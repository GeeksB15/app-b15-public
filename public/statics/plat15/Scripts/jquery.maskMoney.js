!function(e){e.fn.maskMoney=function(t){return t=e.extend({symbol:"",showSymbol:!1,symbolStay:!0,thousands:".",decimal:",",precision:2,defaultZero:!0,allowZero:!0,allowNegative:!0},t),this.each((function(){var n=e(this),a=!1;function r(){a=!0}function l(){a=!1}function o(o){var i,c=(o=o||window.event).charCode||o.keyCode||o.which;if(null==c)return!1;if(n.attr("readonly")&&13!=c&&9!=c)return!1;if(c<48||c>57)return 45==c?(r(),n.val((i=n,t.allowNegative?(i.val(),""!=i.val()&&"-"==i.val().charAt(0)?i.val().replace("-",""):"-"+i.val()):i.val())),!1):43==c?(r(),n.val(n.val().replace("-","")),!1):13==c||9==c?(a&&(l(),e(this).change()),!0):(37==c||39==c||s(o),!0);if(n.val().length>=n.attr("maxlength"))return!1;s(o);var v=String.fromCharCode(c),h=n.get(0),g=n.getInputSelection(h),f=g.start,m=g.end;return h.value=h.value.substring(0,f)+v+h.value.substring(m,h.value.length),u(h,f+1),r(),!1}function i(a){e.browser.msie&&o(a),""==n.val()||n.val()==h(v())||n.val()==t.symbol?t.allowZero?t.symbolStay?n.val(h(v())):n.val(v()):n.val(""):t.symbolStay?t.symbolStay&&n.val()==t.symbol&&n.val(h(v())):n.val(n.val().replace(t.symbol,""))}function s(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function u(e,t){var a=n.val().length;n.val(c(e.value)),t-=a-n.val().length,n.setCursorPosition(t)}function c(e){var n=(e=e.replace(t.symbol,"")).length,a="",r="",l="";if(0!=n&&"-"==e.charAt(0)&&(e=e.replace("-",""),t.allowNegative&&(l="-")),0==n){if(!t.defaultZero)return r;r="0.00"}for(var o=0;o<n&&("0"==e.charAt(o)||e.charAt(o)==t.decimal);o++);for(;o<n;o++)-1!="0123456789".indexOf(e.charAt(o))&&(a+=e.charAt(o));var i=parseFloat(a);r=(i=isNaN(i)?0:i/Math.pow(10,t.precision)).toFixed(t.precision),o=0==t.precision?0:1;var s,u=(r=r.split("."))[o].substr(0,t.precision);for(s=(r=r[0]).length;(s-=3)>=1;)r=r.substr(0,s)+t.thousands+r.substr(s);return t.precision>0?h(l+r+t.decimal+u+Array(t.precision+1-u.length).join(0)):h(l+r)}function v(){return(parseFloat("0")/Math.pow(10,t.precision)).toFixed(t.precision).replace(new RegExp("\\.","g"),t.decimal)}function h(e){return t.showSymbol&&e.substr(0,t.symbol.length)!=t.symbol?t.symbol+e:e}n.bind("keypress.maskMoney",o),n.bind("keydown.maskMoney",(function(t){var o=(t=t||window.event).charCode||t.keyCode||t.which;if(null==o)return!1;if(n.attr("readonly")&&13!=o&&9!=o)return!1;var i=n.get(0),c=n.getInputSelection(i),v=c.start,h=c.end;return 8==o?(s(t),v==h?(i.value=i.value.substring(0,v-1)+i.value.substring(h,i.value.length),v-=1):i.value=i.value.substring(0,v)+i.value.substring(h,i.value.length),u(i,v),r(),!1):9==o?(a&&(e(this).change(),l()),!0):46!=o&&63272!=o||(s(t),i.selectionStart==i.selectionEnd?i.value=i.value.substring(0,v)+i.value.substring(h+1,i.value.length):i.value=i.value.substring(0,v)+i.value.substring(h,i.value.length),u(i,v),r(),!1)})),n.bind("blur.maskMoney",i),n.bind("focus.maskMoney",(function(e){var a=v();if(n.val()==a?n.val(""):""==n.val()&&t.defaultZero?n.val(h(a)):n.val(h(n.val())),this.createTextRange){var r=this.createTextRange();r.collapse(!1),r.select()}})),n.bind("mask",(function(){var e=n.val();n.val(c(e))})),n.data("maskMoney",t),n.val(number_format(n.val(),t.precision)),n.one("unmaskMoney",(function(){n.unbind(".maskMoney"),e.browser.msie?this.onpaste=null:e.browser.mozilla&&this.removeEventListener("input",i,!1)}))}))},e.fn.unmaskMoney=function(){return this.trigger("unmaskMoney")},e.fn.mask=function(){return this.trigger("mask")},e.fn.setCursorPosition=function(e){return this.each((function(t,n){if(n.setSelectionRange)n.focus(),n.setSelectionRange(e,e);else if(n.createTextRange){var a=n.createTextRange();a.collapse(!0),a.moveEnd("character",e),a.moveStart("character",e),a.select()}})),this},e.fn.getInputSelection=function(e){var t,n,a,r,l,o=0,i=0;return"number"==typeof e.selectionStart&&"number"==typeof e.selectionEnd?(o=e.selectionStart,i=e.selectionEnd):(n=document.selection.createRange())&&n.parentElement()==e&&(r=e.value.length,t=e.value.replace(/\r\n/g,"\n"),(a=e.createTextRange()).moveToBookmark(n.getBookmark()),(l=e.createTextRange()).collapse(!1),a.compareEndPoints("StartToEnd",l)>-1?o=i=r:(o=-a.moveStart("character",-r),o+=t.slice(0,o).split("\n").length-1,a.compareEndPoints("EndToEnd",l)>-1?i=r:(i=-a.moveEnd("character",-r),i+=t.slice(0,i).split("\n").length-1))),{start:o,end:i}}}(jQuery);