!function(t){var e,i;i="EAN13",e=function(){function e(t,e,n){var s;if(this.element=t,this.number=e,this.settings={number:!0,prefix:!0,color:"#000",debug:!1,onValid:function(){},onInvalid:function(){},onSuccess:function(){},onError:function(){}},n)for(s in n)this.settings[s]=n[s];this._name=i,this.init()}return e.prototype.settings={},e.prototype.init=function(){var t,e;return 12===this.number.length&&(t=this.generateCheckDigit(this.number),this.number+=t),13===this.number.length?(this.validate()?this.settings.onValid.call():this.settings.onInvalid.call(),e=this.getCode(),this.draw(e)):this.settings.onError.call()},e.prototype.getCode=function(){var t,e,i,n,s,r,h;for(s=["0001101","0011001","0010011","0111101","0100011","0110001","0101111","0111011","0110111","0001011"],r=["0100111","0110011","0011011","0100001","0011101","0111001","0000101","0010001","0001001","0010111"],h=["1110010","1100110","1101100","1000010","1011100","1001110","1010000","1000100","1001000","1110100"],e="",t=["xxxxxx","xxyxyy","xxyyxy","xxyyyx","xyxxyy","xyyxxy","xyyyxx","xyxyxy","xyxyyx","xyyxyx"][parseInt(this.number.substr(0,1),10)].split(""),n=this.number.substr(1).split(""),i=0;6>i;)e+="x"===t[i]?s[n[i]]:r[n[i]],i++;for(i=6;12>i;)e+=h[n[i]],i++;return e},e.prototype.clear=function(t){return t.clearRect(0,0,this.element.width,this.element.height)},e.prototype.draw=function(e){var i,n,s,r,h,o,l,f,u,c,x,g,a,y,p;if(l={prefix_offset:.06,font_stretch:.073,border_line_height_number:.9,border_line_height:1,line_height:.9,font_size:.15,font_y:1.03,text_offset:4.5},g=this.settings.prefix?this.element.width-this.element.width*l.prefix_offset:this.element.width,this.settings.number?(i=l.border_line_height_number*this.element.height,r=l.line_height*i):r=i=l.border_line_height*this.element.height,o=g/95,this.element.getContext){for(s=this.element.getContext("2d"),this.clear(s),s.fillStyle=this.settings.color,f=this.settings.number&&this.settings.prefix?this.element.width*l.prefix_offset:0,u=e.split(""),s.fillRect(f,0,o,i),f+=2*o,s.fillRect(f,0,o,i),f+=o,h=0;42>h;)"1"===u[h]&&s.fillRect(f,0,Math.floor(o)+1,r),f+=o,h++;for(f+=o,s.fillRect(f,0,o,i),f+=2*o,s.fillRect(f,0,o,i),f+=2*o,h=42;84>h;)"1"===u[h]&&s.fillRect(f,0,Math.floor(o)+1,r),f+=o,h++;if(s.fillRect(f,0,o,i),f+=2*o,s.fillRect(f,0,o,i),this.settings.number&&(s.font=l.font_size*r+"px monospace",x=this.number.substr(0,1),this.settings.prefix&&s.fillText(x,0,i*l.font_y),c=o*l.text_offset+(this.settings.prefix?l.prefix_offset*this.element.width:0),n=this.number.substr(1,6).split(""),t.each(n,(function(t,e){return s.fillText(e,c,i*l.font_y),c+=l.font_stretch*g})),c=49*o+(this.settings.prefix?l.prefix_offset*this.element.width:0)+l.text_offset,t.each(this.number.substr(7).split(""),(function(t,e){return s.fillText(e,c,i*l.font_y),c+=l.font_stretch*g}))),this.settings.debug)for(a=y=0,p=2*o;p>0?g>=y:y>=g;a=y+=p)s.beginPath(),s.rect(a,.4*r,o,.1*r),s.fillStyle="red",s.fill();return this.settings.onSuccess.call()}return this.settings.onError.call()},e.prototype.generateCheckDigit=function(e){var i,n;return n=0,i=e.split(""),t.each(i,(function(t,e){return n+=t%2==0?parseInt(e,10):3*parseInt(e,10)})),10-n%10%10},e.prototype.validate=function(){return parseInt(this.number.slice(-1),10)===this.generateCheckDigit(this.number.slice(0,-1))},e}(),t.fn[i]=function(n,s){return this.each((function(){return t.data(this,"plugin_"+i,new e(this,n,s))}))}}(jQuery,window,document);