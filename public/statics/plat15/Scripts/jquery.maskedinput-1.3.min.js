!function(e){var t=(e.browser.msie?"paste":"input")+".mask",n=null!=window.orientation;e.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn"},e.fn.extend({caret:function(e,t){if(0!=this.length){if("number"==typeof e)return t="number"==typeof t?t:e,this.each((function(){if(this.setSelectionRange)this.setSelectionRange(e,t);else if(this.createTextRange){var n=this.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select()}}));if(this[0].setSelectionRange)e=this[0].selectionStart,t=this[0].selectionEnd;else if(document.selection&&document.selection.createRange){var n=document.selection.createRange();e=0-n.duplicate().moveStart("character",-1e5),t=e+n.text.length}return{begin:e,end:t}}},unmask:function(){return this.trigger("unmask")},mask:function(a,r){if(!a&&this.length>0)return e(this[0]).data(e.mask.dataName)();r=e.extend({placeholder:"_",completed:null},r);var i=e.mask.definitions,c=[],o=a.length,l=null,u=a.length;return e.each(a.split(""),(function(e,t){"?"==t?(u--,o=e):i[t]?(c.push(new RegExp(i[t])),null==l&&(l=c.length-1)):c.push(null)})),this.trigger("unmask").each((function(){function s(e){for(var t=v.val(),n=-1,a=0,i=0;a<u;a++)if(c[a]){for(g[a]=r.placeholder;i++<t.length;){var s=t.charAt(i-1);if(c[a].test(s)){g[a]=s,n=a;break}}if(i>t.length)break}else g[a]==t.charAt(i)&&a!=o&&(i++,n=a);return!e&&n+1<o?(v.val(""),h(0,u)):(e||n+1>=o)&&(f(),e||v.val(v.val().substring(0,n+1))),o?a:l}function f(){return v.val(g.join("")).val()}function h(e,t){for(var n=e;n<t&&n<u;n++)c[n]&&(g[n]=r.placeholder)}function d(e,t){if(!(e<0)){for(var n=e,a=m(t);n<u;n++)if(c[n]){if(!(a<u&&c[n].test(g[a])))break;g[n]=g[a],g[a]=r.placeholder,a=m(a)}f(),v.caret(Math.max(l,e))}}function m(e){for(;++e<=u&&!c[e];);return e}var v=e(this),g=e.map(a.split(""),(function(e,t){if("?"!=e)return i[e]?r.placeholder:e})),p=v.val();v.data(e.mask.dataName,(function(){return e.map(g,(function(e,t){return c[t]&&e!=r.placeholder?e:null})).join("")})),v.attr("readonly")||v.one("unmask",(function(){v.unbind(".mask").removeData(e.mask.dataName)})).bind("focus.mask",(function(){p=v.val();var t=s();f();var n=function(){t==a.length?v.caret(0,t):v.caret(t)};(e.browser.msie?n:function(){setTimeout(n,0)})()})).bind("blur.mask",(function(){s(),v.val()!=p&&v.change()})).bind("keydown.mask",(function(e){var t=e.which;if(8==t||46==t||n&&127==t){var a=v.caret(),r=a.begin,i=a.end;return i-r==0&&(r=46!=t?function(e){for(;--e>=0&&!c[e];);return e}(r):i=m(r-1),i=46==t?m(i):i),h(r,i),d(r,i-1),!1}if(27==t)return v.val(p),v.caret(0,s()),!1})).bind("keypress.mask",(function(e){var t=e.which,n=v.caret();if(e.ctrlKey||e.altKey||e.metaKey||t<32)return!0;if(t){n.end-n.begin!=0&&(h(n.begin,n.end),d(n.begin,n.end-1));var a=m(n.begin-1);if(a<u){var i=String.fromCharCode(t);if(c[a].test(i)){(function(e){for(var t=e,n=r.placeholder;t<u;t++)if(c[t]){var a=m(t),i=g[t];if(g[t]=n,!(a<u&&c[a].test(i)))break;n=i}})(a),g[a]=i,f();var o=m(a);v.caret(o),r.completed&&o>=u&&r.completed.call(v)}}return!1}})).bind(t,(function(){setTimeout((function(){v.caret(s(!0))}),0)})),s()}))}})}(jQuery);