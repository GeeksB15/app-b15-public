!function(e,t,n,r){var a,o={};function s(t,n){var i;if(!("FileReader"in e))return n(t.getAsBinary());(i=new FileReader).readAsBinaryString(t),i.onload=function(){n(i.result)}}function d(n,i,r,a){var s,d,l,g,c=this;!function(t,n){var i;if(!("FileReader"in e))return n(t.getAsDataURL());(i=new FileReader).readAsDataURL(t),i.onload=function(){n(i.result)}}(o[n.id],(function(e){(s=t.createElement("canvas")).style.display="none",t.body.appendChild(s),d=s.getContext("2d"),(l=new Image).onerror=l.onabort=function(){a({success:!1})},l.onload=function(){var t,o,h,p;if(i.width||(i.width=l.width),i.height||(i.height=l.height),(g=Math.min(i.width/l.width,i.height/l.height))<1||1===g&&"image/jpeg"===r){if(t=Math.round(l.width*g),o=Math.round(l.height*g),s.width=t,s.height=o,d.drawImage(l,0,0,t,o),"image/jpeg"===r){if((h=new u(atob(e.substring(e.indexOf("base64,")+7)))).headers&&h.headers.length&&(p=new f).init(h.get("exif")[0])&&(p.setExif("PixelXDimension",t),p.setExif("PixelYDimension",o),h.set("exif",p.getBinary()),c.hasEventListener("ExifData")&&c.trigger("ExifData",n,p.EXIF()),c.hasEventListener("GpsData")&&c.trigger("GpsData",n,p.GPS())),i.quality)try{e=s.toDataURL(r,i.quality/100)}catch(t){e=s.toDataURL(r)}}else e=s.toDataURL(r);e=e.substring(e.indexOf("base64,")+7),e=atob(e),h&&h.headers&&h.headers.length&&(e=h.restore(e),h.purge()),s.parentNode.removeChild(s),a({success:!0,data:e})}else a({success:!1})},l.src=e}))}function l(){var e,t=!1;function n(n,i){var r,a=t?0:-8*(i-1),o=0;for(r=0;r<i;r++)o|=e.charCodeAt(n+r)<<Math.abs(a+8*r);return o}function i(t,n,i){i=3===arguments.length?i:e.length-n-1,e=e.substr(0,n)+t+e.substr(i+n)}return{II:function(e){if(e===r)return t;t=e},init:function(n){t=!1,e=n},SEGMENT:function(t,n,r){switch(arguments.length){case 1:return e.substr(t,e.length-t-1);case 2:return e.substr(t,n);case 3:i(r,t,n);break;default:return e}},BYTE:function(e){return n(e,1)},SHORT:function(e){return n(e,2)},LONG:function(e,a){if(a===r)return n(e,4);!function(e,n,r){var a,o="",s=t?0:-24;for(a=0;a<4;a++)o+=String.fromCharCode(n>>Math.abs(s+8*a)&255);i(o,e,4)}(e,a)},SLONG:function(e){var t=n(e,4);return t>2147483647?t-4294967296:t},STRING:function(e,t){var i="";for(t+=e;e<t;e++)i+=String.fromCharCode(n(e,1));return i}}}function u(e){var t,n,i,a={65505:{app:"EXIF",name:"APP1",signature:"Exif\0"},65506:{app:"ICC",name:"APP2",signature:"ICC_PROFILE\0"},65517:{app:"IPTC",name:"APP13",signature:"Photoshop 3.0\0"}},o=[],s=r,d=0;if((t=new l).init(e),65496===t.SHORT(0)){for(n=2,i=Math.min(1048576,e.length);n<=i;)if((s=t.SHORT(n))>=65488&&s<=65495)n+=2;else{if(65498===s||65497===s)break;d=t.SHORT(n+2)+2,a[s]&&t.STRING(n+4,a[s].signature.length)===a[s].signature&&o.push({hex:s,app:a[s].app.toUpperCase(),name:a[s].name.toUpperCase(),start:n,length:d,segment:t.SEGMENT(n,d)}),n+=d}return t.init(null),{headers:o,restore:function(e){t.init(e);var i=new u(e);if(!i.headers)return!1;for(var r=i.headers.length;r>0;r--){var a=i.headers[r-1];t.SEGMENT(a.start,a.length,"")}i.purge(),n=65504==t.SHORT(2)?4+t.SHORT(4):2,r=0;for(var s=o.length;r<s;r++)t.SEGMENT(n,0,o[r].segment),n+=o[r].length;return t.SEGMENT()},get:function(e){for(var t=[],n=0,i=o.length;n<i;n++)o[n].app===e.toUpperCase()&&t.push(o[n].segment);return t},set:function(e,t){var n=[];"string"==typeof t?n.push(t):n=t;for(var i=ii=0,r=o.length;i<r&&(o[i].app===e.toUpperCase()&&(o[i].segment=n[ii],o[i].length=n[ii].length,ii++),!(ii>=n.length));i++);},purge:function(){o=[],t.init(null)}}}}function f(){var e,t,a,o={};function s(t,n){var i,s,d,l,u,f,g,c=e.SHORT(t),h=[],p={};for(i=0;i<c;i++)if(f=t+12*i+2,(d=n[e.SHORT(f)])!==r){switch(l=e.SHORT(f+=2),u=e.LONG(f+=2),f+=4,h=[],l){case 1:case 7:for(u>4&&(f=e.LONG(f)+o.tiffHeader),s=0;s<u;s++)h[s]=e.BYTE(f+s);break;case 2:u>4&&(f=e.LONG(f)+o.tiffHeader),p[d]=e.STRING(f,u-1);continue;case 3:for(u>2&&(f=e.LONG(f)+o.tiffHeader),s=0;s<u;s++)h[s]=e.SHORT(f+2*s);break;case 4:for(u>1&&(f=e.LONG(f)+o.tiffHeader),s=0;s<u;s++)h[s]=e.LONG(f+4*s);break;case 5:for(f=e.LONG(f)+o.tiffHeader,s=0;s<u;s++)h[s]=e.LONG(f+4*s)/e.LONG(f+4*s+4);break;case 9:for(f=e.LONG(f)+o.tiffHeader,s=0;s<u;s++)h[s]=e.SLONG(f+4*s);break;case 10:for(f=e.LONG(f)+o.tiffHeader,s=0;s<u;s++)h[s]=e.SLONG(f+4*s)/e.SLONG(f+4*s+4);break;default:continue}g=1==u?h[0]:h,a.hasOwnProperty(d)&&"object"!=typeof g?p[d]=a[d][g]:p[d]=g}return p}return e=new l,t={tiff:{274:"Orientation",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}},a={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},{init:function(n){return o={tiffHeader:10},!(n===r||!n.length)&&(e.init(n),65505===e.SHORT(0)&&"EXIF\0"===e.STRING(4,5).toUpperCase()&&function(){var n,i=o.tiffHeader;return e.II(18761==e.SHORT(i)),42===e.SHORT(i+=2)&&(o.IFD0=o.tiffHeader+e.LONG(i+=2),n=s(o.IFD0,t.tiff),o.exifIFD="ExifIFDPointer"in n?o.tiffHeader+n.ExifIFDPointer:r,o.gpsIFD="GPSInfoIFDPointer"in n?o.tiffHeader+n.GPSInfoIFDPointer:r,!0)}())},EXIF:function(){var e;if((e=s(o.exifIFD,t.exif)).ExifVersion&&"array"===n.typeOf(e.ExifVersion)){for(var i=0,r="";i<e.ExifVersion.length;i++)r+=String.fromCharCode(e.ExifVersion[i]);e.ExifVersion=r}return e},GPS:function(){var e;return(e=s(o.gpsIFD,t.gps)).GPSVersionID&&(e.GPSVersionID=e.GPSVersionID.join(".")),e},setExif:function(n,r){return("PixelXDimension"===n||"PixelYDimension"===n)&&function(n,r,a){var s,d,l,u=0;if("string"==typeof r){var f=t[n.toLowerCase()];for(hex in f)if(f[hex]===r){r=hex;break}}for(s=o[n.toLowerCase()+"IFD"],d=e.SHORT(s),i=0;i<d;i++)if(l=s+12*i+2,e.SHORT(l)==r){u=l+8;break}return!!u&&(e.LONG(u,a),!0)}("exif",n,r)},getBinary:function(){return e.SEGMENT()}}}n.runtimes.Html5=n.addRuntime("html5",{getFeatures:function(){var i,r,o,s,d,l,u;return r=o=d=l=!1,e.XMLHttpRequest&&(o=!!(i=new XMLHttpRequest).upload,r=!(!i.sendAsBinary&&!i.upload)),r&&(s=!!(i.sendAsBinary||e.Uint8Array&&e.ArrayBuffer),d=!(!File||!File.prototype.getAsDataURL&&!e.FileReader||!s),l=!(!File||!(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice))),a=n.ua.safari&&n.ua.windows,{html5:r,dragdrop:(u=t.createElement("div"),"draggable"in u||"ondragstart"in u&&"ondrop"in u),jpgresize:d,pngresize:d,multipart:d||!!e.FileReader||!!e.FormData,canSendBinary:s,cantSendBlobInFormData:!(!(n.ua.gecko&&e.FormData&&e.FileReader)||FileReader.prototype.readAsArrayBuffer),progress:o,chunks:l,multi_selection:!(n.ua.safari&&n.ua.windows),triggerDialog:n.ua.gecko&&e.FormData||n.ua.webkit}},init:function(i,r){var l,u;function f(e){var t,r,a,s=[],d={};for(r=0;r<e.length;r++)d[(t=e[r]).name]||(d[t.name]=!0,a=n.guid(),o[a]=t,s.push(new n.File(a,t.fileName||t.name,t.fileSize||t.size)));s.length&&i.trigger("FilesAdded",s)}(l=this.getFeatures()).html5?(i.bind("Init",(function(e){var r,a,o,s,d,l,u,g=[],c=e.settings.filters,h=t.body;(r=t.createElement("div")).id=e.id+"_html5_container",n.extend(r.style,{position:"absolute",background:i.settings.shim_bgcolor||"transparent",width:"100px",height:"100px",overflow:"hidden",zIndex:99999,opacity:i.settings.shim_bgcolor?"":0}),r.className="plupload html5",i.settings.container&&(h=t.getElementById(i.settings.container),"static"===n.getStyle(h,"position")&&(h.style.position="relative")),h.appendChild(r);e:for(o=0;o<c.length;o++)for(d=c[o].extensions.split(/,/),s=0;s<d.length;s++){if("*"===d[s]){g=[];break e}(l=n.mimeTypes[d[s]])&&-1===n.inArray(l,g)&&g.push(l)}if(r.innerHTML='<input id="'+i.id+'_html5"  style="font-size:999px" type="file" accept="'+g.join(",")+'" '+(i.settings.multi_selection&&i.features.multi_selection?'multiple="multiple"':"")+" />",r.scrollTop=100,u=t.getElementById(i.id+"_html5"),e.features.triggerDialog?n.extend(u.style,{position:"absolute",width:"100%",height:"100%"}):n.extend(u.style,{cssFloat:"right",styleFloat:"right"}),u.onchange=function(){f(this.files),this.value=""},a=t.getElementById(e.settings.browse_button)){var p=e.settings.browse_button_hover,m=e.settings.browse_button_active,y=e.features.triggerDialog?a:r;p&&(n.addEvent(y,"mouseover",(function(){n.addClass(a,p)}),e.id),n.addEvent(y,"mouseout",(function(){n.removeClass(a,p)}),e.id)),m&&(n.addEvent(y,"mousedown",(function(){n.addClass(a,m)}),e.id),n.addEvent(t.body,"mouseup",(function(){n.removeClass(a,m)}),e.id)),e.features.triggerDialog&&n.addEvent(a,"click",(function(n){var i=t.getElementById(e.id+"_html5");i&&!i.disabled&&i.click(),n.preventDefault()}),e.id)}})),i.bind("PostInit",(function(){var e=t.getElementById(i.settings.drop_element);if(e){if(a)return void n.addEvent(e,"dragenter",(function(r){var a,o;(a=t.getElementById(i.id+"_drop"))||((a=t.createElement("input")).setAttribute("type","file"),a.setAttribute("id",i.id+"_drop"),a.setAttribute("multiple","multiple"),n.addEvent(a,"change",(function(){f(this.files),n.removeEvent(a,"change",i.id),a.parentNode.removeChild(a)}),i.id),e.appendChild(a)),n.getPos(e,t.getElementById(i.settings.container)),o=n.getSize(e),"static"===n.getStyle(e,"position")&&n.extend(e.style,{position:"relative"}),n.extend(a.style,{position:"absolute",display:"block",top:0,left:0,width:o.w+"px",height:o.h+"px",opacity:0})}),i.id);n.addEvent(e,"dragover",(function(e){e.preventDefault()}),i.id),n.addEvent(e,"drop",(function(e){var t=e.dataTransfer;t&&t.files&&f(t.files),e.preventDefault()}),i.id)}})),i.bind("Refresh",(function(e){var r,a,o,s,d;(r=t.getElementById(i.settings.browse_button))&&(a=n.getPos(r,t.getElementById(e.settings.container)),o=n.getSize(r),s=t.getElementById(i.id+"_html5_container"),n.extend(s.style,{top:a.y+"px",left:a.x+"px",width:o.w+"px",height:o.h+"px"}),i.features.triggerDialog&&("static"===n.getStyle(r,"position")&&n.extend(r.style,{position:"relative"}),d=parseInt(n.getStyle(r,"z-index"),10),isNaN(d)&&(d=0),n.extend(r.style,{zIndex:d}),n.extend(s.style,{zIndex:d-1})))})),i.bind("DisableBrowse",(function(e,n){var i=t.getElementById(e.id+"_html5");i&&(i.disabled=n)})),i.bind("CancelUpload",(function(){u&&u.abort&&u.abort()})),i.bind("UploadFile",(function(t,i){var r,a=t.settings;function f(r){var o=0,s=0,d="FileReader"in e?new FileReader:null;!function f(){var g,c,h,p,m,y,S=t.settings.url;function v(r){var a,d=0,v="----pluploadboundary"+n.guid(),b="--",E="\r\n",F="";if((u=new XMLHttpRequest).upload&&(u.upload.onprogress=function(e){i.loaded=Math.min(i.size,s+e.loaded-d),t.trigger("UploadProgress",i)}),u.onreadystatechange=function(){var e,d;if(4==u.readyState&&t.state!==n.STOPPED){try{e=u.status}catch(t){e=0}if(e>=400)t.trigger("Error",{code:n.HTTP_ERROR,message:n.translate("HTTP Error."),file:i,status:e});else{if(c){if(d={chunk:o,chunks:c,response:u.responseText,status:e},t.trigger("ChunkUploaded",i,d),s+=m,d.cancelled)return void(i.status=n.FAILED);i.loaded=Math.min(i.size,(o+1)*p)}else i.loaded=i.size;t.trigger("UploadProgress",i),r=g=a=F=null,!c||++o>=c?(i.status=n.DONE,t.trigger("FileUploaded",i,{response:u.responseText,status:e})):f()}}},t.settings.multipart&&l.multipart){if(h.name=i.target_name||i.name,u.open("post",S,!0),n.each(t.settings.headers,(function(e,t){u.setRequestHeader(t,e)})),"string"!=typeof r&&e.FormData)return a=new FormData,n.each(n.extend(h,t.settings.multipart_params),(function(e,t){a.append(t,e)})),a.append(t.settings.file_data_name,r),void u.send(a);if("string"==typeof r){if(u.setRequestHeader("Content-Type","multipart/form-data; boundary="+v),n.each(n.extend(h,t.settings.multipart_params),(function(e,t){F+=b+v+E+'Content-Disposition: form-data; name="'+t+'"'+E+E,F+=unescape(encodeURIComponent(e))+E})),y=n.mimeTypes[i.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",F+=b+v+E+'Content-Disposition: form-data; name="'+t.settings.file_data_name+'"; filename="'+unescape(encodeURIComponent(i.name))+'"\r\nContent-Type: '+y+E+E+r+E+b+v+b+E,d=F.length-r.length,r=F,u.sendAsBinary)u.sendAsBinary(r);else if(l.canSendBinary){for(var x=new Uint8Array(r.length),D=0;D<r.length;D++)x[D]=255&r.charCodeAt(D);u.send(x.buffer)}return}}S=n.buildUrl(t.settings.url,n.extend(h,t.settings.multipart_params)),u.open("post",S,!0),u.setRequestHeader("Content-Type","application/octet-stream"),n.each(t.settings.headers,(function(e,t){u.setRequestHeader(t,e)})),u.send(r)}i.status!=n.DONE&&i.status!=n.FAILED&&t.state!=n.STOPPED&&(h={name:i.target_name||i.name},a.chunk_size&&i.size>a.chunk_size&&(l.chunks||"string"==typeof r)?(p=a.chunk_size,c=Math.ceil(i.size/p),m=Math.min(p,i.size-o*p),g="string"==typeof r?r.substring(o*p,o*p+m):function(e,t,n){var i;if(!File.prototype.slice)return(i=File.prototype.webkitSlice||File.prototype.mozSlice)?i.call(e,t,n):null;try{return e.slice(),e.slice(t,n)}catch(i){return e.slice(t,n-t)}}(r,o*p,o*p+m),h.chunk=o,h.chunks=c):(m=i.size,g=r),t.settings.multipart&&l.multipart&&"string"!=typeof g&&d&&l.cantSendBlobInFormData&&l.chunks&&t.settings.chunk_size?(d.onload=function(){v(d.result)},d.readAsBinaryString(g)):v(g))}()}r=o[i.id],l.jpgresize&&t.settings.resize&&/\.(png|jpg|jpeg)$/i.test(i.name)?d.call(t,i,t.settings.resize,/\.png$/i.test(i.name)?"image/png":"image/jpeg",(function(e){e.success?(i.size=e.data.length,f(e.data)):l.chunks?f(r):s(r,f)})):!l.chunks&&l.jpgresize?s(r,f):f(r)})),i.bind("Destroy",(function(e){var i,r,a=t.body,o={inputContainer:e.id+"_html5_container",inputFile:e.id+"_html5",browseButton:e.settings.browse_button,dropElm:e.settings.drop_element};for(i in o)(r=t.getElementById(o[i]))&&n.removeAllEvents(r,e.id);n.removeAllEvents(t.body,e.id),e.settings.container&&(a=t.getElementById(e.settings.container)),a.removeChild(t.getElementById(o.inputContainer))})),r({success:!0})):r({success:!1})}})}(window,document,plupload);