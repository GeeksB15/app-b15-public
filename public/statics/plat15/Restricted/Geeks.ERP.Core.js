Geeks.ERP.Core.Connection=new function(){this.ExecuteSQL=function(e,r,o,n){var a,t=null,s=r?config.serverAddress:$("#hfCodigoSistema").data("GeeksData").URLServidor,i=r?config.structureDatabase:$("#hfCodigoSistema").data("GeeksData").BancoDeDados;if($.isArray(e)){var u=[];for(var m in e)console.log("Chamando Sentença: "+e[m]),e[m]=e[m].replace(/'/g,"$--$").replace(/"/g,"-#-#-"),u.push(e[m]);s+="/ExecuteAllSQL",a=JSON.stringify(u)}else console.log("Chamando Sentença: "+e),s+="/ExecuteSQL",a=e=e.replace(/'/g,"$--$").replace(/"/g,"-#-#-");return $.ajax({type:"POST",url:s,data:{database:i,sentence:a,user:$("#hfCodigoUsuario").length>0?$("#hfCodigoUsuario").val():17,caller:null!=this.ExecuteSQL.caller&&null!=this.ExecuteSQL.caller.name?this.ExecuteSQL.caller.name:"Report"},dataType:"json",async:!!o,success:function(r){if($.isArray(e)){var o=$.grep(r,(function(e){return 1==e.HasError}));if(o.length>0)return void ShowError(o[0])}else if(r.HasError)return void ShowError(r);if(t=r,$.isArray(t)){for(var a=0;a<t.length;a++)for(c in t[a].Columns)if("DateTime"==t[a].Columns[c].ColumnType)for(l in t[a].Records)t[a].Records[l]&&t[a].Records[l]["__"+t[a].Columns[c].ColumnName]&&(s=t[a].Records[l]["__"+t[a].Columns[c].ColumnName].split(".")).length>1&&(t[a].Records[l][t[a].Columns[c].ColumnName]="/Date("+new Date(s[2],s[1]-1,s[0],s[3],s[4],s[5]).getTime()+")/"),delete t[a].Records[l]["__"+t[a].Columns[c].ColumnName]}else for(c in t.Columns)if("DateTime"==t.Columns[c].ColumnType)for(l in t.Records){var s;t.Records[l]&&t.Records[l]["__"+t.Columns[c].ColumnName]&&(s=t.Records[l]["__"+t.Columns[c].ColumnName].split(".")).length>1&&(t.Records[l][t.Columns[c].ColumnName]="/Date("+new Date(s[2],s[1]-1,s[0],s[3],s[4],s[5]).getTime()+")/"),delete t.Records[l]["__"+t.Columns[c].ColumnName]}n&&n(t)},error:function(e){ShowError(e.responseText)}}),t},this.ReportExecuteSQL=function(e,r,o,n){var a,t=null,s=r?config.serverAddress:$("#hfCodigoSistema").data("GeeksData").URLServidor,i=r?config.structureDatabase:$("#hfCodigoSistema").data("GeeksData").BancoDeDados;if($.isArray(e)){var u=[];for(var m in e){if(console.log("Chamando Sentença: "+e[m]),e[m].toLowerCase().indexOf("update")>-1||e[m].toLowerCase().indexOf("delete")>-1||e[m].toLowerCase().indexOf("alter")>-1||e[m].toLowerCase().indexOf("create")>-1||e[m].toLowerCase().indexOf("drop")>-1||e[m].toLowerCase().indexOf("truncate")>-1||e[m].toLowerCase().indexOf("insert")>-1||e[m].indexOf("exec")>-1||e[m].indexOf("grant")>-1)return void ShowError("Query não permitida! "+e[m]);e[m]=e[m].replace(/'/g,"$--$").replace(/"/g,"-#-#-"),u.push(e[m])}s+="/ExecuteAllSQL",a=JSON.stringify(u)}else{if(console.log("Chamando Sentença: "+e),e.toLowerCase().indexOf("update")>-1||e.toLowerCase().indexOf("delete")>-1||e.toLowerCase().indexOf("alter")>-1||e.toLowerCase().indexOf("create")>-1||e.toLowerCase().indexOf("drop")>-1||e.toLowerCase().indexOf("truncate")>-1||e.toLowerCase().indexOf("insert")>-1||e.indexOf("exec")>-1||e.indexOf("grant")>-1)return void ShowError("Query não permitida! "+e);s+="/ExecuteSQL",a=e=e.replace(/'/g,"$--$").replace(/"/g,"-#-#-")}return $.ajax({type:"POST",url:s,data:{database:i,sentence:a,user:$("#hfCodigoUsuario").length>0?$("#hfCodigoUsuario").val():17,caller:null!=this.ExecuteSQL.caller&&null!=this.ExecuteSQL.caller.name?this.ExecuteSQL.caller.name:"Report"},dataType:"json",async:!!o,success:function(r){if($.isArray(e)){var o=$.grep(r,(function(e){return 1==e.HasError}));if(o.length>0)return void ShowError(o[0])}else if(r.HasError)return void ShowError(r);if(t=r,$.isArray(t)){for(var a=0;a<t.length;a++)for(c in t[a].Columns)if("DateTime"==t[a].Columns[c].ColumnType)for(l in t[a].Records)t[a].Records[l]&&t[a].Records[l]["__"+t[a].Columns[c].ColumnName]&&(s=t[a].Records[l]["__"+t[a].Columns[c].ColumnName].split(".")).length>1&&(t[a].Records[l][t[a].Columns[c].ColumnName]="/Date("+new Date(s[2],s[1]-1,s[0],s[3],s[4],s[5]).getTime()+")/"),delete t[a].Records[l]["__"+t[a].Columns[c].ColumnName]}else for(c in t.Columns)if("DateTime"==t.Columns[c].ColumnType)for(l in t.Records){var s;t.Records[l]&&t.Records[l]["__"+t.Columns[c].ColumnName]&&(s=t.Records[l]["__"+t.Columns[c].ColumnName].split(".")).length>1&&(t.Records[l][t.Columns[c].ColumnName]="/Date("+new Date(s[2],s[1]-1,s[0],s[3],s[4],s[5]).getTime()+")/"),delete t.Records[l]["__"+t.Columns[c].ColumnName]}n&&n(t)},error:function(e){ShowError(e.responseText)}}),t},this.ExecuteSQLAnotherDB=function(e,r,o){var n,a=null,t=null!=o?o:$("#hfCodigoSistema").data("GeeksData").URLServidor,s=e;if($.isArray(r)){var i=[];for(var u in r)console.log("Chamando Sentença: "+r[u]),r[u]=r[u].replace(/'/g,"$--$").replace(/"/g,"-#-#-"),i.push(r[u]);t+="/ExecuteAllSQL",n=JSON.stringify(i)}else console.log("Chamando Sentença: "+r),t+="/ExecuteSQL",n=r=r.replace(/'/g,"$--$").replace(/"/g,"-#-#-");return $.ajax({type:"POST",url:t,data:{database:s,sentence:n,user:$("#hfCodigoUsuario").length>0?$("#hfCodigoUsuario").val():17,caller:null!=this.ExecuteSQL.caller&&null!=this.ExecuteSQL.caller.name?this.ExecuteSQL.caller.name:"Report"},dataType:"json",async:!1,success:function(e){if($.isArray(r)){var o=$.grep(e,(function(e){return 1==e.HasError}));if(o.length>0)return void ShowError(o[0])}else if(e.HasError)return void ShowError(e);if(a=e,$.isArray(a)){for(var n=0;n<a.length;n++)for(c in a[n].Columns)if("DateTime"==a[n].Columns[c].ColumnType)for(l in a[n].Records)a[n].Records[l]&&a[n].Records[l]["__"+a[n].Columns[c].ColumnName]&&(t=a[n].Records[l]["__"+a[n].Columns[c].ColumnName].split(".")).length>1&&(a[n].Records[l][a[n].Columns[c].ColumnName]="/Date("+new Date(t[2],t[1]-1,t[0],t[3],t[4],t[5]).getTime()+")/"),delete a[n].Records[l]["__"+a[n].Columns[c].ColumnName]}else for(c in a.Columns)if("DateTime"==a.Columns[c].ColumnType)for(l in a.Records){var t;a.Records[l]&&a.Records[l]["__"+a.Columns[c].ColumnName]&&(t=a.Records[l]["__"+a.Columns[c].ColumnName].split(".")).length>1&&(a.Records[l][a.Columns[c].ColumnName]="/Date("+new Date(t[2],t[1]-1,t[0],t[3],t[4],t[5]).getTime()+")/"),delete a.Records[l]["__"+a.Columns[c].ColumnName]}},error:function(e){ShowError(e.responseText)}}),a}},Geeks.ERP.Core.Permission=new function(){this.Check=function(e,r,o){String.prototype.stripHTML=function(){return this.replace(/<.*?>/g,"").replace(/\n/g,"").replace(/\r/g,"")};var n=!0;if("true"==$("#hfUsuarioAdm").val())n=!0;else if(o&&o.stripHTML().trim().length>0&&(o=o.stripHTML().split(";")).length%4==0){for(var a=new Array,l=0;l<o.length;l+=4)a.push(o[l].trim()+";"+o[l+1].trim()+";"+o[l+2].trim()+";"+o[l+3].trim());n=!1,$.each(a,(function(o,a){var l=a.trim().split(";");l[0]=l[0].toLowerCase().trim(),l[1]=l[1].toLowerCase().trim(),l[2]=l[2].toLowerCase().trim(),"permitir"!=l[0]||"usuário"!=l[1]||l[2]!=e&&0!=l[2]||(n=!0),"bloquear"!=l[0]||"usuário"!=l[1]||l[2]!=e&&0!=l[2]||(n=!1),"invisivel"!=l[0]||"usuário"!=l[1]||l[2]!=e&&0!=l[2]||(n=!1),"permitir"!=l[0]||"grupo"!=l[1]||l[2]!=r&&0!=l[2]||(n=!0),"bloquear"!=l[0]||"grupo"!=l[1]||l[2]!=r&&0!=l[2]||(n=!1),"invisivel"!=l[0]||"grupo"!=l[1]||l[2]!=r&&0!=l[2]||(n=!1)}))}return n}},Geeks.ERP.Core.Permissao={Sistema:function(){}};