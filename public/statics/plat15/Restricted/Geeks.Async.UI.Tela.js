Geeks.Async.UI.Tela={editingSource:!1,dataSource:function(e){const a=async function(a,o){const i=$.grep(e.Campos,(function(e){return e.CodigoSessao==a.CodigoSessao}));$.each(i,(function(a,i){let n=o&&o.length>0?o[0][i.Id]:null;if("data"==i.TipoCampo&&null!=n){const e=new Date(parseInt(n.substr(6))).getTime();n=kendo.toString(new Date(e),"dd/MM/yyyy")}e.Target.find("input[name="+i.Id+"]:not([type=file]), select[name="+i.Id+i.CodigoCampo+"], checkbox[name="+i.Id+"], textarea[name="+i.Id+"], input[name=promptDisplay_"+i.Id+"]").val(n);const t=$.grep(e.Campos,(function(e){return e.CampoForeignKeyPrompt==i.Id}));if(t.length>0&&e.Target.find("input[name=promptDisplay_"+i.Id+"]").val(o&&o.length>0?o[0][t[0].Id]:null),e.Target.find("input[type=checkbox][name="+i.Id+"], checkbox[name="+i.Id+"]").prop("checked","1"==n||"true"==n||1==n),e.Target.find("div[name="+i.Id+"], span[name="+i.Id+"], a[name="+i.Id+"]").html(n),e.Target.find("input[name="+i.Id+"]:not([type=file]), select[name="+i.Id+"], checkbox[name="+i.Id+"], textarea[name="+i.Id+"]").change(),e.Target.find("input[type=checkbox][name="+i.Id+"], checkbox[name="+i.Id+"]").change(),"selecao"==i.TipoCampo&&e.Target.find("select[name="+i.Id+i.CodigoCampo+"]").trigger("liszt:updated"),"numero"==i.TipoCampo||"valor"==i.TipoCampo||"valor4"==i.TipoCampo||"moeda"==i.TipoCampo){const a=e.Target.find("[name="+i.Id+"]");let o=0;"valor"==i.TipoCampo?o=2:"valor4"==i.TipoCampo&&(o=4),o>0&&$(a).val(number_format($(a).val(),o))}"datahora"==i.TipoCampo&&n?(e.Target.find("[name=d_"+i.Id+"]").val(kendo.toString(new Date(1*n.match(/\d+/)[0]),"dd/MM/yyyy")),e.Target.find("[name=t_"+i.Id+"]").val(kendo.toString(new Date(1*n.match(/\d+/)[0]),"HH:mm:ss")),e.Target.find("[name="+i.Id+"]").val(kendo.toString(new Date(1*n.match(/\d+/)[0]),"dd/MM/yyyy HH:mm:ss"))):"datahora"==i.TipoCampo&&(e.Target.find("[name=d_"+i.Id+"]").val(""),e.Target.find("[name=t_"+i.Id+"]").val(""),e.Target.find("[name="+i.Id+"]").val("")),$.uniform.update()}))},o=function(a,o){var i="",n="INSERT INTO "+(e.TabelaMaster.indexOf(",")>-1?e.TabelaMaster.split(",")[0]:e.TabelaMaster)+" (",t=" VALUES (";return $.each(a,(function(a,r){var d=$.grep(e.Campos,(function(e){return e.CodigoSessao==r.CodigoSessao&&e.GravaCampoNoBanco}));$.each(d,(function(e,a){if(!("selecao"==a.TipoCampo.toLowerCase()&&o.find("[name^="+a.Id+"]").length<=0||"selecao"!=a.TipoCampo.toLowerCase()&&o.find("[name="+a.Id+"]").length<=0)){if("prompt"!=a.TipoCampo.toLowerCase())switch(n+=a.Id+",",a.TipoCampo.toLowerCase()){case"email":case"selecao":""==o.find("[name^="+a.Id+"]").val()||"undefined"==o.find("[name^="+a.Id+"]").val()||null==o.find("[name^="+a.Id+"]").val()||null==o.find("[name^="+a.Id+"]").val()?t+="NULL, ":t+="'"+o.find("[name^="+a.Id+"]").val()+"', ";break;case"textolongo":case"editorhtml":case"texto":case"moeda":case"prompt":case"arquivo":case"data":case"datahora":t+=(o.find("[name="+a.Id+"]").val()?"'"+o.find("[name="+a.Id+"]").val().replace(/'/g,"''")+"'":"null")+", ";break;case"valor":case"valor4":case"numero":t+=(o.find("[name="+a.Id+"]").val()?""+getDecimal(o.find("[name="+a.Id+"]").val()):"0")+", ";break;case"senha":""!=o.find("[name="+a.Id+"]").val()&&(t+=(o.find("[name="+a.Id+"]").val()?"'"+calcMD5(o.find("[name="+a.Id+"]").val())+"'":"null")+", ");break;case"checagem":t+=(o.find("[name="+a.Id+"]").attr("checked")?"1":"0")+", "}else"prompt"==a.TipoCampo.toLowerCase()&&(n+=a.Id+",",t+=(o.find("[name="+a.Id+"]").val()?"'"+o.find("[name="+a.Id+"]").val().replace(/'/g,"''")+"'":"null")+", ");if(a.Obrigatorio||""!=o.find("[name="+a.Id+"]").val())switch(a.TipoCampo){case"Data":validaData(o.find("[name="+a.Id+"]").val())||(i+="<strong>"+a.Label+"</strong> => data inválida.<br />");break;case"Email":validaMail(o.find("[name="+a.Id+"]").val())||(i+="<strong>"+a.Label+"</strong> => formato de E-mail inválido.<br />");default:""==o.find("[name="+a.Id+"]").val()&&(i+="<strong>"+a.Label+"</strong> => campo obrigatório.<br />")}}}))})),""!=i?(jError(i,"Atenção"),""):(n=n.substr(0,n.length-1)+")",t=t.substr(0,t.length-2)+"); SELECT SCOPE_IDENTITY() as Codigo",n+t)},i=function(a){var o=$.grep(e.Campos,(function(e){return 1==e.Obrigatorio})),i="";return $.each(o,(function(e,o){"selecao"==o.TipoCampo.toLowerCase()?a.find("[name^="+o.Id+"]").val()||(i+='O campo "'+o.Label+'" deve ser informado.<br/>'):"prompt"!=o.TipoCampo.toLowerCase()||"prompt"==o.TipoCampo.toLowerCase()&&!o.CampoForeignKeyPrompt?a.find("[name="+o.Id+"]").val()||(i+='O campo "'+o.Label+'" deve ser informado.<br/>'):a.find("[name="+o.CampoForeignKeyPrompt+"]").val()||(i+='O campo "'+o.Label+'" deve ser informado.<br/>')})),$.each(e.Campos,(function(e,o){"valor"!=o.TipoCampo.toLowerCase()&&"valor4"!=o.TipoCampo.toLowerCase()&&"numero"!=o.TipoCampo.toLowerCase()||null!=a.find("[name="+o.Id+"]").val()&&isNaN(a.find("[name="+o.Id+"]").val().replace(/\./g,"").replace(",","."))&&(i+='Valor do campo "'+o.Label+'" inválido.<br/>')})),!i||(jError(i,"Atenção"),!1)};return{Fill:async function(o){var i,n=[],t=[],r="("+e.SentencaSQL+") Tabela";i=e.TabelaMaster.indexOf(",")>-1?e.TabelaMaster.split(",")[0]:e.TabelaMaster,(!e.SentencaSQL||e.SentencaSQL.trim().length<=0)&&(r="(select * from "+i+") tb");var d=$.grep(e.Sessoes,(function(e){return e.SentencaSQL==r||null==e.SentencaSQL||""==e.SentencaSQL.trim()})),s="SELECT ";$.each(d,(function(a,o){var i=$.grep(e.Campos,(function(e){return e.CodigoSessao==o.CodigoSessao&&e.LeCampoDoBanco}));$.each(i,(function(e,a){s+=a.Id+", "}))})),s=s.substr(0,s.length-2),s+=" FROM "+r+" WHERE 1 = 1 ",null==o&&""==$(o).trim()||(s+=" AND "+o),n.push(s);var l=$.grep(e.Sessoes,(function(e){return e.SentencaSQL!=r&&null!=e.SentencaSQL&&""!=e.SentencaSQL.trim()&&"Campo"==e.TipoSessao}));$.each(l,(function(a,i){var r=$.grep(e.Campos,(function(e){return e.CodigoSessao==i.CodigoSessao&&e.LeCampoDoBanco}));if(r.length>0){var d="SELECT ";$.each(r,(function(e,a){d+=a.Id+", "})),d=d.substr(0,d.length-2),d+=" FROM "+i.SentencaSQL+" WHERE 1 = 1 ",null==o&&""==$(o).trim()||(d+=" AND "+o),n.push(d),t.push(i)}}));var c=await Geeks.Async.Core.Connection.ExecuteSQL(n,e.Estrutural);c&&c.RecordsAffected>0&&$.jGrowl("Registro salvo com sucesso."),$.each(d,(function(e,o){a(o,c[0].Records)})),$.each(t,(function(e,o){"Campo"==o.TipoSessao&&a(o,c[e+1].Records)})),c[0].Records.length<=0?$(e.Target).find(".k-grid-toolbar").css("display","none"):$(e.Target).find(".k-grid-toolbar").css("display","block"),c&&$(e.Target).find(".breadLine .breadLinks").find("ul[name=MenuBotoes]").find("a[VisivelComRegistro=true]").parent().css("display","block"),n=[],t=[];var u=$.grep(e.Campos,(function(e){return 1==e.Identificador}));if(u.length>0){var m=$.grep(e.Sessoes,(function(e){return"Grade"==e.TipoSessao}));$.each(m,(function(a,o){var i=$.grep(e.Grades,(function(e){return e.CodigoSessao==o.CodigoSessao}));if(i.length>0){var r=$(e.Target).find("[name=kendogrid_"+i[0].Descricao+"]").data("kendoGrid");if(i[0].ForeignKeyName&&c[0].Records[0]){r.filter=i[0].ForeignKeyName+" = '"+c[0].Records[0][u[0].Id]+"'";var d="";i[0].TabelaMaster.indexOf(",")>-1&&(d=i[0].TabelaMaster.split(",")[1]),""!=d&&(r.filter=r.filter+" AND TabelaMaster = '"+d+"'")}else r.filter="0 = 1",console.log("Grade sem Foreign Key: "+i[0].CodigoGrid+" - "+i[0].Descricao);var s=r.sentenceSql();s&&(n.push(s),t.push(o))}})),c=await Geeks.Async.Core.Connection.ExecuteSQL(n,e.Estrutural),$.each(t,(function(a,o){if("Grade"==o.TipoSessao){var i=$.grep(e.Grades,(function(e){return e.CodigoSessao==o.CodigoSessao}));if(i.length>0){var n=$(e.Target).find("[name=kendogrid_"+i[0].Descricao+"]").data("kendoGrid"),t=n.dataSource.transport.read;n.dataSource.transport.read=function(e){e.success(c[a].Records)},n.Fill(),n.dataSource.transport.read=t}}}))}this.AfterFill&&this.AfterFill()},Update:async function(a){if(i(e.Target)){if(null==e.TabelaMaster||e.TabelaMaster.indexOf(" ")>=0)return jAlert("Esta interface não permite gravação automática. Verifique a sentença SQL!"),"";var n=!0;if(this.BeforeUpdate&&(n=this.BeforeUpdate()),n){var t,r=[],d=$.grep(e.Sessoes,(function(a){var o;return o=e.TabelaMaster.indexOf(",")>-1?e.TabelaMaster.split(",")[0]:e.TabelaMaster,a.SentencaSQL==o||null==a.SentencaSQL||""==a.SentencaSQL.trim()})),s=0,l=$.grep(e.Campos,(function(a){return!!(a.Identificador&&e.Target.find("[name="+a.Id+"]").length>0)&&(s=e.Target.find("[name="+a.Id+"]").val(),!0)}));if(l.lengh<=0||!l[0])return jError("<strong>O campo de identificação não foi localizado, por favor entre em contato com a Geeks!</strong><br />","Atenção"),"";if(parseInt(s)>0){if(""==(t=function(a){let o="",i="",n=!1,t="";t=e.TabelaMaster.indexOf(",")>-1?e.TabelaMaster.split(",")[0]:e.TabelaMaster;let r="UPDATE "+t+" SET ";return $.each(a,(function(a,t){var d=$.grep(e.Campos,(function(e){return e.CodigoSessao==t.CodigoSessao&&(e.GravaCampoNoBanco||e.Identificador)}));$.each(d,(function(a,t){if(!("selecao"==t.TipoCampo.toLowerCase()&&e.Target.find("[name="+t.Id+t.CodigoCampo+"]").length<=0||"selecao"!=t.TipoCampo.toLowerCase()&&e.Target.find("[name="+t.Id+"]").length<=0)){if(t.Identificador)"prompt"==t.TipoCampo.toLowerCase()&&(r+=t.Id+"=",r+=(e.Target.find("[name="+t.Id+"]").val()?"'"+e.Target.find("[name="+t.Id+"]").val().replace(/'/g,"''")+"'":"null")+", ");else switch(t.TipoCampo.toLowerCase()){case"email":case"selecao":""==e.Target.find("[name="+t.Id+t.CodigoCampo+"]").val()||"undefined"==e.Target.find("[name="+t.Id+t.CodigoCampo+"]").val()||null==e.Target.find("[name="+t.Id+t.CodigoCampo+"]").val()||null==e.Target.find("[name="+t.Id+t.CodigoCampo+"]").val()?r+=t.Id+"= NULL, ":(r+=t.Id+"= '",r+=e.Target.find("[name="+t.Id+t.CodigoCampo+"]").val()+"', ");break;case"textolongo":case"editorhtml":case"texto":case"prompt":case"arquivo":case"data":case"datahora":r+=t.Id+"=",r+=(e.Target.find("[name="+t.Id+"]").val()?"'"+e.Target.find("[name="+t.Id+"]").val().replace(/'/g,"''")+"'":"null")+", ";break;case"numero":case"valor":case"valor4":r+=t.Id+"=",r+=(e.Target.find("[name="+t.Id+"]").val()?""+getDecimal(e.Target.find("[name="+t.Id+"]").val()):"0")+", ";break;case"senha":""!=e.Target.find("[name="+t.Id+"]").val()&&(r+=t.Id+"=",r+=(e.Target.find("[name="+t.Id+"]").val()?"'"+calcMD5(e.Target.find("[name="+t.Id+"]").val())+"'":"null")+", ");break;case"checagem":r+=t.Id+"=",r+=(e.Target.find("[name="+t.Id+"]").attr("checked")?"1":"0")+", "}if(t.Identificador&&(n=!0,o+=(""==o?" WHERE ":" AND ")+t.Id+"='"+e.Target.find("[name="+t.Id+"]").val().replace(/'/g,"''")+"'"),t.Obrigatorio||""!=e.Target.find("[name="+t.Id+"]").val())switch(t.TipoCampo){case"Data":validaData(e.Target.find("[name="+t.Id+"]").val())||(i+="<strong>"+t.Label+"</strong> => data inválida.<br />");break;case"Email":validaMail(e.Target.find("[name="+t.Id+"]").val())||(i+="<strong>"+t.Label+"</strong> => formato de E-mail inválido.<br />");default:""==e.Target.find("[name="+t.Id+"]").val()&&(i+="<strong>"+t.Label+"</strong> => campo obrigatório.<br />")}}}))})),n||(i+="<strong>O campo de identificação não foi localizado, por favor entre em contato com a Geeks!</strong><br />"),""!=i?(jError(i,"Atenção"),""):(r=r.substr(0,r.length-2)+o,r)}(d)))return"";a&&(t.toLowerCase().indexOf("where")>0?t+=" AND "+a:t+=" WHERE "+a),r.push(t)}else{if(""==(t=o(d,e.Target)))return"";r.push(t)}var c=await Geeks.Async.Core.Connection.ExecuteSQL(r,e.Estrutural);return this.AfterUpdate&&this.AfterUpdate(c),c}}},AddNew:async function(){var a=this,n=[],t=200,r=[],d=null,s=$.grep(e.Campos,(function(e){return e.Obrigatorio&&e.GravaCampoNoBanco||e.Identificador}));if($.each(s,(function(a,o){if(o.Identificador)d=o;else{var i=$.grep(e.Sessoes,(function(e){return e.CodigoSessao==o.CodigoSessao}));$.grep(r,(function(e){return e.CodigoSessao==o.CodigoSessao})).length<=0&&r.push(i[0]);var s={CodigoSessao:1,Label:o.Label,Id:o.Id,TipoCampo:o.TipoCampo,Obrigatorio:!0,Identificador:!1,SentencaSQL:o.SentencaSQL,Ordem:a,LabelLargura:3,CampoLargura:9,Leitura:o.Leitura,CampoForeignKeyPrompt:o.CampoForeignKeyPrompt,Visivel:o.Visivel};n.push(s),t+36<600&&(t+=36)}})),d){var l={Descricao:"Incluindo "+e.Descricao,CodigoObjeto:e.CodigoObjeto,NomeObjeto:e.NomeObjeto,CodigoPersonalizado:e.CodigoPersonalizado,Estrutural:e.Estrutural,Sessoes:[{CodigoSessao:1,TipoSessao:"unica",Ordem:1,Layout:"opened"}],Campos:n,Botoes:[{Nome:"Salvar",Valor:"Salvar",CodigoBotao:"INC1",Icone:"icon-checkmark"},{Nome:"Cancelar",Valor:"Cancelar",CodigoBotao:"INC2",Icone:"icon-minus"}]},c=await Geeks.Async.UI.Tela.OpenWindow("popupAdd",e.Target,l,null,!0,!0,!1);c.find(".fluid").css("padding-bottom","20px");var u=c.dialog({modal:!0,width:600,height:t<600?t:600,resizable:!0,closeOnEscape:!1,close:function(){c.remove()}});return u.dialog("open"),c.find("a[name=btn_Salvar]").click((async function(){if(i(c)){if(a.BeforeAddNew&&!a.BeforeAddNew(c))return;var n=o(r,c),t=await Geeks.Async.Core.Connection.ExecuteSQL(n,e.Estrutural);t&&(a.Fill(d.Id+" = "+t.Records[0].Codigo),$(e.Target).find(".k-grid-toolbar").css("display","block"),$(e.Target).find(".breadLine .breadLinks").find("ul[name=MenuBotoes]").find("a[VisivelComRegistro=true]").parent().css("display","block"),u.dialog("close")),a.AfterAddNew&&a.AfterAddNew(c)}})),c.find("a[name=btn_Cancelar]").click((function(){u.dialog("close"),u.remove()})),c}jError("Não foi encontrado o campo identificador, por favor, entre em contato com a Geeks!")},Delete:function(){this.BeforeDelete&&this.BeforeDelete(),this.AfterDelete&&this.AfterDelete()},AfterAddNew:null,BeforeAddNew:null,AfterUpdate:null,BeforeUpdate:null,AfterDelete:null,BeforeDelete:null,AfterFill:null}},OpenWindow:async function(e,a,o,i,n,t,r){return new Promise((async(t,d)=>{if("gridEdit"!=e&&"popup"!=e&&"popupAdd"!=e&&"popupEdit"!=e&&0!=o.CodigoObjeto){const e=JSON.parse(localStorage.getItem("dadosUsuario"));let a="if (Select count(*) from UsuarioPermissaoSistema ups inner join Usuario u on u.CodigoUsuario = ups.CodigoUsuario \tleft join UsuarioPermissao up on up.CodigoUsuarioPermissaoSistema = ups.CodigoUsuarioPermissaoSistema \twhere up.Permitir = 1 and ups.CodigoUsuario=0"+e.CodigoUsuario+" and up.CodigoObjeto = "+o.CodigoObjeto+" and ups.CodigoClienteSistema = "+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema+") > 0 or \t(Select count(*) from UsuarioPermissaoSistema ups inner join Usuario u on u.CodigoUsuario = ups.CodigoUsuario \tleft join GrupoPermissao gp on gp.CodigoGrupo = ups.CodigoGrupo \twhere gp.Permitir = 1 and ups.CodigoUsuario=0"+e.CodigoUsuario+" and gp.CodigoObjeto = "+o.CodigoObjeto+" and ups.CodigoClienteSistema = "+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema+") > 0 \tSelect 1 Permitir else \tSelect 0 Permitir ";const i=(await Geeks.Async.Core.Connection.ExecuteSQL(a,!0)).Records;var s="true"==$("#hfUsuarioAdm").val();if("true"!=$("#hfUsuarioAdm").val()&&i&&i.length>0&&(s=i[0].Permitir),!s)return void $.jGrowl("O usuário não possui permissão para a tela "+o.Descricao);a="Insert into LogMenu (CodigoUsuario, CodigoContato, Nome, CodigoMenu, DescricaoMenu, DataHoraAcesso) Select 0"+e.CodigoUsuario+", CodigoContato, Nome, 0"+o.CodigoObjeto+", '"+o.Descricao+"', getDate() from Contato where CodigoUsuario = 0"+e.CodigoUsuario,await Geeks.Async.Core.Connection.ExecuteSQL(a)}if("popup"!=e&&$(">div[ref=contentBody]",a).hide(),r)try{console.log(a),console.log("entrou 2"),o.CodigoPersonalizado=(await Geeks.Async.Core.Connection.ExecuteSQL("select CodigoPersonalizado From Objeto Where CodigoObjeto = "+o.CodigoObjeto,!0)).Records[0].CodigoPersonalizado}catch(e){}o.CodigoPersonalizado||(o.CodigoPersonalizado="");var l=$(a).find("#"+e+"_"+o.NomeObjeto);if(l.length<=0?(l=$(Geeks.ERP.UI.Template.Get("ContentBodyTemplate").format({Codigo:e+"_"+o.NomeObjeto})).appendTo(a),$("<ul name='MenuBotoes'></ul>").appendTo(l.find(".breadLine > .breadLinks")).append(Geeks.Async.UI.Tela.MontaBotoes([{Nome:"Fechar",Valor:"Fechar",CodigoBotao:"D0",Icone:"icon-exit"}],null)),l.find("a[name=btn_Fechar]").click((function(){if("content"==e){var o=a.data("OpenedWindows");if(o){for(var i=null,n=o.windows.length-1;n>=0;n--)if(o.windows[n].attr("id")==l.attr("id")){i=o.windows[n-1];break}i&&$("#"+i.attr("id")).length>0?(o.windows=$.grep(o.windows,(function(e){return e.attr("id")!=l.attr("id")})),i.show(),Geeks.Async.UI.Tela.integracao(i.attr("id"),i)):(o.windows=$.grep(o.windows,(function(e){return e.attr("id")!=l.attr("id")})),$("#content_Menu").show(),$(document).find("title").html("Geeks - B15 :: Menu"))}}$(this).parents("[ref=contentBody]").remove()})),n&&await Geeks.Async.UI.Tela.RenderObjeto(l,o,"gridEdit"==e||"popupEdit"==e||"popupAdd"==e),Geeks.Async.UI.Tela.FormataCampos(l),l.find(".wrapper > .fluid").prepend("<script>$(function (){ var currentContainer = $('#"+e+"_"+o.NomeObjeto+"');  try { "+o.CodigoPersonalizado+" \r } catch(ex) { jError(ex.message, 'Erro no código personalizado'); } }); <\/script>"),l.find(".wrapper > .fluid").find("script").remove(),l.append("<input name='CodigoObjeto' type='hidden' value='"+o.CodigoObjeto+"'/>"),this.integracao(o.NomeObjeto,l)):(l.css("display",""),this.integracao(o.NomeObjeto,l)),l.find("span[ref=bodyTitle]").html(o.CodigoObjeto+" - "+o.Descricao),l.find("span[ref=imgIcon]").addClass(o.Icone),l.close=function(){i&&i(),l.remove()},l.find(".k-grid-add").prop("title","Adicionar Registro"),l.find(".k-grid-edit").prop("title","Editar Registro"),l.find(".k-grid-delete").prop("title","Excluir Registro"),l.find(".k-grid-excel").prop("title","Exportar para Excel"),l.find(".k-grid-layout").prop("title","Salvar Layout da Grade"),l.find(".k-grid-collapse").prop("title","Minimizar Linhas"),l.find(".k-grid-expand").prop("title","Expandir Linhas"),"content"==e&&"content_Menu"!=l.attr("id")){$(document).find("title").html(o.Descricao+" :: B15");var c=a.data("OpenedWindows");c||(c={windows:[]},a.data("OpenedWindows",c)),c.windows.push(l)}"content"==e&&$(window).scrollTop(0),l.find(".breadLine").sticky({topSpacing:0,zIndex:999}),t(l)}))},RenderObjeto:async function(e,a,o){return new Promise((async(i,n)=>{if(!o){const e=await Geeks.Async.Core.Connection.ExecuteSQL(["select * from objeto where codigoObjeto = "+a.CodigoObjeto,"select o.Descricao as Objeto, s.* from SESSAO as s left join Objeto as o on s.CodigoObjeto = o.CodigoObjeto where s.codigoObjeto = "+a.CodigoObjeto+" and s.Ativo = 1order by Ordem","select * from botao where codigoObjeto = "+a.CodigoObjeto+" order by ordem","select Graficos.* from Graficos inner join Sessao on Sessao.CodigoSessao = Graficos.CodigoSessao Where Sessao.CodigoObjeto = "+a.CodigoObjeto,"select Campo.* from Campo inner join Sessao on Sessao.CodigoSessao = Campo.CodigoSessao Where Sessao.CodigoObjeto = "+a.CodigoObjeto+" and Campo.Ativo = 1 and Sessao.Ativo = 1 order by Ordem","select Grid.* from Grid inner join Sessao on Sessao.CodigoSessao = Grid.CodigoSessao Where Sessao.CodigoObjeto = "+a.CodigoObjeto+" and Grid.Ativo = 1"],!0);(a=e[0].Records[0]).Sessoes=e[1].Records,a.Botoes=e[2].Records,a.Graficos=e[3].Records,a.Campos=e[4].Records,a.Grades=e[5].Records,a.Record=null}const t=Geeks.ERP.UI.Grid;e.find("ul[name='MenuBotoes']").prepend(Geeks.Async.UI.Tela.MontaBotoes(a.Botoes,null));let r=0;$.each(a.Sessoes,(function(o,i){let n=e.find(".fluid");if("unica"!=i.TipoSessao){if(r+=parseInt(i.Largura),n=$(Geeks.ERP.UI.Template.Get("SessaoTemplate").format({CodigoSessao:i.CodigoSessao,Tipo:"grade"==i.TipoSessao.toLowerCase()?"Grade":"",Largura:i.Largura,Alinhamento:i.Alinhamento,Layout:"opened"==i.Layout.toLowerCase()?"opened inactive":"closed"==i.Layout?"closed normal":"",Descricao:i.Descricao,Estilo:"grade"==i.TipoSessao.toLowerCase()?"overflow-x: auto; ":""})).appendTo(e.find(".fluid")),r>12&&(r=i.Largura),("true"!=$("#hfUsuarioAdm").val()||"true"==$("#hfUsuarioAdm").val()&&"1"!=$("#hfGrupoInterno").val())&&n.find("[just-adm=true]").remove(),"grade"!=i.TipoSessao.toLowerCase()&&n.find("[just-grade=true]").remove(),"campo"!=i.TipoSessao.toLowerCase()&&n.find("[just-campo=true]").remove(),"gráfico"!=i.TipoSessao.toLowerCase()&&n.find("[just-grafico=true]").remove(),"Campo"!=i.TipoSessao){if(""==i.Tamanho||null==i.Tamanho)if("contentBody"==n.parents(".wrapper").parent().attr("ref")&&$(window).height()>300){let e=$(window).height()-n.parents(".wrapper").parent().position().top;$.each(n.parents(".wrapper").siblings(),(function(){e-=$(this).outerHeight()})),$.each(n.find(".body").siblings(),(function(){e-=$(this).outerHeight()})),i.Tamanho=e-n.outerHeight()+20}else i.Tamanho=300;i.Tamanho&&n.find(".body").css("height",i.Tamanho)}else""!=i.Tamanho&&null!=i.Tamanho&&n.find(".body").css("height",i.Tamanho-10);"Campo"!=i.TipoSessao&&(n.find(".body").css("padding-bottom","0px"),n.find(".body").css("overflow","hidden"))}else e.find(".fluid").append('<div class="body" name="sessao_'+i.CodigoSessao+'"></div>');if("grade"==i.TipoSessao.toLowerCase()){let o=$.grep(a.Grades,(function(e){return e.CodigoSessao==i.CodigoSessao}));o.length>0&&(t.Render(n.find(".body"),o[0],"",a.Estrutural),n.find("a[name=PropriedadeGrid]").click((async function(){const n=await Geeks.Async.UI.Tela.OpenWindow("popup",e,{CodigoObjeto:0,NomeObjeto:"Propriedades",Descricao:'Propriedades da Grade "'+i.Descricao+'"',Estrutural:!0},null,!1,!0);t.Propriedade(o[0],n,a.Estrutural),event.stopPropagation&&event.stopPropagation(),event.cancelBubble=!0})))}else if("campo"==i.TipoSessao.toLowerCase()||"unica"==i.TipoSessao.toLowerCase()){let e=0,o=!0,t=null;var d=$.grep(a.Campos,(function(e){return e.CodigoSessao==i.CodigoSessao}));$.each(d,(function(r,s){if($.grep(d,(function(e){return e.CampoForeignKeyPrompt==s.Id})).length<=0){if(o&&(t=$('<div class="formRow"></div>').appendTo("unica"==i.TipoSessao.toLowerCase()?n:n.find(".body")),o=!1),t.append(Geeks.Async.UI.Tela.MontaCampos(i.Ordem,s,a.Record,!1,a.Estrutural)),e+=parseInt(s.LabelLargura)+parseInt(s.CampoLargura),d.length-1>r){var l=d[r+1].LabelLargura+d[r+1].CampoLargura;e+l>12&&(e=12)}(e>=12||r==d.length-1)&&(e=0,t.append('<div class="clear"></div>'),o=!0)}}))}else"grafico"==i.TipoSessao.toLowerCase()&&n.find(".body").append('<div name="chart" style="width: 100%; height: 100%"/>');n.find("a[name=BotaoSessao]").click((async function(){var a=[],o=JSON.parse((await Geeks.Async.Core.Connection.ExecuteSQL("Select g.* from Sessao s left join Grid as g on g.CodigoSessao = s.CodigoSessao where s.CodigoSessao = 12 ",!0)).Records[0].DtaLayout);$.each(o.columns,(function(e,i){o.dataSource.schema.model.fields.hasOwnProperty(i.field)&&(o.dataSource.schema.model.fields[i.field],a.push({CodigoSessao:1,Label:i.title,Id:i.field,TipoCampo:null!=i.geeksType?i.geeksType:"texto",Obrigatorio:i.Obrigatorio,Identificador:i.Identificador,SentencaSQL:i.dropDownOptions,Ordem:e,LabelLargura:3,CampoLargura:9,Leitura:i.Leitura,CampoForeignKeyPrompt:i.campoForeignKeyPrompt,Visivel:!i.hidden,GravaCampoNoBanco:i.GravaCampoNoBanco}))}));var n={Descricao:'Propriedades da Sessão "'+i.Descricao+'"',CodigoObjeto:12,NomeObjeto:"Propriedades",Estrutural:!0,Sessoes:[{CodigoSessao:1,TipoSessao:"unica",Ordem:1}],Campos:a,Record:i,Botoes:[{Nome:"Salvar",Valor:"Salvar",CodigoBotao:"S1",Icone:"icon-checkmark"},{Nome:"Cancelar",Valor:"Cancelar",CodigoBotao:"S2",Icone:"icon-minus"}]},t=await Geeks.Async.UI.Tela.OpenWindow("popupEdit",e,n,null,!0,!0),r=t.dialog({modal:!0,width:600,height:600,resizable:!0,close:function(){t.remove()}}).dialog("open");t.find("a[name=btn_Salvar]").click((async function(){var e="",a="";$.each(t.find("input, select, textarea"),(function(){var o=$(this).data("FieldData");o&&(o.Leitura||o.Identificador||!o.GravaCampoNoBanco?(a+=a?" AND ":" WHERE ",a+=o.Id+" = '"+$(this).val()+"'"):(e+=e?",":"","checagem"!=o.TipoCampo?"null"!=$(this).val()&&""!=$(this).val()&&null!=$(this).val()||"numero"==o.TipoCampo?"null"!=$(this).val()&&""!=$(this).val()&&null!=$(this).val()||"numero"!=o.TipoCampo?e+=o.Id+" = '"+$(this).val()+"'":e+=o.Id+" = 0":e+=o.Id+" = null":e+=o.Id+" = "+($(this).prop("checked")?"1":"0")))})),await Geeks.Async.Core.Connection.ExecuteSQL("UPDATE Sessao SET "+e+a,!0),r.dialog("close")})),t.find("a[name=btn_Cancelar]").click((function(){r.dialog("close")})),event.stopPropagation&&event.stopPropagation(),event.cancelBubble=!0})),n.find("a[name=BotaoComponente]").click((async function(){var a="",o="";"campo"==i.TipoSessao.toLowerCase()?(a="13",o="Campos"):"gráfico"==i.TipoSessao.toLowerCase()&&(a="23",o="Gráfico");var n=await Geeks.Async.UI.Tela.OpenWindow("popup",e,{CodigoObjeto:0,NomeObjeto:"Sessao",Descricao:o+' da Sessão "'+i.Descricao+'"',Estrutural:!0},null,!1,!0),r=n.dialog({modal:!0,width:"80%",height:600,resizable:!0,close:function(){n.remove()}}).dialog("open");$("<ul name='MenuBotoes'><ul>").prependTo(n.find(".breadLine > .breadLinks")).append(Geeks.Async.UI.Tela.MontaBotoes([{Nome:"Cancelar",Valor:"Cancelar",CodigoBotao:"S2",Icone:"icon-minus"}],null)).find("a[name=btn_Cancelar]").click((function(){r.dialog("close")}));var d=(await Geeks.Async.Core.Connection.ExecuteSQL("select * from Grid Where CodigoGrid = "+a,!0)).Records[0];d.sessao=i.CodigoSessao;var s=$("<div name='promptBotAdm_"+i.CodigoSessao+"'></div>").appendTo(n.find(".fluid"));t.Render(s,d,!0,!0),n.find("[name^=kendogrid_]").data("kendoGrid").filter="CodigoSessao = "+i.CodigoSessao,n.find("[name^=kendogrid_]").data("kendoGrid").foreignKeyName="CodigoSessao",n.find("[name^=kendogrid_]").data("kendoGrid").foreignKeyValue=i.CodigoSessao,n.find("[name^=kendogrid_]").data("kendoGrid").Fill(),event.stopPropagation&&event.stopPropagation(),event.cancelBubble=!0}))})),a.Target=e,a.TelaDesabilitada=!1,a.DataSource=Geeks.Async.UI.Tela.dataSource(a),e.data("GeeksForm",a),$(a.Target).find(".breadLine .breadLinks").find("ul[name=MenuBotoes]").find("a[VisivelComRegistro=true]").parent().css("display","none"),i()}))},MontaBotoes:function(e,a){var o=$("<div>"),i=$.grep(e,(function(e){return e.CodigoPai==a})),n=i.length;return $.each(i,(function(i,t){var r=$.grep(e,(function(e){return e.CodigoPai==t.CodigoBotao})),d=$("<li></li>").addClass(r.length>0?"has":""),s=$("<a title='"+t.Valor+"' name='btn_"+t.Nome+"' VisivelComRegistro='"+t.VisivelComRegistro+"'></a>");i===n-1&&null!=a&&s.addClass("noBorderB"),s.appendTo(d),$("<i class='"+t.Icone+"'></i>").appendTo(s),$("<span>"+t.Valor+"</span>").appendTo(s),r.length>0&&$("<ul></ul>").css("display","none").appendTo(d).append(Geeks.Async.UI.Tela.MontaBotoes(r,t.CodigoBotao)),o.append(d)})),$(o.html())},MontaCampos:function(e,a,o,i,n){var t="";e=100*parseInt(e);var r=function(){return o&&o.hasOwnProperty(a.Id)&&o[a.Id]?o[a.Id]:a.ValorPadrao?a.ValorPadrao:""};if(a.Visivel)switch(a.TipoCampo.toLowerCase()){case"texto":0!=a.LabelLargura&&null!=a.LabelLargura&&(t='<div class="grid'+(i?4:a.LabelLargura)+'"><label for="'+a.Id+'">'+a.Label+"</label></div>"),0!=a.CampoLargura&&null!=a.LabelLargura&&(t+='<div class="grid'+(i?8:a.CampoLargura)+'"><input class="align'+("auto"!=a.Alinhamento?a.Alinhamento:"left")+'" type="text" name="'+a.Id+'" id="'+a.Id+'"  value="'+r()+'" tabindex="'+(e+parseInt(a.Ordem))+'" '+(a.Obrigatorio?"required":"")+"  ",a.Leitura&&(t+=' readonly="readonly" disabled="disabled" style="background-color: var(--geeks-lightGray);" '),t+="></div>");break;case"email":0!=a.LabelLargura&&null!=a.LabelLargura&&(t='<div class="grid'+a.LabelLargura+'"><label for="'+a.Id+'">'+a.Label+"</label></div>"),0!=a.CampoLargura&&null!=a.LabelLargura&&(t+='<div class="grid'+(i?8:a.CampoLargura)+'"><input class="align'+("auto"!=a.Alinhamento?a.Alinhamento:"left")+' inputEmail" type="text" value="'+r()+'"  id="'+a.Id+'" '+(a.Obrigatorio?"required":"")+' class="validate[required,custom[email]]" name="'+a.Id+'" tabindex="'+(e+parseInt(a.Ordem))+'"  ',a.Leitura&&(t+=' readonly="readonly" disabled="disabled" style="background-color: var(--geeks-lightGray);" '),t+="></div>");break;case"valor":0!=a.LabelLargura&&null!=a.LabelLargura&&(t='<div class="grid'+(i?4:a.LabelLargura)+'"><label for="'+a.Id+'">'+a.Label+"</label></div>"),0!=a.CampoLargura&&null!=a.LabelLargura&&(t+='<div class="grid'+(i?8:a.CampoLargura)+'"><input class="align'+("auto"!=a.Alinhamento?a.Alinhamento:"right")+' inputMoeda" type="text" value="'+r()+'" name="'+a.Id+'"  id="'+a.Id+'" '+(a.Obrigatorio?"required":"")+' tabindex="'+(e+parseInt(a.Ordem))+'"  ',a.Leitura&&(t+=' readonly="readonly" disabled="disabled" style="background-color: var(--geeks-lightGray);" '),t+="></div>");break;case"valor4":0!=a.LabelLargura&&null!=a.LabelLargura&&(t='<div class="grid'+(i?4:a.LabelLargura)+'"><label for="'+a.Id+'">'+a.Label+"</label></div>"),0!=a.CampoLargura&&null!=a.LabelLargura&&(t+='<div class="grid'+(i?8:a.CampoLargura)+'"><input class="align'+("auto"!=a.Alinhamento?a.Alinhamento:"right")+' inputValor4" type="text" value="'+r()+'" name="'+a.Id+'"  id="'+a.Id+'" '+(a.Obrigatorio?"required":"")+' tabindex="'+(e+parseInt(a.Ordem))+'"  ',a.Leitura&&(t+=' readonly="readonly" disabled="disabled" style="background-color: var(--geeks-lightGray);" '),t+="></div>");break;case"numero":0!=a.LabelLargura&&null!=a.LabelLargura&&(t='<div class="grid'+(i?4:a.LabelLargura)+'"><label for="'+a.Id+'">'+a.Label+"</label></div>"),0!=a.CampoLargura&&null!=a.LabelLargura&&(t+='<div class="grid'+(i?8:a.CampoLargura)+'"><input class="align'+("auto"!=a.Alinhamento?a.Alinhamento:"right")+' inputNumero" type="text" name="'+a.Id+'"  id="'+a.Id+'" value="'+r()+'" tabindex="'+(e+parseInt(a.Ordem))+'" '+(a.Obrigatorio?"required":""),a.Leitura&&(t+=' readonly="readonly" disabled="disabled" style="background-color: var(--geeks-lightGray);" '),t+="></div>");break;case"data":0!=a.LabelLargura&&null!=a.LabelLargura&&(t='<div class="grid'+(i?4:a.LabelLargura)+'"><label for="'+a.Id+'">'+a.Label+"</label></div>"),0!=a.CampoLargura&&null!=a.LabelLargura&&(t+='<div class="grid'+(i?8:a.CampoLargura)+'"><input type="text" name="'+a.Id+'" '+(a.Obrigatorio?"required":"")+' maxlength="10"  value="'+(r()?kendo.toString(r(),"dd/MM/yyyy"):"")+'" tabindex="'+(e+parseInt(a.Ordem))+'" ',a.Leitura?t+=' readonly="readonly" disabled="disabled" style="background-color: var(--geeks-lightGray);" ':t+=' class="datepicker"',t+="></div>");break;case"datahora":0!=a.LabelLargura&&null!=a.LabelLargura&&(t='<div class="grid'+(i?4:a.LabelLargura)+'"><label for="d_'+a.Id+'">'+a.Label+"</label></div>"),0!=a.CampoLargura&&null!=a.LabelLargura&&(t+='<div class="grid'+(i?8:a.CampoLargura)+'"><div style="float:left; width: 48%"><input type="text"  name="d_'+a.Id+'" maxlength="10"  value="'+(r()?kendo.toString(r(),"dd/MM/yyyy"):"")+'" tabindex="'+(e+parseInt(a.Ordem))+'" '+(a.Obrigatorio?"required":"")+' onchange="SetaValorDataHora(this);" ',a.Leitura?t+=' readonly="readonly" disabled="disabled" style="background-color: var(--geeks-lightGray); width: 100% !important;"  ':t+=' class="datepicker" style="width: 100% !important;"',t+="></div>",t+='<div style="float:right;  width: 48%;"><input type="text" '+(a.Obrigatorio?"required":"")+' name="t_'+a.Id+'" value="'+(r()?kendo.toString(r(),"HH:mm:ss"):"")+'" tabindex="'+(e+parseInt(a.Ordem))+'" onchange="SetaValorDataHora(this);" ',a.Leitura?t+=' readonly="readonly" disabled="disabled" style="background-color: var(--geeks-lightGray); width: 100% !important;"  ':t+=' class="timepicker" style="width: 100% !important;"',t+='></div><input type="hidden" name="'+a.Id+'" value="'+(r()?kendo.toString(r(),"dd/MM/yyyy HH:mm:ss"):"")+'"/></div>');break;case"selecao":if(0!=a.LabelLargura&&null!=a.LabelLargura&&(t='<div class="grid'+(i?4:a.LabelLargura)+'">',t+=' <label for="'+a.Id+a.CodigoCampo+'">'+a.Label+"</label>",t+="</div>"),0!=a.CampoLargura&&null!=a.LabelLargura){if(t+='<div class="grid'+(i?8:a.CampoLargura)+'">',t+='    <select data-placeholder="Selecione uma opção" name="'+a.Id+a.CodigoCampo+'" tabindex="'+(e+parseInt(a.Ordem))+'"  id="'+a.Id+a.CodigoCampo+'" '+(a.Obrigatorio?"required=false":"required=true"),a.Leitura&&(t+=' disabled="disabled" '),t+=' class="select ">',null!=a.SentencaSQL||""!=a.SentencaSQL){var d=(a.SentencaSQL?a.SentencaSQL:"").split("\n");$.each(d,(function(e,a){t+='        <option value="'+a.split("=")[0]+'" '+(r()==a.split("=")[0]?"selected":"")+">"+a.split("=")[1]+"</option>"}))}t+="    </select>",t+="</div>"}break;case"prompt":0!=a.LabelLargura&&null!=a.LabelLargura&&(t='<div class="grid'+(i?4:a.LabelLargura)+'">',t+='    <label for="'+a.CampoForeignKeyPrompt+'">'+a.Label+"</label>",t+="</div>"),0!=a.CampoLargura&&null!=a.LabelLargura&&(t+='<div class="grid'+(i?8:a.CampoLargura)+'">',t+='   <input type="text" data="prompt"  tabindex="'+(e+parseInt(a.Ordem))+'" ',a.Leitura&&(t+=' readonly="readonly" disabled="disabled" style="background-color: var(--geeks-lightGray);" '),t+=' id="'+(a.CampoForeignKeyPrompt?a.CampoForeignKeyPrompt:a.Id)+'"  name="promptDisplay_'+(a.CampoForeignKeyPrompt?a.CampoForeignKeyPrompt:a.Id)+'"  '+(a.Obrigatorio?"required":"")+' value="'+r()+'" '+(a.Leitura||a.CampoForeignKeyPrompt?"":"onchange=\"SetaValorPrompt(this, '"+a.Id+"');\"")+'><input type="hidden" name="'+(a.CampoForeignKeyPrompt?a.CampoForeignKeyPrompt:a.Id)+'" value="'+(a.CampoForeignKeyPrompt?o&&o.hasOwnProperty(a.CampoForeignKeyPrompt)&&o[a.CampoForeignKeyPrompt]?o[a.CampoForeignKeyPrompt]:a.ValorPadrao?a.ValorPadrao:"":r())+'"/>',t+='   <img src="Content/Plugins/Aquincum/images/icons/usual/icon-create2.png" id="img_'+a.CodigoCampo+'" alt="Clicar" class="fieldIcon" style="cursor: pointer;"  > ',t+="</div>");break;case"checagem":0!=a.LabelLargura&&null!=a.LabelLargura&&(t='<div class="grid'+(i?4:a.LabelLargura)+'"><label for="'+a.Id+'">'+a.Label+"</label></div>"),0!=a.CampoLargura&&null!=a.LabelLargura&&(t+='<div class="grid'+(i?8:a.CampoLargura)+'"><input type="checkbox" class="check" name="'+a.Id+'"  id="'+a.Id+'" '+("1"==r()||1==r()||"true"==r()?"checked":"")+' tabindex="'+(e+parseInt(a.Ordem))+'" '+(a.Obrigatorio?"required":"")+" ",a.Leitura&&(t+=' readonly="readonly" disabled="disabled" '),t+="></div>");break;case"textolongo":0!=a.LabelLargura&&null!=a.LabelLargura&&(t='<div class="grid'+(i?4:a.LabelLargura)+'">',t+='    <label for="'+a.Id+'">'+a.Label+"</label>",t+="</div>"),0!=a.CampoLargura&&null!=a.LabelLargura&&(t+='<div class="grid'+(i?8:a.CampoLargura)+'">',t+='   <textarea name="'+a.Id+'" id="'+a.Id+'" '+(a.Obrigatorio?"required":"")+" rows='1'  tabindex=\""+(e+parseInt(a.Ordem))+'" ',a.Leitura?t+=' readonly="readonly" disabled="disabled" style="padding-right: 20px; background-color: var(--geeks-lightGray); overflow-x: hidden;"></textarea>':t+="style='padding-right: 20px; overflow-x: hidden;'></textarea>",t+='   <img src="Content/Plugins/Aquincum/images/icons/usual/icon-books2.png" alt="Clicar" class="fieldIcon" style="cursor: pointer; right: 15px;"  > ',t+="</div>");break;case"editorhtml":0!=a.LabelLargura&&null!=a.LabelLargura&&(t='<div class="grid'+(i?4:a.LabelLargura)+'">',t+='    <label for="'+a.Id+'">'+a.Label+"</label>",t+="</div>"),0!=a.CampoLargura&&null!=a.LabelLargura&&(t+='<div class="grid'+(i?8:a.CampoLargura)+'">',t+='   <input type="text" name="'+a.Id+'" id="'+a.Id+'" '+(a.Obrigatorio?"required":"")+" value=''  tabindex=\""+(e+parseInt(a.Ordem))+'" ',a.Leitura&&(t+=' readonly="readonly" disabled="disabled" style="background-color: var(--geeks-lightGray);" '),t+="> ",t+='   <img src="Content/Plugins/Aquincum/images/icons/usual/icon-books2.png" alt="Clicar" class="fieldIcon" style="cursor: pointer;"  > ',t+="</div>");break;case"senha":0!=a.LabelLargura&&null!=a.LabelLargura&&(t='<div class="grid'+(i?4:a.LabelLargura)+'"><label for="'+a.Id+'">'+a.Label+"</label></div>"),0!=a.CampoLargura&&null!=a.LabelLargura&&(t+='<div class="grid'+(i?8:a.CampoLargura)+'"><input type="password" name="'+a.Id+'"  id="'+a.Id+'" '+(a.Obrigatorio?"required":"")+' value="'+r()+'" tabindex="'+(e+parseInt(a.Ordem))+'" ></div>');break;case"arquivo":0!=a.LabelLargura&&null!=a.LabelLargura&&(t='<div class="grid'+(i?4:a.LabelLargura)+'"><label for="name_'+a.Id+'">'+a.Label+"</label></div>"),0!=a.CampoLargura&&null!=a.LabelLargura&&(t+='<div class="grid'+(i?8:a.CampoLargura)+'"><input type="file" class="fileInput" name="file_'+a.Id+'"  id="file_'+a.Id+'"  tabindex="'+(e+parseInt(a.Ordem))+'" style="opacity: 0;" ',a.Leitura&&(t+=' readonly="readonly" disabled="disabled" style="background-color: var(--geeks-lightGray);" '),t+=">",t+='<div style="display: '+(""==r()?"none":"table-cell")+';"><input type="hidden" name="'+a.Id+'" value="'+r()+'"/><table style="margin-left: 10px"><tr><td style="vertical-align: middle;"><a name= "view_'+a.Id+'" href="" target="_blank" title="Download"><i class="icos-cloud-download"></i></a></td><td style="vertical-align: middle;"><a name= "delete_'+a.Id+'" title="Remover"><i class="k-icon k-delete" style="width: 14px; height: 14px;"></i></a></td></tr></table></div>',t+="</div>");break;default:t=""}else t='<input type="hidden" name="'+a.Id+'" value="'+r()+'"/>';var s=$(t);return"prompt"==a.TipoCampo.toLowerCase()?(s.find("input[type=hidden]").data("GeeksForm",{SentencaSQL:a.SentencaSQL}),s.find("img").click((function(){if(!$(this).parents("[ref=contentBody]").data("GeeksForm").TelaDesabilitada){if(!$(this).siblings("input[type=hidden]").data("GeeksForm")||!$(this).siblings("input[type=hidden]").data("GeeksForm").SentencaSQL)return void jError("Não existe uma sentença configurada para o prompt!","Atenção");var e=new Geeks.ERP.Prompt(this,"",$(this).siblings("input[type=hidden]").data("GeeksForm").SentencaSQL,n);e.Configuracao(1,"Código",50,1),e.Configuracao(2,"Descrição",250,0),e.Show()}}))):"textolongo"==a.TipoCampo.toLowerCase()?(s.find("textarea").val(r()),s.find("img").click((function(){$(this).parents("[ref=contentBody]").data("GeeksForm").TelaDesabilitada||new Geeks.ERP.PromptTexto(this,a).Show($(this).siblings("textarea").val())}))):"editorhtml"==a.TipoCampo.toLowerCase()?(s.find("input").val(r()),s.find("img").click((function(){$(this).parents("[ref=contentBody]").data("GeeksForm").TelaDesabilitada||new Geeks.ERP.PromptHtml(this,a).Show($(this).siblings("input").val())}))):"arquivo"==a.TipoCampo.toLowerCase()&&(s.find("input[name=file_"+a.Id+"]").change((function(){var e,o,i=new FileReader;i.onload=(e=this.files[0],o=e,function(e){s.find("input[name="+a.Id+"]").val(e.target.result+"#$#"+o.name+"#$#"+o.type)}),i.readAsDataURL(this.files[0])})),s.find("a[name=delete_"+a.Id+"]").click((function(){s.find("input[name="+a.Id+"]").val("")})),s.find("input[name="+a.Id+"]").change((function(){if($(this).parent().siblings("div").find("span.filename").html("Selecione ou arraste um arquivo aqui"),$(this).parent().siblings("div").find("span.action").html("Selecione um arquivo"),$(this).siblings().find("a[name=view_"+a.Id+"]").removeAttr("download"),$(this).siblings().find("a[name=view_"+a.Id+"]").removeAttr("href"),$(this).parent().css("display","none"),this.value){$(this).parent().css("display","table-cell");var e=s.find("input[name="+a.Id+"]").val().split("#$#");$(this).parent().siblings("div").find("span.filename").html(e[1]),$(this).siblings().find("a[name=view_"+a.Id+"]").attr("download",e[1]),$(this).siblings().find("a[name=view_"+a.Id+"]").attr("href",e[0])}}))),$(s).find("[name="+a.Id+"]").data("FieldData",a),s},FormataCampos:function(e){e.find(".opened").on("collapsiblecreate",(function(){$(this).unbind()})),e.find(".opened").collapsible({defaultOpen:"opened",cssOpen:"inactive",cssClose:"normal",speed:200}),e.find(".closed").on("collapsiblecreate",(function(){$(this).unbind()})),e.find(".closed").collapsible({defaultOpen:"",cssOpen:"inactive",cssClose:"normal",speed:200}),$.each(e.find(".opened"),(function(a,o){e.find(o).next().show()})),e.find(".datepicker").unbind().datepicker({showOtherMonths:!0,changeMonth:!0,changeYear:!0,autoSize:!0,dateFormat:"dd/mm/yy",weekHeader:"Semana",dayNames:["Domingo","Segunda","Terça","Quarta","Quinta","Sexta","Sábado"],dayNamesMin:["D","S","T","Q","Q","S","S","D"],dayNamesShort:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb","Dom"],monthNames:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],monthNamesShort:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],nextText:"Próximo",prevText:"Anterior"}),e.find(".check, .check :checkbox, input:radio, input:file").uniform(),e.find(".check, .check :checkbox, input:radio, input:file").parent().siblings("div").find("input:hidden").change(),e.find(".editor").cleditor({width:"100%",height:"250px",bodyStyle:"margin: 10px; font: 12px Arial,Verdana; cursor:text",useCSS:!0}),e.find("#resize, #resize2").colResizable({liveDrag:!0,draggingClass:"dragging"}),e.find(".select").chosen(),e.find(".select").siblings().css("width","100%"),$.fn.contentTabs=function(){e.find(".tab_content").hide(),e.find("ul.tabs li:first").addClass("activeTab").show(),e.find(".tab_content:first").show(),e.find("ul.tabs li").click((function(){$(this).parent().parent().find("ul.tabs li").removeClass("activeTab"),$(this).addClass("activeTab"),$(this).parent().parent().find(".tab_content").hide();var e=$(this).find("a").attr("href");return $(e).show(),!1}))},e.find("div[class^='widget']").contentTabs(),e.find(".formRow").find("input[type=hidden]").each((function(){$(this).siblings().length<=1&&$(this).parent().css("display","none")}));var a=Math.max.apply(null,$.map($("body > *"),(function(e,a){if("absolute"==$(e).css("position"))return parseInt($(e).css("z-index"))||1})))+99999;e.find("[name][type!=checkbox]:tabbable:visible").each((function(){$(this).attr("tabindex",a++)})),e.find("[name][type!=checkbox]:tabbable:visible:last").keydown((function(a){"9"==(a.keyCode||a.which)&&(e.find("[name]:tabbable:visible:first").focus(),event.preventDefault())})),e.find(".inputMoeda").autoNumeric("init",{aSep:".",aDec:",",wEmpty:"zero",vMin:"-999999999.99"}),e.find(".inputMoeda").focusin((function(){"0,00"==$(this).val()&&$(this).val("0")})),e.find(".inputValor4").autoNumeric("init",{aSep:".",aDec:",",wEmpty:"zero",vMin:"-999999999.99",mDec:"4"}),e.find(".inputValor4").focusin((function(){"0,0000"==$(this).val()&&$(this).val("0")})),e.find(".inputNumero").numeric(","),e.find(".datepicker").mask("99/99/9999"),e.find(".timepicker").mask("99:99:99"),$.uniform.update()},integracao:async function(e,a){if(a[0].id.indexOf("popup")<0)if("PadraoNovo_Contatos"==e){var o=localStorage.getItem("codigoContato"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema),i=localStorage.getItem("nomeContato"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema);null!=o&&"null"!=o&&a.find("input[name=CodigoContato]")&&""==a.find("input[name=CodigoContato]").val()?($.jGrowl("Contato "+i+" selecionado."),$.AtualizaContato(o)):null!=o&&"null"!=o&&a.find("input[name=CodigoContato]")&&a.find("input[name=CodigoContato]").val()!=o?(i=localStorage.getItem("nomeContato"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema),jConfirm("Deseja trocar para o Contato "+i+"?","Mudar?",(function(e){e&&($.jGrowl("Contato "+i+" selecionado."),$.AtualizaContato(o))}))):a.find("input[name=CodigoContato]")&&""==a.find("input[name=CodigoContato]").val()&&a.find("a[name=btn_Pesquisar]").click()}else if("PadraoNovo_Item"==e){var n=localStorage.getItem("codigoItem"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema),t=localStorage.getItem("nomeItem"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema);null!=n&&"null"!=n&&a.find("input[name=CodigoItem]")&&""==a.find("input[name=CodigoItem]").val()?(a.find("input[name=CodigoItem]").val()!=n&&$.jGrowl("Item "+t+" selecionado."),$.AtualizaItem(n)):null!=n&&"null"!=n&&a.find("input[name=CodigoItem]")&&a.find("input[name=CodigoItem]").val()!=n?(t=localStorage.getItem("nomeItem"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema),jConfirm("Deseja trocar para o Item "+t+"?","Mudar?",(function(e){e&&($.jGrowl("Item "+t+" selecionado."),$.AtualizaItem(n))}))):a.find("input[name=CodigoItem]")&&""==a.find("input[name=CodigoItem]").val()&&a.find("a[name=btn_Pesquisar]").click()}else if("PadraoNovo_Vendas_Industria"==e||"PadraoNovo_Vendas_Varejo"==e||"PadraoNovo_Vendas_Distribuidor"==e||"PadraoNovo_Vendas_Revenda"==e||"OptiSoul_Vendas"==e)if(null!=(o=localStorage.getItem("codigoContato"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema))&&"null"!=o){i=localStorage.getItem("nomeContato"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema);var r=JSON.parse(localStorage.getItem("dadosUsuario")),d="";d="PadraoNovo_Vendas_Varejo"==e?" Select top 1 CodigoDocumento from Documento where Tipo='Venda' and DataHoraEmissao < getDate() and CodigoContato = 0"+o+" and CodigoContatoDigitador = (select CodigoContato from Contato where CodigoUsuario = '"+r.CodigoUsuario+"') order by CodigoDocumento desc":" Select top 1 CodigoDocumento from Documento where Tipo='Venda' and DataHoraEmissao < getDate() and CodigoContato = 0"+o+" order by CodigoDocumento desc",null!=(s=await Geeks.Async.Core.Connection.ExecuteSQL(d))&&s.Records.length>0?a.find("[name=CodigoDocumento]")&&""==a.find("[name=CodigoDocumento]").val()?($.jGrowl("Pedido "+s.Records[0].CodigoDocumento+" selecionado."),$.AtualizaVenda(s.Records[0].CodigoDocumento)):a.find("[name=CodigoContato]")&&a.find("[name=CodigoContato]").val()!=o&&jConfirm("Deseja abrir o último pedido do Contato "+i+"?","Mudar?",(function(e){e&&($.jGrowl("Pedido "+s.Records[0].CodigoDocumento+" selecionado."),$.AtualizaVenda(s.Records[0].CodigoDocumento))})):(d="Select CodigoContato from Contato where CodigoUsuario = 0"+r.CodigoUsuario,s=await Geeks.Async.Core.Connection.ExecuteSQL(d),o=null,null!=s&&null!=s.Records&&s.Records.length>0&&(o=s.Records[0].CodigoContato),(a.find("[name=CodigoDocumento]")&&""==a.find("[name=CodigoDocumento]").val()||null==a.find("[name=CodigoDocumento]"))&&null!=o&&a.find("a[name=btn_Incluir]").click())}else"PadraoNovo_Vendas_Varejo"!=e&&a.find("a[name=btn_Incluir]").click();else if("PadraoNovo_Compras_NFEntrada"==e)if("true"==localStorage.getItem("origemHistoricoItem"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema))localStorage.setItem("origemHistoricoItem"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema,"false");else if(null!=(o=localStorage.getItem("codigoContato"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema))&&"null"!=o){var s;i=localStorage.getItem("nomeContato"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema),null!=(s=await Geeks.Async.Core.Connection.ExecuteSQL(" Select top 1 CodigoDocumento from Documento where Tipo='Compra' and DataHoraEmissao < getDate() and CodigoContato = 0"+o+"order by CodigoDocumento desc"))&&s.Records.length>0?a.find("[name=CodigoDocumento]")&&""==a.find("[name=CodigoDocumento]").val()?($.jGrowl("Pedido "+s.Records[0].CodigoDocumento+" selecionado."),$.AtualizaCompra(s.Records[0].CodigoDocumento)):a.find("[name=CodigoContato]")&&a.find("[name=CodigoContato]").val()!=o&&jConfirm("Deseja abrir o último pedido do Contato "+i+"?","Mudar?",(function(e){e&&($.jGrowl("Pedido "+s.Records[0].CodigoDocumento+" selecionado."),$.AtualizaCompra(s.Records[0].CodigoDocumento))})):(a.find("[name=CodigoDocumento]")&&""==a.find("[name=CodigoDocumento]").val()||null==a.find("[name=CodigoDocumento]"))&&a.find("a[name=btn_Incluir]").click()}else a.find("a[name=btn_Incluir]").click();else if("PadraoNovo_Estoque"==e)n=localStorage.getItem("codigoItem"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema),t=localStorage.getItem("nomeItem"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema),null!=n&&"null"!=n&&a.find("input[name=Item]")&&""==a.find("input[name=Item]").val()?(a.find("input[name=Item]").val(n),a.find("input[name=promptDisplay_Item]").val(t),a.find("a[name=btn_Pesquisa]").click()):null!=n&&"null"!=n&&a.find("input[name=Item]")&&a.find("input[name=Item]").val()!=n?(t=localStorage.getItem("nomeItem"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema),jConfirm("Deseja trocar para o Item "+t+"?","Mudar?",(function(e){e&&(a.find("input[name=Item]").val(n),a.find("input[name=promptDisplay_Item]").val(t),a.find("a[name=btn_Pesquisa]").click())}))):a.find("input[name=Item]")&&""!=a.find("input[name=Item]").val()&&a.find("a[name=btn_Pesquisa]").click();else if("PadraoNovo_Estoque_Kardex"==e)if(n=localStorage.getItem("codigoItem"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema),t=localStorage.getItem("nomeItem"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema),null!=n&&"null"!=n&&"undefined"!=n&&a.find("input[name=Produto]")&&""==a.find("input[name=Produto]").val()){a.find("[name=Produto]").val(n),a.find("[name=promptDisplay_Produto]").val(t),a.find("[name=CodigoItem]").val(n),a.find("a[name=btn_Pesquisa]").click();var l="select distinct Case When LoteEmpresa is Null Then 'Nenhum' else LoteEmpresa End as LoteEmpresa from Kardex where CodigoItem = 0"+s.Codigo+" order by LoteEmpresa",c=await Geeks.Async.Core.Connection.ExecuteSQL(l);if(null!=c&&c.Records.length>0){a.find("[name=Lote]").empty(),a.find("[name=Lote]").append($("<option value=''>-- Selecione --</option>"));for(var u=0;u<c.Records.length;u++)a.find("[name=Lote]").append($("<option value='"+c.Records[u].LoteEmpresa+"'>"+c.Records[u].LoteEmpresa+"</option>"));a.find("[name=Lote]").val(""),a.find("[name=Lote]").trigger("liszt:updated")}}else null!=n&&"null"!=n&&"undefined"!=n&&a.find("input[name=Produto]")&&a.find("input[name=Produto]").val()!=n&&(t=localStorage.getItem("nomeItem"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema),jConfirm("Deseja trocar para o Item "+t+"?","Mudar?",(async function(e){if(e){a.find("[name=Produto]").val(n),a.find("[name=promptDisplay_Produto]").val(t),a.find("[name=CodigoItem]").val(n),a.find("a[name=btn_Pesquisa]").click();var o="select distinct Case When LoteEmpresa is Null Then 'Nenhum' else LoteEmpresa End as LoteEmpresa from Kardex where CodigoItem = 0"+s.Codigo+" order by LoteEmpresa";const e=await Geeks.Async.Core.Connection.ExecuteSQL(o);if(null!=e&&e.Records.length>0){a.find("[name=Lote]").empty(),a.find("[name=Lote]").append($("<option value=''>-- Selecione --</option>"));for(var i=0;i<e.Records.length;i++)a.find("[name=Lote]").append($("<option value='"+e.Records[i].LoteEmpresa+"'>"+e.Records[i].LoteEmpresa+"</option>"));a.find("[name=Lote]").val(""),a.find("[name=Lote]").trigger("liszt:updated")}}})))}};