String.prototype.replaceAll=String.prototype.replaceAll||function(e,a){return this.split(e).join(a)},Geeks.ERP.UI.Grid=new function(){var e=this,a=Geeks.ERP.UI.Tela,t=function(e,a){var t=[];t.push({name:"clean-filters",text:" ",width:"20px",iconClass:"k-icon"}),e.Incluir&&t.push({name:"create",text:" ",width:"20px"}),e.Editar&&t.push({name:"edit",text:" ",width:"20px"}),e.Excluir&&t.push({name:"destroy",text:" ",width:"20px"}),e.Excel&&t.push({name:"excel",text:" ",width:"20px",iconClass:"k-icon"}),e.MinimizarLinhas&&(t.push({name:"expand",text:" ",width:"20px",iconClass:"k-icon"}),t.push({name:"collapse",text:" ",width:"20px",iconClass:"k-icon"})),"true"==$("#hfUsuarioAdm").val()&&"1"==$("#hfGrupoInterno").val()&&t.push({name:"layout",text:" ",width:"20px",iconClass:"k-icon"});var o=$.grep(a.toolbar,(function(e){return""==e.name.trim()}));return $.each(o,(function(e,a){t.push(a)})),a.toolbar=t,a},o=function(a,t,o){a.find(".k-button.k-button-icontext.k-grid-delete").off(),a.find(".k-button.k-button-icontext.k-grid-edit").off(),a.find(".k-button.k-button-icontext.k-grid-add").off(),a.find(".k-button.k-button-icontext.k-grid-layout").off(),a.find(".k-button.k-button-icontext.k-grid-expand").off(),a.find(".k-button.k-button-icontext.k-grid-collapse").off(),a.find(".k-button.k-button-icontext.k-grid-clean-filters").off(),a.find(".k-button.k-button-icontext.k-grid-delete").click((function(e){e.preventDefault();var t=a.data("kendoGrid");t.dataItem(t.select())?jConfirm("Deseja excluir este registro?","Excluir?",(function(e){e&&t.dataSource.transport.destroy(t.dataItem(t.select()))})):jError("Selecione uma linha para Excluí-la.","Atenção")})),a.find(".k-button.k-button-icontext.k-grid-edit").click((function(n){n.preventDefault();var i=a.data("kendoGrid");return i.dataItem(i.select())?e.EditaGrade(t,a.parent(),i.dataItem(i.select()),"Editar",o):jError("Selecione uma linha para Editá-la.","Atenção"),!1})),a.find(".k-button.k-button-icontext.k-grid-add").click((function(n){return n.preventDefault(),e.EditaGrade(t,a.parent(),null,"Nova",o),!1})),a.find(".k-button.k-button-icontext.k-grid-excel").children().addClass("k-icon k-i-group"),a.find(".k-button.k-button-icontext.k-grid-expand").children().addClass("k-icon icos-arrowdown"),a.find(".k-button.k-button-icontext.k-grid-expand").click((function(e){return e.preventDefault(),$.each(a.find(".k-grouping-row"),(function(){a.data("kendoGrid").expandGroup(this)})),!1})),a.find(".k-button.k-button-icontext.k-grid-collapse").children().addClass("k-icon icos-arrowup"),a.find(".k-button.k-button-icontext.k-grid-collapse").click((function(e){return e.preventDefault(),$.each(a.find(".k-grouping-row"),(function(){a.data("kendoGrid").collapseGroup(this)})),!1})),a.find(".k-button.k-button-icontext.k-grid-clean-filters").children().addClass("k-icon k-i-filter"),t.Target.data("kendoGrid").dataSource.bind("change",(()=>{t.Target.data("kendoGrid").dataSource.filter()?t.Target.find(".k-button.k-button-icontext.k-grid-clean-filters").css("display","block"):t.Target.find(".k-button.k-button-icontext.k-grid-clean-filters").css("display","none")})),a.find(".k-button.k-button-icontext.k-grid-clean-filters").on("click",(()=>{jConfirm("Deseja limpar os filtro(s)?","",(e=>{e&&t.Target.data("kendoGrid").dataSource.filter({})}))})),"true"==$("#hfUsuarioAdm").val()&&"1"==$("#hfGrupoInterno").val()?(a.find(".k-button.k-button-icontext.k-grid-layout").children().addClass("k-icon k-i-lock"),a.find(".k-button.k-button-icontext.k-grid-layout").click((function(){var e=t.Target.data("kendoGrid").getOptions(),a=JSON.parse(t.DtaLayout);a||(a=e);var o=a.columns;$.each(e.columns,(function(e,a){var t=$.grep(o,(function(e){return e.field==a.field}));t.length>0&&$.each(t[0],(function(e,t){"width"!=e&&(a[e]=t)}))})),a.columns=e.columns,a.dataSource=e.dataSource,a.filterable=e.filterable,t.DtaLayout=JSON.stringify(a);var n=t.DtaLayout,i="UPDATE GRID SET  Descricao = '"+t.Descricao+"',  SentencaSQL = '"+t.SentencaSQL.replace(/[']/g,"''")+"',  Editar = "+(t.Editar?1:0)+",  Excluir = "+(t.Excluir?1:0)+",  Incluir = "+(t.Incluir?1:0)+",  Excel = "+(t.Excel?1:0)+",  OrdenaGrade = "+(t.OrdenaGrade?1:0)+",  FiltraGrade = "+(t.FiltraGrade?1:0)+",  AgrupaGrade = "+(t.AgrupaGrade?1:0)+",  MinimizarLinhas = "+(t.MinimizarLinhas?1:0)+",  Paginacao = "+(t.Paginacao?1:0)+",  MultiRow = "+(t.MultiRow?1:0)+",  TabelaMaster = '"+t.TabelaMaster+"',  ForeignKeyName = '"+t.ForeignKeyName+"',  DtaLayout = '"+n.split("''").join("'").split("'").join("''")+"'  WHERE CodigoGrid = "+t.CodigoGrid;Geeks.ERP.Core.Connection.ExecuteSQL(i,!0),$.jGrowl("Layout salvo com sucesso")}))):a.find(".k-button.k-button-icontext.k-grid-layout").remove()};this.Render=function(a,n,i,r){var l={};n.DtaLayout&&(l=JSON.parse(n.DtaLayout));var d=n.TabelaMaster,u="";n.foreignKeyName,d.indexOf(",")>-1&&(u=d.split(",")[1],d=d.split(",")[0]);var c={columns:[],toolbar:[]};n.Altura||(n.Altura=200),n.Admin&&(n.Altura=400);var s=!1;n.Paginacao&&(s={previousNext:!0,numeric:!0,pageSize:50,pageSizes:!1,messages:{display:"mostrando {0} - {1} de {2} registros"}});var p=!1;n.FiltraGrade&&(p={mode:"menu",extra:!0,operators:{string:{contains:"Contenha",doesnotcontain:"Não Contenha",eq:"Igual",neq:"Diferente",startswith:"Começa com",endswith:"Termina com"},number:{eq:"Igual",neq:"Diferente",gte:"Maior ou igual",gt:"Maior que",lte:"Menor ou igual",lt:"Menor que"},money:{eq:"Igual",neq:"Diferente",gte:"Maior ou igual",gt:"Maior que",lte:"Menor ou igual",lt:"Menor que"},date:{eq:"Igual",neq:"Diferente",gte:"Posterior ou igual",gt:"Posterior a",lte:"Anterior ou igual",lt:"Anterior a"}}}),t(n,c);var m=$("<div name='kendogrid_"+n.Descricao+"'/>");this.ExcelExport=function(e){for(var a=e.workbook.sheets[0].rows,t=[],o=0;o<a.length;o++){var n=a[o];if("group-footer"==n.type||"footer"==n.type)for(var i=0;i<n.cells.length;i++){const e=n.cells[i],a=(e?.value??"").replace("<div style='text-align: right'>","").replace("</div>",""),t=Number(a.replace("Qtde: ","").replace(/\./g,"").replace(",","."));e.hAlign="right",e.value=t||""}t.push(n)}e.workbook.sheets[0].rows=t},m.kendoGrid({autoBind:!1,groupable:n.AgrupaGrade,selectable:1==n.MultiRow?"multiple":"row",reorderable:!0,resizable:!0,filterable:p,sortable:n.OrdenaGrade,refresh:!0,pageable:s,height:a.height(),editable:"popup",excel:{allPages:!0},excelExport:this.ExcelExport}).appendTo(a),n.Target=m;var f=new kendo.data.DataSource({transport:{read:function(a){if(!m.data("kendoGrid").Disconnected&&m.data("kendoGrid").sentenceSql()){var t=Geeks.ERP.Core.Connection.ExecuteSQL(m.data("kendoGrid").sentenceSql(),r);t?(t.Columns?(m.data("kendoGrid").dataSource.options.schema.model=e.GenerateModel(l,t.Columns),c.columns=function(e){var a=[];if(l&&l.columns){for(a=$.grep(l.columns,(function(a){return $.grep(e,(function(e){return a.field==e.ColumnName})).length>0})),o=0;o<e.length;o++)if($.grep(l.columns,(function(a){return a.field==e[o].ColumnName})).length<=0){var t={field:e[o].ColumnName,title:e[o].ColumnName,hidden:!1,condition:!1,command:null};a.push(t)}}else for(var o=0;o<e.length;o++)a.push({field:e[o].ColumnName,title:e[o].ColumnName,hidden:!1,condition:!1,command:null});var n=[],i=[];return $.each(a,(function(e,a){a.width||(a.width=100),a.dropDownOptions?(a.template=function(e){var t=a.dropDownOptions.split("\n"),o=$.grep(t,(function(t){return t.split("=")[0].trim()==e[a.field]}));return o.length>0?o[0].split("=")[1].trim():"DropDown Error"},a.filterable=[{ui:"dropDownFilter"}]):"checagem"==a.geeksType?(a.template=function(e){return 1==e[a.field]||"1"==e[a.field]||1==e[a.field]||"true"==e[a.field]?"<div style=\"text-align: center\"><img src='./Content/Plugins/Aquincum/images/icons/usual/icon-check.png' alt='"+e[a.field]+"'/></div>":" "},a.groupHeaderTemplate=function(e){return"true"==e.value?a.title+": Sim":a.title+": Não"}):"data"==a.geeksType?(a.template=function(e){return e[a.field]?(e[a.field]=new Date(kendo.parseDate(e[a.field]).getTime()),kendo.toString(e[a.field],"dd/MM/yyyy")):" "},a.groupHeaderTemplate="#= kendo.toString(kendo.parseDate(value), 'dd/MM/yyyy') #",a.format="{0:dd/MM/yyyy}",a.filterable=[{ui:"datepicker"}]):"datahora"==a.geeksType?(a.template=function(e){return e[a.field]?(e[a.field]=new Date(kendo.parseDate(e[a.field]).getTime()),kendo.toString(e[a.field],"dd/MM/yyyy HH:mm:ss")):" "},a.groupHeaderTemplate="#= kendo.toString(kendo.parseDate(value), 'dd/MM/yyyy HH:mm:ss') #",a.format="{0:dd/MM/yyyy HH:mm:ss}",a.filterable=[{ui:"datetimepicker"}]):"valor"==a.geeksType?(a.template=function(e){return e[a.field]?kendo.toString(e[a.field],"n2"):"0,00"},a.groupHeaderTemplate="#= kendo.toString(value, 'n2') #"):"valor4"==a.geeksType?(a.template=function(e){return e[a.field]?kendo.toString(e[a.field],"n4"):"0,0000"},a.groupHeaderTemplate="#= kendo.toString(value, 'n4') #"):"numero"==a.geeksType?a.template=function(e){return e[a.field]?(e[a.field]+"").replace(".",","):"0"}:"data"==a.geeksType?(a.template=function(e){return e[a.field]?(e[a.field]=new Date(kendo.parseDate(e[a.field]).getTime()),kendo.toString(e[a.field],"dd/MM/yyyy")):" "},a.groupHeaderTemplate="#= kendo.toString(kendo.parseDate(value), 'dd/MM/yyyy') #",a.format="{0:dd/MM/yyyy}",a.filterable=[{ui:"datepicker"}]):"datahora"==a.geeksType?(a.template=function(e){return e[a.field]?(e[a.field]=new Date(kendo.parseDate(e[a.field]).getTime()),kendo.toString(e[a.field],"dd/MM/yyyy HH:mm:ss")):" "},a.groupHeaderTemplate="#= kendo.toString(kendo.parseDate(value), 'dd/MM/yyyy HH:mm:ss') #",a.format="{0:dd/MM/yyyy HH:mm:ss}",a.filterable=[{ui:"datetimepicker"}]):"arquivo"==a.geeksType?a.template=function(e){if(e[a.field]){var t=e[a.field].split("#$#");return'<a href="'+t[0]+'" download="'+t[1]+'" title="Download do Arquivo">'+t[1]+"</a>"}return" "}:"imagem"==a.geeksType?a.template=function(e){if(e[a.field]){var t=e[a.field].split("#$#");if(t[0].indexOf("image")>-1)return'<img src="'+t[0]+'" style="max-height: 100px;"></img>'}return" "}:a.template=a.CustomTemplate?a.CustomTemplate:null,a.Alinhamento?"auto"!=a.Alinhamento?a.attributes={style:"text-align: "+a.Alinhamento}:"valor"==a.geeksType||"valor4"==a.geeksType||"numero"==a.geeksType?a.attributes={style:"text-align: right"}:a.attributes={style:"text-align: left"}:a.attributes=null,a.Sumarizacao?(a.SumarizaNoGrupo?a.TemplateSumarizacao?a.groupFooterTemplate=a.TemplateSumarizacao:"valor"==a.geeksType&&"count"!=a.OperacaoSumarizacao?a.groupFooterTemplate="<div style='text-align: right'>#: kendo.toString("+a.OperacaoSumarizacao+", 'n2') #</div>":"valor4"==a.geeksType&&"count"!=a.OperacaoSumarizacao?a.groupFooterTemplate="<div style='text-align: right'>#: kendo.toString("+a.OperacaoSumarizacao+", 'n4') #</div>":"numero"==a.geeksType&&"count"!=a.OperacaoSumarizacao?a.groupFooterTemplate="<div style='text-align: right'>#: "+a.OperacaoSumarizacao+" #</div>":a.groupFooterTemplate="#: "+a.OperacaoSumarizacao+" #":a.groupFooterTemplate=null,a.SumarizaNoRodape?(a.TemplateSumarizacao?a.footerTemplate=a.TemplateSumarizacao:"valor"==a.geeksType&&"count"!=a.OperacaoSumarizacao?a.footerTemplate="<div style='text-align: right'>#: kendo.toString("+a.OperacaoSumarizacao+", 'n2') #</div>":"valor4"==a.geeksType&&"count"!=a.OperacaoSumarizacao?a.footerTemplate="<div style='text-align: right'>#: kendo.toString("+a.OperacaoSumarizacao+", 'n4') #</div>":"numero"==a.geeksType&&"count"!=a.OperacaoSumarizacao?a.footerTemplate="<div style='text-align: right'>#: "+a.OperacaoSumarizacao+" #</div>":a.footerTemplate="#: "+a.OperacaoSumarizacao+" #",i.push({field:a.field,aggregate:a.OperacaoSumarizacao})):a.footerTemplate=null,a.aggregates=[a.OperacaoSumarizacao],n.push({field:a.field,aggregate:a.OperacaoSumarizacao})):(a.groupFooterTemplate=null,a.footerTemplate=null,a.aggregates=null)})),a}(t.Columns)):jError("Houve um problema na sentença, por favor, verifique!","Erro na Sentença"),a.success(t.Records)):a.success([])}},create:function(e){if(!m.data("kendoGrid").Disconnected){if(m.data("kendoGrid").BeforeCreate&&m.data("kendoGrid").BeforeCreate(m.data("kendoGrid"),e))return!1;if(m.data("kendoGrid").BeforeUpdate&&m.data("kendoGrid").BeforeUpdate(m.data("kendoGrid"),e))return!1;var a="",t="";if($.each(l.columns,(function(o,n){if((e.hasOwnProperty(n.field)||"selecao"==n.geeksType&&e.hasOwnProperty(n.field+"1"))&&n.field&&n.GravaCampoNoBanco&&!n.Identificador)if(a+=(""==a?"":",")+n.field,e[n.field]||n.field!=m.data("kendoGrid").foreignKeyName)if(e[n.field]||"CodigoGrid"!=n.field||"promptBotAdm"!=prompt)n.Identificador||("TabelaMaster"==n.field&&""!=u?t+=(""==t?"":",")+"'"+u+"'":("selecao"!=n.geeksType||e[n.field+"1"]||n.Obrigatorio||"checagem"==n.geeksType)&&("selecao"==n.geeksType||e[n.field]||n.Obrigatorio||"checagem"==n.geeksType)?"senha"==n.geeksType?t+=(""==t?"":",")+(e[n.field]&&"null"!=e[n.field]?"'"+calcMD5(e[n.field])+"'":null):"checagem"==n.geeksType?t+=(""==t?"":",")+(0==e[n.field]||null==e[n.field]||0==e[n.field]||"false"==e[n.field]?0:1):"numero"==n.geeksType||"valor"==n.geeksType||"valor4"==n.geeksType?t+=(""==t?"":",")+(e[n.field]?""+e[n.field].replaceAll(".","").replace(",","."):"0"):"selecao"==n.geeksType?t+=(""==t?"":",")+(e[n.field+"1"]&&"null"!=e[n.field+"1"]?"'"+e[n.field+"1"]+"'":null):"datahora"==n.geeksType||"data"==n.geeksType?t+=(""==t?"":",")+(e[n.field]&&"null"!=e[n.field]&&""!=e[n.field].trim()?"'"+e[n.field]+"'":null):t+=(""==t?"":",")+(e[n.field]&&"null"!=e[n.field]?"'"+e[n.field]+"'":null):t+=(""==t?"":",")+"null");else{var i=Geeks.ERP.Core.Connection.ExecuteSQL("Select CodigoGrid from Grid Where CodigoSessao = "+m.data("kendoGrid").foreignKeyValue,r).Records[0].CodigoGrid;t+=(""==t?"":",")+(i||0)}else"checagem"==n.geeksType?t+=(""==t?"":",")+(0==e[n.field]||null==e[n.field]||0==e[n.field]||"false"==e[n.field]?0:1):"numero"==n.geeksType||"valor"==n.geeksType||"valor4"==n.geeksType?t+=(""==t?"":",")+(m.data("kendoGrid").foreignKeyValue?"'"+m.data("kendoGrid").foreignKeyValue+"'":"0"):t+=(""==t?"":",")+(m.data("kendoGrid").foreignKeyValue?"'"+m.data("kendoGrid").foreignKeyValue+"'":"null")})),""!=a){var o="INSERT INTO "+d+"("+a+")VALUES("+t+");";Geeks.ERP.Core.Connection.ExecuteSQL(o,r).RecordsAffected>0&&m.data("kendoGrid").Fill()}return m.data("kendoGrid").AfterCreate&&m.data("kendoGrid").AfterCreate(m.data("kendoGrid"),e),m.data("kendoGrid").AfterUpdate&&m.data("kendoGrid").AfterUpdate(m.data("kendoGrid"),e),!0}},update:function(e){if(!m.data("kendoGrid").Disconnected){if(m.data("kendoGrid").BeforeUpdate&&m.data("kendoGrid").BeforeUpdate(m.data("kendoGrid"),e))return!1;var a="",t="";if($.each(l.columns,(function(o,n){(e.hasOwnProperty(n.field)||"selecao"==n.geeksType&&e.hasOwnProperty(n.field+"1"))&&n.field&&(n.GravaCampoNoBanco||n.Identificador)&&(n.GravaCampoNoBanco&&!n.Identificador?("selecao"!=n.geeksType||e[n.field+"1"]||n.Obrigatorio||"checagem"==n.geeksType)&&("selecao"==n.geeksType||e[n.field]||n.Obrigatorio||"checagem"==n.geeksType)?"senha"==n.geeksType?a+=(""==a?"":",")+n.field+"="+(e[n.field]&&"null"!=e[n.field]?"'"+calcMD5(e[n.field])+"'":null):"checagem"==n.geeksType?a+=(""==a?"":",")+n.field+"="+(0==e[n.field]||null==e[n.field]||0==e[n.field]||"false"==e[n.field]?0:1):"numero"==n.geeksType||"valor"==n.geeksType||"valor4"==n.geeksType?a+=(""==a?"":",")+n.field+"="+(e[n.field]?""+e[n.field].replaceAll(".","").replace(",","."):"0"):"selecao"==n.geeksType?a+=(""==a?"":",")+n.field+"="+(e[n.field+"1"]&&"null"!=e[n.field+"1"]?"'"+e[n.field+"1"].replace(/'/g,"''")+"'":"null"):"datahora"==n.geeksType||"data"==n.geeksType?a+=(""==a?"":",")+n.field+"="+(e[n.field]&&"null"!=e[n.field]&&""!=e[n.field].trim()?"'"+e[n.field].replace(/'/g,"''")+"'":"null"):a+=(""==a?"":",")+n.field+"="+(e[n.field]&&"null"!=e[n.field]?"'"+e[n.field].replace(/'/g,"''")+"'":"null"):a+=(""==a?"":",")+n.field+"= null":n.Identificador&&""!=e[n.field]&&(t+=(""==t?" WHERE ":" AND ")+n.field+"='"+e[n.field]+"'"))})),t){var o="";""!=u&&(o=" AND TabelaMaster = '"+u+"'");var n="UPDATE "+d+" SET "+a+t+o,i=Geeks.ERP.Core.Connection.ExecuteSQL(n,r);i&&(i.RecordsAffected>0&&m.data("kendoGrid").Fill(),m.data("kendoGrid").AfterUpdate&&m.data("kendoGrid").AfterUpdate(m.data("kendoGrid"),e))}else console.warn("Erro na sintaxe update. Fantando parâmetros where","Atenção"),m.data("kendoGrid").AfterUpdate&&m.data("kendoGrid").AfterUpdate(m.data("kendoGrid"),e);return!0}},destroy:function(e){if(!m.data("kendoGrid").Disconnected){if(m.data("kendoGrid").BeforeDelete&&m.data("kendoGrid").BeforeDelete(m.data("kendoGrid"),e))return;var a="";if($.each(l.columns,(function(t,o){e.hasOwnProperty(o.field)&&o.Identificador&&null!=e[o.field]&&""!=e[o.field]&&"null"!=e[o.field]&&(a+=(""==a?" WHERE ":" AND ")+o.field+"='"+e[o.field]+"'")})),""==a)return void jAlert("Coluna identificador ausente. Verifique as configurações da grade!","Atenção");try{var t="";""!=u&&(t=" AND TabelaMaster = '"+u+"'"),Geeks.ERP.Core.Connection.ExecuteSQL("DELETE FROM "+d+" "+a+t,r).RecordsAffected>0&&(m.data("kendoGrid").Fill(),m.data("kendoGrid").AfterDelete&&m.data("kendoGrid").AfterDelete(m.data("kendoGrid"),e))}catch(e){jError(e.message,"Atenção")}}}},schema:{model:{}},sort:l.dataSource?l.dataSource.sort:[],group:function(){if(!l.dataSource)return[];var e=l.dataSource.group;return l.dataSource.aggregate&&$.each(e,(function(e,a){a.aggregates=l.dataSource.aggregate})),e}(),aggregate:l.dataSource?l.dataSource.aggregate:[]});m.data("kendoGrid").filter="1 = 0",m.data("kendoGrid").foreignKeyName=n.ForeignKeyName,m.data("kendoGrid").foreignKeyValue="",m.data("kendoGrid").sentenceSql=function(){return"SELECT * FROM ("+n.SentencaSQL+") ss "+(m.data("kendoGrid").filter?" WHERE "+m.data("kendoGrid").filter:"")},m.data("kendoGrid").BeforeDelete=null,m.data("kendoGrid").AfterDelete=null,m.data("kendoGrid").BeforeUpdate=null,m.data("kendoGrid").BeforeCreate=null,m.data("kendoGrid").AfterUpdate=null,m.data("kendoGrid").AfterCreate=null,m.data("kendoGrid").AfterFill=null,m.data("kendoGrid").Fill=function(){m.data("kendoGrid").dataSource.read(),m.data("kendoGrid").refresh(),m.data("kendoGrid").pager&&(m.data("kendoGrid").dataSource.pageSize(50),m.data("kendoGrid").dataSource.page(1),m.data("kendoGrid").pager.refresh()),m.find(".k-grid-toolbar > a").not(".k-grid-layout").css("display","1 = 0"==m.data("kendoGrid").filter?"none":"block"),m.find(".k-grid-toolbar > a.k-grid-clean-filters").css("display","none"),n.Target.data("kendoGrid").dataSource.filter()?n.Target.find(".k-button.k-button-icontext.k-grid-clean-filters").css("display","block"):n.Target.find(".k-button.k-button-icontext.k-grid-clean-filters").css("display","none"),m.data("kendoGrid").AfterFill&&m.data("kendoGrid").AfterFill(m.data("kendoGrid"),c)},m.data("kendoGrid").Disconnected=!1,m.data("kendoGrid",m.data("kendoGrid"));var g=m.parents(".widget");i&&(g=m.parents(".wrapper").parent());var h=function(){var e=g.outerHeight();i?g.find(".k-grid").parents(".wrapper").siblings(":visible").each((function(a,t){e-=$(t).outerHeight()})):g.find(".body").siblings(":visible").each((function(a,t){e-=$(t).outerHeight()})),e-=2,e-=2,g.find(".k-grid").height(e),g.find(".k-grid").children(":visible").not(".k-grid-content").each((function(a,t){e-=$(t).outerHeight()})),e--,g.find(".k-grid-content").height(e)};m.data("kendoGrid").setDataSource(f),m.data("kendoGrid").Fill(),m.data("kendoGrid").setOptions(c),m.find(".k-grid-toolbar > a").not(".k-grid-layout").css("display","none"),h(),g.resize(h),function(){var e=m.data("kendoGrid").getOptions(),a=!1;n.FiltraGrade&&(a={mode:"menu",extra:!0,operators:{string:{contains:"Contenha",doesnotcontain:"Não Contenha",eq:"Igual",neq:"Diferente",startswith:"Começa com",endswith:"Termina com"},number:{eq:"Igual",neq:"Diferente",gte:"Maior ou igual",gt:"Maior que",lte:"Menor ou igual",lt:"Menor que"},money:{eq:"Igual",neq:"Diferente",gte:"Maior ou igual",gt:"Maior que",lte:"Menor ou igual",lt:"Menor que"},date:{eq:"Igual",neq:"Diferente",gte:"Posterior ou igual",gt:"Posterior a",lte:"Anterior ou igual",lt:"Anterior a"}}}),e.filterable=a;var t=[],o=[];$.each(e.columns,(function(a,n){if("prompt"==n.geeksType&&n.campoForeignKeyPrompt){var i=$.grep(e.columns,(function(e){return e.field==n.campoForeignKeyPrompt}));i.length>0&&(i[0].hidden=!0)}else"selecao"==n.geeksType&&n.dropDownOptions&&(n.dropDownOptions=n.dropDownOptions.replace(/\\[n]/g,"\n"));n.dropDownOptions?(n.template=function(e){var a=n.dropDownOptions.split("\n"),t=$.grep(a,(function(a){return a.split("=")[0].trim()==e[n.field]}));return t.length>0?t[0].split("=")[1].trim():"DropDown Error"},n.filterable=[{ui:"dropDownFilter"}]):"checagem"==n.geeksType?(n.template=function(e){return 1==e[n.field]||"1"==e[n.field]||1==e[n.field]||"true"==e[n.field]?"<div style=\"text-align: center\"><img src='./Content/Plugins/Aquincum/images/icons/usual/icon-check.png' alt='"+e[n.field]+"'/></div>":" "},n.groupHeaderTemplate=function(e){return"true"==e.value?n.title+": Sim":n.title+": Não"}):"valor"==n.geeksType?(n.template=function(e){return e[n.field]?kendo.toString(e[n.field],"n2"):"0,00"},n.groupHeaderTemplate="#= kendo.toString(value, 'n2') #"):"valor4"==n.geeksType?(n.template=function(e){return e[n.field]?kendo.toString(e[n.field],"n4"):"0,00"},n.groupHeaderTemplate="#= kendo.toString(value, 'n4') #"):"numero"==n.geeksType?n.template=function(e){return e[n.field]?(e[n.field]+"").replace(".",","):"0"}:"data"==n.geeksType?(n.template=function(e){return e[n.field]?(e[n.field]=new Date(kendo.parseDate(e[n.field]).getTime()),kendo.toString(e[n.field],"dd/MM/yyyy")):" "},n.groupHeaderTemplate="#= kendo.toString(kendo.parseDate(value), 'dd/MM/yyyy') #",n.format="{0:dd/MM/yyyy}",n.filterable=[{ui:"datepicker"}]):"datahora"==n.geeksType?(n.template=function(e){return e[n.field]?(e[n.field]=new Date(kendo.parseDate(e[n.field]).getTime()),kendo.toString(e[n.field],"dd/MM/yyyy HH:mm:ss")):" "},n.groupHeaderTemplate="#= kendo.toString(kendo.parseDate(value), 'dd/MM/yyyy HH:mm:ss') #",n.format="{0:dd/MM/yyyy HH:mm:ss}",n.filterable=[{ui:"datetimepicker"}]):"arquivo"==n.geeksType?n.template=function(e){if(e[n.field]){var a=e[n.field].split("#$#");return'<a href="'+a[0]+'" download="'+a[1]+'" title="Download do Arquivo">'+a[1]+"</a>"}return" "}:"imagem"==n.geeksType?n.template=function(e){if(e[n.field]){var a=e[n.field].split("#$#");if(a[0].indexOf("image")>-1)return'<img src="'+a[0]+'" style="max-height: 100px;"></img>'}return" "}:n.template=!!n.CustomTemplate&&n.CustomTemplate,n.Alinhamento?"auto"!=n.Alinhamento?n.attributes={style:"text-align: "+n.Alinhamento}:"valor"==n.geeksType||"valor4"==n.geeksType||"numero"==n.geeksType?n.attributes={style:"text-align: right"}:n.attributes={style:"text-align: left"}:n.attributes=null,n.Sumarizacao?(n.SumarizaNoGrupo?n.TemplateSumarizacao?n.groupFooterTemplate=n.TemplateSumarizacao:"valor"==n.geeksType&&"count"!=n.OperacaoSumarizacao?n.groupFooterTemplate="<div style='text-align: right'>#: kendo.toString("+n.OperacaoSumarizacao+", 'n2') #</div>":"valor4"==n.geeksType&&"count"!=n.OperacaoSumarizacao?n.groupFooterTemplate="<div style='text-align: right'>#: kendo.toString("+n.OperacaoSumarizacao+", 'n4') #</div>":"numero"==n.geeksType&&"count"!=n.OperacaoSumarizacao?n.groupFooterTemplate="<div style='text-align: right'>#: "+n.OperacaoSumarizacao+" #</div>":n.groupFooterTemplate="#: "+n.OperacaoSumarizacao+" #":n.groupFooterTemplate=null,n.SumarizaNoRodape?(n.TemplateSumarizacao?n.footerTemplate=n.TemplateSumarizacao:"valor"==n.geeksType&&"count"!=n.OperacaoSumarizacao?n.footerTemplate="<div style='text-align: right'>#: kendo.toString("+n.OperacaoSumarizacao+", 'n2') #</div>":"valor4"==n.geeksType&&"count"!=n.OperacaoSumarizacao?n.footerTemplate="<div style='text-align: right'>#: kendo.toString("+n.OperacaoSumarizacao+", 'n4') #</div>":"numero"==n.geeksType&&"count"!=n.OperacaoSumarizacao?n.footerTemplate="<div style='text-align: right'>#: "+n.OperacaoSumarizacao+" #</div>":n.footerTemplate="#: "+n.OperacaoSumarizacao+" #",o.push({field:n.field,aggregate:n.OperacaoSumarizacao})):n.footerTemplate=null,n.aggregates=[n.OperacaoSumarizacao],t.push({field:n.field,aggregate:n.OperacaoSumarizacao})):(n.groupFooterTemplate=null,n.footerTemplate=null,n.aggregates=null)})),t.length>0&&(l.dataSource.aggregate=t),o.length>0&&l.dataSource.group[0]&&(l.dataSource.group[0].aggregates=o),m.data("kendoGrid").setOptions(e),n.DtaLayout=JSON.stringify(e)}(),o(m,n,r),m.data("kendoGrid").Fill()},this.EditaGrade=function(e,t,o,n,i){var r=[],l=JSON.parse(e.DtaLayout);l||(l=e.Target.data("kendoGrid").getOptions()),$.each(l.columns,(function(e,a){var t={CodigoCampo:1,CodigoSessao:1,Label:a.title,Id:a.field,TipoCampo:null!=a.geeksType?a.geeksType:"texto",Obrigatorio:a.Obrigatorio,Identificador:a.Identificador,SentencaSQL:a.dropDownOptions,Ordem:e,LabelLargura:3,CampoLargura:9,Leitura:a.Leitura,CampoForeignKeyPrompt:a.campoForeignKeyPrompt,Visivel:a.Obrigatorio?a.Obrigatorio:!a.hidden};r.push(t)}));var d={Descricao:"Editar Linha",CodigoObjeto:e.CodigoGrid,NomeObjeto:e.Descricao,CodigoPersonalizado:e.CodigoPersonalizado,Estrutural:i,Sessoes:[{CodigoSessao:1,TipoSessao:"unica",Ordem:1}],Campos:r,Record:o,Botoes:[{Nome:"Salvar",Valor:"Salvar",CodigoBotao:"S1",Icone:"icon-checkmark"},{Nome:"Cancelar",Valor:"Cancelar",CodigoBotao:"S2",Icone:"icon-minus"}]},u=a.OpenWindow("gridEdit",t,d,null,!0);u.find(".fluid").css("padding-bottom","20px");var c=u.dialog({modal:!0,width:600,height:600,resizable:!0,closeOnEscape:!1,close:function(){u.remove()}});c.dialog("open"),u.find("ul[name='MenuBotoes']").find("a[name=btn_Salvar]").click((function(){var e=u.find(":input[required]"),a=!0;if($.each(e,(function(e,t){if((!$(t).attr("readonly")||t.name.indexOf("promptDisplay")>-1)&&""==$(this).val().trim()&&a){a=!1;var o=t.name;o.indexOf("promptDisplay")>-1&&(o=o.substr(14,o.length)),jError("Preencher campo: "+o)}})),a&&(e=u.find("select"),$.each(e,(function(e,t){if($(this).required&&""==$(this).val().trim()&&a){a=!1;var o=t.name;jError("Preencher campo: "+o)}}))),a){var o="{",i=u.find(".formRow").find("input, select, password, textarea");$.each(i,(function(e,a){a.name&&(o+='"'+a.name.replace("uniform-","")+'": '+("checkbox"!=u.find("[name="+a.name.replace("uniform-","")+"]")[0].type?'"'+u.find("[name="+a.name.replace("uniform-","")+"]").val().replace(/\"/g,'\\"')+'"':!!u.find("[name="+a.name.replace("uniform-","")+"]").prop("checked"))+",")})),"{"!=o&&(o=o.substring(0,o.length-1)),o=(o+="}").replaceAll("\\","\\\\");var r=JSON.parse(o.replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")),l=t.find("[name^=kendogrid_]").data("kendoGrid");("nova"==n.toLowerCase()?l.dataSource.transport.create(r):l.dataSource.transport.update(r))&&c.dialog("close")}})),u.find("ul[name='MenuBotoes']").find("a[name=btn_Cancelar]").click((function(){c.dialog("close"),u.remove()}))},this.Propriedade=function(n,i,r){var l=i,d=JSON.parse(n.DtaLayout);if(d||(d=n.Target.data("kendoGrid").getOptions()),!d.dataSource.schema.model||d.dataSource.schema.model&&!d.dataSource.schema.model.fields||d.dataSource.schema.model&&d.dataSource.schema.model.fields.length<=0){var u=[];$.each(d.columns,(function(){u.push({ColumnName:this.field})})),d.dataSource.schema.model=e.GenerateModel(d,u)}l.find(".fluid").css("padding-bottom","20px");var c=l.dialog({modal:!0,width:600,height:600,resizable:!0,closeOnEscape:!1,close:function(){l.remove()}});c.dialog("open");var s=l.find("ul[name='MenuBotoes']").prependTo(l.find(".breadLine > .breadLinks")).append(Geeks.ERP.UI.Tela.MontaBotoes([{Nome:"Salvar",Valor:"Salvar",CodigoBotao:"S1",Icone:"icon-checkmark"},{Nome:"Cancelar",Valor:"Cancelar",CodigoBotao:"S2",Icone:"icon-minus"}],null));s.find("a[name=btn_Cancelar]").click((function(){c.dialog("close")}));var p=$(Geeks.ERP.UI.Template.Get("ContentBodyPropertiesTemplate").format({Codigo:n.Descricao})).appendTo(l.find(".fluid")),m=function(){l.find("select[name=ddlBotoes]").empty(),d.toolbar.length>0&&$.each(d.toolbar,(function(e,a){""==a.name.trim()&&l.find("select[name=ddlBotoes]").append($("<option>",{value:e,text:a.id?a.id:e}))})),l.find("select[name=ddlBotoes]").find("option").length>0?(l.find("div[name=toolbarSelecionado]").show(),l.find("select[name=ddlBotoes]").val(0)):l.find("div[name=toolbarSelecionado]").hide()};l.find("select[name=ddlColunas]").empty(),d.columns.length>0&&($.each(d.columns,(function(e,a){(!a.template||a.template.indexOf("<span>")<0)&&l.find("select[name=ddlColunas]").append($("<option>",{value:e,text:a.title?a.title:a.field})),a.hasOwnProperty("CustomTemplate")||(a.CustomTemplate=""),a.hasOwnProperty("GravaCampoNoBanco")||(a.GravaCampoNoBanco=!0),a.hasOwnProperty("LeCampoDoBanco")||(a.LeCampoDoBanco=!0),a.hasOwnProperty("Alinhamento")||(a.Alinhamento="auto"),a.hasOwnProperty("Obrigatorio")||(a.Obrigatorio=!1),a.hasOwnProperty("Identificador")||(a.Identificador=!1),a.hasOwnProperty("Leitura")||(a.Leitura=!1),a.hasOwnProperty("condition")||(a.condition=!1),a.hasOwnProperty("sortable")||(a.sortable=!0),a.hasOwnProperty("filterable")||(a.filterable=!0),a.hasOwnProperty("groupable")||(a.groupable=!0),a.hasOwnProperty("TemBotao")||(a.TemBotao=!1),a.hasOwnProperty("hidden")||(a.hidden=!1),a.hasOwnProperty("Sumarizacao")||(a.Sumarizacao=!1),a.hasOwnProperty("SumarizaNoGrupo")||(a.SumarizaNoGrupo=!1),a.hasOwnProperty("SumarizaNoRodape")||(a.SumarizaNoRodape=!1),a.hasOwnProperty("OperacaoSumarizacao")||(a.OperacaoSumarizacao="sum"),a.hasOwnProperty("TemplateSumarizacao")||(a.TemplateSumarizacao="")})),l.find("select[name=ddlColunas]").val(0),l.find("select[name=ddlColunas]").change()),m(),p.find("a[name=btnNovoBotao]").click((function(){var e=$("#promptPropriedadeGridAdd_"+n.Descricao);e.length>0&&e.remove();var t=$(Geeks.ERP.UI.Template.Get("ContentBodyTemplate").format({Codigo:"promptPropriedadeButtonAdd_"+n.Descricao}));$(t).appendTo(i),t.find("span[ref=bodyTitle]").html("Novo Botão");var o=t.dialog({modal:!0,width:300,height:330,resizable:!0,close:function(){t.remove()}});o.dialog("open");var r=$("<ul name='MenuBotoes'><ul>").prependTo(t.find(".breadLine > .breadLinks")),u=$(Geeks.ERP.UI.Template.Get("ContentBodyAddButton"));u.appendTo(t.find(".fluid")),r.append(a.MontaBotoes([{Nome:"Salvar",Valor:"Salvar",CodigoBotao:"S1",Icone:"icon-checkmark"},{Nome:"Cancelar",Valor:"Cancelar",CodigoBotao:"S2",Icone:"icon-minus"}],null)),r.find("a[name=btn_Salvar]").click((function(){var e=u.find("input[name=txtIdAdd]").val().trim(),a=u.find("input[name=txtClasseAdd]").val().trim();if(""!=e)if(""!=a){d.toolbar.push({name:" ",id:e,classe:a,template:'<button style="width: 22px; height:20px; margin:0; padding:0; margin-left:2px;" class="buttonM bDefault"  name="'+e+'"; return false;"> <span class="'+a+'" style="margin-left:5px; font-size:10px" ></span> </button>'}),m();var t=d.toolbar.length-1;p.find("select[name=ddlBotoes]").val(t),l.find("div[name=toolbarSelecionado]").show(),o.dialog("close")}else jError("Classe Obrigatório!","Atenção");else jError("Id Obrigatório!","Atenção")})),r.find("a[name=btn_Cancelar]").click((function(){o.dialog("close")})),a.FormataCampos(u)})),p.find("a[name=btnExcluirBotao]").click((function(){var e=l.find("select[name=ddlBotoes]").val();""!=e&&jConfirm('Deseja realmente excluir "'+(d.toolbar[e].id?d.toolbar[e].id:" ")+'"?',"Remover Botão?",(function(a){if(a)if(d.toolbar.splice(e,1),m(),l.find("select[name=ddlBotoes]").find("option").length>0){var t=l.find("select[name=ddlBotoes]").find("option:first-child").val();l.find("select[name=ddlBotoes]").val(t)}else l.find("div[name=toolbarSelecionado]").hide()}))})),l.find("select[name=ddlColunas]").change((function(){d.dataSource.schema.model.fields[d.columns[this.value].field]||(d.dataSource.schema.model.fields[d.columns[this.value].field]={type:"string",nullable:!0,identify:!1,editable:!0,hidden:!1}),d.columns[this.value].hasOwnProperty("CustomTemplate")||(d.columns[this.value].CustomTemplate=""),d.columns[this.value].hasOwnProperty("GravaCampoNoBanco")||(d.columns[this.value].GravaCampoNoBanco=!0),d.columns[this.value].hasOwnProperty("LeCampoDoBanco")||(d.columns[this.value].LeCampoDoBanco=!0),d.columns[this.value].hasOwnProperty("Alinhamento")||(d.columns[this.value].Alinhamento="auto"),d.columns[this.value].hasOwnProperty("Obrigatorio")||(d.columns[this.value].Obrigatorio=!1),d.columns[this.value].hasOwnProperty("Identificador")||(d.columns[this.value].Identificador=!1),d.columns[this.value].hasOwnProperty("Leitura")||(d.columns[this.value].Leitura=!1),d.columns[this.value].hasOwnProperty("condition")||(d.columns[this.value].condition=!1),d.columns[this.value].hasOwnProperty("sortable")||(d.columns[this.value].sortable=!0),d.columns[this.value].hasOwnProperty("filterable")||(d.columns[this.value].filterable=!0),d.columns[this.value].hasOwnProperty("groupable")||(d.columns[this.value].groupable=!0),d.columns[this.value].hasOwnProperty("TemBotao")||(d.columns[this.value].TemBotao=!1),d.columns[this.value].hasOwnProperty("hidden")||(d.columns[this.value].hidden=!1),d.columns[this.value].hasOwnProperty("Sumarizacao")||(d.columns[this.value].Sumarizacao=!1),d.columns[this.value].hasOwnProperty("SumarizaNoGrupo")||(d.columns[this.value].SumarizaNoGrupo=!1),d.columns[this.value].hasOwnProperty("SumarizaNoRodape")||(d.columns[this.value].SumarizaNoRodape=!1),d.columns[this.value].hasOwnProperty("OperacaoSumarizacao")||(d.columns[this.value].OperacaoSumarizacao="sum"),d.columns[this.value].hasOwnProperty("TemplateSumarizacao")||(d.columns[this.value].TemplateSumarizacao=""),l.find("div[name=comBotao]").hide(),l.find("input[name=txtCampo]").val(d.columns[this.value].field),l.find("input[name=txtDescricao]").val(d.columns[this.value].title),l.find("input[name=txtTemplate]").val(d.columns[this.value].CustomTemplate),d.columns[this.value].geeksType||(d.columns[this.value].geeksType="texto"),l.find("select[name=ddlTipo]").val(d.columns[this.value].geeksType).trigger("liszt:updated"),l.find("select[name=ddlAlinhamento]").val(d.columns[this.value].Alinhamento),l.find("input[name=ckObrigatorio]").prop("checked",d.columns[this.value].Obrigatorio),l.find("input[name=ckIdentificador]").prop("checked",d.columns[this.value].Identificador),l.find("input[name=ckEditavel]").prop("checked",!d.columns[this.value].Leitura),l.find("input[name=ckVisivel]").prop("checked",!d.columns[this.value].hidden),l.find("input[name=ckCondicao]").prop("checked",d.columns[this.value].condition),l.find("input[name=ckOrdenaColuna]").prop("checked",d.columns[this.value].sortable),l.find("input[name=ckFiltraColuna]").prop("checked",d.columns[this.value].filterable),l.find("input[name=ckGravaNoBanco]").prop("checked",d.columns[this.value].GravaCampoNoBanco),l.find("input[name=ckLeDoBanco]").prop("checked",d.columns[this.value].LeCampoDoBanco),l.find("input[name=ckAgrupaColuna]").prop("checked",d.columns[this.value].groupable),l.find("input[name=ckBotao]").prop("checked",d.columns[this.value].TemBotao),l.find("input[name=ckSumarizacao]").prop("checked",d.columns[this.value].Sumarizacao),l.find("input[name=ckSumarizaNoGrupo]").prop("checked",d.columns[this.value].SumarizaNoGrupo),l.find("input[name=ckSumarizaNoRodape]").prop("checked",d.columns[this.value].SumarizaNoRodape),l.find("select[name=ddlOperacaoSumarizacao]").val(d.columns[this.value].OperacaoSumarizacao).trigger("liszt:updated"),l.find("input[name=txtTemplateSumarizacao]").val(d.columns[this.value].TemplateSumarizacao),d.columns[this.value].command&&l.find("input[name=txtTexto]").val(d.columns[this.value].command.text),$.uniform.update()})),l.find("input[name=txtCampo]").change((function(){var e=l.find("select[name=ddlColunas]").val();d.columns[e].field=this.value})),l.find("input[name=txtDescricao]").change((function(){var e=l.find("select[name=ddlColunas]").val();d.columns[e].title=this.value})),l.find("select[name=ddlTipo]").change((function(){var e=l.find("select[name=ddlColunas]").val();d.dataSource.schema.model.fields[d.columns[e].field].type=function(e){switch(e){case"numero":case"number":return"number";case"checagem":return"boolean";case"valor":case"valor4":case"money":return"money";case"data":case"datahora":case"date":return"date";default:return"string"}}(this.value),d.columns[e].geeksType=this.value,l.find("div[name=divDropDownOptions]").hide(),l.find("div[name=divPrompt]").hide(),"selecao"==this.value.toLowerCase()?(l.find("div[name=divDropDownOptions]").show(),l.find("textarea[name=txtDropDownOpcoes]").val(d.columns[e].dropDownOptions?d.columns[e].dropDownOptions.replace(/\\[n]/g,"\n"):""),l.find("input[name=ckBotao]").prop("checked",!1),l.find("input[name=ckBotao]").parents(".formRow").css("display","none")):"prompt"==this.value.toLowerCase()?(l.find("div[name=divPrompt]").show(),l.find("input[name=txtCampoForeignKeyPrompt]").val(d.columns[e].campoForeignKeyPrompt),l.find("input[name=ckBotao]").prop("checked",!1),l.find("input[name=ckBotao]").parents(".formRow").css("display","none")):l.find("input[name=ckBotao]").parents(".formRow").css("display","block"),$.uniform.update()})),l.find("select[name=ddlAlinhamento]").change((function(){var e=l.find("select[name=ddlColunas]").val();d.columns[e].Alinhamento=this.value})),l.find("input[name=txtCampoForeignKeyPrompt]").change((function(){var e=l.find("select[name=ddlColunas]").val();d.columns[e].campoForeignKeyPrompt=this.value})),l.find("textarea[name=txtDropDownOpcoes]").change((function(){var e=l.find("select[name=ddlColunas]").val();d.columns[e].dropDownOptions=this.value})),l.find("input[name=ckObrigatorio]").change((function(){var e=l.find("select[name=ddlColunas]").val();d.dataSource.schema.model.fields[d.columns[e].field].nullable=!$(this).prop("checked"),d.columns[e].Obrigatorio=$(this).prop("checked")})),l.find("input[name=ckIdentificador]").change((function(){var e=l.find("select[name=ddlColunas]").val();d.dataSource.schema.model.fields[d.columns[e].field].identify=$(this).prop("checked"),d.columns[e].Identificador=$(this).prop("checked")})),l.find("input[name=ckOrdenaColuna]").change((function(){var e=l.find("select[name=ddlColunas]").val();d.columns[e].sortable=$(this).prop("checked")})),l.find("input[name=ckFiltraColuna]").change((function(){var e=l.find("select[name=ddlColunas]").val();d.columns[e].filterable=$(this).prop("checked")})),l.find("input[name=ckGravaNoBanco]").change((function(){var e=l.find("select[name=ddlColunas]").val();d.columns[e].GravaCampoNoBanco=$(this).prop("checked")})),l.find("input[name=ckLeDoBanco]").change((function(){var e=l.find("select[name=ddlColunas]").val();d.columns[e].LeCampoDoBanco=$(this).prop("checked")})),l.find("input[name=ckAgrupaColuna]").change((function(){var e=l.find("select[name=ddlColunas]").val();d.columns[e].groupable=$(this).prop("checked")})),l.find("input[name=ckEditavel]").change((function(){var e=l.find("select[name=ddlColunas]").val();d.dataSource.schema.model.fields[d.columns[e].field].editable=$(this).prop("checked"),d.columns[e].Leitura=!$(this).prop("checked")})),l.find("input[name=ckVisivel]").change((function(){var e=l.find("select[name=ddlColunas]").val();d.columns[e].hidden=!$(this).prop("checked")})),l.find("input[name=ckBotao]").change((function(){var e=l.find("select[name=ddlColunas]").val();$(this).prop("checked")?(d.columns[e].command||(d.columns[e].command={name:"gridBtn_"+$(this).prop("name")}),l.find("div[name=comBotao]").show()):(l.find("div[name=comBotao]").hide(),d.columns[e].command=null),d.columns[e].TemBotao=$(this).prop("checked")})),l.find("input[name=txtTexto]").change((function(){var e=l.find("select[name=ddlColunas]").val();d.columns[e].command||(d.columns[e].command={}),d.columns[e].command.text=this.value})),l.find("input[name=ckCondicao]").change((function(){var e=d.columns[l.find("select[name=ddlColunas]").val()];$(this).prop("checked")?(l.find("div[name=divCondicao]").show(),l.find("input[name=txtCondicao]").val(e.textCondition),l.find("select[name=ddlCondicao]").val(e.compCondition).trigger("liszt:updated"),l.find("input[name=txtImagem]").val(e.bgImage),l.find("input[name=txtCorBg]").val(e.color),l.find("input[name=txtCorFonte]").val(e.fontColor)):l.find("div[name=divCondicao]").hide(),e.condition=$(this).prop("checked")})),l.find("input[name=txtCondicao]").change((function(){var e=l.find("select[name=ddlColunas]").val();d.columns[e].textCondition=this.value})),l.find("input[name=txtImagem]").change((function(){var e=l.find("select[name=ddlColunas]").val();d.columns[e].bgImage=this.value})),l.find("input[name=txtCorBg]").change((function(){var e=l.find("select[name=ddlColunas]").val();d.columns[e].color=this.value})),l.find("input[name=txtCorFonte]").change((function(){var e=l.find("select[name=ddlColunas]").val();d.columns[e].fontColor=this.value})),l.find("select[name=ddlBotoes]").change((function(){l.find("input[name=txtId]").val(d.toolbar[this.value].id),l.find("input[name=txtClasse]").val(d.toolbar[this.value].classe)})),l.find("input[name=txtId]").change((function(){var e=l.find("select[name=ddlBotoes]").val();d.toolbar[e].id=this.value})),l.find("input[name=txtClasse]").change((function(){var e=l.find("select[name=ddlBotoes]").val();d.toolbar[e].classe=this.value})),l.find("input[name=txtTemplate]").change((function(){var e=l.find("select[name=ddlColunas]").val();d.columns[e].CustomTemplate=this.value})),l.find("input[name=ckSumarizacao]").change((function(){var e=l.find("select[name=ddlColunas]").val();$(this).prop("checked")?l.find("div[name=comSumarizacao]").show():l.find("div[name=comSumarizacao]").hide(),d.columns[e].Sumarizacao=$(this).prop("checked")})),l.find("input[name=ckSumarizaNoGrupo]").change((function(){var e=l.find("select[name=ddlColunas]").val();d.columns[e].SumarizaNoGrupo=$(this).prop("checked")})),l.find("input[name=ckSumarizaNoRodape]").change((function(){var e=l.find("select[name=ddlColunas]").val();d.columns[e].SumarizaNoRodape=$(this).prop("checked")})),l.find("select[name=ddlOperacaoSumarizacao]").change((function(){var e=l.find("select[name=ddlColunas]").val();d.columns[e].OperacaoSumarizacao=this.value})),l.find("input[name=txtTemplateSumarizacao]").change((function(){var e=l.find("select[name=ddlColunas]").val();d.columns[e].TemplateSumarizacao=this.value})),s.find("a[name=btn_Salvar]").click((function(){var a=""==l.find("textarea[name=txtSentencaSQL]").val().trim()?"Por Favor preencher a Sentença SQL da Grid":"OK";if("OK"!=a)throw a;!function(){n.Incluir=l.find("input[name=ckIncluir]").prop("checked"),n.Editar=l.find("input[name=ckEditar]").prop("checked"),n.Excluir=l.find("input[name=ckExcluir]").prop("checked"),n.Excel=l.find("input[name=ckExcel]").prop("checked"),n.OrdenaGrade=l.find("input[name=ckOrdenaGrade]").prop("checked"),n.FiltraGrade=l.find("input[name=ckFiltraGrade]").prop("checked"),n.AgrupaGrade=l.find("input[name=ckAgrupaGrade]").prop("checked"),n.MinimizarLinhas=l.find("input[name=ckMinimizarLinhas]").prop("checked"),n.Paginacao=l.find("input[name=ckPaginacao]").prop("checked"),n.MultiRow=l.find("input[name=ckMultiRow]").prop("checked"),n.SentencaSQL=l.find("textarea[name=txtSentencaSQL]").val().replace(/\\n/g,"\n"),n.Descricao=l.find("input[name=txtDescricaoGrade]").val(),n.ForeignKeyName=l.find("input[name=ForeignKeyName]").val();var a=!1;n.FiltraGrade&&(a={mode:"menu",extra:!0,operators:{string:{contains:"Contenha",doesnotcontain:"Não Contenha",eq:"Igual",neq:"Diferente",startswith:"Começa com",endswith:"Termina com"},number:{eq:"Igual",neq:"Diferente",gte:"Maior ou igual",gt:"Maior que",lte:"Menor ou igual",lt:"Menor que"},money:{eq:"Igual",neq:"Diferente",gte:"Maior ou igual",gt:"Maior que",lte:"Menor ou igual",lt:"Menor que"},date:{eq:"Igual",neq:"Diferente",gte:"Posterior ou igual",gt:"Posterior a",lte:"Anterior ou igual",lt:"Anterior a"}}}),d.filterable=a,d.sortable=n.OrdenaGrade,d.groupable=n.AgrupaGrade,t(n,d);var i=[],u=[];$.each(d.columns,(function(e,a){if(0==a.hidden&&(null!=a.footerAttributes&&null!=a.footerAttributes.style&&(a.footerAttributes.style=""),null!=a.headerAttributes&&null!=a.headerAttributes.style&&(a.headerAttributes.style="")),"prompt"==a.geeksType&&a.campoForeignKeyPrompt){var t=$.grep(d.columns,(function(e){return e.field==a.campoForeignKeyPrompt}));t.length>0&&(t[0].hidden=!0)}else"selecao"==a.geeksType&&a.dropDownOptions&&(a.dropDownOptions=a.dropDownOptions.replace(/\\[n]/g,"\n"));a.dropDownOptions?(a.template=function(e){var t=a.dropDownOptions.split("\n"),o=$.grep(t,(function(t){return t.split("=")[0].trim()==e[a.field]}));return o.length>0?o[0].split("=")[1].trim():"DropDown Error"},a.filterable=[{ui:"dropDownFilter"}]):"checagem"==a.geeksType?(a.template=function(e){return 1==e[a.field]||"1"==e[a.field]||1==e[a.field]||"true"==e[a.field]?"<div style=\"text-align: center\"><img src='./Content/Plugins/Aquincum/images/icons/usual/icon-check.png' alt='"+e[a.field]+"'/></div>":" "},a.groupHeaderTemplate=function(e){return"true"==e.value?a.title+": Sim":a.title+": Não"}):"valor"==a.geeksType?(a.template=function(e){return e[a.field]?kendo.toString(e[a.field],"n2"):"0,00"},a.groupHeaderTemplate="#= kendo.toString(value, 'n2') #"):"valor4"==a.geeksType?(a.template=function(e){return e[a.field]?kendo.toString(e[a.field],"n4"):"0,00"},a.groupHeaderTemplate="#= kendo.toString(value, 'n4') #"):"numero"==a.geeksType?a.template=function(e){return e[a.field]?(e[a.field]+"").replace(".",","):"0"}:"data"==a.geeksType?(a.template=function(e){return e[a.field]?(e[a.field]=new Date(kendo.parseDate(e[a.field]).getTime()),kendo.toString(e[a.field],"dd/MM/yyyy")):" "},a.groupHeaderTemplate="#= kendo.toString(kendo.parseDate(value), 'dd/MM/yyyy') #",a.format="{0:dd/MM/yyyy}",a.filterable=[{ui:"datepicker"}]):"datahora"==a.geeksType?(a.template=function(e){return e[a.field]?(e[a.field]=new Date(kendo.parseDate(e[a.field]).getTime()),kendo.toString(e[a.field],"dd/MM/yyyy HH:mm:ss")):" "},a.groupHeaderTemplate="#= kendo.toString(kendo.parseDate(value), 'dd/MM/yyyy HH:mm:ss') #",a.format="{0:dd/MM/yyyy HH:mm:ss}",a.filterable=[{ui:"datetimepicker"}]):"arquivo"==a.geeksType?a.template=function(e){if(e[a.field]){var t=e[a.field].split("#$#");return'<a href="'+t[0]+'" download="'+t[1]+'" title="Download do Arquivo">'+t[1]+"</a>"}return" "}:"imagem"==a.geeksType?a.template=function(e){if(e[a.field]){var t=e[a.field].split("#$#");if(t[0].indexOf("image")>-1)return'<img src="'+t[0]+'" style="max-height: 100px;"></img>'}return" "}:a.template=!!a.CustomTemplate&&a.CustomTemplate,a.Alinhamento?"auto"!=a.Alinhamento?a.attributes={style:"text-align: "+a.Alinhamento}:"valor"==a.geeksType||"valor4"==a.geeksType||"numero"==a.geeksType?a.attributes={style:"text-align: right"}:a.attributes={style:"text-align: left"}:a.attributes=null,a.Sumarizacao?(a.SumarizaNoGrupo?a.TemplateSumarizacao?a.groupFooterTemplate=a.TemplateSumarizacao:"valor"==a.geeksType&&"count"!=a.OperacaoSumarizacao?a.groupFooterTemplate="<div style='text-align: right'>#: kendo.toString("+a.OperacaoSumarizacao+", 'n2') #</div>":"valor4"==a.geeksType&&"count"!=a.OperacaoSumarizacao?a.groupFooterTemplate="<div style='text-align: right'>#: kendo.toString("+a.OperacaoSumarizacao+", 'n4') #</div>":"numero"==a.geeksType&&"count"!=a.OperacaoSumarizacao?a.groupFooterTemplate="<div style='text-align: right'>#: "+a.OperacaoSumarizacao+" #</div>":a.groupFooterTemplate="#: "+a.OperacaoSumarizacao+" #":a.groupFooterTemplate=null,a.SumarizaNoRodape?(a.TemplateSumarizacao?a.footerTemplate=a.TemplateSumarizacao:"valor"==a.geeksType&&"count"!=a.OperacaoSumarizacao?a.footerTemplate="<div style='text-align: right'>#: kendo.toString("+a.OperacaoSumarizacao+", 'n2') #</div>":"valor4"==a.geeksType&&"count"!=a.OperacaoSumarizacao?a.footerTemplate="<div style='text-align: right'>#: kendo.toString("+a.OperacaoSumarizacao+", 'n4') #</div>":"numero"==a.geeksType&&"count"!=a.OperacaoSumarizacao?a.footerTemplate="<div style='text-align: right'>#: "+a.OperacaoSumarizacao+" #</div>":a.footerTemplate="#: "+a.OperacaoSumarizacao+" #",u.push({field:a.field,aggregate:a.OperacaoSumarizacao})):a.footerTemplate=null,a.aggregates=[a.OperacaoSumarizacao],i.push({field:a.field,aggregate:a.OperacaoSumarizacao})):(a.groupFooterTemplate=null,a.footerTemplate=null,a.aggregates=null)})),i.length>0&&(d.dataSource.aggregate=i),u.length>0&&d.dataSource.group[0]&&(d.dataSource.group[0].aggregates=u);var c=[];$.each(d.columns,(function(){c.push({ColumnName:this.field})})),d.dataSource.schema.model=e.GenerateModel(d,c),n.Target.data("kendoGrid").setOptions(d),o(n.Target,n,r),n.Target.data("kendoGrid").Fill(),n.DtaLayout=JSON.stringify(d)}()})),l.find("input[name=TabelaMaster]").val(n.TabelaMaster),l.find("input[name=ckIncluir]").prop("checked",n.Incluir),l.find("input[name=ckEditar]").prop("checked",n.Editar),l.find("input[name=ckExcluir]").prop("checked",n.Excluir),l.find("input[name=ckExcel]").prop("checked",n.Excel),l.find("input[name=ckOrdenaGrade]").prop("checked",n.OrdenaGrade),l.find("input[name=ckFiltraGrade]").prop("checked",n.FiltraGrade),l.find("input[name=ckAgrupaGrade]").prop("checked",n.AgrupaGrade),l.find("input[name=ckMinimizarLinhas]").prop("checked",n.MinimizarLinhas),l.find("input[name=ckPaginacao]").prop("checked",n.Paginacao),l.find("input[name=ckMultiRow]").prop("checked",n.MultiRow),l.find("textarea[name=txtSentencaSQL]").val(n.SentencaSQL),l.find("input[name=txtDescricaoGrade]").val(n.Descricao),l.find("input[name=ForeignKeyName]").val(n.ForeignKeyName),l.find(".wrapper").css("height","465px"),l.find(".wrapper").css("margin","0px"),l.find(".fluid").css("height","465px"),l.find(".tab_container").css("height","427px"),a.FormataCampos(l),l.find("select[name=ddlColunas]").val(0)},this.GenerateModel=function(e,a){var t={id:"ID"},o={};if(e&&e.dataSource&&e.dataSource.schema&&e.dataSource.schema.model&&e.dataSource.schema.model.fields)for(var n=0;n<a.length;n++)if(e.dataSource.schema.model.fields.hasOwnProperty(a[n].ColumnName)){for(var i=0;i<e.columns.length;i++)e.columns[i].field==a[n].ColumnName&&("data"==e.columns[i].geeksType||"datahora"==e.columns[i].geeksType?e.dataSource.schema.model.fields[a[n].ColumnName].type="date":"valor"==e.columns[i].geeksType||"valor4"==e.columns[i].geeksType?e.dataSource.schema.model.fields[a[n].ColumnName].type="money":"numero"==e.columns[i].geeksType?e.dataSource.schema.model.fields[a[n].ColumnName].type="number":"texto"==e.columns[i].geeksType&&(e.dataSource.schema.model.fields[a[n].ColumnName].type="string"));o[a[n].ColumnName]=e.dataSource.schema.model.fields[a[n].ColumnName]}else o[a[n].ColumnName]={type:"string",nullable:!0,identify:!1,editable:!0};else for(i=0;i<a.length;i++)o[a[i].ColumnName]={type:"string",nullable:!0,identify:!1,editable:!0};return t.fields=o,t}};var CaseInsensitiveComparer={getterCache:{},getter:function(e){return this.getterCache[e]=this.getterCache[e]||new Function("d","return "+kendo.expr(e))},selector:function(e){return jQuery.isFunction(e)?e:this.getter(e)},asc:function(e){var a=this.selector(e);return function(e,t){return e=a(e),t=a(t),"string"==typeof e&&"string"==typeof t&&(e=e.toLowerCase(),t=t.toLowerCase()),e>t?1:e<t?-1:0}},desc:function(e){var a=this.selector(e);return function(e,t){return e=a(e),t=a(t),"string"==typeof e&&"string"==typeof t&&(e=e.toLowerCase(),t=t.toLowerCase()),e<t?1:e>t?-1:0}},create:function(e){return this[e.dir.toLowerCase()](e.field)},combine:function(e){return function(a,t){var o,n,i=e[0](a,t);for(o=1,n=e.length;o<n;o++)i=i||e[o](a,t);return i}}};kendo.data.Query.prototype.normalizeSort=function(e,a){if(e){var t="string"==typeof e?{field:e,dir:a}:e,o=jQuery.isArray(t)?t:void 0!==t?[t]:[];return jQuery.grep(o,(function(e){return!!e.dir}))}},kendo.data.Query.prototype.sort=function(e,a,t){var o,n,i=this.normalizeSort(e,a),r=[];if(t=t||CaseInsensitiveComparer,i.length){for(o=0,n=i.length;o<n;o++)r.push(t.create(i[o]));return this.orderBy({compare:t.combine(r)})}return this},kendo.data.Query.prototype.orderBy=function(e){var a=this.data.slice(0),t=jQuery.isFunction(e)||!e?CaseInsensitiveComparer.asc(e):e.compare;return new kendo.data.Query(a.sort(t))},kendo.data.Query.prototype.orderByDescending=function(e){return new kendo.data.Query(this.data.slice(0).sort(CaseInsensitiveComparer.desc(e)))};