Geeks.ERP.UI.Tela=new function(){var e=this;this.OpenWindow=function(a,o,i,t,n,r,d){if("gridEdit"!=a&&"popup"!=a&&"popupAdd"!=a&&"popupEdit"!=a&&0!=i.CodigoObjeto){var s=JSON.parse(localStorage.getItem("dadosUsuario")),l="if (Select count(*) from UsuarioPermissaoSistema ups inner join Usuario u on u.CodigoUsuario = ups.CodigoUsuario \tleft join UsuarioPermissao up on up.CodigoUsuarioPermissaoSistema = ups.CodigoUsuarioPermissaoSistema \twhere up.Permitir = 1 and ups.CodigoUsuario=0"+s.CodigoUsuario+" and up.CodigoObjeto = "+i.CodigoObjeto+" and ups.CodigoClienteSistema = "+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema+") > 0 or \t(Select count(*) from UsuarioPermissaoSistema ups inner join Usuario u on u.CodigoUsuario = ups.CodigoUsuario \tleft join GrupoPermissao gp on gp.CodigoGrupo = ups.CodigoGrupo \twhere gp.Permitir = 1 and ups.CodigoUsuario=0"+s.CodigoUsuario+" and gp.CodigoObjeto = "+i.CodigoObjeto+" and ups.CodigoClienteSistema = "+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema+") > 0 \tSelect 1 Permitir else \tSelect 0 Permitir ",c=Geeks.ERP.Core.Connection.ExecuteSQL(l,!0).Records,u="true"==$("#hfUsuarioAdm").val();if("true"!=$("#hfUsuarioAdm").val()&&c&&c.length>0&&(u=c[0].Permitir),!u)return void $.jGrowl("O usuário não possui permissão para a tela "+i.Descricao);l="Insert into LogMenu (CodigoUsuario, CodigoContato, Nome, CodigoMenu, DescricaoMenu, DataHoraAcesso) Select 0"+s.CodigoUsuario+", CodigoContato, Nome, 0"+i.CodigoObjeto+", '"+i.Descricao+"', getDate() from Contato where CodigoUsuario = 0"+s.CodigoUsuario,Geeks.ERP.Core.Connection.ExecuteSQL(l)}if("popup"!=a&&$(">div[ref=contentBody]",o).hide(),d)try{console.log(o),console.log("entrou 2"),i.CodigoPersonalizado=Geeks.ERP.Core.Connection.ExecuteSQL("select CodigoPersonalizado From Objeto Where CodigoObjeto = "+i.CodigoObjeto,!0).Records[0].CodigoPersonalizado}catch(e){}i.CodigoPersonalizado||(i.CodigoPersonalizado="");var m=$(o).find("#"+a+"_"+i.NomeObjeto);if(m.length<=0?(m=$(Geeks.ERP.UI.Template.Get("ContentBodyTemplate").format({Codigo:a+"_"+i.NomeObjeto})).appendTo(o),$("<ul name='MenuBotoes'></ul>").appendTo(m.find(".breadLine > .breadLinks")).append(e.MontaBotoes([{Nome:"Fechar",Valor:"Fechar",CodigoBotao:"D0",Icone:"icon-exit"}],null)),m.find("a[name=btn_Fechar]").click((function(){if("content"==a){var i=o.data("OpenedWindows");if(i){for(var t=null,n=i.windows.length-1;n>=0;n--)if(i.windows[n].attr("id")==m.attr("id")){t=i.windows[n-1];break}t&&$("#"+t.attr("id")).length>0?(i.windows=$.grep(i.windows,(function(e){return e.attr("id")!=m.attr("id")})),t.show(),e.integracao(t.attr("id"),t)):(i.windows=$.grep(i.windows,(function(e){return e.attr("id")!=m.attr("id")})),$("#content_Menu").show(),$(document).find("title").html("Geeks - B15 :: Menu"))}}$(this).parents("[ref=contentBody]").remove()})),n&&e.RenderObjeto(m,i,"gridEdit"==a||"popupEdit"==a||"popupAdd"==a),e.FormataCampos(m),m.find(".wrapper > .fluid").prepend("<script>$(function (){ var currentContainer = $('#"+a+"_"+i.NomeObjeto+"');  try { "+i.CodigoPersonalizado+" \r } catch(ex) { jError(ex.message, 'Erro no código personalizado'); } }); <\/script>"),m.find(".wrapper > .fluid").find("script").remove(),m.append("<input name='CodigoObjeto' type='hidden' value='"+i.CodigoObjeto+"'/>"),this.integracao(i.NomeObjeto,m)):(m.css("display",""),this.integracao(i.NomeObjeto,m)),m.find("span[ref=bodyTitle]").html(i.CodigoObjeto+" - "+i.Descricao),m.find("span[ref=imgIcon]").addClass(i.Icone),m.close=function(){t&&t(),m.remove()},m.find(".k-grid-add").prop("title","Adicionar Registro"),m.find(".k-grid-edit").prop("title","Editar Registro"),m.find(".k-grid-delete").prop("title","Excluir Registro"),m.find(".k-grid-excel").prop("title","Exportar para Excel"),m.find(".k-grid-layout").prop("title","Salvar Layout da Grade"),m.find(".k-grid-collapse").prop("title","Minimizar Linhas"),m.find(".k-grid-expand").prop("title","Expandir Linhas"),"content"==a&&"content_Menu"!=m.attr("id")){$(document).find("title").html(i.Descricao+" :: B15");var p=o.data("OpenedWindows");p||(p={windows:[]},o.data("OpenedWindows",p)),p.windows.push(m)}return"content"==a&&$(window).scrollTop(0),m.find(".breadLine").sticky({topSpacing:0,zIndex:999}),m},this.RenderObjeto=function(a,o,i){var t=Geeks.ERP.UI.Grid;if(!i){var n=Geeks.ERP.Core.Connection.ExecuteSQL(["select * from objeto where codigoObjeto = "+o.CodigoObjeto,"select o.Descricao as Objeto, s.* from SESSAO as s left join Objeto as o on s.CodigoObjeto = o.CodigoObjeto where s.codigoObjeto = "+o.CodigoObjeto+" and s.Ativo = 1order by Ordem","select * from botao where codigoObjeto = "+o.CodigoObjeto+" order by ordem","select Graficos.* from Graficos inner join Sessao on Sessao.CodigoSessao = Graficos.CodigoSessao Where Sessao.CodigoObjeto = "+o.CodigoObjeto,"select Campo.* from Campo inner join Sessao on Sessao.CodigoSessao = Campo.CodigoSessao Where Sessao.CodigoObjeto = "+o.CodigoObjeto+" and Campo.Ativo = 1 and Sessao.Ativo = 1 order by Ordem","select Grid.* from Grid inner join Sessao on Sessao.CodigoSessao = Grid.CodigoSessao Where Sessao.CodigoObjeto = "+o.CodigoObjeto+" and Grid.Ativo = 1"],!0);(o=n[0].Records[0]).Sessoes=n[1].Records,o.Botoes=n[2].Records,o.Graficos=n[3].Records,o.Campos=n[4].Records,o.Grades=n[5].Records,o.Record=null}if(a.find("ul[name='MenuBotoes']").prepend(e.MontaBotoes(o.Botoes,null)),(o.Botoes||[]).find((e=>"videoaula"===e.Nome))){a.find("a[name=btn_videoaula]").css("display","none"),a.find("a[name=btn_videoaula]").off("click");const e=new Headers({Accept:"application/json","Content-type":"application/json; charset=utf-8",token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZFVzdWFyaW8iOiJEREIzNTJCOS1DNUMwLTQ1ODYtOTBGQy00NTlDNUMzN0VFQkQiLCJjcGYiOiIyMjUuOTExLjAwOC04OCIsImlhdCI6MTYyNzkwNTU1NywiZXhwIjoxNjU5NDQxNTU3fQ.bAr17s7XZp2YlZxZ31qazBgavdTTgWFTbK4Yo7eBy1Q",debug:void 0,banco:$("#hfCodigoSistema").data("GeeksData").BancoDeDados});let i="b15";~[37,23,42,40,52,53,57,58,63,68].indexOf($("#hfCodigoSistema").data("GeeksData").CodigoSistema)&&(i="optisoul");const t={method:"POST",headers:e,body:JSON.stringify({tutorial:{funcao:"36FB3AC2-EDE6-483C-9645-FD09B69B10DA",componente:o.CodigoObjeto,sistema:i}})};fetch("https://api2.b15.com.br",t).then((e=>{e.ok&&e.json().then((e=>{if(console.log("fetch json: ",e.tutorial),e.tutorial.length){if(a.find("a[name=btn_videoaula]").css("display","block"),1===e.tutorial.length)return a.find("a[name=btn_videoaula]").find("span").text("Videoaula"),void a.find("a[name=btn_videoaula]").on("click",(function(){window.open(e.tutorial[0].url,e.tutorial[0].title)}));a.find("a[name=btn_videoaula]").find("span").text("Videoaulas"),a.find("a[name=btn_videoaula]").on("click",(function(){let a="";for(const o of e.tutorial)a&&(a+=" union "),a+=`select\n                  1 as Codigo,\n                  '${o.title}' as title,\n                  '${o.url}' as url\n                `;const o=new Geeks.ERP.PromptB(this,"Videoaulas",a);o.Configuracao(1,"Código",70,1,"Codigo","numero","",0),o.Configuracao(2,"Vídeo",250,0,"title","texto","asc"),o.Configuracao(3,"url",300,1,"url","texto","",0),o.Show((function(e){window.open(e.url,e.title)}))}))}}))}))}var r=0;$.each(o.Sessoes,(function(i,n){var d=a.find(".fluid");if("unica"!=n.TipoSessao){if(r+=parseInt(n.Largura),d=$(Geeks.ERP.UI.Template.Get("SessaoTemplate").format({CodigoSessao:n.CodigoSessao,Tipo:"grade"==n.TipoSessao.toLowerCase()?"Grade":"",Largura:n.Largura,Alinhamento:n.Alinhamento,Layout:"opened"==n.Layout.toLowerCase()?"opened inactive":"closed"==n.Layout?"closed normal":"",Descricao:n.Descricao,Estilo:"grade"==n.TipoSessao.toLowerCase()?"overflow-x: auto; ":""})).appendTo(a.find(".fluid")),r>12&&(r=n.Largura),("true"!=$("#hfUsuarioAdm").val()||"true"==$("#hfUsuarioAdm").val()&&"1"!=$("#hfGrupoInterno").val())&&d.find("[just-adm=true]").remove(),"grade"!=n.TipoSessao.toLowerCase()&&d.find("[just-grade=true]").remove(),"campo"!=n.TipoSessao.toLowerCase()&&d.find("[just-campo=true]").remove(),"gráfico"!=n.TipoSessao.toLowerCase()&&d.find("[just-grafico=true]").remove(),"Campo"!=n.TipoSessao){if(""==n.Tamanho||null==n.Tamanho)if("contentBody"==d.parents(".wrapper").parent().attr("ref")&&$(window).height()>300){var s=$(window).height()-d.parents(".wrapper").parent().position().top;$.each(d.parents(".wrapper").siblings(),(function(){s-=$(this).outerHeight()})),$.each(d.find(".body").siblings(),(function(){s-=$(this).outerHeight()})),n.Tamanho=s-d.outerHeight()+20}else n.Tamanho=300;n.Tamanho&&d.find(".body").css("height",n.Tamanho)}else""!=n.Tamanho&&null!=n.Tamanho&&d.find(".body").css("height",n.Tamanho-10);"Campo"!=n.TipoSessao&&(d.find(".body").css("padding-bottom","0px"),d.find(".body").css("overflow","hidden"))}else a.find(".fluid").append('<div class="body" name="sessao_'+n.CodigoSessao+'"></div>');if("grade"==n.TipoSessao.toLowerCase()){var l=$.grep(o.Grades,(function(e){return e.CodigoSessao==n.CodigoSessao}));l.length>0&&(t.Render(d.find(".body"),l[0],"",o.Estrutural),d.find("a[name=PropriedadeGrid]").click((function(){var i=e.OpenWindow("popup",a,{CodigoObjeto:0,NomeObjeto:"Propriedades",Descricao:'Propriedades da Grade "'+n.Descricao+'"',Estrutural:!0},null,!1,!0);t.Propriedade(l[0],i,o.Estrutural),event.stopPropagation&&event.stopPropagation(),event.cancelBubble=!0})))}else if("campo"==n.TipoSessao.toLowerCase()||"unica"==n.TipoSessao.toLowerCase()){var c=0,u=!0,m=null,p=$.grep(o.Campos,(function(e){return e.CodigoSessao==n.CodigoSessao}));$.each(p,(function(a,i){if($.grep(p,(function(e){return e.CampoForeignKeyPrompt==i.Id})).length<=0){if(u&&(m=$('<div class="formRow"></div>').appendTo("unica"==n.TipoSessao.toLowerCase()?d:d.find(".body")),u=!1),m.append(e.MontaCampos(n.Ordem,i,o.Record,!1,o.Estrutural)),c+=parseInt(i.LabelLargura)+parseInt(i.CampoLargura),p.length-1>a){var t=p[a+1].LabelLargura+p[a+1].CampoLargura;c+t>12&&(c=12)}(c>=12||a==p.length-1)&&(c=0,m.append('<div class="clear"></div>'),u=!0)}}))}else"grafico"==n.TipoSessao.toLowerCase()&&d.find(".body").append('<div name="chart" style="width: 100%; height: 100%"/>');d.find("a[name=BotaoSessao]").click((function(){var o=[],i=JSON.parse(Geeks.ERP.Core.Connection.ExecuteSQL("Select g.* from Sessao s left join Grid as g on g.CodigoSessao = s.CodigoSessao where s.CodigoSessao = 12 ",!0).Records[0].DtaLayout);$.each(i.columns,(function(e,a){i.dataSource.schema.model.fields.hasOwnProperty(a.field)&&(i.dataSource.schema.model.fields[a.field],o.push({CodigoSessao:1,Label:a.title,Id:a.field,TipoCampo:null!=a.geeksType?a.geeksType:"texto",Obrigatorio:a.Obrigatorio,Identificador:a.Identificador,SentencaSQL:a.dropDownOptions,Ordem:e,LabelLargura:3,CampoLargura:9,Leitura:a.Leitura,CampoForeignKeyPrompt:a.campoForeignKeyPrompt,Visivel:!a.hidden,GravaCampoNoBanco:a.GravaCampoNoBanco}))}));var t={Descricao:'Propriedades da Sessão "'+n.Descricao+'"',CodigoObjeto:12,NomeObjeto:"Propriedades",Estrutural:!0,Sessoes:[{CodigoSessao:1,TipoSessao:"unica",Ordem:1}],Campos:o,Record:n,Botoes:[{Nome:"Salvar",Valor:"Salvar",CodigoBotao:"S1",Icone:"icon-checkmark"},{Nome:"Cancelar",Valor:"Cancelar",CodigoBotao:"S2",Icone:"icon-minus"}]},r=e.OpenWindow("popupEdit",a,t,null,!0,!0),d=r.dialog({modal:!0,width:600,height:600,resizable:!0,close:function(){r.remove()}}).dialog("open");r.find("a[name=btn_Salvar]").click((function(){var e="",a="";$.each(r.find("input, select, textarea"),(function(){var o=$(this).data("FieldData");o&&(o.Leitura||o.Identificador||!o.GravaCampoNoBanco?(a+=a?" AND ":" WHERE ",a+=o.Id+" = '"+$(this).val()+"'"):(e+=e?",":"","checagem"!=o.TipoCampo?"null"!=$(this).val()&&""!=$(this).val()&&null!=$(this).val()||"numero"==o.TipoCampo?"null"!=$(this).val()&&""!=$(this).val()&&null!=$(this).val()||"numero"!=o.TipoCampo?e+=o.Id+" = '"+$(this).val()+"'":e+=o.Id+" = 0":e+=o.Id+" = null":e+=o.Id+" = "+($(this).prop("checked")?"1":"0")))})),Geeks.ERP.Core.Connection.ExecuteSQL("UPDATE Sessao SET "+e+a,!0),d.dialog("close")})),r.find("a[name=btn_Cancelar]").click((function(){d.dialog("close")})),event.stopPropagation&&event.stopPropagation(),event.cancelBubble=!0})),d.find("a[name=BotaoComponente]").click((function(){var o="",i="";"campo"==n.TipoSessao.toLowerCase()?(o="13",i="Campos"):"gráfico"==n.TipoSessao.toLowerCase()&&(o="23",i="Gráfico");var r=e.OpenWindow("popup",a,{CodigoObjeto:0,NomeObjeto:"Sessao",Descricao:i+' da Sessão "'+n.Descricao+'"',Estrutural:!0},null,!1,!0),d=r.dialog({modal:!0,width:"80%",height:600,resizable:!0,close:function(){r.remove()}}).dialog("open");$("<ul name='MenuBotoes'><ul>").prependTo(r.find(".breadLine > .breadLinks")).append(e.MontaBotoes([{Nome:"Cancelar",Valor:"Cancelar",CodigoBotao:"S2",Icone:"icon-minus"}],null)).find("a[name=btn_Cancelar]").click((function(){d.dialog("close")}));var s=Geeks.ERP.Core.Connection.ExecuteSQL("select * from Grid Where CodigoGrid = "+o,!0).Records[0];s.sessao=n.CodigoSessao;var l=$("<div name='promptBotAdm_"+n.CodigoSessao+"'></div>").appendTo(r.find(".fluid"));t.Render(l,s,!0,!0),r.find("[name^=kendogrid_]").data("kendoGrid").filter="CodigoSessao = "+n.CodigoSessao,r.find("[name^=kendogrid_]").data("kendoGrid").foreignKeyName="CodigoSessao",r.find("[name^=kendogrid_]").data("kendoGrid").foreignKeyValue=n.CodigoSessao,r.find("[name^=kendogrid_]").data("kendoGrid").Fill(),event.stopPropagation&&event.stopPropagation(),event.cancelBubble=!0}))})),o.Target=a,o.TelaDesabilitada=!1,o.DataSource=function(a){var o=function(e,o){var i=$.grep(a.Campos,(function(a){return a.CodigoSessao==e.CodigoSessao}));$.each(i,(function(e,i){var t=o&&o.length>0?o[0][i.Id]:null;if("data"==i.TipoCampo&&null!=t){var n=new Date(parseInt(t.substr(6))).getTime();t=kendo.toString(new Date(n),"dd/MM/yyyy")}a.Target.find("input[name="+i.Id+"]:not([type=file]), select[name="+i.Id+i.CodigoCampo+"], checkbox[name="+i.Id+"], textarea[name="+i.Id+"], input[name=promptDisplay_"+i.Id+"]").val(t);var r=$.grep(a.Campos,(function(e){return e.CampoForeignKeyPrompt==i.Id}));if(r.length>0&&a.Target.find("input[name=promptDisplay_"+i.Id+"]").val(o&&o.length>0?o[0][r[0].Id]:null),a.Target.find("input[type=checkbox][name="+i.Id+"], checkbox[name="+i.Id+"]").prop("checked","1"==t||"true"==t||1==t),a.Target.find("div[name="+i.Id+"], span[name="+i.Id+"], a[name="+i.Id+"]").html(t),a.Target.find("input[name="+i.Id+"]:not([type=file]), select[name="+i.Id+"], checkbox[name="+i.Id+"], textarea[name="+i.Id+"]").change(),a.Target.find("input[type=checkbox][name="+i.Id+"], checkbox[name="+i.Id+"]").change(),"selecao"==i.TipoCampo&&a.Target.find("select[name="+i.Id+i.CodigoCampo+"]").trigger("liszt:updated"),"numero"==i.TipoCampo||"valor"==i.TipoCampo||"valor4"==i.TipoCampo||"moeda"==i.TipoCampo){var d=a.Target.find("[name="+i.Id+"]"),s=0;"valor"==i.TipoCampo?s=2:"valor4"==i.TipoCampo&&(s=4),s>0&&$(d).val(number_format($(d).val(),s))}"datahora"==i.TipoCampo&&t?(a.Target.find("[name=d_"+i.Id+"]").val(kendo.toString(new Date(1*t.match(/\d+/)[0]),"dd/MM/yyyy")),a.Target.find("[name=t_"+i.Id+"]").val(kendo.toString(new Date(1*t.match(/\d+/)[0]),"HH:mm:ss")),a.Target.find("[name="+i.Id+"]").val(kendo.toString(new Date(1*t.match(/\d+/)[0]),"dd/MM/yyyy HH:mm:ss"))):"datahora"==i.TipoCampo&&(a.Target.find("[name=d_"+i.Id+"]").val(""),a.Target.find("[name=t_"+i.Id+"]").val(""),a.Target.find("[name="+i.Id+"]").val("")),$.uniform.update()}))},i=function(e,o){var i="",t="INSERT INTO "+(a.TabelaMaster.indexOf(",")>-1?a.TabelaMaster.split(",")[0]:a.TabelaMaster)+" (",n=" VALUES (";return $.each(e,(function(e,r){var d=$.grep(a.Campos,(function(e){return e.CodigoSessao==r.CodigoSessao&&e.GravaCampoNoBanco}));$.each(d,(function(e,a){if(!("selecao"==a.TipoCampo.toLowerCase()&&o.find("[name^="+a.Id+"]").length<=0||"selecao"!=a.TipoCampo.toLowerCase()&&o.find("[name="+a.Id+"]").length<=0)){if("prompt"!=a.TipoCampo.toLowerCase())switch(t+=a.Id+",",a.TipoCampo.toLowerCase()){case"email":case"selecao":""==o.find("[name^="+a.Id+"]").val()||"undefined"==o.find("[name^="+a.Id+"]").val()||null==o.find("[name^="+a.Id+"]").val()||null==o.find("[name^="+a.Id+"]").val()?n+="NULL, ":n+="'"+o.find("[name^="+a.Id+"]").val()+"', ";break;case"textolongo":case"editorhtml":case"texto":case"moeda":case"prompt":case"arquivo":case"data":case"datahora":n+=(o.find("[name="+a.Id+"]").val()?"'"+o.find("[name="+a.Id+"]").val().replace(/'/g,"''")+"'":"null")+", ";break;case"valor":case"valor4":case"numero":n+=(o.find("[name="+a.Id+"]").val()?""+getDecimal(o.find("[name="+a.Id+"]").val()):"0")+", ";break;case"senha":""!=o.find("[name="+a.Id+"]").val()&&(n+=(o.find("[name="+a.Id+"]").val()?"'"+calcMD5(o.find("[name="+a.Id+"]").val())+"'":"null")+", ");break;case"checagem":n+=(o.find("[name="+a.Id+"]").attr("checked")?"1":"0")+", "}else"prompt"==a.TipoCampo.toLowerCase()&&(t+=a.Id+",",n+=(o.find("[name="+a.Id+"]").val()?"'"+o.find("[name="+a.Id+"]").val().replace(/'/g,"''")+"'":"null")+", ");if(a.Obrigatorio||""!=o.find("[name="+a.Id+"]").val())switch(a.TipoCampo){case"Data":validaData(o.find("[name="+a.Id+"]").val())||(i+="<strong>"+a.Label+"</strong> => data inválida.<br />");break;case"Email":validaMail(o.find("[name="+a.Id+"]").val())||(i+="<strong>"+a.Label+"</strong> => formato de E-mail inválido.<br />");default:""==o.find("[name="+a.Id+"]").val()&&(i+="<strong>"+a.Label+"</strong> => campo obrigatório.<br />")}}}))})),""!=i?(jError(i,"Atenção"),""):(t=t.substr(0,t.length-1)+")",n=n.substr(0,n.length-2)+"); SELECT SCOPE_IDENTITY() as Codigo",t+n)},t=function(e){var o=$.grep(a.Campos,(function(e){return 1==e.Obrigatorio})),i="";return $.each(o,(function(a,o){"selecao"==o.TipoCampo.toLowerCase()?e.find("[name^="+o.Id+"]").val()||(i+='O campo "'+o.Label+'" deve ser informado.<br/>'):"prompt"!=o.TipoCampo.toLowerCase()||"prompt"==o.TipoCampo.toLowerCase()&&!o.CampoForeignKeyPrompt?e.find("[name="+o.Id+"]").val()||(i+='O campo "'+o.Label+'" deve ser informado.<br/>'):e.find("[name="+o.CampoForeignKeyPrompt+"]").val()||(i+='O campo "'+o.Label+'" deve ser informado.<br/>')})),$.each(a.Campos,(function(a,o){"valor"!=o.TipoCampo.toLowerCase()&&"valor4"!=o.TipoCampo.toLowerCase()&&"numero"!=o.TipoCampo.toLowerCase()||null!=e.find("[name="+o.Id+"]").val()&&isNaN(e.find("[name="+o.Id+"]").val().replace(/\./g,"").replace(",","."))&&(i+='Valor do campo "'+o.Label+'" inválido.<br/>')})),!i||(jError(i,"Atenção"),!1)};return{Fill:function(e){var i,t=[],n=[],r="("+a.SentencaSQL+") Tabela";i=a.TabelaMaster.indexOf(",")>-1?a.TabelaMaster.split(",")[0]:a.TabelaMaster,(!a.SentencaSQL||a.SentencaSQL.trim().length<=0)&&(r="(select * from "+i+") tb");var d=$.grep(a.Sessoes,(function(e){return e.SentencaSQL==r||null==e.SentencaSQL||""==e.SentencaSQL.trim()})),s="SELECT ";$.each(d,(function(e,o){var i=$.grep(a.Campos,(function(e){return e.CodigoSessao==o.CodigoSessao&&e.LeCampoDoBanco}));$.each(i,(function(e,a){s+=a.Id+", "}))})),s=s.substr(0,s.length-2),s+=" FROM "+r+" WHERE 1 = 1 ",null==e&&""==$(e).trim()||(s+=" AND "+e),t.push(s);var l=$.grep(a.Sessoes,(function(e){return e.SentencaSQL!=r&&null!=e.SentencaSQL&&""!=e.SentencaSQL.trim()&&"Campo"==e.TipoSessao}));$.each(l,(function(o,i){var r=$.grep(a.Campos,(function(e){return e.CodigoSessao==i.CodigoSessao&&e.LeCampoDoBanco}));if(r.length>0){var d="SELECT ";$.each(r,(function(e,a){d+=a.Id+", "})),d=d.substr(0,d.length-2),d+=" FROM "+i.SentencaSQL+" WHERE 1 = 1 ",null==e&&""==$(e).trim()||(d+=" AND "+e),t.push(d),n.push(i)}}));var c=Geeks.ERP.Core.Connection.ExecuteSQL(t,a.Estrutural);c&&c.RecordsAffected>0&&$.jGrowl("Registro salvo com sucesso."),$.each(d,(function(e,a){o(a,c[0].Records)})),$.each(n,(function(e,a){"Campo"==a.TipoSessao&&o(a,c[e+1].Records)})),c[0].Records.length<=0?$(a.Target).find(".k-grid-toolbar").css("display","none"):$(a.Target).find(".k-grid-toolbar").css("display","block"),c&&$(a.Target).find(".breadLine .breadLinks").find("ul[name=MenuBotoes]").find("a[VisivelComRegistro=true]").parent().css("display","block"),t=[],n=[];var u=$.grep(a.Campos,(function(e){return 1==e.Identificador}));if(u.length>0){var m=$.grep(a.Sessoes,(function(e){return"Grade"==e.TipoSessao}));$.each(m,(function(e,o){var i=$.grep(a.Grades,(function(e){return e.CodigoSessao==o.CodigoSessao}));if(i.length>0){var r=$(a.Target).find("[name=kendogrid_"+i[0].Descricao+"]").data("kendoGrid");if(i[0].ForeignKeyName&&c[0].Records[0]){r.filter=i[0].ForeignKeyName+" = '"+c[0].Records[0][u[0].Id]+"'";var d="";i[0].TabelaMaster.indexOf(",")>-1&&(d=i[0].TabelaMaster.split(",")[1]),""!=d&&(r.filter=r.filter+" AND TabelaMaster = '"+d+"'")}else r.filter="0 = 1",console.log("Grade sem Foreign Key: "+i[0].CodigoGrid+" - "+i[0].Descricao);var s=r.sentenceSql();s&&(t.push(s),n.push(o))}})),c=Geeks.ERP.Core.Connection.ExecuteSQL(t,a.Estrutural),$.each(n,(function(e,o){if("Grade"==o.TipoSessao){var i=$.grep(a.Grades,(function(e){return e.CodigoSessao==o.CodigoSessao}));if(i.length>0){var t=$(a.Target).find("[name=kendogrid_"+i[0].Descricao+"]").data("kendoGrid"),n=t.dataSource.transport.read;t.dataSource.transport.read=function(a){a.success(c[e].Records)},t.Fill(),t.dataSource.transport.read=n}}}))}this.AfterFill&&this.AfterFill()},Update:function(e){if(t(a.Target)){if(null==a.TabelaMaster||a.TabelaMaster.indexOf(" ")>=0)return jAlert("Esta interface não permite gravação automática. Verifique a sentença SQL!"),"";var o,n,r,d,s,l=!0;if(this.BeforeUpdate&&(l=this.BeforeUpdate()),l){var c,u=[],m=$.grep(a.Sessoes,(function(e){var o;return o=a.TabelaMaster.indexOf(",")>-1?a.TabelaMaster.split(",")[0]:a.TabelaMaster,e.SentencaSQL==o||null==e.SentencaSQL||""==e.SentencaSQL.trim()})),p=0,g=$.grep(a.Campos,(function(e){return!!(e.Identificador&&a.Target.find("[name="+e.Id+"]").length>0)&&(p=a.Target.find("[name="+e.Id+"]").val(),!0)}));if(g.lengh<=0||!g[0])return jError("<strong>O campo de identificação não foi localizado, por favor entre em contato com a Geeks!</strong><br />","Atenção"),"";if(parseInt(p)>0){if(o=m,n="",r="",d=!1,s="UPDATE "+(a.TabelaMaster.indexOf(",")>-1?a.TabelaMaster.split(",")[0]:a.TabelaMaster)+" SET ",$.each(o,(function(e,o){var i=$.grep(a.Campos,(function(e){return e.CodigoSessao==o.CodigoSessao&&(e.GravaCampoNoBanco||e.Identificador)}));$.each(i,(function(e,o){if(!("selecao"==o.TipoCampo.toLowerCase()&&a.Target.find("[name="+o.Id+o.CodigoCampo+"]").length<=0||"selecao"!=o.TipoCampo.toLowerCase()&&a.Target.find("[name="+o.Id+"]").length<=0)){if(o.Identificador)"prompt"==o.TipoCampo.toLowerCase()&&(s+=o.Id+"=",s+=(a.Target.find("[name="+o.Id+"]").val()?"'"+a.Target.find("[name="+o.Id+"]").val().replace(/'/g,"''")+"'":"null")+", ");else switch(o.TipoCampo.toLowerCase()){case"email":case"selecao":""==a.Target.find("[name="+o.Id+o.CodigoCampo+"]").val()||"undefined"==a.Target.find("[name="+o.Id+o.CodigoCampo+"]").val()||null==a.Target.find("[name="+o.Id+o.CodigoCampo+"]").val()||null==a.Target.find("[name="+o.Id+o.CodigoCampo+"]").val()?s+=o.Id+"= NULL, ":(s+=o.Id+"= '",s+=a.Target.find("[name="+o.Id+o.CodigoCampo+"]").val()+"', ");break;case"textolongo":case"editorhtml":case"texto":case"prompt":case"arquivo":case"data":case"datahora":s+=o.Id+"=",s+=(a.Target.find("[name="+o.Id+"]").val()?"'"+a.Target.find("[name="+o.Id+"]").val().replace(/'/g,"''")+"'":"null")+", ";break;case"numero":case"valor":case"valor4":s+=o.Id+"=",s+=(a.Target.find("[name="+o.Id+"]").val()?""+getDecimal(a.Target.find("[name="+o.Id+"]").val()):"0")+", ";break;case"senha":""!=a.Target.find("[name="+o.Id+"]").val()&&(s+=o.Id+"=",s+=(a.Target.find("[name="+o.Id+"]").val()?"'"+calcMD5(a.Target.find("[name="+o.Id+"]").val())+"'":"null")+", ");break;case"checagem":s+=o.Id+"=",s+=(a.Target.find("[name="+o.Id+"]").attr("checked")?"1":"0")+", "}if(o.Identificador&&(d=!0,n+=(""==n?" WHERE ":" AND ")+o.Id+"='"+a.Target.find("[name="+o.Id+"]").val().replace(/'/g,"''")+"'"),o.Obrigatorio||""!=a.Target.find("[name="+o.Id+"]").val())switch(o.TipoCampo){case"Data":validaData(a.Target.find("[name="+o.Id+"]").val())||(r+="<strong>"+o.Label+"</strong> => data inválida.<br />");break;case"Email":validaMail(a.Target.find("[name="+o.Id+"]").val())||(r+="<strong>"+o.Label+"</strong> => formato de E-mail inválido.<br />");default:""==a.Target.find("[name="+o.Id+"]").val()&&(r+="<strong>"+o.Label+"</strong> => campo obrigatório.<br />")}}}))})),d||(r+="<strong>O campo de identificação não foi localizado, por favor entre em contato com a Geeks!</strong><br />"),""==(c=""!=r?(jError(r,"Atenção"),""):s=s.substr(0,s.length-2)+n))return"";e&&(c.toLowerCase().indexOf("where")>0?c+=" AND "+e:c+=" WHERE "+e),u.push(c)}else{if(""==(c=i(m,a.Target)))return"";u.push(c)}var f=Geeks.ERP.Core.Connection.ExecuteSQL(u,a.Estrutural);return this.AfterUpdate&&this.AfterUpdate(f),f}}},AddNew:function(){var o=this,n=[],r=200,d=[],s=null,l=$.grep(a.Campos,(function(e){return e.Obrigatorio&&e.GravaCampoNoBanco||e.Identificador}));if($.each(l,(function(e,o){if(o.Identificador)s=o;else{var i=$.grep(a.Sessoes,(function(e){return e.CodigoSessao==o.CodigoSessao}));$.grep(d,(function(e){return e.CodigoSessao==o.CodigoSessao})).length<=0&&d.push(i[0]);var t={CodigoSessao:1,Label:o.Label,Id:o.Id,TipoCampo:o.TipoCampo,Obrigatorio:!0,Identificador:!1,SentencaSQL:o.SentencaSQL,Ordem:e,LabelLargura:3,CampoLargura:9,Leitura:o.Leitura,CampoForeignKeyPrompt:o.CampoForeignKeyPrompt,Visivel:o.Visivel};n.push(t),r+36<600&&(r+=36)}})),s){var c={Descricao:"Incluindo "+a.Descricao,CodigoObjeto:a.CodigoObjeto,NomeObjeto:a.NomeObjeto,CodigoPersonalizado:a.CodigoPersonalizado,Estrutural:a.Estrutural,Sessoes:[{CodigoSessao:1,TipoSessao:"unica",Ordem:1,Layout:"opened"}],Campos:n,Botoes:[{Nome:"Salvar",Valor:"Salvar",CodigoBotao:"INC1",Icone:"icon-checkmark"},{Nome:"Cancelar",Valor:"Cancelar",CodigoBotao:"INC2",Icone:"icon-minus"}]},u=e.OpenWindow("popupAdd",a.Target,c,null,!0,!0,!1);u.find(".fluid").css("padding-bottom","20px");var m=u.dialog({modal:!0,width:600,height:r<600?r:600,resizable:!0,closeOnEscape:!1,close:function(){u.remove()}});return m.dialog("open"),u.find("a[name=btn_Salvar]").click((function(){if(t(u)){if(o.BeforeAddNew&&!o.BeforeAddNew(u))return;var e=i(d,u),n=Geeks.ERP.Core.Connection.ExecuteSQL(e,a.Estrutural);n&&(o.Fill(s.Id+" = "+n.Records[0].Codigo),$(a.Target).find(".k-grid-toolbar").css("display","block"),$(a.Target).find(".breadLine .breadLinks").find("ul[name=MenuBotoes]").find("a[VisivelComRegistro=true]").parent().css("display","block"),m.dialog("close")),o.AfterAddNew&&o.AfterAddNew(u)}})),u.find("a[name=btn_Cancelar]").click((function(){m.dialog("close"),m.remove()})),u}jError("Não foi encontrado o campo identificador, por favor, entre em contato com a Geeks!")},Delete:function(){this.BeforeDelete&&this.BeforeDelete(),this.AfterDelete&&this.AfterDelete()},AfterAddNew:null,BeforeAddNew:null,AfterUpdate:null,BeforeUpdate:null,AfterDelete:null,BeforeDelete:null,AfterFill:null}}(o),a.data("GeeksForm",o),$(o.Target).find(".breadLine .breadLinks").find("ul[name=MenuBotoes]").find("a[VisivelComRegistro=true]").parent().css("display","none")},this.MontaBotoes=function(a,o){var i=$("<div>"),t=$.grep(a,(function(e){return e.CodigoPai==o})),n=t.length;return $.each(t,(function(t,r){var d=$.grep(a,(function(e){return e.CodigoPai==r.CodigoBotao})),s=$("<li></li>").addClass(d.length>0?"has":""),l=$("<a title='"+r.Valor+"' name='btn_"+r.Nome+"' VisivelComRegistro='"+r.VisivelComRegistro+"'></a>");t===n-1&&null!=o&&l.addClass("noBorderB"),l.appendTo(s),$("<i class='"+r.Icone+"'></i>").appendTo(l),$("<span>"+r.Valor+"</span>").appendTo(l),d.length>0&&$("<ul></ul>").css("display","none").appendTo(s).append(e.MontaBotoes(d,r.CodigoBotao)),i.append(s)})),$(i.html())},this.MontaCampos=function(e,a,o,i,t){var n="";e=100*parseInt(e);var r=function(){return o&&o.hasOwnProperty(a.Id)&&o[a.Id]?o[a.Id]:a.ValorPadrao?a.ValorPadrao:""};if(a.Visivel)switch(a.TipoCampo.toLowerCase()){case"texto":0!=a.LabelLargura&&null!=a.LabelLargura&&(n='<div class="grid'+(i?4:a.LabelLargura)+'"><label for="'+a.Id+'">'+a.Label+"</label></div>"),0!=a.CampoLargura&&null!=a.LabelLargura&&(n+='<div class="grid'+(i?8:a.CampoLargura)+'"><input class="align'+("auto"!=a.Alinhamento?a.Alinhamento:"left")+'" type="text" name="'+a.Id+'" id="'+a.Id+'"  value="'+r()+'" tabindex="'+(e+parseInt(a.Ordem))+'" '+(a.Obrigatorio?"required":"")+"  ",a.Leitura&&(n+=' readonly="readonly" disabled="disabled" style="background-color: var(--geeks-lightGray);" '),n+="></div>");break;case"email":0!=a.LabelLargura&&null!=a.LabelLargura&&(n='<div class="grid'+a.LabelLargura+'"><label for="'+a.Id+'">'+a.Label+"</label></div>"),0!=a.CampoLargura&&null!=a.LabelLargura&&(n+='<div class="grid'+(i?8:a.CampoLargura)+'"><input class="align'+("auto"!=a.Alinhamento?a.Alinhamento:"left")+' inputEmail" type="text" value="'+r()+'"  id="'+a.Id+'" '+(a.Obrigatorio?"required":"")+' class="validate[required,custom[email]]" name="'+a.Id+'" tabindex="'+(e+parseInt(a.Ordem))+'"  ',a.Leitura&&(n+=' readonly="readonly" disabled="disabled" style="background-color: var(--geeks-lightGray);" '),n+="></div>");break;case"valor":0!=a.LabelLargura&&null!=a.LabelLargura&&(n='<div class="grid'+(i?4:a.LabelLargura)+'"><label for="'+a.Id+'">'+a.Label+"</label></div>"),0!=a.CampoLargura&&null!=a.LabelLargura&&(n+='<div class="grid'+(i?8:a.CampoLargura)+'"><input class="align'+("auto"!=a.Alinhamento?a.Alinhamento:"right")+' inputMoeda" type="text" value="'+r()+'" name="'+a.Id+'"  id="'+a.Id+'" '+(a.Obrigatorio?"required":"")+' tabindex="'+(e+parseInt(a.Ordem))+'"  ',a.Leitura&&(n+=' readonly="readonly" disabled="disabled" style="background-color: var(--geeks-lightGray);" '),n+="></div>");break;case"valor4":0!=a.LabelLargura&&null!=a.LabelLargura&&(n='<div class="grid'+(i?4:a.LabelLargura)+'"><label for="'+a.Id+'">'+a.Label+"</label></div>"),0!=a.CampoLargura&&null!=a.LabelLargura&&(n+='<div class="grid'+(i?8:a.CampoLargura)+'"><input class="align'+("auto"!=a.Alinhamento?a.Alinhamento:"right")+' inputValor4" type="text" value="'+r()+'" name="'+a.Id+'"  id="'+a.Id+'" '+(a.Obrigatorio?"required":"")+' tabindex="'+(e+parseInt(a.Ordem))+'"  ',a.Leitura&&(n+=' readonly="readonly" disabled="disabled" style="background-color: var(--geeks-lightGray);" '),n+="></div>");break;case"numero":0!=a.LabelLargura&&null!=a.LabelLargura&&(n='<div class="grid'+(i?4:a.LabelLargura)+'"><label for="'+a.Id+'">'+a.Label+"</label></div>"),0!=a.CampoLargura&&null!=a.LabelLargura&&(n+='<div class="grid'+(i?8:a.CampoLargura)+'"><input class="align'+("auto"!=a.Alinhamento?a.Alinhamento:"right")+' inputNumero" type="text" name="'+a.Id+'"  id="'+a.Id+'" value="'+r()+'" tabindex="'+(e+parseInt(a.Ordem))+'" '+(a.Obrigatorio?"required":""),a.Leitura&&(n+=' readonly="readonly" disabled="disabled" style="background-color: var(--geeks-lightGray);" '),n+="></div>");break;case"data":0!=a.LabelLargura&&null!=a.LabelLargura&&(n='<div class="grid'+(i?4:a.LabelLargura)+'"><label for="'+a.Id+'">'+a.Label+"</label></div>"),0!=a.CampoLargura&&null!=a.LabelLargura&&(n+='<div class="grid'+(i?8:a.CampoLargura)+'"><input type="text" name="'+a.Id+'" '+(a.Obrigatorio?"required":"")+' maxlength="10"  value="'+(r()?kendo.toString(r(),"dd/MM/yyyy"):"")+'" tabindex="'+(e+parseInt(a.Ordem))+'" ',a.Leitura?n+=' readonly="readonly" disabled="disabled" style="background-color: var(--geeks-lightGray);" ':n+=' class="datepicker"',n+="></div>");break;case"datahora":0!=a.LabelLargura&&null!=a.LabelLargura&&(n='<div class="grid'+(i?4:a.LabelLargura)+'"><label for="d_'+a.Id+'">'+a.Label+"</label></div>"),0!=a.CampoLargura&&null!=a.LabelLargura&&(n+='<div class="grid'+(i?8:a.CampoLargura)+'"><div style="float:left; width: 48%"><input type="text"  name="d_'+a.Id+'" maxlength="10"  value="'+(r()?kendo.toString(r(),"dd/MM/yyyy"):"")+'" tabindex="'+(e+parseInt(a.Ordem))+'" '+(a.Obrigatorio?"required":"")+' onchange="SetaValorDataHora(this);" ',a.Leitura?n+=' readonly="readonly" disabled="disabled" style="background-color: var(--geeks-lightGray); width: 100% !important;"  ':n+=' class="datepicker" style="width: 100% !important;"',n+="></div>",n+='<div style="float:right;  width: 48%;"><input type="text" '+(a.Obrigatorio?"required":"")+' name="t_'+a.Id+'" value="'+(r()?kendo.toString(r(),"HH:mm:ss"):"")+'" tabindex="'+(e+parseInt(a.Ordem))+'" onchange="SetaValorDataHora(this);" ',a.Leitura?n+=' readonly="readonly" disabled="disabled" style="background-color: var(--geeks-lightGray); width: 100% !important;"  ':n+=' class="timepicker" style="width: 100% !important;"',n+='></div><input type="hidden" name="'+a.Id+'" value="'+(r()?kendo.toString(r(),"dd/MM/yyyy HH:mm:ss"):"")+'"/></div>');break;case"selecao":if(0!=a.LabelLargura&&null!=a.LabelLargura&&(n='<div class="grid'+(i?4:a.LabelLargura)+'">',n+=' <label for="'+a.Id+a.CodigoCampo+'">'+a.Label+"</label>",n+="</div>"),0!=a.CampoLargura&&null!=a.LabelLargura){if(n+='<div class="grid'+(i?8:a.CampoLargura)+'">',n+='    <select data-placeholder="Selecione uma opção" name="'+a.Id+a.CodigoCampo+'" tabindex="'+(e+parseInt(a.Ordem))+'"  id="'+a.Id+a.CodigoCampo+'" '+(a.Obrigatorio?"required=false":"required=true"),a.Leitura&&(n+=' disabled="disabled" '),n+=' class="select ">',null!=a.SentencaSQL||""!=a.SentencaSQL){var d=(a.SentencaSQL?a.SentencaSQL:"").split("\n");$.each(d,(function(e,a){n+='        <option value="'+a.split("=")[0]+'" '+(r()==a.split("=")[0]?"selected":"")+">"+a.split("=")[1]+"</option>"}))}n+="    </select>",n+="</div>"}break;case"prompt":0!=a.LabelLargura&&null!=a.LabelLargura&&(n='<div class="grid'+(i?4:a.LabelLargura)+'">',n+='    <label for="'+a.CampoForeignKeyPrompt+'">'+a.Label+"</label>",n+="</div>"),0!=a.CampoLargura&&null!=a.LabelLargura&&(n+='<div class="grid'+(i?8:a.CampoLargura)+'">',n+='   <input type="text" data="prompt"  tabindex="'+(e+parseInt(a.Ordem))+'" ',a.Leitura&&(n+=' readonly="readonly" disabled="disabled" style="background-color: var(--geeks-lightGray);" '),n+=' id="'+(a.CampoForeignKeyPrompt?a.CampoForeignKeyPrompt:a.Id)+'"  name="promptDisplay_'+(a.CampoForeignKeyPrompt?a.CampoForeignKeyPrompt:a.Id)+'"  '+(a.Obrigatorio?"required":"")+' value="'+r()+'" '+(a.Leitura||a.CampoForeignKeyPrompt?"":"onchange=\"SetaValorPrompt(this, '"+a.Id+"');\"")+'><input type="hidden" name="'+(a.CampoForeignKeyPrompt?a.CampoForeignKeyPrompt:a.Id)+'" value="'+(a.CampoForeignKeyPrompt?o&&o.hasOwnProperty(a.CampoForeignKeyPrompt)&&o[a.CampoForeignKeyPrompt]?o[a.CampoForeignKeyPrompt]:a.ValorPadrao?a.ValorPadrao:"":r())+'"/>',n+='   <img src="Content/Plugins/Aquincum/images/icons/usual/icon-create2.png" id="img_'+a.CodigoCampo+'" alt="Clicar" class="fieldIcon" style="cursor: pointer;"  > ',n+="</div>");break;case"checagem":0!=a.LabelLargura&&null!=a.LabelLargura&&(n='<div class="grid'+(i?4:a.LabelLargura)+'"><label for="'+a.Id+'">'+a.Label+"</label></div>"),0!=a.CampoLargura&&null!=a.LabelLargura&&(n+='<div class="grid'+(i?8:a.CampoLargura)+'"><input type="checkbox" class="check" name="'+a.Id+'"  id="'+a.Id+'" '+("1"==r()||1==r()||"true"==r()?"checked":"")+' tabindex="'+(e+parseInt(a.Ordem))+'" '+(a.Obrigatorio?"required":"")+" ",a.Leitura&&(n+=' readonly="readonly" disabled="disabled" '),n+="></div>");break;case"textolongo":0!=a.LabelLargura&&null!=a.LabelLargura&&(n='<div class="grid'+(i?4:a.LabelLargura)+'">',n+='    <label for="'+a.Id+'">'+a.Label+"</label>",n+="</div>"),0!=a.CampoLargura&&null!=a.LabelLargura&&(n+='<div class="grid'+(i?8:a.CampoLargura)+'">',n+='   <textarea name="'+a.Id+'" id="'+a.Id+'" '+(a.Obrigatorio?"required":"")+" rows='1'  tabindex=\""+(e+parseInt(a.Ordem))+'" ',a.Leitura?n+=' readonly="readonly" disabled="disabled" style="padding-right: 20px; background-color: var(--geeks-lightGray); overflow-x: hidden;"></textarea>':n+="style='padding-right: 20px; overflow-x: hidden;'></textarea>",n+='   <img src="Content/Plugins/Aquincum/images/icons/usual/icon-books2.png" alt="Clicar" class="fieldIcon" style="cursor: pointer; right: 15px;"  > ',n+="</div>");break;case"editorhtml":0!=a.LabelLargura&&null!=a.LabelLargura&&(n='<div class="grid'+(i?4:a.LabelLargura)+'">',n+='    <label for="'+a.Id+'">'+a.Label+"</label>",n+="</div>"),0!=a.CampoLargura&&null!=a.LabelLargura&&(n+='<div class="grid'+(i?8:a.CampoLargura)+'">',n+='   <input type="text" name="'+a.Id+'" id="'+a.Id+'" '+(a.Obrigatorio?"required":"")+" value=''  tabindex=\""+(e+parseInt(a.Ordem))+'" ',a.Leitura&&(n+=' readonly="readonly" disabled="disabled" style="background-color: var(--geeks-lightGray);" '),n+="> ",n+='   <img src="Content/Plugins/Aquincum/images/icons/usual/icon-books2.png" alt="Clicar" class="fieldIcon" style="cursor: pointer;"  > ',n+="</div>");break;case"senha":0!=a.LabelLargura&&null!=a.LabelLargura&&(n='<div class="grid'+(i?4:a.LabelLargura)+'"><label for="'+a.Id+'">'+a.Label+"</label></div>"),0!=a.CampoLargura&&null!=a.LabelLargura&&(n+='<div class="grid'+(i?8:a.CampoLargura)+'"><input type="password" name="'+a.Id+'"  id="'+a.Id+'" '+(a.Obrigatorio?"required":"")+' value="'+r()+'" tabindex="'+(e+parseInt(a.Ordem))+'" ></div>');break;case"arquivo":0!=a.LabelLargura&&null!=a.LabelLargura&&(n='<div class="grid'+(i?4:a.LabelLargura)+'"><label for="name_'+a.Id+'">'+a.Label+"</label></div>"),0!=a.CampoLargura&&null!=a.LabelLargura&&(n+='<div class="grid'+(i?8:a.CampoLargura)+'"><input type="file" class="fileInput" name="file_'+a.Id+'"  id="file_'+a.Id+'"  tabindex="'+(e+parseInt(a.Ordem))+'" style="opacity: 0;" ',a.Leitura&&(n+=' readonly="readonly" disabled="disabled" style="background-color: var(--geeks-lightGray);" '),n+=">",n+='<div style="display: '+(""==r()?"none":"table-cell")+';"><input type="hidden" name="'+a.Id+'" value="'+r()+'"/><table style="margin-left: 10px"><tr><td style="vertical-align: middle;"><a name= "view_'+a.Id+'" href="" target="_blank" title="Download"><i class="icos-cloud-download"></i></a></td><td style="vertical-align: middle;"><a name= "delete_'+a.Id+'" title="Remover"><i class="k-icon k-delete" style="width: 14px; height: 14px;"></i></a></td></tr></table></div>',n+="</div>");break;default:n=""}else n='<input type="hidden" name="'+a.Id+'" value="'+r()+'"/>';var s=$(n);return"prompt"==a.TipoCampo.toLowerCase()?(s.find("input[type=hidden]").data("GeeksForm",{SentencaSQL:a.SentencaSQL}),s.find("img").click((function(){if(!$(this).parents("[ref=contentBody]").data("GeeksForm").TelaDesabilitada){if(!$(this).siblings("input[type=hidden]").data("GeeksForm")||!$(this).siblings("input[type=hidden]").data("GeeksForm").SentencaSQL)return void jError("Não existe uma sentença configurada para o prompt!","Atenção");var e=new Geeks.ERP.Prompt(this,"",$(this).siblings("input[type=hidden]").data("GeeksForm").SentencaSQL,t);e.Configuracao(1,"Código",50,1),e.Configuracao(2,"Descrição",250,0),e.Show()}}))):"textolongo"==a.TipoCampo.toLowerCase()?(s.find("textarea").val(r()),s.find("img").click((function(){$(this).parents("[ref=contentBody]").data("GeeksForm").TelaDesabilitada||new Geeks.ERP.PromptTexto(this,a).Show($(this).siblings("textarea").val())}))):"editorhtml"==a.TipoCampo.toLowerCase()?(s.find("input").val(r()),s.find("img").click((function(){$(this).parents("[ref=contentBody]").data("GeeksForm").TelaDesabilitada||new Geeks.ERP.PromptHtml(this,a).Show($(this).siblings("input").val())}))):"arquivo"==a.TipoCampo.toLowerCase()&&(s.find("input[name=file_"+a.Id+"]").change((function(){var e,o,i=new FileReader;i.onload=(e=this.files[0],o=e,function(e){s.find("input[name="+a.Id+"]").val(e.target.result+"#$#"+o.name+"#$#"+o.type)}),i.readAsDataURL(this.files[0])})),s.find("a[name=delete_"+a.Id+"]").click((function(){s.find("input[name="+a.Id+"]").val("")})),s.find("input[name="+a.Id+"]").change((function(){if($(this).parent().siblings("div").find("span.filename").html("Selecione ou arraste um arquivo aqui"),$(this).parent().siblings("div").find("span.action").html("Selecione um arquivo"),$(this).siblings().find("a[name=view_"+a.Id+"]").removeAttr("download"),$(this).siblings().find("a[name=view_"+a.Id+"]").removeAttr("href"),$(this).parent().css("display","none"),this.value){$(this).parent().css("display","table-cell");var e=s.find("input[name="+a.Id+"]").val().split("#$#");$(this).parent().siblings("div").find("span.filename").html(e[1]),$(this).siblings().find("a[name=view_"+a.Id+"]").attr("download",e[1]),$(this).siblings().find("a[name=view_"+a.Id+"]").attr("href",e[0])}}))),$(s).find("[name="+a.Id+"]").data("FieldData",a),s},this.FormataCampos=function(e){e.find(".opened").on("collapsiblecreate",(function(){$(this).unbind()})),e.find(".opened").collapsible({defaultOpen:"opened",cssOpen:"inactive",cssClose:"normal",speed:200}),e.find(".closed").on("collapsiblecreate",(function(){$(this).unbind()})),e.find(".closed").collapsible({defaultOpen:"",cssOpen:"inactive",cssClose:"normal",speed:200}),$.each(e.find(".opened"),(function(a,o){e.find(o).next().show()})),e.find(".datepicker").unbind().datepicker({showOtherMonths:!0,changeMonth:!0,changeYear:!0,autoSize:!0,dateFormat:"dd/mm/yy",weekHeader:"Semana",dayNames:["Domingo","Segunda","Terça","Quarta","Quinta","Sexta","Sábado"],dayNamesMin:["D","S","T","Q","Q","S","S","D"],dayNamesShort:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb","Dom"],monthNames:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],monthNamesShort:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],nextText:"Próximo",prevText:"Anterior"}),e.find(".check, .check :checkbox, input:radio, input:file").uniform(),e.find(".check, .check :checkbox, input:radio, input:file").parent().siblings("div").find("input:hidden").change(),e.find(".editor").cleditor({width:"100%",height:"250px",bodyStyle:"margin: 10px; font: 12px Arial,Verdana; cursor:text",useCSS:!0}),e.find("#resize, #resize2").colResizable({liveDrag:!0,draggingClass:"dragging"}),e.find(".select").chosen(),e.find(".select").siblings().css("width","100%"),$.fn.contentTabs=function(){e.find(".tab_content").hide(),e.find("ul.tabs li:first").addClass("activeTab").show(),e.find(".tab_content:first").show(),e.find("ul.tabs li").click((function(){$(this).parent().parent().find("ul.tabs li").removeClass("activeTab"),$(this).addClass("activeTab"),$(this).parent().parent().find(".tab_content").hide();var e=$(this).find("a").attr("href");return $(e).show(),!1}))},e.find("div[class^='widget']").contentTabs(),e.find(".formRow").find("input[type=hidden]").each((function(){$(this).siblings().length<=1&&$(this).parent().css("display","none")}));var a=Math.max.apply(null,$.map($("body > *"),(function(e,a){if("absolute"==$(e).css("position"))return parseInt($(e).css("z-index"))||1})))+99999;e.find("[name][type!=checkbox]:tabbable:visible").each((function(){$(this).attr("tabindex",a++)})),e.find("[name][type!=checkbox]:tabbable:visible:last").keydown((function(a){"9"==(a.keyCode||a.which)&&(e.find("[name]:tabbable:visible:first").focus(),event.preventDefault())})),e.find(".inputMoeda").autoNumeric("init",{aSep:".",aDec:",",wEmpty:"zero",vMin:"-999999999.99"}),e.find(".inputMoeda").focusin((function(){"0,00"==$(this).val()&&$(this).val("0")})),e.find(".inputValor4").autoNumeric("init",{aSep:".",aDec:",",wEmpty:"zero",vMin:"-999999999.99",mDec:"4"}),e.find(".inputValor4").focusin((function(){"0,0000"==$(this).val()&&$(this).val("0")})),e.find(".inputNumero").numeric(","),e.find(".datepicker").mask("99/99/9999"),e.find(".timepicker").mask("99:99:99"),$.uniform.update()},this.integracao=function(e,a){if(a[0].id.indexOf("popup")<0)if("PadraoNovo_Contatos"==e){var o=localStorage.getItem("codigoContato"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema),i=localStorage.getItem("nomeContato"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema);null!=o&&"null"!=o&&a.find("input[name=CodigoContato]")&&""==a.find("input[name=CodigoContato]").val()?($.jGrowl("Contato "+i+" selecionado."),$.AtualizaContato(o)):null!=o&&"null"!=o&&a.find("input[name=CodigoContato]")&&a.find("input[name=CodigoContato]").val()!=o?(i=localStorage.getItem("nomeContato"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema),jConfirm("Deseja trocar para o Contato "+i+"?","Mudar?",(function(e){e&&($.jGrowl("Contato "+i+" selecionado."),$.AtualizaContato(o))}))):a.find("input[name=CodigoContato]")&&""==a.find("input[name=CodigoContato]").val()&&a.find("a[name=btn_Pesquisar]").click()}else if("PadraoNovo_Item"==e){var t=localStorage.getItem("codigoItem"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema),n=localStorage.getItem("nomeItem"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema);null!=t&&"null"!=t&&a.find("input[name=CodigoItem]")&&""==a.find("input[name=CodigoItem]").val()?(a.find("input[name=CodigoItem]").val()!=t&&$.jGrowl("Item "+n+" selecionado."),$.AtualizaItem(t)):null!=t&&"null"!=t&&a.find("input[name=CodigoItem]")&&a.find("input[name=CodigoItem]").val()!=t?(n=localStorage.getItem("nomeItem"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema),jConfirm("Deseja trocar para o Item "+n+"?","Mudar?",(function(e){e&&($.jGrowl("Item "+n+" selecionado."),$.AtualizaItem(t))}))):a.find("input[name=CodigoItem]")&&""==a.find("input[name=CodigoItem]").val()&&a.find("a[name=btn_Pesquisar]").click()}else if("PadraoNovo_Vendas_Industria"==e||"PadraoNovo_Vendas_Varejo"==e||"PadraoNovo_Vendas_Distribuidor"==e||"PadraoNovo_Vendas_Revenda"==e||"OptiSoul_Vendas"==e)if(null!=(o=localStorage.getItem("codigoContato"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema))&&"null"!=o){i=localStorage.getItem("nomeContato"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema);var r=JSON.parse(localStorage.getItem("dadosUsuario")),d="";d="PadraoNovo_Vendas_Varejo"==e?" Select top 1 CodigoDocumento from Documento where Tipo='Venda' and DataHoraEmissao < getDate() and CodigoContato = 0"+o+" and CodigoContatoDigitador = (select CodigoContato from Contato where CodigoUsuario = '"+r.CodigoUsuario+"') order by CodigoDocumento desc":" Select top 1 CodigoDocumento from Documento where Tipo='Venda' and DataHoraEmissao < getDate() and CodigoContato = 0"+o+" order by CodigoDocumento desc",null!=(s=Geeks.ERP.Core.Connection.ExecuteSQL(d))&&s.Records.length>0?a.find("[name=CodigoDocumento]")&&""==a.find("[name=CodigoDocumento]").val()?($.jGrowl("Pedido "+s.Records[0].CodigoDocumento+" selecionado."),$.AtualizaVenda(s.Records[0].CodigoDocumento)):a.find("[name=CodigoContato]")&&a.find("[name=CodigoContato]").val()!=o&&jConfirm("Deseja abrir o último pedido do Contato "+i+"?","Mudar?",(function(e){e&&($.jGrowl("Pedido "+s.Records[0].CodigoDocumento+" selecionado."),$.AtualizaVenda(s.Records[0].CodigoDocumento))})):(d="Select CodigoContato from Contato where CodigoUsuario = 0"+r.CodigoUsuario,s=Geeks.ERP.Core.Connection.ExecuteSQL(d),o=null,null!=s&&null!=s.Records&&s.Records.length>0&&(o=s.Records[0].CodigoContato),(a.find("[name=CodigoDocumento]")&&""==a.find("[name=CodigoDocumento]").val()||null==a.find("[name=CodigoDocumento]"))&&null!=o&&a.find("a[name=btn_Incluir]").click())}else"PadraoNovo_Vendas_Varejo"!=e&&a.find("a[name=btn_Incluir]").click();else if("PadraoNovo_Compras_NFEntrada"==e)if("true"==localStorage.getItem("origemHistoricoItem"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema))localStorage.setItem("origemHistoricoItem"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema,"false");else if(null!=(o=localStorage.getItem("codigoContato"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema))&&"null"!=o){var s;i=localStorage.getItem("nomeContato"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema),null!=(s=Geeks.ERP.Core.Connection.ExecuteSQL(" Select top 1 CodigoDocumento from Documento where Tipo='Compra' and DataHoraEmissao < getDate() and CodigoContato = 0"+o+"order by CodigoDocumento desc"))&&s.Records.length>0?a.find("[name=CodigoDocumento]")&&""==a.find("[name=CodigoDocumento]").val()?($.jGrowl("Pedido "+s.Records[0].CodigoDocumento+" selecionado."),$.AtualizaCompra(s.Records[0].CodigoDocumento)):a.find("[name=CodigoContato]")&&a.find("[name=CodigoContato]").val()!=o&&jConfirm("Deseja abrir o último pedido do Contato "+i+"?","Mudar?",(function(e){e&&($.jGrowl("Pedido "+s.Records[0].CodigoDocumento+" selecionado."),$.AtualizaCompra(s.Records[0].CodigoDocumento))})):(a.find("[name=CodigoDocumento]")&&""==a.find("[name=CodigoDocumento]").val()||null==a.find("[name=CodigoDocumento]"))&&a.find("a[name=btn_Incluir]").click()}else a.find("a[name=btn_Incluir]").click();else if("PadraoNovo_Estoque"==e)t=localStorage.getItem("codigoItem"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema),n=localStorage.getItem("nomeItem"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema),null!=t&&"null"!=t&&a.find("input[name=Item]")&&""==a.find("input[name=Item]").val()?(a.find("input[name=Item]").val(t),a.find("input[name=promptDisplay_Item]").val(n),a.find("a[name=btn_Pesquisa]").click()):null!=t&&"null"!=t&&a.find("input[name=Item]")&&a.find("input[name=Item]").val()!=t?(n=localStorage.getItem("nomeItem"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema),jConfirm("Deseja trocar para o Item "+n+"?","Mudar?",(function(e){e&&(a.find("input[name=Item]").val(t),a.find("input[name=promptDisplay_Item]").val(n),a.find("a[name=btn_Pesquisa]").click())}))):a.find("input[name=Item]")&&""!=a.find("input[name=Item]").val()&&a.find("a[name=btn_Pesquisa]").click();else if("PadraoNovo_Estoque_Kardex"==e)if(t=localStorage.getItem("codigoItem"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema),n=localStorage.getItem("nomeItem"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema),null!=t&&"null"!=t&&"undefined"!=t&&a.find("input[name=Produto]")&&""==a.find("input[name=Produto]").val()){a.find("[name=Produto]").val(t),a.find("[name=promptDisplay_Produto]").val(n),a.find("[name=CodigoItem]").val(t),a.find("a[name=btn_Pesquisa]").click();var l="select distinct Case When LoteEmpresa is Null Then 'Nenhum' else LoteEmpresa End as LoteEmpresa from Kardex where CodigoItem = 0"+s.Codigo+" order by LoteEmpresa",c=Geeks.ERP.Core.Connection.ExecuteSQL(l);if(null!=c&&c.Records.length>0){a.find("[name=Lote]").empty(),a.find("[name=Lote]").append($("<option value=''>-- Selecione --</option>"));for(var u=0;u<c.Records.length;u++)a.find("[name=Lote]").append($("<option value='"+c.Records[u].LoteEmpresa+"'>"+c.Records[u].LoteEmpresa+"</option>"));a.find("[name=Lote]").val(""),a.find("[name=Lote]").trigger("liszt:updated")}}else null!=t&&"null"!=t&&"undefined"!=t&&a.find("input[name=Produto]")&&a.find("input[name=Produto]").val()!=t&&(n=localStorage.getItem("nomeItem"+$("#hfCodigoSistema").data("GeeksData").CodigoClienteSistema),jConfirm("Deseja trocar para o Item "+n+"?","Mudar?",(function(e){if(e){a.find("[name=Produto]").val(t),a.find("[name=promptDisplay_Produto]").val(n),a.find("[name=CodigoItem]").val(t),a.find("a[name=btn_Pesquisa]").click();var o="select distinct Case When LoteEmpresa is Null Then 'Nenhum' else LoteEmpresa End as LoteEmpresa from Kardex where CodigoItem = 0"+s.Codigo+" order by LoteEmpresa",i=Geeks.ERP.Core.Connection.ExecuteSQL(o);if(null!=i&&i.Records.length>0){a.find("[name=Lote]").empty(),a.find("[name=Lote]").append($("<option value=''>-- Selecione --</option>"));for(var r=0;r<i.Records.length;r++)a.find("[name=Lote]").append($("<option value='"+i.Records[r].LoteEmpresa+"'>"+i.Records[r].LoteEmpresa+"</option>"));a.find("[name=Lote]").val(""),a.find("[name=Lote]").trigger("liszt:updated")}}})))}};