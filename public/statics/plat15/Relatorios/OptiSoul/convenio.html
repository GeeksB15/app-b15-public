<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>Convênio</title>
        <link rel="stylesheet" type="text/css" href="optidados.framework.css"/>
        <script src="/Scripts/jquery-2.1.4.js"></script>
        <script src="/Restricted/Geeks.ERP.BasicReport.js"></script>
        <script src="/Scripts/codigobarras.js"></script>
        <script src="/Plugins/html2canvas.js"></script>

        <style type="text/css">
            h6, p {
                white-space: nowrap;
            }

            .picote-cred-conv {
                position: relative;
                float: left;
                padding-top: 0.5cm;
                padding-bottom: 0.5cm;
                border-top: 1px dashed rgb(25,25,25);
                border-bottom: 1px dashed rgb(25,25,25);
            }
        
            .botao-apagar-parte {
                position: relative;
                float: left;
                background-color: #E64949;
                box-shadow: 2px 2px 2px grey;
                padding: 10px;
                border-radius: 5px;
                color: #FFF;
                width: 200px;
                height: 20px;
                margin-top: 4px;
                margin-bottom: 25px;
                text-align: center;
                transition: 350ms;
                -webkit-transition: 350ms;
                cursor: pointer;
            }

            .botao-apagar-parte:hover {
                background-color: #5BBDBC;
            }
        </style>

        <style type="text/css" media="print">
            .botao-apagar-parte { 
                display: none;
            }
        </style>

        <script id="TemplateItensVenda" type="TemplateItensVenda">
            <div class="row w100" id="DelPrint_ItensVenda">
                <!--dados loja-->
                <div class="row w100 lineb">
                    <!--logo da loja-->
                    <div class="col w25">
                        <div class="logo">
                            <img class="img-responsive" src="optsoul-exemplo.png"/>
                        </div>
                    </div>

                    <div class="col w50">
                        <h6 class="lineb"> [fantasiaEmissor] </h6>
                        <h6> [enderecoEmissor] </h6>
                        <h6> [telefoneEmissor] </h6>
                        <h6> [siteEmissor] </h6>
                        <h6> [emailEmissor] </h6>
                    </div>

                    <!--codigo de barras-->
                    <div class="col w25">
                        <h6 class="txt-ac" id="codBarras"></h6>
                        <h6 class="b txt-ac" id="codFatura"></h6>
                    </div>
                </div>

                <!--dados cliente-->
                <div class="row w100">
                    <!--dados clietne-->
                    <div class="col w70">
                        <h6> Empresa: <span>[nomeEmpresa]</span> </h6>
                        <h6> #<span>[codgoTitular]</span> <span>[nomeTitular]</span> </h6>
                        <h6> [enderecoTitular] </h6>
                        <h6> [telefoneTitular] </h6>
                    </div>

                    <!--data-->
                    <div class="col w30 txt-ar">
                        <h6>Venda: <span>[DataHoraVenda]</span> </h6>
                        <h6>Faturado: <span>[faturado]</span> </h6>
                        <h6>Impresso: <span>[impresso]</span> </h6>
                    </div>
                </div>

                <!--bloco produtos-->
                <div class="row w100">
                    <h6 class="b txt-ac lineb pb01 mb03">Produtos</h6>

                    <!--Produtos Cabeçalho-->
                    <div class="col w15">
                        <h6 class="b">Código de Barras</h6>
                    </div>

                    <div class="col w15">
                        <h6 class="b">Marca</h6>
                    </div>

                    <div class="col w50">
                        <h6 class="b">Descrição</h6>
                    </div>

                    <div class="col w10">
                        <h6 class="b txt-ac">Qtd</h6>
                    </div>

                    <div class="col w10">
                        <h6 class="b txt-ac">Preço (R$)</h6>
                    </div>

                    <!--Produtos Descrição-->
                    <div id="itensVendaProdutos"></div>

                    <!--Totalizadores-->
                    <div id="itensVendaTotalizadores"></div>
                </div>
                
                <!--Não quero Imprimir isso-->
                <div class="botao-apagar-parte" id="btItensVenda">Não quero imprimir isso! ⤴</div>
            </div>
        </script>

        <script id="TemplateItensVendaProdutos" type="TemplateItensVendaProdutos">
            <div class="col w15">
                <p>[Barra]</p>
            </div>

            <div class="col w15">
                <p>[Marca]</p>
            </div>

            <div class="col w50">
                <p>[Descricao]</p>
            </div>

            <div class="col w10">
                <p class="txt-ac">[Quantidade]</p>
            </div>

            <div class="col w10">
                <p class="txt-ar">[Unitario]</p>
            </div>
        </script>

        <script id="TemplateItensVendaTotalizadores" type="TemplateItensVendaTotalizadores">
            <div class="row w100 linet mt04 pt01">
                <!--sub-total-->
                <div class="col w80">
                    <h6 class="b">Sub-Total:</h6>
                </div>
                <div class="col w10">
                    <h6 class="b txt-ac">[SUM_Qtd]</h6>
                </div>
                <div class="col w10">
                    <h6 class="b txt-ar">[SUM_SubTotal]</h6>
                </div>

                <!--desconto-->
                <div class="col w90 mt05">
                    <h6 class="b">Descontos</h6>
                </div>
                <div class="col w10 mt05">
                    <h6 class="b txt-ar">[SUM_Descontos]</h6>
                </div>

                <!--valor final-->
                <div class="col w90 mt01">
                    <h6 class="b">Total</h6>
                </div>
                <div class="col w10 mt03">
                    <h6 class="b txt-ar">[SUM_TotalFinal]</h6>
                </div>
            </div>
        </script>

        <script type="TemplateConvenioParcelas" id="TemplateConvenioParcelas">
            <div class="row w100 picote-cred-conv" id="DelPrint_ConvenioParcelas">
                <div class="row w100 linef">
                    
                    <!--via cliente-->
                    <div class="col w53 liner pf02">
                        <div class="col w40">
                            <div class="logo">
                                <img class="img-responsive" src="optsoul-exemplo.png"/>
                            </div>
                        </div>

                        <div class="col w60">
                            <h6 class="lineb"> [fantasiaEmissor] </h6>
                            <h6> [enderecoEmissor] </h6>
                            <h6> [telefoneEmissor] </h6>
                            <h6> [siteEmissor] </h6>
                            <h6> [emailEmissor] </h6>
                        </div>

                        <div class="row w100 pt04 linet">
                            <h6>Empresa: <span>[nomeEmpresa]</span></h6>
                            <h6>Conveniado: <span>[nomeTitular]</span></h6>
                        </div>
                        
                        <div class="col w60">
                            <h6>Data Emissão: <span>[DataEmissao]</span></h6>
                            <h6>Venc. Parcela: <span>[DataVencimento]</span></h6>
                            <h6>Data Pgto.: <span>[DataPagamento]</span></h6>
                        </div>

                        <div class="col w40">
                            <h6>Nº Parcela: <span>[Parcela]</span></h6>
                            <H6>Valor Total Compra: <span>[ValorTotal]</span></H6>
                            <h6>Valor Parcela <span>[Valor]</span></h6>
                            <h6>Valor Parcela Pago: <span>[ValorPagamento]</span></h6>
                        </div>
                    </div>

                    <!--termo-->
                    <div class="col w45-8 pf02">
                        <h6 class="lineb pb01 mb03 txt-ac">Contrato</h6>
                        <h5>
                            Eu, <span class="b">[nomeTitular]</span>, residente em <span class="b">[enderecoTitular]</span>, portador do CPF: <span class="b">[CPFTitular]</span> e RG: <span class="b">[RGTitular]</span>, autorizo o desconto em folha de pagamento do meu salário em parcelas iguais e sucessivas ou, em caso de rescisão do contrato de trabalho, em uma só vez, da despesa acima expressa, realizada por mim e/ou por meu(s) dependente(s).
                        </h5>

                        <!--assinatura-->
                        <h6 class="w65 mt35 pt03 txt-ac linet float-r"> Assinatura </h6>
                    </div>

                </div>
            </div>
        </script>
    </head>

    <body>
        <!--container-->
        <div class="container">
            <div id="itensVenda"></div>
            <div id="ConvenioParcelas"></div>
        </div>
        <!--.end container-->

        <!--Script DB-->
        <script>
            //Não quero imprimir isso (Exlcui bloco)
            function apagar(id) {
                $("#" + id.replace("D", "")).remove();
                $("#" + id).remove();
            }

            $(document).ready(function(){
                //Codigo fatura
                var codigoDocumento = getParameterByName("CodigoDocumento");

                //Connect DB
                var banco = getParameterByName("BancoDeDados");
                var usuario = getParameterByName("CodigoUsuario");              
                var url = decodeURIComponent(getParameterByName("URLServidor"));

                //var codPrescricao = "";
                //var totalQuantidade = 0.00;
                
                $("#codFatura").html("Fatura: " +codigoDocumento);

                var oculto = getParameterByName("Oculto");

                //Dados da Loja 
                var dadosEmissor = GeeksSQL(
                    " SELECT"
                        +" IsNull(C.Nome, '') as Nome"
                        +" ,IsNull(C.[Site], '') as Site"
                        +" ,IsNull(C.Email, '') as Email"
                        +" ,IsNull(STUFF(("
                            +" SELECT ',  '+Ct.Telefone"
                            +" FROM ContatoTelefone Ct"
                            +" WHERE Ct.CodigoContato = C.CodigoContato"
                        +" FOR XML PATH('')), 1, 2, ''), '') as Telefone"
                        +" ,(IsNull(Ce.Logradouro+' ', '')+ IsNull(Ce.Numero+', ', '')+ IsNull(Ce.Complemento+', ', '')+ IsNull(Ce.Bairro+' - ', '')+ IsNull(Ce.Municipio+'/', '')+ IsNull(Ce.UF+' ', '')+ IsNull(Ce.CEP, '')) as Endereco"
                        +" ,IsNull(C.Imagem, 'Não informado') as Imagem"
                    +" FROM Contato C"
                        +" LEFT JOIN ContatoEndereco Ce ON(Ce.CodigoContato = C.CodigoContato) AND(Ce.Grupo = 'Principal')"
                    +" WHERE"
                        +" C.CodigoContato = (SELECT CodigoEmpresa FROM Documento WHERE CodigoDocumento ="+codigoDocumento+")"
                ,false ,url ,banco ,usuario);


                //Dados do Titular
                var dadosTitular = GeeksSQL(
                    " SELECT"
                        +" IsNull(C.CodigoContato, '') as CodigoContatoTitular"
                        +" ,IsNull(C.Nome, '') as NomeContatoTitular"
                        +" ,IsNull(C.NumeroDocumentoNacional, 'Não informado') as CPF"
                        +" ,IsNull(C.NumeroDocumentoEstadual, 'Não informado') as RG"
                        +" ,IsNull(Ce.Logradouro, '') as Logradouro"
                        +" ,IsNull(Ce.Numero, '') as Numero"
                        +" ,IsNull(Ce.Complemento, '') as Complemento"
                        +" ,IsNull(Ce.Bairro, '') as Bairro"
                        +" ,IsNull(Ce.Municipio, '') as Cidade"
                        +" ,IsNull(Ce.UF, '') as UF"
                        +" ,IsNull(Cemp.CodigoContato, '') as CodigoContatoEmpresa"
                        +" ,IsNull(Cemp.Nome, '') as NomeContatoEmpresa"
                        +" ,IsNull(STUFF(("
                            +" SELECT ',  '+Ct.Telefone"
                            +" FROM ContatoTelefone Ct"
                            +" WHERE Ct.CodigoContato = C.CodigoContato"
                        +" FOR XML PATH('')), 1, 2, ''), '') as TelefoneContato"
                        +" ,Convert(Varchar, Dfat.DataHoraFinalizado, 103)+' '+ Convert(Varchar, Dfat.DataHoraFinalizado, 108) as Faturado"
                        +" ,Convert(Varchar, getdate(), 103)+' '+ Convert(Varchar, getdate(), 108) as Impresso"
                    +" FROM Documento Dfat"
                        +" LEFT JOIN Contato C ON(C.CodigoContato = Dfat.CodigoContato)"
                        +" LEFT JOIN ContatoEndereco Ce ON(Ce.CodigoContato = C.CodigoContato)"
                        +" LEFT JOIN ContatoFilho Cf ON(Cf.CodigoContato = C.CodigoContato)"
                        +" LEFT JOIN Contato Cemp ON(Cemp.CodigoContato = Cf.CodigoContatoRelacionado)"
                        +" LEFT JOIN ContatoGrupo Cg ON(Cg.CodigoContato = Cemp.CodigoContato)"
                    +" WHERE"
                        +" Cg.Descricao = 'Convênio'"
                        +" AND Dfat.CodigoDocumento ="+codigoDocumento
                ,false ,url ,banco ,usuario);


                //Dados Parcelas
                var dadosParcelas = GeeksSQL(
                    "SELECT"
                        +" FT.CodigoFinanceiroTitulo,"
                        +" FT.Parcela,"
                        +" ISNULL(convert(varchar,FT.DataEmissao,103), '') as DataEmissao,"
                        +" ISNULL(convert(varchar,FT.DataVencimento,103), '') as DataVencimento,"
                        +" ISNULL(convert(varchar,FT.DataPagamento,103),'Em Aberto') as DataPagamento,"
                        +" FT.Valor,"
                        +" FTSum.ValorTotal,"
                        +" FT.ValorMulta+ValorJuros as ValorMultaJuros,"
                        +" FT.ValorDesconto,"
                        +" FTSum.ValorDescontoTotal,"
                        +" FT.ValorRealizado as ValorPagamento,"
                        +" FT.FormadePagamento"
                    +" FROM FinanceiroTitulo FT, (SELECT documentoCodigo, SUM(ValorTotal) as ValorTotal, SUM(ValorDesconto) as ValorDescontoTotal FROM FinanceiroTitulo WHERE FormadePagamento ='Convênio' AND documentoCodigo =0"+codigoDocumento+" GROUP BY documentoCodigo) as FTSum"
                    +" WHERE"
                        +" FT.documentoCodigo = FTSum.documentoCodigo"
                        +" AND FT.FormadePagamento = 'Convênio' AND FT.documentoCodigo =0"+codigoDocumento
                    +" ORDER BY FT.Parcela Desc"
                ,false ,url ,banco ,usuario);

                //Parcelas (For)
                if (dadosParcelas.RecordsAffected > 0)
                {
                    for (i = 0; i < dadosParcelas.RecordsAffected; i++)
                    {
                        $('#ConvenioParcelas').append(
                            $("#TemplateConvenioParcelas").html()
                                //Dados Emissor (Loja)
                                .replaceAll("[fantasiaEmissor]", ((dadosEmissor.Records[0].Nome != null && dadosEmissor.Records[0].Nome != "null") ? (dadosEmissor.Records[0].Nome) : ''))
                                .replaceAll("[emailEmissor]", ((dadosEmissor.Records[0].Email != null && dadosEmissor.Records[0].Email != "null") ? (dadosEmissor.Records[0].Email) : ''))
                                .replaceAll("[enderecoEmissor]", ((dadosEmissor.Records[0].Endereco != null && dadosEmissor.Records[0].Endereco != "null") ? (dadosEmissor.Records[0].Endereco) : ''))
                                .replaceAll("[siteEmissor]", ((dadosEmissor.Records[0].Site != null && dadosEmissor.Records[0].Site != "null") ? (dadosEmissor.Records[0].Site) : ''))
                                .replaceAll("[telefoneEmissor]", ((dadosEmissor.Records[0].Telefone != null && dadosEmissor.Records[0].Telefone != "null") ? (dadosEmissor.Records[0].Telefone) : ''))

                                //Dados Cliente (Titular)
                                .replaceAll("[nomeEmpresa]", ((dadosTitular.Records[0].NomeContatoEmpresa != null && dadosTitular.Records[0].NomeContatoEmpresa != "null") ? (dadosTitular.Records[0].NomeContatoEmpresa) : '') )
                                .replaceAll("[codgoTitular]", ((dadosTitular.Records[0].CodigoContatoTitular != null && dadosTitular.Records[0].CodigoContatoTitular != "null") ? (dadosTitular.Records[0].CodigoContatoTitular) : '') )
                                .replaceAll("[nomeTitular]", ((dadosTitular.Records[0].NomeContatoTitular != null && dadosTitular.Records[0].NomeContatoTitular != "null") ? (dadosTitular.Records[0].NomeContatoTitular) : '') )
                                .replaceAll("[CPFTitular]", ((dadosTitular.Records[0].CPF != null && dadosTitular.Records[0].CPF != "null") ? (dadosTitular.Records[0].CPF) : '') )
                                .replaceAll("[RGTitular]", ((dadosTitular.Records[0].RG != null && dadosTitular.Records[0].RG != "null") ? (dadosTitular.Records[0].RG) : '') )
                                .replaceAll("[enderecoTitular]", (((dadosTitular.Records[0].Logradouro != null && dadosTitular.Records[0].Logradouro != "null") ? (dadosTitular.Records[0].Logradouro) : '' ) +" "+ ((dadosTitular.Records[0].Numero != null && dadosTitular.Records[0].Numero != "null") ? (dadosTitular.Records[0].Numero) : '' ) +" - "+ ((dadosTitular.Records[0].Complemento != null && dadosTitular.Records[0].Complemento != "null") ? (dadosTitular.Records[0].Complemento) : '' ) +" "+ ((dadosTitular.Records[0].Bairro != null && dadosTitular.Records[0].Bairro != "null") ? (dadosTitular.Records[0].Bairro) : '' ) +" "+ ((dadosTitular.Records[0].Cidade != null && dadosTitular.Records[0].Cidade != "null") ? (dadosTitular.Records[0].Cidade) : '' ) +"/"+ ((dadosTitular.Records[0].UF != null && dadosTitular.Records[0].UF != "null") ? (dadosTitular.Records[0].UF) : '' )) )
                                .replaceAll("[telefoneTitular]", ((dadosTitular.Records[0].TelefoneContato != null && dadosTitular.Records[0].TelefoneContato != "null") ? (dadosTitular.Records[0].TelefoneContato) : '')  )
                                .replaceAll("[impresso]", ((dadosTitular.Records[0].Impresso != null && dadosTitular.Records[0].Impresso != "null") ? (dadosTitular.Records[0].Impresso) : '') )
                                .replaceAll("[faturado]", ((dadosTitular.Records[0].Faturado != null && dadosTitular.Records[0].Faturado != "null") ? (dadosTitular.Records[0].Faturado) : '') )

                                //Parcelas
                                .replaceAll("[Parcela]", dadosParcelas.Records[i].Parcela)
                                .replaceAll("[DataEmissao]", dadosParcelas.Records[i].DataEmissao)
                                .replaceAll("[DataVencimento]", dadosParcelas.Records[i].DataVencimento)
                                .replaceAll("[DataPagamento]", dadosParcelas.Records[i].DataPagamento)
                                .replaceAll("[Valor]", ((dadosParcelas.Records[i].Valor != null && dadosParcelas.Records[i].Valor != "null") ? (dadosParcelas.Records[i].Valor.toFixed(2).replace(".",",")) : '') )
                                .replaceAll("[ValorTotal]", ((dadosParcelas.Records[i].ValorTotal != null && dadosParcelas.Records[i].ValorTotal != "null") ? (dadosParcelas.Records[i].ValorTotal.toFixed(2).replace(".",",")) : '') )
                                .replaceAll("[ValorMultaJuros]", ((dadosParcelas.Records[i].ValorMultaJuros != null && dadosParcelas.Records[i].ValorMultaJuros != "null") ? (dadosParcelas.Records[i].ValorMultaJuros.toFixed(2).replace(".",",")) : '') )
                                .replaceAll("[ValorDesconto]",((dadosParcelas.Records[i].ValorDesconto != null && dadosParcelas.Records[i].ValorDesconto != "null") ? (dadosParcelas.Records[i].ValorDesconto.toFixed(2).replace(".",",")) : '') )
                                .replaceAll("[ValorPagamento]", ((dadosParcelas.Records[i].ValorPagamento != null && dadosParcelas.Records[i].ValorPagamento != "null") ? (dadosParcelas.Records[i].ValorPagamento.toFixed(2).replace(".",",")) : '') )

                                //Não quero imprimir isso
                                .replaceAll("DelPrint_ConvenioParcelas", "Linha"+i)
                        );

                        $("#ConvenioParcelas").append("<div class='botao-apagar-parte' id='DLinha"+ i +"' onclick='apagar(this.id)'>Não quero imprimir isso! ⤴</div>");
                    }             
                }

                //Dados Venda
                var dadosVenda = GeeksSQL(
                            "SELECT"
                                +" CodigoDocumento,"
                                +" convert(varchar,DataHoraFinalizado,103)+' '+convert(varchar,DataHoraFinalizado,108) as DataHoraVenda"
                            +" FROM Documento d"
                            +" WHERE CodigoFatura =0"+codigoDocumento , false, url, banco, usuario);

                //Dados Venda (Itens)
                if (dadosVenda.RecordsAffected > 0)
                {
                    //Variavel para totalizadores
                    var SUM_Qtd = 0;
                    var SUM_SubTotal = 0.00;

                    //Cabeçalho Dados Venda
                    $("#itensVenda").append(
                        $("#TemplateItensVenda").html()
                            //Dados Emissor (Loja)
                            .replaceAll("[fantasiaEmissor]", ((dadosEmissor.Records[0].Nome != null && dadosEmissor.Records[0].Nome != "null") ? (dadosEmissor.Records[0].Nome) : '') )
                            .replaceAll("[emailEmissor]", ((dadosEmissor.Records[0].Email != null && dadosEmissor.Records[0].Email != "null") ? (dadosEmissor.Records[0].Email) : '') )
                            .replaceAll("[enderecoEmissor]", ((dadosEmissor.Records[0].Endereco != null && dadosEmissor.Records[0].Endereco != "null") ? (dadosEmissor.Records[0].Endereco) : '') )
                            .replaceAll("[siteEmissor]", ((dadosEmissor.Records[0].Site != null && dadosEmissor.Records[0].Site != "null") ? (dadosEmissor.Records[0].Site) : '') )
                            .replaceAll("[telefoneEmissor]", ((dadosEmissor.Records[0].Telefone != null && dadosEmissor.Records[0].Telefone != "null") ? (dadosEmissor.Records[0].Telefone) : '') )

                            //Dados Cliente (Titular)
                            .replaceAll("[nomeEmpresa]", ((dadosTitular.Records[0].NomeContatoEmpresa != null && dadosTitular.Records[0].NomeContatoEmpresa != "null") ? (dadosTitular.Records[0].NomeContatoEmpresa) : '') )
                            .replaceAll("[codgoTitular]", ((dadosTitular.Records[0].CodigoContatoTitular != null && dadosTitular.Records[0].CodigoContatoTitular != "null") ? (dadosTitular.Records[0].CodigoContatoTitular) : '') )
                            .replaceAll("[nomeTitular]", ((dadosTitular.Records[0].NomeContatoTitular != null && dadosTitular.Records[0].NomeContatoTitular != "null") ? (dadosTitular.Records[0].NomeContatoTitular) : '') )
                            .replaceAll("[CPFTitular]", ((dadosTitular.Records[0].CPF != null && dadosTitular.Records[0].CPF != "null") ? (dadosTitular.Records[0].CPF) : '') )
                            .replaceAll("[RGTitular]", ((dadosTitular.Records[0].RG != null && dadosTitular.Records[0].RG != "null") ? (dadosTitular.Records[0].RG) : '') )
                            .replaceAll("[enderecoTitular]", (((dadosTitular.Records[0].Logradouro != null && dadosTitular.Records[0].Logradouro != "null") ? (dadosTitular.Records[0].Logradouro) : '') +" "+ ((dadosTitular.Records[0].Numero != null && dadosTitular.Records[0].Numero != "null") ? (dadosTitular.Records[0].Numero) : '') +" - "+ ((dadosTitular.Records[0].Complemento != null && dadosTitular.Records[0].Complemento != "null") ? (dadosTitular.Records[0].Complemento) : '') +" "+ ((dadosTitular.Records[0].Bairro != null && dadosTitular.Records[0].Bairro != "null") ? (dadosTitular.Records[0].Bairro) : '') +" "+ ((dadosTitular.Records[0].Cidade != null && dadosTitular.Records[0].Cidade != "null") ? (dadosTitular.Records[0].Cidade) : '') +"/"+ ((dadosTitular.Records[0].UF != null && dadosTitular.Records[0].UF != "null") ? (dadosTitular.Records[0].UF) : '')) )
                            .replaceAll("[telefoneTitular]", ((dadosTitular.Records[0].TelefoneContato != null && dadosTitular.Records[0].TelefoneContato != "null") ? (dadosTitular.Records[0].TelefoneContato) : '')  )
                            .replaceAll("[impresso]", ((dadosTitular.Records[0].Impresso != null && dadosTitular.Records[0].Impresso != "null") ? (dadosTitular.Records[0].Impresso) : '') )
                            .replaceAll("[faturado]", ((dadosTitular.Records[0].Faturado != null && dadosTitular.Records[0].Faturado != "null") ? (dadosTitular.Records[0].Faturado) : '') )

                            //Data e Hora da Venda
                            .replaceAll("[DataHoraVenda]", dadosVenda.Records[0].DataHoraVenda)
                    );

                    //Pegar todas as vendas de uma Fatura (For)
                    for (var i = 0; i < dadosVenda.RecordsAffected; i++) {

                        //Dados Itens
                        var dadosItens = GeeksSQL(
                                        " SELECT"
                                            +" IT.CodigoItem,"
                                            +" (Convert(varchar, DP.DataHoraFinalizado, 103)+' '+ Convert(varchar, DP.DataHoraFinalizado, 108)) as DataHoraVenda,"
                                            +" DP.DescricaoContato NomeBeneficiario,"
                                            +" ISNULL(IT.CodigoBarras,'N/A') CodigoBarras,"
                                            +" IT.Marca,"
                                            +" IT.DescricaoComercial,"
                                            +" DI.Quantidade,"
                                            +" It.ValorVenda as ValorVendaUnitario,"
                                            +" DI.DescontoSubTotal,"
                                            +" DI.Total"
                                        +" FROM DOCUMENTO DF"
                                            +" JOIN DOCUMENTO DP on (DP.CodigoDocumentoAdicional = DF.CodigoDocumento) AND (DF.Tipo = 'Venda')"
                                            +" JOIN DocumentoItem DI on (DP.CodigoDocumento = DI.CodigoDocumento)"
                                            +" JOIN Item IT on (DI.CodigoItem = IT.CodigoItem)"
                                        +" WHERE"
                                            +" DF.CodigoDocumento = 0"+dadosVenda.Records[i].CodigoDocumento, false, url, banco, usuario);

                        //For para exibir todos os Produtos
                        for (x = 0; x < dadosItens.RecordsAffected; x++) {
                            //Produtos
                            $("#itensVendaProdutos").append(
                                $("#TemplateItensVendaProdutos").html()
                                    .replaceAll("[Codigo]", ((dadosItens.Records[x].CodigoItem != null && dadosItens.Records[x].CodigoItem != "null") ? (dadosItens.Records[x].CodigoItem) : '') )
                                    .replaceAll("[Barra]", ((dadosItens.Records[x].CodigoBarras != null && dadosItens.Records[x].CodigoBarras != "null") ? (dadosItens.Records[x].CodigoBarras) : '') )
                                    .replaceAll("[Marca]", ((dadosItens.Records[x].Marca != null && dadosItens.Records[x].Marca != "null") ? (dadosItens.Records[x].Marca) : '') )
                                    .replaceAll("[Descricao]", ((dadosItens.Records[x].DescricaoComercial != null && dadosItens.Records[x].DescricaoComercial != "null") ? (dadosItens.Records[x].DescricaoComercial) : '') )
                                    .replaceAll("[Quantidade]", ((dadosItens.Records[x].Quantidade != null && dadosItens.Records[x].Quantidade != "null") ? (dadosItens.Records[x].Quantidade) : ''))
                                    .replaceAll("[Unitario]", ((dadosItens.Records[x].ValorVendaUnitario != null && dadosItens.Records[x].ValorVendaUnitario != "null") ? (dadosItens.Records[x].ValorVendaUnitario.toFixed(2).replace(".",",")) : ''))
                            );
                        }

                        //For totalizadores Produtos
                        for (t = 0; t < dadosItens.RecordsAffected; t++){
                            SUM_Qtd += dadosItens.Records[t].Quantidade;
                            SUM_SubTotal += dadosItens.Records[t].ValorVendaUnitario;
                        }
                    }

                    $("#itensVendaTotalizadores").append(
                        $("#TemplateItensVendaTotalizadores").html()
                            .replaceAll("[SUM_Qtd]", ((SUM_Qtd != null && SUM_Qtd != "null") ? (SUM_Qtd) : '') )
                            .replaceAll("[SUM_SubTotal]", ((SUM_SubTotal != null && SUM_SubTotal != "null") ? (SUM_SubTotal.toFixed(2).replace(".",",")) : '') )
                            .replaceAll("[SUM_Descontos]", ((dadosParcelas.Records[0].ValorDescontoTotal != null && dadosParcelas.Records[0].ValorDescontoTotal != "null") ? (dadosParcelas.Records[0].ValorDescontoTotal.toFixed(2).replace(".",",")) : '') )
                            .replaceAll("[SUM_TotalFinal]", ((dadosParcelas.Records[0].ValorTotal != null && dadosParcelas.Records[0].ValorTotal != "null") ? (dadosParcelas.Records[0].ValorTotal.toFixed(2).replace(".",",")) : '') )
                    );
                }

                //Logo Loja
                if (dadosEmissor.Records[0].Imagem != "Não informado")
                    $(".logo").each(function() {
                        $( this ).html('<img class="img-responsive" src="' + dadosEmissor.Records[0].Imagem.split("#")[0] + '" />');
                });

                //Codigo da Fatura
                $("#codFatura").html("Fatura: " +codigoDocumento);


                //Codigo de Barras da Fatura
                var numero = String(codigoDocumento);
                var zeros = 13 - Number(numero.length);

                for (var i = 0; i < zeros; i++) 
                    numero = '0' + numero;

                $("#codBarras").css("white-space", "nowrap");
                $("#codBarras").css("background-color", "#fff");
                $("#codBarras").html(fbarcode(numero,40));


                //Não queor imprimir isso (Itnes da Venda)
                $("#btItensVenda").click(function () {
                    $("#DelPrint_ItensVenda").remove();
                });
            }); 
        </script>
    </body>
</html>