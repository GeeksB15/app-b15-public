<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <title>Receita</title>
        <link rel="stylesheet" type="text/css" href="optidados.framework.css"/>
		<script src="/Scripts/jquery-2.1.4.js"></script>
		<script src="/Restricted/Geeks.ERP.BasicReport.js"></script>

		<style type="text/css">
            h5 { font-size: 13px; }
            h6 { font-size: 12px; }
            p { font-size: 11px; }
		</style>
    </head>

	<body>
		<div class="container">

            <!--cabeçalho do impresso-->
            <div class="row w100">

                <!--dados loja-->
                <div class="row w100 lineb">
                    <div class="col w18 logo">
                        <img class="img-responsive" src="optsoul-exemplo.png"/>
                    </div>

                    <div class="col w60">
                        <h5> <span id="fantasiaEmissor">Carregando impressão</span> </h5>
                        <h5> <span id="enderecoEmissor">-</span> </h5>
                        <h5> <span id="telefoneEmissor"></span> </h5>
                        <h5> <span id="emailEmissor">-</span> </h5>
                        <h5> <span id="siteEmissor">-</span> </h5>
                    </div>
                </div>

                <!--dados cliente-->
                <div class="row w100 pt07">
                    <div class="col w65">
                        <h5> Cód. Paciente: <span id="CodigoContato">-</span> </h5>
                        <h5> Paciente: <span id="nomePaciente">-</span> </h5>
                        <!-- <h5>Endereço: <span id="enderecoPaciente">-</span>  </h5> -->
                        <!-- <h5>Telefone: <span id="telefonePaciente">-</span> </h5> -->
                    </div>

                    <div class="col w35 float-r">
                        <h5 class="float-r">Data Presc.<span id="dataPrevista"></span></h5>
                        <!-- <h5>Valida até <span id="dataValidade"></span></h5> -->
                    </div>
                </div>

            </div>
            <!--.end cabeçalho do impresso-->

            <!--prescricao-->
            <div class="row w100 pb15">

                <!--relogio eixo direito-->
                <div class="col w49-3">
                    <img class="img-responsive" src="img-impresso/relogio-eixo-direito-prov.png"/>
                </div>

                <!--relogio eixo esquerdo-->
                <div class="col w49-3">
                    <img class="img-responsive" src="img-impresso/relogio-eixo-esquerdo-prov.png"/>
                </div>

                <!--olho direito-->                     
                <div class="col w49-3 linel lineb liner">
                    <ul class="list-col txt-ac">
                        <li class="w10"> <p class="b linef">O.D.</p> </li>
                        <li class="w12-8 lineb"> <p> Adc. </p> </li>
                        <li class="w12-8 lineb"> <p> Esf. </p> </li>
                        <li class="w12-8 lineb"> <p> Cil. </p> </li>
                        <li class="w12-8 lineb"> <p> Eixo </p> </li>
                        <li class="w12-8 lineb"> <p> Pris. </p> </li>
                        <li class="w12-8 lineb"> <p> Base </p> </li>
                        <li class="w12-8 lineb"> <p> DNP  </p> </li>
                    </ul>

                    <ul class="list-col txt-ac linhaDireitoLonge">
                        <li class="w10"> <p class="txt-al"> Longe </p> </li>
                        <li class="w12-8"> <p>.</p> </li>
                        <li class="w12-8"> <p id="odLongeEsf"> </p> </li>
                        <li class="w12-8"> <p id="odLongeCil"> </p> </li>
                        <li class="w12-8"> <p id="odLongeEixo"> </p> </li>
                        <li class="w12-8"> <p id="odLongePris"> </p> </li>
                        <li class="w12-8"> <p id="odLongeBase"> </p> </li>
                        <li class="w12-8"> <p id="odLongeDNP"> </p> </li>
                    </ul>

                    <ul class="medio list-col txt-ac linhaDireitoMedio">
                        <li class="w10"> <p class="txt-al"> Medio </p> </li>
                        <li class="w12-8"> <p id="odMedioAdc"> </p> </li>
                        <li class="w12-8"> <p id="odMedioEsf"> </p> </li>
                        <li class="w12-8"> <p id="odMedioCil"> </p> </li>
                        <li class="w12-8"> <p id="odMedioEixo"> </p> </li>
                        <li class="w12-8"> <p id="odMedioPris"> </p> </li>
                        <li class="w12-8"> <p id="odMedioBase"> </p> </li>
                        <li class="w12-8"> <p id="odMedioDNP"> </p> </li>
                    </ul>

                    <ul class="perto list-col txt-ac linhaDireitoPerto">
                        <li class="w10"> <p class="txt-al"> Perto </p> </li>
                        <li class="w12-8"> <p id="odPertoAdc"> </p> </li>
                        <li class="w12-8"> <p id="odPertoEsf"> </p> </li>
                        <li class="w12-8"> <p id="odPertoCil"> </p> </li>
                        <li class="w12-8"> <p id="odPertoEixo"> </p> </li>
                        <li class="w12-8"> <p id="odPertoPris"> </p> </li>
                        <li class="w12-8"> <p id="odPertoBase"> </p> </li>
                        <li class="w12-8"> <p id="odPertoDNP"> </p> </li>
                    </ul>
                </div>

                <!--olho esquerdo-->
                <div class="col w49-3 linel lineb liner float-r">
                    <ul class="list-col txt-ac">
                        <li class="w10"> <p class="b linef">O.E.</p> </li>
                        <li class="w12-8 lineb"> <p> Adc. </p> </li>
                        <li class="w12-8 lineb"> <p> Esf. </p> </li>
                        <li class="w12-8 lineb"> <p> Cil. </p> </li>
                        <li class="w12-8 lineb"> <p> Eixo </p> </li>
                        <li class="w12-8 lineb"> <p> Pris. </p> </li>
                        <li class="w12-8 lineb"> <p> Base </p> </li>
                        <li class="w12-8 lineb"> <p> DNP  </p> </li>
                    </ul>

                    <ul class="list-col txt-ac linhaEsquerdoLonge">
                        <li class="w10"> <p class="txt-al"> Longe </p> </li>
                        <li class="w12-8"> <p>.</p> </li>
                        <li class="w12-8"> <p id="oeLongeEsf"> </p> </li>
                        <li class="w12-8"> <p id="oeLongeCil"> </p> </li>
                        <li class="w12-8"> <p id="oeLongeEixo"> </p> </li>
                        <li class="w12-8"> <p id="oeLongePris"> </p> </li>
                        <li class="w12-8"> <p id="oeLongeBase"> </p> </li>
                        <li class="w12-8"> <p id="oeLongeDNP"> </p> </li>
                    </ul>

                    <ul class="medio list-col txt-ac linhaEsquerdoMedio">
                        <li class="w10"> <p class="txt-al"> Medio </p> </li>
                        <li class="w12-8 "> <p id="oeMedioAdc"> </p> </li>
                        <li class="w12-8 "> <p id="oeMedioEsf"> </p> </li>
                        <li class="w12-8 "> <p id="oeMedioCil"> </p> </li>
                        <li class="w12-8 "> <p id="oeMedioEixo"> </p> </li>
                        <li class="w12-8 "> <p id="oeMedioPris"> </p> </li>
                        <li class="w12-8 "> <p id="oeMedioBase"> </p> </li>
                        <li class="w12-8 "> <p id="oeMedioDNP"> </p> </li>
                    </ul>

                    <ul class="perto list-col txt-ac linhaEsquerdoPerto">
                        <li class="w10"> <p class="txt-al"> Perto </p> </li>
                        <li class="w12-8 "> <p id="oePertoAdc"> </p> </li>
                        <li class="w12-8 "> <p id="oePertoEsf"> </p> </li>
                        <li class="w12-8 "> <p id="oePertoCil"> </p> </li>
                        <li class="w12-8 "> <p id="oePertoEixo"> </p> </li>
                        <li class="w12-8 "> <p id="oePertoPris"> </p> </li>
                        <li class="w12-8 "> <p id="oePertoBase"> </p> </li>
                        <li class="w12-8 "> <p id="oePertoDNP"> </p> </li>
                    </ul>
                </div>
            </div>

            <!--observação-->
            <div class="row w100 pb20">
                <h6 class="linel lineb liner pf01">Obs: <span id="observacao"></span> </h6>
            </div>

            <!--optometrista-->
            <div class="row w100" style="padding: 40px 0 20px 0;">
                <h5 class="float-r w48 linet pt03 txt-ac">Especialista: <span id="nomeMedico"></span></h5>
            </div>

            <!--frase alerta-->
            <div class="row w100">
            	<h5 class="txt-ac">
            		O estabelecimento comercial para a aquisição dos óculos é de livre escolha do usuário.<br>
					É importante trazer os seus óculos para conferência.
				</h5>
            </div>

		</div>
	
		<script>
			$(document).ready(function(){
                
				var cod = getParameterByName("CodigoDocumento");
				var banco = getParameterByName("BancoDeDados");
				var url = decodeURIComponent(getParameterByName("URLServidor"));
				var usuario = getParameterByName("CodigoUsuario");
				var codPrescricao = "";
				var CodigoDocumento = "";
						
				if(getParameterByName("codPrescricao").length == 0 && getParameterByName("codigoDocumento").length > 0){
					CodigoDocumento = getParameterByName("codigoDocumento");
					codPrescricao = GeeksSQL("SELECT * from DocumentoItem where CodigoDocumento = 0" + getParameterByName("CodigoDocumentoAdicional"), false, url, banco, usuario);
					codPrescricao = codPrescricao.Records[0].CodigoDocumentoAdicional;
				}else{
					codPrescricao = getParameterByName("codPrescricao");
					CodigoDocumento = GeeksSQL("SELECT DISTINCT CodigoDocumento from DocumentoItem where CodigoDocumentoAdicional = 0" + codPrescricao, false, url, banco, usuario).Records[0].CodigoDocumento;
				}
				

						
			//Dados da Loja	
				var oculto = getParameterByName("Oculto");
				var dadosEmissor = GeeksSQL("select C.Nome, C.[Site], C.Email, CT.Telefone, IsNull((CE.Logradouro + ' ' + CE.Numero + ', '  + CE.Bairro + ' - ' + CE.Municipio + '/' + CE.UF + ' ' + CE.CEP), '') as Endereco, IsNull(C.Imagem, 'Não informado') Imagem from Contato C left join ContatoTelefone CT on CT.CodigoContato = C.CodigoContato and CT.TipoTelefone = 'Principal' left join ContatoEndereco CE on CE.CodigoContato = C.CodigoContato and CE.Grupo = 'Principal' where C.CodigoContato = (select CodigoEmpresa from Documento where CodigoDocumento = 0" + CodigoDocumento + ")", false, url, banco, usuario);

			//Dados Emissor
				$("#fantasiaEmissor").html(dadosEmissor.Records[0].Nome);
				$("#emailEmissor").html(dadosEmissor.Records[0].Email);
				$("#enderecoEmissor").html(dadosEmissor.Records[0].Endereco);
				$("#siteEmissor").html(dadosEmissor.Records[0].Site);
				$("#telefoneEmissor").html(dadosEmissor.Records[0].Telefone);
		
			//Dados do Medico 
			try {
			
				var dadosMedicoPaciente = GeeksSQL("select d.CodigoDocumento, DescricaoContato Paciente, d.CodigoContato CodigoContato, IsNull((Select Nome from Contato where CodigoContato = dc.CodigoContato),'Não informado') DescricaoMedico, isnull(d.DescricaoContatoEndereco, '') Endereco, isnull(d.DescricaoContatoEnderecoEntrega, '') EnderecoEntrega, isnull(d.TelefoneContato, '') Telefone, isnull(Convert(varchar(10), d.DataHoraEmissao, 103), '') DataPrevista, isnull(Convert(varchar(10), d.DataHoraFinalizado, 103), '') as DataValidade, d.Observacao from Documento d left join DocumentoContato dc on d.CodigoDocumento = dc.CodigoDocumento and dc.Descricao = 'Medico' where d.CodigoDocumento = 0" + codPrescricao, false, url, banco, usuario).Records[0];

				
					if(dadosMedicoPaciente.CodigoContato != undefined && dadosMedicoPaciente.CodigoContato > 0) {
									
				//Dados do Cliente
					$("#CodigoContato").html(Number(dadosMedicoPaciente.CodigoContato));
					$("#nomePaciente").html(dadosMedicoPaciente.Paciente);
					
					if(dadosMedicoPaciente.Endereco && dadosMedicoPaciente.Endereco.length > 0)
					{				
						$("#enderecoPaciente").html(dadosMedicoPaciente.Endereco);
					}else{
						$("#enderecoPaciente").html(dadosMedicoPaciente.EnderecoEntrega);
					}				

					$("#telefonePaciente").html(dadosMedicoPaciente.Telefone); 
					$("#nomeMedico").html(dadosMedicoPaciente.DescricaoMedico);
					
					
						$("#dataPrevista").html(dadosMedicoPaciente.DataPrevista == '01/01/1900' ? " " : dadosMedicoPaciente.DataPrevista);
						$("#dataValidade").html(dadosMedicoPaciente.DataValidade == '01/01/1900' ? " " : dadosMedicoPaciente.DataValidade);
						$("#observacao").html(dadosMedicoPaciente.Observacao);
					}
				}
			catch(err) {
						
						$("#observacao").html(err.message);
						$("#nomeMedico").html("Não encontrado.");
						}

			
			
			//Informações da Receita
			
            var OdLonge = GeeksSQL("Select Esferico, Cilindrico, Eixo, Prisma, Base, DIOD, DIOE from DocumentoItem where CodigoDocumento = 0" + codPrescricao + " and TipoItem = 'Prescrição' and Operacao = 'Olho Direito' and [Status] = 'Longe'", false, url, banco, usuario).Records[0];

            var OdMedio = GeeksSQL("Select Adicao, Esferico, Cilindrico, Eixo, Prisma, Base, DIOD, DIOE from DocumentoItem where CodigoDocumento = 0" + codPrescricao + " and TipoItem = 'Prescrição' and Operacao = 'Olho Direito' and [Status] = 'Medio'", false, url, banco, usuario).Records[0];

            var OdPerto = GeeksSQL("Select Adicao, Esferico, Cilindrico, Eixo, Prisma, Base, DIOD, DIOE from DocumentoItem where CodigoDocumento = 0" + codPrescricao + " and TipoItem = 'Prescrição' and Operacao = 'Olho Direito' and [Status] = 'Perto'", false, url, banco, usuario).Records[0];

            var OeLonge = GeeksSQL("Select Esferico, Cilindrico, Eixo, Prisma, Base from DocumentoItem where CodigoDocumento = 0" + codPrescricao + " and TipoItem = 'Prescrição' and Operacao = 'Olho Esquerdo' and [Status] = 'Longe'", false, url, banco, usuario).Records[0];

            var OeMedio = GeeksSQL("Select Adicao, Esferico, Cilindrico, Eixo, Prisma, Base from DocumentoItem where CodigoDocumento = 0"+ codPrescricao + " and TipoItem = 'Prescrição' and Operacao = 'Olho Esquerdo' and [Status] = 'Medio'", false, url, banco, usuario).Records[0];

            var OePerto = GeeksSQL("Select Adicao, Esferico, Cilindrico, Eixo, Prisma, Base from DocumentoItem where CodigoDocumento = 0" + codPrescricao + " and TipoItem = 'Prescrição' and Operacao = 'Olho Esquerdo' and [Status] = 'Perto'", false, url, banco, usuario).Records[0];
			
			// Longe

            $("#oeLongeEsf").html(Number(OeLonge.Esferico).toFixed(2).replace(".", ","));
            $("#oeLongeCil").html(Number(OeLonge.Cilindrico).toFixed(2).replace(".", ","));
            $("#oeLongeEixo").html(OeLonge.Eixo);
            $("#oeLongePris").html(OeLonge.Prisma);
            $("#oeLongeBase").html(OeLonge.Base);
            $("#oeLongeDNP").html(Number(OdLonge.DIOE).toFixed(2).replace(".", ","));

            $("#odLongeEsf").html(Number(OdLonge.Esferico).toFixed(2).replace(".", ","));
            $("#odLongeCil").html(Number(OdLonge.Cilindrico).toFixed(2).replace(".", ","));
            $("#odLongeEixo").html(OdLonge.Eixo);
            $("#odLongePris").html(OdLonge.Prisma);
            $("#odLongeBase").html(OdLonge.Base);
            $("#odLongeDNP").html(Number(OdLonge.DIOD).toFixed(2).replace(".", ","));

            // Médio

            $("#odMedioAdc").html(Number(OdMedio.Adicao).toFixed(2).replace(".", ","));
            $("#odMedioEsf").html(Number(OdMedio.Esferico).toFixed(2).replace(".", ","));
            $("#odMedioCil").html(Number(OdMedio.Cilindrico).toFixed(2).replace(".", ","));
            $("#odMedioEixo").html(OdMedio.Eixo);
            $("#odMedioPris").html(OdMedio.Prisma);
            $("#odMedioBase").html(OdMedio.Base);
            $("#odMedioDNP").html(Number(OdMedio.DIOD).toFixed(2).replace(".", ","));

            $("#oeMedioAdc").html(Number(OeMedio.Adicao).toFixed(2).replace(".", ","));
            $("#oeMedioEsf").html(Number(OeMedio.Esferico).toFixed(2).replace(".", ","));
            $("#oeMedioCil").html(Number(OeMedio.Cilindrico).toFixed(2).replace(".", ","));
            $("#oeMedioEixo").html(OeMedio.Eixo);
            $("#oeMedioPris").html(OeMedio.Prisma);
            $("#oeMedioBase").html(OeMedio.Base);
            $("#oeMedioDNP").html(Number(OdMedio.DIOE).toFixed(2).replace(".", ","));

            // Perto

            $("#odPertoAdc").html(Number(OdPerto.Adicao).toFixed(2).replace(".", ","));
            $("#odPertoEsf").html(Number(OdPerto.Esferico).toFixed(2).replace(".", ","));
            $("#odPertoCil").html(Number(OdPerto.Cilindrico).toFixed(2).replace(".", ","));
            $("#odPertoEixo").html(OdPerto.Eixo);
            $("#odPertoPris").html(OdPerto.Prisma);
            $("#odPertoBase").html(OdPerto.Base);
            $("#odPertoDNP").html(Number(OdPerto.DIOD).toFixed(2).replace(".", ","));

            $("#oePertoAdc").html(Number(OePerto.Adicao).toFixed(2).replace(".", ","));
            $("#oePertoEsf").html(Number(OePerto.Esferico).toFixed(2).replace(".", ","));
            $("#oePertoCil").html(Number(OePerto.Cilindrico).toFixed(2).replace(".", ","));
            $("#oePertoEixo").html(OePerto.Eixo);
            $("#oePertoPris").html(OePerto.Prisma);
            $("#oePertoBase").html(OePerto.Base);
            $("#oePertoDNP").html(Number(OdPerto.DIOE).toFixed(2).replace(".", ","));      


			//Oculta campos se vazio
			if(OdMedio.Adicao == 0 || OeMedio.Adicao == 0 ){
			$('.medio').hide();
			}
			
			if(OdPerto.Adicao == 0 || OePerto.Adicao == 0){
			$('.perto').hide();
			}
    	});
    	</script>

	</body>	

</html>