<!DOCTYPE html>
    <html lang="pt-br">

        <head>
            <meta charset="utf-8">
            <title>Envelope</title>
            <link rel="stylesheet" type="text/css" href="impressos.css"/>
            <script src="/Scripts/jquery-2.1.4.js"></script>
            <script src="/Restricted/Geeks.ERP.BasicReport.js"></script>
            <script src="/Scripts/codigobarras.js"></script>
            <script src="/Plugins/html2canvas.js"></script>

            <script id="linhaTabelaItensVenda" type="linhaTabelaItensVenda">
                <tr>
                    <td> <p> [codigo]  </p> </td>
                    <td> <p> [marca]        </p> </td>
                    <td> <p> [descricao]     </p> </td>
                    <td class="cont-qtd">  <p> [qtd] </p> </td>
                    <td class="cont-valor"> <p> [valorProduto]</p> </td>
                </tr>
            </script>

            <script type="linhaTabelaFormaPgto" id="linhaTabelaFormaPgto">
                <tr>
                    <td class="box-bottom"> <h6>[nomeFormaPgto]</h6> </td>
                    <td class="box-bottom" colspan="3"> <h6>[data]</h6> </td>
                    <td class="cont-valor box-bottom"> <p>R$ [valorPgto]</p> </td>
                </tr>
            </script>

            <script type="oculos" id="oculos">
                <table class="content-table">
                    <!--titulo da seção-->
                    <tr>
                        <td class="titulo-sessao" colspan="2">
                            Prescrição
                        </td>
                    </tr>

                    <tr>
                        <!--olho direito-->
                        <td>
                            <table class="prescricao-od">
                                <tr>
                                    <td></td>
                                    <td class="prescricao-od-title" colspan="7">
                                        <h6> Olho Direito </h6>
                                    </td>
                                </tr>

                                <tr>
                                    <td></td>
                                    <td class="prescricao-title"> <h6> Adc. </h6> </td>
                                    <td class="prescricao-title"> <h6> Esf. </h6> </td>
                                    <td class="prescricao-title"> <h6> Cil. </h6> </td>
                                    <td class="prescricao-title"> <h6> Eixo </h6> </td>
                                    <td class="prescricao-title"> <h6> Pris. </h6> </td>
                                    <td class="prescricao-title"> <h6> Base </h6> </td>
                                    <td class="prescricao-title"> <h6> DNP  </h6> </td>
                                </tr>
                                <tr>
                                    <td class="prescricao-dist"> <h6> Longe </h6> </td>
                                    <td class="prescricao-dados"> <p class="odLongeAdc"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="odLongeEsf"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="odLongeCil"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="odLongeEixo"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="odLongePris"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="odLongeBase"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="odLongeDNP"> - </p> </td>
                                </tr>
                                <tr>
                                    <td class="prescricao-dist"> <h6> Medio </h6> </td>
                                    <td class="prescricao-dados"> <p class="odMedioAdc"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="odMedioEsf"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="odMedioCil"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="odMedioEixo"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="odMedioPris"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="odMedioBase"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="odMedioDNP"> - </p> </td>
                                </tr>
                                <tr>
                                    <td class="prescricao-dist"> <h6> Perto </h6> </td>
                                    <td class="prescricao-dados"> <p class="odPertoAdc"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="odPertoEsf"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="odPertoCil"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="odPertoEixo"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="odPertoPris"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="odPertoBase"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="odPertoDNP"> - </p> </td>
                                </tr>
                            </table>
                        </td>

                        <!--olho esquerdo-->
                        <td>
                            <table class="prescricao-oe">
                                <tr>
                                    <td></td>
                                    <td class="prescricao-oe-title" colspan="7">
                                        <h6> Olho Esquerdo </h6>
                                    </td>
                                </tr>

                                <tr>
                                    <td></td>
                                    <td class="prescricao-title"> <h6> Adc. </h6> </td>
                                    <td class="prescricao-title"> <h6> Esf. </h6> </td>
                                    <td class="prescricao-title"> <h6> Cil. </h6> </td>
                                    <td class="prescricao-title"> <h6> Eixo </h6> </td>
                                    <td class="prescricao-title"> <h6> Pris. </h6> </td>
                                    <td class="prescricao-title"> <h6> Base </h6> </td>
                                    <td class="prescricao-title"> <h6> DNP  </h6> </td>
                                </tr>
                                <tr>
                                    <td class="prescricao-dist"> <h6> Longe </h6> </td>
                                    <td class="prescricao-dados"> <p> - </p> </td>
                                    <td class="prescricao-dados"> <p class="oeLongeEsf"> -  </p> </td>
                                    <td class="prescricao-dados"> <p class="oeLongeCil"> -  </p> </td>
                                    <td class="prescricao-dados"> <p class="oeLongeEixo"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="oeLongePris"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="oeLongeBase"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="oeLongeDNP"> - </p> </td>
                                </tr>
                                <tr>
                                    <td class="prescricao-dist"> <h6> Medio </h6> </td>
                                    <td class="prescricao-dados"> <p class="oeMedioAdc"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="oeMedioEsf"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="oeMedioCil"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="oeMedioEixo"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="oeMedioPris"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="oeMedioBase"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="oeMedioDNP"> - </p> </td>
                                </tr>
                                <tr>
                                    <td class="prescricao-dist"> <h6> Perto </h6> </td>
                                    <td class="prescricao-dados"> <p class="oePertoAdc"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="oePertoEsf"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="oePertoCil"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="oePertoEixo"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="oePertoPris"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="oePertoBase"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="oePertoDNP"> - </p> </td>
                                </tr>
                            </table>                
            </script>

            <script type="lenteAumento" id="lenteAumento">
                <table class="content-table">
                    <!--titulo da seção-->
                    <tr>
                        <td class="titulo-sessao" colspan="2">
                            Lente de Contato
                        </td>
                    </tr>

                    <!--dioptria-->
                    <tr>
                        <!--olho direito-->
                        <td>
                            <table class="prescricao-od">
                                <tr>
                                    <td class="prescricao-od-title" colspan="4">
                                        <h6> Olho Direito </h6>
                                    </td>
                                </tr>

                                <tr>
                                    <td class="prescricao-title"> <h6> Esf. </h6> </td>
                                    <td class="prescricao-title"> <h6> Cil. </h6> </td>
                                    <td class="prescricao-title"> <h6> Eixo </h6> </td>
                                    <td class="prescricao-title"> <h6> Adc. </h6> </td>
                                </tr>
                                <tr>
                                    <td class="prescricao-dados"> <p class="lodEsf"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="lodCil"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="lodEixo"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="lodAdc"> - </p> </td>
                            </table>
                        </td>

                        <!--olho esquerdo-->
                        <td>
                            <table class="prescricao-oe">
                                <tr>
                                    <td class="prescricao-oe-title" colspan="4">
                                        <h6> Olho Esquerdo </h6>
                                    </td>
                                </tr>

                                <tr>
                                    <td class="prescricao-title"> <h6> Esf. </h6> </td>
                                    <td class="prescricao-title"> <h6> Cil. </h6> </td>
                                    <td class="prescricao-title"> <h6> Eixo </h6> </td>
                                    <td class="prescricao-title"> <h6> Adc. </h6> </td>
                                </tr>
                                <tr>
                                    <td class="prescricao-dados"> <p class="loeEsf"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="loeCil"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="loeEixo"> - </p> </td>
                                    <td class="prescricao-dados"> <p class="loeAdc"> - </p> </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
            </script>

        </head>

        <body>

        <div class="container">

            <div class="via">
                <!--titulo do impresso-->
                <table class="titulo-relatorio">
                    <tr>
                        <td>
                            Envelope
                        </td>
                    </tr>
                </table>


                <!--dados loja-->
                <table class="content-table">
                    <tr>
                        <!--logo da loja-->
                        <td class="logo-loja" align="center" valign="center">
                            <img src="optsoul-exemplo.png"/>
                        </td>

                        <!--dados da loja-->
                        <td class="dados-loja">
                            <h5 class="fantasiaEmissor"> Carregando relatório </h5>
                            <h5 class="enderecoEmissor">-</h5>
                            <h5 class="telefoneEmissor">-</h5>
                            <h5 class="emailEmissor">-</h5>
                            <h5 class="siteEmissor">-</h5>
                        </td>

                        <!--codigo de barras-->
                        <td>
							<div style="width: 200px">
								<table class="sub-content-table">
									<tr>
										<td class="codPedido" align="center">-</td>
									</tr>
									<tr>
										<td id="codBarras" class="codBarras" align="center" cellpadding=0 cellspacing=0>-</td>
									</tr>
									<tr>
										<td class="codEnvelope" style="font-size: 8pt;" align="center" valign="top" cellpadding=0 cellspacing=0>-</td>
									</tr>
								</table>
							</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="linha-divisoria" colspan="3"></td>
                    </tr>
                </table>


                <!--dados cliente-->
                <table class="content-table">
                    <tr>
                        <!--dados clietne-->
                        <td class="dados-cliente">
                            <h5> Cliente: <span class="codigoCliente"></span> - <span class="nomeCliente"></span></h5>
                            <h5 class="enderecoCliente"> - </h5>
                            <h5 class="telefoneCliente"> - </h5>
                        </td>

                        <!--data-->
                        <td class="float-right">
                            <h5>Venda: <span class="dataVenda">-</span></h5>
                            <h5>Previsão: <span class="prevEntrega">-</span></h5>
                            <h5>Entrega: <span class="dataEntrega">-</span></h5>
                            <h5>Impresso: <span class="dataImpressao">-</span></h5>
                        </td>
                    </tr>
                </table>

                    <div class="oculosOuLente"></div>

                    <!--tipo de oculos-->
                    <tr>
                        <td colspan="2">
                            <h6 class="tipoOculos">Tipo de óculos: Longe, Médio, Perto, Solar</h6>
                        </td>
                    </tr>                    

                    <!--paciente/médico/verificado-->
                    <tr>
                        <td colspan="2">
                            <table class="sub-content-table text-align-center">
                                <tr>
                                    <!--paciente-->
                                    <td>
                                        <h6> Paciente: <span class="nomePaciente">-</span> </h6>
                                    </td>
                                    <!--médico-->
                                    <td>
                                        <h6> Médico: <span class="nomeMedico">-</span> </h6>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>

                <!--produtos-->
                <table class="content-table tabela-produtos">
                    <!--codigo envelope-->
                    <tr>
                        <td class="titulo-sessao" colspan="6">
                            Produtos/Pagamento
                        </td>
                    </tr>

                    <!--descrição-->
                    <tr>
                        <td> <h6> Código de Barras </h6> </td>
                        <td> <h6> Marca            </h6> </td>
                        <td> <h6> Descrição        </h6> </td>
                        <td class="desc-qtd">  <h6> Qtd   </h6> </td>
                        <td class="desc-valor"> <h6> Preço (R$) </h6> </td>
                    </tr>
                    
                    <tr>
                        <td class="linha-divisoria" colspan="5"></td>
                    </tr>
                </table>

                <table class="content-table">

                    <!--total produtos-->
                    <tr>
                        <td class="box-bottom" colspan="3"> <h6>SUBTOTAL:</h6> </td>
                        <td class="cont-qtd box-bottom"></td>
                        <td class="cont-valor box-bottom"> <p class="subtotalProdutos">-</p> </td>
                    </tr>

                    <tr>
                        <td class="box-bottom" colspan="3"> <h6>VALOR DOS OUTROS ITENS DO PEDIDO:</h6> </td>
                        <td class="cont-qtd box-bottom"></td>
                        <td class="cont-valor box-bottom"> <p class="valorOutrosProdutos">-</p> </td>
                    </tr>

                    <tr>
                        <td class="box-bottom" colspan="3"> <h6>VALOR DE OUTROS PEDIDOS NA FATURA</h6> </td>
                        <td class="cont-qtd box-bottom"></td>
                        <td class="cont-valor box-bottom"> <p class="valorOutrosPedidos">-</p> </td>
                    </tr>
                    
                    <tr>
                        <td class="box-bottom" colspan="4"> <h6>DESCONTO (ITEM + PEDIDO):</h6> </td>
                        <td class="cont-valor box-bottom"> <p class="descontoProdutos">-</p> </td>
                    </tr>

                    <tr>
                        <td class="box-bottom" colspan="4"> <h6>TOTAL:</h6> </td>
                        <td class="cont-valor box-bottom"> <p class="totalProdutos">-</p> </td>
                    </tr>

                </table>

                <table class="content-table tabela-totais">

                </table>

                <table class="content-table">
                    <!--formas pgto-->
                    <tr><td style="padding-top: 5px;" colspan="5"></td></tr>

                    <!--valor à pagar (restante)-->
                    <tr><td style="padding-top: 5px;" colspan="5"></td></tr>
                    <tr>
                        <td class="box-bottom" colspan="4"> <h6>VALOR A RECEBER:</h6> </td>
                        <td class="cont-valor box-bottom"> <p class="valorAReceber">-</p> </td>
                    </tr>

                </table>


                <!--contrato de compra-->
                <table class="content-table">
                    <tr>
                        <td class="titulo-sessao">
                            Contrato de Compra
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <p class="textoAssinatura">
                                Eu, [nomeCliente], [endereco][documentos]declaro estar
                                adquirindo da [nomeLoja], os
                                produtos de minha necessidade, totalizando um
                                valor de
                                [valorTotalOS]
                            </p>
                        </td>
                    </tr>
                    <tr>
                        <td class="assinatura-contrato">
                            <p> Assinatura </p>
                        </td>
                    </tr>
                </table>
            </div>

            <div class="via">
                <!--via cliente-->
                <table class="content-table">
                    <tr>
                        <td class="titulo-sessao" colspan="3">Via Cliente</td>
                    </tr>
                </table>

                    <!--dados loja-->
                    <table class="content-table">
                        <tr>
                            <!--logo da loja-->
                            <td class="logo-loja" align="center" valign="center">
                                <img src="optsoul-exemplo.png"/>
                            </td>

                            <!--dados da loja-->
                            <td class="dados-loja">
                                <h5 class="fantasiaEmissor"> Carregando relatório </h5>
                                <h5 class="enderecoEmissor">-</h5>
                                <h5 class="telefoneEmissor">-</h5>
                                <h5 class="emailEmissor">-</h5>
                                <h5 class="siteEmissor">-</h5>
                            </td>

                            <!--codigo de barras-->
                            <td>
								<div style="width: 200px">
									<table class="sub-content-table">
										<tr>
											<td class="codPedido" align="center">-</td>
										</tr>
										<tr>
											<td id="codBarras" class="codBarras" align="center" cellpadding=0 cellspacing=0>-</td>
										</tr>
										<tr>
											<td class="codEnvelope" style="font-size: 8pt;" align="center" valign="top" cellpadding=0 cellspacing=0>-</td>
										</tr>
									</table>
								</div>
                            </td>
                        </tr>
                        <tr>
                            <td class="linha-divisoria" colspan="3"></td>
                        </tr>
                    </table>

                    <!--dados cliente-->
                    <table class="content-table">
                        <tr>
                            <!--dados clietne-->
                            <td class="dados-cliente">
                                <h5> Cliente: <span class="codigoCliente"></span> - <span class="nomeCliente"></span></h5>
                                <h5 class="enderecoCliente"> - </h5>
                                <h5 class="telefoneCliente"> - </h5>
                            </td>

                            <!--data-->
                            <td class="float-right">
                                <h5>Venda: <span class="dataVenda">-</span></h5>
                                <h5>Previsão: <span class="prevEntrega">-</span></h5>
                                <h5>Entrega: <span class="dataEntrega">-</span></h5>
                                <h5>Impresso: <span class="dataImpressao">-</span></h5>
                            </td>
                        </tr>
                    </table>

                    <!--produtos-->
                <table class="content-table tabela-produtos">
                    <!--codigo envelope-->
                    <tr>
                        <td class="titulo-sessao" colspan="6">
                            Produtos
                        </td>
                    </tr>

                    <!--descrição-->
                    <tr>
                        <td> <h6> Código de Barras </h6> </td>
                        <td> <h6> Marca            </h6> </td>
                        <td> <h6> Descrição        </h6> </td>
                        <td class="desc-qtd">  <h6> Qtd   </h6> </td>
                        <td class="desc-valor"> <h6> Preço (R$) </h6> </td>
                    </tr>
                    
                    <tr>
                        <td class="linha-divisoria" colspan="5"></td>
                    </tr>

                </table>

                <table class="content-table">

                    <!--total produtos-->
                    <tr>
                        <td class="box-bottom" colspan="3"> <h6>SUBTOTAL:</h6> </td>
                        <td class="cont-qtd box-bottom"></td>
                        <td class="cont-valor box-bottom"> <p class="subtotalProdutos">-</p> </td>
                    </tr>

                    <tr>
                        <td class="box-bottom" colspan="3"><h6>VALOR DOS OUTROS ITENS DO PEDIDO:</h6> </td>
                        <td class="cont-qtd box-bottom"></td>
                        <td class="cont-valor box-bottom"> <p class="valorOutrosProdutos">-</p> </td>
                    </tr>

                    <tr>
                        <td class="box-bottom" colspan="3"><h6>VALOR DE OUTROS PEDIDOS NA FATURA</h6> </td>
                        <td class="cont-qtd box-bottom"></td>
                        <td class="cont-valor box-bottom"> <p class="valorOutrosPedidos">-</p> </td>
                    </tr>
                    
                    <tr>
                        <td class="box-bottom" colspan="4"> <h6>DESCONTO (ITEM + PEDIDO):</h6> </td>
                        <td class="cont-valor box-bottom"><p class="descontoProdutos">-</p> </td>
                    </tr>

                    <tr>
                        <td class="box-bottom" colspan="4"> <h6>TOTAL:</h6> </td>
                        <td class="cont-valor box-bottom"> <p class="totalProdutos">-</p> </td>
                    </tr>

                </table>

                <table class="content-table tabela-totais">

                </table>

                <table class="content-table">
                    <!--formas pgto-->
                    <tr><td style="padding-top: 5px;" colspan="5"></td></tr>

                    <!--valor à pagar (restante)-->
                    <tr><td style="padding-top: 5px;" colspan="5"></td></tr>
                    <tr>
                        <td class="box-bottom" colspan="4"> <h6>VALOR A RECEBER:</h6> </td>
                        <td class="cont-valor box-bottom"> <p class="valorAReceber">-</p> </td>
                    </tr>
                    
                </table>

            </div>

            <div class="via">
                <!--via laboratório-->
                <table class="content-table">
                    <tr>
                        <td class="titulo-sessao" colspan="2">
                            Via Laboratório
                        </td>
                    </tr>
                </table>

                    <!--dados loja-->
                    <table class="content-table">
                        <tr>
                            <!--logo da loja-->
                            <td class="logo-loja" align="center" valign="center">
                                <img src="optsoul-exemplo.png"/>
                            </td>

                            <!--dados da loja-->
                            <td class="dados-loja">
                                <h5 class="fantasiaEmissor"> Carregando relatório </h5>
                                <h5 class="enderecoEmissor">-</h5>
                                <h5 class="telefoneEmissor">-</h5>
                                <h5 class="emailEmissor">-</h5>
                                <h5 class="siteEmissor">-</h5>
                            </td>

                            <!--codigo de barras-->
                            <td>
                                <div style="width: 200px">
									<table class="sub-content-table">
										<tr>
											<td class="codPedido" align="center">-</td>
										</tr>
										<tr>
											<td id="codBarras" class="codBarras" align="center" cellpadding=0 cellspacing=0>-</td>
										</tr>
										<tr>
											<td class="codEnvelope" style="font-size: 8pt;" align="center" valign="top" cellpadding=0 cellspacing=0>-</td>
										</tr>
									</table>
								</div>
                            </td>
                        </tr>
                        <tr>
                            <td class="linha-divisoria" colspan="3"></td>
                        </tr>
                    </table>                

                    <div class="oculosOuLente"></div>

                    <!--tipo de oculos-->
                    <tr>
                        <td colspan="2">
                            <h6 class="tipoOculos">Tipo de óculos: Longe, Médio, Perto, Solar</h6>
                        </td>
                    </tr>

                    <!--paciente/médico/verificado-->
                    <tr>
                        <td colspan="2">
                            <table class="sub-content-table text-align-center">
                                <tr>
                                    <!--paciente-->
                                    <td>
                                        <h6> Paciente: <span class="nomePaciente">-</span> </h6>
                                    </td>
                                    <!--médico-->
                                    <td>
                                        <h6> Médico: <span class="nomeMedico">-</span> </h6>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>

                <!-- Não vai valor para o laboratório -->
                <table class="content-table tabela-produtos-lab">
                    <tr>
                        <td class="titulo-sessao" colspan="5">
                            Produtos
                        </td>
                    </tr>
                    <tr>
                        <td> <h6> Código de Barras </h6> </td>
                        <td> <h6> Marca            </h6> </td>
                        <td> <h6> Descrição        </h6> </td>
                        <!--<td class="desc-qtd">  <h6> Qtd   </h6> </td>
                        <td class="desc-valor"> <h6> Preço (R$) </h6> </td>-->
                    </tr>
                    
                    <tr>
                        <td class="linha-divisoria" colspan="5"></td>
                    </tr>

                </table>
            </div>

        </div>

        <script>

        $(document).ready(function(){

            var pedido = getParameterByName("CodigoVenda");
			var codigoEnvelope = getParameterByName("CodigoEnvelope");
            var banco = getParameterByName("BancoDeDados");
            var url = decodeURIComponent(getParameterByName("URLServidor"));
            var usuario = getParameterByName("CodigoUsuario");

            var item = GeeksSQL("select CodigoDocumentoAdicional from Documento where CodigoDocumento = 0" + codigoEnvelope, false, url, banco, usuario);
            item = item.Records[0].CodigoDocumentoAdicional;

            var codigoVenda = GeeksSQL("select CodigoDocumentoAdicional from Documento where CodigoDocumento = 0" + item, false, url, banco, usuario);
            codigoVenda = codigoVenda.Records[0].CodigoDocumentoAdicional;

            var dadosEmissor = GeeksSQL("select C.Nome, C.[Site], C.Email, CT.Telefone, (CE.Logradouro + ' ' + CE.Numero + ', '  + CE.Bairro + ' - ' + CE.Municipio + '/' + CE.UF + ' ' + CE.CEP) as Endereco from Contato C left join ContatoTelefone CT on CT.CodigoContato = C.CodigoContato and CT.TipoTelefone = 'Principal' left join ContatoEndereco CE on CE.CodigoContato = C.CodigoContato and CE.Grupo = 'Principal' where C.CodigoContato = (select CodigoEmpresa from Documento where CodigoDocumento = 0" + pedido + ")", false, url, banco, usuario);

			var dadosEnvelope = GeeksSQL("select CodigoDocumento CodigoEnvelope, Cast((Select Numero from Documento where CodigoDocumento = (Select CodigoDocumentoAdicional from Documento where CodigoDocumento=d.CodigoDocumentoAdicional)) as varchar)+'-'+Cast(Numero as varchar) NumeroEnvelope, IsNull(Convert(varchar(10), DataHoraPrevisto, 103) + ' ' + Convert(varchar(10), DataHoraPrevisto, 108), '-') Previsto from Documento d where CodigoDocumento = 0" + codigoEnvelope, false, url, banco, usuario);
			
            $(".codPedido").html("Número " + dadosEnvelope.Records[0].NumeroEnvelope);
			$(".codEnvelope").html(dadosEnvelope.Records[0].CodigoEnvelope);

            $(".fantasiaEmissor").html(dadosEmissor.Records[0].Nome);
            $(".emailEmissor").html(dadosEmissor.Records[0].Email);
            $(".enderecoEmissor").html(dadosEmissor.Records[0].Endereco);
            $(".siteEmissor").html(dadosEmissor.Records[0].Site);
            $(".telefoneEmissor").html(dadosEmissor.Records[0].Telefone);

            var dadosCliente = GeeksSQL("select C.CodigoContato, C.Nome, C.NumeroDocumentoNacional, C.TipoDocumentoNacional, C.NumeroDocumentoEstadual, CT.Telefone, CE.Logradouro + ' ' + CE.Numero + ', '  + CE.Bairro + ' - ' + CE.Municipio + '/' + CE.UF + ' ' + CE.CEP Endereco from Contato C left join ContatoTelefone CT on CT.CodigoContato = C.CodigoContato and CT.TipoTelefone = 'Principal' left join ContatoEndereco CE on CE.CodigoContato = C.CodigoContato and CE.Grupo = 'Principal' where C.CodigoContato = (select CodigoContato from Documento where CodigoDocumento = 0" + pedido + ")", false, url, banco, usuario);

            $(".codCliente").html(dadosCliente.Records[0].CodigoContato);
            $(".nomeCliente").html(dadosCliente.Records[0].Nome);
            $(".enderecoCliente").html(dadosCliente.Records[0].Endereco);
            $(".telefoneCliente").html(dadosCliente.Records[0].Telefone);

            var dadositem = GeeksSQL("select Operacao, IsNull(Convert(varchar(10), DataHoraEmissao, 103) + ' ' + Convert(varchar(10), DataHoraEmissao, 108), '-') Emissao, IsNull(Convert(varchar(10), DataHoraRealizado, 103) + ' ' + Convert(varchar(10), DataHoraRealizado, 108), '-') Entregue, IsNull(Convert(varchar(10), current_timestamp, 103) + ' ' + Convert(varchar(10), current_timestamp, 108), '-') Agora, (select Nome from Contato where CodigoContato = CodigoContatoResponsavel) Verificado from Documento where CodigoDocumento = 0" + item, false, url, banco, usuario);            

            $(".dataVenda").html(dadositem.Records[0].Emissao);
            $(".prevEntrega").html(dadosEnvelope.Records[0].Previsto);
            $(".dataEntrega").html(dadositem.Records[0].Entregue);
            $(".dataImpressao").html(dadositem.Records[0].Agora);

            // Geração do código de barras
            var numero = String(codigoEnvelope);
            var zeros = 13 - Number(numero.length);

            for (var i = 0; i < zeros; i++) 
                numero = '0' + numero;

            $(".codBarras").css("white-space", "nowrap");
            $(".codBarras").css("background-color", "#fff");

            $(".codBarras").html(fbarcode(numero));

            var bc = document.getElementById("codBarras");
            html2canvas(bc, {
              onrendered: function(canvas) {
                var img = canvas.toDataURL("image/jpeg");
                    $(".codBarras").html("");
                    $(".codBarras").append('<img src="' + img + '"></img>');
                }
            });

            if (dadositem.Records[0].Operacao != 'Lente de Contato Surfaçada') {

                $(".oculosOuLente").append($("#oculos").html());

                var OdLonge = GeeksSQL("Select Esferico, Cilindrico, Eixo, Prisma, Base, DIOD, DIOE from DocumentoItem where CodigoDocumento = (Select Top 1 CodigoDocumentoAdicional from DocumentoItem where CodigoDocumento = 0" + item + ") and TipoItem = 'Prescrição' and Operacao = 'Olho Direito' and [Status] = 'Longe'", false, url, banco, usuario).Records[0];

                var OdMedio = GeeksSQL("Select Adicao, Esferico, Cilindrico, Eixo, Prisma, Base, DIOD, DIOE from DocumentoItem where CodigoDocumento = (Select Top 1 CodigoDocumentoAdicional from DocumentoItem where CodigoDocumento = 0" + item + ") and TipoItem = 'Prescrição' and Operacao = 'Olho Direito' and [Status] = 'Medio'", false, url, banco, usuario).Records[0];

                var OdPerto = GeeksSQL("Select Adicao, Esferico, Cilindrico, Eixo, Prisma, Base, DIOD, DIOE from DocumentoItem where CodigoDocumento = (Select Top 1 CodigoDocumentoAdicional from DocumentoItem where CodigoDocumento = 0" + item + ") and TipoItem = 'Prescrição' and Operacao = 'Olho Direito' and [Status] = 'Perto'", false, url, banco, usuario).Records[0];

                var OeLonge = GeeksSQL("Select Esferico, Cilindrico, Eixo, Prisma, Base from DocumentoItem where CodigoDocumento = (Select Top 1 CodigoDocumentoAdicional from DocumentoItem where CodigoDocumento = 0" + item + ") and TipoItem = 'Prescrição' and Operacao = 'Olho Esquerdo' and [Status] = 'Longe'", false, url, banco, usuario).Records[0];

                var OeMedio = GeeksSQL("Select Adicao, Esferico, Cilindrico, Eixo, Prisma, Base from DocumentoItem where CodigoDocumento = (Select Top 1 CodigoDocumentoAdicional from DocumentoItem where CodigoDocumento = 0" + item + ") and TipoItem = 'Prescrição' and Operacao = 'Olho Esquerdo' and [Status] = 'Medio'", false, url, banco, usuario).Records[0];

                var OePerto = GeeksSQL("Select Adicao, Esferico, Cilindrico, Eixo, Prisma, Base from DocumentoItem where CodigoDocumento = (Select Top 1 CodigoDocumentoAdicional from DocumentoItem where CodigoDocumento = 0" + item + ") and TipoItem = 'Prescrição' and Operacao = 'Olho Esquerdo' and [Status] = 'Perto'", false, url, banco, usuario).Records[0];

                // Longe

                $(".oeLongeEsf").html(Number(OeLonge.Esferico).toFixed(2).replace(".", ","));
                $(".oeLongeCil").html(Number(OeLonge.Cilindrico).toFixed(2).replace(".", ","));
                $(".oeLongeEixo").html(OeLonge.Eixo);
                $(".oeLongePris").html(OeLonge.Prisma);
                $(".oeLongeBase").html(Number(OeLonge.Base).toFixed(2).replace(".", ","));
                $(".oeLongeDNP").html(Number(OdLonge.DIOE).toFixed(2).replace(".", ","));

                $(".odLongeEsf").html(Number(OdLonge.Esferico).toFixed(2).replace(".", ","));
                $(".odLongeCil").html(Number(OdLonge.Cilindrico).toFixed(2).replace(".", ","));
                $(".odLongeEixo").html(OdLonge.Eixo);
                $(".odLongePris").html(OdLonge.Prisma);
                $(".odLongeBase").html(Number(OdLonge.Base).toFixed(2).replace(".", ","));
                $(".odLongeDNP").html(Number(OdLonge.DIOD).toFixed(2).replace(".", ","));

                // Médio

                $(".odMedioAdc").html(Number(OdMedio.Adicao).toFixed(2).replace(".", ","));
                $(".odMedioEsf").html(Number(OdMedio.Esferico).toFixed(2).replace(".", ","));
                $(".odMedioCil").html(Number(OdMedio.Cilindrico).toFixed(2).replace(".", ","));
                $(".odMedioEixo").html(OdMedio.Eixo);
                $(".odMedioPris").html(OdMedio.Prisma);
                $(".odMedioBase").html(Number(OdMedio.Base).toFixed(2).replace(".", ","));
                $(".odMedioDNP").html(Number(OdMedio.DIOD).toFixed(2).replace(".", ","));

                $(".oeMedioAdc").html(Number(OeMedio.Adicao).toFixed(2).replace(".", ","));
                $(".oeMedioEsf").html(Number(OeMedio.Esferico).toFixed(2).replace(".", ","));
                $(".oeMedioCil").html(Number(OeMedio.Cilindrico).toFixed(2).replace(".", ","));
                $(".oeMedioEixo").html(OeMedio.Eixo);
                $(".oeMedioPris").html(OeMedio.Prisma);
                $(".oeMedioBase").html(Number(OeMedio.Base).toFixed(2).replace(".", ","));
                $(".oeMedioDNP").html(Number(OdMedio.DIOE).toFixed(2).replace(".", ","));

                // Perto

                $(".odPertoAdc").html(Number(OdPerto.Adicao).toFixed(2).replace(".", ","));
                $(".odPertoEsf").html(Number(OdPerto.Esferico).toFixed(2).replace(".", ","));
                $(".odPertoCil").html(Number(OdPerto.Cilindrico).toFixed(2).replace(".", ","));
                $(".odPertoEixo").html(OdPerto.Eixo);
                $(".odPertoPris").html(OdPerto.Prisma);
                $(".odPertoBase").html(Number(OdPerto.Base).toFixed(2).replace(".", ","));
                $(".odPertoDNP").html(Number(OdPerto.DIOD).toFixed(2).replace(".", ","));

                $(".oePertoAdc").html(Number(OePerto.Adicao).toFixed(2).replace(".", ","));
                $(".oePertoEsf").html(Number(OePerto.Esferico).toFixed(2).replace(".", ","));
                $(".oePertoCil").html(Number(OePerto.Cilindrico).toFixed(2).replace(".", ","));
                $(".oePertoEixo").html(OePerto.Eixo);
                $(".oePertoPris").html(OePerto.Prisma);
                $(".oePertoBase").html(Number(OePerto.Base).toFixed(2).replace(".", ","));
                $(".oePertoDNP").html(Number(OdPerto.DIOE).toFixed(2).replace(".", ","));

            } else {

                $(".oculosOuLente").append($("#lenteAumento").html());

                var lod = GeeksSQL("select Esferico, Cilindrico, Eixo, Adicao from DocumentoItem where TipoItem = 'LOD' and CodigoDocumento = 0" + item, false, url, banco, usuario);
                var loe = GeeksSQL("select Esferico, Cilindrico, Eixo, Adicao from DocumentoItem where TipoItem = 'LOE' and CodigoDocumento = 0" + item, false, url, banco, usuario);

                if (lod.Records[0] != null) {
                    $(".lodAdc").html(Number(lod.Records[0].Adicao).toFixed(2).replace(".", ","));
                    $(".lodEsf").html(Number(lod.Records[0].Eixo).toFixed(2).replace(".", ","));
                    $(".lodCil").html(Number(lod.Records[0].Cilindrico).toFixed(2).replace(".", ","));
                    $(".lodEixo").html(lod.Records[0].Esferico);
                }

                if (loe.Records[0] != null) {
                    $(".loeAdc").html(Number(loe.Records[0].Adicao).toFixed(2).replace(".", ","));
                    $(".loeEsf").html(Number(loe.Records[0].Eixo).toFixed(2).replace(".", ","));
                    $(".loeCil").html(Number(loe.Records[0].Cilindrico).toFixed(2).replace(".", ","));
                    $(".loeEixo").html(loe.Records[0].Esferico);
                }

            }

            var tipoOculos = GeeksSQL("select IsNull(TipoOculos,'-') TipoOculos from DocumentoItem where TipoItem = 'Armação' and CodigoDocumento = 0" + item, false, url, banco, usuario);

            if (tipoOculos.Records[0] == undefined)
                tipoOculos = "Lente Surfaçada";
            else
                tipoOculos = tipoOculos.Records[0].TipoOculos;

            $(".tipoOculos").html("Tipo de Óculos/Lente: " + tipoOculos);

            var dadosItens = GeeksSQL("select IsNull(I.CodigoBarras,'') CodigoBarras, I.Descricao, IsNull(I.Marca,'-') Marca, DI.CodigoDocumento, DI.TipoItem, DI.Quantidade, DI.SubTotal, DI.DescontoItem + DI.DescontoTotalRateado Desconto, DI.DescontoSubTotal, DI.DescontoTotalRateado from DocumentoItem DI inner join Item I on DI.CodigoItem = I.CodigoItem where DI.CodigoDocumento in (select CodigoDocumento from Documento where CodigoDocumentoAdicional = 0" + pedido + ") union select I.CodigoBarras, I.Descricao, IsNull(I.Marca,'-') Marca, DI.CodigoDocumento, DI.TipoItem, DI.Quantidade, DI.SubTotal, DI.DescontoItem + DI.DescontoTotalRateado Desconto, DI.DescontoSubTotal, DI.DescontoTotalRateado from DocumentoItem DI inner join Item I on DI.CodigoItem = I.CodigoItem where DI.CodigoDocumento = 0" + pedido + " order by I.Descricao", false, url, banco, usuario);

            var subtotal = 0.0;
            var desconto = 0.0;

            var subtotalgeral = 0.0;
            var descontogeral = 0.0;

            $(dadosItens.Records).each(function(index, row){

                if (row.CodigoDocumento == item) {

                    $(".tabela-produtos").append(
                        
                        $("#linhaTabelaItensVenda").html()
                        .replace("[codigo]", row.CodigoBarras)
                        .replace("[marca]", row.Marca)
                        .replace("[descricao]", row.Descricao)
                        .replace("[qtd]", row.Quantidade)
                        .replace("[valorProduto]", "R$ " + row.SubTotal.toFixed(2).replace('.', ','))
                    );

                    $(".tabela-produtos-lab").append(
                        
                        $("#linhaTabelaItensVenda").html()
                        .replace("[codigo]", row.CodigoBarras)
                        .replace("[marca]", row.Marca)
                        .replace("[descricao]", row.Descricao)
                        .replace("[qtd]", "")
                        .replace("[valorProduto]", "")
                    );

                    subtotal += row.SubTotal;
                    desconto += row.Desconto;

                }

                subtotalgeral += row.SubTotal;
                descontogeral += row.Desconto;

            });

            var total = subtotal - desconto;
            var totalgeral = subtotalgeral - descontogeral;
            var outrosProdutosVenda = subtotalgeral - subtotal;


            $(".subtotalProdutos").html("R$ " + subtotal.toFixed(2).replace('.', ','));
            $(".descontoProdutos").html("(-) R$ " + descontogeral.toFixed(2).replace('.', ','));
            $(".totalProdutos").html("R$ " + totalgeral.toFixed(2).replace('.', ','));
            $(".valorOutrosProdutos").html("(+) R$ " + outrosProdutosVenda.toFixed(2).replace('.', ','));

            var faturaPedido = GeeksSQL("select CodigoFatura from Documento where CodigoDocumento = 0" + pedido, false, url, banco, usuario).Records[0].CodigoFatura;

            if (faturaPedido == null || faturaPedido == undefined) {

                $(".valorOutrosPedidos").html("(+) R$ 0,00");
                $(".valorAReceber").html("R$ " + totalgeral.toFixed(2).replace(".", ","));

            } else {

                var formasPagamento = GeeksSQL("select D.CodigoFormaPagamento, Convert(varchar(10), D.DataVencimento, 103) + ' ' + Convert (varchar(10), D.DataVencimento, 108) DataVencimento, D.Valor, D.Sinal, F.Descricao from DocumentoCondicaoPagamento D inner join FormaPagamento F on D.CodigoFormaPagamento = F.CodigoFormaPagamento where D.CodigoDocumento = (select CodigoFatura from Documento where CodigoDocumento = 0" + pedido + ") order by Sinal desc", false, url, banco, usuario);

                var pedidosFatura = 0.0;

                $(formasPagamento.Records).each(function(index, row){

                    $(".tabela-totais").append(
                        $("#linhaTabelaFormaPgto").html()
                        .replace("[nomeFormaPgto]", row.Sinal == 1 ? "Sinal " + row.Descricao : row.Descricao)
                        .replace("[data]", row.DataVencimento)
                        .replace("[valorPgto]", row.Valor.toFixed(2).replace(".", ","))
                    );

                    pedidosFatura += row.Valor;

                });

                outrosPedidosFatura = pedidosFatura - totalgeral;
                $(".valorOutrosPedidos").html("(+) R$ " + outrosPedidosFatura.toFixed(2).replace('.', ','));

                var valorAReceber = pedidosFatura - (totalgeral + outrosPedidosFatura);
                $(".valorAReceber").html("R$ " + valorAReceber.toFixed(2).replace(".", ","));

            }

            var textoAssinatura = $(".textoAssinatura").html()
                    .replace("[nomeCliente]", dadosCliente.Records[0].Nome)
                    .replace("[nomeLoja]", dadosEmissor.Records[0].Nome)
                    .replace("[valorTotalOS]", "R$ " + totalgeral.toFixed(2).replace(".", ","));

            if ((dadosCliente.Records.TipoDocumentoNacional == null || dadosCliente.Records.NumeroDocumentoNacional == null) && dadosCliente.Records.NumeroDocumentoEstadual == null)
                textoAssinatura = textoAssinatura.replace("[documentos]", "");
            else if ((dadosCliente.Records.TipoDocumentoNacional == null || dadosCliente.Records.NumeroDocumentoNacional == null) && dadosCliente.Records.NumeroDocumentoEstadual != null)
                textoAssinatura = textoAssinatura.replace("[documentos]", "Portador do RG " + dadosCliente.Records.NumeroDocumentoEstadual + ", ");
            else if (dadosCliente.Records.TipoDocumentoNacional != null && dadosCliente.Records.NumeroDocumentoNacional != null && dadosCliente.Records.NumeroDocumentoEstadual == null)
                textoAssinatura = textoAssinatura.replace("[documentos]", "Portador do " + dadosCliente.Records.NumeroDocumentoEstadual + " " + dadosCliente.Records.NumeroDocumentoEstadual + ", ");
            else if (dadosCliente.Records.TipoDocumentoNacional != null && dadosCliente.Records.NumeroDocumentoNacional != null && dadosCliente.Records.NumeroDocumentoEstadual != null)
                textoAssinatura = textoAssinatura.replace("[documentos]", "Portador do " + dadosCliente.Records.NumeroDocumentoEstadual + " " + dadosCliente.Records.NumeroDocumentoEstadual + " e RG " + dadosCliente.Records.NumeroDocumentoEstadual + ", ");

            if (dadosCliente.Records.Endereco != null)
                textoAssinatura = textoAssinatura.replace("[endereco]", "residente na " + dadosCliente.Records[0].Endereco + ", ");
            else
                textoAssinatura = textoAssinatura.replace("[endereco]", "");

            $(".textoAssinatura").html(textoAssinatura);

            var dadosMedicoPaciente = GeeksSQL("Select d.CodigoDocumento, DescricaoContato Paciente, (Select Nome from Contato where CodigoContato = dc.CodigoContato) DescricaoMedico from Documento d left join DocumentoContato dc on d.CodigoDocumento = dc.CodigoDocumento and dc.Descricao = 'Medico' where d.CodigoDocumento = (Select Top 1 CodigoDocumentoAdicional from DocumentoItem where CodigoDocumento = 0" + item + ")", false, url, banco, usuario);

            if(dadosMedicoPaciente.Records[0] != undefined) {
                $(".nomePaciente").html(dadosMedicoPaciente.Records[0].Paciente);
                $(".nomeMedico").html(dadosMedicoPaciente.Records[0].DescricaoMedico); 
            }

        });

        </script>

        </body>

    </html>