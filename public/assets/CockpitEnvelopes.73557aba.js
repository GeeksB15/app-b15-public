import{_ as O,M as Q,p as D,o as p,d as E,x as m,f as o,w as t,B as N,E as $,i as C,D as v,aF as y,C as k,aj as S,ak as b,j as U,e as c,L as F,l as J,s as A,t as f,aB as V,cy as M,aK as g,b9 as I,ba as q,bb as d,aM as x,X as j,aY as T,ai as H,F as P,r as B,ah as z}from"./index.5f3d4c88.js";import{I as L}from"./Icone.de66e190.js";import{o as W}from"./open-url.1b543da1.js";import{J as K}from"./JsonViewer.6ea74840.js";const X={components:{Avatar:Q,Icone:L,JsonViewer:K},computed:{colunas(){return{envelopes:[{name:"nroVenda",label:"N.\xB0 Venda",field:"numero",align:"left"},{name:"nroEnvelope",label:"N.\xB0 Envelope",field:"numero",align:"left"},{name:"status",label:"Status",field:"status",sortable:!0,align:"left"},{name:"dataHoraPrevisto",label:"Previs\xE3o de Entrega",field:"dataHoraPrevisto",sortable:!0,align:"center"},{name:"nome",label:"Cliente",field:"nome",sortable:!0,align:"left"},{name:"telefone",label:"Telefone",field:"telefone",align:"left"},{name:"valor",label:"Valor",field:"valor",align:"left"},{name:"imprimir",field:"idVenda",align:"center"}]}}},data(){return{carregando:!0,cockpit:{envelopesAtrasados:[],envelopesHoje:[],envelopesAEntregar:[]},contato:{},empresas:[],nomesEmpresasSelecionadas:[],configImpressaoEnvelope:{},filtro:{codigoClienteSistema:"",codigoContatoUsuario:"",empresas:[],periodo:{ini:"",fim:""}}}},watch:{"$route.params.id"(){this.atualizar()}},methods:{irParaAtendimentoVenda(a){this.$router.push({name:"AtendimentoVenda",params:{id:a}})},async abrirTelefone(a){if(!a.telefone)return;const r=a.tipoTelefone==="WhatsApp"?"https://api.whatsapp.com/send?"+(a.aniversario?"text=Parab\xE9ns, "+a.nome+"&":"")+"phone=":"tel:+";W(r+await $utils.formatarTelefone(a))},async configuraImpressaoEnvelope(a){for(const r of a)if(!this.configImpressaoEnvelope[r.idEmpresa]){const n=await $db.configuracoes.porNome("impressao.envelope",r.idEmpresa),u=[...n.length?n.map(l=>({texto:"Imprimir Envelope",...l})):[{valor:"envelope",texto:"Imprimir Envelope"},{valor:"envelopeMini",texto:"Imprimir Envelope Mini"}]];this.configImpressaoEnvelope[r.idEmpresa]=u}},telefoneIcone(a){return{Celular:{color:"dark",name:"phone_iphone",size:"18px"},Comercial:{color:"dark",name:"phone",size:"18px"},Fixo:{color:"dark",name:"phone",size:"18px"},Principal:{color:"orange",name:"star",size:"18px"},WhatsApp:{cor:"whatsapp",nome:"whatsapp",tamanho:18}}[a]||{color:"dark",name:"phone",size:"18px"}},removerEmpresa(a){const r=this.empresas.find(n=>n.nome===a.value[0]);r&&(this.filtro.empresas=this.filtro.empresas.filter(n=>n!==r.codigoContato),this.filtrar())},selecionarEmpresa(a){this.filtro.empresas.includes(a.value)?this.nomesEmpresasSelecionadas=this.nomesEmpresasSelecionadas.slice(0,this.nomesEmpresasSelecionadas.length-1):(this.filtro.empresas.push(a.value),this.nomesEmpresasSelecionadas.splice(this.nomesEmpresasSelecionadas.length-1,1,a.label),this.filtrar())},async obterContatos(a){let r={};for(const n of a)if(n.idContato&&!r[n.idContato]){const u=await $erp().contato.get(n.idContato);u&&u.id&&(r[n.idContato]={imagem:u.imagem||""})}this.contato=r},async obterConsultaRecente(){await this.criarObjStoreIDB();const a=String(this.codigoClienteSistema)+"_"+String(this.codigoContatoUsuario)+"/envelopes";let r=await this.obterObjIDb(a);if(r){this.filtro={codigoClienteSistema:this.codigoClienteSistema,codigoContatoUsuario:this.codigoContatoUsuario,empresas:r.empresas,dataConsulta:new Date(r.dataConsulta),periodo:r.periodo},this.nomesEmpresasSelecionadas=[];for(const u of this.filtro.empresas){const l=this.empresas.find(i=>i.codigoContato===u);l&&this.nomesEmpresasSelecionadas.push(l.nome)}const n=r.dados;return await this.obterContatos([...n.envelopesAtrasados,...n.envelopesHoje,...n.envelopesAEntregar]),await this.configuraImpressaoEnvelope([...n.envelopesAtrasados,...n.envelopesHoje,...n.envelopesAEntregar]),this.acertarDatas(n),this.cockpit=n,!0}return!1},acertarDatas(a){const r=new Date(new Date().setHours(0,0,0,0)).toISOString().replace(/\d{4}-\d{2}-\d{2}/g,"");a.envelopesAtrasados.forEach(n=>{n.dataHoraPrevisto=(n.dataHoraPrevisto||"").replace(/T.+$/g,r)}),a.envelopesHoje.forEach(n=>{n.dataHoraPrevisto=(n.dataHoraPrevisto||"").replace(/T.+$/g,r)}),a.envelopesAEntregar.forEach(n=>{n.dataHoraPrevisto=(n.dataHoraPrevisto||"").replace(/T.+$/g,r)})},async salvarConsultaRecente(){await this.criarObjStoreIDB(),this.salvarObjIDb({id:String(this.filtro.codigoClienteSistema)+"_"+String(this.filtro.codigoContatoUsuario)+"/envelopes",periodo:this.filtro.periodo,dataConsulta:this.filtro.dataConsulta.toISOString(),empresas:this.filtro.empresas,dados:this.cockpit})},async criarObjStoreIDB(){if(!("indexedDB"in window)){console.log("Navegador sem suporte ao IndexedDB");return}let a=indexedDB.open("cockpit",1);return a.onupgradeneeded=function(r){var n=r.target.result;n.createObjectStore("consultasRecentes",{keyPath:"id"}).createIndex("id","id",{unique:!0})},new Promise((r,n)=>{a.onsuccess=function(u){r()},a.onerror=function(u){r()}})},salvarObjIDb(a){if(!("indexedDB"in window))return;let r,n,u;return r=new Promise((l,i)=>{u=l}),n=indexedDB.open("cockpit",1),n.onsuccess=function(){n=n.result.transaction(["consultasRecentes"],"readwrite").objectStore("consultasRecentes").put($utils.clonarV2(a)),n.onsuccess=function(h){u()},n.onerror=function(h){u()}},r},obterObjIDb(a){if(!("indexedDB"in window))return;let r,n,u;return r=new Promise((l,i)=>{u=l}),n=indexedDB.open("cockpit",1),n.onsuccess=function(){n=n.result.transaction(["consultasRecentes"],"readwrite").objectStore("consultasRecentes").get(a),n.onsuccess=function(h){u(h.target.result)},n.onerror=function(h){u()}},r},async filtrar(){this.carregando=!0,this.contato={},this.filtro.periodo.ini=new Date(this.filtro.periodo.ini).toISOString(),this.filtro.periodo.fim=new Date(this.filtro.periodo.fim).toISOString(),this.filtro.dataConsulta=new Date;let a=await this.$utils.geeksApi({"cockpit-envelopes":{funcao:"1A2281A1-795D-4ACE-8A8B-DFFE2CAEE2CA",codigoClienteSistema:this.filtro.codigoClienteSistema,codigoContatoUsuario:this.filtro.codigoContatoUsuario,empresas:this.filtro.empresas,periodo:this.filtro.periodo}});a=a.data["cockpit-envelopes"],await this.obterContatos([...a.envelopesAtrasados,...a.envelopesHoje,...a.envelopesAEntregar]),await this.configuraImpressaoEnvelope([...a.envelopesAtrasados,...a.envelopesHoje,...a.envelopesAEntregar]),this.acertarDatas(a),this.cockpit=a,this.salvarConsultaRecente(),this.carregando=!1},async atualizar(){try{let a,r,n;const u=this.$route.params.id;$utils.verificarErro(!u,"Id do contato n\xE3o encontrado"),n=(await $erp().contato.get(u)||{}).codigoContato,$utils.verificarErro(!n,"Contato n\xE3o encontrado"),a=JSON.parse(localStorage.getItem("clienteSistema"))||{},r=a.codigoClienteSistema,$utils.verificarErro(!r,"Cliente Sistema n\xE3o encontrado"),this.codigoClienteSistema=r,this.codigoContatoUsuario=n;let i=await $erp().empresa.toArray();this.empresas=i.map(w=>({codigoContato:w.codigoContato,nome:w.nome,apelido:w.apelido,numeroDocumentoNacional:w.numeroDocumentoNacional}));let h,_;h=new Date(new Date(new Date().setDate(1)).setHours(0,0,0,0)),_=new Date(new Date(new Date(h).setMonth(h.getMonth()+1)).setDate(0)),this.nomesEmpresasSelecionadas=[],this.filtro=JSON.parse(this.filtroT||null)||{codigoClienteSistema:this.codigoClienteSistema,codigoContatoUsuario:this.codigoContatoUsuario,empresas:[],dataConsulta:new Date,periodo:{ini:h,fim:_}},this.nomesEmpresasSelecionadas=[];for(const w of this.filtro.empresas){const e=this.empresas.find(s=>s.codigoContato===w);e&&this.nomesEmpresasSelecionadas.push(e.nome)}if(!this.filtroT&&await this.obterConsultaRecente()&&(this.carregando=!1,!(new Date-new Date(this.filtro.dataConsulta)>5*6e4)))return;this.filtrar()}catch(a){this.$q.notifyError("N\xE3o foi poss\xEDvel carregar os dados do cockpit",a)}},async mostrarJsonViewer(){await this.$refs.jsonViewer.show(this)}},props:{filtroT:String},mounted(){this.atualizar()}},Y={id:"cockpitenvelope"},G={class:"col-12"},Z={class:"filters row content-stretch justify-between q-pt-sm q-pr-sm q-mt-md q-mb-md q-col-gutter-x-sm bg-white",style:{"border-radius":"5px","min-height":"50px"}},ee={class:"col-11"},oe={class:"row q-mb-sm"},te={class:"row q-col-gutter-sm q-pb-md"},ae={class:"col-12",style:{float:"right"}},ne={style:{"font-size":"70%"}},re={class:"col-12"},ie={class:"row items-center"},se={class:"row items-center"},le={class:"row items-center"},ce={class:"row items-center"},de={class:"col-12"},me={class:"row items-center"},ue={class:"row items-center"},fe={class:"row items-center"},pe={class:"row items-center"},he={class:"col-12"},ve={class:"row items-center"},we={class:"row items-center"},Ce={class:"row items-center"},_e={class:"row items-center"};function ge(a,r,n,u,l,i){const h=D("q-chips-input"),_=D("avatar"),w=D("JsonViewer");return p(),E(P,null,[m("div",Y,[o(A,{class:"shadow-3 filters row no-shadow"},{default:t(()=>[m("div",G,[o(N,{"text-color":"black",class:"no-shadow q-pa-none",color:"transparent"},{default:t(()=>[o($,{class:"q-pa-none"},{default:t(()=>[m("div",Z,[m("div",ee,[m("div",oe,[o(h,{modelValue:l.nomesEmpresasSelecionadas,"onUpdate:modelValue":r[0]||(r[0]=e=>l.nomesEmpresasSelecionadas=e),color:"tertiary",class:"col q-mx-md",placeholder:"Filtre por Empresa",onRemove:i.removerEmpresa},null,8,["modelValue","onRemove"])])]),a.$db.usuario.desenvolvedor()?(p(),C(v,{key:0,icon:"more_vert",round:"",flat:""},{default:t(()=>[o(y,null,{default:t(()=>[k((p(),C(S,{clickable:"",onClick:r[1]||(r[1]=e=>i.mostrarJsonViewer())},{default:t(()=>[o(b,{avatar:""},{default:t(()=>[o(U,{name:"mdi-file-replace",size:"sm"})]),_:1}),o(b,null,{default:t(()=>[c("Ver Objeto")]),_:1})]),_:1})),[[F]])]),_:1})]),_:1})):J("",!0),o(v,{icon:"mdi-refresh",round:"",dense:"",flat:"",color:"tertiary",class:"no-shadow",onClick:i.filtrar},null,8,["onClick"])])]),_:1})]),_:1})])]),_:1}),m("div",te,[m("div",ae,[m("span",ne,[c(" Atualizado em: "+f(a.$filters.dataHora(this.filtro.dataConsulta))+" ",1),k(o(M,{color:"primary",size:20},null,512),[[V,l.carregando]])])]),m("div",re,[o(A,{inline:"",color:"white",class:"fit no-shadow"},{default:t(()=>[o(g,{class:"text-tertiary q-title q-pb-sm"},{default:t(()=>[c(" Atrasados ")]),_:1}),o(g,null,{default:t(()=>[k(o(I,{rows:l.cockpit.envelopesAtrasados,columns:i.colunas.envelopes,class:"no-shadow text-left"},{body:t(e=>[o(q,{props:e,style:{cursor:"pointer"}},{default:t(()=>[o(d,{key:"nroVenda",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:t(()=>[c(f(e.row.nroVenda),1)]),_:2},1032,["props","onClick"]),o(d,{key:"nroEnvelope",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:t(()=>[c(f(e.row.nroEnvelope),1)]),_:2},1032,["props","onClick"]),o(d,{key:"status",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:t(()=>[c(f(e.row.status),1)]),_:2},1032,["props","onClick"]),o(d,{key:"dataHoraPrevisto",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:t(()=>[c(f(a.$filters.data(e.row.dataHoraPrevisto)),1)]),_:2},1032,["props","onClick"]),o(d,{key:"nome",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:t(()=>[m("div",ie,[o(_,{imagem:(l.contato[e.row.idContato]||{}).imagem,rotulo:e.row.nome,tamanho:"40",class:"q-mr-sm"},null,8,["imagem","rotulo"]),c(" "+f(e.row.nome),1)])]),_:2},1032,["props","onClick"]),o(d,{key:"telefone",props:e,onClick:s=>i.abrirTelefone(e.row)},{default:t(()=>[m("div",se,[o(v,{color:"none",dense:"",flat:"",round:""},{default:t(()=>[(p(),C(x(e.row.tipoTelefone==="WhatsApp"?"icone":"q-icon"),j(T(i.telefoneIcone(e.row.tipoTelefone))),null,16))]),_:2},1024),c(" "+f(e.row.telefone),1)])]),_:2},1032,["props","onClick"]),o(d,{key:"valor",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:t(()=>[m("div",le,[o(v,{color:"none",class:"q-mx-xs",dense:"",flat:"",round:"",icon:"shopping_cart"}),c(" "+f(a.$filters.numero(e.row.valor||0,2)),1)])]),_:2},1032,["props","onClick"]),o(d,{key:"imprimir",props:e},{default:t(()=>[m("div",ce,[o(v,{rounded:"",dense:"",flat:"",icon:"print",color:"primary",class:"no-shadow q-ma-xs",size:"md",style:{float:"right"}},{default:t(()=>[o(y,null,{default:t(()=>[o(H,{link:"",separator:""},{default:t(()=>[(p(!0),E(P,null,B(l.configImpressaoEnvelope[e.row.idEmpresa],s=>(p(),C(S,{key:s.valor,onClick:R=>a.$imprimir(s.valor,e.row.idVenda||"0")},{default:t(()=>[o(b,{icon:"print"}),o(z,{label:s.texto},null,8,["label"])]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"]),[[V,!l.carregando]])]),_:1})]),_:1})]),m("div",de,[o(A,{inline:"",color:"white",class:"fit no-shadow"},{default:t(()=>[o(g,{class:"text-tertiary q-title q-pb-sm"},{default:t(()=>[c(" Para hoje ")]),_:1}),o(g,null,{default:t(()=>[k(o(I,{rows:l.cockpit.envelopesHoje,columns:i.colunas.envelopes,class:"no-shadow text-left"},{body:t(e=>[o(q,{props:e,style:{cursor:"pointer"}},{default:t(()=>[o(d,{key:"nroVenda",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:t(()=>[c(f(e.row.nroVenda),1)]),_:2},1032,["props","onClick"]),o(d,{key:"nroEnvelope",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:t(()=>[c(f(e.row.nroEnvelope),1)]),_:2},1032,["props","onClick"]),o(d,{key:"status",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:t(()=>[c(f(e.row.status),1)]),_:2},1032,["props","onClick"]),o(d,{key:"dataHoraPrevisto",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:t(()=>[c(f(a.$filters.data(e.row.dataHoraPrevisto)),1)]),_:2},1032,["props","onClick"]),o(d,{key:"nome",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:t(()=>[m("div",me,[o(_,{imagem:(l.contato[e.row.idContato]||{}).imagem,rotulo:e.row.nome,tamanho:"40",class:"q-mr-sm"},null,8,["imagem","rotulo"]),c(" "+f(e.row.nome),1)])]),_:2},1032,["props","onClick"]),o(d,{key:"telefone",props:e,onClick:s=>i.abrirTelefone(e.row)},{default:t(()=>[m("div",ue,[o(v,{color:"none",dense:"",flat:"",round:""},{default:t(()=>[(p(),C(x(e.row.tipoTelefone==="WhatsApp"?"icone":"q-icon"),j(T(i.telefoneIcone(e.row.tipoTelefone))),null,16))]),_:2},1024),c(" "+f(e.row.telefone),1)])]),_:2},1032,["props","onClick"]),o(d,{key:"valor",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:t(()=>[m("div",fe,[o(v,{color:"none",class:"q-mx-xs",dense:"",flat:"",round:"",icon:"shopping_cart"}),c(" "+f(a.$filters.numero(e.row.valor||0,2)),1)])]),_:2},1032,["props","onClick"]),o(d,{key:"imprimir",props:e},{default:t(()=>[m("div",pe,[o(v,{rounded:"",dense:"",flat:"",icon:"print",color:"primary",class:"no-shadow q-ma-xs",size:"md",style:{float:"right"}},{default:t(()=>[o(y,null,{default:t(()=>[o(H,{link:"",separator:""},{default:t(()=>[(p(!0),E(P,null,B(l.configImpressaoEnvelope[e.row.idEmpresa],s=>(p(),C(S,{key:s.valor,onClick:R=>a.$imprimir(s.valor,e.row.idVenda||"0")},{default:t(()=>[o(b,{icon:"print"}),o(z,{label:s.texto},null,8,["label"])]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"]),[[V,!l.carregando]])]),_:1})]),_:1})]),m("div",he,[o(A,{inline:"",color:"white",class:"fit no-shadow"},{default:t(()=>[o(g,{class:"text-tertiary q-title q-pb-sm"},{default:t(()=>[c(" A Entregar ")]),_:1}),o(g,null,{default:t(()=>[k(o(I,{rows:l.cockpit.envelopesAEntregar,columns:i.colunas.envelopes,class:"no-shadow text-left"},{body:t(e=>[o(q,{props:e,style:{cursor:"pointer"}},{default:t(()=>[o(d,{key:"nroVenda",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:t(()=>[c(f(e.row.nroVenda),1)]),_:2},1032,["props","onClick"]),o(d,{key:"nroEnvelope",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:t(()=>[c(f(e.row.nroEnvelope),1)]),_:2},1032,["props","onClick"]),o(d,{key:"status",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:t(()=>[c(f(e.row.status),1)]),_:2},1032,["props","onClick"]),o(d,{key:"dataHoraPrevisto",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:t(()=>[c(f(a.$filters.data(e.row.dataHoraPrevisto)),1)]),_:2},1032,["props","onClick"]),o(d,{key:"nome",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:t(()=>[m("div",ve,[o(_,{imagem:(l.contato[e.row.idContato]||{}).imagem,rotulo:e.row.nome,tamanho:"40",class:"q-mr-sm"},null,8,["imagem","rotulo"]),c(" "+f(e.row.nome),1)])]),_:2},1032,["props","onClick"]),o(d,{key:"telefone",props:e,onClick:s=>i.abrirTelefone(e.row)},{default:t(()=>[m("div",we,[o(v,{color:"none",dense:"",flat:"",round:""},{default:t(()=>[(p(),C(x(e.row.tipoTelefone==="WhatsApp"?"icone":"q-icon"),j(T(i.telefoneIcone(e.row.tipoTelefone))),null,16))]),_:2},1024),c(" "+f(e.row.telefone),1)])]),_:2},1032,["props","onClick"]),o(d,{key:"valor",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:t(()=>[m("div",Ce,[o(v,{color:"none",class:"q-mx-xs",dense:"",flat:"",round:"",icon:"shopping_cart"}),c(" "+f(a.$filters.numero(e.row.valor||0,2)),1)])]),_:2},1032,["props","onClick"]),o(d,{key:"imprimir",props:e},{default:t(()=>[m("div",_e,[o(v,{rounded:"",dense:"",flat:"",icon:"print",color:"primary",class:"no-shadow q-ma-xs",size:"md",style:{float:"right"}},{default:t(()=>[o(y,null,{default:t(()=>[o(H,{link:"",separator:""},{default:t(()=>[(p(!0),E(P,null,B(l.configImpressaoEnvelope[e.row.idEmpresa],s=>(p(),C(S,{key:s.valor,onClick:R=>a.$imprimir(s.valor,e.row.idVenda||"0")},{default:t(()=>[o(b,{icon:"print"}),o(z,{label:s.texto},null,8,["label"])]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"]),[[V,!l.carregando]])]),_:1})]),_:1})])])]),o(w,{ref:"jsonViewer"},null,512)],64)}var Se=O(X,[["render",ge]]);export{Se as default};
