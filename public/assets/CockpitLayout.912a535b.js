import{_ as k,M as C,bc as S,p as l,o as u,d as D,f as n,w as i,B as x,x as p,E as B,e as d,t as $,i as m,D as f,k as y,l as b,aF as V,C as I,aj as N,ak as h,j as q,L as P,H as O}from"./index.1304e793.js";import{M as Q}from"./MenuAbas.9f1624e8.js";import{J as R}from"./JsonViewer.c586dc59.js";const J={components:{Avatar:C,MenuAbas:Q,Tutorial:S,JsonViewer:R},data(){return{contato:{},permissoes:{},sistemaPai:""}},methods:{async atualizar(){try{await this.obterContatoUsuario()}catch(e){$q.notifyError("N\xE3o foi poss\xEDvel carregar os dados do cockpit",e)}},async criarObjStoreIDB(){if(!("indexedDB"in window)){console.log("Navegador sem suporte ao IndexedDB");return}let e=indexedDB.open("cockpit",1);return e.onupgradeneeded=function(a){var t=a.target.result;t.createObjectStore("consultasRecentes",{keyPath:"id"}).createIndex("id","id",{unique:!0})},new Promise((a,t)=>{e.onsuccess=function(o){a()},e.onerror=function(o){a()}})},salvarObjIDb(e){if(!("indexedDB"in window))return;let a,t,o;return a=new Promise((s,r)=>{o=s}),t=indexedDB.open("cockpit",1),t.onsuccess=function(){t=t.result.transaction(["consultasRecentes"],"readwrite").objectStore("consultasRecentes").put(e),t.onsuccess=function(c){o()},t.onerror=function(c){o()}},a},obterObjIDb(e){if(!("indexedDB"in window))return;let a,t,o;return a=new Promise((s,r)=>{o=s}),t=indexedDB.open("cockpit",1),t.onsuccess=function(){t=t.result.transaction(["consultasRecentes"],"readwrite").objectStore("consultasRecentes").get(e),t.onsuccess=function(c){o(c.target.result)},t.onerror=function(c){o()}},a},async obterContatoUsuario(){const e=JSON.parse(localStorage.getItem("usuario"))||{},a=this.$route.params.id,t=e.numeroDocumentoNacional;let o={};if(t){if(a&&(o=await $erp().contato.get(a)||{},(!o.ativo||o.excluido||o.numeroDocumentoNacional!==t)&&(o={})),!o.id){let s;s=await $erp().contato.where({numeroDocumentoNacional:t}).toArray(),o=s.find(r=>r.ativo&&!r.excluido&&r.codigoUsuario)||{}}this.selecionarContato(o)}if(!o.id){const s=await $g.promptContato.show({filtro:{ativo:!0,vendedores:!0},placeholder:"Selecione o usu\xE1rio"});$lodash.get(s,"id")&&this.selecionarContato(s)}},async btBuscar_click(){const e=await $g.promptContato.show({filtro:{ativo:!0,vendedores:!0},placeholder:"Selecione o usu\xE1rio"});$lodash.get(e,"id")&&this.selecionarContato(e)},selecionarContato(e){e.id&&(this.contato={id:e.id,nome:e.nome||"",apelido:e.apelido||"",imagem:e.imagem||""},this.$router.push({name:this.$route.name==="Cockpit"?"CockpitVendedor":this.$route.name,params:{id:e.id||""}}),this.salvarConsultaRecente())},async salvarConsultaRecente(){await this.criarObjStoreIDB();let e,a;e=JSON.parse(localStorage.getItem("clienteSistema"))||{},a=e.codigoClienteSistema,this.salvarObjIDb({id:a,idContato:this.contato.id})},async mostrarJsonViewer(){await this.$refs.jsonViewer.show(this)}},mounted(){this.permissoes={obterUsuario:!1,envelope:!1,vendas:!1,faturas:!1},$db.permissao.objeto("Diretiva_Cockpit_MudarUsuario").then(e=>{this.permissoes.obterUsuario=e}),$db.permissao.objeto("cockpit/envelope").then(e=>{this.permissoes.envelope=e}),$db.permissao.objeto("cockpit/vendas").then(e=>{this.permissoes.vendas=e}),$db.permissao.objeto("cockpit/faturas").then(e=>{this.permissoes.faturas=e}),this.sistemaPai=$utils.sistemaPai(),this.atualizar()}},T={class:"u-container"},U={class:"u-container"};function M(e,a,t,o,s,r){const c=l("avatar"),v=l("Tutorial"),_=l("row"),w=l("router-view"),g=l("MenuAbas"),j=l("JsonViewer");return u(),D("div",null,[n(O,null,{default:i(()=>[n(x,{class:"bg-gradiente text-white"},{default:i(()=>[p("div",T,[n(_,{class:"items-center q-mx-none q-px-none q-py-xs"},{default:i(()=>[n(c,{imagem:s.contato.imagem,rotulo:s.contato.apelido,tamanho:"40"},null,8,["imagem","rotulo"]),n(B,null,{default:i(()=>[d($(s.contato.nome),1)]),_:1}),s.permissoes.obterUsuario?(u(),m(f,{key:0,flat:"",dense:"",icon:"search",round:"",size:"md",onClick:r.btBuscar_click},{default:i(()=>[n(y,null,{default:i(()=>[d("Buscar vendedor/empresa")]),_:1})]),_:1},8,["onClick"])):b("",!0),n(v,{componente:"CockpitLayout"}),e.$db.usuario.desenvolvedor()?(u(),m(f,{key:1,icon:"more_vert",size:"md",round:"",flat:"",dense:""},{default:i(()=>[n(V,null,{default:i(()=>[I((u(),m(N,{clickable:"",onClick:a[0]||(a[0]=z=>r.mostrarJsonViewer())},{default:i(()=>[n(h,{avatar:""},{default:i(()=>[n(q,{name:"mdi-file-replace",size:"sm"})]),_:1}),n(h,null,{default:i(()=>[d("Ver Objeto")]),_:1})]),_:1})),[[P]])]),_:1})]),_:1})):b("",!0)]),_:1})])]),_:1}),n(g,{objetoPai:"cockpit"},{default:i(()=>[p("div",U,[n(w)])]),_:1})]),_:1}),n(j,{ref:"jsonViewer"},null,512)])}var F=k(J,[["render",M]]);export{F as default};
