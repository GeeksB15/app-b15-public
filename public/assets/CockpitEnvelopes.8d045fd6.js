import{_ as O,M as Q,p as P,o as p,d as E,x as m,f as o,w as a,B as N,E as $,i as C,D as v,aF as y,C as k,aj as S,ak as b,j as U,e as c,L as F,l as J,s as A,t as f,aB as V,cx as M,aK as _,b8 as I,b9 as q,ba as d,aM as x,X as j,aY as T,ai as H,F as D,r as B,ah as z}from"./index.1304e793.js";import{I as L}from"./Icone.878488b6.js";import{o as W}from"./open-url.8ff7b8d0.js";import{J as K}from"./JsonViewer.c586dc59.js";const X={components:{Avatar:Q,Icone:L,JsonViewer:K},computed:{colunas(){return{envelopes:[{name:"nroVenda",label:"N.\xB0 Venda",field:"numero",align:"left"},{name:"nroEnvelope",label:"N.\xB0 Envelope",field:"numero",align:"left"},{name:"status",label:"Status",field:"status",sortable:!0,align:"left"},{name:"dataHoraPrevisto",label:"Previs\xE3o de Entrega",field:"dataHoraPrevisto",sortable:!0,align:"center"},{name:"nome",label:"Cliente",field:"nome",sortable:!0,align:"left"},{name:"telefone",label:"Telefone",field:"telefone",align:"left"},{name:"valor",label:"Valor",field:"valor",align:"left"},{name:"imprimir",field:"idVenda",align:"center"}]}}},data(){return{carregando:!0,cockpit:{envelopesAtrasados:[],envelopesHoje:[],envelopesAEntregar:[]},contato:{},empresas:[],nomesEmpresasSelecionadas:[],configImpressaoEnvelope:{},filtro:{codigoClienteSistema:"",codigoContatoUsuario:"",empresas:[],periodo:{ini:"",fim:""}}}},watch:{"$route.params.id"(){this.atualizar()}},methods:{irParaAtendimentoVenda(t){this.$router.push({name:"AtendimentoVenda",params:{id:t}})},async abrirTelefone(t){if(!t.telefone)return;const r=t.tipoTelefone==="WhatsApp"?"https://api.whatsapp.com/send?"+(t.aniversario?"text=Parab\xE9ns, "+t.nome+"&":"")+"phone=":"tel:+";W(r+await $utils.formatarTelefone(t))},async configuraImpressaoEnvelope(t){for(const r of t)if(!this.configImpressaoEnvelope[r.idEmpresa]){const n=await $db.configuracoes.porNome("impressao.envelope",r.idEmpresa),u=[...n.length?n.map(l=>({texto:"Imprimir Envelope",...l})):[{valor:"envelope",texto:"Imprimir Envelope"},{valor:"envelopeMini",texto:"Imprimir Envelope Mini"}]];this.configImpressaoEnvelope[r.idEmpresa]=u}},formatarTelefone(t){return!t&&typeof t!="string"?t:"55"+t.replace(/\D/g,"").replace(/^55/,"")},telefoneIcone(t){return{Celular:{color:"dark",name:"phone_iphone",size:"18px"},Comercial:{color:"dark",name:"phone",size:"18px"},Fixo:{color:"dark",name:"phone",size:"18px"},Principal:{color:"orange",name:"star",size:"18px"},WhatsApp:{cor:"whatsapp",nome:"whatsapp",tamanho:18}}[t]||{color:"dark",name:"phone",size:"18px"}},removerEmpresa(t){const r=this.empresas.find(n=>n.nome===t.value[0]);r&&(this.filtro.empresas=this.filtro.empresas.filter(n=>n!==r.codigoContato),this.filtrar())},selecionarEmpresa(t){this.filtro.empresas.includes(t.value)?this.nomesEmpresasSelecionadas=this.nomesEmpresasSelecionadas.slice(0,this.nomesEmpresasSelecionadas.length-1):(this.filtro.empresas.push(t.value),this.nomesEmpresasSelecionadas.splice(this.nomesEmpresasSelecionadas.length-1,1,t.label),this.filtrar())},async obterContatos(t){let r={};for(const n of t)if(n.idContato&&!r[n.idContato]){const u=await $erp().contato.get(n.idContato);u&&u.id&&(r[n.idContato]={imagem:u.imagem||""})}this.contato=r},async obterConsultaRecente(){await this.criarObjStoreIDB();const t=String(this.codigoClienteSistema)+"_"+String(this.codigoContatoUsuario)+"/envelopes";let r=await this.obterObjIDb(t);if(r){this.filtro={codigoClienteSistema:this.codigoClienteSistema,codigoContatoUsuario:this.codigoContatoUsuario,empresas:r.empresas,dataConsulta:new Date(r.dataConsulta),periodo:r.periodo},this.nomesEmpresasSelecionadas=[];for(const u of this.filtro.empresas){const l=this.empresas.find(i=>i.codigoContato===u);l&&this.nomesEmpresasSelecionadas.push(l.nome)}const n=r.dados;return await this.obterContatos([...n.envelopesAtrasados,...n.envelopesHoje,...n.envelopesAEntregar]),await this.configuraImpressaoEnvelope([...n.envelopesAtrasados,...n.envelopesHoje,...n.envelopesAEntregar]),this.acertarDatas(n),this.cockpit=n,!0}return!1},acertarDatas(t){const r=new Date(new Date().setHours(0,0,0,0)).toISOString().replace(/\d{4}-\d{2}-\d{2}/g,"");t.envelopesAtrasados.forEach(n=>{n.dataHoraPrevisto=(n.dataHoraPrevisto||"").replace(/T.+$/g,r)}),t.envelopesHoje.forEach(n=>{n.dataHoraPrevisto=(n.dataHoraPrevisto||"").replace(/T.+$/g,r)}),t.envelopesAEntregar.forEach(n=>{n.dataHoraPrevisto=(n.dataHoraPrevisto||"").replace(/T.+$/g,r)})},async salvarConsultaRecente(){await this.criarObjStoreIDB(),this.salvarObjIDb({id:String(this.filtro.codigoClienteSistema)+"_"+String(this.filtro.codigoContatoUsuario)+"/envelopes",periodo:this.filtro.periodo,dataConsulta:this.filtro.dataConsulta.toISOString(),empresas:this.filtro.empresas,dados:this.cockpit})},async criarObjStoreIDB(){if(!("indexedDB"in window)){console.log("Navegador sem suporte ao IndexedDB");return}let t=indexedDB.open("cockpit",1);return t.onupgradeneeded=function(r){var n=r.target.result;n.createObjectStore("consultasRecentes",{keyPath:"id"}).createIndex("id","id",{unique:!0})},new Promise((r,n)=>{t.onsuccess=function(u){r()},t.onerror=function(u){r()}})},salvarObjIDb(t){if(!("indexedDB"in window))return;let r,n,u;return r=new Promise((l,i)=>{u=l}),n=indexedDB.open("cockpit",1),n.onsuccess=function(){n=n.result.transaction(["consultasRecentes"],"readwrite").objectStore("consultasRecentes").put($utils.clonarV2(t)),n.onsuccess=function(h){u()},n.onerror=function(h){u()}},r},obterObjIDb(t){if(!("indexedDB"in window))return;let r,n,u;return r=new Promise((l,i)=>{u=l}),n=indexedDB.open("cockpit",1),n.onsuccess=function(){n=n.result.transaction(["consultasRecentes"],"readwrite").objectStore("consultasRecentes").get(t),n.onsuccess=function(h){u(h.target.result)},n.onerror=function(h){u()}},r},async filtrar(){this.carregando=!0,this.contato={},this.filtro.periodo.ini=new Date(this.filtro.periodo.ini).toISOString(),this.filtro.periodo.fim=new Date(this.filtro.periodo.fim).toISOString(),this.filtro.dataConsulta=new Date;let t=await this.$utils.geeksApi({"cockpit-envelopes":{funcao:"1A2281A1-795D-4ACE-8A8B-DFFE2CAEE2CA",codigoClienteSistema:this.filtro.codigoClienteSistema,codigoContatoUsuario:this.filtro.codigoContatoUsuario,empresas:this.filtro.empresas,periodo:this.filtro.periodo}});t=t.data["cockpit-envelopes"],await this.obterContatos([...t.envelopesAtrasados,...t.envelopesHoje,...t.envelopesAEntregar]),await this.configuraImpressaoEnvelope([...t.envelopesAtrasados,...t.envelopesHoje,...t.envelopesAEntregar]),this.acertarDatas(t),this.cockpit=t,this.salvarConsultaRecente(),this.carregando=!1},async atualizar(){try{let t,r,n;const u=this.$route.params.id;$utils.verificarErro(!u,"Id do contato n\xE3o encontrado"),n=(await $erp().contato.get(u)||{}).codigoContato,$utils.verificarErro(!n,"Contato n\xE3o encontrado"),t=JSON.parse(localStorage.getItem("clienteSistema"))||{},r=t.codigoClienteSistema,$utils.verificarErro(!r,"Cliente Sistema n\xE3o encontrado"),this.codigoClienteSistema=r,this.codigoContatoUsuario=n;let i=await $erp().empresa.toArray();this.empresas=i.map(w=>({codigoContato:w.codigoContato,nome:w.nome,apelido:w.apelido,numeroDocumentoNacional:w.numeroDocumentoNacional}));let h,g;h=new Date(new Date(new Date().setDate(1)).setHours(0,0,0,0)),g=new Date(new Date(new Date(h).setMonth(h.getMonth()+1)).setDate(0)),this.nomesEmpresasSelecionadas=[],this.filtro=JSON.parse(this.filtroT||null)||{codigoClienteSistema:this.codigoClienteSistema,codigoContatoUsuario:this.codigoContatoUsuario,empresas:[],dataConsulta:new Date,periodo:{ini:h,fim:g}},this.nomesEmpresasSelecionadas=[];for(const w of this.filtro.empresas){const e=this.empresas.find(s=>s.codigoContato===w);e&&this.nomesEmpresasSelecionadas.push(e.nome)}if(!this.filtroT&&await this.obterConsultaRecente()&&(this.carregando=!1,!(new Date-new Date(this.filtro.dataConsulta)>5*6e4)))return;this.filtrar()}catch(t){this.$q.notifyError("N\xE3o foi poss\xEDvel carregar os dados do cockpit",t)}},async mostrarJsonViewer(){await this.$refs.jsonViewer.show(this)}},props:{filtroT:String},mounted(){this.atualizar()}},Y={id:"cockpitenvelope"},G={class:"col-12"},Z={class:"filters row content-stretch justify-between q-pt-sm q-pr-sm q-mt-md q-mb-md q-col-gutter-x-sm bg-white",style:{"border-radius":"5px","min-height":"50px"}},ee={class:"col-11"},oe={class:"row q-mb-sm"},te={class:"row q-col-gutter-sm q-pb-md"},ae={class:"col-12",style:{float:"right"}},ne={style:{"font-size":"70%"}},re={class:"col-12"},ie={class:"row items-center"},se={class:"row items-center"},le={class:"row items-center"},ce={class:"row items-center"},de={class:"col-12"},me={class:"row items-center"},ue={class:"row items-center"},fe={class:"row items-center"},pe={class:"row items-center"},he={class:"col-12"},ve={class:"row items-center"},we={class:"row items-center"},Ce={class:"row items-center"},ge={class:"row items-center"};function _e(t,r,n,u,l,i){const h=P("q-chips-input"),g=P("avatar"),w=P("JsonViewer");return p(),E(D,null,[m("div",Y,[o(A,{class:"shadow-3 filters row no-shadow"},{default:a(()=>[m("div",G,[o(N,{"text-color":"black",class:"no-shadow q-pa-none",color:"transparent"},{default:a(()=>[o($,{class:"q-pa-none"},{default:a(()=>[m("div",Z,[m("div",ee,[m("div",oe,[o(h,{modelValue:l.nomesEmpresasSelecionadas,"onUpdate:modelValue":r[0]||(r[0]=e=>l.nomesEmpresasSelecionadas=e),color:"tertiary",class:"col q-mx-md",placeholder:"Filtre por Empresa",onRemove:i.removerEmpresa},null,8,["modelValue","onRemove"])])]),t.$db.usuario.desenvolvedor()?(p(),C(v,{key:0,icon:"more_vert",round:"",flat:""},{default:a(()=>[o(y,null,{default:a(()=>[k((p(),C(S,{clickable:"",onClick:r[1]||(r[1]=e=>i.mostrarJsonViewer())},{default:a(()=>[o(b,{avatar:""},{default:a(()=>[o(U,{name:"mdi-file-replace",size:"sm"})]),_:1}),o(b,null,{default:a(()=>[c("Ver Objeto")]),_:1})]),_:1})),[[F]])]),_:1})]),_:1})):J("",!0),o(v,{icon:"mdi-refresh",round:"",dense:"",flat:"",color:"tertiary",class:"no-shadow",onClick:i.filtrar},null,8,["onClick"])])]),_:1})]),_:1})])]),_:1}),m("div",te,[m("div",ae,[m("span",ne,[c(" Atualizado em: "+f(t.$filters.dataHora(this.filtro.dataConsulta))+" ",1),k(o(M,{color:"primary",size:20},null,512),[[V,l.carregando]])])]),m("div",re,[o(A,{inline:"",color:"white",class:"fit no-shadow"},{default:a(()=>[o(_,{class:"text-tertiary q-title q-pb-sm"},{default:a(()=>[c(" Atrasados ")]),_:1}),o(_,null,{default:a(()=>[k(o(I,{rows:l.cockpit.envelopesAtrasados,columns:i.colunas.envelopes,class:"no-shadow text-left"},{body:a(e=>[o(q,{props:e,style:{cursor:"pointer"}},{default:a(()=>[o(d,{key:"nroVenda",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:a(()=>[c(f(e.row.nroVenda),1)]),_:2},1032,["props","onClick"]),o(d,{key:"nroEnvelope",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:a(()=>[c(f(e.row.nroEnvelope),1)]),_:2},1032,["props","onClick"]),o(d,{key:"status",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:a(()=>[c(f(e.row.status),1)]),_:2},1032,["props","onClick"]),o(d,{key:"dataHoraPrevisto",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:a(()=>[c(f(t.$filters.data(e.row.dataHoraPrevisto)),1)]),_:2},1032,["props","onClick"]),o(d,{key:"nome",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:a(()=>[m("div",ie,[o(g,{imagem:(l.contato[e.row.idContato]||{}).imagem,rotulo:e.row.nome,tamanho:"40",class:"q-mr-sm"},null,8,["imagem","rotulo"]),c(" "+f(e.row.nome),1)])]),_:2},1032,["props","onClick"]),o(d,{key:"telefone",props:e,onClick:s=>i.abrirTelefone(e.row)},{default:a(()=>[m("div",se,[o(v,{color:"none",dense:"",flat:"",round:""},{default:a(()=>[(p(),C(x(e.row.tipoTelefone==="WhatsApp"?"icone":"q-icon"),j(T(i.telefoneIcone(e.row.tipoTelefone))),null,16))]),_:2},1024),c(" "+f(e.row.telefone),1)])]),_:2},1032,["props","onClick"]),o(d,{key:"valor",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:a(()=>[m("div",le,[o(v,{color:"none",class:"q-mx-xs",dense:"",flat:"",round:"",icon:"shopping_cart"}),c(" "+f(t.$filters.numero(e.row.valor||0,2)),1)])]),_:2},1032,["props","onClick"]),o(d,{key:"imprimir",props:e},{default:a(()=>[m("div",ce,[o(v,{rounded:"",dense:"",flat:"",icon:"print",color:"primary",class:"no-shadow q-ma-xs",size:"md",style:{float:"right"}},{default:a(()=>[o(y,null,{default:a(()=>[o(H,{link:"",separator:""},{default:a(()=>[(p(!0),E(D,null,B(l.configImpressaoEnvelope[e.row.idEmpresa],s=>(p(),C(S,{key:s.valor,onClick:R=>t.$imprimir(s.valor,e.row.idVenda||"0")},{default:a(()=>[o(b,{icon:"print"}),o(z,{label:s.texto},null,8,["label"])]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"]),[[V,!l.carregando]])]),_:1})]),_:1})]),m("div",de,[o(A,{inline:"",color:"white",class:"fit no-shadow"},{default:a(()=>[o(_,{class:"text-tertiary q-title q-pb-sm"},{default:a(()=>[c(" Para hoje ")]),_:1}),o(_,null,{default:a(()=>[k(o(I,{rows:l.cockpit.envelopesHoje,columns:i.colunas.envelopes,class:"no-shadow text-left"},{body:a(e=>[o(q,{props:e,style:{cursor:"pointer"}},{default:a(()=>[o(d,{key:"nroVenda",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:a(()=>[c(f(e.row.nroVenda),1)]),_:2},1032,["props","onClick"]),o(d,{key:"nroEnvelope",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:a(()=>[c(f(e.row.nroEnvelope),1)]),_:2},1032,["props","onClick"]),o(d,{key:"status",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:a(()=>[c(f(e.row.status),1)]),_:2},1032,["props","onClick"]),o(d,{key:"dataHoraPrevisto",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:a(()=>[c(f(t.$filters.data(e.row.dataHoraPrevisto)),1)]),_:2},1032,["props","onClick"]),o(d,{key:"nome",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:a(()=>[m("div",me,[o(g,{imagem:(l.contato[e.row.idContato]||{}).imagem,rotulo:e.row.nome,tamanho:"40",class:"q-mr-sm"},null,8,["imagem","rotulo"]),c(" "+f(e.row.nome),1)])]),_:2},1032,["props","onClick"]),o(d,{key:"telefone",props:e,onClick:s=>i.abrirTelefone(e.row)},{default:a(()=>[m("div",ue,[o(v,{color:"none",dense:"",flat:"",round:""},{default:a(()=>[(p(),C(x(e.row.tipoTelefone==="WhatsApp"?"icone":"q-icon"),j(T(i.telefoneIcone(e.row.tipoTelefone))),null,16))]),_:2},1024),c(" "+f(e.row.telefone),1)])]),_:2},1032,["props","onClick"]),o(d,{key:"valor",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:a(()=>[m("div",fe,[o(v,{color:"none",class:"q-mx-xs",dense:"",flat:"",round:"",icon:"shopping_cart"}),c(" "+f(t.$filters.numero(e.row.valor||0,2)),1)])]),_:2},1032,["props","onClick"]),o(d,{key:"imprimir",props:e},{default:a(()=>[m("div",pe,[o(v,{rounded:"",dense:"",flat:"",icon:"print",color:"primary",class:"no-shadow q-ma-xs",size:"md",style:{float:"right"}},{default:a(()=>[o(y,null,{default:a(()=>[o(H,{link:"",separator:""},{default:a(()=>[(p(!0),E(D,null,B(l.configImpressaoEnvelope[e.row.idEmpresa],s=>(p(),C(S,{key:s.valor,onClick:R=>t.$imprimir(s.valor,e.row.idVenda||"0")},{default:a(()=>[o(b,{icon:"print"}),o(z,{label:s.texto},null,8,["label"])]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"]),[[V,!l.carregando]])]),_:1})]),_:1})]),m("div",he,[o(A,{inline:"",color:"white",class:"fit no-shadow"},{default:a(()=>[o(_,{class:"text-tertiary q-title q-pb-sm"},{default:a(()=>[c(" A Entregar ")]),_:1}),o(_,null,{default:a(()=>[k(o(I,{rows:l.cockpit.envelopesAEntregar,columns:i.colunas.envelopes,class:"no-shadow text-left"},{body:a(e=>[o(q,{props:e,style:{cursor:"pointer"}},{default:a(()=>[o(d,{key:"nroVenda",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:a(()=>[c(f(e.row.nroVenda),1)]),_:2},1032,["props","onClick"]),o(d,{key:"nroEnvelope",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:a(()=>[c(f(e.row.nroEnvelope),1)]),_:2},1032,["props","onClick"]),o(d,{key:"status",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:a(()=>[c(f(e.row.status),1)]),_:2},1032,["props","onClick"]),o(d,{key:"dataHoraPrevisto",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:a(()=>[c(f(t.$filters.data(e.row.dataHoraPrevisto)),1)]),_:2},1032,["props","onClick"]),o(d,{key:"nome",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:a(()=>[m("div",ve,[o(g,{imagem:(l.contato[e.row.idContato]||{}).imagem,rotulo:e.row.nome,tamanho:"40",class:"q-mr-sm"},null,8,["imagem","rotulo"]),c(" "+f(e.row.nome),1)])]),_:2},1032,["props","onClick"]),o(d,{key:"telefone",props:e,onClick:s=>i.abrirTelefone(e.row)},{default:a(()=>[m("div",we,[o(v,{color:"none",dense:"",flat:"",round:""},{default:a(()=>[(p(),C(x(e.row.tipoTelefone==="WhatsApp"?"icone":"q-icon"),j(T(i.telefoneIcone(e.row.tipoTelefone))),null,16))]),_:2},1024),c(" "+f(e.row.telefone),1)])]),_:2},1032,["props","onClick"]),o(d,{key:"valor",props:e,onClick:s=>i.irParaAtendimentoVenda(e.row.idContato)},{default:a(()=>[m("div",Ce,[o(v,{color:"none",class:"q-mx-xs",dense:"",flat:"",round:"",icon:"shopping_cart"}),c(" "+f(t.$filters.numero(e.row.valor||0,2)),1)])]),_:2},1032,["props","onClick"]),o(d,{key:"imprimir",props:e},{default:a(()=>[m("div",ge,[o(v,{rounded:"",dense:"",flat:"",icon:"print",color:"primary",class:"no-shadow q-ma-xs",size:"md",style:{float:"right"}},{default:a(()=>[o(y,null,{default:a(()=>[o(H,{link:"",separator:""},{default:a(()=>[(p(!0),E(D,null,B(l.configImpressaoEnvelope[e.row.idEmpresa],s=>(p(),C(S,{key:s.valor,onClick:R=>t.$imprimir(s.valor,e.row.idVenda||"0")},{default:a(()=>[o(b,{icon:"print"}),o(z,{label:s.texto},null,8,["label"])]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"]),[[V,!l.carregando]])]),_:1})]),_:1})])])]),o(w,{ref:"jsonViewer"},null,512)],64)}var Se=O(X,[["render",_e]]);export{Se as default};
