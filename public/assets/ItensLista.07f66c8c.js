import{_ as G,p as v,o as p,i as g,w as t,f as e,s as X,B as W,E as Y,e as f,x as C,aS as Fe,d as I,n as Ce,t as E,D as S,y as H,C as D,L as R,aK as re,z as Q,q,a$ as ge,U as fe,b0 as Qe,b1 as Ae,Q as se,aR as ze,l as _,F as P,r as O,M as qe,aT as Te,S as He,P as Je,aW as Xe,b2 as We,b3 as oe,aX as Ye,j as T,k as B,ax as Ze,J as $e,b4 as le,aG as je,aH as $,aZ as eo,a_ as ae,aB as ie,I as oo,V as ao,aC as to,aD as lo,an as io,b5 as ro,a5 as ve,a6 as Ee,b6 as so,a8 as no,b7 as mo,a7 as uo,a9 as co,aF as we,b8 as ye,b9 as po,ba as fo,am as L,ai as ne,aj as A,ak as w,ah as J,T as he,bb as _e,K as Oe,A as Re,G as Ne,H as Le,aQ as Be,u as ue,bc as ho,N as go,aE as Ve,al as Ue}from"./index.c3a09d8d.js";import{l as bo}from"./Lista.9913fd22.js";import{i as vo}from"./importarArquivoXlsx.d07b5673.js";import{Q as Vo}from"./QScrollArea.df71aea9.js";import{g as xe,a as Se,b as Ie}from"./g-label.e0d62fac.js";import{B as Co}from"./BadgeCopiarUid.46ebda31.js";import{Q as yo}from"./QSpinnerHourglass.0675ac35.js";import{c as _o}from"./codigosANP.a6c1a264.js";import{Q as qo}from"./QDate.362b03bf.js";import{Q as wo}from"./QTime.db515900.js";import{Q as ke}from"./QBtnToggle.eb7b5085.js";import{S as xo}from"./SeletorCfop.40efc6f5.js";import{J as Ge}from"./JsonViewer.438fbeb8.js";import{x as ce}from"./xlsx.062c5183.js";const So={descricao:{maxlength:"50",rotulo:"Descri\xE7\xE3o",tipo:"texto"},idContato:{rotulo:"Nome fornecedor",tipo:"texto"},referencia:{maxlength:"30",rotulo:"Refer\xEAncia",tipo:"texto"}},Io={idItemUtilizado:{rotulo:"Produto para composi\xE7\xE3o",tipo:"texto"},ordem:{max:"9999",min:"0",rotulo:"Ordem",tipo:"quantidade"},quantidade:{min:"0",rotulo:"Quantidade",tipo:"decimal",decimals:"4"},temporario:{total:{readonly:!0,rotulo:"Total",tipo:"decimal",decimals:"2"},unidade:{disable:!0,readonly:!0,rotuloFixo:"Unidade",tipo:"texto"},valor:{readonly:!0,rotulo:"Valor",tipo:"decimal",decimals:"2"}}},ko={descricao:{maxlength:"8000",rotulo:"Descri\xE7\xE3o",tipo:"texto"},idItemEquipamento:{rotulo:"Equipamento",tipo:"texto"},idItemFerramenta:{rotulo:"Ferramenta",tipo:"texto"},idItemServico:{rotulo:"Servico",tipo:"texto"},ordem:{max:"9999",min:"0",rotulo:"Ordem",tipo:"quantidade"}},Eo={descricao:{maxlength:"150",rotulo:"Descri\xE7\xE3o"},especificacao:{maxlength:"150",rotulo:"Especifica\xE7\xE3o"},limites:{maxlength:"150",rotulo:"Limites"}},Uo={altura:{rotulo:"Altura",tipo:"decimal",decimals:"0"},armacaoCor:{rotuloFixo:"Cor",tipo:"seletor"},armacaoMaterial:{rotuloFixo:"Material",tipo:"seletor"},diagonal:{rotulo:"Diagonal",tipo:"decimal",decimals:"0"},genero:{class:"col-12 col-md-6",rotuloFixo:"G\xEAnero",tipo:"seletor"},haste:{rotulo:"Haste",tipo:"decimal",decimals:"0"},modelo:{maxlength:"100",rotulo:"Modelo",tipo:"texto"},ponte:{rotulo:"Ponte",tipo:"decimal",decimals:"0"},largura:{maxlength:"100",rotulo:"Largura",tipo:"texto"},tipoMontagem:{rotuloFixo:"Tipo de montagem",tipo:"seletor"}},Po={aplicacao:{maxlength:"10000",rotulo:"Aplica\xE7\xE3o",rows:"2",tipo:"textoArea"},capacidade:{rotulo:"Capacidade",tipo:"decimal",decimals:"2"},capacidadeUnidade:{class:"col-12 col-md-3",maxlength:"20",rotulo:"Un. Capacidade",tipo:"texto"},codigoOrigem:{rotuloFixo:"Origem",tipo:"seletor",tipo2:"numerico"},densidade:{rotulo:"Densidade",tipo:"decimal",decimals:"2"},embalagem:{class:"col-12 col-md-3",maxlength:"255",rotulo:"Embalagem",tipo:"texto"},garantiaDescricao:{maxlength:"255",rotulo:"Garantia descri\xE7\xE3o",tipo:"texto"},garantiaDias:{class:"col-12 col-md-4",min:"0",max:"9999",rotulo:"Garantia (dias)",tipo:"quantidade"},grupo:{rotuloFixo:"Grupo",tipo:"seletor"},idPerfilContabil:{class:"col-12 col-md-4",rotulo:"Perfil cont\xE1bil",tipo:"seletor"},altura:{rotulo:"Altura",tipo:"decimal",decimals:"2"},largura:{rotulo:"Largura",tipo:"decimal",decimals:"2"},comprimento:{rotulo:"Comprimento",tipo:"decimal",decimals:"2"},observacao:{maxlength:"10000",rotulo:"Observa\xE7\xE3o",rows:"4",tipo:"textoArea"},peso:{rotulo:"Peso",tipo:"decimal",decimals:"2"},subGrupo:{rotuloFixo:"Subgrupo",tipo:"seletor"},unidade:{rotuloFixo:"Unidade",tipo:"seletor"},unidade__:{valorInicial:"UN"},validadeMeses:{class:"col-12 col-md-3",min:"0",max:"9999",rotulo:"Validade (meses)",tipo:"decimal",decimals:"2"}},Mo={consumoMedio:{min:"0",rotulo:"Consumo m\xE9dio",tipo:"decimal",decimals:"2"},local:{maxlength:"20",rotulo:"Local",tipo:"texto"},quantidadeMinimaCompra:{min:"0",rotulo:"Qtde compra reposi\xE7\xE3o",tipo:"decimal",decimals:"2"},quantidadeMinimaEstoque:{min:"0",rotulo:"Estoque m\xEDnimo",tipo:"decimal",decimals:"2"},tempoMedioReposicao:{min:"0",rotulo:"Tempo m\xE9dio reposi\xE7\xE3o (dias)",tipo:"quantidade"}},Do={codigoBarras:{errorMessage:"Deve ter 12 ou 13 d\xEDgitos",maxlength:"13",rotulo:"C\xF3digo de barras (GTIN ou EAN)",tipo:"texto"},descricao:{errorMessage:"O nome deve ter pelo menos 2 caracteres",maxlength:"500",rotulo:"Nome do produto",tipo:"texto"},marca:{rotuloFixo:"Marca",tipo:"seletor"},fabricante:{rotuloFixo:"Fabricante",tipo:"seletor"},ncm:{maxlength:"8",rotulo:"NCM",tipo:"texto"},catalogo:{maxlength:"8",rotulo:"Cat\xE1logo Fabricante",tipo:"texto"},percentualMarkup:{rotulo:"Lucro %",tipo:"decimal",decimals:"2"},referencia:{errorMessage:"Refer\xEAncia deve ser \xFAnica",maxlength:"30",rotulo:"Refer\xEAncia",tipo:"texto"},tipo:{rotuloFixo:"Tipo",tipo:"seletor"},utilizaComposicaoValorReposicao:{tipo:"logico"},utilizaMarkup:{tipo:"logico"},valorCustoReposicao:{rotulo:"Custo de reposi\xE7\xE3o",tipo:"decimal",decimals:"2"},valorVenda:{rotulo:"Valor de venda",tipo:"decimal",decimals:"2"}},Fo={adicaoFinal:{rotulo:"at\xE9",tipo:"decimal",decimals:"2"},adicaoInicial:{rotulo:"Adi\xE7\xE3o",tipo:"decimal",decimals:"2"},alturaMinima:{rotulo:"Altura m\xEDnima",tipo:"decimal",decimals:"0"},cilindrico:{rotulo:"Cil\xEDndrico",tipo:"decimal",decimals:"2"},cor:{rotuloFixo:"Cor",tipo:"seletor"},diametro:{rotulo:"Di\xE2metro",tipo:"decimal",decimals:"0"},eixo:{rotulo:"Eixo",tipo:"decimal",decimals:"2"},eixoFinal:{rotulo:"at\xE9",tipo:"decimal",decimals:"2"},esfericoFinal:{rotulo:"at\xE9",tipo:"decimal",decimals:"2"},esfericoInicial:{rotulo:"Esf\xE9rico",tipo:"decimal",decimals:"2"},geometria:{rotulo:"Geometria",tipo:"seletor"},indiceRefracao:{rotulo:"\xCDndice refra\xE7\xE3o",tipo:"decimal",decimals:"2"},lenteTipo:{rotulo:"Tipo de lente",tipo:"seletor"},material:{rotuloFixo:"Material",tipo:"seletor"},RB1:{rotulo:"RB1",tipo:"decimal",decimals:"2"},RB2:{rotulo:"RB2",tipo:"decimal",decimals:"2"},surfacada:{rotulo:"Pronta ou surfa\xE7ada",tipo:"seletor"}},Ao={procedimento:{maxlength:"10000",rotuloFixo:"Procedimento",rows:"3",tipo:"textoArea"},numeroPop:{maxlength:"50",rotulo:"N\xFAmero Pop",tipo:"texto"}},zo={ativo:{tipo:"logico"},consumoMedioReal:{tipo:"quantidade"},percentualMarkupReal:{tipo:"decimal",decimals:"2"},quantidadeDisponivel:{tipo:"quantidade"},tempoMedioReposicaoReal:{tipo:"quantidade"},utilizaComposicaoPedido:{tipo:"logico"},valorCusto:{tipo:"decimal",decimals:"2"},valorCustoMedio:{tipo:"decimal",decimals:"2"},valorCustoUltimo:{tipo:"decimal",decimals:"2"}},be={composicao:{lista:Io},fornecedor:{lista:So},producaoFase:{lista:ko},qualidade:{lista:Eo},...Uo,...Po,...Mo,...Do,...Fo,...zo,...Ao},To={alterados:0,arquivo:null,cor:"text-negative",corFinal:"",erro:"",erros:0,incluidos:0,listaErros:[],mensagem:"",mensagemFinal:"",modalResultado:!1},jo={data(){return{importar:$utils.clonarV2(To)}},emits:["update:modelValue"],methods:{beforeShow(){this.importar.arquivo=null,this.importar.mensagem="",this.importar.mensagemFinal="",this.importar.erro=""},hide(){this.$emit("update:modelValue",!1)},async prepareFile(l){const o=s=>new Promise((n,a)=>{const r=new FileReader;r.readAsBinaryString(s),r.onload=()=>n(r.result),r.onerror=u=>a(u)});try{const s=await o(l[0]);await this.importarArquivo(s),this.hide(),this.$q.notify({type:"positive",message:"Importa\xE7\xE3o realizada com sucesso"})}catch(s){this.importar.erro="Ocorreu erro ao importar produtos",this.$q.notifyError(this.importar.erro,s)}},templateDownload(){window.open("/statics/downloads/B15-Importar-ou-Atualizar-Produtos.xlsx","_self")},async importarArquivo(l){try{this.importar.modalResultado=!0,this.importar.mensagem="Carregando o arquivo .xlsx",this.importarLista=await $erp().item.toArray();const o={Item:be,ItemFornecedor:be.fornecedor.lista};await vo(l,o,this.importarCallbackParcial,this.importarCallbackErro,this.importarCallbackFinal)}catch(o){o.name&&o.name==="ErroValidacao"?(this.importar.erro=o.message,this.$q.notifyError(o.message,o)):(this.importar.erro="Ocorreu erro ao importar arquivo xlsx",this.$q.notifyError(this.importar.erro,o))}},async importarCallbackErro(l,o){this.importar.erros++,this.importar.listaErros.push({linha:l,mensagem:o})},async importarCallbackFinal(l){this.importar.incluidos+this.importar.alterados>0?this.importar.erros>0?(this.importar.corFinal="bg-warning",this.importar.mensagemFinal="Importa\xE7\xE3o realizada parcialmente!"):(this.importar.corFinal="bg-positive text-white",this.importar.mensagemFinal="Importa\xE7\xE3o conclu\xEDda com sucesso!"):this.importar.erros>0?(this.importar.corFinal="text-negative",this.importar.mensagemFinal="Importa\xE7\xE3o n\xE3o realizada!"):(this.importar.corFinal="bg-warning",this.importar.mensagemFinal="Importa\xE7\xE3o n\xE3o realizada!")},acertarFornecedores(l){for(const o of l.atual.fornecedor||[])o.id=$utils.uuid(),o.idItem=l.atual.id;for(const o of l.original.fornecedor||[]){let s=l.atual.fornecedor.find(n=>(n.idContato||"")===(o.idContato||"")&&(n.descricao||"")===(o.descricao||"")&&(n.referencia||"")===(o.referencia||""));s?s.id=o.id:l.atual.fornecedor.push(o)}},acertarCEST(l={}){const o=l.atual;if(!o)return;let s=(o.cest||"").replace(/\D/g,"").replace(/^(\d{2})(\d{3})(\d{2})/g,"$1.$2.$3").substr(0,9);o.cest=s&&s.length===9?s:""},acertarNCM(l={}){const o=l.atual;if(!o)return;const s=(o.ncm||"").replace(/\D/g,"").substr(0,8);o.ncm=s&&s.length===8?s:""},async importarCallbackParcial(l){const o=l.Item[0];l.ItemFornecedor&&(o.fornecedor=l.ItemFornecedor);const s=l.chaves.length>0?r=>l.chaves.reduce((u,d)=>u&&r[d]===o[d],!0):r=>!1,n=this.importarLista.filter(s);if(o.referencia){const r=this.importarLista.filter(u=>u.referencia===o.referencia);if(r.length>1)throw new $utils.ErroValidacao(`Refer\xEAncia deve ser \xFAnica (${o.referencia})`);if(r.length===1){if(n.length===0)throw new $utils.ErroValidacao(`Refer\xEAncia deve ser \xFAnica (${o.referencia})`);if(r[0].id!==n[0].id)throw new $utils.ErroValidacao(`Refer\xEAncia deve ser \xFAnica (${o.referencia})`)}}const a=$utils.dataAtual();if(n.length===0){const r={...$db.item.vazio,dataCadastro:a,_DataHoraUltimaAlteracao:a,...o,id:$utils.uuid()};let u={atual:r,original:{}};this.acertarNCM(u),this.acertarCEST(u),this.acertarFornecedores(u),await $db.item.grava(u),this.importarLista.push(r),this.importar.incluidos++}else if(n.length===1){let r=await $db.item.leCompleto(n[0].id);o.id=r.atual.id,Object.assign(r.atual,o),this.acertarNCM(r),this.acertarCEST(r),this.acertarFornecedores(r),await $db.item.grava(r),this.importar.alterados++}else{const r=l.chaves.map(u=>u+": "+o[u]).join(", ");throw new $utils.ErroValidacao(`Existem ${n.length} produtos no banco com a chave (${r})`)}}},props:{modelValue:{required:!0,type:Boolean}}},Oo={class:"q-pa-md"};function Ro(l,o,s,n,a,r){const u=v("row");return p(),g(H,{modelValue:s.modelValue,onBeforeShow:r.beforeShow,onHide:r.hide},{default:t(()=>[e(X,null,{default:t(()=>[e(W,{class:"text-tertiary"},{default:t(()=>[e(Y,null,{default:t(()=>[f(" Importar Produtos ")]),_:1})]),_:1}),C("div",Oo,[e(Fe,{label:"Selecione o arquivo (.xlsx)","hide-upload-btn":"","auto-upload":"",factory:r.prepareFile},null,8,["factory"]),a.importar.erro?(p(),I("div",{key:0,class:Ce(["row","q-pa-sm",a.importar.cor])},E(a.importar.erro),3)):(p(),g(u,{key:1,class:"q-mt-md justify-center"},{default:t(()=>[e(S,{color:"primary",flat:"",icon:"cloud_download",onClick:r.templateDownload,label:"Baixar arquivo modelo (.xlsx)"},null,8,["onClick"])]),_:1}))])]),_:1})]),_:1},8,["modelValue","onBeforeShow","onHide"])}var No=G(jo,[["render",Ro]]);const Lo={components:{},data(){return{campos:{marca:"",grupo:"",unidade:"",subgrupo:"",ncm:""},atualizado:{marca:"",grupo:"",unidade:"",subgrupo:"",ncm:""},opcoesMarca:[],opcoesSubgrupo:[],opcoesGrupo:[],opcoesUnidade:[],opcoesNcm:[],visivel:!1}},methods:{meta(){return be},adicionarMarca(){this.atualizado.marca=this.campos.marca},async leOpcoesMarca(){this.opcoesMarca=(await $db.item.leValoresUnicos("marca",this.campos.marca)).map(l=>({rotulo:l,valor:l}))},async salvarMarca(){const o=(await $db.item.leNew()).filter(n=>n.marca===this.campos.marca);let s=$utils.clonarV2(o);s.map(n=>{n.marca=this.atualizado.marca});try{for(let n=0;n<o.length;n++){let a=o[n],r=s[n];$db.item.gravaItem({original:a,atual:r})}}catch(n){this.$q.notifyError("Erro ao alterar marca"),console.log(n)}this.$q.notifyPositive("Marca alterada com sucesso em "+o.length+" itens."),this.campos.marca="",this.atualizado.marca=""},adicionarGrupo(){this.atualizado.grupo=this.campos.grupo},async leOpcoesGrupo(){this.opcoesGrupo=(await $db.item.leValoresUnicos("grupo",this.campos.grupo)).map(l=>({rotulo:l,valor:l}))},async salvarGrupo(){const o=(await $db.item.leNew()).filter(n=>n.grupo===this.campos.grupo);let s=$utils.clonarV2(o);s.map(n=>{n.grupo=this.atualizado.grupo});try{for(let n=0;n<o.length;n++){let a=o[n],r=s[n];$db.item.gravaItem({original:a,atual:r})}}catch(n){this.$q.notifyError("Erro ao alterar grupo"),console.log(n)}this.$q.notifyPositive("Grupo alterado com sucesso em "+o.length+" itens."),this.campos.grupo="",this.atualizado.grupo=""},adicionarSubgrupo(){this.atualizado.subgrupo=this.campos.subgrupo},async leOpcoesSubgrupo(){this.opcoesSubgrupo=(await $db.item.leValoresUnicos("subGrupo",this.campos.subgrupo)).map(l=>({rotulo:l,valor:l}))},async salvarSubgrupo(){const o=(await $db.item.leNew()).filter(n=>n.subGrupo===this.campos.subgrupo);let s=$utils.clonarV2(o);s.map(n=>{n.subGrupo=this.atualizado.subgrupo});try{for(let n=0;n<o.length;n++){let a=o[n],r=s[n];$db.item.gravaItem({original:a,atual:r})}}catch(n){this.$q.notifyError("Erro ao alterar subgrupo"),console.log(n)}this.$q.notifyPositive("Subgrupo alterado com sucesso em "+o.length+" itens."),this.campos.subgrupo="",this.atualizado.subgrupo=""},adicionarUnidade(){this.atualizado.unidade=this.campos.unidade},async leOpcoesUnidade(){this.opcoesUnidade=(await $db.item.leValoresUnicos("unidade",this.campos.unidade)).map(l=>({rotulo:l,valor:l}))},async salvarUnidade(){const o=(await $db.item.leNew()).filter(n=>n.unidade===this.campos.unidade);let s=$utils.clonarV2(o);s.map(n=>{n.unidade=this.atualizado.unidade});try{for(let n=0;n<o.length;n++){let a=o[n],r=s[n];$db.item.gravaItem({original:a,atual:r})}}catch(n){this.$q.notifyError("Erro ao alterar unidade"),console.log(n)}this.$q.notifyPositive("Unidade alterado com sucesso em "+o.length+" itens."),this.campos.unidade="",this.atualizado.unidade=""},adicionarNcm(){this.atualizado.ncm=this.campos.ncm},async leOpcoesNcm(){this.opcoesNcm=(await $db.item.leValoresUnicos("ncm",this.campos.ncm)).map(l=>({rotulo:l,valor:l}))},async salvarNcm(){const o=(await $db.item.leNew()).filter(n=>n.ncm===this.campos.ncm);let s=$utils.clonarV2(o);s.map(n=>{n.ncm=this.atualizado.ncm});try{for(let n=0;n<o.length;n++){let a=o[n],r=s[n];$db.item.gravaItem({original:a,atual:r})}}catch(n){this.$q.notifyError("Erro ao alterar ncm"),console.log(n)}this.$q.notifyPositive("NCM alterado com sucesso em "+o.length+" itens."),this.campos.ncm="",this.atualizado.ncm=""},concluir(){this.atualizado.marca&&this.salvarMarca(),this.atualizado.grupo&&this.salvarGrupo(),this.atualizado.subgrupo&&this.salvarSubgrupo(),this.atualizado.unidade&&this.salvarUnidade(),this.atualizado.ncm&&this.salvarNcm(),this.limparCampos(),this.visivel=!1},fechar(){this.limparCampos(),this.visivel=!1},limparCampos(){this.campos.unidade="",this.atualizado.unidade="",this.campos.subgrupo="",this.atualizado.subgrupo="",this.campos.grupo="",this.atualizado.grupo="",this.campos.marca="",this.atualizado.marca="",this.campos.ncm="",this.atualizado.ncm=""}},created(){this.limparCampos()}},Bo=C("div",{class:"q-mt-sm text-tertiary col-12 text-weight-bold"},"Marca",-1),Go={class:"col"},Ko={class:"col"},Qo={class:"col-auto"},Ho=C("div",{class:"q-mt-sm text-tertiary col-12 text-weight-bold"},"Grupo",-1),Jo={class:"col"},Xo={class:"col"},Wo={class:"col-auto"},Yo=C("div",{class:"q-mt-sm text-tertiary col-12 text-weight-bold"},"Subgrupo",-1),Zo={class:"col"},$o={class:"col"},ea={class:"col-auto"},oa=C("div",{class:"q-mt-sm text-tertiary col-12 text-weight-bold"},"Unidade",-1),aa={class:"col"},ta={class:"col"},la={class:"col-auto"},ia=C("div",{class:"q-mt-sm text-tertiary col-12 text-weight-bold"},"NCM",-1),ra={class:"col"},sa={class:"col"},na={class:"col-auto"};function da(l,o,s,n,a,r){const u=v("campo"),d=v("row");return p(),g(H,{modelValue:a.visivel,"onUpdate:modelValue":o[10]||(o[10]=c=>a.visivel=c)},{default:t(()=>[e(X,{class:"q-pa-none"},{default:t(()=>[e(W,{class:"text-white bg-primary"},{default:t(()=>[e(Y,null,{default:t(()=>[f(" Editar ")]),_:1}),D(e(S,{dense:"",flat:"",icon:"close"},null,512),[[R]])]),_:1}),e(re,{class:"q-px-md q-pb-md"},{default:t(()=>[e(Q,{class:"q-pb-md"},{default:t(()=>[e(d,{class:"justify-between q-col-gutter-x-sm"},{default:t(()=>[Bo,C("div",Go,[e(u,q({modelValue:a.campos.marca,"onUpdate:modelValue":o[0]||(o[0]=c=>a.campos.marca=c),filter:"",rotulo:"De"},r.meta.marca,{opcoes:a.opcoesMarca,tipo:"seletor",after:[{icon:"search"}],onClick:r.leOpcoesMarca,"onUpdate:modelValue":r.adicionarMarca}),null,16,["modelValue","opcoes","onClick","onUpdate:modelValue"])]),C("div",Ko,[e(u,{modelValue:a.atualizado.marca,"onUpdate:modelValue":o[1]||(o[1]=c=>a.atualizado.marca=c),rotulo:"Para"},null,8,["modelValue"])]),C("div",Qo,[e(S,{unelevated:"",color:"primary",label:"Trocar",onClick:r.salvarMarca},null,8,["onClick"])]),Ho,C("div",Jo,[e(u,q({modelValue:a.campos.grupo,"onUpdate:modelValue":o[2]||(o[2]=c=>a.campos.grupo=c),rotulo:"De",filter:""},r.meta.grupo,{opcoes:a.opcoesGrupo,tipo:"seletor",after:[{icon:"search"}],onClick:r.leOpcoesGrupo,"onUpdate:modelValue":r.adicionarGrupo}),null,16,["modelValue","opcoes","onClick","onUpdate:modelValue"])]),C("div",Xo,[e(u,{modelValue:a.atualizado.grupo,"onUpdate:modelValue":o[3]||(o[3]=c=>a.atualizado.grupo=c),rotulo:"Para"},null,8,["modelValue"])]),C("div",Wo,[e(S,{unelevated:"",color:"primary",label:"Trocar",onClick:r.salvarGrupo},null,8,["onClick"])]),Yo,C("div",Zo,[e(u,q({modelValue:a.campos.subgrupo,"onUpdate:modelValue":o[4]||(o[4]=c=>a.campos.subgrupo=c),rotulo:"De",filter:""},r.meta.subgrupo,{opcoes:a.opcoesSubgrupo,tipo:"seletor",after:[{icon:"search"}],onClick:r.leOpcoesSubgrupo,"onUpdate:modelValue":r.adicionarSubgrupo}),null,16,["modelValue","opcoes","onClick","onUpdate:modelValue"])]),C("div",$o,[e(u,{modelValue:a.atualizado.subgrupo,"onUpdate:modelValue":o[5]||(o[5]=c=>a.atualizado.subgrupo=c),rotulo:"Para"},null,8,["modelValue"])]),C("div",ea,[e(S,{unelevated:"",color:"primary",label:"Trocar",onClick:r.salvarSubgrupo},null,8,["onClick"])]),oa,C("div",aa,[e(u,q({modelValue:a.campos.unidade,"onUpdate:modelValue":o[6]||(o[6]=c=>a.campos.unidade=c),rotulo:"De",filter:""},r.meta.unidade,{opcoes:a.opcoesUnidade,tipo:"seletor",after:[{icon:"search"}],onClick:r.leOpcoesUnidade,"onUpdate:modelValue":r.adicionarUnidade}),null,16,["modelValue","opcoes","onClick","onUpdate:modelValue"])]),C("div",ta,[e(u,{modelValue:a.atualizado.unidade,"onUpdate:modelValue":o[7]||(o[7]=c=>a.atualizado.unidade=c),rotulo:"Para"},null,8,["modelValue"])]),C("div",la,[e(S,{unelevated:"",color:"primary",label:"Trocar",onClick:r.salvarUnidade},null,8,["onClick"])]),ia,C("div",ra,[e(u,q({modelValue:a.campos.ncm,"onUpdate:modelValue":o[8]||(o[8]=c=>a.campos.ncm=c),rotulo:"De",filter:""},r.meta.ncm,{opcoes:a.opcoesNcm,tipo:"seletor",after:[{icon:"search"}],onClick:r.leOpcoesNcm,"onUpdate:modelValue":r.adicionarNcm}),null,16,["modelValue","opcoes","onClick","onUpdate:modelValue"])]),C("div",sa,[e(u,{modelValue:a.atualizado.ncm,"onUpdate:modelValue":o[9]||(o[9]=c=>a.atualizado.ncm=c),rotulo:"Para"},null,8,["modelValue"])]),C("div",na,[e(S,{unelevated:"",color:"primary",label:"Trocar",onClick:r.salvarNcm},null,8,["onClick"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}var ma=G(Lo,[["render",da]]);const ua={data(){return{visivel:!1,descricao:"",tipo:"",opcoesTipo:[]}},methods:{async criar(){try{this.$q.loading.show();const l={...$db.item.vazio,id:$utils.uuid(),descricao:(this.descricao||"").trim(),tipo:this.tipo};await $db.item.grava({atual:l}),this.resolve(l),this.visivel=!1}catch(l){$q.notifyError("Ocorreu erro ao adicionar Produto",l)}finally{$q.loading.hide()}},onHide(){this.resolve({})},show(){return this.opcoesTipo=ge,this.tipo=this.opcoesTipo[0].valor,this.descricao="",this.texto="",this.erro="",this.visivel=!0,new Promise((l,o)=>{this.resolve=l})}}},ca={class:"layout-padding"},pa={class:"col-12"},fa={class:"col-12"},ha={class:"q-mt-lg text-right"};function ga(l,o,s,n,a,r){const u=v("campo"),d=v("row");return p(),g(H,{modelValue:a.visivel,"onUpdate:modelValue":o[2]||(o[2]=c=>a.visivel=c),onHide:o[3]||(o[3]=c=>r.onHide())},{default:t(()=>[e(X,{class:"q-dialog-plugin"},{default:t(()=>[e(W,{class:"bg-primary text-white"},{default:t(()=>[e(Y,null,{default:t(()=>[f("Cadastrar produto")]),_:1}),D(e(S,{dense:"",flat:"",icon:"close",round:""},null,512),[[R]])]),_:1}),C("div",ca,[e(Q,{class:"q-pa-md",onSubmit:r.criar},{default:t(()=>[e(d,{class:"items-center q-col-gutter-md"},{default:t(()=>[C("div",pa,[e(u,{modelValue:a.descricao,"onUpdate:modelValue":o[0]||(o[0]=c=>a.descricao=c),autofocus:"",class:"row",rules:[c=>!!c.trim()||"Campo obrigat\xF3rio"]},null,8,["modelValue","rules"])]),C("div",fa,[e(u,{modelValue:a.tipo,"onUpdate:modelValue":o[1]||(o[1]=c=>a.tipo=c),opcoes:a.opcoesTipo,class:"row",rotulo:"Tipo",tipo:"seletor"},null,8,["modelValue","opcoes"])])]),_:1}),C("div",ha,[D(e(S,{color:"tertiary",flat:"",label:"Cancelar"},null,512),[[R]]),e(S,{color:"primary",class:"text-white",unelevated:"",label:"Criar",type:"submit"})])]),_:1},8,["onSubmit"])])]),_:1})]),_:1},8,["modelValue"])}var ba=G(ua,[["render",ga]]);const va={data(){return{modal:{}}},methods:{limparModal(){this.modal={visivel:!1,campos:{},optsParceiro:[],optsSincronismo:[{label:"Ativar os itens filtrados",value:"exportarFiltrados"},{label:"Ativar os itens da p\xE1gina atual",value:"exportarPaginaAtual"},{label:"Importar",value:"importar"},{label:"Exportar Estoque (todos os itens)",value:"exportarEstoque"}]}},continuar(){~["exportarFiltrados","exportarPaginaAtual"].indexOf(this.modal.campos.direcaoSincronismo)&&this.exportar(),this.modal.campos.direcaoSincronismo==="importar"&&this.importar(),this.modal.campos.direcaoSincronismo==="exportarEstoque"&&this.exportarEstoque()},async exportar(){var s,n;const l=this.eCommerce.find(a=>a.id===this.modal.campos.parceiro);let o;this.modal.campos.direcaoSincronismo==="exportarFiltrados"&&(o=await $db.item.ler({filtros:this.filtros,somenteDadosIndexados:!0})),this.modal.campos.direcaoSincronismo==="exportarPaginaAtual"&&(o=await $db.item.ler({filtros:this.filtros,limit:this.limit,page:this.page,sort:this.sort}));for(const a of(s=o==null?void 0:o.data)!=null?s:[]){const r=(n=await $db.item.ler({filtros:{id:a.id}}))==null?void 0:n.data[0],u=(await $db.itemECommerce.ler({idItem:r.id,idECommerce:l.id}))[0];let d=$utils.clonarV2(u);d&&!d.valorVendaAtivo&&(d.valorVenda=r.valorVenda),d||(d={id:$utils.uuid(),idECommerce:l.id,idItem:r.id,idItemNoECommerce:"",descricao:r.descricao,valorVenda:r.valorVenda,valorVendaAtivo:!1,json:JSON.stringify({})}),d.ativo=!0;try{if($q.loading.show({message:`<code>Exportando...${r.id.slice(-6)}
                <br />
                ${r.descricao.slice(0,15)+(r.descricao.length>15?"...":"")}</code>`,html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"}),o=await $db.itemECommerce.enviarItem({itemECommerce:d,eCommerce:l,itemGeeks:r}),!(o!=null&&o.id))continue;d.idItemNoECommerce=o==null?void 0:o.id,await $db.itemECommerce.gravar({atual:d,original:u})}catch(c){console.error(c)}}this.limparModal(),$q.loading.hide()},toDataUrl(l,o){const s=new XMLHttpRequest;s.onload=function(){const n=new FileReader;n.onloadend=function(){o(n.result)},n.readAsDataURL(s.response)},s.open("GET",l),s.responseType="blob",s.send()},async exportarEstoque(){try{$q.loading.show(),await $db.itemECommerce.exportarEstoque(),this.limparModal()}finally{$q.loading.hide()}},async importar(){var s,n,a,r,u,d,c,b,m,V,U,x,y;const l=this.eCommerce.find(M=>M.id===this.modal.campos.parceiro);let o;$q.loading.show(),o=await $db.item.ler({filtros:{ativo:!0},somenteDadosIndexados:!0});for(const M of(s=o==null?void 0:o.data)!=null?s:[])try{const j=(n=await $db.item.ler({filtros:{id:M.id}}))==null?void 0:n.data[0],F=(await $db.itemECommerce.ler({idItem:j.id,idECommerce:l.id}))[0];let N=$utils.clonarV2(F);if(o=await $db.itemECommerce.obterItem({itemGeeks:j,itemECommerce:N,eCommerce:l}),!(o!=null&&o.id))continue;$q.loading.show({message:`<code>Importando...${j.id.slice(-6)}
                <br />
                ${j.descricao.slice(0,15)+(j.descricao.length>15?"...":"")}</code>`,html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"}),N||(N={id:$utils.uuid(),idECommerce:l.id,idItem:j.id,json:JSON.stringify({})}),N.idItemNoECommerce=o.id,N.descricao=o[l.json.sincronismo.dePara.descricao],N.valorVenda=o[l.json.sincronismo.dePara.valorVenda],N.valorVendaAtivo=!0,await $db.itemECommerce.gravar({atual:N,original:F})}catch(j){console.error(j)}try{const M=await $db.itemECommerce.obterCategorias({eCommerce:l}),j=$db.itemECommerce.getTiposGeeksCategoriasTray();o=await $db.itemECommerce.obterItens({eCommerce:l});for(const F of o){const N=(await $db.itemECommerce.ler({idItemNoECommerce:F.id}))[0];if(!$utils.clonarV2(N)){let i,h;const k=(r=(a=M.find(K=>K.id===F.all_categories[0]))==null?void 0:a.name)!=null?r:"";for(const K of Object.keys(j))if(j[K]===k){h=K;break}const z={id:$utils.uuid(),tipo:h};for(const K of Object.keys(l.json.sincronismo.dePara)){if(K==="codigoItem")continue;const ee=l.json.sincronismo.dePara[K],Z=(d=(u=l.json.sincronismo.deParaTipo)==null?void 0:u[K])!=null?d:"string";if(~ee.indexOf("Properties.")){const me=ee.split(".")[1];if(!(me in F.Properties))continue;Z==="string"&&(z[K]=String(F.Properties[me]).trim()),Z==="number"&&(z[K]=(c=Number(F.Properties[me]))!=null?c:0),Z==="boolean"&&(z[K]=F.Properties[me]==="1");continue}Z==="string"&&(z[K]=String((b=F[ee])!=null?b:"").trim()),Z==="number"&&(z[K]=(m=Number(F[ee]))!=null?m:0),Z==="boolean"&&(z[K]=F[ee]==="1")}z.peso=$utils.arredondar((Number(F.weight)||0)/1e3,3),z.comprimento=$utils.arredondar((Number(F.length)||0)*10,2),z.altura=Number((V=F.Properties)==null?void 0:V["Altura da Arma\xE7\xE3o"])||0,z.altura||(z.altura=$utils.arredondar((Number(F.height)||0)*10,2)),z.largura=Number((U=F.Properties)==null?void 0:U["Largura da Arma\xE7\xE3o"])||0,z.largura||(z.largura=$utils.arredondar((Number(F.width)||0)*10,2)),$q.loading.show({message:`<code>Importando...${z.id.slice(-6)}
                <br />
                ${z.descricao.slice(0,15)+(z.descricao.length>15?"...":"")}</code>`,html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"}),(y=(x=F==null?void 0:F.ProductImage)==null?void 0:x[0])!=null&&y.http&&await new Promise((K,ee)=>{this.toDataUrl(F.ProductImage[0].http,function(Z){z.imagem=Z,K()})}),i={id:$utils.uuid(),idECommerce:l.id,idItem:z.id,idItemNoECommerce:F.id,descricao:z.descricao,valorVenda:z.valorVenda,valorVendaAtivo:!1,ativo:!0,json:JSON.stringify({})},await $db.item.gravaItem({atual:z}),await $db.itemECommerce.gravar({atual:i})}}}catch(M){console.error(M)}this.limparModal(),$q.loading.hide()},async show(l){var o;try{const{filtros:s,limit:n,page:a,sort:r}=l!=null?l:{};let u;this.filtros=s,this.limit=n,this.page=a,this.sort=r,this.limparModal(),this.modal.campos.direcaoSincronismo="exportarFiltrados",u=await $db.eCommerce.ler(),u.sort((d,c)=>new Date(d.dataHoraCriacao)<new Date(c.dataHoraCriacao)?-1:1);for(const d of u)!d.ativo||(d.json=JSON.parse(d.json),this.modal.optsParceiro.push({label:d.descricao,value:d.id}));this.eCommerce=u,this.modal.campos.parceiro=(o=this.modal.optsParceiro[0])==null?void 0:o.value,this.modal.visivel=!0}catch(s){$q.notifyError("Erro ao consultar dados de e-commerce",s)}}}},Va={class:"layout-padding"},Ca={class:"q-mt-lg text-right q-gutter-sm"};function ya(l,o,s,n,a,r){return p(),g(H,{modelValue:a.modal.visivel,"onUpdate:modelValue":o[2]||(o[2]=u=>a.modal.visivel=u),class:""},{default:t(()=>[e(X,{class:"q-dialog-plugin"},{default:t(()=>[e(W,{class:"bg-primary text-white"},{default:t(()=>[e(Y,null,{default:t(()=>[f("e-Commerce")]),_:1}),D(e(S,{dense:"",flat:"",icon:"close",round:""},null,512),[[R]])]),_:1}),C("div",Va,[e(Q,{class:"q-pa-md",onSubmit:r.continuar},{default:t(()=>[e(X,{flat:""},{default:t(()=>[e(re,null,{default:t(()=>[e(fe,{"transition-show":"jump-up","transition-hide":"jump-up",dense:"",modelValue:a.modal.campos.parceiro,"onUpdate:modelValue":o[0]||(o[0]=u=>a.modal.campos.parceiro=u),"emit-value":"","map-options":"",options:a.modal.optsParceiro,hint:"Parceiro"},null,8,["modelValue","options"])]),_:1}),e(re,null,{default:t(()=>[e(Qe,{options:a.modal.optsSincronismo,type:"radio",modelValue:a.modal.campos.direcaoSincronismo,"onUpdate:modelValue":o[1]||(o[1]=u=>a.modal.campos.direcaoSincronismo=u)},null,8,["options","modelValue"])]),_:1})]),_:1}),C("div",Ca,[D(e(S,{color:"tertiary",flat:"",label:"Cancelar"},null,512),[[R]]),e(S,{color:"primary",class:"text-white",unelevated:"",label:"continuar",type:"submit"})])]),_:1},8,["onSubmit"])])]),_:1})]),_:1},8,["modelValue"])}var _a=G(va,[["render",ya]]);const qa={name:"ModalCombinarItens",components:{PromptItemV2:Ae},data(){return{itemCombinado:{origem:{},destino:{},prompt:{origem:!1,destino:!1}}}},methods:{async combinarItens(){this.combinarItensModal=!1;try{await this.$q.dialog({message:"Ao continuar voc\xEA ir\xE1 combinar todas as informa\xE7\xF5es dos dois produtos em apenas um produto.",title:"Tem certeza?",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Combinar",push:!0,class:"bg-negative",textColor:"white",flat:!0}})}catch{this.itemCombinado.origem={},this.itemCombinado.destino={};return}this.$q.loading.show();try{const l=await this.$utils.geeksApi({combinarProdutos:{funcao:"0FE624BB-1D3C-4D37-8F47-D303AAC8B98E",idItemCombinar:this.itemCombinado.destino.id,idItemRemover:this.itemCombinado.origem.id}});this.$q.notifyPositive(l.data.combinarProdutos.mensagem),this.visibilidade=!1}catch(l){this.$q.notifyError("Ocorreu um erro ao combinar produtos",l)}finally{this.$q.loading.hide()}},async selecionarCombinarItensOrigem(l){for(let o in l)this.itemCombinado.origem=l[o].item},selecionarCombinarItensDestino(l){for(let o in l)this.itemCombinado.destino=l[o].item}},props:{modelValue:{required:!0,type:Boolean}}},wa={class:"row justify-end q-mt-md"},xa={class:"col-auto"},Sa={class:"col-auto"};function Ia(l,o,s,n,a,r){const u=v("PromptItemV2");return p(),g(H,{modelValue:s.modelValue},{default:t(()=>[e(X,null,{default:t(()=>[e(W,{class:"text-tertiary"},{default:t(()=>[e(Y,null,{default:t(()=>[f(" Combinar Produtos ")]),_:1})]),_:1}),e(re,null,{default:t(()=>[e(Q,{onSubmit:r.combinarItens},{default:t(()=>[e(se,{modelValue:a.itemCombinado.origem.descricao,"onUpdate:modelValue":o[0]||(o[0]=d=>a.itemCombinado.origem.descricao=d),color:"primary",placeholder:"Buscar produto","stack-label":"Pegar dados de",onClick:o[1]||(o[1]=d=>a.itemCombinado.prompt.origem=!0)},null,8,["modelValue"]),e(se,{modelValue:a.itemCombinado.destino.descricao,"onUpdate:modelValue":o[2]||(o[2]=d=>a.itemCombinado.destino.descricao=d),color:"primary",placeholder:"Buscar produto","stack-label":"Transferir para",onClick:o[3]||(o[3]=d=>a.itemCombinado.prompt.destino=!0)},null,8,["modelValue"]),C("div",wa,[C("div",xa,[D(e(S,{flat:"",color:"tertiary",label:"Cancelar"},null,512),[[R]])]),C("div",Sa,[e(S,{class:"",color:"primary",type:"submit",label:"Combinar",unelevated:""})])])]),_:1},8,["onSubmit"]),e(u,{modelValue:a.itemCombinado.prompt.origem,"onUpdate:modelValue":o[4]||(o[4]=d=>a.itemCombinado.prompt.origem=d),filtro:{ativo:!0},onSelecionarItens:r.selecionarCombinarItensOrigem},null,8,["modelValue","onSelecionarItens"]),e(u,{modelValue:a.itemCombinado.prompt.destino,"onUpdate:modelValue":o[5]||(o[5]=d=>a.itemCombinado.prompt.destino=d),filtro:{ativo:!0},onSelecionarItens:r.selecionarCombinarItensDestino},null,8,["modelValue","onSelecionarItens"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var ka=G(qa,[["render",Ia]]);const Ea={props:{label:String},data(){return{alterarDescricao:!1,alterarValorCusto:!1,alterarValorVenda:!1,visivel:!1}},methods:{fecharModal(){this.visivel=!1},opcaoConfirma(){const l={alterarDescricao:this.alterarDescricao,alterarValorCusto:this.alterarValorCusto,alterarValorVenda:this.alterarValorVenda};this.$emit("opcaoSelecionada",l)}}};function Ua(l,o,s,n,a,r){const u=v("g-label"),d=v("g-col"),c=v("campo"),b=v("g-row");return p(),g(H,{modelValue:a.visivel,"onUpdate:modelValue":o[3]||(o[3]=m=>a.visivel=m),persistent:""},{default:t(()=>[e(X,null,{default:t(()=>[e(b,{gutter:"md"},{default:t(()=>[e(d,{bordered:"bottom",mg:"sm-b"},{default:t(()=>[e(u,{text:"body1 bold"},{default:t(()=>[f(E(s.label),1)]),_:1})]),_:1}),e(d,{col:"12",class:"q-pb-sm"},{default:t(()=>[e(c,{modelValue:a.alterarDescricao,"onUpdate:modelValue":o[0]||(o[0]=m=>a.alterarDescricao=m),tipo:"logico",rotulo:"Descri\xE7\xE3o",class:"text-body1 text-weight-medium"},null,8,["modelValue"])]),_:1}),e(d,{col:"12",class:"q-pb-sm"},{default:t(()=>[e(c,{modelValue:a.alterarValorCusto,"onUpdate:modelValue":o[1]||(o[1]=m=>a.alterarValorCusto=m),tipo:"logico",rotulo:"Valor de Custo",class:"text-body1 text-weight-medium"},null,8,["modelValue"])]),_:1}),e(d,{col:"12",class:"q-pb-sm"},{default:t(()=>[e(c,{modelValue:a.alterarValorVenda,"onUpdate:modelValue":o[2]||(o[2]=m=>a.alterarValorVenda=m),tipo:"logico",rotulo:"Valor de Venda",class:"text-body1 text-weight-medium"},null,8,["modelValue"])]),_:1}),e(d,{col:"12",text:"right",bordered:"top",mg:"sm-t"},{default:t(()=>[D(e(S,{class:"q-mr-sm",flat:"",label:"Cancelar",color:"tertiary"},null,512),[[R]]),D(e(S,{label:"Continuar",color:"primary",onClick:r.opcaoConfirma},null,8,["onClick"]),[[R]])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}var Ke=G(Ea,[["render",Ua]]);const Pa={data(){return{visivel:!1}},methods:{trocarFoto(l){ze(l[0],{crop:!0,outputFormat:"jpg",targetHeight:200,targetWidth:200},(o,s)=>{this.resolve(s),this.visivel=!1})},onHide(){this.resolve()},async show(){return this.visivel=!0,new Promise((l,o)=>{this.resolve=l})}},props:{modelValue:{type:String}}};function Ma(l,o,s,n,a,r){return p(),g(H,{modelValue:a.visivel,"onUpdate:modelValue":o[0]||(o[0]=u=>a.visivel=u),onHide:o[1]||(o[1]=u=>r.onHide())},{default:t(()=>[e(X,null,{default:t(()=>[e(W,null,{default:t(()=>[e(Y,null,{default:t(()=>[f("Alterar foto")]),_:1}),D(e(S,{dense:"",flat:"",icon:"close",round:""},null,512),[[R]])]),_:1}),e(Fe,{"auto-expand":"",color:"none",extensions:".jpg,.jpeg",label:"Foto","hide-upload-button":"","hide-upload-progress":"","dark-light":"",url:"",ref:"fotoCampo",factory:r.trocarFoto},null,8,["factory"])]),_:1})]),_:1},8,["modelValue"])}var Da=G(Pa,[["render",Ma]]);const Fa={components:{"g-row":xe,"g-col":Se,"g-label":Ie},data(){return{descricaoECommerce:{},itemECommerce:[],loading:!1}},methods:{async atualizar(){var l;try{let o;this.permissaoFicha=await $db.permissao.objeto("item//ficha"),this.eCommerce=await $db.eCommerce.ler(),o=await $db.itemECommerce.ler({idItem:this.item.id}),o=o.filter(s=>this.eCommerce.some(n=>n.id===s.idECommerce)),this.itemECommerceOriginal=$utils.clonarV2(o);for(const s of this.eCommerce){if(!s.ativo){const n=o.findIndex(a=>a.idECommerce===s.id);n>=0&&o.splice(n,1);continue}s.json=JSON.parse((l=s.json)!=null?l:null),this.descricaoECommerce[s.id]=s.descricao,!o.some(n=>n.idECommerce===s.id)&&o.push({id:$utils.uuid(),idECommerce:s.id,idItem:this.item.id,idItemNoECommerce:"",descricao:"",valorVenda:0,valorVendaAtivo:!1,ativo:!1,json:JSON.stringify({})})}o.sort((s,n)=>new Date(s.dataHoraCriacao)<new Date(n.dataHoraCriacao)?-1:1),o.forEach(s=>{s.json=JSON.parse(s.json)}),this.itemECommerce=o;for(const s of this.itemECommerce)this.importarDadosECommerce(s).catch(n=>{console.error(n)})}catch(o){this.$q.notifyError("Erro ao consultar dados de e-commerce",o)}},async ativo_onClick(l){if(l.ativo)try{$q.loading.show(),await this.importarDadosECommerce(l)}catch(o){this.$q.notifyError(o.message)}finally{$q.loading.hide()}},valorVendaAtivo_onClick(l){l.valorVendaAtivo||(l.valorVenda=this.item.valorVenda)},async importarDadosECommerce(l){const o=this.eCommerce.find(n=>n.id===l.idECommerce);let s;try{if(l.ativo&&!l.idItemNoECommerce){$q.loading.hide();try{await new Promise((n,a)=>{this.$q.dialog({title:"Tem certeza?",message:"Caso o produto j\xE1 exista no e-commerce, insira o ID no campo espec\xEDfico antes de habilit\xE1-lo, assim voc\xEA evita duplicar o produto em seu e-commerce.",cancel:{label:"CANCELAR",push:!0,color:"tertiary",flat:!0},ok:{label:"CONTINUAR SEM ID",push:!0,class:"bg-info",textColor:"white",flat:!0}}).onOk(()=>{n()}).onCancel(()=>{a()})})}catch{l.ativo=!1;return}$q.loading.show()}s=await $db.itemECommerce.obterItem({itemGeeks:this.item,itemECommerce:l,eCommerce:o})}catch{throw l.ativo=!1,new Error("Erro ao consultar dados de e-commerce")}s||(l.descricao=this.item.descricao,l.valorVenda=this.item.valorVenda,l.idItemNoECommerce=""),s&&(l.valorVendaAtivo&&(l.valorVenda=Number(s[o.json.sincronismo.dePara.valorVenda])||0),l.descricao=s[o.json.sincronismo.dePara.descricao]||"",l.idItemNoECommerce=s[o.json.sincronismo.dePara.codigoItem]||"")},async salvar(){try{$q.loading.show();for(const l of this.itemECommerce){const o=$utils.clonarV2(l),s=this.itemECommerceOriginal.find(n=>n.id===l.id);if(o.json=JSON.stringify(o.json),o.ativo){const n=this.eCommerce.find(r=>r.id===o.idECommerce),a=await $db.itemECommerce.enviarItem({itemECommerce:o,eCommerce:n,itemGeeks:this.item});o.idItemNoECommerce=a==null?void 0:a.id}await $db.itemECommerce.gravar({atual:o,original:s})}await this.atualizar()}catch{this.$q.notifyError("Erro ao salvar dados de e-commerce")}finally{$q.loading.hide()}}},props:{item:{type:Object,required:!0}},created(){this.atualizar()}};function Aa(l,o,s,n,a,r){const u=v("g-label"),d=v("g-col"),c=v("campo"),b=v("g-row");return a.itemECommerce.length?(p(),I(P,{key:0},[e(d,{col:"12"},{default:t(()=>[e(u,{text:"h6",color:"text-tertiary"},{default:t(()=>[f("E-Commerce")]),_:1}),a.loading?(p(),g(yo,{key:0})):_("",!0)]),_:1}),(p(!0),I(P,null,O(a.itemECommerce,m=>(p(),I(P,{key:m.id},[e(d,{col:"12 sm4"},{default:t(()=>[e(u,{text:"medium",lines:"2"},{default:t(()=>[f(E(a.descricaoECommerce[m.idECommerce]),1)]),_:2},1024)]),_:2},1024),e(d,{col:"12 sm8"},{default:t(()=>[e(b,null,{default:t(()=>[e(d,{col:"3 sm-shrink",text:"center"},{default:t(()=>[e(c,{modelValue:m.ativo,"onUpdate:modelValue":[V=>m.ativo=V,V=>r.ativo_onClick(m)],tipo:"logico",noDense:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(d,{col:"9 sm"},{default:t(()=>[e(c,{modelValue:m.descricao,"onUpdate:modelValue":V=>m.descricao=V,modelModifiers:{trim:!0},tipo:"texto",maxlength:"250",rotulo:"Nome do produto",disable:!m.ativo,readonly:!m.ativo,class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue","disable","readonly"])]),_:2},1024),e(d,{col:"3 sm-shrink",text:"center"},{default:t(()=>[e(c,{modelValue:m.valorVendaAtivo,"onUpdate:modelValue":[V=>m.valorVendaAtivo=V,V=>r.valorVendaAtivo_onClick(m)],tipo:"logico",disable:!m.ativo,readonly:!m.ativo,noDense:""},null,8,["modelValue","onUpdate:modelValue","disable","readonly"])]),_:2},1024),e(d,{col:"9 sm2"},{default:t(()=>[e(c,{modelValue:m.valorVenda,"onUpdate:modelValue":V=>m.valorVenda=V,tipo:"decimal",decimals:"2",zerosDireita:"2",maxlength:"20",rotulo:"Valor de venda",disable:!m.ativo||!m.valorVendaAtivo,readonly:!m.ativo||!m.valorVendaAtivo,class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue","disable","readonly"])]),_:2},1024),e(d,{col:"9 sm2",offset:"3 sm0"},{default:t(()=>[e(c,{modelValue:m.idItemNoECommerce,"onUpdate:modelValue":V=>m.idItemNoECommerce=V,modelModifiers:{trim:!0},tipo:"texto",rotulo:"ID E-Commerce",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)],64))),128))],64)):_("",!0)}var za=G(Fa,[["render",Aa]]);const Ta={components:{modalTrocarFoto:Da,"g-row":xe,"g-col":Se,"g-label":Ie,Avatar:qe,BadgeCopiarUid:Co,PromptItemV2:Ae,SeletorCampoTabela:Te,SeletorCest:He,SeletorNcm:Je,Arquivo:Xe,ItemECommerce:za,importarDadosReferencia:Ke},computed:{badgeCor(){return this.item.ativo?(this.item.quantidadeDisponivel||0)<0?"negative":(this.item.quantidadeDisponivel||0)<=(this.item.quantidadeMinimaEstoque||0)?"orange":"positive":"faded"},descricaoConcatenada(){return $db.item.descricaoConcatenada(this.item)},opcoesGenero(){return[{rotulo:"Masculino",valor:"Masculino"},{rotulo:"Feminino",valor:"Feminino"},{rotulo:"Unisex",valor:"Unisex"},{rotulo:"Masculino Kids",valor:"Masculino Kids"},{rotulo:"Feminino Kids",valor:"Feminino Kids"},{rotulo:"Unisex Kids",valor:"Unisex Kids"}]},opcoesGeometria(){return[{rotulo:"Asf\xE9rica",valor:"Asf\xE9rica"},{rotulo:"Esf\xE9rica",valor:"Esf\xE9rica"},{rotulo:"T\xF3rica",valor:"T\xF3rica"}]},opcoesLenteTipo(){return[{rotulo:"Monofocal",valor:"Monofocal"},{rotulo:"Bifocal",valor:"Bifocal"},{rotulo:"Multifocal",valor:"Multifocal"}]},opcoesOrigemOld(){return[{valor:"",rotulo:""},{valor:"0",rotulo:"0 - Nacional exceto as indicadas nos c\xF3digos 3, 4, 5 e 8"},{valor:"1",rotulo:"1 - Estrangeira - Importa\xE7\xE3o direta"},{valor:"2",rotulo:"2 - Estrangeira - Adquirida no mercado interno"},{valor:"3",rotulo:"3 - Nacional, conteudo superior 40 % e inferior ou igual a 70 %"},{valor:"4",rotulo:"4 - Nacional, processos produtivos b\xE1sicos"},{valor:"5",rotulo:"5 - Nacional, conteudo inferior 40 %"},{valor:"6",rotulo:"6 - Estrangeira - Importa\xE7\xE3o direta, com similar nacional, lista CAMEX"},{valor:"7",rotulo:"7 - Estrangeira - mercado interno, sem simular, lista CAMEX"},{valor:"8",rotulo:"8 - Nacional, Conte\xFAdo de Importa\xE7\xE3o superior a 70 %"}]},opcoesSurfacada(){return[{rotulo:"Pronta",valor:"0"},{rotulo:"Surfa\xE7ada",valor:"1"}]},opcoesTipo(){return ge},opcoesStatus(){return[{rotulo:"Linha",valor:"Linha"},{rotulo:"Fora de Linha",valor:"Fora de Linha"},{rotulo:"Promo\xE7\xE3o",valor:"Promo\xE7\xE3o"}]},meta(){return be},temArmacao(){return["\xD3culos Sol","\xD3culos Pronto","Arma\xE7\xE3o"].includes(this.item.tipo)},temDescricaoConcatenada(){return["\xD3culos Sol","Lente"].includes(this.item.tipo)},temLente(){return["\xD3culos Sol","\xD3culos Pronto","Lente","Lente Contato"].includes(this.item.tipo)}},data(){return{tabelasPrecoOriginal:[],tabelasPreco:[],item:{},contato:{},fornecedor:[],composicao:[],producaoFase:[],qualidade:[],arquivo:[],especificacao:[],habilitaCamposControlados:!1,estoquePorEmpresa:[],opcoesOrigem:[],opcoesPerfilContabil:[],modalEquipamento:!1,modalFerramenta:!1,modalFoto:!1,modalItemUtilizado:!1,modalServico:!1,modalTratamento:!1,utilizaMarkupInvertido:!1,utilizaComposicaoValorReposicaoInvertido:!1,tab:"profile-tab-1",descricaoNcm:"",sistemaPai:We(),itemCompleto:{},indiceTratamento:0,indiceComposicao:0,descricaoANP:"",rules:{referencia:[async l=>await this.verificarReferenciaExistente(l)]},permissaoImportarImagensEAN:!1,permissaoMaximoDescontoGerente:!1,loadingImage:!1,mostrarCampoMix:!1,mostrarImportarDados:!1,EstoqueHeight:200}},methods:{async atualizar({id:l}){var o;try{this.estoquePorEmpresa=[],this.descricaoNcm="";const s=await $db.item.leCompletoV2(l);$db.item.selecionado=s,this.item=s.item,this.item.bloquearVenda=(o=this.item.bloquearVenda)!=null?o:!1,this.composicao=s.composicao,this.fornecedor=s.fornecedor,this.qualidade=s.qualidade,this.especificacao=$lodash.orderBy(s.especificacao,["descricao","agrupamento","valor"],["asc","asc","asc"]),this.producaoFase=s==null?void 0:s.producaoFase.sort((n,a)=>{const r=Number(n.ordem),u=Number(a.ordem);return r>u?1:-1}),this.item.codigoANP&&await this.consultarCodigoAnp(this.item.codigoANP);for(const n of this.fornecedor.map(a=>a.idContato))this.contato[n]||(this.contato[n]=await $db.contato.le({id:n}));this.itemOriginal=$utils.clonarV2(s.item),this.composicaoOriginal=$utils.clonarV2(s.composicao),this.fornecedorOriginal=$utils.clonarV2(s.fornecedor),this.producaoFaseOriginal=$utils.clonarV2(s.producaoFase),this.qualidadeOriginal=$utils.clonarV2(s.qualidade),this.especificacaoOriginal=$utils.clonarV2(s.especificacao),this.arquivoOriginal=await $db.arquivo.ler({filtros:{idTabelaMaster:this.item.id}}),this.arquivo=$utils.clonarV2(this.arquivoOriginal),this.utilizaMarkupInvertido=!this.item.utilizaMarkup,this.utilizaComposicaoValorReposicaoInvertido=!this.item.utilizaComposicaoValorReposicao,await this.leOpcoesPerfilContabil(),this.opcoesOrigem=(await oe().list("impostoParametro",{filter:{impParamTipoCod:2}})).map(n=>({rotulo:n.numero.trim()+" - "+n.descr,valor:Number(n.numero)})).sort((n,a)=>Number(n.valor)-Number(a.valor));for(const n of s.composicao)await this.atualizarItemComposicao(n.idItemUtilizado);this.estoquePorEmpresa=await $db.estoqueSaldoProdutoEmpresa.leEstoquePorEmpresa(this.item.id),this.habilitaCamposControlados=!!await $db.configuracoes.leValorNumerico("item.habilitacamposcontrolados"),await this.carregarTabelasPreco()}catch(s){this.$q.notifyError("Ocorreu erro ao consultar produto",s)}finally{}},async itemRestaurar_click(){try{$q.loading.show(),this.item.ativo=!0,await this.salvarItem(),$q.notifyPositive("O item foi restaurado com sucesso.")}catch(l){$q.notifyError("Ocorreu um erro ao restaurar",l)}finally{$q.loading.hide()}},async verificarReferenciaExistente(l){const o=(l||"").trim().toLowerCase();return o&&(await $db.item.carregarMemoria(),$db.item.itens.find(n=>(n.referencia||"").trim().toLowerCase()===o&&n.id!==this.item.id))?(this.mostrarImportarDados=!1,"Refer\xEAncia j\xE1 existente"):(this.mostrarImportarDados=!0,!0)},removerFoto(){this.item.imagem=""},async salvarItem(){try{this.$q.loading.show(),this.completarCodigoBarras();const l=this.item.id,o={originais:{item:this.itemOriginal,composicao:this.composicaoOriginal,fornecedor:this.fornecedorOriginal,producaoFase:this.producaoFaseOriginal,qualidade:this.qualidadeOriginal,especificacao:this.especificacaoOriginal},item:this.item,composicao:this.composicao,fornecedor:this.fornecedor,producaoFase:this.producaoFase,qualidade:this.qualidade,especificacao:this.especificacao};await $db.arquivo.remove(this.arquivoOriginal.filter(s=>!this.arquivo.find(n=>n.id===s.id)));for(const s of this.arquivo)await $db.arquivo.gravar({original:this.arquivoOriginal.find(n=>n.id===s.id),atual:s});await $db.item.gravaV2(o),await this.salvarTabelasPreco(),await this.$refs.itemECommerce.salvar(),await this.atualizar({id:l}),$q.notifyPositive("Os dados do produto foram salvos com sucesso.")}catch(l){$q.notifyError("Ocorreu um erro ao salvar",l)}finally{$q.loading.hide()}},async itemRemover_click(){let l=!1;this.$refs.form.getValidationComponents().forEach(o=>{!o.validate()&&!l&&(l=!0)}),!l&&$q.dialog({cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},title:"Remover",message:"Ao continuar voc\xEA ir\xE1 remover este item.",ok:{label:"Sim",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{try{$q.loading.show();const o=this.item.id;this.item.ativo=!1;const s={dadosOriginais:{item:this.itemOriginal},item:this.item};await $db.item.gravaV2(s),await this.atualizar({id:o}),$q.notifyPositive("O produto foi exclu\xEDdo com sucesso.")}catch(o){$q.notifyError("Ocorreu um erro ao remover item",o)}finally{$q.loading.hide()}})},aoCancelar(){if(!this.verificarSeAlterouCampos()){this.$q.notifyPositive("N\xE3o h\xE1 dados alterados."),this.atualizar({id:this.item.id});return}$q.dialog({message:"Ao continuar voc\xEA ir\xE1 perder todas as modifica\xE7\xF5es.",title:"Tem certeza?",cancel:{label:"Manter",push:!0,color:"tertiary",flat:!0},ok:{label:"Continuar",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(()=>{this.atualizar({id:this.item.id})})},async indexarNcms(){this.ncm=[],this.ncmIdx=void 0,$erp()._ncm.toArray().then(async l=>{l.forEach(o=>{this.ncm.push({id:o.id,ncm:o.ncm,descricao:o.descricao})}),this.ncm})},async abrirModalEquipamento(l){this.itensEquipamento=await oe().list("item",{filterNi:{ativo:!0,tipo:"Equipamento"}}),this.indiceProducaoFase=l,this.modalEquipamento=!0},async abrirModalFerramenta(l){this.indiceFerramenta=l,this.modalFerramenta=!0},async abrirModalServico(l){this.itensServico=await oe().list("item",{filterNi:{ativo:!0,tipo:"Servi\xE7o"}}),this.indiceServico=l,this.modalServico=!0},async abrirModalTratamento(l){this.itensTratamento=await oe().list("item",{filterNi:{ativo:!0,tipo:"Tratamento"}}),this.indiceTratamento=l,this.modalTratamento=!0},async abrirModalItemUtilizado(l){this.itensAtivos=await oe().list("item",{filterNi:{ativo:!0}}),this.indiceItemUtilizado=l,this.modalItemUtilizado=!0},async leOpcoesPerfilContabil(){const l=(await oe().list("perfilContabil")).sort((o,s)=>o.descricao.localeCompare(s.descricao,void 0,{sensitivity:"base"})).map(o=>({rotulo:o.descricao,valor:o.id}));this.opcoesPerfilContabil=[{rotulo:"",valor:""},...l]},async selecionarEquipamento(l){const o=Object.keys(l)[0],s=l[o].item,n=this.producaoFase[this.indiceProducaoFase];n.itemEquipamento=s,n.idItemEquipamento=o,n.descricaoItemEquipamento=s.descricao||"",this.modalEquipamento=!1},async selecionarFerramenta(l){const o=Object.keys(l)[0],s=l[o].item,n=this.producaoFase[this.indiceFerramenta];n.itemFerramenta=s,n.idItemFerramenta=o,n.descricaoItemFerramenta=s.descricao||"",this.modalFerramenta=!1},async selecionarServico(l){const o=Object.keys(l)[0],s=l[o].item,n=this.producaoFase[this.indiceServico];n.itemServico=s,n.idItemServico=o,n.descricaoItemServico=s.descricao||"",this.modalServico=!1},async selecionarTratamento(l){const o=Object.keys(l)[0],s=l[o].item;await this.atualizarItemTratamento(s.id,this.indiceTratamento),this.modalTratamento=!1},async selecionarFornecedor(l){const o=await $g.promptContato.show({filtro:{ativo:!0},placeholder:"Selecione o fornecedor"});if(o!=null&&o.id){const s=this.fornecedor[l];s.id=$utils.uuid(),s.idItem=this.item.id,s.idContato=o.id,this.contato[o.id]||(this.contato[o.id]=o)}},trocarFoto(l){this.$resizeImage(l[0],{crop:!0,outputFormat:"jpg",targetHeight:200,targetWidth:200},(o,s)=>{this.imagemModalFoto=s})},async fotoTrocar_click(){const l=await this.$refs.modalTrocarFoto.show();l&&(this.item.imagem=l)},uploadClick(){this.$refs.Upload.click()},async abrirArquivo(l){const o=this.$refs.Upload.files;if(FileReader&&o&&o.length){var s=new FileReader;s.onload=()=>{ze(o[0],{crop:!0,outputFormat:"jpg",targetHeight:200,targetWidth:200},(n,a)=>{this.item.imagem=a})},s.readAsDataURL(o[0])}},atualizarTabelasPreco(){for(const l of this.tabelasPreco.map(o=>o.id))this.atualizarTabelaPreco(l)},async atualizarTabelaPreco(l){let o=this.tabelasPreco.find(a=>a.id===l&&!a.habilitada);if(!o)return;const s=await $erp().itemTabelaPreco.get(o.id);if(!s.id)return;const n=await $db.itemTabelaPreco.obterValores(s,this.item,4)||{};o.valorVenda=n.valorVenda||0,o.maximoDesconto=n.maximoDesconto||0,o.maximoDescontoGerente=n.maximoDescontoGerente||0},async carregarTabelasPreco(){let l,o=[];l=await $erp().itemTabelaPreco.filter(s=>s.tabelaMaster===1).toArray();for(const s of l)if(s.id){let n={};const a=await $db.itemTabelaPreco.obterValores(s,this.item,4)||{};n.habilitada=!a.tabelaMaster,n.valorVenda=a.valorVenda||0,n.maximoDesconto=a.maximoDesconto||0,n.maximoDescontoGerente=a.maximoDescontoGerente||0,o.push({id:s.id,descricao:s.descricao,...n})}o=Ye.exports.orderBy(o,"descricao","asc"),this.tabelasPreco=o,this.tabelasPrecoOriginal=$utils.clonarV2(o)},async salvarTabelasPreco(){let l=this.tabelasPreco.filter(o=>!o.habilitada);for(const o of l){const s=await $erp().itemTabelaPreco.filter(n=>!n.tabelaMaster&&n.idItem===this.item.id&&n.idItemTabelaPrecoPai===o.id).toArray();for(const n of s)await $erp().itemTabelaPreco.delete(n.id),await $utils.sincronismoEnviar("remover","itemTabelaPreco",n.id)}l=this.tabelasPreco.filter(o=>o.habilitada);for(const o of l){const s=await $erp().itemTabelaPreco.filter(n=>!n.tabelaMaster&&n.idItem===this.item.id&&n.idItemTabelaPrecoPai===o.id).toArray();for(const n of s){let a={};n.valorVenda!==o.valorVenda&&(a.valorVenda=o.valorVenda),n.maximoDesconto!==o.maximoDesconto&&(a.maximoDesconto=o.maximoDesconto),n.maximoDescontoGerente!==o.maximoDescontoGerente&&(a.maximoDescontoGerente=o.maximoDescontoGerente),Object.keys(a).length&&(await $erp().itemTabelaPreco.update(n.id,a),await $utils.sincronismoEnviar("atualizar","itemTabelaPreco",n.id,a))}if(!s.length){const n={id:$utils.uuid(),tabelaMaster:0,descricao:this.item.descricao,idItemTabelaPrecoPai:o.id,idItem:this.item.id,valorVenda:o.valorVenda,maximoDesconto:o.maximoDesconto,maximoDescontoGerente:o.maximoDescontoGerente};await $erp().itemTabelaPreco.put(n),await $utils.sincronismoEnviar("adicionar","itemTabelaPreco",n.id,n)}}},async atualizarItemComposicao(l){let o=this.composicao.find(n=>l===n.idItemUtilizado)||{};o.idItemUtilizado||(o=this.composicao[0],o.idItemUtilizado=l),o.temporario||(o.temporario={});const s=await $db.item.leCompletoV2(l);o.descricaoItemUtilizado=s.item.descricao||"",o.temporario.unidade=s.item.unidade||"",o.temporario.valor=s.item.valorCustoReposicao||0,o.temporario.total=$utils.arredondar((o.temporario.valor||0)*(o.quantidade||0),2)},async atualizarItemTratamento(l,o){let s=this.composicao.find(a=>l===a.idItemUtilizado)||{};s.idItemUtilizado||(s=this.composicao[o],s.idItemUtilizado=l),s.temporario||(s.temporario={});const n=await $db.item.leCompletoV2(l);s.descricaoItemUtilizado=n.item.descricao||"",s.temporario.unidade=n.item.unidade||"",s.temporario.valor=n.item.valorCustoReposicao||0,s.temporario.total=$utils.arredondar((s.temporario.valor||0)*(s.quantidade||0),2)},async removerComposicao(l){$q.dialog({cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},title:"Remover",message:"Ao continuar voc\xEA ir\xE1 remover este item.",ok:{label:"Sim",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(()=>{try{this.composicao.splice(l,1),this.composicao.length===0&&this.adicionarComposicao()}catch(o){o.message&&$q.notifyError("Ocorreu um erro ao remover",o)}})},async adicionarComposicao(){this.composicao||(this.composicao=[]),this.composicao.push({idItem:this.item.id,idItemUtilizado:"",ordem:0,quantidade:1,temporario:{unidade:"",valor:0,total:0}})},async selecionarItemUtilizado(l){const o=Object.keys(l)[0],s=l[o].item;let n=this.composicao.find(a=>o===a.idItemUtilizado)||{};if(!n.idItemUtilizado){let a=this.composicao.length>0?this.composicao.length-1:0;n=this.composicao[a],n.idItemUtilizado=o}n.quantidade=l[o].quantidade,await this.atualizarItemComposicao(s.id),this.modalItemUtilizado=!1},atualizarValorVendaLucro(){if(this.utilizaMarkupInvertido){if(!!this.item.valorCustoReposicao&&!!this.item.valorVenda){const l=100*(this.item.valorVenda-this.item.valorCustoReposicao)/this.item.valorVenda;this.item.percentualMarkup=$utils.arredondar(l,2)}}else{const l=(this.item.percentualMarkup||0)/100;if(!!this.item.valorCustoReposicao&&l<1){const o=this.item.valorCustoReposicao/(1-l);o&&(this.item.valorVenda=$utils.arredondar(o,4))}}},atualizarCustoReposicao(){this.item&&this.item.id&&!this.utilizaComposicaoValorReposicaoInvertido&&(this.item.valorCustoReposicao=(this.composicao||[]).reduce((l,o)=>l+o.temporario.total,0),this.item.valorCustoReposicao||(this.item.percentualMarkup=100),this.atualizarValorVendaLucro())},completarCodigoBarras(){!this.item.codigoBarras&&!!this.item.codigoItem&&(this.item.codigoBarras=$utils.completarCodigoBarras(String(this.item.codigoItem)))},removerItemDaLista(l,o){$q.dialog({cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},title:"Remover",message:"Ao continuar voc\xEA ir\xE1 remover este item.",ok:{label:"Sim",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(()=>{try{l.splice(o,1)}catch(s){s.message&&$q.notifyError("Ocorreu um erro ao remover",s)}})},verificarSeAlterouCampos(){const l={item:this.itemOriginal,itemComposicao:this.composicaoOriginal,itemFornecedor:this.fornecedorOriginal,itemProducaoFase:this.producaoFaseOriginal,itemQualidade:this.qualidadeOriginal},o={item:this.item,itemComposicao:this.composicao,itemFornecedor:this.fornecedor,itemProducaoFase:this.producaoFase,itemQualidade:this.qualidade};for(const n of this.arquivoOriginal)if(!this.arquivo.some(a=>a.id===n.id))return!0;for(const n of this.arquivo)if(!this.arquivoOriginal.some(a=>a.id===n.id))return!0;return($utils.diferenca(l,o)||$utils.diferenca(this.tabelasPrecoOriginal,this.tabelasPreco))!==null},importarDados_click(){this.$refs.modalImportarDados.visivel=!0},async importarDadosReferencia(l){$q.loading.show();try{const o=$utils.clonarV2(this.item),s=$utils.clonarV2(this.arquivo),n=await $db.item.importarDadosProdutoReferencia({item:o,arquivosOriginal:s,alterarDescricao:l.alterarDescricao,alterarValorCusto:l.alterarValorCusto,alterarValorVenda:l.alterarValorVenda});this.arquivo=n.arquivos,this.item.descricao=n.item.descricao,this.item.referencia=n.item.referencia,this.item.tipo=n.item.tipo,this.item.marca=n.item.marca,this.item.ncm=n.item.ncm,this.item.valorCustoReposicao=n.item.valorCustoReposicao,this.item.valorVenda=n.item.valorVenda,this.item.imagem=n.item.imagem,this.item.armacaoMaterial=n.item.armacaoMaterial,this.item.amarcaoCor=n.item.amarcaoCor,this.item.tipoMontagem=n.item.tipoMontagem,this.item.modelo=n.item.modelo,this.item.haste=n.item.haste,this.item.ponte=n.item.ponte,this.item.largura=n.item.largura,this.item.material=n.item.material,this.item.cor=n.item.cor,$q.notify({message:'Lembre-se de "SALVAR" as altera\xE7\xF5es do produto.',type:"warning"}),$q.notifyPositive("Dados e Imagens importados com sucesso.")}catch(o){$q.notify({message:"N\xE3o encontramos dados ou imagens para est\xE1 refer\xEAncia.",type:"warning"}),console.error(o)}finally{$q.loading.hide()}},getFile(l){const o=new FormData,s=new Blob([l],{type:"image/jpeg"});return o.append("file",s),o.get("file")},especificacaoAdicionar(){this.especificacao.push({id:$utils.uuid(),idItem:this.item.id})},async especificacaoRemover(l){await this.removerConfirma(),l>=0&&this.especificacao.splice(l,1)},removerConfirma(){return new Promise((l,o)=>{this.$q.dialog({cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},title:"Remover",message:"Ao continuar voc\xEA ir\xE1 remover este item.",ok:{label:"Sim",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(()=>{l()})})},async buscaEspecificacoes(l){const o=await $db.configuracoes.le({nome:`item.especificacao.${l}`});o.length>0&&await $q.dialog({title:"Especifica\xE7\xF5es",message:"O tipo selecionado possue itens de especifica\xE7\xE3o, deseja preencher?",cancel:!0,persistent:!0}).onOk(()=>{o.forEach(async s=>{let n={id:$utils.uuid(),idItem:this.item.id,descricao:s.texto,valor:s.valor};await $db.itemEspecificacao.gravar({original:{},atual:n}),this.especificacao=await $db.itemEspecificacao.ler({idItem:this.item.id})})})},async consultarCodigoAnp(){let l=_o.tabelaANP.find(o=>o.value===this.item.codigoANP);l&&(this.descricaoANP=l.label),l||(this.descricaoANP="C\xF3digo n\xE3o encontrado na tabela da ANP.",this.$q.notifyError("C\xF3digo n\xE3o encontrado na tabela da ANP."))},onResize(l){let o;o=window.innerWidth,parseInt(l.height),o>=1024?this.EstoqueHeight=(l.height-117).toString():this.EstoqueHeight="140"}},watch:{utilizaComposicaoValorReposicaoInvertido(){this.item.utilizaComposicaoValorReposicao=!this.utilizaComposicaoValorReposicaoInvertido,this.atualizarCustoReposicao()},utilizaMarkupInvertido(){this.item.utilizaMarkup=!this.utilizaMarkupInvertido,this.atualizarValorVendaLucro()},descricaoConcatenada(l){this.item.descricaoConcatenada=l}},async created(){const l=await $db.configuracoes.le({nome:"importarImagensEAN"}),o=JSON.parse(localStorage.getItem("clienteSistema"));this.permissaoImportarImagensEAN=l.some(s=>Number(s.valor)===1),this.indexarNcms(),this.permissaoMaximoDescontoGerente=await $db.permissao.objetoClienteSistema("Diretiva_Vendas_DescontoMaximoNivelGerente"),this.mostrarCampoMix=~[53,62].indexOf(o==null?void 0:o.codigoSistema)}},de=l=>(to("data-v-1dcfdc52"),l=l(),lo(),l),ja=de(()=>C("img",{class:"fit",src:"/assets/images/icon-haste.svg"},null,-1)),Oa=de(()=>C("img",{class:"fit",src:"/assets/images/icon-altura.svg"},null,-1)),Ra=de(()=>C("img",{class:"fit",src:"/assets/images/icon-ponte.svg"},null,-1)),Na=de(()=>C("img",{class:"fit",src:"/assets/images/icon-tamanho.svg"},null,-1)),La=de(()=>C("img",{class:"fit",src:"/assets/images/icon-diagonal.svg"},null,-1)),Ba=["onUpdate:modelValue"],Ga=["onUpdate:modelValue"],Ka=["onUpdate:modelValue"],Qa=["onUpdate:modelValue"],Ha=["onUpdate:modelValue"];function Ja(l,o,s,n,a,r){const u=v("avatar"),d=v("g-col"),c=v("g-label"),b=v("BadgeCopiarUid"),m=v("campo"),V=v("SeletorCampoTabela"),U=v("SeletorNcm"),x=v("SeletorCest"),y=v("g-row"),M=v("ItemECommerce"),j=v("arquivo"),F=v("modalTrocarFoto"),N=v("PromptItemV2"),te=v("importarDadosReferencia");return p(),I("div",null,[e(Q,{ref:"form",class:"ItemFicha q-mt-md",onSubmit:r.salvarItem},{default:t(()=>[e(y,{gutter:"md",bg:"bg-white"},{default:t(()=>[e(d,{col:"12 md2",text:"center"},{default:t(()=>[e(u,{onClick:r.uploadClick,imagem:a.item.imagem,rotulo:a.item.descricao,tamanho:"160"},null,8,["onClick","imagem","rotulo"]),C("input",{ref:"Upload",type:"file",id:"Upload",onChange:o[0]||(o[0]=(...i)=>r.abrirArquivo&&r.abrirArquivo(...i)),style:{visibility:"hidden"}},null,544),(a.item.codigoBarras||a.item.referencia)&&a.mostrarImportarDados?(p(),g(T,{key:0,name:"image",size:"sm",class:"cursor-pointer",onClick:r.importarDados_click},{default:t(()=>[e(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[f("Importar Produto/Imagem")]),_:1})]),_:1},8,["onClick"])):_("",!0)]),_:1}),e(d,{col:"12 md7"},{default:t(()=>[e(y,{gutter:"none-y",items:"center"},{default:t(()=>[e(Ze,{onResize:r.onResize},null,8,["onResize"]),e(d,null,{default:t(()=>[r.temDescricaoConcatenada?(p(),g(c,{key:0,text:"sub1 medium",color:"text-tertiary"},{default:t(()=>[f(E(r.descricaoConcatenada),1)]),_:1})):_("",!0)]),_:1}),e(d,{col:"shrink"},{default:t(()=>[e(b,{id:a.item.id,numero:a.item.codigoItem,cor:r.badgeCor},null,8,["id","numero","cor"])]),_:1}),e(d,{col:"12"},{default:t(()=>[e(m,{rules:[i=>!!i.trim()||"Campo obrigat\xF3rio"],modelValue:a.item.descricao,"onUpdate:modelValue":o[1]||(o[1]=i=>a.item.descricao=i),modelModifiers:{trim:!0},tipo:"texto",rotulo:"Nome do produto",dense:"",autogrow:"",autofocus:"",maxlength:"500"},null,8,["rules","modelValue"])]),_:1}),e(d,{col:"12 sm6 md6"},{default:t(()=>[e(V,{modelValue:a.item.marca,"onUpdate:modelValue":o[2]||(o[2]=i=>a.item.marca=i),buscarSemCaractere:!0,tabela:"item",campo:"marca",label:"Marca",enableAdd:""},null,8,["modelValue"])]),_:1}),e(d,{col:"12 sm6 md6"},{default:t(()=>[e(m,{modelValue:a.item.tipo,"onUpdate:modelValue":o[3]||(o[3]=i=>a.item.tipo=i),opcoes:r.opcoesTipo,onBlur:o[4]||(o[4]=i=>r.buscaEspecificacoes(a.item.tipo)),rotuloFixo:"Tipo",tipo:"seletor",class:"q-field--with-bottom"},null,8,["modelValue","opcoes"])]),_:1}),e(d,{col:"12 sm6 md6",class:"relative-position"},{default:t(()=>[e(se,{modelValue:a.item.referencia,"onUpdate:modelValue":o[5]||(o[5]=i=>a.item.referencia=i),rules:a.rules.referencia,maxlength:"30",label:"Refer\xEAncia",dense:""},null,8,["modelValue","rules"])]),_:1}),e(d,{col:"12 sm6 md6",class:"relative-position"},{default:t(()=>[e(se,{modelValue:a.item.codigoBarras,"onUpdate:modelValue":o[6]||(o[6]=i=>a.item.codigoBarras=i),modelModifiers:{trim:!0},onBlur:r.completarCodigoBarras,type:"text",maxlength:"14",mask:"##############",label:"C\xF3digo de barras (GTIN ou EAN)",class:"q-field--with-bottom",dense:""},null,8,["modelValue","onBlur"])]),_:1}),a.item.tipo!="Servi\xE7o"?(p(),I(P,{key:0},[e(d,{col:"12 sm6 md6"},{default:t(()=>[e(U,{modelValue:a.item.ncm,"onUpdate:modelValue":o[7]||(o[7]=i=>a.item.ncm=i)},null,8,["modelValue"])]),_:1}),e(d,{col:"12 sm6 md6"},{default:t(()=>[e(x,{modelValue:a.item.cest,"onUpdate:modelValue":o[8]||(o[8]=i=>a.item.cest=i),ncm:a.item.ncm},null,8,["modelValue","ncm"])]),_:1})],64)):_("",!0),e(d,{col:"12",class:"q-mt-md"},{default:t(()=>[e(c,{text:"h6"},{default:t(()=>[f("Valores")]),_:1})]),_:1}),e(d,{col:"12 sm"},{default:t(()=>[e(y,null,{default:t(()=>[e(d,{col:"3",text:"center"},{default:t(()=>[e(m,{modelValue:a.utilizaComposicaoValorReposicaoInvertido,"onUpdate:modelValue":o[9]||(o[9]=i=>a.utilizaComposicaoValorReposicaoInvertido=i),tipo:"logico",noDense:""},null,8,["modelValue"])]),_:1}),e(d,{col:"9"},{default:t(()=>[e(m,{modelValue:a.item.valorCustoReposicao,"onUpdate:modelValue":[o[10]||(o[10]=i=>a.item.valorCustoReposicao=i),r.atualizarValorVendaLucro],disable:!a.utilizaComposicaoValorReposicaoInvertido,readonly:!a.utilizaComposicaoValorReposicaoInvertido,ajuda:a.utilizaComposicaoValorReposicaoInvertido?"":"Total da composi\xE7\xE3o",tipo:"decimal",decimals:"4",zerosDireita:"2",rotulo:"Custo de reposi\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","disable","readonly","ajuda"])]),_:1})]),_:1})]),_:1}),e(d,{col:"9 sm",offset:"3 sm0"},{default:t(()=>[e(m,q({modelValue:a.item.percentualMarkup,"onUpdate:modelValue":o[11]||(o[11]=i=>a.item.percentualMarkup=i)},r.meta.percentualMarkup,{"onUpdate:modelValue":r.atualizarValorVendaLucro,disable:a.utilizaMarkupInvertido,readonly:a.utilizaMarkupInvertido,class:"q-field--with-bottom"}),null,16,["modelValue","onUpdate:modelValue","disable","readonly"])]),_:1}),e(d,{col:"12 sm"},{default:t(()=>[e(y,null,{default:t(()=>[e(d,{col:"3",text:"center"},{default:t(()=>[e(m,{modelValue:a.utilizaMarkupInvertido,"onUpdate:modelValue":o[12]||(o[12]=i=>a.utilizaMarkupInvertido=i),tipo:"logico",noDense:""},null,8,["modelValue"])]),_:1}),e(d,{col:"9"},{default:t(()=>[e(m,q({modelValue:a.item.valorVenda,"onUpdate:modelValue":o[13]||(o[13]=i=>a.item.valorVenda=i)},r.meta.valorVenda,{onBlur:r.atualizarTabelasPreco,"onUpdate:modelValue":r.atualizarValorVendaLucro,disable:!a.utilizaMarkupInvertido,readonly:!a.utilizaMarkupInvertido,decimals:"4",zerosDireita:"2",class:"q-field--with-bottom"}),null,16,["modelValue","onBlur","onUpdate:modelValue","disable","readonly"])]),_:1})]),_:1})]),_:1}),(a.tabelasPreco||[]).length>1?(p(),I(P,{key:1},[e(d,{col:"12",class:"q-mt-md"},{default:t(()=>[e(c,{text:"h6"},{default:t(()=>[f("Tabelas de Pre\xE7o")]),_:1})]),_:1}),(p(!0),I(P,null,O(a.tabelasPreco,i=>(p(),I(P,{key:i.id},[e(d,{col:"12 sm4"},{default:t(()=>[e(c,{text:"medium",lines:"2"},{default:t(()=>[f(E(i.descricao),1)]),_:2},1024)]),_:2},1024),e(d,{col:"12 sm8"},{default:t(()=>[e(y,null,{default:t(()=>[e(d,{col:"3 sm-shrink",text:"center"},{default:t(()=>[e(m,{modelValue:i.habilitada,"onUpdate:modelValue":[h=>i.habilitada=h,h=>r.atualizarTabelaPreco(i.id)],tipo:"logico",noDense:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(d,{col:"9 sm"},{default:t(()=>[e(m,q({modelValue:i.maximoDesconto,"onUpdate:modelValue":h=>i.maximoDesconto=h},{rotulo:"Desc. M\xE1ximo (%)",tipo:"decimal",decimals:"2"},{disable:!i.habilitada,readonly:!i.habilitada,class:"q-field--with-bottom"}),null,16,["modelValue","onUpdate:modelValue","disable","readonly"])]),_:2},1024),a.permissaoMaximoDescontoGerente?(p(),g(d,{key:0,col:"9 sm",offset:"3 sm0"},{default:t(()=>[e(m,q({modelValue:i.maximoDescontoGerente,"onUpdate:modelValue":h=>i.maximoDescontoGerente=h},{rotulo:"Desc. M\xE1ximo Gerente (%)",tipo:"decimal",decimals:"2"},{disable:!i.habilitada,readonly:!i.habilitada,class:"q-field--with-bottom"}),null,16,["modelValue","onUpdate:modelValue","disable","readonly"])]),_:2},1024)):_("",!0),e(d,{col:"9 sm",offset:"3 sm0"},{default:t(()=>[e(m,q({modelValue:i.valorVenda,"onUpdate:modelValue":h=>i.valorVenda=h},{rotulo:"Valor de venda",tipo:"decimal",decimals:"4",zerosDireita:"2"},{disable:!i.habilitada,readonly:!i.habilitada,class:"q-field--with-bottom"}),null,16,["modelValue","onUpdate:modelValue","disable","readonly"])]),_:2},1024)]),_:2},1024)]),_:2},1024)],64))),128))],64)):_("",!0),a.item.id?(p(),g(M,{key:2,item:a.item,ref:"itemECommerce"},null,8,["item"])):_("",!0),a.item.tipo!=="Servi\xE7o"&&a.habilitaCamposControlados?(p(),I(P,{key:3},[e(d,{col:"12"},{default:t(()=>[e(c,{text:"h6"},{default:t(()=>[f("Produto Controlado")]),_:1})]),_:1}),e(d,{col:"12 sm4"},{default:t(()=>[e(m,{modelValue:a.item.controladoExercito,"onUpdate:modelValue":o[14]||(o[14]=i=>a.item.controladoExercito=i),rotulo:"Quantidade Ex\xE9rcito",tipo:"decimal",decimals:"4",class:"q-field--with-bottom"},null,8,["modelValue"])]),_:1}),e(d,{col:"12 sm4"},{default:t(()=>[e(m,{modelValue:a.item.controladoPoliciaFederal,"onUpdate:modelValue":o[15]||(o[15]=i=>a.item.controladoPoliciaFederal=i),rotulo:"Quantidade Pol\xEDcia Federal",tipo:"decimal",decimals:"4",class:"q-field--with-bottom"},null,8,["modelValue"])]),_:1}),e(d,{col:"12 sm4"},{default:t(()=>[e(m,{modelValue:a.item.controladoPoliciaCivil,"onUpdate:modelValue":o[16]||(o[16]=i=>a.item.controladoPoliciaCivil=i),rotulo:"Quantidade Pol\xEDcia Civil",tipo:"decimal",decimals:"4",class:"q-field--with-bottom"},null,8,["modelValue"])]),_:1})],64)):_("",!0)]),_:1})]),_:1}),e(d,{col:"12 md"},{default:t(()=>[e(y,{gutter:"md",bg:"bg-light","rounded-borders":""},{default:t(()=>[e(d,null,{default:t(()=>[a.estoquePorEmpresa.length!==0?(p(),I(P,{key:0},[e(c,{text:"sub1 medium"},{default:t(()=>[f("Estoque / Custos")]),_:1}),a.estoquePorEmpresa.length!==0?(p(),g(y,{key:0,items:"stretch",text:"caption medium center"},{default:t(()=>[e(d,{col:"3",bordered:"bottom"},{default:t(()=>[f("Saldo")]),_:1}),e(d,{col:"3",bordered:"bottom"},{default:t(()=>[f("Custo M\xE9dio")]),_:1}),e(d,{col:"3",bordered:"bottom"},{default:t(()=>[f("Custo Real")]),_:1}),e(d,{col:"3",bordered:"bottom"},{default:t(()=>[f("Custo Anterior")]),_:1})]),_:1})):_("",!0)],64)):(p(),g(c,{key:1,text:"center caption medium",class:"q-pb-xl"},{default:t(()=>[f("Sem informa\xE7\xE3o de estoque.")]),_:1})),e(Vo,{style:$e(`height:${a.EstoqueHeight}px;`)},{default:t(()=>[(p(!0),I(P,null,O(a.estoquePorEmpresa,i=>(p(),I(P,{key:i.idEmpresa},[e(c,{text:"sub2 medium",icon:"factory xs grey-7 left",bordered:"bottom",class:"q-mt-md"},{default:t(()=>[f(E(i.nomeEmpresa),1)]),_:2},1024),(p(!0),I(P,null,O(i.estoquePorLote,(h,k)=>(p(),g(y,{key:k,items:"stretch",text:"caption center"},{default:t(()=>[e(d,{col:"12"},{default:t(()=>[e(c,{text:"sub2 medium left"},{default:t(()=>[f(E(h.tipoEstoque)+E(h.loteEmpresa?` - ${h.loteEmpresa}`:""),1)]),_:2},1024)]),_:2},1024),e(d,{col:"3"},{default:t(()=>[f(E(l.$filters.numero(h.saldo,2)),1)]),_:2},1024),e(d,{col:"3"},{default:t(()=>[f(E(l.$filters.numero(h.valorCustoMedio,2)),1)]),_:2},1024),e(d,{col:"3"},{default:t(()=>[f(E(l.$filters.numero(h.valorCusto,2)),1)]),_:2},1024),e(d,{col:"3"},{default:t(()=>[f(E(l.$filters.numero(h.valorCustoAnterior,2)),1)]),_:2},1024)]),_:2},1024))),128))],64))),128))]),_:1},8,["style"])]),_:1})]),_:1})]),_:1})]),_:1}),r.temArmacao?(p(),g(y,{key:0,gutter:"md-x",bg:"bg-white",justify:"around",items:"end"},{default:t(()=>[e(d,{col:"12"},{default:t(()=>[e(c,{text:"h6"},{default:t(()=>[f("Arma\xE7\xE3o")]),_:1})]),_:1}),e(d,{col:"4 sm2 md2"},{default:t(()=>[ja,e(m,q(r.meta.haste,{modelValue:a.item.haste,"onUpdate:modelValue":o[17]||(o[17]=i=>a.item.haste=i),dense:"",class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"4 sm2 md2"},{default:t(()=>[Oa,e(m,q(r.meta.altura,{modelValue:a.item.altura,"onUpdate:modelValue":o[18]||(o[18]=i=>a.item.altura=i),rotulo:"Altura/Vertical",dense:"",class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"4 sm2 md2"},{default:t(()=>[Ra,e(m,q(r.meta.ponte,{modelValue:a.item.ponte,"onUpdate:modelValue":o[19]||(o[19]=i=>a.item.ponte=i),dense:"",class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"4 sm2 md2"},{default:t(()=>[Na,e(m,q(r.meta.largura,{modelValue:a.item.largura,"onUpdate:modelValue":o[20]||(o[20]=i=>a.item.largura=i),rotulo:"Aro total",dense:"",class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"4 sm2 md2"},{default:t(()=>[La,e(m,q(r.meta.diagonal,{modelValue:a.item.diagonal,"onUpdate:modelValue":o[21]||(o[21]=i=>a.item.diagonal=i),rotulo:"Diagonal maior",dense:"",class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"12 sm4 md4"},{default:t(()=>[e(m,q({modelValue:a.item.genero,"onUpdate:modelValue":o[22]||(o[22]=i=>a.item.genero=i)},r.meta.genero,{filter:"",opcoes:r.opcoesGenero,class:"q-field--with-bottom"}),null,16,["modelValue","opcoes"])]),_:1}),e(d,{col:"12 sm4 md4"},{default:t(()=>[e(V,{modelValue:a.item.armacaoMaterial,"onUpdate:modelValue":o[23]||(o[23]=i=>a.item.armacaoMaterial=i),tabela:"item",campo:"armacaoMaterial",label:"Material",buscarSemCaractere:!0,enableAdd:""},null,8,["modelValue"])]),_:1}),e(d,{col:"12 sm4 md4"},{default:t(()=>[e(V,{modelValue:a.item.tipoMontagem,"onUpdate:modelValue":o[24]||(o[24]=i=>a.item.tipoMontagem=i),tabela:"item",campo:"tipoMontagem",label:"Montagem",buscarSemCaractere:!0,enableAdd:""},null,8,["modelValue"])]),_:1}),e(d,{col:"12 sm6 md6"},{default:t(()=>[e(m,q({modelValue:a.item.modelo,"onUpdate:modelValue":o[25]||(o[25]=i=>a.item.modelo=i)},r.meta.modelo,{class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"12 sm6 md6"},{default:t(()=>[e(V,{modelValue:a.item.amarcaoCor,"onUpdate:modelValue":o[26]||(o[26]=i=>a.item.amarcaoCor=i),tabela:"item",campo:"amarcaoCor",label:"Cor",buscarSemCaractere:!0,enableAdd:""},null,8,["modelValue"])]),_:1})]),_:1})):_("",!0),r.temLente?(p(),g(y,{key:1,gutter:"md-x",bg:"bg-white"},{default:t(()=>[e(d,{col:"12"},{default:t(()=>[e(c,{text:"h6"},{default:t(()=>[f("Lente")]),_:1})]),_:1}),e(d,{col:"12 sm6"},{default:t(()=>[e(V,{modelValue:a.item.material,"onUpdate:modelValue":o[27]||(o[27]=i=>a.item.material=i),tabela:"item",campo:"material",label:"Material",buscarSemCaractere:!0,enableAdd:""},null,8,["modelValue"])]),_:1}),e(d,{col:"12 sm6"},{default:t(()=>[e(V,{modelValue:a.item.cor,"onUpdate:modelValue":o[28]||(o[28]=i=>a.item.cor=i),tabela:"item",campo:"cor",label:"Cor",buscarSemCaractere:!0,enableAdd:""},null,8,["modelValue"])]),_:1}),a.item.tipo==="\xD3culos Pronto"?(p(),g(d,{key:0,col:"12 sm3"},{default:t(()=>[e(m,q({modelValue:a.item.esfericoInicial,"onUpdate:modelValue":o[29]||(o[29]=i=>a.item.esfericoInicial=i)},r.meta.esfericoInicial,{class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1})):_("",!0),a.item.tipo==="Lente"?(p(),I(P,{key:1},[e(d,{col:"6 sm4"},{default:t(()=>[e(m,q(r.meta.esfericoInicial,{modelValue:a.item.esfericoInicial,"onUpdate:modelValue":o[30]||(o[30]=i=>a.item.esfericoInicial=i),rotulo:"Esf\xE9rico de",class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"6 sm4"},{default:t(()=>[e(m,q(r.meta.esfericoFinal,{modelValue:a.item.esfericoFinal,"onUpdate:modelValue":o[31]||(o[31]=i=>a.item.esfericoFinal=i),rotulo:"Esf\xE9rico at\xE9",class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"12 sm4"},{default:t(()=>[e(m,q(r.meta.cilindrico,{modelValue:a.item.cilindrico,"onUpdate:modelValue":o[32]||(o[32]=i=>a.item.cilindrico=i),class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),a.item.lenteTipo!=="Monofocal"?(p(),g(d,{key:0,col:"6 sm"},{default:t(()=>[e(m,q(r.meta.adicaoInicial,{modelValue:a.item.adicaoInicial,"onUpdate:modelValue":o[33]||(o[33]=i=>a.item.adicaoInicial=i),rotulo:"Adi\xE7\xE3o de",class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1})):_("",!0),a.item.lenteTipo!=="Monofocal"?(p(),g(d,{key:1,col:"6 sm"},{default:t(()=>[e(m,q(r.meta.adicaoFinal,{modelValue:a.item.adicaoFinal,"onUpdate:modelValue":o[34]||(o[34]=i=>a.item.adicaoFinal=i),rotulo:"Adi\xE7\xE3o at\xE9",class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1})):_("",!0),e(d,{col:"6 sm"},{default:t(()=>[e(m,q(r.meta.alturaMinima,{modelValue:a.item.alturaMinima,"onUpdate:modelValue":o[35]||(o[35]=i=>a.item.alturaMinima=i),class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"6 sm"},{default:t(()=>[e(m,q(r.meta.indiceRefracao,{modelValue:a.item.indiceRefracao,"onUpdate:modelValue":o[36]||(o[36]=i=>a.item.indiceRefracao=i),class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"6 sm"},{default:t(()=>[e(m,q(r.meta.diametro,{modelValue:a.item.diametro,"onUpdate:modelValue":o[37]||(o[37]=i=>a.item.diametro=i),class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"6 sm"},{default:t(()=>[e(m,q(r.meta.lenteTipo,{modelValue:a.item.lenteTipo,"onUpdate:modelValue":o[38]||(o[38]=i=>a.item.lenteTipo=i),opcoes:r.opcoesLenteTipo,class:"q-field--with-bottom"}),null,16,["modelValue","opcoes"])]),_:1})],64)):_("",!0),a.item.tipo==="Lente Contato"?(p(),I(P,{key:2},[e(d,{col:"6 sm3"},{default:t(()=>[e(m,q({modelValue:a.item.esfericoInicial,"onUpdate:modelValue":o[39]||(o[39]=i=>a.item.esfericoInicial=i)},r.meta.esfericoInicial,{rotulo:"Esf\xE9rico de",class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"6 sm3"},{default:t(()=>[e(m,q({modelValue:a.item.esfericoFinal,"onUpdate:modelValue":o[40]||(o[40]=i=>a.item.esfericoFinal=i)},r.meta.esfericoFinal,{rotulo:"Esf\xE9rico at\xE9",class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"6 sm3"},{default:t(()=>[e(m,q({modelValue:a.item.eixo,"onUpdate:modelValue":o[41]||(o[41]=i=>a.item.eixo=i)},r.meta.eixo,{rotulo:"Eixo de",class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"6 sm3"},{default:t(()=>[e(m,q({modelValue:a.item.eixoFinal,"onUpdate:modelValue":o[42]||(o[42]=i=>a.item.eixoFinal=i)},r.meta.eixoFinal,{rotulo:"Eixo at\xE9",class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"12 sm3"},{default:t(()=>[e(m,q({modelValue:a.item.cilindrico,"onUpdate:modelValue":o[43]||(o[43]=i=>a.item.cilindrico=i)},r.meta.cilindrico,{class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"12 sm3"},{default:t(()=>[e(m,q({modelValue:a.item.adicaoInicial,"onUpdate:modelValue":o[44]||(o[44]=i=>a.item.adicaoInicial=i)},r.meta.adicaoInicial,{class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"6 sm3"},{default:t(()=>[e(m,q({modelValue:a.item.RB1,"onUpdate:modelValue":o[45]||(o[45]=i=>a.item.RB1=i)},r.meta.RB1,{class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"6 sm3"},{default:t(()=>[e(m,q({modelValue:a.item.RB2,"onUpdate:modelValue":o[46]||(o[46]=i=>a.item.RB2=i)},r.meta.RB2,{class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"6 sm3"},{default:t(()=>[e(m,q({modelValue:a.item.diametro,"onUpdate:modelValue":o[47]||(o[47]=i=>a.item.diametro=i)},r.meta.diametro,{class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"6 sm3"},{default:t(()=>[e(m,q({modelValue:a.item.geometria,"onUpdate:modelValue":o[48]||(o[48]=i=>a.item.geometria=i)},r.meta.geometria,{opcoes:r.opcoesGeometria,class:"q-field--with-bottom"}),null,16,["modelValue","opcoes"])]),_:1}),e(d,{col:"6 sm3"},{default:t(()=>[e(m,q({modelValue:a.item.surfacada,"onUpdate:modelValue":o[49]||(o[49]=i=>a.item.surfacada=i)},r.meta.surfacada,{opcoes:r.opcoesSurfacada,class:"q-field--with-bottom"}),null,16,["modelValue","opcoes"])]),_:1}),e(d,{col:"6 sm3"},{default:t(()=>[e(m,q({modelValue:a.item.lenteTipo,"onUpdate:modelValue":o[50]||(o[50]=i=>a.item.lenteTipo=i)},r.meta.lenteTipo,{opcoes:r.opcoesLenteTipo,class:"q-field--with-bottom"}),null,16,["modelValue","opcoes"])]),_:1})],64)):_("",!0)]),_:1})):_("",!0),a.item.tipo==="Lente"?(p(),g(y,{key:2,gutter:"md-x",items:"center",bg:"bg-white"},{default:t(()=>[e(d,{col:"12"},{default:t(()=>[e(c,{text:"h6"},{default:t(()=>[f("Tratamento")]),_:1})]),_:1}),(p(!0),I(P,null,O(a.composicao||[],(i,h)=>(p(),I(P,{key:h},[e(d,{col:"12 sm6"},{default:t(()=>[e(m,{"model-value":i.descricaoItemUtilizado,before:[{icon:"search",handler(){r.abrirModalTratamento(h)}}],onClick:k=>r.abrirModalTratamento(h),readonly:"",rotulo:"Tratamento",class:"q-field--with-bottom"},null,8,["model-value","before","onClick"]),D(C("input",{"onUpdate:modelValue":k=>i.idItemUtilizado=k,type:"hidden"},null,8,Ba),[[le,i.idItemUtilizado]])]),_:2},1024),e(d,{col:"10 sm-grow"},{default:t(()=>[e(m,q(r.meta.composicao.lista.temporario.valor,{modelValue:a.composicao[h].temporario.valor,"onUpdate:modelValue":k=>a.composicao[h].temporario.valor=k,disable:!0,readonly:!0,class:"q-field--with-bottom"}),null,16,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(d,{col:"2 sm-shrink",text:"center"},{default:t(()=>[e(S,{onClick:k=>r.removerComposicao(h),icon:"delete",flat:"",round:"",dense:"",color:"tertiary",class:"q-mb-sm"},{default:t(()=>[e(B,{anchor:"top left",self:"bottom start"},{default:t(()=>[f("Excluir")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)],64))),128)),e(d,{col:"12",text:"center",class:"q-mb-md"},{default:t(()=>[e(S,{onClick:r.adicionarComposicao,icon:"add",size:"sm",color:"positive",label:"Tratamento",outline:""},null,8,["onClick"])]),_:1})]),_:1})):_("",!0),e(je,{modelValue:a.tab,"onUpdate:modelValue":o[51]||(o[51]=i=>a.tab=i),"inline-label":"","outside-arrows":"","mobile-arrows":"",class:"bg-transparent q-mt-lg text-primary",align:"justify"},{default:t(()=>[e($,{label:"Detalhes",name:"profile-tab-1"}),e($,{label:"Especifica\xE7\xF5es",name:"profile-tab-5"}),e($,{label:"Arquivos",name:"profile-images"}),e($,{label:"Fornecedores",name:"profile-tab-2"}),a.item.tipo!=="Lente"&&a.sistemaPai!=="optisoul"?(p(),g($,{key:0,label:"Composi\xE7\xE3o",name:"profile-tab-3"})):_("",!0),a.sistemaPai!=="optisoul"?(p(),g($,{key:1,label:"PCP",name:"profile-tab-4"})):_("",!0)]),_:1},8,["modelValue"]),e(eo,{modelValue:a.tab,"onUpdate:modelValue":o[81]||(o[81]=i=>a.tab=i)},{default:t(()=>[e(ae,{name:"profile-tab-1",class:"bg-white q-pa-none"},{default:t(()=>[e(y,{gutter:"md",items:"top"},{default:t(()=>[e(d,{col:"12 sm9 md9"},{default:t(()=>[e(y,{gutter:"none-y"},{default:t(()=>[e(d,{col:"12 sm4"},{default:t(()=>[e(V,{modelValue:a.item.grupo,"onUpdate:modelValue":o[52]||(o[52]=i=>a.item.grupo=i),tabela:"item",campo:"grupo",label:"Grupo",buscarSemCaractere:!0,enableAdd:""},null,8,["modelValue"])]),_:1}),e(d,{col:"12 sm4"},{default:t(()=>[e(V,{modelValue:a.item.subGrupo,"onUpdate:modelValue":o[53]||(o[53]=i=>a.item.subGrupo=i),tabela:"item",campo:"subGrupo",label:"Subgrupo",buscarSemCaractere:!0,enableAdd:""},null,8,["modelValue"])]),_:1}),e(d,{col:"12 sm4"},{default:t(()=>[e(V,{modelValue:a.item.unidade,"onUpdate:modelValue":o[54]||(o[54]=i=>a.item.unidade=i),tabela:"item",campo:"unidade",label:"Unidade",buscarSemCaractere:!0,enableAdd:"",maxLength:"10"},null,8,["modelValue"])]),_:1}),e(d,{col:"6 sm4"},{default:t(()=>[e(m,q(r.meta.garantiaDias,{modelValue:a.item.garantiaDias,"onUpdate:modelValue":o[55]||(o[55]=i=>a.item.garantiaDias=i),class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"6 sm8"},{default:t(()=>[e(m,q({modelValue:a.item.garantiaDescricao,"onUpdate:modelValue":o[56]||(o[56]=i=>a.item.garantiaDescricao=i)},r.meta.garantiaDescricao,{class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"12 md4"},{default:t(()=>[e(m,q(r.meta.idPerfilContabil,{modelValue:a.item.idPerfilContabil,"onUpdate:modelValue":o[57]||(o[57]=i=>a.item.idPerfilContabil=i),filter:"",opcoes:a.opcoesPerfilContabil,onClick:r.leOpcoesPerfilContabil,class:"q-field--with-bottom"}),null,16,["modelValue","opcoes","onClick"])]),_:1}),e(d,{col:"12 md8"},{default:t(()=>[e(m,q({modelValue:a.item.codigoOrigem,"onUpdate:modelValue":o[58]||(o[58]=i=>a.item.codigoOrigem=i)},r.meta.codigoOrigem,{opcoes:a.opcoesOrigem,class:"q-field--with-bottom",style:{"white-space":"normal"}}),null,16,["modelValue","opcoes"])]),_:1})]),_:1})]),_:1}),e(d,{col:"12 sm3 md3"},{default:t(()=>[e(y,{gutter:"none-y"},{default:t(()=>[a.mostrarCampoMix?(p(),g(d,{key:0,col:"12"},{default:t(()=>[e(V,{modelValue:a.item.mix,"onUpdate:modelValue":o[59]||(o[59]=i=>a.item.mix=i),tabela:"item",campo:"mix",label:"Mix",buscarSemCaractere:!0,enableAdd:""},null,8,["modelValue"])]),_:1})):_("",!0),e(d,{col:"12"},{default:t(()=>[e(m,q(r.meta.observacao,{modelValue:a.item.observacao,"onUpdate:modelValue":o[60]||(o[60]=i=>a.item.observacao=i),class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"12"},{default:t(()=>[e(m,q(r.meta.aplicacao,{modelValue:a.item.aplicacao,"onUpdate:modelValue":o[61]||(o[61]=i=>a.item.aplicacao=i),class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1})]),_:1})]),_:1}),e(d,{col:"12"},{default:t(()=>[e(y,{gutter:"none-y"},{default:t(()=>[e(d,{col:"12"},{default:t(()=>[e(c,{text:"h6"},{default:t(()=>[f("Caracter\xEDsticas")]),_:1})]),_:1}),e(d,{col:"4 md2"},{default:t(()=>[e(m,{modelValue:a.item.peso,"onUpdate:modelValue":o[62]||(o[62]=i=>a.item.peso=i),tipo:"decimal",decimals:"4",zerosDireita:"2",rotulo:"Peso",class:"q-field--with-bottom"},null,8,["modelValue"])]),_:1}),e(d,{col:"4 md2"},{default:t(()=>[e(m,{modelValue:a.item.pesoBruto,"onUpdate:modelValue":o[63]||(o[63]=i=>a.item.pesoBruto=i),tipo:"decimal",decimals:"4",zerosDireita:"2",rotulo:"Peso Bruto",class:"q-field--with-bottom"},null,8,["modelValue"])]),_:1}),e(d,{col:"4 md2"},{default:t(()=>[e(m,q({modelValue:a.item.densidade,"onUpdate:modelValue":o[64]||(o[64]=i=>a.item.densidade=i)},r.meta.densidade,{opcoes:{minimumValue:0,decimalPlaces:4},class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"4 md2"},{default:t(()=>[e(m,q({modelValue:a.item.altura,"onUpdate:modelValue":o[65]||(o[65]=i=>a.item.altura=i)},r.meta.altura,{opcoes:{minimumValue:0,decimalPlaces:4},class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"4 md2"},{default:t(()=>[e(m,q({col:"3",modelValue:a.item.largura,"onUpdate:modelValue":o[66]||(o[66]=i=>a.item.largura=i)},r.meta.largura,{opcoes:{minimumValue:0,decimalPlaces:4},class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"4 md2"},{default:t(()=>[e(m,{col:"3",modelValue:a.item.comprimento,"onUpdate:modelValue":o[67]||(o[67]=i=>a.item.comprimento=i),tipo:"decimal",decimals:"4",zerosDireita:"2",rotulo:"Comprimento",class:"q-field--with-bottom"},null,8,["modelValue"])]),_:1}),e(d,{col:"4 md"},{default:t(()=>[e(m,q({modelValue:a.item.capacidade,"onUpdate:modelValue":o[68]||(o[68]=i=>a.item.capacidade=i)},r.meta.capacidade,{opcoes:{minimumValue:0,decimalPlaces:4},class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"4 md"},{default:t(()=>[e(m,q({modelValue:a.item.capacidadeUnidade,"onUpdate:modelValue":o[69]||(o[69]=i=>a.item.capacidadeUnidade=i)},r.meta.capacidadeUnidade,{class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"4 md"},{default:t(()=>[e(m,q({modelValue:a.item.validadeMeses,"onUpdate:modelValue":o[70]||(o[70]=i=>a.item.validadeMeses=i)},r.meta.validadeMeses,{class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"6 sm md"},{default:t(()=>[e(m,q({modelValue:a.item.embalagem,"onUpdate:modelValue":o[71]||(o[71]=i=>a.item.embalagem=i)},r.meta.embalagem,{class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"6 sm md"},{default:t(()=>[e(m,{rotuloFixo:"Status",tipo:"seletor",modelValue:a.item.status,"onUpdate:modelValue":o[72]||(o[72]=i=>a.item.status=i),opcoes:r.opcoesStatus,class:"q-field--with-bottom"},null,8,["modelValue","opcoes"])]),_:1}),D(e(d,{col:"xs sm md"},{default:t(()=>[e(V,{modelValue:a.item.cor,"onUpdate:modelValue":o[73]||(o[73]=i=>a.item.cor=i),tabela:"item",campo:"cor",label:"Cor",buscarSemCaractere:!0,enableAdd:""},null,8,["modelValue"])]),_:1},512),[[ie,a.item.tipo!=="\xD3culos Sol"&&a.item.tipo!=="\xD3culos Pronto"&&a.item.tipo!=="Lente"&&a.item.tipo!=="Lente Contato"]]),e(d,{col:"6 sm md"},{default:t(()=>[e(m,{modelValue:a.item.codigoANP,"onUpdate:modelValue":o[74]||(o[74]=i=>a.item.codigoANP=i),maxlength:"9",rotulo:"C\xF3digo ANP",dense:"",tipo:"texto",ajuda:a.descricaoANP,onBlur:r.consultarCodigoAnp},null,8,["modelValue","ajuda","onBlur"])]),_:1}),e(d,{col:"xs sm12 md",text:"center"},{default:t(()=>[e(m,{modelValue:a.item.bloquearVenda,"onUpdate:modelValue":o[75]||(o[75]=i=>a.item.bloquearVenda=i),tipo:"logico",rotulo:"Bloquear Venda",noDense:"",class:"q-field--with-bottom"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(ae,{name:"profile-tab-2",class:"bg-white q-pa-none"},{default:t(()=>[e(y,{gutter:"md",items:"center"},{default:t(()=>[(p(!0),I(P,null,O(a.fornecedor,(i,h)=>(p(),I(P,{key:h},[e(d,{col:"12 sm4"},{default:t(()=>{var k;return[e(m,q({"model-value":(k=a.contato[i.idContato])==null?void 0:k.apelido},r.meta.fornecedor.lista.idContato,{readonly:"",onClick:z=>r.selecionarFornecedor(h),before:[{icon:"search",handler(){r.selecionarFornecedor(h)}}]}),null,16,["model-value","onClick","before"]),D(C("input",{"onUpdate:modelValue":z=>i.idContato=z,type:"hidden"},null,8,Ga),[[le,i.idContato]])]}),_:2},1024),e(d,{col:"12 sm4"},{default:t(()=>[e(m,q(r.meta.fornecedor.lista.descricao,{modelValue:i.descricao,"onUpdate:modelValue":k=>i.descricao=k}),null,16,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(d,{col:"10 sm"},{default:t(()=>[e(m,q(r.meta.fornecedor.lista.referencia,{modelValue:i.referencia,"onUpdate:modelValue":k=>i.referencia=k}),null,16,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(d,{col:"2 sm-shrink",text:"center"},{default:t(()=>[e(S,{onClick:k=>r.removerItemDaLista(a.fornecedor,h),icon:"delete",flat:"",round:"",dense:"",color:"tertiary",class:"q-mt-sm"},{default:t(()=>[e(B,{anchor:"top left",self:"bottom start"},{default:t(()=>[f("Excluir")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),e(d,{col:"12",class:"q-mb-sm"})],64))),128)),e(d,{col:"12",text:"center"},{default:t(()=>[e(S,{onClick:o[76]||(o[76]=()=>{this.fornecedor.push({})}),icon:"add",size:"sm",color:"positive",label:"Fornecedor",outline:""})]),_:1})]),_:1})]),_:1}),e(ae,{name:"profile-images",class:"bg-white q-pa-none"},{default:t(()=>[e(y,{gutter:"md"},{default:t(()=>[e(d,null,{default:t(()=>[e(j,{resize:{crop:!0,width:1e3,height:1e3},idTabelaMaster:a.item.id,arquivo:a.arquivo,tipoArquivo:"itemImagem"},null,8,["idTabelaMaster","arquivo"])]),_:1})]),_:1})]),_:1}),e(ae,{name:"profile-tab-3",class:"bg-white q-pa-none"},{default:t(()=>[e(y,{gutter:"md",items:"center"},{default:t(()=>[(p(!0),I(P,null,O(a.composicao,(i,h)=>(p(),I(P,{key:h},[e(d,{col:"12 sm4"},{default:t(()=>[e(m,{"model-value":i.descricaoItemUtilizado,onClick:k=>r.abrirModalItemUtilizado(h),before:[{icon:"search",handler(){r.abrirModalItemUtilizado(h)}}],readonly:"",rotulo:"Produto para composi\xE7\xE3o",tipo:"texto"},null,8,["model-value","onClick","before"])]),_:2},1024),e(d,{col:"12 sm4"},{default:t(()=>[e(m,q(r.meta.composicao.lista.ordem,{modelValue:i.ordem,"onUpdate:modelValue":k=>i.ordem=k}),null,16,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(d,{col:"10 sm"},{default:t(()=>[e(m,q(r.meta.composicao.lista.quantidade,{modelValue:i.quantidade,"onUpdate:modelValue":[k=>i.quantidade=k,k=>r.atualizarItemComposicao(i.idItemUtilizado)]}),null,16,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(d,{col:"2 sm-shrink",text:"center"},{default:t(()=>[e(S,{onClick:k=>r.removerComposicao(h),icon:"delete",flat:"",round:"",dense:"",color:"tertiary",class:"q-mt-sm"},{default:t(()=>[e(B,{anchor:"top left",self:"bottom start"},{default:t(()=>[f("Excluir")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),e(d,{col:"12",class:"q-mb-sm"})],64))),128)),e(d,{col:"12",text:"center"},{default:t(()=>[e(S,{onClick:r.adicionarComposicao,icon:"add",size:"sm",color:"positive",label:"Composi\xE7\xE3o",outline:""},null,8,["onClick"])]),_:1})]),_:1})]),_:1}),e(ae,{name:"profile-tab-4",class:"bg-white q-pa-none"},{default:t(()=>[e(y,{gutter:"md"},{default:t(()=>[e(d,{col:"12 sm5"},{default:t(()=>[e(m,q({modelValue:a.item.numeroPop,"onUpdate:modelValue":o[77]||(o[77]=i=>a.item.numeroPop=i)},r.meta.numeroPop,{class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1}),e(d,{col:"12 sm7"},{default:t(()=>[e(m,q({modelValue:a.item.procedimento,"onUpdate:modelValue":o[78]||(o[78]=i=>a.item.procedimento=i)},r.meta.procedimento,{class:"q-field--with-bottom"}),null,16,["modelValue"])]),_:1})]),_:1}),e(y,{gutter:"md",items:"center"},{default:t(()=>[e(d,{col:"12"},{default:t(()=>[e(c,{text:"h6"},{default:t(()=>[f("Qualidade")]),_:1})]),_:1}),(p(!0),I(P,null,O(a.qualidade,(i,h)=>(p(),I(P,{key:h},[e(d,{col:"12 sm4"},{default:t(()=>[e(m,q(r.meta.qualidade.lista.descricao,{modelValue:i.descricao,"onUpdate:modelValue":k=>i.descricao=k}),null,16,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(d,{col:"12 sm4"},{default:t(()=>[e(m,q(r.meta.qualidade.lista.especificacao,{modelValue:i.especificacao,"onUpdate:modelValue":k=>i.especificacao=k}),null,16,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(d,{col:"10 sm"},{default:t(()=>[e(m,q(r.meta.qualidade.lista.limites,{modelValue:i.limites,"onUpdate:modelValue":k=>i.limites=k}),null,16,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(d,{col:"2 sm-shrink",text:"center"},{default:t(()=>[e(S,{onClick:k=>r.removerItemDaLista(a.qualidade,h),icon:"delete",flat:"",round:"",dense:"",color:"tertiary",class:"q-mt-sm"},{default:t(()=>[e(B,{anchor:"top left",self:"bottom start"},{default:t(()=>[f("Excluir")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),e(d,{col:"12",class:"q-mb-sm"})],64))),128)),e(d,{col:"12",text:"center"},{default:t(()=>[e(S,{onClick:o[79]||(o[79]=()=>{this.qualidade.push({idItem:this.item.id})}),icon:"add",size:"sm",color:"positive",label:"Qualidade",outline:""})]),_:1})]),_:1}),e(y,{gutter:"md"},{default:t(()=>[e(d,{col:"12"},{default:t(()=>[e(c,{text:"h6"},{default:t(()=>[f("Fase")]),_:1})]),_:1}),(p(!0),I(P,null,O(a.producaoFase,(i,h)=>(p(),I(P,{key:h},[e(d,{col:"12 sm6 md"},{default:t(()=>[e(m,q(r.meta.producaoFase.lista.ordem,{modelValue:i.ordem,"onUpdate:modelValue":k=>i.ordem=k}),null,16,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(d,{col:"12 sm6 md"},{default:t(()=>[e(m,q(r.meta.producaoFase.lista.descricao,{modelValue:i.descricao,"onUpdate:modelValue":k=>i.descricao=k}),null,16,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(d,{col:"12 sm md"},{default:t(()=>[e(m,{"model-value":i.descricaoItemEquipamento,before:[{icon:"search",handler(){r.abrirModalEquipamento(h)}}],onClick:k=>r.abrirModalEquipamento(h),readonly:"",rotulo:"Equipamento"},null,8,["model-value","before","onClick"]),D(C("input",{"onUpdate:modelValue":k=>i.idItemEquipamento=k,type:"hidden"},null,8,Ka),[[le,i.idItemEquipamento]])]),_:2},1024),e(d,{col:"12 sm md"},{default:t(()=>[e(m,{"model-value":i.descricaoItemFerramenta,before:[{icon:"search",handler(){r.abrirModalFerramenta(h)}}],onClick:k=>r.abrirModalFerramenta(h),readonly:"",rotulo:"Ferramenta"},null,8,["model-value","before","onClick"]),D(C("input",{"onUpdate:modelValue":k=>i.idItemFerramenta=k,type:"hidden"},null,8,Qa),[[le,i.idItemFerramenta]])]),_:2},1024),e(d,{col:"grow sm md"},{default:t(()=>[e(m,{"model-value":i.descricaoItemServico,before:[{icon:"search",handler(){r.abrirModalServico(h)}}],onClick:k=>r.abrirModalServico(h),readonly:"",rotulo:"Servico"},null,8,["model-value","before","onClick"]),D(C("input",{"onUpdate:modelValue":k=>i.idItemServico=k,type:"hidden"},null,8,Ha),[[le,i.idItemServico]])]),_:2},1024),e(d,{col:"2 sm-shrink",text:"center"},{default:t(()=>[e(S,{onClick:k=>r.removerItemDaLista(a.producaoFase,h),icon:"delete",flat:"",round:"",dense:"",color:"tertiary",class:"q-mt-sm"},{default:t(()=>[e(B,{anchor:"top left",self:"bottom start"},{default:t(()=>[f("Excluir")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),e(d,{col:"12",class:"q-mb-sm"})],64))),128)),e(d,{col:"12",text:"center"},{default:t(()=>[e(S,{onClick:o[80]||(o[80]=()=>{this.producaoFase.push({idItem:this.item.id})}),icon:"add",size:"sm",color:"positive",label:"Fase",outline:""})]),_:1})]),_:1})]),_:1}),e(ae,{name:"profile-tab-5",class:"bg-white q-pa-none"},{default:t(()=>[e(y,{gutter:"md",items:"center"},{default:t(()=>[(p(!0),I(P,null,O(a.especificacao,(i,h)=>(p(),I(P,{key:h},[e(d,{col:"12 sm4"},{default:t(()=>[e(m,{modelValue:i.descricao,"onUpdate:modelValue":k=>i.descricao=k,rotulo:"Descri\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(d,{col:"12 sm4"},{default:t(()=>[e(m,{modelValue:i.valor,"onUpdate:modelValue":k=>i.valor=k,rotulo:"Valor"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(d,{col:"10 grow sm"},{default:t(()=>[e(m,{modelValue:i.agrupamento,"onUpdate:modelValue":k=>i.agrupamento=k,rotulo:"Agrupamento"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(d,{col:"2 sm-shrink",text:"center"},{default:t(()=>[e(S,{onClick:k=>r.especificacaoRemover(h),icon:"delete",flat:"",round:"",dense:"",color:"tertiary",class:"q-mt-sm"},null,8,["onClick"])]),_:2},1024),e(d,{col:"12",class:"q-mb-sm"})],64))),128)),e(d,{col:"12",text:"center"},{default:t(()=>[e(S,{onClick:r.especificacaoAdicionar,icon:"add",size:"sm",color:"positive",label:"Especifica\xE7\xE3o",outline:""},null,8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(y,{gutter:"lg",items:"center",text:"center"},{default:t(()=>[a.item.dataCadastro?(p(),g(d,{key:0,col:"12 sm"},{default:t(()=>[C("small",null,"Data do cadastro: "+E(l.$filters.dataHora(a.item.dataCadastro)),1)]),_:1})):_("",!0),a.item._DataHoraUltimaAlteracao?(p(),g(d,{key:1,col:"12 sm"},{default:t(()=>[C("small",null,"\xDAltima altera\xE7\xE3o: "+E(l.$filters.dataHora(a.item._DataHoraUltimaAlteracao)),1)]),_:1})):_("",!0)]),_:1}),e(oo,{class:"bg-light no-shadow q-pa-sm",bordered:""},{default:t(()=>[e(y,{relative:"",text:"right",class:"u-container"},{default:t(()=>[a.item.ativo?(p(),g(d,{key:0},{default:t(()=>[e(S,{onClick:ao(r.aoCancelar,["prevent"]),label:"Cancelar",flat:"",color:"tertiary"},null,8,["onClick"]),e(S,{type:"submit",label:"Salvar",color:"primary",unelevated:"",class:"q-ml-sm"}),e(S,{onClick:r.itemRemover_click,icon:"delete",round:"",flat:"",color:"tertiary",class:"q-ml-lg"},{default:t(()=>[e(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[f("Remover")]),_:1})]),_:1},8,["onClick"])]),_:1})):(p(),g(d,{key:1,class:"q-py-sm"},{default:t(()=>[e(c,{color:"text-tertiary"},{default:t(()=>[f(" N\xE3o \xE9 poss\xEDvel editar informa\xE7\xF5es de um produto exclu\xEDdo. "),e(S,{onClick:r.itemRestaurar_click,label:"Restaurar produto",color:"primary",unelevated:"",class:"q-ml-sm text-white"},null,8,["onClick"])]),_:1})]),_:1}))]),_:1})]),_:1}),e(F,{ref:"modalTrocarFoto"},null,512),e(N,{modelValue:a.modalEquipamento,"onUpdate:modelValue":o[82]||(o[82]=i=>a.modalEquipamento=i),filtro:{tipo:"Equipamento",ativo:!0},onSelecionarItens:r.selecionarEquipamento},null,8,["modelValue","onSelecionarItens"]),e(N,{modelValue:a.modalFerramenta,"onUpdate:modelValue":o[83]||(o[83]=i=>a.modalFerramenta=i),filtro:{tipo:"Ferramenta",ativo:!0},onSelecionarItens:r.selecionarFerramenta},null,8,["modelValue","onSelecionarItens"]),e(N,{modelValue:a.modalServico,"onUpdate:modelValue":o[84]||(o[84]=i=>a.modalServico=i),filtro:{tipo:"Servi\xE7o",ativo:!0},onSelecionarItens:r.selecionarServico},null,8,["modelValue","onSelecionarItens"]),e(N,{modelValue:a.modalTratamento,"onUpdate:modelValue":o[85]||(o[85]=i=>a.modalTratamento=i),filtro:{tipo:"Tratamento",ativo:!0},onSelecionarItens:r.selecionarTratamento},null,8,["modelValue","onSelecionarItens"]),e(N,{modelValue:a.modalItemUtilizado,"onUpdate:modelValue":o[86]||(o[86]=i=>a.modalItemUtilizado=i),filtro:{ativo:!0},onSelecionarItens:r.selecionarItemUtilizado},null,8,["modelValue","onSelecionarItens"]),e(te,{label:"Gostaria de importar essas informa\xE7\xF5es no produto?",onOpcaoSelecionada:r.importarDadosReferencia,ref:"modalImportarDados"},null,8,["onOpcaoSelecionada"])]),_:1},8,["onSubmit"])])}var Xa=G(Ta,[["render",Ja],["__scopeId","data-v-1dcfdc52"]]),Pe=io({name:"QPopupProxy",props:{...ro,breakpoint:{type:[String,Number],default:450}},emits:["show","hide"],setup(l,{slots:o,emit:s,attrs:n}){const{proxy:a}=co(),{$q:r}=a,u=ve(!1),d=ve(null),c=Ee(()=>parseInt(l.breakpoint,10)),{canShow:b}=so({showing:u});function m(){return r.screen.width<c.value||r.screen.height<c.value?"dialog":"menu"}const V=ve(m()),U=Ee(()=>V.value==="menu"?{maxHeight:"99vh"}:{});no(()=>m(),M=>{u.value!==!0&&(V.value=M)});function x(M){u.value=!0,s("show",M)}function y(M){u.value=!1,V.value=m(),s("hide",M)}return Object.assign(a,{show(M){b(M)===!0&&d.value.show(M)},hide(M){d.value.hide(M)},toggle(M){d.value.toggle(M)}}),mo(a,"currentComponent",()=>({type:V.value,ref:d.value})),()=>{const M={ref:d,...U.value,...n,onShow:x,onHide:y};let j;return V.value==="dialog"?j=H:(j=we,Object.assign(M,{target:l.target,contextMenu:l.contextMenu,noParentEvent:!0,separateClosePopup:!0})),uo(j,M,o.default)}}});const Wa={components:{"g-row":xe,"g-col":Se,"g-label":Ie},computed:{colunasKardex(){return[{align:"left",name:"DataHoraFinalizado",field:"dataHoraFinalizado",label:"Data Movimenta\xE7\xE3o",sortable:!0,format:this.$filters.dataHora},{align:"left",name:"DocumentoTipo",field:"documentoTipo",label:"Documento",sortable:!0},{align:"middle",name:"Acao",field:"acao",label:"A\xE7\xE3o"},{align:"right",name:"Numero",field:"numero",label:"N\xFAmero",format:o=>o||0},{align:"right",name:"Quantidade",field:"quantidade",label:"Quantidade"},{align:"left",name:"Unidade",field:"unidade",label:"Unidade"},{align:"right",name:"Saldo",field:"saldo",label:"Saldo",sortable:!0},{align:"left",name:"DescricaoContato",field:"descricaoContato",label:"Contato",format:o=>o||""},{align:"right",name:"CustoMedio",field:"custoMedio",label:"Custo M\xE9dio",format:this.$filters.dinheiro},{align:"right",name:"Custo",field:"custo",label:"Custo Real",format:this.$filters.dinheiro},{align:"right",name:"Venda",field:"venda",label:"Venda",format:this.$filters.dinheiro},{align:"right",name:"Ordem",field:"ordem",label:"Ordem",sortable:!0},{align:"right",name:"Fator",field:"fator",label:"Fator"},{align:"left",name:"DocumentoItemOperacao",field:"documentoItemOperacao",label:"Opera\xE7\xE3o Item",sortable:!0},{align:"left",name:"DocumentoItemStatus",field:"documentoItemStatus",label:"Status Item",sortable:!0},{align:"right",name:"CodigoDocumento",field:"codigoDocumento",label:"C\xF3digo Documento",sortable:!0},{align:"center",name:"observacao",field:"observacao",label:"Observa\xE7\xE3o"}]}},data(){return{estoquePorEmpresa:[],item:{ativo:!1},itemOriginal:{},ajusteData:null,ajuste:{custoDesejado:0,data:null,lote:"",planoConta:"",planoContaEstoque:"",planoContaMovimento:"",qtdeDesejada:0,qtdeDiferenca:0,qtdeMomento:0},ajusteCor:"text-primary",ajusteMensagem:"",ajusteDataSomenteLeitura:!1,codigoEmpresaSelecionada:0,ajusteRegras:{planoConta:[l=>!!this.ajuste.planoConta||"Selecione uma conta do plano de contas"],planoContaEstoque:[l=>!!this.ajuste.planoContaEstoque||"Selecione uma conta do plano de contas"],planoContaMovimento:[l=>!!this.ajuste.planoContaMovimento||"Selecione uma conta do plano de contas"],custoDesejado:[l=>l>0||"Custo deve ser maior que zero"],qtdeDesejada:[l=>this.ajuste.qtdeDesejada>=0||"Quantidade deve ser maior ou igual a zero"]},codigoEmpresaKardex:0,tipoEstoqueSelecionado:"",tipoLoteSelecionado:"",mensagemKardex:"",tabelaKardex:[],atualizandoKardex:!1,recalculandoKardex:!1,empresas:[],opcoesConta:[],opcoesPlanoConta:[{rotulo:"-",valor:""}],opcoesTipoEstoque:[{rotulo:"-",valor:""}],opcoesLoteEstoque:[{rotulo:"-",valor:""}],permissaoAjusteEstoque:!0,permissaoFicha:!0,usaLote:!1,usaLoteEmpresaKardex:!1,usaLoteEmpresaAjuste:!1}},methods:{ajustarData(){if(!!/\d{2}\/\d{2}\/\d{4}\s\d{2}:\d{2}/.test(this.ajusteData))try{let l=this.ajusteData.split("/");l=[l[1],l[0],l[2]].join("/"),l=new Date(l),this.ajuste.data=l.toISOString()}catch(l){console.log("erro: ",l.message)}},async atualizar({id:l}){if(!!l){try{const o=new Intl.DateTimeFormat("pt-BR",{dateStyle:"short",timeStyle:"medium"});this.ajuste.data=$utils.dataAtual(),this.ajusteData=o.format(new Date(this.ajuste.data)),this.permissaoFicha=await $db.permissao.objeto("item//ficha");const s=await $db.item.leCompletoV2(l);this.item=$utils.clonar(s.item),this.itemOriginal=$utils.clonar(s.item);const a=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data.map(u=>u.id);let r=(await $erp().empresa.toArray()).filter(u=>~a.indexOf(u.idContato));this.empresas=r.map(u=>({rotulo:u.apelido+" - "+u.nome,valor:u.codigoContato})),this.empresas.length===0&&(this.empresas=[{rotulo:"-",valor:""}]),this.estoquePorEmpresa=await $db.estoqueSaldoProdutoEmpresa.leEstoquePorEmpresa(l)}catch(o){$q.notifyError("Ocorreu erro ao consultar produto",o)}try{const o=(await $db.configuracoes.le()).filter(n=>n.nome==="item.estoque.ajuste").sort((n,a)=>n.texto.localeCompare(a.texto));this.opcoesPlanoConta=[{rotulo:"-",valor:""},...o.map(n=>({rotulo:(n.texto||"").trim(),valor:n.valor})),{rotulo:"Especificar Contas",valor:"0"}];const s=(await $db.financeiroPlanoConta.le()).filter(n=>n.ativo&&!!n.tradutor&&n.tradutor.substr(12,5)!=="00000").sort((n,a)=>n.tradutor.localeCompare(a.tradutor));this.opcoesConta=s.map(n=>({valor:n.codigoFinanceiroPlanoConta,rotulo:(n.descricao||"").trim(),sublabel:(n.caminho||"").trim()}))}catch(o){$q.notifyError("Ocorreu erro ao consultar o plano de contas",o),this.opcoesConta=[]}this.atualizarKardex(),this.codigoEmpresaSelecionada||(this.codigoEmpresaSelecionada=this.empresas[0].valor),this.atualizarAjustePorLote(),await this.configLote()}},async configLote(){var o;let l;this.usaLote=!1,l=await $erp().configuracoes.where({nome:"usa.lote"}).toArray(),this.usaLote=((o=l[0])==null?void 0:o.valor)==="1"},async salvarItem(){if(!this.verificarSeAlterouCampos()){$q.notifyPositive("N\xE3o h\xE1 dados alterados.");return}try{const l=this.item.id,o={originais:{item:this.itemOriginal},item:this.item};await $db.item.gravaV2(o),await this.atualizar({id:l}),$q.notifyPositive("Os dados foram salvos com sucesso.")}catch(l){$q.notifyError("Ocorreu um erro ao salvar",l)}},async estoqueAjustar_click(){const l=this.item.id;try{this.ajusteCor="text-primary",this.ajusteMensagem="Processando",$q.loading.show(),await $db.item.ajusteEstoque({codigoEmpresaSelecionada:this.codigoEmpresaSelecionada,idItem:this.item.id,...this.ajuste}),this.ajuste.observacao="",this.ajusteCor="text-positive",this.ajusteMensagem="Ajuste inclu\xEDdo com sucesso!",$q.notifyPositive(this.ajusteMensagem),await this.atualizar({id:l})}catch(o){let s="N\xE3o foi poss\xEDvel realizar o ajuste de estoque.";/^GError:/.test(o.message)&&(s+=` ${o.message.slice(7)}`),this.ajusteCor="text-negative",this.ajusteMensagem=s,$q.notify({type:"negative",message:s})}finally{$q.loading.hide()}},atualizarDiferenca(){this.ajuste.qtdeDiferenca=this.ajuste.qtdeDesejada-this.ajuste.qtdeMomento},async atualizarAjustePorLote(){let l=this.ajusteData;l=l.replace(", "," ");const o=`
          select top 1
            custoMedio valorCustoMedio,
            saldo
          from kardex
          where
            codigoItem = ${(this.item||{}).codigoItem||0}
            and codigoEmpresa = ${this.codigoEmpresaSelecionada||0}
            and datahorafinalizado <= '${l}'
            and tipoEstoque = 'Dispon\xEDvel'
            and ${(this.ajuste.lote||"").trim()?"loteEmpresa = '"+(this.ajuste.lote||"").trim()+"'":"(ltrim(rtrim(loteEmpresa)) = '' or loteEmpresa is null)"}
          order by ordem desc`;let s={};try{s=(await $utils.executarSql(o)||[])[0]||{}}catch{this.ajusteDataSomenteLeitura=!0,$utils.gconsole.log("ItemEstoque","atualizarAjustePorLote",this.codigoEmpresaSelecionada,this.ajuste.lote),s=(((this.estoquePorEmpresa||[]).find(u=>u.codigoEmpresa===this.codigoEmpresaSelecionada)||{}).estoquePorLote||[]).find(u=>u.tipoEstoque==="Dispon\xEDvel"&&(u.loteEmpresa||"")===this.ajuste.lote)||{}}this.ajuste.custoMomento=s.valorCustoMedio||0,this.ajuste.custoDesejado=this.ajuste.custoDesejado||s.valorCustoMedio||0,this.ajuste.qtdeMomento=s.saldo||0,this.ajuste.qtdeDesejada=this.ajuste.qtdeMomento||0,this.atualizarDiferenca(),await this.atualizarKardex()},async recalcularKardex(){try{this.recalculandoKardex=!0,await $utils.geeksApi({kardex:{funcao:"9913E9FD-24A5-4C0A-9F1E-AACCDC7EAB9D",idItem:this.item.id}}),await this.atualizarKardex()}catch(l){console.log(l.message),this.mensagemKardex="N\xE3o foi poss\xEDvel recalcular o Kardex neste momento. Por favor, tente novamente!"}finally{this.recalculandoKardex=!1}},async alterarCodigoEmpresaKardex(){this.tipoLoteSelecionado="",await this.atualizarKardex()},async alterarCodigoEmpresaAjuste(){let l=!1;if(this.codigoEmpresaSelecionada){const s=(await $erp().empresa.toArray()).find(a=>a.codigoContato===this.codigoEmpresaSelecionada);let n;n=await $erp().configuracoes.where({nome:"usa.lote"}).toArray(),n=n.find(a=>a.idEmpresa===(s==null?void 0:s.idContato)),l=(n==null?void 0:n.valor)==="1"}this.usaLoteEmpresaAjuste=l,this.ajuste.lote=""},async atualizarKardex(){var l,o,s,n,a,r,u,d,c;this.atualizandoKardex=!0,this.codigoEmpresaKardex||(this.codigoEmpresaKardex=(l=this.empresas[0])==null?void 0:l.valor);try{let b,m,V,U,x=!1;if(b=await $utils.geeksApi({kardex:{funcao:"267A2ED1-6529-451D-8567-7015470E9CD6",idItem:this.item.id,codigoEmpresa:this.codigoEmpresaKardex}}),m=((s=(o=b==null?void 0:b.data)==null?void 0:o.kardex)!=null?s:[]).filter(y=>y.tipoEstoque).map(y=>y.tipoEstoque),m=Array.from(new Set(m)),m=m.map(y=>({rotulo:y,valor:y})),V=((a=(n=b==null?void 0:b.data)==null?void 0:n.kardex)!=null?a:[]).filter(y=>y.loteEmpresa).map(y=>y.loteEmpresa),V=Array.from(new Set(V)),V=V.map(y=>({rotulo:y,valor:y})),this.tipoEstoqueSelecionado||(this.tipoEstoqueSelecionado=(u=(r=m[0])==null?void 0:r.valor)!=null?u:""),U=((c=(d=b==null?void 0:b.data)==null?void 0:d.kardex)!=null?c:[]).filter(y=>y.tipoEstoque===this.tipoEstoqueSelecionado),this.tipoLoteSelecionado||(U=U.filter(y=>!y.loteEmpresa)),this.tipoLoteSelecionado&&(U=U.filter(y=>y.loteEmpresa===this.tipoLoteSelecionado)),this.codigoEmpresaKardex){const M=(await $erp().empresa.toArray()).find(j=>j.codigoContato===this.codigoEmpresaKardex);b=await $erp().configuracoes.where({nome:"usa.lote"}).toArray(),b=b.find(j=>j.idEmpresa===(M==null?void 0:M.idContato)),x=(b==null?void 0:b.valor)==="1"}this.opcoesTipoEstoque=m,this.opcoesLoteEstoque=V,this.tabelaKardex=U,this.usaLoteEmpresaKardex=x,this.mensagemKardex=""}catch(b){this.mensagemKardex="\xC9 necess\xE1rio estar com a internet ativa para acessar este servi\xE7o",console.error("Mensagem ao usu\xE1rio: "+this.mensagemKardex),console.error(b)}finally{this.atualizandoKardex=!1}},excluirAjuste(l){$q.dialog({message:"Ao continuar o ajuste ser\xE1 exclu\xEDdo.",noRefocus:!0,title:"Tem certeza?",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Continuar",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{try{$q.loading.show({message:"Excluindo ajuste"});const o=`exec Sp_Estoque_ExcluirAjuste ${l}, ${this.item.codigoItem}`;await $utils.executarSql(o),await this.recalcularKardex(),await this.atualizar({id:this.item.id}),$q.notifyPositive("Ajuste exclu\xEDdo com sucesso")}catch{}finally{$q.loading.hide()}})},verificarSeAlterouCampos(){return $utils.diferenca(this.itemOriginal,this.item)!==null}},watch:{"ajuste.data"(){this.atualizarAjustePorLote()},"ajuste.lote"(){this.atualizarAjustePorLote()},codigoEmpresaSelecionada(){this.atualizarAjustePorLote()},codigoEmpresaKardex(){this.atualizarKardex()},tipoEstoqueSelecionado(){this.atualizarKardex()},"ajuste.planoConta"(){if(this.ajuste.planoConta!=="0"){const[l,o]=this.ajuste.planoConta.split(",");this.ajuste.planoContaEstoque=+l||0,this.ajuste.planoContaMovimento=+o||0}},"$route.params.id"(l){this.atualizar({id:l})}}},Ya=C("span",{class:"float-right"},"+",-1),Za=C("span",{class:"float-right"},"=",-1),$a={key:0,class:"row items-center no-wrap"},et={key:1};function ot(l,o,s,n,a,r){const u=v("g-label"),d=v("g-col"),c=v("g-row"),b=v("campo");return p(),I("div",null,[e(c,{gutter:"md",bg:"bg-white",class:"q-my-md"},{default:t(()=>[(p(!0),I(P,null,O(a.estoquePorEmpresa,m=>(p(),g(d,{key:m.idEmpresa,col:"12",class:Ce(a.estoquePorEmpresa.length>1?"q-my-sm":"")},{default:t(()=>[e(u,{text:"sub2 bold",icon:"factory xs grey-7 left"},{default:t(()=>[f(E(m.nomeEmpresa),1)]),_:2},1024),e(c,{justify:"around",text:"center caption medium"},{default:t(()=>[e(d,{col:"2"},{default:t(()=>[f("Tipo")]),_:1}),a.usaLote?(p(),g(d,{key:0,col:"2"},{default:t(()=>[f("Lote")]),_:1})):_("",!0),e(d,{col:"2"},{default:t(()=>[f("Saldo")]),_:1}),e(d,{col:"2"},{default:t(()=>[f("Custo M\xE9dio")]),_:1}),e(d,{col:"2"},{default:t(()=>[f("Custo Real")]),_:1}),e(d,{col:"2"},{default:t(()=>[f("Custo Anterior")]),_:1})]),_:1}),e(u,{bordered:"top"}),(p(!0),I(P,null,O(m.estoquePorLote,(V,U)=>(p(),g(c,{key:U,justify:"around",text:"center caption bolder"},{default:t(()=>[e(d,{col:"2"},{default:t(()=>[f(E(V.tipoEstoque||"-"),1)]),_:2},1024),a.usaLote?(p(),g(d,{key:0,col:"2"},{default:t(()=>[f(E(V.loteEmpresa||"-"),1)]),_:2},1024)):_("",!0),e(d,{col:"2"},{default:t(()=>[f(E(l.$filters.numero(V.saldo,2)),1)]),_:2},1024),e(d,{col:"2"},{default:t(()=>[f(E(l.$filters.numero(V.valorCustoMedio,2)),1)]),_:2},1024),e(d,{col:"2"},{default:t(()=>[f(E(l.$filters.numero(V.valorCusto,2)),1)]),_:2},1024),e(d,{col:"2"},{default:t(()=>[f(E(l.$filters.numero(V.valorCustoAnterior,2)),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1032,["class"]))),128)),a.estoquePorEmpresa.length===0?(p(),g(d,{key:0,col:"12"},{default:t(()=>[e(u,{text:"sub1 bold center"},{default:t(()=>[f("Sem movimenta\xE7\xF5es de estoque.")]),_:1})]),_:1})):_("",!0)]),_:1}),a.item.ativo&&a.permissaoFicha?(p(),g(c,{key:0,gutter:"md",bg:"bg-white",class:"q-mb-md"},{default:t(()=>[e(d,{col:"12"},{default:t(()=>[e(u,{text:"h6"},{default:t(()=>[f("Par\xE2metros")]),_:1})]),_:1}),e(d,{col:"12"},{default:t(()=>[e(Q,{onSubmit:r.salvarItem},{default:t(()=>[e(c,{gutter:"none-y"},{default:t(()=>[e(d,{col:"6 sm4 md"},{default:t(()=>[e(b,{modelValue:a.item.quantidadeMinimaEstoque,"onUpdate:modelValue":o[0]||(o[0]=m=>a.item.quantidadeMinimaEstoque=m),min:"0",rotulo:"Estoque m\xEDnimo",tipo:"decimal",decimals:"2",opcoes:{decimalPlaces:4},class:"q-field--with-bottom"},null,8,["modelValue"])]),_:1}),e(d,{col:"6 sm4 md"},{default:t(()=>[e(b,{modelValue:a.item.quantidadeMinimaCompra,"onUpdate:modelValue":o[1]||(o[1]=m=>a.item.quantidadeMinimaCompra=m),min:"0",rotulo:"Qtde compra reposi\xE7\xE3o",tipo:"decimal",decimalPlaces:"4",decimals:"2",class:"q-field--with-bottom"},null,8,["modelValue"])]),_:1}),e(d,{col:"12 sm4 md"},{default:t(()=>[e(b,{modelValue:a.item.tempoMedioReposicao,"onUpdate:modelValue":o[2]||(o[2]=m=>a.item.tempoMedioReposicao=m),min:"0",rotulo:"Tempo m\xE9dio reposi\xE7\xE3o (dias)",tipo:"quantidade",class:"q-field--with-bottom"},null,8,["modelValue"])]),_:1}),e(d,{col:"6 sm md"},{default:t(()=>[e(b,{modelValue:a.item.consumoMedio,"onUpdate:modelValue":o[3]||(o[3]=m=>a.item.consumoMedio=m),min:"0",rotulo:"Consumo m\xE9dio",tipo:"decimal",decimals:"2",class:"q-field--with-bottom"},null,8,["modelValue"])]),_:1}),e(d,{col:"6 sm md"},{default:t(()=>[e(b,{modelValue:a.item.local,"onUpdate:modelValue":o[4]||(o[4]=m=>a.item.local=m),maxlength:"20",rotulo:"Local",tipo:"texto",class:"q-field--with-bottom"},null,8,["modelValue"])]),_:1}),e(d,{col:"12",text:"right"},{default:t(()=>[e(S,{color:"primary",label:"Salvar",type:"submit",unelevated:""})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})):_("",!0),a.item.ativo&&a.permissaoAjusteEstoque?(p(),g(c,{key:1,gutter:"md",bg:"bg-white",class:"q-mb-md"},{default:t(()=>[e(d,{col:"12"},{default:t(()=>[e(u,{text:"h6"},{default:t(()=>[f("Ajuste")]),_:1})]),_:1}),e(d,{col:"12"},{default:t(()=>[e(Q,{onSubmit:r.estoqueAjustar_click,novalidate:""},{default:t(()=>[e(c,{gutter:"none-y"},{default:t(()=>[e(d,{col:"12"},{default:t(()=>[e(b,{modelValue:a.codigoEmpresaSelecionada,"onUpdate:modelValue":[o[5]||(o[5]=m=>a.codigoEmpresaSelecionada=m),r.alterarCodigoEmpresaAjuste],rotuloFixo:"Empresa",tipo:"seletor",opcoes:a.empresas,class:"q-field--with-bottom"},null,8,["modelValue","opcoes","onUpdate:modelValue"])]),_:1}),e(d,{col:"12 sm"},{default:t(()=>[e(se,{modelValue:a.ajusteData,"onUpdate:modelValue":[o[8]||(o[8]=m=>a.ajusteData=m),r.ajustarData],mask:"##/##/#### ##:##",dense:"",class:"q-field--with-bottom"},{prepend:t(()=>[e(T,{name:"event",class:"cursor-pointer"},{default:t(()=>[e(Pe,{"transition-show":"scale","transition-hide":"scale"},{default:t(()=>[e(qo,{modelValue:a.ajusteData,"onUpdate:modelValue":[o[6]||(o[6]=m=>a.ajusteData=m),r.ajustarData],mask:"DD/MM/YYYY HH:mm"},{default:t(()=>[e(c,{items:"center",justify:"end"},{default:t(()=>[D(e(S,{label:"Fechar",color:"primary",flat:""},null,512),[[R]])]),_:1})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),append:t(()=>[e(T,{name:"access_time",class:"cursor-pointer"},{default:t(()=>[e(Pe,{"transition-show":"scale","transition-hide":"scale"},{default:t(()=>[e(wo,{modelValue:a.ajusteData,"onUpdate:modelValue":[o[7]||(o[7]=m=>a.ajusteData=m),r.ajustarData],mask:"DD/MM/YYYY HH:mm",format24h:""},{default:t(()=>[e(c,{class:"row items-center justify-end"},{default:t(()=>[D(e(S,{label:"Fechar",color:"primary",flat:""},null,512),[[R]])]),_:1})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),e(d,{col:"12 sm"},{default:t(()=>[e(b,{modelValue:a.ajuste.custoDesejado,"onUpdate:modelValue":o[9]||(o[9]=m=>a.ajuste.custoDesejado=m),rotulo:"Custo desejado",tipo:"decimal",decimals:"2",class:"q-field--with-bottom"},null,8,["modelValue"])]),_:1}),a.usaLoteEmpresaAjuste?(p(),g(d,{key:0,col:"12 md"},{default:t(()=>[e(b,{modelValue:a.ajuste.lote,"onUpdate:modelValue":o[10]||(o[10]=m=>a.ajuste.lote=m),modelModifiers:{trim:!0},rotulo:"Lote",tipo:"texto",maxlength:"50",class:"q-field--with-bottom"},null,8,["modelValue"])]),_:1})):_("",!0),e(d,{col:"12"},{default:t(()=>[e(b,{modelValue:a.ajuste.observacao,"onUpdate:modelValue":o[11]||(o[11]=m=>a.ajuste.observacao=m),modelModifiers:{trim:!0},rotulo:"Observa\xE7\xF5es",tipo:"texto",maxlength:"500",class:"q-field--with-bottom"},null,8,["modelValue"])]),_:1}),e(d,{col:"12 sm"},{default:t(()=>[e(b,{modelValue:a.ajuste.planoConta,"onUpdate:modelValue":o[12]||(o[12]=m=>a.ajuste.planoConta=m),opcoes:a.opcoesPlanoConta,rules:a.ajusteRegras.planoConta,errorMessage:"Obrigat\xF3rio",rotuloFixo:"Plano de contas",tipo:"seletor"},null,8,["modelValue","opcoes","rules"])]),_:1}),a.ajuste.planoConta==="0"?(p(),I(P,{key:1},[e(d,{col:"12 sm"},{default:t(()=>[e(b,{modelValue:a.ajuste.planoContaEstoque,"onUpdate:modelValue":o[13]||(o[13]=m=>a.ajuste.planoContaEstoque=m),filter:"",errorMessage:"Obrigat\xF3rio",rotuloFixo:"Conta estoque",tipo:"seletor",opcoes:a.opcoesConta,rules:a.ajusteRegras.planoContaEstoque},null,8,["modelValue","opcoes","rules"])]),_:1}),e(d,{col:"12 sm"},{default:t(()=>[e(b,{modelValue:a.ajuste.planoContaMovimento,"onUpdate:modelValue":o[14]||(o[14]=m=>a.ajuste.planoContaMovimento=m),filter:"",errorMessage:"Obrigat\xF3rio",rotuloFixo:"Conta movimento",tipo:"seletor",opcoes:a.opcoesConta,rules:a.ajusteRegras.planoContaMovimento},null,8,["modelValue","opcoes","rules"])]),_:1})],64)):_("",!0),e(d,{col:"12"},{default:t(()=>[e(c,{items:"top"},{default:t(()=>[e(d,{col:"6 sm"},{default:t(()=>[e(u,{text:"caption"},{default:t(()=>[f("Saldo atual")]),_:1}),e(u,null,{default:t(()=>[f(E(l.$filters.numero(a.ajuste.qtdeMomento,4))+" ",1),Ya]),_:1})]),_:1}),e(d,{col:"6 sm"},{default:t(()=>[e(u,{text:"caption"},{default:t(()=>[f("Diferen\xE7a")]),_:1}),e(u,null,{default:t(()=>[f(E(l.$filters.numero(a.ajuste.qtdeDiferenca,4))+" ",1),Za]),_:1})]),_:1}),e(d,{col:"12 sm"},{default:t(()=>[e(b,{modelValue:a.ajuste.qtdeDesejada,"onUpdate:modelValue":[o[15]||(o[15]=m=>a.ajuste.qtdeDesejada=m),r.atualizarDiferenca],rotulo:"Saldo desejado",tipo:"decimal",decimals:"4",rules:a.ajusteRegras.qtdeDesejada},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:1})]),_:1})]),_:1}),e(d,{col:"12"},{default:t(()=>[e(u,{text:"right"},{default:t(()=>[C("span",{class:Ce(["q-pa-sm",a.ajusteCor])},E(a.ajusteMensagem),3),e(S,{color:"primary",label:"Ajustar",type:"submit",unelevated:""})]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})):_("",!0),a.item.ativo?(p(),g(c,{key:2,gutter:"md",bg:"bg-white",class:"q-mb-lg"},{default:t(()=>[e(d,{col:"12"},{default:t(()=>[e(u,{text:"h6"},{default:t(()=>[f("Hist\xF3rico de Movimenta\xE7\xF5es (Kardex)")]),_:1})]),_:1}),e(d,{col:"12",class:"q-mb-sm"},{default:t(()=>[e(c,{gutter:"none-y"},{default:t(()=>[e(d,{col:"6 sm"},{default:t(()=>[e(b,{modelValue:a.codigoEmpresaKardex,"onUpdate:modelValue":[o[16]||(o[16]=m=>a.codigoEmpresaKardex=m),r.alterarCodigoEmpresaKardex],opcoes:a.empresas,rotuloFixo:"Empresa",tipo:"seletor"},null,8,["modelValue","onUpdate:modelValue","opcoes"])]),_:1}),e(d,{col:"2"},{default:t(()=>[e(b,{modelValue:a.tipoEstoqueSelecionado,"onUpdate:modelValue":[o[17]||(o[17]=m=>a.tipoEstoqueSelecionado=m),r.atualizarKardex],opcoes:a.opcoesTipoEstoque,"rotulo-fixo":"Tipo de estoque",tipo:"seletor"},null,8,["modelValue","onUpdate:modelValue","opcoes"])]),_:1}),a.usaLoteEmpresaKardex?(p(),g(d,{key:0,col:"2"},{default:t(()=>[e(b,{modelValue:a.tipoLoteSelecionado,"onUpdate:modelValue":[o[18]||(o[18]=m=>a.tipoLoteSelecionado=m),r.atualizarKardex],opcoes:a.opcoesLoteEstoque,"rotulo-fixo":"Lote",tipo:"seletor",clearable:""},null,8,["modelValue","onUpdate:modelValue","opcoes"])]),_:1})):_("",!0),e(d,{col:"2 sm-shrink",offset:"0 md1",text:"right"},{default:t(()=>[e(S,{onClick:r.recalcularKardex,loading:a.recalculandoKardex,label:"Recalcular",color:"primary"},null,8,["onClick","loading"]),e(S,{onClick:r.atualizarKardex,loading:a.atualizandoKardex,icon:"mdi-reload",flat:"",round:"",class:"q-ml-sm"},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1}),a.mensagemKardex?(p(),g(d,{key:0,col:"12"},{default:t(()=>[e(u,{text:"center sub1 medium",color:"text-negative",class:"q-pb-sm"},{default:t(()=>[f(E(a.mensagemKardex),1)]),_:1})]),_:1})):_("",!0),e(d,{col:"12"},{default:t(()=>[e(ye,{rows:a.tabelaKardex,columns:r.colunasKardex,"row-key":"name",bordered:"",class:"no-shadow"},{body:t(m=>[e(po,{props:m},{default:t(()=>[(p(!0),I(P,null,O(m.cols,V=>(p(),g(fo,{key:V.name,props:m},{default:t(()=>[V.field==="acao"?(p(),I("div",$a,[a.permissaoAjusteEstoque&&(m.cols.find(U=>U.field==="documentoTipo")||{}).value==="Estoque"&&(m.cols.find(U=>U.field==="documentoItemOperacao")||{}).value!=="Manipula\xE7\xE3o"?(p(),g(S,{key:0,onClick:U=>r.excluirAjuste((m.cols.find(x=>x.field==="codigoDocumento")||{}).value),icon:"mdi-trash-can-outline",size:"sm",round:"",dense:"",class:"q-mr-sm"},{default:t(()=>[e(B,{anchor:"bottom middle",self:"center middle",class:"hideonmobile"},{default:t(()=>[f("Excluir ajuste")]),_:1})]),_:2},1032,["onClick"])):_("",!0)])):(p(),I("div",et,E(V.value),1))]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1})]),_:1})):_("",!0)])}var at=G(Wa,[["render",ot]]);const tt={data(){return{item:{}}},methods:{async atualizar(){var l;try{const o=(l=this.params)==null?void 0:l.idItem;this.itemOriginal=await $erp().item.get(o),this.item=$utils.clonarV2(this.itemOriginal)}catch(o){console.log(o.message)}},async salvar(){try{const l={};if(this.item.fiscalBlocoKCodigoAntigo!==this.itemOriginal.fiscalBlocoKCodigoAntigo&&(l.fiscalBlocoKCodigoAntigo=this.item.fiscalBlocoKCodigoAntigo),this.item.fiscalBlocoKTipo!==this.itemOriginal.fiscalBlocoKTipo&&(l.fiscalBlocoKTipo=this.item.fiscalBlocoKTipo),!(Object.keys(l).length>0)){$q.notify({message:"N\xE3o h\xE1 dados alterados.",type:"positive"});return}await $db.item.gravarSimplesV1(this.item.id,l),await this.atualizar(),$q.notify({message:"Dados salvos com sucesso.",type:"positive"})}catch(l){console.log(l.message),$q.notify({message:"Ocorreu um erro ao salvar os dados. Por favor, tente novamente.",type:"negative"})}}},props:{params:{type:Object}},watch:{params(){this.atualizar()}}};function lt(l,o,s,n,a,r){const u=v("campo"),d=v("g-col"),c=v("g-row");return p(),I("div",null,[e(Q,{onSubmit:r.salvar},{default:t(()=>[e(c,{gutter:"md"},{default:t(()=>[e(d,{col:"12 sm6"},{default:t(()=>[e(u,{modelValue:a.item.fiscalBlocoKCodigoAntigo,"onUpdate:modelValue":o[0]||(o[0]=b=>a.item.fiscalBlocoKCodigoAntigo=b),rotulo:"C\xF3digo Antigo",filled:""},null,8,["modelValue"])]),_:1}),e(d,{class:"12 sm6"},{default:t(()=>[e(u,{modelValue:a.item.fiscalBlocoKTipo,"onUpdate:modelValue":o[1]||(o[1]=b=>a.item.fiscalBlocoKTipo=b),rotulo:"Tipo do Item",filled:""},null,8,["modelValue"])]),_:1}),e(d,{col:"12",text:"right"},{default:t(()=>[e(L,{class:"q-mb-sm"}),e(S,{type:"submit",label:"Salvar",color:"primary",unelevated:""})]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}var it=G(tt,[["render",lt]]);const Me={vBCSTRet:0,pST:0,vICMSSTRet:0,vICMSSubstituto:0},rt={data(){return{item:{},json:{icmsSTRet:{...Me}},mostrarCampos:!1,opcoesCampos:[{value:!1,label:"OCULTAR"},{value:!0,label:"MOSTRAR"}]}},methods:{async atualizar(){var l,o,s,n;try{const a=(l=this.params)==null?void 0:l.idItem;this.item=await $erp().item.get(a),this.json=(n=JSON.parse((s=(o=this.item)==null?void 0:o.json)!=null?s:null))!=null?n:{},this.json.icmsSTRet&&(this.mostrarCampos=!0),this.json.icmsSTRet||(this.json.icmsSTRet={...Me})}catch(a){console.log(a.message)}},calcularvICMSSTRet(){this.json.icmsSTRet.vICMSSTRet=$utils.arredondar(this.json.icmsSTRet.vBCSTRet*(this.json.icmsSTRet.pST/100),4)},async salvar(){try{this.mostrarCampos||delete this.json.icmsSTRet,await $db.item.gravarSimplesV1(this.item.id,{json:JSON.stringify(this.json)}),await this.atualizar(),$q.notify({message:"Dados salvos com sucesso.",type:"positive"})}catch(l){console.log(l.message),$q.notify({message:"Ocorreu um erro ao salvar os dados. Por favor, tente novamente.",type:"negative"})}}},props:{params:{type:Object}},watch:{params(){this.atualizar()}}};function st(l,o,s,n,a,r){const u=v("g-col"),d=v("campo"),c=v("g-row");return p(),I("div",null,[e(c,{gutter:"md"},{default:t(()=>[e(u,{col:"12",text:"right"},{default:t(()=>[e(ke,{modelValue:a.mostrarCampos,"onUpdate:modelValue":o[0]||(o[0]=b=>a.mostrarCampos=b),options:a.opcoesCampos,"toggle-color":"primary",unelevated:"",class:"float-right"},null,8,["modelValue","options"]),e(L,{class:"q-mt-xl"})]),_:1}),e(u,{col:"12"},{default:t(()=>[e(Q,{onSubmit:r.salvar},{default:t(()=>[a.mostrarCampos?(p(),g(c,{key:0},{default:t(()=>[e(u,{col:"12 sm6 md3"},{default:t(()=>[e(d,{modelValue:a.json.icmsSTRet.vBCSTRet,"onUpdate:modelValue":o[1]||(o[1]=b=>a.json.icmsSTRet.vBCSTRet=b),onBlur:r.calcularvICMSSTRet,filled:"",dica:"vBCSTRet",tipo:"decimal",decimals:"4",rotulo:"Valor da BC do ICMS ST retido anteriormente"},null,8,["modelValue","onBlur"])]),_:1}),e(u,{col:"12 sm6 md3"},{default:t(()=>[e(d,{modelValue:a.json.icmsSTRet.pST,"onUpdate:modelValue":o[2]||(o[2]=b=>a.json.icmsSTRet.pST=b),onBlur:r.calcularvICMSSTRet,suffix:"%",filled:"",tipo:"decimal",decimals:"2",rotulo:"Aliquota suportada pelo consumidor final",dica:"pST"},null,8,["modelValue","onBlur"])]),_:1}),e(u,{col:"12 sm6 md3"},{default:t(()=>[e(d,{modelValue:a.json.icmsSTRet.vICMSSTRet,"onUpdate:modelValue":o[3]||(o[3]=b=>a.json.icmsSTRet.vICMSSTRet=b),"somente-leitura":"",filled:"",dica:"vICMSSTRet = vBCSTRet * (pST / 100)",tipo:"decimal",decimals:"4",rotulo:"Valor do ICMS ST retido anteriormente"},null,8,["modelValue"])]),_:1}),e(u,{col:"12 sm6 md3"},{default:t(()=>[e(d,{modelValue:a.json.icmsSTRet.vICMSSubstituto,"onUpdate:modelValue":o[4]||(o[4]=b=>a.json.icmsSTRet.vICMSSubstituto=b),tipo:"decimal",decimals:"4",filled:"",dica:"vICMSSubstituto (campo opcional)",rotulo:"Valor do ICMS Pr\xF3prio do Substituto",ajuda:"Cobrado em opera\xE7\xE3o anterior"},null,8,["modelValue"])]),_:1}),e(u,{col:"12",text:"right"},{default:t(()=>[e(L,{class:"q-mb-sm"}),e(S,{type:"submit",label:"Salvar",color:"primary",unelevated:""})]),_:1})]),_:1})):_("",!0)]),_:1},8,["onSubmit"])]),_:1})]),_:1})])}var nt=G(rt,[["render",st]]);const dt={data(){return{item:{},opcaoNCM:0,opcoesNCM:[{value:0,label:"PADR\xC3O"},{value:1,label:"PERSONALIZADO"}],ufsDescricao:[],ufsNcm:[]}},methods:{async atualizar({id:l}){var o;try{this.obterUfs(),this.item=await $erp().item.get(l);const n=(JSON.parse(((o=this.item)==null?void 0:o.json)||null)||{}).impostoST;if(this.opcaoNCM=1,!n){this.opcaoNCM=0;return}for(const a of this.ufsNcm)!~n.indexOf(a.uf)||(a.st=!0)}catch(s){console.log(s.message)}},descricaoUF(l){const o=this.ufsDescricao.find(s=>s.sigla===l);return`${o.nome} (${o.sigla})`},desmarcarTodos(){for(const l of this.ufsNcm)l.st=!1},inverterSelecao(){for(const l of this.ufsNcm)l.st=!l.st},obterUfs(){this.ufsNcm=[{uf:"AC",st:!1},{uf:"AL",st:!1},{uf:"AP",st:!1},{uf:"AM",st:!1},{uf:"BA",st:!1},{uf:"CE",st:!1},{uf:"DF",st:!1},{uf:"ES",st:!1},{uf:"GO",st:!1},{uf:"MA",st:!1},{uf:"MT",st:!1},{uf:"MS",st:!1},{uf:"MG",st:!1},{uf:"PA",st:!1},{uf:"PB",st:!1},{uf:"PR",st:!1},{uf:"PE",st:!1},{uf:"PI",st:!1},{uf:"RJ",st:!1},{uf:"RN",st:!1},{uf:"RS",st:!1},{uf:"RO",st:!1},{uf:"RR",st:!1},{uf:"SC",st:!1},{uf:"SP",st:!1},{uf:"SE",st:!1},{uf:"TO",st:!1}]},obterUfsDescricao(){this.ufsDescricao=[{nome:"Acre",sigla:"AC"},{nome:"Alagoas",sigla:"AL"},{nome:"Amap\xE1",sigla:"AP"},{nome:"Amazonas",sigla:"AM"},{nome:"Bahia",sigla:"BA"},{nome:"Cear\xE1",sigla:"CE"},{nome:"Distrito Federal",sigla:"DF"},{nome:"Esp\xEDrito Santo",sigla:"ES"},{nome:"Goi\xE1s",sigla:"GO"},{nome:"Maranh\xE3o",sigla:"MA"},{nome:"Mato Grosso",sigla:"MT"},{nome:"Mato Grosso do Sul",sigla:"MS"},{nome:"Minas Gerais",sigla:"MG"},{nome:"Par\xE1",sigla:"PA"},{nome:"Para\xEDba",sigla:"PB"},{nome:"Paran\xE1",sigla:"PR"},{nome:"Pernambuco",sigla:"PE"},{nome:"Piau\xED",sigla:"PI"},{nome:"Rio de Janeiro",sigla:"RJ"},{nome:"Rio Grande do Norte",sigla:"RN"},{nome:"Rio Grande do Sul",sigla:"RS"},{nome:"Rond\xF4nia",sigla:"RO"},{nome:"Roraima",sigla:"RR"},{nome:"Santa Catarina",sigla:"SC"},{nome:"S\xE3o Paulo",sigla:"SP"},{nome:"Sergipe",sigla:"SE"},{nome:"Tocantins",sigla:"TO"}]},async salvar(){var l;try{const o=JSON.parse(((l=this.item)==null?void 0:l.json)||null)||{},s=o.impostoST||[],n=this.ufsNcm.filter(a=>a.st).map(a=>a.uf);o.impostoST=n,this.opcaoNCM===0&&delete o.impostoST,await $db.item.gravarSimplesV1(this.item.id,{json:JSON.stringify(o)}),await this.atualizar({id:this.item.id}),$q.notify({message:"Dados salvos com sucesso.",type:"positive"})}catch(o){console.log(o.message),$q.notify({message:"Ocorreu um erro ao salvar os dados. Por favor, tente novamente.",type:"negative"})}}},beforeMount(){this.obterUfsDescricao()}};function mt(l,o,s,n,a,r){const u=v("g-label"),d=v("g-col"),c=v("g-row");return p(),I("div",null,[e(c,{gutter:"md",items:"center"},{default:t(()=>[e(d,{col:"12"},{default:t(()=>[e(u,{text:"sub1 medium",inline:"",class:"q-mt-xs"},{default:t(()=>[f("Substitui\xE7\xE3o Tribut\xE1ria por UF")]),_:1}),e(ke,{modelValue:a.opcaoNCM,"onUpdate:modelValue":o[0]||(o[0]=b=>a.opcaoNCM=b),options:a.opcoesNCM,"toggle-color":"primary",unelevated:"",class:"float-right"},null,8,["modelValue","options"]),e(L,{class:"q-mt-md"})]),_:1}),e(d,{col:"12"},{default:t(()=>[a.opcaoNCM===0?(p(),g(c,{key:0,gutter:"none"},{default:t(()=>[e(d,null,{default:t(()=>[e(u,{text:"body1 medium center"},{default:t(()=>[f("Padr\xE3o")]),_:1})]),_:1})]),_:1})):_("",!0),a.opcaoNCM===1?(p(),g(c,{key:1,gutter:"none"},{default:t(()=>[e(d,{col:"12",text:"right"},{default:t(()=>[e(S,{onClick:r.desmarcarTodos,label:"Desmarcar todos",icon:"remove_done",size:"sm",unelevated:""},null,8,["onClick"]),e(S,{onClick:r.inverterSelecao,label:"Inverter sele\xE7\xE3o",icon:"rule",size:"sm",unelevated:""},null,8,["onClick"]),e(L)]),_:1}),e(d,{col:"12"},{default:t(()=>[e(ne,{link:"","no-border":"",separator:""},{default:t(()=>[(p(!0),I(P,null,O(a.ufsNcm,b=>(p(),g(A,{key:b.uf,class:"q-pa-sm"},{default:t(()=>[e(w,null,{default:t(()=>[e(J,null,{default:t(()=>[f(E(r.descricaoUF(b.uf)),1)]),_:2},1024)]),_:2},1024),e(w,{side:""},{default:t(()=>[e(he,{color:"blue",modelValue:b.st,"onUpdate:modelValue":m=>b.st=m,val:"1"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):_("",!0)]),_:1}),e(d,{col:"12",text:"right"},{default:t(()=>[e(L,{class:"q-mb-sm"}),e(S,{class:"q-ml-sm",unelevated:"",color:"primary",label:"Salvar",onClick:r.salvar},null,8,["onClick"])]),_:1})]),_:1})])}var ut=G(dt,[["render",mt]]);const De={id:"",descricao:"",finalidade:100,json:{contribuinte:[{descricao:"Venda",interna:"",internaST:"",interestadual:"",interestadualST:""},{descricao:"Devolu\xE7\xE3o",interna:"",internaST:"",interestadual:"",interestadualST:""}],naoContribuinte:[{descricao:"Venda",interna:"",internaST:"",interestadual:"",interestadualST:""},{descricao:"Devolu\xE7\xE3o",interna:"",internaST:"",interestadual:"",interestadualST:""}]}},pe={show:!1,titulo:"",documento:{}},ct={components:{SeletorCfop:xo},data(){return{documentos:[],columnsContribuinte:[{name:"descricao",align:"left",label:"PJ Contribuinte",field:"descricao",sortable:!1},{name:"interna",align:"left",label:"Interna",field:"interna",sortable:!1},{name:"internaST",align:"left",label:"Interna ST",field:"internaST",sortable:!1},{name:"interestadual",align:"left",label:"Interestadual",field:"interestadual",sortable:!1},{name:"interestadualST",align:"left",label:"Interestadual ST",field:"interestadualST",sortable:!1}],columnsNaoContribuinte:[{name:"descricao",align:"left",label:"PF/PJ N\xE3o Contribuinte",field:"descricao",sortable:!1},{name:"interna",align:"left",label:"Interna",field:"interna",sortable:!1},{name:"internaST",align:"left",label:"Interna ST",field:"internaST",sortable:!1},{name:"interestadual",align:"left",label:"Interestadual",field:"interestadual",sortable:!1},{name:"interestadualST",align:"left",label:"Interestadual ST",field:"interestadualST",sortable:!1}],opcoesFinalidade:[{label:"Revenda",value:99},{label:"Consumo",value:100}],opcaoOperacoes:0,opcoesOperacoes:[{value:0,label:"PADR\xC3O"},{value:1,label:"PERSONALIZADO"}],modal:{},validations:{required:[l=>l.length||"Campo obrigat\xF3rio"]}}},methods:{async alternarOpcoesOperacoes(){var l,o;if(this.opcaoOperacoes===0)try{const s=(l=this.params)==null?void 0:l.idItem;let n,a;if(n=await $erp().item.get(s),a=(o=JSON.parse((n==null?void 0:n.json)||null))!=null?o:{},!a.documentosOperacao)return;await new Promise((r,u)=>{$q.dialog({message:"Deseja alterar para opera\xE7\xF5es padr\xE3o?",title:"Descartar",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Descartar",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(()=>{r()}).onCancel(()=>{u("Rejected")})}),delete a.documentosOperacao,await $db.item.gravarSimplesV1(s,{json:JSON.stringify(a)}),await this.carregarDocumentosPadrao(),this.documentos=$utils.clonarV2(this.documentosPadrao),$q.notify({message:"Os dados de opera\xE7\xF5es foram salvos com sucesso",type:"positive"})}catch(s){if(s==="Rejected"){this.opcaoOperacoes=1;return}console.log(s.message),$q.notify({message:"Ocorreu um erro ao salvar os dados de opera\xE7\xF5es. Por favor, tente novamente.",type:"negative"})}},async atualizar(){var l,o;this.modal=$utils.clonarV2(pe);try{const s=(l=this.params)==null?void 0:l.idItem;let n,a,r,u;if(r=await $erp().item.get(s),u=(o=JSON.parse((r==null?void 0:r.json)||null))!=null?o:{},a=u.documentosOperacao,await this.carregarDocumentosPadrao(),n=$utils.clonarV2(this.documentosPadrao),this.opcaoOperacoes=0,a){this.opcaoOperacoes=1;for(const d of Object.keys(a)){const c=n.find(b=>b.id===d);c.json=a[d]}}this.documentos=n}catch(s){console.log(s.message)}},alterar(l){const o=this.documentos.find(s=>s.id===l);this.modal.documento=$utils.clonarV2(o),this.modal.titulo="Alterar opera\xE7\xE3o",this.modal.show=!0},async carregarDocumentosPadrao(){this.modal=$utils.clonarV2(pe);try{let l;this.documentosPadrao=await $db.documentoOperacao.ler();for(const o of this.documentosPadrao){if(!o.json){o.json=$utils.clonarV2(De.json);continue}o.json=JSON.parse(o.json)}}catch(l){console.log(l.message)}},descricaoFinalidade(l){var s;const o=this.documentos.find(n=>n.id===l);return(s=this.opcoesFinalidade.find(n=>n.value===o.finalidade))==null?void 0:s.label},async salvar(){var l,o,s;try{const n=(l=this.params)==null?void 0:l.idItem,a=this.modal.documento.id,r={contribuinte:this.modal.documento.json.contribuinte,naoContribuinte:this.modal.documento.json.naoContribuinte};let u,d,c;if(u=await $erp().item.get(n),d=(o=JSON.parse((u==null?void 0:u.json)||null))!=null?o:{},c=(s=d.documentosOperacao)!=null?s:{},$lodash.isEqual(c[a],r)){console.log("iguais");return}c[a]=r,d.documentosOperacao=c,await $db.item.gravarSimplesV1(n,{json:JSON.stringify(d)}),$q.notify({message:"Dados salvos com sucesso.",type:"positive"})}catch(n){console.log(n.message),$q.notify({message:"Ocorreu um erro ao salvar os dados. Por favor, tente novamente.",type:"negative"})}finally{this.atualizar()}},voltar(l){l.stopPropagation();const o=this.documentos.find(n=>n.id===this.modal.documento.id);let s={};if(o||(s=$utils.diferencaObjetos(De,this.modal.documento)),o&&(s=$utils.diferencaObjetos(o,this.modal.documento)),delete s.id,!Object.keys(s).length){this.modal=$utils.clonarV2(pe);return}$q.dialog({message:"Deseja descartar as modifica\xE7\xF5es?",title:"Descartar",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Descartar",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(()=>{this.modal=$utils.clonarV2(pe)})}},props:{params:{type:Object}},watch:{params(){this.atualizar()}}};function pt(l,o,s,n,a,r){const u=v("g-col"),d=v("BadgeCopiarUid"),c=v("g-row"),b=v("campo"),m=v("badge"),V=v("g-label"),U=v("SeletorCfop");return p(),I("div",null,[e(c,{gutter:"md",items:"center"},{default:t(()=>[e(u,{col:"12",text:"right"},{default:t(()=>[e(ke,{modelValue:a.opcaoOperacoes,"onUpdate:modelValue":[o[0]||(o[0]=x=>a.opcaoOperacoes=x),r.alternarOpcoesOperacoes],options:a.opcoesOperacoes,"toggle-color":"primary",unelevated:""},null,8,["modelValue","onUpdate:modelValue","options"]),e(L,{class:"q-mt-md"})]),_:1}),e(u,{col:"12"},{default:t(()=>[e(ne,{"no-border":""},{default:t(()=>[(p(!0),I(P,null,O(a.documentos,x=>(p(),I(P,{key:x.id},[e(A,{class:"q-pa-sm bg-light rounded-borders"},{default:t(()=>[e(w,{avatar:""},{default:t(()=>[e(d,{id:x.id,cor:x.ativo?"positive":"tertiary",dica:x.ativo?"Ativado":"Desativado"},null,8,["id","cor","dica"])]),_:2},1024),e(w,null,{default:t(()=>[f(E(x.descricao),1)]),_:2},1024),e(w,{avatar:""},{default:t(()=>[e(_e,{color:"tertiary"},{default:t(()=>[f(E(r.descricaoFinalidade(x.id)),1)]),_:2},1024)]),_:2},1024),x.ativo&&a.opcaoOperacoes===1?(p(),g(w,{key:0,avatar:""},{default:t(()=>[e(S,{onClick:y=>r.alterar(x.id),icon:"edit",round:"",flat:"",dense:"",color:"primary"},null,8,["onClick"])]),_:2},1024)):_("",!0)]),_:2},1024),x.json?(p(),g(A,{key:0,class:"q-pa-sm"},{default:t(()=>[x.json.contribuinte[0].interna!=""||x.json.naoContribuinte[0].interna!=""?(p(),g(w,{key:0,class:"q-mb-md"},{default:t(()=>[e(c,null,{default:t(()=>[x.json.contribuinte[0].interna?(p(),g(u,{key:0,col:"12 md6"},{default:t(()=>[e(ye,{rows:x.json.contribuinte,columns:a.columnsContribuinte,"row-key":"descricao",flat:"",dense:"","hide-bottom":""},null,8,["rows","columns"])]),_:2},1024)):_("",!0),x.json.naoContribuinte[0].interna?(p(),g(u,{key:1,col:"12 md6"},{default:t(()=>[e(ye,{rows:x.json.naoContribuinte,columns:a.columnsNaoContribuinte,"row-key":"descricao",flat:"",dense:"","hide-bottom":""},null,8,["rows","columns"])]),_:2},1024)):_("",!0)]),_:2},1024)]),_:2},1024)):(p(),g(w,{key:1},{default:t(()=>[e(L)]),_:1}))]),_:2},1024)):_("",!0)],64))),128))]),_:1})]),_:1})]),_:1}),e(H,{modelValue:a.modal.show,"onUpdate:modelValue":o[2]||(o[2]=x=>a.modal.show=x),onKeyup:Be(r.voltar,["esc"]),"content-css":{maxWidth:"80vw"},maximized:"",persistent:""},{default:t(()=>[e(Oe,{container:"",class:"bg-light"},{default:t(()=>[e(Q,{onSubmit:r.salvar},{default:t(()=>[e(Re,null,{default:t(()=>[e(W,null,{default:t(()=>[e(S,{onClick:r.voltar,icon:"arrow_back",round:"",flat:"",dense:""},null,8,["onClick"]),e(Y,null,{default:t(()=>[f(E(a.modal.titulo),1)]),_:1}),e(S,{label:"Salvar",type:"submit",color:"white","text-color":"primary",unelevated:""})]),_:1})]),_:1}),e(Ne,null,{default:t(()=>[e(Le,{class:"u-container"},{default:t(()=>[e(c,{gutter:"md",bg:"bg-white","rounded-borders":"",class:"q-my-md"},{default:t(()=>[e(u,{col:"12"},{default:t(()=>[e(b,{modelValue:a.modal.documento.descricao,"onUpdate:modelValue":o[1]||(o[1]=x=>a.modal.documento.descricao=x),rules:a.validations.required,rotulo:"Descri\xE7\xE3o",somenteLeitura:"",filled:"","hide-bottom-space":""},null,8,["modelValue","rules"])]),_:1}),e(u,{col:"12"},{default:t(()=>[e(c,null,{default:t(()=>[e(u,{class:"shrink"},{default:t(()=>[f(" Finalidade: "),e(m,{cor:"tertiary",escuro:"",class:"q-ml-sm"},{default:t(()=>[f(E(r.descricaoFinalidade(a.modal.documento.id)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(c,{gutter:"md",bg:"bg-white","rounded-borders":""},{default:t(()=>[e(u,{col:"12"},{default:t(()=>[e(V,{text:"h6"},{default:t(()=>[f("PJ Contribuinte")]),_:1})]),_:1}),e(u,{col:"12"},{default:t(()=>[e(c,{items:"center"},{default:t(()=>[e(u,{col:"12 md"},{default:t(()=>[f(" \xA0\xA0\xA0 ")]),_:1}),e(u,{col:"6 md"},{default:t(()=>[e(V,{text:"body2 bold"},{default:t(()=>[f("Interna")]),_:1}),e(L)]),_:1}),e(u,{col:"6 md"},{default:t(()=>[e(V,{text:"body2 bold"},{default:t(()=>[f("Interna ST")]),_:1}),e(L)]),_:1}),e(u,{col:"6 md"},{default:t(()=>[e(V,{text:"body2 bold"},{default:t(()=>[f("Interestadual")]),_:1}),e(L)]),_:1}),e(u,{col:"6 md"},{default:t(()=>[e(V,{text:"body2 bold"},{default:t(()=>[f("Interestadual ST")]),_:1}),e(L)]),_:1})]),_:1}),(p(!0),I(P,null,O(a.modal.documento.json.contribuinte,x=>(p(),g(c,{key:x.descricao,items:"center"},{default:t(()=>[e(u,{col:"12 md",mg:"lg-b"},{default:t(()=>[e(V,{text:"body2 bold"},{default:t(()=>[f(E(x.descricao),1)]),_:2},1024)]),_:2},1024),e(u,{col:"6 md",mg:"lg-b"},{default:t(()=>[e(U,{modelValue:x.interna,"onUpdate:modelValue":y=>x.interna=y,rules:a.validations.required},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(u,{col:"6 md",mg:"lg-b"},{default:t(()=>[e(U,{modelValue:x.internaST,"onUpdate:modelValue":y=>x.internaST=y,rules:a.validations.required},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(u,{col:"6 md",mg:"lg-b"},{default:t(()=>[e(U,{modelValue:x.interestadual,"onUpdate:modelValue":y=>x.interestadual=y,rules:a.validations.required},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(u,{col:"6 md",mg:"lg-b"},{default:t(()=>[e(U,{modelValue:x.interestadualST,"onUpdate:modelValue":y=>x.interestadualST=y,rules:a.validations.required},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),a.modal.documento.finalidade===100?(p(),g(c,{key:0,gutter:"md",bg:"bg-white","rounded-borders":""},{default:t(()=>[e(u,{col:"12"},{default:t(()=>[e(V,{text:"h6"},{default:t(()=>[f("PF/PJ N\xE3o Contribuinte")]),_:1})]),_:1}),e(u,{col:"12"},{default:t(()=>[e(c,{items:"center"},{default:t(()=>[e(u,{col:"12 md"},{default:t(()=>[f(" \xA0\xA0\xA0 ")]),_:1}),e(u,{col:"12 md"},{default:t(()=>[e(V,{text:"body2 bold"},{default:t(()=>[f("Interna")]),_:1}),e(L)]),_:1}),e(u,{col:"12 md"},{default:t(()=>[e(V,{text:"body2 bold"},{default:t(()=>[f("Interna ST")]),_:1}),e(L)]),_:1}),e(u,{col:"12 md"},{default:t(()=>[e(V,{text:"body2 bold"},{default:t(()=>[f("Interestadual")]),_:1}),e(L)]),_:1}),e(u,{col:"12 md"},{default:t(()=>[e(V,{text:"body2 bold"},{default:t(()=>[f("Interestadual ST")]),_:1}),e(L)]),_:1})]),_:1}),(p(!0),I(P,null,O(a.modal.documento.json.naoContribuinte,x=>(p(),g(c,{key:x.descricao,items:"center"},{default:t(()=>[e(u,{col:"12 md",mg:"lg-b"},{default:t(()=>[e(V,{text:"body2 bold"},{default:t(()=>[f(E(x.descricao),1)]),_:2},1024)]),_:2},1024),e(u,{col:"6 md",mg:"lg-b"},{default:t(()=>[e(U,{modelValue:x.interna,"onUpdate:modelValue":y=>x.interna=y,rules:a.validations.required},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(u,{col:"6 md",mg:"lg-b"},{default:t(()=>[e(U,{modelValue:x.internaST,"onUpdate:modelValue":y=>x.internaST=y,rules:a.validations.required},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(u,{col:"6 md",mg:"lg-b"},{default:t(()=>[e(U,{modelValue:x.interestadual,"onUpdate:modelValue":y=>x.interestadual=y,rules:a.validations.required},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(u,{col:"6 md",mg:"lg-b"},{default:t(()=>[e(U,{modelValue:x.interestadualST,"onUpdate:modelValue":y=>x.interestadualST=y,rules:a.validations.required},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):_("",!0)]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue","onKeyup"])])}var ft=G(ct,[["render",pt]]);const ht={components:{BlocoK:it,ICMSSTRet:nt,NCM:ut,Operacoes:ft},data(){return{operacoesParams:{},ICMSSTRetParams:{},blocoKParams:{}}},methods:{async atualizar({id:l}){this.operacoesParams={idItem:l},this.ICMSSTRetParams={idItem:l},this.blocoKParams={idItem:l},await this.$refs.NCM.atualizar({id:l})}}};function gt(l,o,s,n,a,r){const u=v("Operacoes"),d=v("g-col"),c=v("NCM"),b=v("ICMSSTRet"),m=v("BlocoK"),V=v("g-row");return p(),I("div",null,[e(V,{gutter:"md",bg:"bg-white",class:"q-my-md"},{default:t(()=>[e(d,{col:"12"},{default:t(()=>[e(ue,{group:"somegroup",icon:"explore",label:"Opera\xE7\xF5es",class:"expansion-impostos border-full rounded-borders"},{default:t(()=>[e(u,{params:a.operacoesParams},null,8,["params"])]),_:1})]),_:1}),e(d,{col:"12"},{default:t(()=>[e(ue,{group:"somegroup",icon:"explore",label:"NCM",class:"expansion-impostos border-full rounded-borders"},{default:t(()=>[e(c,{ref:"NCM"},null,512)]),_:1})]),_:1}),e(d,{col:"12"},{default:t(()=>[e(ue,{group:"somegroup",icon:"explore",class:"expansion-impostos border-full rounded-borders",label:"ICMS Retido Anteriormente por Substitui\xE7\xE3o Tribut\xE1ria"},{default:t(()=>[e(b,{params:a.ICMSSTRetParams},null,8,["params"])]),_:1})]),_:1}),e(d,{col:"12"},{default:t(()=>[e(ue,{group:"somegroup",icon:"explore",label:"Bloco K",class:"expansion-impostos border-full rounded-borders"},{default:t(()=>[e(m,{params:a.blocoKParams},null,8,["params"])]),_:1})]),_:1})]),_:1})])}var bt=G(ht,[["render",gt]]);const vt={components:{itemFicha:Xa,ItemEstoque:at,Impostos:bt,Avatar:qe,Tutorial:ho,JsonViewer:Ge},data(){return{item:{id:""},visivel:!1,abas:[],abaSelecionada:"ItemFicha",abaAnterior:"ItemFicha",objetoPai:"item",permissaoFicha:!1,permissaoEcommerce:!1,permissaoEstoque:!1}},emits:["atualizar"],methods:{trocarAba_click(l){let o=!1;try{o=this.$refs[this.abaAnterior].verificarSeAlterouCampos()}catch{}o?$q.dialog({message:"Deseja descartar suas modifica\xE7\xF5es?",title:"Aten\xE7\xE3o!",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Descartar",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(()=>{this.abaAnterior=this.abaSelecionada}).onCancel(()=>{this.abaSelecionada=this.abaAnterior}):this.abaAnterior=this.abaSelecionada},async fechar(){this.visivel=!1,this.$emit("atualizar"),this.$router.push({name:"Item"})},async duplicarItem(l){try{const o=await $db.item.duplica(l);this.$emit("atualizar",o.id),this.fechar(),this.$q.notifyPositive("O produto foi duplicado com sucesso.")}catch(o){this.$q.notifyError("Ocorreu erro ao duplicar Produto",o)}},removerFoto(l){$q.dialog({message:"Deseja remover a foto?",cancel:{label:"N\xC3O",push:!0,color:"tertiary",flat:!0},ok:{label:"SIM",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(()=>{l.imagem="",this.$refs.ItemFicha.removerFoto()})},async atualizar({id:l}){var o;try{this.$q.loading.show();const s=JSON.parse((o=localStorage.getItem("clienteSistema"))!=null?o:null),n=(await $plataforma.objeto.where({nomeObjeto:this.objetoPai}).toArray()).find(d=>d.id);if(!((n==null?void 0:n.id)&&(s==null?void 0:s.idSistema)))return;let a=await $plataforma.sistemaObjeto.where({idPai:n.id,idSistema:s.idSistema}).toArray();if(!a.length)return;const r=await $plataforma.objeto.where("id").anyOf(a.map(d=>d.idObjeto)).toArray();if(!r.length)return;a=a.sort((d,c)=>(d.ordem||0)>(c.ordem||0)?1:-1);const u=[];for(const d of a){const c=r.find(m=>m.id===d.idObjeto),b=JSON.parse(c.rota||null)||{};!await $db.permissao.objeto(c.nomeObjeto)||c.tipo==="componente"&&!c.menuPrincipal&&(c.menuDesenvolvimento&&!($db.usuario.logado.desenvolvedor&&$db.usuario.logado.desenvolvedor())||u.push({icon:c.icone||"",label:c.descricao||"",to:{name:b.name||""}}))}this.abas=u,this.permissaoFicha=await $db.permissao.objeto("item//ficha"),this.permissaoEstoque=await $db.permissao.objeto("item//estoque"),this.permissaoEcommerce=await $db.permissao.objeto("item//ecommerce"),this.abaSelecionada==="ItemFicha"&&!this.permissaoFicha&&(this.abaSelecionada="ItemEstoque"),this.item=await $db.item.leNew({id:l}),await this.$refs.ItemFicha.atualizar({id:l}),await this.$refs.ItemEstoque.atualizar({id:l}),await this.$refs.Impostos.atualizar({id:l})}finally{this.$q.loading.hide()}},async show({id:l}){this.visivel=!0,await this.atualizar({id:l})},async mostrarJsonViewer(){await this.$refs.jsonViewer.show(this)}}};function Vt(l,o,s,n,a,r){const u=v("avatar"),d=v("Tutorial"),c=v("itemFicha"),b=v("ItemEstoque"),m=v("Impostos"),V=v("JsonViewer");return p(),g(H,{modelValue:a.visivel,"onUpdate:modelValue":o[4]||(o[4]=U=>a.visivel=U),persistent:"",maximized:"",onKeyup:Be(r.fechar,["esc"])},{default:t(()=>[e(Oe,{class:"bg-light",container:""},{default:t(()=>[e(Ne,{class:"u-container",style:{"padding-bottom":"0"}},{default:t(()=>[e(Re,{class:"bg-gradiente"},{default:t(()=>[e(W,{class:"no-shadow q-px-none q-py-sm",color:"transparent"},{default:t(()=>[D(e(S,{dense:"",flat:"",icon:"arrow_back",round:"",onClick:r.fechar},null,8,["onClick"]),[[R]]),e(u,{imagem:a.item.imagem,tamanho:"40",rotulo:a.item.descricao},null,8,["imagem","rotulo"]),e(Y,null,{default:t(()=>[f(E(a.item.descricao||"Item"),1)]),_:1}),e(d,{componente:"ItemModalFicha"}),D(e(S,{dense:"",flat:"",icon:"more_vert",round:"",size:"md"},{default:t(()=>[e(we,null,{default:t(()=>[e(ne,{link:"","no-border":"",separator:""},{default:t(()=>[D((p(),g(A,{clickable:"",onClick:o[0]||(o[0]=U=>r.duplicarItem(a.item.id))},{default:t(()=>[e(w,{avatar:""},{default:t(()=>[e(T,{name:"control_point_duplicate"})]),_:1}),e(w,null,{default:t(()=>[e(J,null,{default:t(()=>[f("Duplicar Produto/Servi\xE7o")]),_:1})]),_:1})]),_:1})),[[R]]),D((p(),g(A,{clickable:"",onClick:o[1]||(o[1]=U=>r.removerFoto(a.item))},{default:t(()=>[e(w,{avatar:""},{default:t(()=>[e(T,{name:"mdi-image-remove"})]),_:1}),e(w,null,{default:t(()=>[f("Remover Foto")]),_:1})]),_:1})),[[R]]),l.$db.usuario.desenvolvedor()?D((p(),g(A,{key:0,clickable:"",onClick:o[2]||(o[2]=U=>r.mostrarJsonViewer(this))},{default:t(()=>[e(w,{avatar:""},{default:t(()=>[e(T,{name:"mdi-image-remove"})]),_:1}),e(w,null,{default:t(()=>[f("Ver Objeto")]),_:1})]),_:1})),[[R]]):_("",!0)]),_:1})]),_:1})]),_:1},512),[[ie,a.permissaoFicha]])]),_:1}),e(je,{modelValue:a.abaSelecionada,"onUpdate:modelValue":[o[3]||(o[3]=U=>a.abaSelecionada=U),r.trocarAba_click],align:"justify",class:"ModalAWrapper q-px-none u-container","indicator-color":"light-blue-4",color:"transparent","text-color":"white"},{default:t(()=>[(p(!0),I(P,null,O(a.abas,(U,x)=>(p(),g($,{key:x,icon:U.icon,label:U.label,name:U.to.name,class:"ModalA-aba"},null,8,["icon","label","name"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),e(Le,null,{default:t(()=>[D(e(c,{ref:"ItemFicha"},null,512),[[ie,a.abaSelecionada==="ItemFicha"]]),D(e(b,{ref:"ItemEstoque"},null,512),[[ie,a.abaSelecionada==="ItemEstoque"]]),D(e(m,{ref:"Impostos"},null,512),[[ie,a.abaSelecionada==="ItemImpostos"]])]),_:1})]),_:1}),e(V,{ref:"jsonViewer"},null,512)]),_:1})]),_:1},8,["modelValue","onKeyup"])}var Ct=G(vt,[["render",Vt]]);const yt={components:{lista:bo,Avatar:qe,Badge:go,importarItens:No,editarMarca:ma,modalItemCriar:ba,modalSincronizarECommerce:_a,modalItemFicha:Ct,modalCombinarItens:ka,SeletorCampoTabela:Te,importarDadosReferencia:Ke,JsonViewer:Ge},computed:{opcoesStatus(){return[{rotulo:"Linha",valor:"Linha"},{rotulo:"Fora de Linha",valor:"Fora de Linha"},{rotulo:"Promo\xE7\xE3o",valor:"Promo\xE7\xE3o"}]}},data(){return{catalogoVirtualChecked:{},lista:[],listaOriginal:[],listaLayout:{},modalCombinarItens:!1,modalImportar:!1,campos:{codigoBarras:"",descricao:"",marca:"",referencia:"",tipo:"Produto",valorCustoReposicao:0,valorVenda:0},paginacao:{atual:1,maximo:1,total:1,limite:25,ordenacao:["descricaoConcatenada"]},permissaoImportarImagensEAN:!1,permissaoFicha:!1,permissaoEstoque:!1,permissaoCatalogoVirtual:!1,mostrarOpcaoSincronizarECommerce:!1,showFilters:!1,filtros:{ativo:null,descricaoAplicacao:null,codIdRef:null,codigoBarras:null,marca:null,fornecedores:null,grupo:null,subGrupo:null,status:null,estoque:null,tipo:null,codigoCompra:null,catalogoVirtualChecked:!1},buscaCampo:"",opcoesMarca:[],opcoesGrupo:[],opcoesSubGrupo:[],opcoesTipo:[],tabSelecionada:{valor:"Ativos"},tabs:[{rotulo:"Ativos",value:"Ativos"},{rotulo:"Exclu\xEDdos",value:"Excluidos"},{rotulo:"Todos",value:"Todos"}],showAllPreviewDetail:!1,checkboxModel:!1,sistemaPai:$utils.sistemaPai(),dialogoImprimirEtiquetas:{visivel:!1,empresa:null,tabelaPreco:null,modelo:null,listaEmpresas:[]},usuario:JSON.parse(localStorage.getItem("usuario")),clienteSistema:JSON.parse(localStorage.getItem("clienteSistema")),opcoesTabelasPrecoFull:[],opcoesTabelasPreco:[],mainPular:0,opcoesPlanoConta:[],modeloImpressaoSelecionada:null,empresaSelecionada:null,tabelaPreco:null,opcoesEmpresas:[],opcoesModeloImpressao:[]}},methods:{atualizarValorVendaLucro(l){if(this.listaLayout[l.id].utilizaMarkupInvertido){if(!!l.valorCustoReposicao&&!!l.valorVenda){const o=100*(l.valorVenda-l.valorCustoReposicao)/l.valorVenda;l.percentualMarkup=$utils.arredondar(o,2)}}else{const o=(l.percentualMarkup||0)/100;if(!!l.valorCustoReposicao&&o<1){const s=l.valorCustoReposicao/(1-o);s&&(l.valorVenda=$utils.arredondar(s,4))}}},atualizarCustoReposicao(l){l&&l.id&&!this.listaLayout[l.id].utilizaComposicaoValorReposicaoInvertido&&(l.valorCustoReposicao=(l.composicao||[]).reduce((o,s)=>o+s.temporario.total,0),l.valorCustoReposicao||(l.percentualMarkup=100),this.atualizarValorVendaLucro(l))},async atualizar(l=null){try{$q.loading.show();const o=$utils.eliminarVazios(this.filtros);if(delete o.ativo,this.tabSelecionada.valor==="Ativos"&&(o.ativo=!0),this.tabSelecionada.valor==="Excluidos"&&(o.ativo=!1),o.catalogoVirtualChecked){delete o.catalogoVirtualChecked,o.ids=[];for(const n of Object.keys(this.catalogoVirtualChecked))!this.catalogoVirtualChecked[n]||o.ids.push(n)}this.buscaCampo=l||this.buscaCampo,this.itemListaFiltro={...o,termoBusca:this.buscaCampo},localStorage.setItem("itemListaFiltro",JSON.stringify(this.itemListaFiltro));const s=await $db.item.ler({filtros:this.itemListaFiltro,limit:this.paginacao.limite,page:this.paginacao.atual,sort:this.paginacao.ordenacao});s.total||(s.total=s.total=s.data.length),s.totalPages||(s.totalPages=1),this.listaLayout={};for(let n of s.data)this.listaLayout[n.id]={detalhes:!1,remover:!1,utilizaMarkupInvertido:!n.utilizaMarkup,utilizaComposicaoValorReposicaoInvertido:!n.utilizaComposicaoValorReposicao};this.listaOriginal=$utils.clonarV2(s.data),this.lista=s.data;for(const n of this.lista)n.id in this.catalogoVirtualChecked||(this.catalogoVirtualChecked[n.id]=!1);this.paginacao.total=s.total,this.paginacao.maximo=s.totalPages}catch(o){$q.notifyError("Erro iniciar",o)}finally{$q.loading.hide()}},toggleCatalogoVirtual(l){const o=l==="on";$q.dialog({title:`${o?"Habilitar":"Desabilitar"} itens para o cat\xE1logo virtual`,options:{type:"radio",model:"opt1",items:[{label:"Todos os itens da p\xE1gina atual",value:"opt1"},{label:"Todos os itens filtrados",value:"opt2"}]},cancel:{label:"N\xE3o",push:!0,color:"textiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-primary",textColor:"white",flat:!0}}).onOk(async s=>{var n;if($q.loading.show(),s==="opt1")for(const a of this.lista)this.catalogoVirtualChecked[a.id]=o;if(s==="opt2"){const a=await $db.item.ler({filtros:this.itemListaFiltro,somenteDadosIndexados:!0});for(const r of(n=a.data)!=null?n:[])this.catalogoVirtualChecked[r.id]=o}await this.salvarCatalogoVirtual(),$q.loading.hide()})},async salvarCatalogoVirtual(){var s;$q.loading.show();const o=(s=(await this.$utils.geeksApi({site:{funcao:"84C328A7-CEA7-4762-A703-C59DE8D53BF5"}})).data.site)!=null?s:{};o.itens=[];for(const n of Object.keys(this.catalogoVirtualChecked))!this.catalogoVirtualChecked[n]||o.itens.push(n);await this.$utils.geeksApi({site:{funcao:"E981897C-A205-441E-99DE-BECD16CB261A",...$utils.clonarV2(o)}}),this.$q.notifyPositive("Salvo com sucesso!"),$q.loading.hide()},async removerItem(l){$q.dialog({cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},title:"Remover",message:"Ao continuar voc\xEA ir\xE1 remover este item.",ok:{label:"Sim",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{try{$q.loading.show();const o=$utils.clonar(l);l.ativo=!1,await $db.item.grava({atual:l,original:o}),$q.notifyPositive("O produto foi exclu\xEDdo com sucesso.")}catch(o){$q.notifyError("Ocorreu um erro ao remover produto",o)}finally{$q.loading.hide()}})},async duplicarItem(l){try{const o=await $db.item.duplica(l.id);this.filtros.codIdRef=o.id,await this.atualizar(o.id),this.$q.notifyPositive("O produto foi duplicado com sucesso.")}catch(o){this.$q.notifyError("Ocorreu erro ao duplicar Produto",o)}},async abrirItem(l){!(this.permissaoFicha||this.permissaoEstoque)||this.$router.replace({params:{id:l}}).finally(async()=>{this.$refs.modalFicha.abaAnterior="ItemFicha",this.$refs.modalFicha.abaSelecionada="ItemFicha",await this.$refs.modalFicha.show({id:l})})},async restaurarItem(l){$q.dialog({title:"Restaurar item",message:"Deseja restaurar este item?",cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{try{$q.loading.show();let o=$utils.clonarV2(l);l.ativo=!0,await $db.item.grava({atual:l,original:o}),$q.notifyPositive("O produto foi restaurado com sucesso.")}catch(o){$q.notifyError("Ocorreu um erro ao remover produto",o)}finally{$q.loading.hide()}})},limparFiltros_click(){this.filtros={tab:"Ativos",descricaoAplicacao:null,codIdRef:null,codigoBarras:null,marca:null,fornecedores:null,grupo:null,subGrupo:null,status:null,estoque:null,tipo:null,codigoCompra:null},this.atualizar()},async filtroFornecedor_click(){const l=await $g.promptContato.show({filtro:{ativo:!0}});l.nome&&(this.filtros.fornecedores=l.nome)},async leOpcoesMarca(){this.opcoesMarca=(await $db.item.leValoresUnicos("marca")).map(l=>({rotulo:l,valor:l}))},async leOpcoesGrupo(){this.opcoesGrupo=(await $db.item.leValoresUnicos("grupo")).map(l=>({rotulo:l,valor:l}))},async leOpcoesTipo(){this.opcoesTipo=ge},async itemCriarPorModal_click(){const l=await this.$refs.modalItemCriar.show();!l.id||(this.filtros.codIdRef=l.id,await this.atualizar(l.id),this.abrirEdicaoCompleta(l.id))},async sincronizarECommercePorModal_click(){await this.$refs.modalSincronizarECommerce.show({filtros:this.itemListaFiltro,limit:this.paginacao.limite,page:this.paginacao.atual,sort:this.paginacao.ordenacao})},async buscarItem(){const l=await $g.promptItem.show({filtro:{ativo:!0}});l.acao&&Object.keys(l.itensSelecionados)[0]&&this.abrirItem(Object.keys(l.itensSelecionados)[0])},checkBoxGeral_click(){for(let l of this.lista)this.listaLayout[l.id].remover=this.checkboxModel},async removerTodos(){$q.dialog({title:"Remover itens",message:"Deseja remover todos os itens selecionados?",cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{for(let l of this.lista)if(this.listaLayout[l.id].remover){const o=$utils.clonarV2(l);l.ativo=!1;try{await $db.item.grava({original:o,atual:l})}catch{$q.notify("Houve um erro ao remover os itens. Tente novamente")}}})},async restaurarTodos(){$q.dialog({title:"Restaurar itens",message:"Deseja restaurar todos os itens selecionados?",cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{for(let l of this.lista)if(this.listaLayout[l.id].remover){let o=$utils.clonarV2(l);l.ativo=!0;try{await $db.item.grava({original:o,atual:l})}catch{$q.notify("Houve um erro ao restaurar os itens. Tente novamente")}}})},async abrirDetalhesItem(l,o){if(this.listaLayout[l.id].detalhes=o||!this.listaLayout[l.id].detalhes,this.listaLayout[l.id].detalhes){let s=await $db.item.leCompleto(l.id);this.listaLayout[l.id].fornecedor=s.atual.fornecedor}},abrirTodosPreview(){this.showAllPreviewDetail=!this.showAllPreviewDetail,this.lista.forEach(l=>{this.abrirDetalhesItem(l,this.showAllPreviewDetail)})},importarDados_click(){this.$refs.modalImportarDados.visivel=!0},editarMarca_click(){this.$refs.modalEditarMarca.visivel=!0},async adicionarItem(){if(this.campos.descricao.length<2){$q.notifyError("favor preencher a descri\xE7\xE3o do item");return}let l={};try{this.completarCodigoBarras(),l={...$db.item.vazio,id:$utils.uuid(),ativo:!0,tipo:this.campos.tipo,marca:this.campos.marca,descricao:this.campos.descricao,referencia:this.campos.referencia,valorVenda:this.campos.valorVenda,codigoBarras:this.campos.codigoBarras,valorCustoReposicao:this.campos.valorCustoReposicao},$q.loading.show(),await $db.item.grava({atual:l}),this.filtros.codIdRef=l.id,this.atualizar(),$q.notifyPositive("Os dados do produto foram salvos com sucesso."),this.campos={ativo:!0,codigoBarras:"",descricao:"",marca:"",referencia:"",tipo:"Produto",valorCustoReposicao:0,valorVenda:0}}catch(o){$q.notifyError("Ocorreu um erro ao salvar",o)}finally{$q.loading.hide()}},abrirEdicaoCompleta(l){$q.dialog({title:"Item Cadastrado!",message:"Deseja abrir a edi\xE7\xE3o completa?",persistent:"Sim",cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-primary",textColor:"white",flat:!0}}).onOk(()=>{this.abrirItem(l)})},async exportarXLSX_click(){try{$q.loading.show();const l=$utils.eliminarVazios(this.filtros);delete l.ativo,this.tabSelecionada.valor==="Ativos"&&(l.ativo=!0),this.tabSelecionada.valaor==="Excluidos"&&(l.ativo=!1);const s=(await $db.item.leRefatorado({filtros:l,limit:999999,page:1,sort:"descricao"})).data;for(let r=0;r<s.length;r++){const u=s[r];delete u.imagem}const n=ce.utils.book_new(),a=ce.utils.json_to_sheet(s,{header:Object.keys(s[0])});ce.utils.book_append_sheet(n,a,"itens"),ce.writeFile(n,"itens.xlsx")}catch(l){$q.notifyError("Erro iniciar",l)}finally{$q.loading.hide()}},async salvarItem(l){let o=await $erp().item.get(l.id),s=$utils.clonarV2(l);try{await $db.item.gravaItem({original:o,atual:s}),this.$q.notifyPositive("Item alterado com sucesso")}catch(n){console.error(n),this.$q.notifyError("Ocorreu um erro ao alterar o item"),this.atualizar()}},completarCodigoBarras(){!this.campos.codigoBarras&&!!this.campos.codigoItem&&(this.campos.codigoBarras=$utils.completarCodigoBarras(String(this.campos.codigoItem)))},criarMarca(){$q.dialog({title:"Cadastrar marca",prompt:{model:"",isValid:l=>l.length<=50,type:"text",class:"bg-light"},cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-primary",textColor:"white",flat:!0}}).onOk(l=>{try{if(!l){alert("Favor preencher");return}if(l.length>50){alert("M\xE1ximo 50 caracteres");return}if(this.opcoesMarca.find(o=>o.rotulo.toUpperCase()===l.toUpperCase())){alert("Nome j\xE1 existente");return}this.campos.marca=l,$q.notifyPositive("Marca criada com sucesso.")}catch(o){$q.notifyError("Ocorreu um erro ao criar marca",o)}})},async importarDadosReferencia(l){var s;JSON.parse((s=localStorage.getItem("itemListaFiltro"))!=null?s:null);const o=await $db.item.ler({filtros:this.itemListaFiltro});$q.loading.show();for(const n of o.data)try{const a=$utils.clonarV2(n),r=await $db.arquivo.ler({filtros:{idTabelaMaster:n.id}}),u=$utils.clonarV2(r),d=await $db.item.importarDadosProdutoReferencia({item:n,arquivosOriginal:u,alterarDescricao:l.alterarDescricao,alterarValorCusto:l.alterarValorCusto,alterarValorVenda:l.alterarValorVenda});await $db.item.grava({atual:d.item,original:a}),d.arquivos.forEach(b=>{r.find(V=>V.arquivo===b.arquivo)||$db.arquivo.gravar({atual:b,original:{}})}),$q.notifyPositive(`Imagens e dados importados com sucesso para o produto ${n.descricao}`)}catch(a){$q.notify({message:`N\xE3o encontramos imagens ou dados para a refer\xEAncia do produto ${n.descricao}`,type:"warning"}),console.error(a)}$q.loading.hide(),await this.atualizar()},async getImagesFromApi(l){try{const s=(await $utils.geeksApi({getImagesFromApi:{funcao:"DB75E495-D0F8-4F09-BB51-9F028BB87D8B",ean:l.codigoBarras}})).data.getImagesFromApi.replace(/(\[*\]*'*)/g,""),n=[];for(const a of s.split(",")){const r=await this.getImageB6FromApi(a);n.push({id:$utils.uuid(),dataCriacao:$utils.dataAtual(),nome:a,idTabelaMaster:l.id,arquivo:r})}return n}catch(o){console.log(o)}finally{$q.loading.hide()}},async getImageB6FromApi(l){const o=await $utils.geeksApi({getImagesFromApi:{funcao:"E480B438-2555-4936-B04D-77EC188E0ADB",path:l}});return o==null?void 0:o.data.getImagesFromApi},async mostrarJsonViewer(){await this.$refs.jsonViewer.show(this)},async imprimirEtiquetas(){var s,n;$q.loading.show();const l=await $db.etiqueta.ler({cpfUsuarioLogado:this.usuario.cpf});for(const a of l)await $db.etiqueta.remover(a.id);const o=this.lista;try{for(let a of o){const u=(await $db.estoqueSaldoProdutoEmpresa.leEstoquePorEmpresa(a.id)).find(m=>m.codigoEmpresa===this.empresaSelecionada.value);if(!u||((s=a==null?void 0:a.valorVenda)!=null?s:0)<=0)continue;let d=0,c=0;if(c=u.estoquePorLote.reduce((m,V)=>m+V.saldo,d),!(c>0))continue;console.log(c);let b={id:$utils.uuid(),idItem:a.id,nomeProduto:a.descricaoConcatenada,valor:(n=a.valorVenda)!=null?n:0,quantidadeEtiquetas:c!=null?c:0,cpfUsuarioLogado:this.usuario.cpf};await $db.etiqueta.gravar({atual:b})}this.ImprimirLista(),$q.loading.hide(),this.dialogoImprimirEtiquetas.visivel=!1}catch(a){console.log(a.message)}},async abrirDialogoImprimirEtiquetas(){const l=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;this.dialogoImprimirEtiquetas.listaEmpresas=l.map(s=>({value:s.codigoContato,label:s.nome+" - "+s.numeroDocumentoNacional,cnpj:s.numeroDocumentoNacional,inscricaoMunicipal:s.numeroDocumentoMunicipal})),this.dialogoImprimirEtiquetas.empresa=this.dialogoImprimirEtiquetas.listaEmpresas[0],this.opcoesTabelasPrecoFull=await $db.itemTabelaPreco.le({ativo:!0,tabelaMaster:!0}),this.opcoesTabelasPreco=this.opcoesTabelasPrecoFull.map(s=>({label:s.descricao,value:s.codigoItemTabelaPreco}));let o=await $erp().configuracoes.where({nome:"impressao.etiqueta"}).toArray();o.length?this.opcoesModeloImpressao=o.map(s=>({label:s.texto,value:s.valor})):this.opcoesModeloImpressao=[{label:"Personaliz\xE1vel",value:"etiqueta_generica_ajustavel"},{label:"Folha Argox",value:"etiquetaFilaUnica"},{label:"Folha Carta",value:"etiquetaa4"},{label:"Folha Pimaco",value:"EtiquetaPimaco6Col"}],this.modeloImpressaoSelecionada=this.opcoesModeloImpressao[0].value,this.tabelaPreco=this.opcoesTabelasPreco[0].value,this.dialogoImprimirEtiquetas.visivel=!0},ImprimirLista(){let l="OptiSoul/";this.modeloImpressaoSelecionada.value==="etiqueta_generica_ajustavel"&&(l="");const o=`
          https://rel.storage.b15.com.br/Relatorios/${l}${this.modeloImpressaoSelecionada.value}.html
          ?rid=F3DAAA9EABE48D9843C4FF4B33FA3125
          &Banco=${this.clienteSistema.bancoDeDados}
          &URLServidor=https://api.b15.com.br/sql/srv5
          &CodigoUsuario=${this.usuario.codigoUsuario}
          &EmBranco=${this.mainPular}
          &TabelaPreco=${this.tabelaPreco.value}
          &CodigoContatoEmpresa=${this.empresaSelecionada.value}
          &cpfUsuarioLogado=${this.usuario.cpf}
          &hfCodigoSistema={
            data:{
              CodigoUsuario:${this.usuario.codigoUsuario},
              CodigoSistema:${this.clienteSistema.codigoSistema},
              CodigoClienteSistema:${this.clienteSistema.CodigoClienteSistema},
              Sistema:${this.clienteSistema.sistema},
              URLServidor:${this.clienteSistema.URLServidor},
              BancoDeDados:${this.clienteSistema.bancoDeDados},
              CodigoCliente:${this.clienteSistema.codigoCliente},
              Cliente:${this.clienteSistema.cliente},
              Administrador:${this.clienteSistema.administrador},
              GrupoInterno:${this.clienteSistema.grupoInterno}
            }
          }
        `;window.open(o.replace(/[\s\n]/g,""),"_blank").focus()},async adicionarItensEtiquetas(){await new Promise((l,o)=>{$q.dialog({title:"Imprimir Etiquetas",message:"Deseja incluir os itens listados, na impress\xE3o de etiquetas?",cancel:{label:"CANCELAR",push:!0,color:"tertiary",flat:!0},ok:{label:"CONFIRMAR",push:!0,class:"bg-primary",textColor:"white",flat:!0}}).onOk(async()=>{var s;console.log("OK");try{$q.loading.show();const n=this.lista,a=[];for(let r of n){if(!await $db.estoqueSaldoProdutoEmpresa.leEstoquePorEmpresa(r.id))continue;let d={id:$utils.uuid(),idItem:r.id,nomeProduto:r.descricaoConcatenada,valor:(s=r.valorVenda)!=null?s:0,quantidadeEtiquetas:1,cpfUsuarioLogado:this.usuario.cpf};await $db.etiqueta.gravar({atual:d})}this.$router.push({name:"ImprimirEtiquetas"})}catch(n){console.log(n.message)}finally{$q.loading.hide()}}).onCancel(()=>{console.log("cancelar")})})}},async mounted(){var l=this;const o=await $db.configuracoes.le({nome:"importarImagensEAN"});if(this.permissaoImportarImagensEAN=o.some(s=>Number(s.valor)===1),this.permissaoFicha=await $db.permissao.objeto("item//ficha"),this.permissaoEstoque=await $db.permissao.objeto("item//estoque"),this.permissaoCatalogoVirtual=await $db.permissao.objeto("site"),$db.eCommerce.ler().then(s=>{this.mostrarOpcaoSincronizarECommerce=s.some(n=>n.ativo)}),ge[1].valor,await this.atualizar(),this.permissaoCatalogoVirtual)try{this.$utils.geeksApi({site:{funcao:"84C328A7-CEA7-4762-A703-C59DE8D53BF5"}}).then(s=>{var n,a,r;for(const u of(r=(a=(n=s.data)==null?void 0:n.site)==null?void 0:a.itens)!=null?r:[])!$db.item.itens.some(d=>d.id===u)||(this.catalogoVirtualChecked[u]=!0)})}catch(s){console.error(s)}if(this.$route.params.id){const s=this.$route.params.id;this.$route.path===`/item/${s}/ficha`&&(await this.$refs.modalFicha.show({id:s}),this.$refs.modalFicha.abaAnterior="ItemFicha",this.$refs.modalFicha.abaSelecionada="ItemFicha"),this.$route.path===`/item/${s}/estoque`&&(await this.$refs.modalFicha.show({id:s}),this.$refs.modalFicha.abaAnterior="ItemEstoque",this.$refs.modalFicha.abaSelecionada="ItemEstoque")}this.$route.params.id&&this.$route.params.id.length&&l.abrirItem(this.$route.params.id)}},_t={class:"mw80 text-center"},qt={key:0,class:"q-pt-xs q-pb-sm q-px-sm"},wt={class:"row"},xt={class:"col-12 col-md-6"},St={class:"row"},It={class:"col-12 col-md-6 q-px-sm q-pb-xs"},kt={class:"col-12 col-md-6 q-px-sm"},Et={class:"q-py-xs"},Ut={style:{"white-space":"pre-line"}},Pt={class:"col-12 col-md-6"},Mt={key:0,class:"row"},Dt={class:"col-2 col-md-auto q-py-none q-px-sm q-my-xs"},Ft={class:"col-10 col-md q-py-none q-px-sm q-my-xs"},At={class:"offset-2 col-10 offset-md-0 col-md q-py-none q-px-sm q-my-xs"},zt={class:"col-2 col-md-auto q-py-none q-px-sm q-my-xs"},Tt={class:"col-10 col-md q-py-none q-px-sm q-my-xs"},jt={class:"col-12 col-md-auto q-pa-sm"},Ot={class:"col-6"},Rt={class:"col-6"},Nt={class:"col-12"},Lt={class:"col-12"},Bt={class:"q-mt-lg text-right"};function Gt(l,o,s,n,a,r){const u=v("campo"),d=v("SeletorCampoTabela"),c=v("badge"),b=v("avatar"),m=v("lista"),V=v("modalItemFicha"),U=v("editarMarca"),x=v("importarItens"),y=v("modalCombinarItens"),M=v("modalItemCriar"),j=v("modalSincronizarECommerce"),F=v("importarDadosReferencia"),N=v("JsonViewer"),te=v("row");return p(),I("div",null,[e(m,{titulo:"Produtos e Servi\xE7os",buscaCampo:a.buscaCampo,"onUpdate:buscaCampo":o[24]||(o[24]=i=>a.buscaCampo=i),checkboxModel:a.checkboxModel,"onUpdate:checkboxModel":o[25]||(o[25]=i=>a.checkboxModel=i),onFiltro_change:r.atualizar,onCriar_click:r.itemCriarPorModal_click,onCheckBoxGeral_click:r.checkBoxGeral_click,onLimparFiltros_click:r.limparFiltros_click,onAbrirTodosPreview:r.abrirTodosPreview,onExportarXLSX_click:r.exportarXLSX_click,onRemoverTodos:r.removerTodos,onRestaurarTodos:r.restaurarTodos,lista:a.lista,listaLayout:a.listaLayout,paginacao:a.paginacao,filtros:a.filtros,tabSelecionada:a.tabSelecionada,tabs:a.tabs,permissaoNovo:a.permissaoFicha,removerTodosVisible:a.permissaoFicha,opcoesMarca:a.opcoesMarca,opcoesGrupo:a.opcoesGrupo,opcoesSubGrupo:a.opcoesSubGrupo,opcoesTipo:a.opcoesTipo,opcoesStatus:r.opcoesStatus,multiplosBtnNovo:!1,showQuickAdd:!1},{menuExtras:t(()=>[a.permissaoFicha?(p(),g(A,{key:0,clickable:"",onClick:o[0]||(o[0]=()=>{this.modalImportar=!0})},{default:t(()=>[e(w,{avatar:""},{default:t(()=>[e(T,{name:"publish",size:"sm"})]),_:1}),e(w,null,{default:t(()=>[f("Importar")]),_:1})]),_:1})):_("",!0),a.permissaoFicha?(p(),g(A,{key:1,clickable:"",onClick:o[1]||(o[1]=()=>{this.exportarXLSX_click()}),class:"hideondesktop"},{default:t(()=>[e(w,{avatar:""},{default:t(()=>[e(T,{name:"mdi-download",size:"sm"})]),_:1}),e(w,null,{default:t(()=>[f("Exportar")]),_:1})]),_:1})):_("",!0),a.permissaoFicha&&a.sistemaPai==="optisoul"&&a.permissaoImportarImagensEAN?(p(),g(A,{key:2,onClick:r.importarDados_click,clickable:""},{default:t(()=>[e(w,{avatar:""},{default:t(()=>[e(T,{name:"mdi-image"})]),_:1}),e(w,null,{default:t(()=>[f("Importar Produtos/Imagens")]),_:1})]),_:1},8,["onClick"])):_("",!0),e(A,{onClick:o[2]||(o[2]=i=>l.$imprimir("catalogo-pdf")),clickable:""},{default:t(()=>[e(w,{avatar:""},{default:t(()=>[e(T,{name:"print",size:"sm"})]),_:1}),e(w,null,{default:t(()=>[f("Cat\xE1logo PDF")]),_:1})]),_:1}),a.permissaoFicha?(p(),g(A,{key:3,onClick:o[3]||(o[3]=()=>{this.modalCombinarItens=!0}),clickable:""},{default:t(()=>[e(w,{avatar:""},{default:t(()=>[e(T,{name:"compare_arrows",size:"sm"})]),_:1}),e(w,null,{default:t(()=>[f("Combinar")]),_:1})]),_:1})):_("",!0),a.permissaoFicha?(p(),g(A,{key:4,onClick:o[4]||(o[4]=i=>r.editarMarca_click()),clickable:""},{default:t(()=>[e(w,{avatar:""},{default:t(()=>[e(T,{name:"edit",size:"sm"})]),_:1}),e(w,null,{default:t(()=>[f("Marca, Grupo, Subgrupo, UN e NCM")]),_:1})]),_:1})):_("",!0),a.permissaoCatalogoVirtual?(p(),g(A,{key:5,onClick:o[5]||(o[5]=i=>r.toggleCatalogoVirtual("on")),clickable:""},{default:t(()=>[e(w,{avatar:""},{default:t(()=>[e(T,{name:"toggle_on",size:"sm"})]),_:1}),e(w,null,{default:t(()=>[f("Habilitar itens para o cat\xE1logo virtual")]),_:1})]),_:1})):_("",!0),a.permissaoCatalogoVirtual?(p(),g(A,{key:6,onClick:o[6]||(o[6]=i=>r.toggleCatalogoVirtual("off")),clickable:""},{default:t(()=>[e(w,{avatar:""},{default:t(()=>[e(T,{name:"toggle_off",size:"sm"})]),_:1}),e(w,null,{default:t(()=>[f("Desabilitar itens para o cat\xE1logo virtual")]),_:1})]),_:1})):_("",!0),a.mostrarOpcaoSincronizarECommerce?(p(),g(A,{key:7,onClick:o[7]||(o[7]=i=>r.sincronizarECommercePorModal_click()),clickable:""},{default:t(()=>[e(w,{avatar:""},{default:t(()=>[e(T,{name:"shopping_cart",size:"sm"})]),_:1}),e(w,null,{default:t(()=>[f("e-Commerce")]),_:1})]),_:1})):_("",!0),l.$db.usuario.desenvolvedor()?D((p(),g(A,{key:8,clickable:"",onClick:o[8]||(o[8]=i=>r.mostrarJsonViewer())},{default:t(()=>[e(w,{avatar:""},{default:t(()=>[e(T,{name:"mdi-file-replace",size:"sm"})]),_:1}),e(w,null,{default:t(()=>[f("Ver Objeto")]),_:1})]),_:1})),[[R]]):_("",!0),(p(),g(A,{key:9,onClick:o[9]||(o[9]=i=>r.adicionarItensEtiquetas()),clickable:""},{default:t(()=>[e(w,{avatar:""},{default:t(()=>[e(T,{name:"mdi-barcode",size:"sm"})]),_:1}),e(w,null,{default:t(()=>[f("Imprimir Etiquetas")]),_:1})]),_:1}))]),filtroCampos:t(()=>[e(u,{modelValue:a.filtros.descricaoAplicacao,"onUpdate:modelValue":o[10]||(o[10]=i=>a.filtros.descricaoAplicacao=i),rotulo:"Descri\xE7\xE3o/Aplica\xE7\xE3o",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),e(u,{modelValue:a.filtros.codigoItem,"onUpdate:modelValue":o[11]||(o[11]=i=>a.filtros.codigoItem=i),rotulo:"C\xF3digo",prefix:"#",tipo:"decimal",decimals:"0",zerosDireita:"0",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),e(u,{modelValue:a.filtros.referencia,"onUpdate:modelValue":o[12]||(o[12]=i=>a.filtros.referencia=i),rotulo:"Refer\xEAncia",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),e(u,{modelValue:a.filtros.codigoBarras,"onUpdate:modelValue":o[13]||(o[13]=i=>a.filtros.codigoBarras=i),rotulo:"C\xF3d. Barras",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),e(d,{modelValue:a.filtros.marca,"onUpdate:modelValue":o[14]||(o[14]=i=>a.filtros.marca=i),tabela:"item",campo:"marca",label:"Marca",buscarSemCaractere:!0,dense:""},null,8,["modelValue"]),e(u,{modelValue:a.filtros.fornecedores,"onUpdate:modelValue":o[15]||(o[15]=i=>a.filtros.fornecedores=i),rotulo:"Fornecedor",after:[{icon:"search",handler:r.filtroFornecedor_click}],dense:"",class:"q-field--with-bottom"},null,8,["modelValue","after"]),e(d,{modelValue:a.filtros.grupo,"onUpdate:modelValue":o[16]||(o[16]=i=>a.filtros.grupo=i),tabela:"item",campo:"grupo",label:"Grupo",buscarSemCaractere:!0,dense:""},null,8,["modelValue"]),e(d,{modelValue:a.filtros.subGrupo,"onUpdate:modelValue":o[17]||(o[17]=i=>a.filtros.subGrupo=i),tabela:"item",campo:"subGrupo",label:"Subgrupo",buscarSemCaractere:!0,dense:""},null,8,["modelValue"]),e(u,{modelValue:a.filtros.status,"onUpdate:modelValue":o[18]||(o[18]=i=>a.filtros.status=i),rotuloFixo:"Status",tipo:"seletor",opcoes:r.opcoesStatus,dense:"",class:"q-field--with-bottom"},null,8,["modelValue","opcoes"]),e(u,{modelValue:a.filtros.estoque,"onUpdate:modelValue":o[19]||(o[19]=i=>a.filtros.estoque=i),rotulo:"Estoque",prefix:">",tipo:"decimal",decimals:"4",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),e(u,{modelValue:a.filtros.tipo,"onUpdate:modelValue":o[20]||(o[20]=i=>a.filtros.tipo=i),rotuloFixo:"Tipo",tipo:"seletor",opcoes:a.opcoesTipo,filter:"",onClick:r.leOpcoesTipo,dense:"",class:"q-field--with-bottom"},null,8,["modelValue","opcoes","onClick"]),e(u,{modelValue:a.filtros.codigoCompra,"onUpdate:modelValue":o[21]||(o[21]=i=>a.filtros.codigoCompra=i),rotulo:"Compra C\xF3d.",prefix:"#",tipo:"decimal",decimals:"0",zerosDireita:"0",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),e(u,{modelValue:a.paginacao.limite,"onUpdate:modelValue":o[22]||(o[22]=i=>a.paginacao.limite=i),min:"1",rotulo:"Quantidade por p\xE1gina",tipo:"quantidade",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),a.permissaoCatalogoVirtual?D((p(),g(A,{key:0,tag:"label",class:"q-pa-none q-mt-lg"},{default:t(()=>[e(w,{avatar:""},{default:t(()=>[e(Ve,{modelValue:a.filtros.catalogoVirtualChecked,"onUpdate:modelValue":o[23]||(o[23]=i=>a.filtros.catalogoVirtualChecked=i)},null,8,["modelValue"])]),_:1}),e(w,null,{default:t(()=>[e(J,null,{default:t(()=>[f("Cat\xE1logo Virtual")]),_:1}),e(J,{caption:""},{default:t(()=>[f("Exibir apenas produtos habilitados")]),_:1})]),_:1})]),_:1})),[[Ue]]):_("",!0)]),itemLista:t(()=>[e(ne,{bordered:"",class:"bg-white q-mb-xs rounded-borders"},{default:t(()=>[(p(!0),I(P,null,O(a.lista,i=>(p(),I("div",{key:i.id,class:"itemHover"},[e(A,{"manual-focus":"",class:"q-py-sm q-px-xs items-center"},{default:t(()=>[e(w,{class:"hideonmobile col-auto q-pr-sm no-margin"},{default:t(()=>[e(A,{class:"q-pa-none"},{default:t(()=>[e(w,{side:"",class:"col-auto q-pa-none"},{default:t(()=>[e(Ve,{modelValue:a.listaLayout[i.id].remover,"onUpdate:modelValue":h=>a.listaLayout[i.id].remover=h},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a.permissaoCatalogoVirtual?D((p(),g(w,{key:0,side:"",class:"col-auto q-pa-none"},{default:t(()=>[e(he,{modelValue:a.catalogoVirtualChecked[i.id],"onUpdate:modelValue":[h=>a.catalogoVirtualChecked[i.id]=h,r.salvarCatalogoVirtual]},null,8,["modelValue","onUpdate:modelValue"]),a.catalogoVirtualChecked[i.id]?_("",!0):(p(),g(B,{key:0,anchor:"bottom middle",self:"center middle"},{default:t(()=>[f(" Habilitar no cat\xE1logo virtual ")]),_:1})),a.catalogoVirtualChecked[i.id]?(p(),g(B,{key:1,anchor:"bottom middle",self:"center middle"},{default:t(()=>[f(" Desabilitar no cat\xE1logo virtual ")]),_:1})):_("",!0)]),_:2},1024)),[[Ue]]):_("",!0),e(w,{side:"",class:"col-auto q-pa-none"},{default:t(()=>[C("div",_t,[e(c,{cor:i.ativo?"positive":"tertiary",escuro:""},{default:t(()=>[f(" #"+E((i.codigoItem||0).toString().padStart(4,"0")),1)]),_:2},1032,["cor"])])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(w,{class:"col-xs col-sm-3 col-md-4 col-lg col-xl no-margin"},{default:t(()=>[e(A,{class:"q-pa-none"},{default:t(()=>[e(w,{onClick:h=>r.abrirItem(i.id),class:"col-auto items-center"},{default:t(()=>[e(b,{imagem:i.imagem,rotulo:i.descricaoConcatenada,tamanho:"40",style:{display:"flex","align-self":"center"}},null,8,["imagem","rotulo"]),e(Ve,{modelValue:a.listaLayout[i.id].remover,"onUpdate:modelValue":h=>a.listaLayout[i.id].remover=h,class:"hideondesktop q-mt-md"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["onClick"]),e(w,{onClick:h=>r.abrirItem(i.id),class:"col"},{default:t(()=>[e(J,{lines:"2",class:"text-tertiary text-weight-bold ellipsis-2-lines"},{default:t(()=>[f(E(i.descricaoConcatenada)+" ",1),e(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[f("Descri\xE7\xE3o")]),_:1})]),_:2},1024),i.marca?(p(),g(J,{key:0,caption:"",lines:"1",class:"text-tertiary ellipsis"},{default:t(()=>[f(E(i.marca)+" ",1),e(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[f("Marca")]),_:1})]),_:2},1024)):_("",!0),e(w,{class:"hideondesktop q-mt-sm"},{default:t(()=>[C("div",null,[e(c,{cor:i.ativo?"positive":"tertiary",escuro:"",class:"q-mr-xs"},{default:t(()=>[f(" #"+E((i.codigoItem||0).toString().padStart(4,"0")),1)]),_:2},1032,["cor"]),i.referencia?(p(),g(c,{key:0,cor:"tertiary",escuro:"",class:"q-mr-xs"},{default:t(()=>[f(E(i.referencia),1)]),_:2},1024)):_("",!0),e(c,{cor:"primary",escuro:""},{default:t(()=>[f(E(i.tipo),1)]),_:2},1024),e(J,{class:"text-tertiary text-weight-bold q-mt-sm"},{default:t(()=>[f(E(l.$filters.numeroZerosDireita(i.valorVenda,4,2)),1)]),_:2},1024)])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),e(w,{onClick:h=>r.abrirItem(i.id),class:"hideonmobile maxw180 q-pl-sm no-margin"},{default:t(()=>[i.referencia?(p(),g(_e,{key:0,color:"tertiary","text-color":"white","multi-line":"",class:"col-auto q-mx-auto q-py-xs"},{default:t(()=>[f(E(i.referencia)+" ",1),e(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[f("Refer\xEAncia")]),_:1})]),_:2},1024)):_("",!0)]),_:2},1032,["onClick"]),e(w,{onClick:h=>r.abrirItem(i.id),class:"hideonmobile maxw180 q-pl-sm no-margin"},{default:t(()=>[i.grupo?(p(),g(J,{key:0,lines:"1",color:"tertiary",class:"ellipsis"},{default:t(()=>[f(E(i.grupo)+" ",1),e(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[f("Grupo")]),_:1})]),_:2},1024)):_("",!0),i.grupo?(p(),g(J,{key:1,caption:"",lines:"1",color:"tertiary",class:"ellipsis"},{default:t(()=>[f(E(i.subGrupo)+" ",1),e(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[f("Subgrupo")]),_:1})]),_:2},1024)):_("",!0)]),_:2},1032,["onClick"]),e(w,{onClick:h=>r.abrirItem(i.id),class:"hideonmobile maxw180 q-pl-sm no-margin"},{default:t(()=>[e(_e,{color:"primary","multi-line":"",class:"col-auto q-mx-auto q-py-xs"},{default:t(()=>[f(E(i.tipo)+" ",1),e(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[f("Tipo do produto")]),_:1})]),_:2},1024)]),_:2},1032,["onClick"]),e(w,{onClick:h=>r.abrirItem(i.id),class:"hideonmobile maxw120 q-pl-sm no-margin"},{default:t(()=>[e(J,{class:"text-tertiary text-weight-bold text-right"},{default:t(()=>[f(E(l.$filters.numeroZerosDireita(i.valorVenda,4,2))+" ",1),e(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[f("Valor de venda")]),_:1})]),_:2},1024)]),_:2},1032,["onClick"]),e(w,{class:"col-auto q-pl-sm no-margin"},{default:t(()=>[e(A,{class:"q-pa-none"},{default:t(()=>[e(w,{class:"hideonmobile q-pr-sm no-margin"},{default:t(()=>[e(S,{onClick:h=>r.abrirDetalhesItem(i),icon:a.listaLayout[i.id].detalhes?"keyboard_arrow_up":"keyboard_arrow_down",size:"md",color:"tertiary",round:"",flat:"",dense:""},null,8,["onClick","icon"])]),_:2},1024),e(w,{class:"hideonmobile q-pr-sm no-margin"},{default:t(()=>[a.permissaoFicha||a.permissaoEstoque?(p(),g(S,{key:0,onClick:h=>r.abrirItem(i.id),icon:"edit",size:"md",color:"primary",round:"",flat:"",dense:""},null,8,["onClick"])):_("",!0)]),_:2},1024),e(w,{class:"no-margin"},{default:t(()=>[e(S,{icon:"more_vert",size:"md",round:"",flat:"",dense:""},{default:t(()=>[e(we,null,{default:t(()=>[D((p(),g(ne,{link:"","no-border":"",separator:""},{default:t(()=>[a.permissaoFicha||a.permissaoEstoque?(p(),g(A,{key:0,onClick:h=>r.abrirItem(i.id),clickable:"",class:"hideondesktop"},{default:t(()=>[e(w,{avatar:""},{default:t(()=>[e(T,{name:"edit"})]),_:1}),e(w,null,{default:t(()=>[f(" Editar ")]),_:1})]),_:2},1032,["onClick"])):_("",!0),e(A,{onClick:h=>r.abrirDetalhesItem(i),clickable:"",class:"hideondesktop"},{default:t(()=>[e(w,{avatar:""},{default:t(()=>[e(T,{name:a.listaLayout[i.id].detalhes?"keyboard_arrow_up":"keyboard_arrow_down"},null,8,["name"])]),_:2},1024),e(w,null,{default:t(()=>[f(" Detalhes ")]),_:1})]),_:2},1032,["onClick"]),i.ativo&&a.permissaoFicha?(p(),g(A,{key:1,onClick:h=>r.removerItem(i),clickable:""},{default:t(()=>[e(w,{avatar:""},{default:t(()=>[e(T,{name:"delete"})]),_:1}),e(w,null,{default:t(()=>[f(" Remover ")]),_:1})]),_:2},1032,["onClick"])):_("",!0),!i.ativo&&a.permissaoFicha?(p(),g(A,{key:2,onClick:h=>r.restaurarItem(i),clickable:""},{default:t(()=>[e(w,{avatar:""},{default:t(()=>[e(T,{name:"restore_from_trash"})]),_:1}),e(w,null,{default:t(()=>[f(" Restaurar ")]),_:1})]),_:2},1032,["onClick"])):_("",!0),a.permissaoFicha?(p(),g(A,{key:3,onClick:h=>r.duplicarItem(i),clickable:""},{default:t(()=>[e(w,{avatar:""},{default:t(()=>[e(T,{name:"control_point_duplicate"})]),_:1}),e(w,null,{default:t(()=>[f(" Duplicar Produto/Servi\xE7o ")]),_:1})]),_:2},1032,["onClick"])):_("",!0)]),_:2},1024)),[[R]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a.listaLayout[i.id].detalhes?(p(),I("div",qt,[e(L,{class:"q-mx-xl q-mb-sm"}),C("div",wt,[C("div",xt,[C("div",St,[C("div",It,[e(T,{name:"business",size:"xs",class:"q-mr-xs"}),f("Fornecedor: "),(p(!0),I(P,null,O(a.listaLayout[i.id].fornecedor,h=>(p(),I("div",{key:h.idContato,class:"q-mt-xs"},E(h.contato.nome),1))),128))]),C("div",kt,[C("div",null,[f(" Estoque: "),C("strong",null,E(i.quantidadeDisponivel),1),e(c,{cor:"tertiary",escuro:"",class:"q-ml-sm"},{default:t(()=>[f(E(i.unidade),1)]),_:2},1024)]),C("div",Et,[e(T,{name:"mdi-barcode",size:"sm",color:"tertiary",class:"q-mr-xs"}),f(" "+E(i.codigoBarras),1)]),C("div",null,[C("span",Ut,E(i.address),1)])])])]),C("div",Pt,[a.permissaoFicha?(p(),I("div",Mt,[C("div",Dt,[e(he,{modelValue:a.listaLayout[i.id].utilizaComposicaoValorReposicaoInvertido,"onUpdate:modelValue":[h=>a.listaLayout[i.id].utilizaComposicaoValorReposicaoInvertido=h,h=>r.atualizarCustoReposicao(i)],"checked-icon":"check","unchecked-icon":"clear",size:"sm"},null,8,["modelValue","onUpdate:modelValue"])]),C("div",Ft,[e(u,{class:"full-width no-shadow",dense:"",rotulo:"Custo de reposi\xE7\xE3o",tipo:"decimal",decimals:"2",modelValue:i.valorCustoReposicao,"onUpdate:modelValue":h=>i.valorCustoReposicao=h,onBlur:h=>r.atualizarValorVendaLucro(i),ajuda:a.listaLayout[i.id].utilizaComposicaoValorReposicaoInvertido?"":"Total da composi\xE7\xE3o",disable:!a.listaLayout[i.id].utilizaComposicaoValorReposicaoInvertido,readonly:!a.listaLayout[i.id].utilizaComposicaoValorReposicaoInvertido},null,8,["modelValue","onUpdate:modelValue","onBlur","ajuda","disable","readonly"])]),C("div",At,[e(u,{class:"full-width no-shadow q-field--with-bottom",dense:"",rotulo:"Lucro %",tipo:"decimal",decimals:"2",modelValue:i.percentualMarkup,"onUpdate:modelValue":h=>i.percentualMarkup=h,onBlur:h=>r.atualizarValorVendaLucro(i),disable:a.listaLayout[i.id].utilizaMarkupInvertido,readonly:a.listaLayout[i.id].utilizaMarkupInvertido},null,8,["modelValue","onUpdate:modelValue","onBlur","disable","readonly"])]),C("div",zt,[e(he,{modelValue:a.listaLayout[i.id].utilizaMarkupInvertido,"onUpdate:modelValue":h=>a.listaLayout[i.id].utilizaMarkupInvertido=h,"checked-icon":"check","unchecked-icon":"clear",size:"sm"},null,8,["modelValue","onUpdate:modelValue"])]),C("div",Tt,[e(u,{class:"full-width no-shadow q-field--with-bottom",dense:"",rotulo:"Valor de venda",tipo:"decimal",decimals:"4",zerosDireita:"2",modelValue:i.valorVenda,"onUpdate:modelValue":h=>i.valorVenda=h,onBlur:h=>r.atualizarValorVendaLucro(i),disable:!a.listaLayout[i.id].utilizaMarkupInvertido,readonly:!a.listaLayout[i.id].utilizaMarkupInvertido},null,8,["modelValue","onUpdate:modelValue","onBlur","disable","readonly"])]),C("div",jt,[e(S,{onClick:h=>r.salvarItem(i),color:"primary",label:"Salvar",size:"md",unelevated:"",class:"full-width no-shadow"},null,8,["onClick"])])])):_("",!0)])])])):_("",!0),e(L)]))),128))]),_:1})]),_:1},8,["buscaCampo","checkboxModel","onFiltro_change","onCriar_click","onCheckBoxGeral_click","onLimparFiltros_click","onAbrirTodosPreview","onExportarXLSX_click","onRemoverTodos","onRestaurarTodos","lista","listaLayout","paginacao","filtros","tabSelecionada","tabs","permissaoNovo","removerTodosVisible","opcoesMarca","opcoesGrupo","opcoesSubGrupo","opcoesTipo","opcoesStatus"]),e(V,{ref:"modalFicha",onAtualizar:r.atualizar},null,8,["onAtualizar"]),e(U,{ref:"modalEditarMarca"},null,512),e(x,{modelValue:a.modalImportar,"onUpdate:modelValue":o[26]||(o[26]=i=>a.modalImportar=i)},null,8,["modelValue"]),e(y,{modelValue:a.modalCombinarItens,"onUpdate:modelValue":o[27]||(o[27]=i=>a.modalCombinarItens=i)},null,8,["modelValue"]),e(M,{ref:"modalItemCriar"},null,512),e(j,{ref:"modalSincronizarECommerce"},null,512),e(F,{label:"Gostaria de importar essas informa\xE7\xF5es nos produtos da lista?",onOpcaoSelecionada:r.importarDadosReferencia,ref:"modalImportarDados"},null,8,["onOpcaoSelecionada"]),e(N,{ref:"jsonViewer"},null,512),e(H,{modelValue:a.dialogoImprimirEtiquetas.visivel,"onUpdate:modelValue":o[32]||(o[32]=i=>a.dialogoImprimirEtiquetas.visivel=i),"content-css":{minWidth:"50vw"}},{default:t(()=>[e(X,null,{default:t(()=>[e(W,{class:"bg-primary text-white"},{default:t(()=>[e(Y,null,{default:t(()=>[f("Imprimir Etiquetas")]),_:1}),D(e(S,{dense:"",flat:"",icon:"close",round:""},null,512),[[R]])]),_:1}),e(re,null,{default:t(()=>[e(Q,{onSubmit:r.imprimirEtiquetas},{default:t(()=>[e(te,{class:"q-col-gutter-md"},{default:t(()=>[C("div",Ot,[e(fe,{modelValue:a.modeloImpressaoSelecionada,"onUpdate:modelValue":o[28]||(o[28]=i=>a.modeloImpressaoSelecionada=i),label:"Modelo",options:a.opcoesModeloImpressao,"option-value":"id","option-label":"label","emit-value":"","map-options":""},null,8,["modelValue","options"])]),C("div",Rt,[e(u,{tipo:"quantidade",modelValue:a.mainPular,"onUpdate:modelValue":o[29]||(o[29]=i=>a.mainPular=i),min:0,rotulo:"Pular",color:"tertiary"},null,8,["modelValue"])])]),_:1}),e(te,null,{default:t(()=>[C("div",Nt,[e(fe,{modelValue:a.empresaSelecionada,"onUpdate:modelValue":o[30]||(o[30]=i=>a.empresaSelecionada=i),label:"Empresa",options:a.dialogoImprimirEtiquetas.listaEmpresas,"option-value":"id","option-label":"label","emit-value":"","map-options":""},null,8,["modelValue","options"])]),C("div",Lt,[e(fe,{modelValue:a.tabelaPreco,"onUpdate:modelValue":o[31]||(o[31]=i=>a.tabelaPreco=i),label:"Tabela de Pre\xE7os",options:a.opcoesTabelasPreco,"option-value":"id","option-label":"label","emit-value":"","map-options":""},null,8,["modelValue","options"])])]),_:1}),C("div",Bt,[D(e(S,{color:"tertiary",flat:"",label:"Cancelar"},null,512),[[R]]),e(S,{color:"primary",class:"q-ml-sm no-shadow",unelevated:"",label:"Imprimir Etiquetas",type:"submit"})])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var Kt=G(yt,[["render",Gt],["__scopeId","data-v-2bc668e4"]]),rl=Object.freeze(Object.defineProperty({__proto__:null,default:Kt},Symbol.toStringTag,{value:"Module"}));export{rl as I,Kt as a,Ct as b,at as c,Xa as i};
