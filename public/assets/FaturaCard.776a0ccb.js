import{_ as X,M as Y,Y as V,cM as M,cj as U,Z as Q,aX as Z,cN as W,b3 as $,p as S,o as n,i as c,w as e,f as a,x as B,B as O,E as j,ah as m,e as s,t as d,bc as T,C as D,b5 as aa,j as _,l as b,k as A,am as N,ai as x,d as C,F as E,r as w,aj as v,ak as r,D as P,aF as R,L as H,aB as ea,y as oa,s as L,aK as G,V as ta,aE as J,U as ia,cO as la,cx as ra}from"./index.303e4e1e.js";import{Q as sa}from"./QSpinnerHourglass.ed2912f7.js";import{Q as na}from"./QSpinnerDots.48d2ebc0.js";import{D as da}from"./DocumentosFiscais.31225bb5.js";import{e as ua}from"./emitirNFe.3ad8673b.js";import{F as ca}from"./FaturaModal.de1f8a62.js";import{M as ma}from"./ModalHistoricoStatus.c788c2e3.js";const fa={components:{Avatar:Y,DocumentosFiscais:da,FaturaModal:ca,ModalHistoricoStatus:ma},computed:{config(){return V.configuracoes.valores},mostrarOpcaoEmitirBoleto(){return(this.modalBoleto.condicoesPagamento||[]).length&&(this.modalBoleto.bancos||[]).length},mostrarOpcaoRemoverFatura(){return this.dados.fatura.status==="Aberta"&&!this.dados.carnes.length&&!this.dados.condicaoPagamento.length&&!this.dados.vendas.length},ativarBotaoEmissaoBoleto(){const i=Number(this.modalBoleto.financeiroBanco.value);return Number.isInteger(i)&&i&&this.modalBoleto.condicoesPagamento.find(l=>l.checked)}},data(){return{dbUsuario:V.usuario,dados:{fatura:{}},contatos:{},detalhesVisivel:!1,sistemaPai:"",configImpressaoCarne:[],configImpressaoConvenio:[],configImpressaoFatura:[],configImpressaoEnvelope:[],modalBoleto:{},podeEditar:!1,mostrarBotaoEnviarAvaliacao:!1,mostrarBotaoEnviarPedidosProtheus:!1,mostrarBotaoEmitirCupom:!1}},emits:["executar"],methods:{async enviarPedidosProtheus(i){await $db.fatura.enviarPedidosProtheus(i)},async removerFatura(){try{await new Promise((i,l)=>{this.$q.dialog({message:"Esta a\xE7\xE3o ir\xE1 remover esta fatura.",noRefocus:!0,preventClose:!0,title:"Tem certeza?",cancel:{label:"CANCELAR",push:!0,color:"tertiary",flat:!0},ok:{label:"CONTINUAR",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(()=>{i()}).onCancel(()=>{l()})})}catch{return}this.dados.fatura.id?(await V.fatura.remover(this.dados.fatura.id),this.$emit("executar","atualizar")):this.$q.notify("N\xE3o foi poss\xEDvel realizar a opera\xE7\xE3o")},async abrirModalBoleto(){const l=(await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{idDocumento:this.dados.fatura.id}})).find(h=>h.situacao==="Emitido");for(const h of this.modalBoleto.condicoesPagamento)h.checked=!1,h.disable=!0,h.codigoFinanceiroBoleto="",h.codigoFinanceiroTitulo="",h.banco={};this.modalBoleto.docFiscal=l,this.modalBoleto.checked=!1,this.modalBoleto.financeiroBanco=this.modalBoleto.bancos[0],this.modalBoleto.ativo=!0,this.$nextTick().then(()=>{this.modalBoleto.visivel=!0,this.atualizarBoletos()})},alternarCheckboxModalBoleto(i){if(i==="todos"){this.modalBoleto.condicoesPagamento.forEach(l=>{l.checked=this.modalBoleto.checked});return}this.modalBoleto.checked=!this.modalBoleto.condicoesPagamento.find(l=>!l.checked)},async atualizarBoletos(){let i,l,h,f;f=this.modalBoleto.condicoesPagamento,h=f.reduce((u,y)=>u+"'"+y.idFinanceiroTitulo+"',",""),h=h.slice(0,h.length-1),i=`select
          fTitulo.id,
          fTitulo.codigoFinanceiroTitulo,
          fBoleto.codigoFinanceiroBoleto,
          fBoleto.dataEmissao,
          b.descricao,
          fBanco.agencia,
          fBanco.conta,
          b.arquivoBoleto
        from financeiroTitulo fTitulo
        left join financeiroBoleto fBoleto on fBoleto.codigoFinanceiroBoleto = fTitulo.codigoFinanceiroBoleto
        left join financeiroBanco fBanco on fBanco.CodigoFinanceiroBanco = fBoleto.codigoFinanceiroBanco
        left join _banco b on b.codigoBanco = fBanco.codigoBanco
        where fTitulo.id in (${h})`,this.cancelarAtualizarBoletos=!1;let o=0;do{try{l=await M(i),o=0}catch(u){l=[],++o%3===0&&this.$q.notifyError(u.message)}for(const u of l){const y=f.find(g=>g.idFinanceiroTitulo===u.id);y&&(u.codigoFinanceiroBoleto&&(y.codigoFinanceiroBoleto=u.codigoFinanceiroBoleto,y.banco={descricao:u.descricao,dataEmissao:u.dataEmissao,agencia:u.agencia,conta:u.conta,arquivoBoleto:u.arquivoBoleto}),u.codigoFinanceiroTitulo&&(y.codigoFinanceiroTitulo=u.codigoFinanceiroTitulo,y.disable=!1))}if(l.length===f.length||this.cancelarAtualizarBoletos)break;await U(5e3)}while(1)},async atualizarModalBoleto(){this.modalBoleto={ativo:!1,visivel:!1,loading:!1,codigoFinanceiroBanco:"",condicoesPagamento:[],bancos:[]};const i=[],l=await Q().formaPagamento.toArray(),h=await Q().empresa.where({idContato:this.dados.fatura.idEmpresa}).toArray();if(await(await $db.hibrido.lista({table:"documentoCondicaoPagamento",where:{idDocumento:this.dados.fatura.id}})).forEach(p=>{const F=l.find(q=>q.id===p.idFormaPagamento&&q.tipo===99&&q.tipoFinanceiro==="T\xEDtulo em aberto");F&&i.push({dataVencimento:p.dataVencimento,descricao:F.descricao,idFinanceiroTitulo:p.idFinanceiroTitulo,codigoFinanceiroBoleto:"",checked:!1,disable:!0,valor:p.valor})}),!i.length)return;const o=[];await Q().financeiroBanco.each(p=>{if(!!p.ativo){if(p.id==="7D07229E-B35E-42AA-A312-78313BE61B2F"){o.push(p);return}p.idEmpresa&&h.find(F=>F.id===p.idEmpresa)&&o.push(p)}});const u=[...new Set(o.map(p=>p.codigoBanco))],y=[];await Q()._banco.each(p=>{u.find(F=>F===p.codigoBanco)&&y.push(p)}),this.modalBoleto.condicoesPagamento=Z.exports.orderBy(i,"dataVencimento","asc");const g=[];for(const p of o){const F=y.find(z=>z.codigoBanco===p.codigoBanco)||{};if(!F)continue;const q=(F.descricao||"").trim(),t=(p.agencia||"").trim(),k=(p.conta||"").trim();if(!F.arquivoBoleto||!q||!t||!k)continue;let I=q+" - Ag. "+t+" C/C "+k;g.push({arquivoBoleto:F.arquivoBoleto,label:I,value:p.codigoFinanceiroBanco})}g.length&&(this.modalBoleto.financeiroBanco=g[0],this.modalBoleto.bancos=g)},fecharModalBoleto(){this.cancelarAtualizarBoletos=!0,this.cancelarEmitirBoletos=!0,this.modalBoleto.visivel=!1,this.$nextTick().then(()=>{this.modalBoleto.avito=!1})},async emitirImprimirBoleto(){var y;this.modalBoleto.loading=!0;let i,l,h,f={},o=[];h=this.modalBoleto.condicoesPagamento.filter(g=>g.checked);for(const g of h){if(g.codigoFinanceiroBoleto&&(g.banco||{}).arquivoBoleto){if(!f[g.banco.arquivoBoleto]){f[g.banco.arquivoBoleto]=[g.codigoFinanceiroBoleto];continue}f[g.banco.arquivoBoleto].push(g.codigoFinanceiroBoleto);continue}o.push(g.codigoFinanceiroTitulo)}if(o.length&&((y=this.modalBoleto.financeiroBanco)==null?void 0:y.value)){let g,p,F,q=0,t=0,k,I="";if(this.cancelarEmitirBoletos=!1,this.modalBoleto.docFiscal&&(I=`${this.modalBoleto.docFiscal.nNF} / S\xE9rie ${this.modalBoleto.docFiscal.serie} | `),k=(this.modalBoleto.bancos.find(z=>z.value===this.modalBoleto.financeiroBanco.value)||{}).arquivoBoleto,!k){this.$q.notifyError("Arquivo boleto n\xE3o encontrado");return}i=`sp_financeiro_boletoEmitir ${this.modalBoleto.financeiroBanco.value}, '${o.join(",")}', '${I}'`;do{if(this.cancelarEmitirBoletos)break;try{l=await M(i),q=0}catch(z){l=[],++q%3===0&&this.$q.notifyError(z.message)}if(g=(l||[])[0],p=((g||{}).Msg||"").trim(),F=((g||{}).Retorno||"").trim(),p==="Boleto Gerado com sucesso!"&&F){const z=F.substring(0,F.length-1).split(",");if(!f[k]){f[k]=z;break}for(const K of z)f[k].push(K);break}else++t%3===0&&this.$q.notifyError(p);await U(5e3)}while(1)}let u=JSON.parse(localStorage.getItem("clienteSistema"))||{};for(const g in f){let p;p="https://rel.storage.b15.com.br/Relatorios/"+g+".html?",p+="CodigoFinanceiroBoleto="+f[g].join(","),p+="&Banco="+u.bancoDeDados,p+="&URLServidor="+u.urlServidor,window.open(p)}await this.atualizarBoletos(),this.modalBoleto.loading=!1},alternarDetalhes(){this.detalhesVisivel=!this.detalhesVisivel},async atualizar(){const i=await V.fatura.leCompleto(this.id);i.vendas.sort((f,o)=>new Date(f.dataHoraFinalizado)<new Date(o.dataHoraFinalizado)?-1:1),i.carnes.sort((f,o)=>new Date(f.dataVencimento)<new Date(o.dataVencimento)?-1:1);const l=await i.vendas.reduce(async(f,o)=>(f[o.idContatoVendedor]||(f[o.idContatoVendedor]=await V.contato.le({id:o.idContatoVendedor})),f),{});if(i.fatura.idContato){const f=i.fatura.idContato;l[f]||(l[f]=await V.contato.le({id:f}))}this.configuraImpressaoCarne(i.fatura.idEmpresa),this.configuraImpressaoConvenio(i.fatura.idEmpresa),this.configuraImpressaoEnvelope(i.fatura.idEmpresa),this.configuraImpressaoFatura(i.fatura.idEmpresa),this.contatos=l,this.dados=i,this.atualizarModalBoleto(),this.condicaoPagamento=i.condicaoPagamento,this.resumeCondicaoPagamento();const h=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;this.podeEditar=!1,h.find(f=>f.id===i.fatura.idEmpresa)&&(this.podeEditar=!0),await this.configuraVisibilidadeBotoes(),this.$nextTick(()=>{i.fatura.id===localStorage.getItem("idFatura")&&(this.podeEditar&&this.$refs.faturaModal.mostrar({id:this.dados.fatura.id}),localStorage.removeItem("idFatura"))})},copiarUid(){const i=this.$refs.uid;i.type="text";try{i.select(),document.execCommand("copy"),this.$q.notify({message:"UID copiado para a \xE1rea de transfer\xEAncia.",type:"info"})}catch{this.$q.notify("Erro ao copiar.")}i.type="hidden",window.getSelection().removeAllRanges()},async configuraImpressaoConvenio(i){const l=await V.configuracoes.porNome("impressao.convenio",i);this.configImpressaoConvenio=[...l.length?l.map(h=>({texto:"Imprimir Conv\xEAnio",...h})):[{valor:"convenio",texto:"Imprimir Conv\xEAnio"}]]},async configuraImpressaoCarne(i){const l=await V.configuracoes.porNome("impressao.carne",i);this.configImpressaoCarne=[...l.length?l.map(h=>({texto:"Imprimir Carn\xEA",...h})):[{valor:"carne-crediario",texto:"Reimprimir carn\xEA e notas promiss\xF3rias da fatura"}]]},async configuraImpressaoEnvelope(i){const l=await V.configuracoes.porNome("impressao.envelope",i);this.configImpressaoEnvelope=[...l.length?l.map(h=>({texto:"Imprimir Envelope",...h})):[{valor:"envelope",texto:"Imprimir Envelope"},{valor:"envelopeMini",texto:"Imprimir Envelope Mini"}]]},async configuraImpressaoFatura(i){const l=await V.configuracoes.porNome("impressao.fatura",i);this.configImpressaoFatura=[...l.length?l.map(h=>({texto:"Imprimir Fatura",...h})):[{valor:"invoice",texto:"Fatura (Invoice)"},{valor:"fatura-recibo",texto:"Recibo"},this.sistemaPai==="optisoul"?{valor:"termoGarantia",texto:"Termo de Garantia"}:{}]]},async configuraVisibilidadeBotoes(){var f,o,u,y,g;let i,l,h;i=await $db.configuracoes.leValorComFiltroEmpresa("integrador.idDispositivo",this.dados.fatura.idEmpresa),this.mostrarBotaoEmitirCupom=!!i,i=await $db.configuracoes.porNome("integracao.bten.business"),l=(o=(f=i[0])==null?void 0:f.valor)!=null?o:!1,i=await $db.configuracoes.porNome("integracao.bten.authorization"),h=(y=(u=i[0])==null?void 0:u.valor)!=null?y:!1,this.mostrarBotaoEnviarAvaliacao=l&&h,i=await $db.configuracoes.porNome("protheus.credentials"),this.mostrarBotaoEnviarPedidosProtheus=!!((g=i[0])!=null&&g.valor)&&!!this.dados.fatura.dataHoraFinalizado},editar(){this.$refs.faturaModal.mostrar({id:this.dados.fatura.id})},async executar(i){switch(i){case"atualizar":case"finalizar":case"retornarOrcamento":case"remover":this.$emit("executar","atualizar");return}await this.atualizar()},async sendReview(i){try{this.$q.loading.show();const l=[],h=this.contatos[i.idContato],f=await $api.bten.send(h,i);for(let o=0;o<f.length;o++){const u=f[o];u.status?l.push(u.telefone):this.$q.notifyError(`Falha ao enviar NPS para ${u.telefone}!`)}this.$q.loading.hide(),l.length&&this.$q.notifyPositive(`NPS enviado para ${l.join(",")}!`)}catch(l){if(l.name==="GeeksException"){this.$q.notifyAlert(l.message);return}this.$q.notifyError("N\xE3o foi possivel enviar NPS para o contato.",l)}finally{this.$q.loading.hide()}}},mixins:[W,ua],props:{id:{required:!0,type:String}},async mounted(){this.sistemaPai=$(),this.atualizar()}},ha={class:"col-12 col-md-6 q-pl-none"},pa={class:"q-item-section"},va={class:"col-3 col-md hideonmobile"},ga={class:"text-left q-my-none"},_a={class:"col-3 col-md hideonmobile"},Ba={class:"text-left q-my-none"},ba={class:"col-6 col-md hideonmobile"},ka={class:"text-right text-h5 text-positive text-weight-bold q-my-none"},ya={class:"text-right text-weight-normal text-tertiary text-body2 q-my-none"},Fa={class:"col-12 col-md-6"},Ca={class:"col-12 col-md-6 full-height items-end hideonmobile"},Ea={class:"col-6"},wa={class:"text-left q-my-none hideondesktop"},qa={class:"text-left q-my-none"},Pa={class:"col-6"},Va={class:"text-right text-weight-normal text-tertiary text-body2 q-my-none"},xa={class:"text-right text-h5 text-positive text-weight-bold q-my-none"},Ia={class:"col-12 full-height items-end"},za={class:"col-12 col-md-6"},Na={class:"text-subtitle1 text-weight-bold q-ma-none items-center"},Da={class:"col-12 col-md-4"},Sa=B("p",{class:"text-subtitle1 text-weight-bold q-ma-none"}," Faturamento ",-1),Ta={class:"q-ma-none"},Aa={class:"col-12 col-md-2 text-right"},Ha=B("p",{class:"text-subtitle1 text-weight-bold q-ma-none"}," Desconto ",-1),Qa={class:"q-ma-none"},Ra=B("span",{class:"text-weight-bold"},"Emiss\xE3o de Boleto",-1),Ma={class:"q-mt-lg text-center"};function Ua(i,l,h,f,o,u){const y=S("avatar"),g=S("row"),p=S("documentos-fiscais"),F=S("fatura-modal"),q=S("modal-historico-status");return o.dados.fatura.id?(n(),c(L,{key:0,id:"FaturaCard",class:"extratoItem bg-grey-1 q-pa-sm no-shadow"},{default:e(()=>[a(g,{class:"items-center q-mx-none q-px-none q-mb-sm"},{default:e(()=>[B("div",ha,[a(O,{class:"q-pa-none"},{default:e(()=>[a(y,{imagem:(o.contatos[o.dados.fatura.idContato]||{}).imagem,rotulo:o.dados.fatura.descricaoContato,tamanho:"40",style:{float:"left"}},null,8,["imagem","rotulo"]),a(j,null,{default:e(()=>[B("div",pa,[a(m,null,{default:e(()=>[s(d((o.contatos[o.dados.fatura.idContato]||{}).apelido),1)]),_:1}),a(m,{caption:""},{default:e(()=>[s(d((o.contatos[o.dados.fatura.idContato]||{}).nome),1)]),_:1})])]),_:1}),a(T,{rounded:"",color:"tertiary",small:"",class:"q-ma-sm"},{default:e(()=>[s(d(o.dados.fatura.status),1)]),_:1}),a(T,{class:"q-mr-sm",dark:"",color:"positive",onClick:u.copiarUid},{default:e(()=>[s(" #"+d(parseInt(o.dados.fatura.numero)||(o.dados.fatura.id||"").slice(-6))+" ",1),D(B("input",{type:"hidden","onUpdate:modelValue":l[0]||(l[0]=t=>o.dados.fatura.id=t),ref:"uid"},null,512),[[aa,o.dados.fatura.id]])]),_:1},8,["onClick"])]),_:1})]),B("div",va,[B("p",ga,[o.dados.fatura.dataHoraEmissao?(n(),c(_,{key:0,name:"mdi-calendar-today "})):b("",!0),s(" "+d(i.$filters.data(o.dados.fatura.dataHoraEmissao))+" ",1),a(A,null,{default:e(()=>[s(" Emiss\xE3o ")]),_:1})])]),B("div",_a,[B("p",Ba,[o.dados.fatura.dataHoraFinalizado?(n(),c(_,{key:0,name:"mdi-calendar-check"})):b("",!0),s(" "+d(i.$filters.data(o.dados.fatura.dataHoraFinalizado))+" ",1),a(A,null,{default:e(()=>[s(" Finalizado ")]),_:1})])]),B("div",ba,[B("p",ka,d(i.$filters.numero(o.dados.fatura.totalDocumento,2)),1),B("p",ya,d(i.$filters.numero(o.dados.fatura.subTotal,2)),1)])]),_:1}),a(N,{class:"hideondesktop q-mb-sm"}),a(g,{class:"q-mx-none q-px-none items-end"},{default:e(()=>[B("div",Fa,[a(x,{class:"no-border text-tertiary"},{default:e(()=>[(n(!0),C(E,null,w(o.dados.vendas,t=>(n(),c(v,{key:t.id,class:"items-center q-pa-none q-mb-xs",style:{"min-height":"auto"}},{default:e(()=>[a(r,{avatar:"",class:"mw80"},{default:e(()=>[a(m,null,{default:e(()=>[s(d(t.tipo)+" ",1),a(T,{dark:"",color:"tertiary",denso:"",round:""},{default:e(()=>[s("#"+d(parseInt(t.numero)||(t.id||"").slice(-6)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(r,null,{default:e(()=>[a(m,null,{default:e(()=>[s(d(i.$filters.data(t.dataHoraFinalizado))+" - "+d((o.contatos[t.idContatoVendedor]||{}).apelido)+" ",1),a(A,null,{default:e(()=>[s(" Data Finalizado - Vendedor ")]),_:1})]),_:2},1024)]),_:2},1024),a(r,{avatar:"",class:"mw50"},{default:e(()=>[a(T,{dark:"",rounded:"",color:"tertiary",denso:""},{default:e(()=>[s(d(t.status),1)]),_:2},1024)]),_:2},1024),a(r,{right:"",top:"",class:"mw50"},{default:e(()=>[a(m,null,{default:e(()=>[s(d(i.$filters.numero(t.totalDocumento,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),a(x,{class:"no-border text-tertiary"},{default:e(()=>[(n(!0),C(E,null,w(o.dados.carnes,t=>(n(),c(v,{key:t.id,class:"q-pa-none q-mb-xs",style:{"min-height":"auto"}},{default:e(()=>[a(r,{avatar:"",class:"mw80"},{default:e(()=>[a(m,null,{default:e(()=>[s(" Carn\xEA "),a(T,{dark:"",color:"tertiary",denso:"",round:""},{default:e(()=>[s("#"+d((t.id||"").slice(-6)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(r,null,{default:e(()=>[a(m,null,{default:e(()=>[s(d(i.$filters.data(t.dataVencimento)),1)]),_:2},1024)]),_:2},1024),a(r,null,{default:e(()=>[a(m,null,{default:e(()=>[s(d(t.formaDePagamento),1)]),_:2},1024)]),_:2},1024),a(r,{right:"",top:""},{default:e(()=>[a(m,null,{default:e(()=>[s(d(i.$filters.numero(t.valorTotal,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),B("div",Ca,[a(N,{class:"hideondesktop q-mb-sm q-mt-xs"}),a(P,{rounded:"",dense:"",flat:"",icon:"more_vert",color:"tertiary",class:"no-shadow q-ma-xs",size:"md",style:{float:"right"}},{default:e(()=>[a(R,null,{default:e(()=>[D((n(),c(x,{link:"",separator:""},{default:e(()=>[o.dados.fatura.id?(n(),c(v,{key:0,clickable:"",onClick:l[1]||(l[1]=t=>i.$refs.documentosFiscais.emitirCupom(o.dados.fatura.id))},{default:e(()=>[a(r,{avatar:""},{default:e(()=>[a(_,{name:"account_balance"})]),_:1}),a(r,null,{default:e(()=>[a(m,null,{default:e(()=>[s("Emitir cupom")]),_:1})]),_:1})]),_:1})):b("",!0),i.$utils.mapearStatus(o.dados.fatura).permiteNota?(n(),C(E,{key:1},[a(v,{clickable:"",onClick:l[2]||(l[2]=t=>i.emitirNFeV2({idFatura:o.dados.fatura.id},1,"Venda"))},{default:e(()=>[a(r,{avatar:""},{default:e(()=>[a(_,{name:"account_balance"})]),_:1}),a(r,null,{default:e(()=>[a(m,null,{default:e(()=>[s("NFe de Sa\xEDda/Venda")]),_:1})]),_:1})]),_:1}),a(v,{clickable:"",onClick:l[3]||(l[3]=t=>i.emitirNFeV2({idFatura:o.dados.fatura.id},0,"Devolu\xE7\xE3o"))},{default:e(()=>[a(r,{avatar:""},{default:e(()=>[a(_,{name:"account_balance"})]),_:1}),a(r,null,{default:e(()=>[a(m,null,{default:e(()=>[s("NFe de Entrada/Devolu\xE7\xE3o")]),_:1})]),_:1})]),_:1}),a(v,{clickable:"",onClick:l[4]||(l[4]=t=>i.emitirNFeV2({idFatura:o.dados.fatura.id},1,"Remessa"))},{default:e(()=>[a(r,{avatar:""},{default:e(()=>[a(_,{name:"account_balance"})]),_:1}),a(r,null,{default:e(()=>[a(m,null,{default:e(()=>[s("NFe de Remessa")]),_:1})]),_:1})]),_:1})],64)):b("",!0),u.mostrarOpcaoRemoverFatura?(n(),c(v,{key:2,clickable:"",onClick:l[5]||(l[5]=t=>u.removerFatura())},{default:e(()=>[a(r,{avatar:""},{default:e(()=>[a(_,{name:"mdi-trash-can"})]),_:1}),a(r,null,{default:e(()=>[s("Remover Fatura")]),_:1})]),_:1})):b("",!0),a(v,{clickable:"",onClick:l[6]||(l[6]=t=>i.$refs.modalHistoricoStatus.mostrar({idDocumento:o.dados.fatura.id}))},{default:e(()=>[a(r,{avatar:""},{default:e(()=>[a(_,{name:"history"})]),_:1}),a(r,null,{default:e(()=>[s("Hist\xF3rico do Status")]),_:1})]),_:1}),o.mostrarBotaoEnviarAvaliacao&&o.dados.fatura.status==="Finalizada"?(n(),c(v,{key:3,clickable:"",onClick:l[7]||(l[7]=t=>u.sendReview(o.dados.fatura))},{default:e(()=>[a(r,{avatar:""},{default:e(()=>[a(_,{name:"mdi-file-replace-outline"})]),_:1}),a(r,null,{default:e(()=>[s("Enviar Avalia\xE7\xE3o")]),_:1})]),_:1})):b("",!0),o.mostrarBotaoEnviarPedidosProtheus?(n(),c(v,{key:4,clickable:"",onClick:l[8]||(l[8]=t=>u.enviarPedidosProtheus(o.dados.fatura.id))},{default:e(()=>[a(r,{avatar:""},{default:e(()=>[a(_,{name:"send"})]),_:1}),a(r,null,{default:e(()=>[s("Enviar Pedidos - Protheus")]),_:1})]),_:1})):b("",!0)]),_:1})),[[H]])]),_:1})]),_:1}),o.podeEditar?(n(),c(P,{key:0,rounded:"",dense:"",flat:"",icon:"edit",color:"primary",class:"no-shadow q-ma-xs",size:"md",onClick:u.editar,style:{float:"right"}},null,8,["onClick"])):b("",!0),a(P,{rounded:"",dense:"",flat:"",icon:"print",color:"primary",class:"no-shadow q-ma-xs",size:"md",style:{float:"right"}},{default:e(()=>[a(R,null,{default:e(()=>[D((n(),c(x,{link:"",separator:""},{default:e(()=>[u.mostrarOpcaoEmitirBoleto?(n(),c(v,{key:0,clickable:"",onClick:l[9]||(l[9]=t=>u.abrirModalBoleto())},{default:e(()=>[a(r,{avatar:""},{default:e(()=>[a(_,{name:"mdi-printer"})]),_:1}),a(r,null,{default:e(()=>[a(m,null,{default:e(()=>[s("Emitir Boleto")]),_:1})]),_:1})]),_:1})):b("",!0),(n(!0),C(E,null,w(o.configImpressaoFatura,t=>(n(),c(v,{clickable:"",key:t.valor,onClick:k=>i.$imprimir(t.valor,(o.dados.fatura||{}).id||"0")},{default:e(()=>[a(r,{avatar:""},{default:e(()=>[a(_,{name:"print"})]),_:1}),a(r,null,{default:e(()=>[a(m,null,{default:e(()=>[s(d(t.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),o.sistemaPai==="optisoul"?(n(!0),C(E,{key:1},w(o.configImpressaoEnvelope,t=>(n(),c(v,{clickable:"",key:t.valor,onClick:k=>i.$imprimir(t.valor,(o.dados.fatura||{}).id||"0")},{default:e(()=>[a(r,{avatar:""},{default:e(()=>[a(_,{name:"print"})]),_:1}),a(r,null,{default:e(()=>[a(m,null,{default:e(()=>[s(d(t.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):b("",!0),(n(!0),C(E,null,w(o.configImpressaoCarne,t=>(n(),c(v,{clickable:"",key:t.valor,onClick:k=>i.$imprimir(t.valor,(o.dados.fatura||{}).id||"0")},{default:e(()=>[a(r,{avatar:""},{default:e(()=>[a(_,{name:"print"})]),_:1}),a(r,null,{default:e(()=>[a(m,null,{default:e(()=>[s(d(t.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),(n(!0),C(E,null,w(o.configImpressaoConvenio,t=>(n(),c(v,{clickable:"",key:t.valor,onClick:k=>i.$imprimir(t.valor,(o.dados.fatura||{}).id||"0")},{default:e(()=>[a(r,{avatar:""},{default:e(()=>[a(_,{name:"print"})]),_:1}),a(r,null,{default:e(()=>[a(m,null,{default:e(()=>[s(d(t.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})),[[H]])]),_:1})]),_:1}),a(P,{rounded:"",dense:"",flat:"",icon:o.detalhesVisivel?"keyboard_arrow_up":"keyboard_arrow_down",size:"md",class:"no-shadow q-ma-xs",color:"tertiary",style:{float:"right"},onClick:u.alternarDetalhes},null,8,["icon","onClick"])])]),_:1}),a(N,{class:"hideondesktop q-mb-sm q-mt-xs"}),a(g,{class:"hideondesktop"},{default:e(()=>[B("div",Ea,[B("p",wa,[o.dados.fatura.dataHoraEmissao?(n(),c(_,{key:0,name:"mdi-calendar-today"})):b("",!0),s(" "+d(i.$filters.data(o.dados.fatura.dataHoraEmissao))+" ",1),a(A,null,{default:e(()=>[s(" Emiss\xE3o ")]),_:1})]),B("p",qa,[o.dados.fatura.dataHoraFinalizado?(n(),c(_,{key:0,name:"mdi-calendar-check"})):b("",!0),s(" "+d(i.$filters.data(o.dados.fatura.dataHoraFinalizado))+" ",1),o.dados.fatura.dataHoraFinalizado?(n(),c(A,{key:1},{default:e(()=>[s(" Finalizado ")]),_:1})):b("",!0)])]),B("div",Pa,[B("p",Va,d(i.$filters.numero(o.dados.fatura.subTotal,2)),1),B("p",xa,d(i.$filters.numero(o.dados.fatura.totalDocumento,2)),1)]),B("div",Ia,[a(N,{class:"hideondesktop q-mb-sm q-mt-xs"}),a(P,{rounded:"",dense:"",flat:"",icon:"more_vert",color:"tertiary",class:"no-shadow q-ma-xs",size:"md",style:{float:"right"}},{default:e(()=>[a(R,null,{default:e(()=>[D((n(),c(x,{link:"",separator:""},{default:e(()=>[o.mostrarBotaoEmitirCupom&&o.dados.fatura.id?(n(),c(v,{key:0,clickable:"",onClick:l[10]||(l[10]=t=>i.$refs.documentosFiscais.emitirCupom(o.dados.fatura.id))},{default:e(()=>[a(r,{avatar:""},{default:e(()=>[a(_,{name:"account_balance"})]),_:1}),a(r,null,{default:e(()=>[a(m,null,{default:e(()=>[s("Emitir cupom")]),_:1})]),_:1})]),_:1})):b("",!0),i.$utils.mapearStatus(o.dados.fatura).permiteNota?(n(),C(E,{key:1},[a(v,{clickable:"",onClick:l[11]||(l[11]=t=>i.emitirNFeV2({idFatura:o.dados.fatura.id},1,"Venda"))},{default:e(()=>[a(r,{avatar:""},{default:e(()=>[a(_,{name:"account_balance"})]),_:1}),a(r,null,{default:e(()=>[a(m,null,{default:e(()=>[s("NFe de Sa\xEDda/Venda")]),_:1})]),_:1})]),_:1}),a(v,{clickable:"",onClick:l[12]||(l[12]=t=>i.emitirNFeV2({idFatura:o.dados.fatura.id},0,"Devolu\xE7\xE3o"))},{default:e(()=>[a(r,{avatar:""},{default:e(()=>[a(_,{name:"account_balance"})]),_:1}),a(r,null,{default:e(()=>[a(m,null,{default:e(()=>[s("NFe de Entrada/Devolu\xE7\xE3o")]),_:1})]),_:1})]),_:1}),a(v,{clickable:"",onClick:l[13]||(l[13]=t=>i.emitirNFeV2({idFatura:o.dados.fatura.id},1,"Remessa"))},{default:e(()=>[a(r,{avatar:""},{default:e(()=>[a(_,{name:"account_balance"})]),_:1}),a(r,null,{default:e(()=>[a(m,null,{default:e(()=>[s("NFe de Remessa")]),_:1})]),_:1})]),_:1})],64)):b("",!0),u.mostrarOpcaoRemoverFatura?(n(),c(v,{key:2,clickable:"",onClick:l[14]||(l[14]=t=>u.removerFatura())},{default:e(()=>[a(r,{avatar:""},{default:e(()=>[a(_,{name:"mdi-trash-can"})]),_:1}),a(r,null,{default:e(()=>[s("Remover Fatura")]),_:1})]),_:1})):b("",!0),a(v,{clickable:"",onClick:l[15]||(l[15]=t=>i.$refs.modalHistoricoStatus.mostrar({idDocumento:o.dados.fatura.id}))},{default:e(()=>[a(r,{avatar:""},{default:e(()=>[a(_,{name:"history"})]),_:1}),a(r,null,{default:e(()=>[s("Hist\xF3rico do Status")]),_:1})]),_:1}),o.mostrarBotaoEnviarAvaliacao&&o.dados.fatura.status==="Finalizada"?(n(),c(v,{key:3,clickable:"",onClick:l[16]||(l[16]=t=>u.sendReview(o.dados.fatura))},{default:e(()=>[a(r,{avatar:""},{default:e(()=>[a(_,{name:"mdi-file-replace-outline"})]),_:1}),a(r,null,{default:e(()=>[s("Enviar Avalia\xE7\xE3o")]),_:1})]),_:1})):b("",!0),o.mostrarBotaoEnviarPedidosProtheus?(n(),c(v,{key:4,clickable:"",onClick:l[17]||(l[17]=t=>u.enviarPedidosProtheus(o.dados.fatura.id))},{default:e(()=>[a(r,{avatar:""},{default:e(()=>[a(_,{name:"send"})]),_:1}),a(r,null,{default:e(()=>[s("Enviar Pedidos - Protheus")]),_:1})]),_:1})):b("",!0)]),_:1})),[[H]])]),_:1})]),_:1}),o.podeEditar?(n(),c(P,{key:0,rounded:"",dense:"",flat:"",icon:"edit",color:"primary",class:"no-shadow q-ma-xs",size:"md",onClick:u.editar,style:{float:"right"}},null,8,["onClick"])):b("",!0),a(P,{rounded:"",dense:"",flat:"",icon:"print",color:"primary",class:"no-shadow q-ma-xs",size:"md",style:{float:"right"}},{default:e(()=>[a(R,null,{default:e(()=>[a(x,{link:"",separator:""},{default:e(()=>[u.mostrarOpcaoEmitirBoleto?(n(),c(v,{key:0,clickable:"",onClick:l[18]||(l[18]=t=>u.abrirModalBoleto())},{default:e(()=>[a(r,{avatar:""},{default:e(()=>[a(_,{name:"mdi-printer"})]),_:1}),a(r,null,{default:e(()=>[a(m,null,{default:e(()=>[s("Emitir Boleto")]),_:1})]),_:1})]),_:1})):b("",!0),(n(!0),C(E,null,w(o.configImpressaoFatura,t=>(n(),c(v,{clickable:"",key:t.valor,onClick:k=>i.$imprimir(t.valor,(o.dados.fatura||{}).id||"0")},{default:e(()=>[a(r,{avatar:""},{default:e(()=>[a(_,{name:"print"})]),_:1}),a(r,null,{default:e(()=>[a(m,null,{default:e(()=>[s(d(t.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),o.sistemaPai==="optisoul"?(n(!0),C(E,{key:1},w(o.configImpressaoEnvelope,t=>(n(),c(v,{clickable:"",key:t.valor,onClick:k=>i.$imprimir(t.valor,(o.dados.fatura||{}).id||"0")},{default:e(()=>[a(r,{avatar:""},{default:e(()=>[a(_,{name:"print"})]),_:1}),a(r,null,{default:e(()=>[a(m,null,{default:e(()=>[s(d(t.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):b("",!0),(n(!0),C(E,null,w(o.configImpressaoCarne,t=>(n(),c(v,{clickable:"",key:t.valor,onClick:k=>i.$imprimir(t.valor,(o.dados.fatura||{}).id||"0")},{default:e(()=>[a(r,{avatar:""},{default:e(()=>[a(_,{name:"print"})]),_:1}),a(r,null,{default:e(()=>[a(m,null,{default:e(()=>[s(d(t.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),(n(!0),C(E,null,w(o.configImpressaoConvenio,t=>(n(),c(v,{clickable:"",key:t.valor,onClick:k=>i.$imprimir(t.valor,(o.dados.fatura||{}).id||"0")},{default:e(()=>[a(r,{avatar:""},{default:e(()=>[a(_,{name:"print"})]),_:1}),a(r,null,{default:e(()=>[a(m,null,{default:e(()=>[s(d(t.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1}),a(P,{rounded:"",dense:"",flat:"",icon:o.detalhesVisivel?"keyboard_arrow_up":"keyboard_arrow_down",size:"md",class:"no-shadow q-ma-xs",color:"tertiary",style:{float:"right"},onClick:u.alternarDetalhes},null,8,["icon","onClick"])])]),_:1}),o.detalhesVisivel?(n(),c(N,{key:0,class:"hideondesktop q-my-sm"})):b("",!0),D(a(g,{class:"items-start q-mx-none q-px-none q-mt-md"},{default:e(()=>[B("div",za,[B("p",Na,[a(_,{name:"business"}),s(" "+d(o.dados.fatura.descricaoEmpresa),1)]),a(p,{ref:"documentosFiscais",idFatura:o.dados.fatura.id},null,8,["idFatura"])]),B("div",Da,[Sa,B("p",Ta,d(o.dados.fatura.observacaoFaturamento),1),a(x,{class:"no-border"},{default:e(()=>[(n(!0),C(E,null,w(i.condicaoPagamentoResumo,t=>(n(),c(v,{key:t.id,class:"q-pa-none row",style:{"min-height":"auto"}},{default:e(()=>[a(r,null,{default:e(()=>[a(m,null,{default:e(()=>[s(d(t.formaPagamento),1)]),_:2},1024)]),_:2},1024),a(r,{class:"text-right"},{default:e(()=>[a(m,null,{default:e(()=>[s(d(i.$filters.numero(t.valor,2))+d(t.parcelas>1?` (em ${t.parcelas}x)`:""),1)]),_:2},1024)]),_:2},1024),a(r,{right:""},{default:e(()=>[a(m,null,{default:e(()=>[s(d(i.$filters.data(t.dataVencimento)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),B("div",Aa,[Ha,B("p",Qa,d(i.$filters.numero(o.dados.fatura.totalDesconto,2)),1)])]),_:1},512),[[ea,o.detalhesVisivel]]),a(F,{ref:"faturaModal",onExecutar:u.executar},null,8,["onExecutar"]),o.modalBoleto.ativo?(n(),c(oa,{key:1,modelValue:o.modalBoleto.visivel,"onUpdate:modelValue":l[21]||(l[21]=t=>o.modalBoleto.visivel=t),onHide:u.fecharModalBoleto,minimized:""},{default:e(()=>[a(L,null,{default:e(()=>[a(O,null,{default:e(()=>[a(j,null,{default:e(()=>[Ra]),_:1}),D(a(P,{flat:"",round:"",dense:"",icon:"close"},null,512),[[H]])]),_:1}),o.modalBoleto.docFiscal?(n(),c(G,{key:0},{default:e(()=>[s(" Nota fiscal: "+d(o.modalBoleto.docFiscal.nNF)+" / S\xE9rie: "+d(o.modalBoleto.docFiscal.serie),1)]),_:1})):b("",!0),a(G,null,{default:e(()=>[o.modalBoleto.condicoesPagamento.filter(t=>t.disable).length?(n(),c(x,{key:0,dense:"",highlight:"",class:"q-mb-sm"},{default:e(()=>[a(m,{header:""},{default:e(()=>[s("Recuperando informa\xE7\xF5es do servidor "),a(sa)]),_:1}),a(N),(n(!0),C(E,null,w(o.modalBoleto.condicoesPagamento.filter(t=>t.disable),(t,k)=>(n(),c(v,{key:k,tag:"label"},{default:e(()=>[a(r,null,{default:e(()=>[t.disable?(n(),c(na,{key:0})):b("",!0)]),_:2},1024),a(m,null,{default:e(()=>[a(m,{header:""},{default:e(()=>[s(d(t.descricao)+" - "+d(i.$filters.numero(t.valor,2))+" - Venc. "+d(i.$filters.data(t.dataVencimento)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):b("",!0),B("form",{class:"q-pa-sm",onSubmit:l[20]||(l[20]=ta(t=>u.emitirImprimirBoleto(),["prevent"]))},[o.modalBoleto.condicoesPagamento.filter(t=>!t.disable&&t.codigoFinanceiroBoleto).length?(n(),c(x,{key:0,dense:"",highlight:"",class:"q-mb-sm"},{default:e(()=>[a(m,{header:""},{default:e(()=>[s("Boletos emitidos")]),_:1}),a(N),(n(!0),C(E,null,w(o.modalBoleto.condicoesPagamento.filter(t=>!t.disable&&t.codigoFinanceiroBoleto),(t,k)=>(n(),c(v,{key:k,tag:"label"},{default:e(()=>[a(r,null,{default:e(()=>[a(J,{modelValue:t.checked,"onUpdate:modelValue":I=>t.checked=I},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(m,null,{default:e(()=>[a(m,{header:""},{default:e(()=>[s(d(t.descricao)+" - "+d(i.$filters.numero(t.valor,2))+" - Venc. "+d(i.$filters.data(t.dataVencimento)),1)]),_:2},1024),a(m,{caption:""},{default:e(()=>[s(d(t.banco.descricao)+" - Ag. "+d(t.banco.agencia)+" C/C "+d(t.banco.conta)+" - Emitido em "+d(i.$filters.dataHora(t.banco.dataEmissao)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):b("",!0),o.modalBoleto.condicoesPagamento.filter(t=>!t.disable&&!t.codigoFinanceiroBoleto).length?(n(),c(x,{key:1,dense:"",highlight:""},{default:e(()=>[a(m,{header:""},{default:e(()=>[s("Boletos a emitir")]),_:1}),a(N),a(v,null,{default:e(()=>[a(m,null,{default:e(()=>[a(ia,{modelValue:o.modalBoleto.financeiroBanco,"onUpdate:modelValue":l[19]||(l[19]=t=>o.modalBoleto.financeiroBanco=t),options:o.modalBoleto.bancos},null,8,["modelValue","options"])]),_:1})]),_:1}),(n(!0),C(E,null,w(o.modalBoleto.condicoesPagamento.filter(t=>!t.disable&&!t.codigoFinanceiroBoleto),(t,k)=>(n(),c(v,{key:k,tag:"label"},{default:e(()=>[a(r,null,{default:e(()=>[a(J,{modelValue:t.checked,"onUpdate:modelValue":I=>t.checked=I},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(m,null,{default:e(()=>[a(m,{header:""},{default:e(()=>[s(d(t.descricao)+" - "+d(i.$filters.numero(t.valor,2))+" - Venc. "+d(i.$filters.data(t.dataVencimento)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):b("",!0),B("div",Ma,[D(a(P,{color:"tertiary",flat:"",label:"Cancelar"},null,512),[[H]]),a(P,{color:"primary",class:"q-ml-sm",label:"Imprimir",type:"submit",unelevated:"",disable:!u.ativarBotaoEmissaoBoleto},null,8,["disable"])])],32),a(la,{showing:o.modalBoleto.loading},{default:e(()=>[a(ra,{size:"50px",color:"primary"})]),_:1},8,["showing"])]),_:1})]),_:1})]),_:1},8,["modelValue","onHide"])):b("",!0),a(q,{ref:"modalHistoricoStatus"},null,512)]),_:1})):b("",!0)}var Ya=X(fa,[["render",Ua]]);export{Ya as F};
