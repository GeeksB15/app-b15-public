import{_ as go,P as Ja,b3 as no,p as N,o as b,i as D,w as t,f as a,K as vo,A as Io,B as mo,E as bo,e as h,t as y,l as T,C as B,D as U,L as K,G as Co,H as Xa,d as O,aG as Ka,aH as Eo,aZ as Ya,a_ as Po,T as oo,b9 as Aa,ba as Ha,bb as J,I as qo,b5 as $a,y as Vo,M as Qa,f5 as oe,b1 as Ga,R as La,aB as Q,Q as So,u as ae,ak as S,F as W,r as ao,ai as Y,aj as R,ah as M,x,k as Z,j as L,am as Fo,cr as ja,z as ee,aQ as Za,s as Ra,aF as fo,V as te,aE as le,aS as re}from"./index.de1453f2.js";import"./xlsx.b4645649.js";import{B as Wa}from"./BadgeCopiarUid.b366bc5d.js";import{S as ie}from"./SeletorCfop.3eb2a332.js";import{C as se}from"./Campo.a4c2440c.js";import{l as ne}from"./Lista.abb491a2.js";import"./QBtnDropdown.5dbecd5f.js";import"./QBtnGroup.6b7a6760.js";import"./QDate.3b3bb878.js";const me={components:{SeletorNcm:Ja,SeletorCfop:ie,Campo:se},data(){return{abaSelecionada:"tab1",historicoItem:[],tabelaHistoricoItem:{colunas:[{name:"fornecedor",label:"Fornecedor",align:"left"},{name:"dataCompra",label:"Data Compra",align:"right"},{name:"quantidade",label:"Quantidade",align:"right"},{name:"valorCusto",label:"Valor de Custo",align:"right"},{name:"valorTotal",label:"Valor Total (Custo)",align:"right"}],paginacao:{page:1,rowsPerPage:5}},estoqueItem:[],tabelaEstoqueItem:{colunas:[{name:"empresa",label:"Empresa",align:"left"},{name:"tipoEstoque",label:"Tipo estoque",align:"right"},{name:"lote",label:"Lote",align:"right"},{name:"quantidade",label:"Quantidade",align:"right"}],paginacao:{page:1,rowsPerPage:5}},cfop:null,contaEstoque:[],impostoCstIpi:[],impostoIcmsModalidade:[],impostoCstIcms:[],impostoCstIcmsSt:[],documentoItem:{},imposto:{},item:{},visivel:!1,contasOpcoes:[],exibirIcms:!1,exibirIcmsSt:!1,exibirIpi:!1,somenteLeituraIcms:!1,somenteLeituraIcmsSt:!1,exibirHistorico:!1,exibirEstoque:!1,exibeCfop:!1}},emits:["salvar"],methods:{async mostrar(l,e){var s,p,i,c,u,g,f,I,d,V;this.documentoItem=$utils.clonarV2(l),this.item=$utils.clonarV2(e),await this.consultarHistoricoItem(this.item),await this.consultarEstoqueItem(this.item);const m=await no().list("impostoParametro",{filter:{impParamTipoCod:1}}),n=await no().list("impostoParametro",{filter:{impParamTipoCod:21}});this.impostoCstIcms=m.concat(n).map(v=>({rotulo:v.numero.trim()+" - "+v.descr,valor:Number(v.numero)})).sort((v,r)=>Number(v.valor)-Number(r.valor)),this.impostoIcmsModalidade=(await no().list("impostoParametro",{filter:{impParamTipoCod:3}})).map(v=>({rotulo:v.numero.trim()+" - "+v.descr,valor:Number(v.numero)})).sort((v,r)=>Number(v.valor)-Number(r.valor)),this.impostoCstIcmsSt=(await no().list("impostoParametro",{filter:{impParamTipoCod:4}})).map(v=>({rotulo:v.numero.trim()+" - "+v.descr,valor:Number(v.numero)})).sort((v,r)=>Number(v.valor)-Number(r.valor)),this.impostoCstIpi=(await no().list("impostoParametro",{filter:{impParamTipoCod:5}})).map(v=>({rotulo:v.numero.trim()+" - "+v.descr,valor:Number(v.numero)})).sort((v,r)=>Number(v.valor)-Number(r.valor)),this.contaEstoque=(await $db.financeiroPlanoConta.leV2()).map(v=>{var r,C,w;return{rotulo:(w=(C=(r=v==null?void 0:v.descricao)!=null?r:" - "+(v==null?void 0:v.classificacao))!=null?C:" - "+(v==null?void 0:v.caminho))!=null?w:"",valor:v.id}}).sort((v,r)=>Number(v.valor)-Number(r.valor));let o;(s=this.documentoItem)!=null&&s.idCfop&&(o=await $erp().cfop.where({id:this.documentoItem.idCfop}).first()),o===void 0&&console.log("CFOP inv\xE1lido"),this.documentoItem.cfop=(p=o==null?void 0:o.cfop)!=null?p:"",this.documentoItem.codigoCfop=(i=o==null?void 0:o.codigoCfop)!=null?i:null,this.documentoItem.idCfop=(c=o.id)!=null?c:null,this.documentoItem.valorBaseIcms=(g=(u=this.documentoItem.valorBaseIcms)!=null?u:this.documentoItem.total)!=null?g:0,this.documentoItem.valorBaseIpi=(I=(f=this.documentoItem.valorBaseIpi)!=null?f:this.documentoItem.total)!=null?I:0,this.documentoItem.valorBaseIcmsSt=(V=(d=this.documentoItem.valorBaseIcmsSt)!=null?d:this.documentoItem.total)!=null?V:0,this.calcularImpostos(),this.exibeCfop=!0,this.visivel=!0},async salvar(){try{if(Object.keys(this.documentoItem.cfop).length>0){const l=await $db.cfop.le({cfop:Number(this.documentoItem.cfop)});this.documentoItem.codigoCfop=l[0].codigoCfop,this.documentoItem.idCfop=l[0].id}this.documentoItem.cfop&&delete this.documentoItem.cfop,this.$emit("salvar",this.documentoItem),this.exibirIcms=!1,this.exibirIcmsSt=!1,this.exibirIpi=!1,this.visivel=!1}catch(l){$q.notifyError("Ocorreu um erro ao salvar o produto: ",l.message)}finally{$q.notifyPositive("Produto salvo com sucesso.")}},calcularImpostos(l){var f,I,d,V,v,r,C,w,k,_;let e=(f=this.documentoItem.valorBaseIcms)!=null?f:0,m=(I=this.documentoItem.valorBaseIpi)!=null?I:0,n=(d=this.documentoItem.valorBaseIcmsSt)!=null?d:0,o=(V=this.documentoItem.percentualIcms)!=null?V:0,s=(v=this.documentoItem.percentualIpi)!=null?v:0,p=(r=this.documentoItem.percentualIVA)!=null?r:0,i=(C=this.documentoItem.percentualIcmsSt)!=null?C:0,c=(w=this.documentoItem.valorIcms)!=null?w:0,u=(k=this.documentoItem.valorIpi)!=null?k:0,g=(_=this.documentoItem.valorIcmsSt)!=null?_:0;["valorBaseIcms","percentualIcms"].includes(l)&&(c=e*o/100),l==="valorIcms"&&(o=c/e*100),["valorBaseIpi","percentualIpi"].includes(l)&&(u=m*s/100),l==="valorIpi"&&(s=u/m*100),l==="valorBaseIcmsSt"&&(p=0,n>0&&e>0&&n>=e&&(p=(n-e)/e*100),g=n*i/100-c),l==="percentualIVA"&&(n=e*(1+p/100),g=n*i/100-c),l==="percentualIcmsSt"&&(g=n*i/100-c),l==="valorIcmsSt"&&(i=g/n*100),this.documentoItem.valorBaseIcmsSt=parseFloat(n.toFixed(2)),this.documentoItem.percentualIcms=parseFloat(o.toFixed(2)),this.documentoItem.percentualIcmsSt=parseFloat(i.toFixed(2)),this.documentoItem.percentualIpi=parseFloat(s.toFixed(2)),this.documentoItem.percentualIVA=parseFloat(p.toFixed(2)),this.documentoItem.valorIcms=parseFloat(c.toFixed(2)),this.documentoItem.valorIcmsSt=parseFloat(g.toFixed(2)),this.documentoItem.valorIpi=parseFloat(u.toFixed(2)),(this.documentoItem.modalidadeBaseCalculo||this.documentoItem.percentualIcms>0||this.documentoItem.valorIcms>0)&&(this.exibirIcms=!0),(this.documentoItem.modalidadeBaseCalculoST||this.documentoItem.percentualIcmsSt>0||this.documentoItem.valorIcmsSt>0)&&(this.exibirIcmsSt=!0),(this.documentoItem.codigoCSTIPI||this.documentoItem.percentualIpi>0||this.documentoItem.valorIpi>0)&&(this.exibirIpi=!0)},async consultarCFOP(){var m,n;const l=this.documentoItem.cfop,e=await $erp().cfop.where({cfop:Number(l)}).first();e===void 0&&console.log("CFOP inv\xE1lido"),this.documentoItem.idCfop=(m=e==null?void 0:e.id)!=null?m:null,this.documentoItem.codigoCfop=(n=e==null?void 0:e.CodigoCFOP)!=null?n:null},async consultarHistoricoItem(l){const e={};(l==null?void 0:l.atual)&&Object.keys(l.atual).length>0&&(l=l.atual);const n=(await $db.documentoItem.ler({idItem:l.id})).filter(o=>(o.operacao==="Compra"||o.operacao==="Compra de Mercadoria")&&o.status==="Finalizado"&&o.operacaoFator===1&&o.quantidade>0);for(const o of n){const s=await $db.documento.ler({id:o.idDocumento}),p=await $db.contato.le({id:s.idContato});e[o.idItem]||(e[o.idItem]={fornecedores:[]}),e[o.idItem].fornecedores.push({idItem:o.idItem||"",idContatoFornecedor:s.idContato||"",descricaoContatoFornecedor:p.nome||"",dataCompra:s.dataCompra||"",quantidade:o.quantidade||"",valorCusto:o.valorItem||"",valorTotal:o.valorItem*o.quantidade||""})}Object.keys(e).length>0?(this.historicoItem=e,this.historicoItem[l.id].fornecedores.sort((o,s)=>{const p=new Date(o.dataCompra||"1900-01-01");return new Date(s.dataCompra||"1900-01-01")-p})):this.historicoItem[l.id]={},this.exibirHistorico=!0},async consultarEstoqueItem(l){const e={};(l==null?void 0:l.atual)&&Object.keys(l.atual).length>0&&(l=l.atual);const m=await $db.estoqueSaldoProdutoEmpresa.le({idItem:l.id,tipoEstoque:"Dispon\xEDvel"});for(const n of m){const o=await $db.contato.le({id:n.idEmpresa});e[n.idItem]||(e[n.idItem]={estoques:[]}),e[n.idItem].estoques.push({idItem:n.idItem||"",idContatoEmpresa:n.idEmpresa||"",codigoContatoEmpresa:n.codigoEmpresa||"",descricaoContatoEmpresa:o.nome||"",tipoEstoque:n.tipoEstoque||"",lote:n.lote||"",saldo:n.saldo||""})}Object.keys(e).length>0?(this.estoqueItem=e,this.estoqueItem[l.id].estoques.sort((n,o)=>{const s=Number(n.codigoContatoEmpresa||0),p=Number(o.codigoContatoEmpresa||0);return s-p})):this.estoqueItem[l.id]={},this.exibirEstoque=!0},async fechar(){this.documentoItem.cfop&&delete this.documentoItem.cfop,this.exibirIcms=!1,this.exibirIcmsSt=!1,this.exibirIpi=!1}}},de=["src"],ce={key:0},ue={key:0};function pe(l,e,m,n,o,s){const p=N("badge"),i=N("g-col"),c=N("g-row"),u=N("campo"),g=N("SeletorNcm"),f=N("SeletorCfop"),I=N("g-label");return b(),D(Vo,{modelValue:o.visivel,"onUpdate:modelValue":e[35]||(e[35]=d=>o.visivel=d),persistent:""},{default:t(()=>[a(vo,{container:"",view:"hHh Lpr fFf",class:"bg-white",style:{"max-width":"980px"}},{default:t(()=>[a(Io,{class:"bg-primary"},{default:t(()=>[a(mo,{class:"bg-primary text-white"},{default:t(()=>[a(bo,null,{default:t(()=>[h(y(o.documentoItem.descricaoItem),1)]),_:1}),o.item.referencia?(b(),D(p,{key:0,cor:"tertiary",class:"q-mr-sm"},{default:t(()=>[h(y(o.item.referencia),1)]),_:1})):T("",!0),B(a(U,{onClick:s.fechar,dense:"",flat:"",icon:"close",round:""},null,8,["onClick"]),[[K]])]),_:1})]),_:1}),a(Co,null,{default:t(()=>[a(Xa,null,{default:t(()=>[a(c,{gutter:"md"},{default:t(()=>[a(i,null,{default:t(()=>[a(c,{class:"col-12 text-center"},{default:t(()=>[a(i,null,{default:t(()=>{var d,V,v,r,C,w;return[((d=o.item)==null?void 0:d.imagem)||((v=(V=o.item)==null?void 0:V.atual)==null?void 0:v.imagem)?(b(),O("img",{key:0,src:((r=o.item)==null?void 0:r.imagem)||((w=(C=o.item)==null?void 0:C.atual)==null?void 0:w.imagem),alt:"",style:{"max-width":"33%"}},null,8,de)):T("",!0)]}),_:1})]),_:1}),a(Ka,{modelValue:o.abaSelecionada,"onUpdate:modelValue":e[0]||(e[0]=d=>o.abaSelecionada=d),align:"justify",dense:"","indicator-color":"light-blue-4",class:"text-primary q-px-sm"},{default:t(()=>[a(Eo,{default:"",name:"tab1",icon:"info",label:"Detalhes",class:"cinza"}),a(Eo,{name:"tab2",icon:"history",label:"Compras",class:"cinza"}),a(Eo,{name:"tab3",icon:"compare_arrows",label:"Estoque",class:"cinza"})]),_:1},8,["modelValue"]),a(Ya,{modelValue:o.abaSelecionada,"onUpdate:modelValue":e[34]||(e[34]=d=>o.abaSelecionada=d),animated:"",class:"text-tertiary"},{default:t(()=>[a(Po,{name:"tab1",class:"q-px-sm"},{default:t(()=>[a(c,null,{default:t(()=>[a(i,null,{default:t(()=>[a(u,{modelValue:o.documentoItem.observacao,"onUpdate:modelValue":e[1]||(e[1]=d=>o.documentoItem.observacao=d),tipo:"textoArea",rotulo:"Observa\xE7\xE3o",dense:"",rows:"4"},null,8,["modelValue"])]),_:1})]),_:1}),a(c,{mg:"lg-t"},{default:t(()=>[a(i,{col:"12"},{default:t(()=>[a(g,{modelValue:o.documentoItem.ncm,"onUpdate:modelValue":e[2]||(e[2]=d=>o.documentoItem.ncm=d),class:"col-12 col-md-6",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),a(c,{mg:"lg-t"},{default:t(()=>[a(i,{col:"12"},{default:t(()=>[a(f,{modelValue:o.documentoItem.cfop,"onUpdate:modelValue":e[3]||(e[3]=d=>o.documentoItem.cfop=d),class:"col-12 col-md-6",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),a(c,{mg:"lg-t"},{default:t(()=>[a(i,null,{default:t(()=>[a(I,{text:"sub1 medium"},{default:t(()=>[h("Estoque")]),_:1})]),_:1})]),_:1}),a(c,{items:"center"},{default:t(()=>[a(i,{col:"12"},{default:t(()=>[a(u,{modelValue:o.documentoItem.idPlanoContaEstoque,"onUpdate:modelValue":e[4]||(e[4]=d=>o.documentoItem.idPlanoContaEstoque=d),opcoes:o.contaEstoque,tipo:"seletor",ajuda:"Plano de Conta de Estoque para Entrada de Mercadoria",dense:"",outlined:"",rotulo:"Conta Estoque"},null,8,["modelValue","opcoes"])]),_:1})]),_:1}),a(c,{mg:"lg-t"},{default:t(()=>[a(i,null,{default:t(()=>[a(I,{text:"sub1 medium"},{default:t(()=>[h("Impostos")]),_:1})]),_:1})]),_:1}),a(c,null,{default:t(()=>[a(oo,{label:"ICMS",modelValue:o.exibirIcms,"onUpdate:modelValue":e[5]||(e[5]=d=>o.exibirIcms=d)},null,8,["modelValue"])]),_:1}),o.exibirIcms?(b(),D(c,{key:0,items:"center"},{default:t(()=>[a(i,{col:"12 sm6"},{default:t(()=>[a(u,{modelValue:o.documentoItem.modalidadeBaseCalculo,"onUpdate:modelValue":e[6]||(e[6]=d=>o.documentoItem.modalidadeBaseCalculo=d),opcoes:o.impostoIcmsModalidade,"somente-leitura":o.somenteLeituraIcms,tipo:"seletor",outlined:"",rotulo:"ICMS (Modalidade)"},null,8,["modelValue","opcoes","somente-leitura"])]),_:1}),a(i,{col:"12 sm6"},{default:t(()=>[a(u,{modelValue:o.documentoItem.codigoCST,"onUpdate:modelValue":e[7]||(e[7]=d=>o.documentoItem.codigoCST=d),opcoes:o.impostoCstIcms,"somente-leitura":o.somenteLeituraIcms,tipo:"seletor",outlined:"",rotulo:"CST ICMS"},null,8,["modelValue","opcoes","somente-leitura"])]),_:1}),a(i,{col:"12 sm4"},{default:t(()=>[a(u,{modelValue:o.documentoItem.valorBaseIcms,"onUpdate:modelValue":e[8]||(e[8]=d=>o.documentoItem.valorBaseIcms=d),onBlur:e[9]||(e[9]=d=>s.calcularImpostos("valorBaseIcms")),"somente-leitura":o.somenteLeituraIcms,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Base ICMS"},null,8,["modelValue","somente-leitura"])]),_:1}),a(i,{col:"12 sm4"},{default:t(()=>[a(u,{modelValue:o.documentoItem.percentualIcms,"onUpdate:modelValue":e[10]||(e[10]=d=>o.documentoItem.percentualIcms=d),onBlur:e[11]||(e[11]=d=>s.calcularImpostos("percentualIcms")),"somente-leitura":o.somenteLeituraIcms,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"ICMS %"},null,8,["modelValue","somente-leitura"])]),_:1}),a(i,{col:"12 sm4"},{default:t(()=>[a(u,{modelValue:o.documentoItem.valorIcms,"onUpdate:modelValue":e[12]||(e[12]=d=>o.documentoItem.valorIcms=d),onBlur:e[13]||(e[13]=d=>s.calcularImpostos("valorIcms")),"somente-leitura":o.somenteLeituraIcms,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Valor ICMS"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})):T("",!0),a(c,null,{default:t(()=>[a(oo,{label:"ICMS ST",modelValue:o.exibirIcmsSt,"onUpdate:modelValue":e[14]||(e[14]=d=>o.exibirIcmsSt=d)},null,8,["modelValue"])]),_:1}),o.exibirIcmsSt?(b(),D(c,{key:1,items:"center"},{default:t(()=>[a(i,{col:"12 sm6"},{default:t(()=>[a(u,{modelValue:o.documentoItem.modalidadeBaseCalculoST,"onUpdate:modelValue":e[15]||(e[15]=d=>o.documentoItem.modalidadeBaseCalculoST=d),opcoes:o.impostoCstIcmsSt,"somente-leitura":o.somenteLeituraIcmsSt,tipo:"seletor",outlined:"",rotulo:"ICMS ST (Modalidade)"},null,8,["modelValue","opcoes","somente-leitura"])]),_:1}),a(i,{col:"12 sm6"},{default:t(()=>[a(u,{modelValue:o.documentoItem.percentualIVA,"onUpdate:modelValue":e[16]||(e[16]=d=>o.documentoItem.percentualIVA=d),onBlur:e[17]||(e[17]=d=>s.calcularImpostos("percentualIVA")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"IVA (%)"},null,8,["modelValue"])]),_:1}),a(i,{col:"12 sm4"},{default:t(()=>[a(u,{modelValue:o.documentoItem.valorBaseIcmsSt,"onUpdate:modelValue":e[18]||(e[18]=d=>o.documentoItem.valorBaseIcmsSt=d),onBlur:e[19]||(e[19]=d=>s.calcularImpostos("valorBaseIcmsSt")),"somente-leitura":o.somenteLeituraIcmsSt,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Base ICMS ST"},null,8,["modelValue","somente-leitura"])]),_:1}),a(i,{col:"12 sm4"},{default:t(()=>[a(u,{modelValue:o.documentoItem.percentualIcmsSt,"onUpdate:modelValue":e[20]||(e[20]=d=>o.documentoItem.percentualIcmsSt=d),onBlur:e[21]||(e[21]=d=>s.calcularImpostos("percentualIcmsSt")),"somente-leitura":o.somenteLeituraIcmsSt,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"ICMS ST (%)"},null,8,["modelValue","somente-leitura"])]),_:1}),a(i,{col:"12 sm4"},{default:t(()=>[a(u,{modelValue:o.documentoItem.valorIcmsSt,"onUpdate:modelValue":e[22]||(e[22]=d=>o.documentoItem.valorIcmsSt=d),onBlur:e[23]||(e[23]=d=>s.calcularImpostos("valorIcmsSt")),"somente-leitura":o.somenteLeituraIcmsSt,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Valor ICMS ST"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})):T("",!0),a(c,null,{default:t(()=>[a(oo,{label:"IPI",modelValue:o.exibirIpi,"onUpdate:modelValue":e[24]||(e[24]=d=>o.exibirIpi=d)},null,8,["modelValue"])]),_:1}),o.exibirIpi?(b(),D(c,{key:2,items:"center"},{default:t(()=>[a(i,{col:"12"},{default:t(()=>[a(u,{modelValue:o.documentoItem.codigoCSTIPI,"onUpdate:modelValue":e[25]||(e[25]=d=>o.documentoItem.codigoCSTIPI=d),opcoes:o.impostoCstIpi,tipo:"seletor",dense:"",outlined:"",rotulo:"CST IPI"},null,8,["modelValue","opcoes"])]),_:1}),a(i,{col:"12 sm4"},{default:t(()=>[a(u,{modelValue:o.documentoItem.valorBaseIpi,"onUpdate:modelValue":e[26]||(e[26]=d=>o.documentoItem.valorBaseIpi=d),onBlur:e[27]||(e[27]=d=>s.calcularImpostos("valorBaseIpi")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Base IPI"},null,8,["modelValue"])]),_:1}),a(i,{col:"12 sm4"},{default:t(()=>[a(u,{modelValue:o.documentoItem.percentualIpi,"onUpdate:modelValue":e[28]||(e[28]=d=>o.documentoItem.percentualIpi=d),onBlur:e[29]||(e[29]=d=>s.calcularImpostos("percentualIpi")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"IPI %"},null,8,["modelValue"])]),_:1}),a(i,{col:"12 sm4"},{default:t(()=>[a(u,{modelValue:o.documentoItem.valorIpi,"onUpdate:modelValue":e[30]||(e[30]=d=>o.documentoItem.valorIpi=d),onBlur:e[31]||(e[31]=d=>s.calcularImpostos("valorIpi")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Valor IPI"},null,8,["modelValue"])]),_:1})]),_:1})):T("",!0)]),_:1}),a(Po,{name:"tab2",class:"q-px-sm"},{default:t(()=>[o.exibirHistorico?(b(),D(Aa,{key:0,rows:o.historicoItem[o.documentoItem.idItem].fornecedores,columns:o.tabelaHistoricoItem.colunas,pagination:o.tabelaHistoricoItem.paginacao,"onUpdate:pagination":e[32]||(e[32]=d=>o.tabelaHistoricoItem.paginacao=d),"row-key":"index",class:"no-shadow text-left"},{body:t(d=>[a(Ha,{props:d},{default:t(()=>[a(J,{key:"fornecedor",props:d},{default:t(()=>[h(y(d.row.descricaoContatoFornecedor),1)]),_:2},1032,["props"]),a(J,{key:"dataCompra",props:d},{default:t(()=>[d.row.dataCompra!==""?(b(),O("span",ce,y(l.$filters.data(d.row.dataCompra)),1)):T("",!0)]),_:2},1032,["props"]),a(J,{key:"quantidade",props:d},{default:t(()=>[h(y(d.row.quantidade),1)]),_:2},1032,["props"]),a(J,{key:"valorCusto",props:d},{default:t(()=>[h(y(l.$filters.numero(d.row.valorCusto,2)),1)]),_:2},1032,["props"]),a(J,{key:"valorTotal",props:d},{default:t(()=>[h(y(l.$filters.numero(d.row.valorTotal,2)),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])):T("",!0)]),_:1}),a(Po,{name:"tab3",class:"q-px-sm"},{default:t(()=>[o.exibirEstoque?(b(),D(Aa,{key:0,rows:o.estoqueItem[o.documentoItem.idItem].estoques,columns:o.tabelaEstoqueItem.colunas,pagination:o.tabelaEstoqueItem.paginacao,"onUpdate:pagination":e[33]||(e[33]=d=>o.tabelaEstoqueItem.paginacao=d),"row-key":"index",class:"no-shadow text-left"},{body:t(d=>[a(Ha,{props:d},{default:t(()=>[a(J,{key:"empresa",props:d},{default:t(()=>[h(y(d.row.descricaoContatoEmpresa),1)]),_:2},1032,["props"]),a(J,{key:"tipoEstoque",props:d},{default:t(()=>[h(y(d.row.tipoEstoque),1)]),_:2},1032,["props"]),a(J,{key:"lote",props:d},{default:t(()=>[d.row.lote!==""?(b(),O("span",ue,y(d.row.lote),1)):T("",!0)]),_:2},1032,["props"]),a(J,{key:"quantidade",props:d},{default:t(()=>[h(y(d.row.saldo),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])):T("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),a(qo,{class:"bg-light q-pa-sm",bordered:""},{default:t(()=>[a(mo,null,{default:t(()=>[a($a),B(a(U,{onClick:s.fechar,label:"Cancelar",size:"md",flat:"","no-ripple":"",color:"tertiary",class:"q-mr-sm"},null,8,["onClick"]),[[K]]),a(U,{onClick:s.salvar,label:"Salvar",color:"primary","no-ripple":"",unelevated:""},null,8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}var fe=go(me,[["render",pe]]);const he={components:{Avatar:Qa,ModalEditarProdutoCompras:fe,ModalEditarProduto:oe,BadgeCopiarUid:Wa,PromptItemV2:Ga},data(){return{ehOrcamento:!0,adicionar:{modal:{value:!1,name:""}},dataPrevistaEntrega:"",horaPrevistaEntrega:"",contatos:{},compraOriginal:{},compra:{id:$utils.uuid(),codigoDocumento:null,tipo:"Compra",operacao:"Pedido de Compra",status:"Digita\xE7\xE3o",codigoEmpresa:null,descricaoEmpresa:"",numeroDocumentoEmpresa:"",codigoContato:null,descricaoContato:"",codigoContatoComprador:null,codigoContatoVendedor:null,idContatoComprador:null,dataHoraEmissao:new Date,tipoFrete:"CIF",tipoTransporte:null,idEmpresa:null,idContato:null,totalDesconto:0,totalPercentualDesconto:0,calcularTributacao:!0,totalComImposto:!0,naoGerarFinanceiro:!1,freteSeparado:!1,dataHoraPrevisto:null,valorBaseIcms:0,valorIcms:0,valorBaseIcmsSt:0,valorIcmsSt:0},compraItens:[],compraItensOriginal:[],produtos:[],condicoesDePagamento:[],formasDePagamento:[],visivel:!1,somenteLeitura:!1,condicaoPagamentoRules:[async()=>{const l=this.compra.condicaoPagamento;return/^[\d/]*$/.test(l)}],formaPagamentoRules:[async()=>{const l=this.compra.formaDePagamento;return/^[^\d\s][a-zA-Z\s]*[^\d\s]$/.test(l)}],erroDesconto:!1,erroFrete:!1,erroSeguro:!1,erroOutrasDespesas:!1,itensImagens:{},exibeInfNota:!1,documentoNovo:!1,valorTotalPagamento:0}},emits:["atualizar"],methods:{editarProduto(l){const e=this.produtos[l.idItem];this.$refs.ModalEditarProdutoCompras.mostrar(l,e)},removerItem(l){this.compraItens=this.compraItens.filter(e=>e.id!==l.id),this.calcularTotais()},fecharEdicaoProduto(l){const e=this.compraItens.findIndex(m=>m.id===l.id);this.compraItens[e]=$utils.clonarV2(l),this.calcularTotaisItem(e)},async atualizar({id:l}){var e,m,n,o,s,p,i;try{if(this.$q.loading.show(),(e=this.compra)!=null&&e.idEmpresa){const c=this.compra.idEmpresa||null;c&&!this.contatos[c]&&(this.contatos[c]=await $db.contato.le({id:c}))}if((m=this.compra)!=null&&m.idContato){const c=this.compra.idContato;this.contatos[c]||(this.contatos[c]=await $db.contato.le({id:c}))}if((n=this.compra)!=null&&n.idContatoComprador){const c=this.compra.idContatoComprador;this.contatos[c]||(this.contatos[c]=await $db.contato.le({id:c}))}if((o=this.compra)!=null&&o.idContatoVendedor){const c=this.compra.idContatoVendedor;this.contatos[c]||(this.contatos[c]=await $db.contato.le({id:c}))}if((s=this.compra)!=null&&s.idContatoTransportadora){const c=this.compra.idContatoTransportadora;this.contatos[c]||(this.contatos[c]=await $db.contato.le({id:c}))}this.compraItensOriginal=await $db.documentoItem.ler({idDocumento:(p=this.compra)==null?void 0:p.id}),this.compraItensImagens=$utils.clonarV2(this.compraItensOriginal),await this.processarImagem(this.compraItensImagens),this.compraItens=$utils.clonarV2(this.compraItensOriginal);for(let c in this.compraItens)this.produtos[this.compraItens[c].idItem]=await $db.item.leNew({id:this.compraItens[c].idItem});if(this.condicoesDePagamento=await $db.documentoCondicaoPagamento.ler({idDocumento:(i=this.compra)==null?void 0:i.id}),this.condicoesDePagamento.sort((c,u)=>{let g=new Date(c.dataVencimento),f=new Date(u.dataVencimento);return g-f}),this.valorTotalPagamento===0)for(const c of this.condicoesDePagamento)this.valorTotalPagamento=this.valorTotalPagamento+c.valor;this.compra.dataHoraPrevisto&&(this.dataPrevistaEntrega=this.compra.dataHoraPrevisto.slice(0,10),this.horaPrevistaEntrega=this.compra.dataHoraPrevisto.slice(11,16)),this.exibeInfNota=!0}catch(c){console.log(c.message)}finally{this.$q.loading.hide()}},verificarSeAlterouCampos(){return $utils.diferencaObjetos(this.compraOriginal,this.compra)},async salvar_click(){try{if(this.compra.idContato||(this.compra.idContato=$db.usuario.logado.id),this.dataPrevistaEntrega){const l=`${this.dataPrevistaEntrega} ${this.horaPrevistaEntrega||"00:00:00"}`;this.compra.dataHoraPrevisto=La.formatDate(l)}$q.loading.show(),await this.salvar(),this.$emit("atualizar",{aba:"Digita\xE7\xE3o"}),this.ocultarModal()}catch(l){$q.notifyError("Ocorreu um erro ao salvar",l)}finally{$q.loading.hide(),this.compra.operacao==="Pedido de Compra"?$q.notifyPositive("O Pedido de Compra foi salvo com sucesso."):this.compra.operacao==="Nota de Entrada"&&$q.notifyPositive("A Nota de Compra foi salva com sucesso.")}},async criar(){try{let l,e,m;if(e=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data,!(e.length>0)){this.$q.notify({message:"N\xE3o h\xE1 empresa configurada",timeout:0,type:"negative",closeBtn:!0});return}if(l=e[0],e.length>1){const n={ativo:!0,empresas:!0};if(l=await $g.promptContato.show({filtro:n,placeholder:"Selecione a empresa"}),!l){this.ocultarModal(),this.$q.notifyError("Empresa n\xE3o selecionada");return}}if(m=(await $erp().empresa.where({idContato:l.id}).toArray())[0],!m){this.ocultarModal(),this.$q.notifyError("Erro ao selecionar empresa");return}this.contatos[l.id]||(this.contatos[l.id]=await $db.contato.le({id:l.id})),this.compra.descricaoEmpresa=m.nome,this.compra.idEmpresa=m.idContato,this.compra.numeroDocumentoEmpresa=m.numeroDocumentoNacional,this.compra.codigoEmpresa=m.codigoContato,this.compra.dataHoraPrevisto=null,await this.abrirModalFornecedor(),this.exibeInfNota=!0,this.documentoNovo=!0}catch(l){console.log(l.message)}this.campanha={id:$utils.uuid(),descricao:"Descri\xE7\xE3o",dataHoraCriacao:$utils.dataAtual(),status:"Rascunho",tipo:"Whatsapp",mensagem:"Mensagem",idContato:$db.usuario.logado.id,responsavel:$db.usuario.logado.nome},this.campanhaContato=[],this.campanhaAnexo=[],this.campanhaOriginal={},this.visivel=!0,this.somenteLeitura=!1},async finalizar_click(){if(!this.compra.descricaoContato)return $q.notifyError("N\xE3o \xE9 permitido finalizar a compra sem informar o fornecedor!");if(this.compraItens.length===0){this.$q.notifyError("N\xE3o \xE9 permitido finalizar compra sem itens!");return}if(this.compra.totalDocumento!==this.condicoesDePagamento.map(l=>l.valor).reduce((l,e)=>l+e))return $q.notifyError("N\xE3o \xE9 permitido finalizar a compra se o valor Total difere da soma das parcelas!");if(this.compra.operacao==="Pedido de Compra")try{$q.dialog({title:"Gerar Financeiro",message:"Deseja gerar as provis\xF5es financeiras?",cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-primary",textColor:"white",flat:!0},persistent:!0}).onOk(async()=>{this.adicionar.modal.name="GerarFinanceiro",$q.loading.show(),this.compra.status="Finalizado",this.compra.dataHoraFinalizado=$utils.dataAtual(),await this.finalizarItens(),await this.salvar(),this.gerarFinanceiro(this.compra.id),this.$emit("atualizar",{aba:"Finalizado"}),this.ocultarModal(),$q.notifyPositive("Compra finalizada com sucesso!"),$q.notifyPositive("Provis\xF5es geradas no financeiro!")}).onCancel(async()=>{$q.loading.show(),this.compra.status="Finalizado",this.compra.dataHoraFinalizado=$utils.dataAtual(),await this.finalizarItens(),await this.salvar(),this.$emit("atualizar"),this.ocultarModal(),$q.notifyPositive("Compra finalizada com sucesso!")})}catch(l){$q.notifyError("Ocorreu um erro!",l)}finally{$q.loading.hide()}if(this.compra.operacao==="Nota de Entrada"){if(!this.compra.notaNumero)return $q.notifyError("N\xE3o \xE9 permitido finalizar a compra sem informar o n\xFAmero da Nota de Entrada!");if(!this.compra.notaSerie)return $q.notifyError("N\xE3o \xE9 permitido finalizar a compra sem informara s\xE9rie da Nota de Entrada!");if(!this.compra.naturezaOperacao)return $q.notifyError("N\xE3o \xE9 permitido finalizar a compra sem informar natureza de opera\xE7\xE3o da Nota de Entrada!");if(!this.compra.dataCompra)return $q.notifyError("N\xE3o \xE9 permitido finalizar a compra sem informar a data de compra da Nota de Entrada!");if(!this.compra.chaveAcesso)return $q.notifyError("N\xE3o \xE9 permitido finalizar a compra sem informar a chave de acesso da Nota de Entrada!");$q.loading.show();try{this.compra.dataHoraFinalizado=$utils.dataAtual(),this.compra.status="Finalizado",await this.finalizarItens()}catch(l){console.log(l.message())}await this.salvar(),this.gerarFinanceiro(this.compra.id),this.$emit("atualizar"),this.ocultarModal()}},async finalizarItens(){var l,e,m,n,o,s,p,i,c,u,g,f,I,d,V,v,r,C,w,k,_,A,q,H,X,j,co,to,lo,ro,z,G,$,uo,eo,po,io,xo,ko,No,To,zo,Uo,Bo,Mo,Oo,Ao,Ho,Lo,jo,Ro,Xo,Qo,Go,Zo,Wo,Jo,Ko,Yo,$o,oa,aa,ea,ta,la,ra,ia,sa,na,ma,da,ca,ua,pa,fa,ha,ga,va,Ia,ba,Ca,Va,_a,wa,ya,Da,Ea,Pa,Sa,Fa,qa,xa,ka,Na,Ta,za,Ua,Ba;try{const E=this.compraItens,_o=new Date;let wo=1,Ma=0,Oa=0,yo=!1;if(this.compra.totalProduto>0&&(this.compra.tipoFrete==="FOB"&&this.compra.freteSeparado===0&&(Ma=this.compra.valorFrete+this.compra.valorSeguro),wo=(this.compra.totalProduto+this.compra.valorOutrasDespesas-this.compra.totalDesconto+Ma)/this.compra.totalProduto),E.reduce((P,so)=>P+so.valorIcmsSt,Oa),Oa!==this.compra.valorIcmsSt&&(yo=!0),this.compra.operacao==="Nota de Entrada")for(let P in E){let so=$utils.clonarV2(E[P]),F=$utils.clonarV2(E[P]);F.status="Finalizado",F.dataCompra=_o,F.dataHoraFinalizado=_o,yo&&(F.valorIcmsSt=this.compra.valorIcmsSt*(((e=(l=E[P])==null?void 0:l.total)!=null?e:0)/(((m=this.compra)==null?void 0:m.totalProduto)>0?(n=this.compra)==null?void 0:n.totalProduto:1))),F.valorFreteRateado=((s=(o=this.compra)==null?void 0:o.valorFrete)!=null?s:0)*(((i=(p=E[P])==null?void 0:p.total)!=null?i:0)/((u=(c=this.compra)==null?void 0:c.totalProduto)!=null?u:1)),F.valorSeguroRateado=((f=(g=this.compra)==null?void 0:g.valorSeguro)!=null?f:0)*(((d=(I=E[P])==null?void 0:I.total)!=null?d:0)/((v=(V=this.compra)==null?void 0:V.totalProduto)!=null?v:1)),F.valorOutrasDespesasRateado=((r=this.compra.valorOutrasDespesas)!=null?r:0)*(((w=(C=E[P])==null?void 0:C.total)!=null?w:0)/((_=(k=this.compra)==null?void 0:k.totalProduto)!=null?_:1)),F.descontoTotalRateado=((A=this.compra.totalDesconto)!=null?A:0)*(((H=(q=E[P])==null?void 0:q.total)!=null?H:0)/((j=(X=this.compra)==null?void 0:X.totalProduto)!=null?j:1));let Do=0;((co=E[P])==null?void 0:co.valorIcmsSt)-((to=E[P])==null?void 0:to.valorIcms)>0&&(Do=((ro=(lo=E[P])==null?void 0:lo.valorIcmsSt)!=null?ro:0)-((G=(z=E[P])==null?void 0:z.valorIcms)!=null?G:0)),F.valorRealTotal=((uo=($=E[P])==null?void 0:$.total)!=null?uo:0)*wo+((po=(eo=E[P])==null?void 0:eo.valorIpi)!=null?po:0)+((xo=(io=E[P])==null?void 0:io.valorIcms)!=null?xo:0),F.valorRealTotalImpostos=((No=(ko=E[P])==null?void 0:ko.total)!=null?No:0)+F.valorFreteRateado+F.valorSeguroRateado+F.valorOutrasDespesasRateado-F.descontoTotalRateado+((zo=(To=E[P])==null?void 0:To.valorIpi)!=null?zo:0)+((Bo=(Uo=E[P])==null?void 0:Uo.valorIcmsSt)!=null?Bo:0),F.valorReal=F.valorRealTotalImpostos/((Oo=(Mo=E[P])==null?void 0:Mo.quantidade)!=null?Oo:1),F.valorCustoReposicao=(Lo=(Ho=await $db.item.leNew({id:(Ao=E[P])==null?void 0:Ao.idItem}))==null?void 0:Ho.valorCustoReposicao)!=null?Lo:0,await $db.documentoItem.grava({original:so,atual:F})}if(this.compra.operacao==="Pedido de Compra")for(let P in E){let so=$utils.clonarV2(E[P]),F=$utils.clonarV2(E[P]);F.status="Finalizado",F.dataHoraFinalizado=_o,yo&&(F.valorIcmsSt=this.compra.valorIcmsSt*(((Ro=(jo=E[P])==null?void 0:jo.total)!=null?Ro:0)/(((Xo=this.compra)==null?void 0:Xo.totalProduto)>0?(Qo=this.compra)==null?void 0:Qo.totalProduto:1))),F.valorFreteRateado=((Zo=(Go=this.compra)==null?void 0:Go.valorFrete)!=null?Zo:0)*(((Jo=(Wo=E[P])==null?void 0:Wo.total)!=null?Jo:0)/((Yo=(Ko=this.compra)==null?void 0:Ko.totalProduto)!=null?Yo:1)),F.valorSeguroRateado=((oa=($o=this.compra)==null?void 0:$o.valorSeguro)!=null?oa:0)*(((ea=(aa=E[P])==null?void 0:aa.total)!=null?ea:0)/((la=(ta=this.compra)==null?void 0:ta.totalProduto)!=null?la:1)),F.valorOutrasDespesasRateado=((ra=this.compra.valorOutrasDespesas)!=null?ra:0)*(((sa=(ia=E[P])==null?void 0:ia.total)!=null?sa:0)/((ma=(na=this.compra)==null?void 0:na.totalProduto)!=null?ma:1)),F.descontoTotalRateado=((da=this.compra.totalDesconto)!=null?da:0)*(((ua=(ca=E[P])==null?void 0:ca.total)!=null?ua:0)/((fa=(pa=this.compra)==null?void 0:pa.totalProduto)!=null?fa:1));let Do=0;((ha=E[P])==null?void 0:ha.valorIcmsSt)-((ga=E[P])==null?void 0:ga.valorIcms)>0&&(Do=((Ia=(va=E[P])==null?void 0:va.valorIcmsSt)!=null?Ia:0)-((Ca=(ba=E[P])==null?void 0:ba.valorIcms)!=null?Ca:0)),F.valorRealTotal=((_a=(Va=E[P])==null?void 0:Va.total)!=null?_a:0)*wo+((ya=(wa=E[P])==null?void 0:wa.valorIpi)!=null?ya:0)+((Ea=(Da=E[P])==null?void 0:Da.valorIcms)!=null?Ea:0),F.valorRealTotalImpostos=((Sa=(Pa=E[P])==null?void 0:Pa.total)!=null?Sa:0)+F.valorFreteRateado+F.valorSeguroRateado+F.valorOutrasDespesasRateado-F.descontoTotalRateado+((qa=(Fa=E[P])==null?void 0:Fa.valorIpi)!=null?qa:0)+((ka=(xa=E[P])==null?void 0:xa.valorIcmsSt)!=null?ka:0),F.valorReal=F.valorRealTotalImpostos/((Ta=(Na=E[P])==null?void 0:Na.quantidade)!=null?Ta:1),F.valorCustoReposicao=(Ba=(Ua=await $db.item.leNew({id:(za=E[P])==null?void 0:za.idItem}))==null?void 0:Ua.valorCustoReposicao)!=null?Ba:0,await $db.documentoItem.grava({original:so,atual:F})}}catch(E){console.log(E.message)}},async enviar_click(){if(this.compra.operacao==="Pedido de Compra")try{$q.loading.show();const l=this.compraItens,e=(await $db.itemFornecedor.ler()).filter(m=>m.idContato===this.compra.idContato);for(let m in l){const n=l[m];if(!e.map(o=>o.idItem).includes(n.idItem)){const o={id:$utils.uuid(),idItem:n.idItem,idContato:this.compra.idContato,referencia:"",descricao:n.descricaoItem};await $db.itemFornecedor.gravar({atual:o,original:{}})}}this.compra.status="Digita\xE7\xE3o",this.compra.dataHoraFinalizado="",this.compra.operacao="Nota de Entrada",this.salvar(),this.$emit("atualizar"),this.ocultarModal(),this.$router.push({name:"Nota de Entrada",params:{id:this.compra.id}})}catch(l){$q.notifyError("Ocorreu um erro!",l)}finally{$q.loading.hide()}},async mostrar({id:l}){var e,m;this.visivel=!0,l&&(this.compraOriginal=await $db.documento.ler({id:l}),this.compra=$utils.clonarV2(this.compraOriginal),this.compra.totalComImposto=!0,this.compra.calcularTributacao=(e=this.compra.calcularTributacao)!=null?e:!0,this.compra.naoGerarFinanceiro=(m=this.compra.naoGerarFinanceiro)!=null?m:!1),await this.atualizar({id:l})},fechar(){this.$router.replace({params:{id:""}}),this.compra.status==="Finalizado"?this.$emit("atualizar",{aba:"Finalizado"}):this.$emit("atualizar",{aba:"Digita\xE7\xE3o"}),this.ocultarModal(),this.dataPrevistaEntrega="",this.horaPrevistaEntrega="",this.compraOriginal={},this.compraItens=[],this.produtos=[],this.compra={id:$utils.uuid(),codigoDocumento:null,tipo:"Compra",operacao:"Pedido de Compra",status:"Digita\xE7\xE3o",codigoEmpresa:null,descricaoEmpresa:"",numeroDocumentoEmpresa:"",codigoContato:null,descricaoContato:"",codigoContatoComprador:null,codigoContatoVendedor:null,idContatoComprador:null,dataHoraEmissao:new Date,tipoFrete:"CIF",tipoTransporte:null,idEmpresa:null,idContato:null,calcularTributacao:!0,totalComImposto:!0,naoGerarFinanceiro:!1,freteSeparado:!1},this.condicoesDePagamento=[],this.formasDePagamento=[],this.exibeInfNota=!1,this.documentoNovo=!1,this.valorTotalPagamento=0},ocultarModal(){this.$router.replace({params:{id:""}}),this.visivel=!1},async abrirModalEmpresa(){const l={ativo:!0,empresas:!0},e=await $g.promptContato.show({filtro:l,placeholder:"Selecione"});if(!e)return;let m=(await $erp().empresa.where({idContato:e.id}).toArray())[0];if(!m){this.ocultarModal(),this.$q.notifyError("Erro ao selecionar empresa");return}this.contatos[e.id]||(this.contatos[e.id]=await $db.contato.le({id:e.id})),this.compra.descricaoEmpresa=m.nome,this.compra.idEmpresa=m.idContato,this.compra.codigoEmpresa=m.codigoContato,this.compra.numeroDocumentoEmpresa=m.numeroDocumentoNacional},async abrirModalComprador(){const l=await this.selecionarContato({placeholder:"Selecione o comprador",filtro:{ativo:!0,compradores:!0}});l.id&&(this.compra.idContatoComprador=l.id),this.contatos[l.id]||(this.contatos[l.id]=await $db.contato.le({id:l.id}))},async abrirModalFornecedor(){const l=await this.selecionarContato({placeholder:"Selecione o fornecedor",filtro:{ativo:!0}});l.id&&(this.compra.idContato=l.id,this.compra.codigoContato=l.codigoContato,this.compra.descricaoContato=l.apelido),this.contatos[l.id]||(this.contatos[l.id]=await $db.contato.le({id:l.id}))},async abrirModalVendedor(){const l=(await $db.contato.leFilhos(this.compra.idContato)).map(m=>m.id),e=await this.selecionarContato({placeholder:"Selecione o vendedor",filtro:{ativo:!0,usuarios:l}});e.id&&(this.compra.idContatoVendedor=e.id),this.contatos[e.id]||(this.contatos[e.id]=await $db.contato.le({id:e.id}))},async abrirModalTransportador(){const l=await this.selecionarContato({placeholder:"Selecione o transportadora",filtro:{ativo:!0,transportadoras:!0}});l.id&&(this.compra.idContatoTransportadora=l.id),this.contatos[l.id]||(this.contatos[l.id]=await $db.contato.le({id:l.id}))},async selecionarContato(l){const{placeholder:e,filtro:m}={placeholder:"Selecione o contato",filtro:{ativo:!0},...l},n=await $g.promptContato.show({filtro:m,placeholder:e});if(!n)throw new Error("Contato n\xE3o selecionado");return n},async adicionarItem(){let l={},e=[];for(const m of e)l[m.idItem]={item:await $erp().item.get(m.idItem)||{},quantidade:m.quantidade};this.adicionar.modal.value=!0,this.adicionar.modal.name="Item"},async selecionarItens(l){var e,m,n;for(const o in l){let s=await $db.estoqueSaldoProdutoEmpresa.le({idEmpresa:this.compra.idEmpresa,tipoEstoque:"Dispon\xEDvel",idItem:o});s=s[0];const p=await $db.configuracoes.porNome("vendas.checaestoque",this.compra.idEmpresa);Number((e=p.find(V=>V.id))==null?void 0:e.valor);const i=l[o].item||{},c=l[o].quantidade||0,u=(m=(i==null?void 0:i.valorCustoReposicao)||(s==null?void 0:s.valorCustoMedio))!=null?m:0;let g=this.compraItens.find(V=>V.idItem===o);const f=(await $erp().cfop.where({cfop:5102}).toArray())[0],I=(await $erp().configuracoes.where({nome:"financeiro.planocontas.comprageral"}).toArray())[0],d=(await $erp().financeiroPlanoConta.where({codigoFinanceiroPlanoConta:Number(I==null?void 0:I.valor)}).toArray())[0];if(g)g.quantidade=$utils.arredondar(c,4),g.quantidadeRealizado=$utils.arredondar(c,4),g.subTotal=$utils.arredondar(c*u,2),g.total=$utils.arredondar(c*u,2);else{let V={dataHoraEmissao:$utils.dataAtual(),dataHoraFinalizado:"",descricaoItem:i.descricao,id:$utils.uuid(),idDocumento:this.compra.id,idItem:i.id,codigoItem:i.codigoItem,referencia:i.referencia,operacao:"Compra de Mercadoria",operacaoFator:1,idCfop:f==null?void 0:f.id,idPlanoContaEstoque:d==null?void 0:d.id,quantidade:$utils.arredondar(c,4),quantidadeRealizado:$utils.arredondar(c,4),status:"Digita\xE7\xE3o",tipoItem:i.tipo,subTotal:$utils.arredondar(c*u,2),total:$utils.arredondar(c*u,2),unidade:i.unidade,valorCustoMedio:(n=s==null?void 0:s.valorCustoMedio)!=null?n:0,valorItem:u,valorOriginal:u};this.produtos[i.id]=await $db.item.leCompleto({id:i.id}),this.compraItens.push(V),await this.processarImagem(this.compraItens)}this.compra.subTotal=0,this.compra.subTotalProduto=0;for(let V in this.compraItens)this.compra.subTotal+=this.compraItens[V].total,this.compra.subTotalProduto+=this.compraItens[V].total;this.compra.subTotal=$utils.arredondar(this.compra.subTotal,2),this.compra.totalDocumento=this.compra.subTotal}},calcularTotaisItem(l,e){var g,f,I,d,V,v,r;const m=$utils.clonarV2(this.compraItens[l]),n=(g=m.valorOriginal)!=null?g:0,o=(f=m.quantidade)!=null?f:0;let s=(I=m.valorItem)!=null?I:0,p=(d=m.descontoPercentualItem)!=null?d:0,i=(V=m.descontoItem)!=null?V:0,c=(v=m.subTotal)!=null?v:0,u=(r=m.total)!=null?r:0;e==="descontoPercentualItem"&&((p<0||p>100)&&(p=0),i=s*p/100,c=s-i),e==="descontoItem"&&((i<0||i>s)&&(i=0),p=i/s*100,c=s-i),e==="valorItem"&&(s<n&&(s=n),i>s&&(i=0,p=0),c=s-i),e==="subTotal"&&((c<0||c>s)&&(c=s),i=s-c,p=i/s*100),u=o*c,m.valorItem=s,m.descontoItem=i,m.descontoPercentualItem=p,m.subTotal=c,m.total=u,this.compraItens[l]=m,this.calcularTotais()},calcularTotais(l){var v,r,C,w,k,_,A,q,H,X;const e=$utils.clonarV2(this.compra);let m=0,n=0,o=0,s=(v=e.totalDesconto)!=null?v:0,p=(r=e.totalPercentualDesconto)!=null?r:0,i=(C=e.valorFrete)!=null?C:0,c=(w=e.valorSeguro)!=null?w:0,u=(k=e.valorOutrasDespesas)!=null?k:0,g=0,f=0,I=0,d=0,V=0;this.erroFrete=!1,this.erroSeguro=!1,this.erroOutrasDespesas=!1;for(const j of this.compraItens)m+=j.total,g+=(_=j.valorBaseIcms)!=null?_:0,f+=(A=j.valorIcms)!=null?A:0,I+=(q=j.valorBaseIcmsSt)!=null?q:0,d+=(H=j.valorIcmsSt)!=null?H:0,V+=(X=j.valorIpi)!=null?X:0;l==="totalPercentualDesconto"&&(this.erroDesconto=!1,(p<0||p>100)&&(this.erroDesconto=!0),s=m*p/100),l==="totalDesconto"&&(this.erroDesconto=!1,(s<0||s>m)&&(this.erroDesconto=!0),p=s/m*100),i<0&&(this.erroFrete=!0),i=e.tipoFrete==="FOB"?i:0,c<0&&(this.erroSeguro=!0),c=e.tipoFrete==="FOB"?c:0,u<0&&(this.erroOutrasDespesas=!0),e.calcularTributacao||(g=0,f=0,I=0,d=0),e.totalComImposto||(V=0),n=m-s+i+c+u,o=n+V+d,e.valorBaseIcms=g,e.valorIcms=f,e.valorBaseIcmsSt=I,e.valorIcmsSt=d,e.valorIpi=V,e.totalDesconto=s,e.totalPercentualDesconto=p,e.subTotalProduto=m,e.subTotal=n,e.totalDocumento=o,this.compra=e},async salvar(){try{this.compra.totalComImposto&&delete this.compra.totalComImposto,await $db.documento.grava({original:this.compraOriginal,atual:this.compra}),await $db.documentoItem.remove(this.compraItensOriginal.filter(e=>!this.compraItens.find(m=>m.id===e.id)));for(const e of this.compraItens){const m=this.compraItensOriginal.find(n=>n.id===e.id);await $db.documentoItem.grava({original:m,atual:e})}const l=await $db.documentoCondicaoPagamento.ler({idDocumento:this.compra.id});for(const e of this.condicoesDePagamento){const m=l.find(o=>o.id===e.id),n=$utils.clonarV2(e);await $db.documentoCondicaoPagamento.grava({original:$utils.clonarV2(m),atual:n})}for(const e of l)this.condicoesDePagamento.some(n=>n.id===e.id)||await $db.documentoCondicaoPagamento.remover(e.id);this.compra.totalComImposto=!0}catch(l){console.log(l.message)}},async retornarParaDigitacao(){$q.loading.show();try{if(this.compra.status!=="Finalizado")throw new Error("N\xE3o foi possivel reabrir o documento");this.compra.dataHoraFinalizado="",this.compra.status="Digita\xE7\xE3o",await this.retornarItensParaDigitacao(),await this.removerTitulosAPagar(),await this.salvar(),this.compraOriginal=$utils.clonarV2(this.compra),this.$q.notify({message:"A compra foi re-aberta para digita\xE7\xE3o",timeout:500,type:"positive"})}catch(l){console.log(l.message)}finally{$q.loading.hide()}},async removerTitulosAPagar(){try{const l=await $db.financeiroTitulo.le({documentoId:this.compra.id});await $db.financeiroTitulo.remove(l)}catch(l){console.log(l.message)}},async retornarItensParaDigitacao(){var l;try{const e=await $db.documentoItem.ler({idDocumento:(l=this.compra)==null?void 0:l.id});for(let m in e){let n=$utils.clonarV2(e[m]),o=$utils.clonarV2(e[m]);o.status="Digita\xE7\xE3o",o.dataHoraFinalizado="",await $db.documentoItem.grava({original:n,atual:o})}}catch(e){console.log(e.message)}},async alterarPagamento(l){try{const e=await $db.documentoCondicaoPagamento.ler({id:l==null?void 0:l.id});await $db.documentoCondicaoPagamento.grava({original:e,atual:l})}catch(e){console.log(e.message)}},async removerPagamento(l){try{this.condicoesDePagamento=this.condicoesDePagamento.filter(e=>e.id!==l.id),this.condicoesDePagamento.sort((e,m)=>{let n=new Date(e.dataVencimento),o=new Date(m.dataVencimento);return n-o}),await this.atualizaValorTotalPagamento({condicao:l,acao:"remover"})}catch(e){console.log(e.message)}},async gerarCondicoesDePagamento(){var l;try{let e=this.compra.id,m=this.compra.codigoDocumento,n=this.compra.condicaoPagamento,o=(l=this.compra.notaNumero)!=null?l:null;this.compra.naoGerarFinanceiro||await this.gerarParcelamento(e,n,o),this.compra.naoGerarFinanceiro&&(this.condicoesDePagamento=[])}catch(e){console.log(e.message)}finally{}},async gerarParcelamento(l,e,m){var g,f,I,d;this.condicoesDePagamento=[];const n=$utils.clonarV2(this.compra),o=e.split("/").length,s=!!(n!=null&&n.dataCompra)&&(n==null?void 0:n.dataCompra)!==""?n.dataCompra:!!(n!=null&&n.dataHoraPrevisto)&&(n==null?void 0:n.dataHoraPrevisto)!==""?n.dataHoraPrevisto:!!this.dataPrevistaEntrega&&this.dataPrevistaEntrega!==""?new Date(this.dataPrevistaEntrega):$utils.dataAtual(),p=(g=n==null?void 0:n.freteSeparado)!=null?g:0;let i=n==null?void 0:n.totalDocumento;if(p){const V=((f=n==null?void 0:n.valorFrete)!=null?f:0)+((I=n==null?void 0:n.valorSeguro)!=null?I:0);if((n==null?void 0:n.tipoFrete)==="FOB"&&V>0){let v={id:$utils.uuid(),codigoDocumento:n==null?void 0:n.codigoDocumento,idDocumento:n==null?void 0:n.id,dataVencimento:s,valor:V,observacao:"Valor Frete + Seguro",freteSeparado:!0};this.condicoesDePagamento.push(v),i-=V}}let c=0,u=i/o;for(let V in e.split("/")){let v=!!(n!=null&&n.dataCompra)&&(n==null?void 0:n.dataCompra)!==""?n.dataCompra:!!(n!=null&&n.dataHoraPrevisto)&&(n==null?void 0:n.dataHoraPrevisto)!==""?n.dataHoraPrevisto:!!this.dataPrevistaEntrega&&this.dataPrevistaEntrega!==""?new Date(this.dataPrevistaEntrega):$utils.dataAtual();typeof v=="string"&&(v=(d=new Date(v))!=null?d:$utils.dataAtual()),v.setDate(v.getDate()+parseInt(e.split("/")[V]));let r={id:$utils.uuid(),codigoDocumento:n==null?void 0:n.codigoDocumento,idDocumento:n==null?void 0:n.id,dataVencimento:La.formatDate(v),valor:u,observacao:""};this.condicoesDePagamento.push(r),c+=u!=null?u:0}i!==c&&(this.condicoesDePagamento[0].valor+=(i!=null?i:0)-(c!=null?c:0)),this.valorTotalPagamento=i},async gerarFinanceiro(l){var e,m,n;try{if(!l)throw new Error("idDocumento n\xE3o fornecido");const o=await $db.documento.ler({id:l});if(!o)throw new Error("N\xE3o foi poss\xEDvel obter o documento");const s=o.idEmpresa,p=o.idContato,i=(e=o.notaNumero)!=null?e:0,c=(m=o.observacaoFaturamento)!=null?m:"",u=new Date,g=o.totalDocumento,f=(await $db.configuracoes.le({nome:"financeiro.planocontas.comprageral"}))[0],I=await $db.financeiroPlanoConta.leV2({codigoFinanceiroPlanoConta:Number(f.valor)}),d=0;let V=(n=o.formadePagamento)!=null?n:"",v=`Provisionamento de pedido de compra ${o.observacaoFaturamento||""}`;i!==0&&(v=`${v} | Nota nro: ${i}`),V=`${V}`;let r=[],C=0,_=(await(await $db.documentoItem.ler({idDocumento:o.id})).filter(q=>q.idPlanoContaEstoque!==(I==null?void 0:I.id))).map(q=>{var H,X,j;return{idPlanoContaEstoque:(H=q==null?void 0:q.idPlanoContaEstoque)!=null?H:null,totalItem:((X=q.total)!=null?X:0)-((j=q.descontoTotalRateado)!=null?j:0)}});_=[...new Set(_.map(q=>q))];for(let q in _)if(r.some(H=>H.idPlanoContaEstoque===_[q].codigoPlanoContaEstoque)){let H=r.findIndex(X=>X.idPlanoContaEstoque===_[q].codigoPlanoContaEstoque);r[H].valor+=_[q].totalItem}else r.push({idPlanoContaEstoque:_[q].idPlanoContaEstoque,idPlanoContaDestino:"",valor:_[q].totalItem,porcentagem:0});r.length>0&&(r[0].porcentagem=$utils.arredondar(r[0].valor/g,4)),this.financeiroGerarNotaEntrada(o.id,o.operacao,c,0,d,g,p,V,u,o.codigoDocumento,"Pedido Compra",I,0,s,r);const A={atual:$utils.clonarV2(o),original:$utils.clonarV2(o)};A.atual.provisaoCompra=1,await $db.documento.grava({original:A.original,atual:A.atual})}catch(o){$q.notifyError(o)}},async financeiroGerarNotaEntrada(l,e,m,n,o,s,p,i,c,u,g,f,I,d,V){var v,r,C;try{if(!l)throw new Error("N\xE3o foi informado o Id do documento");if(!await $db.documento.ler({id:l}))throw new Error("N\xE3o foi possivel recuperar o documento");const k=await $db.configuracoes.le({nome:"financeiro.planocontas.freteaquisicao"}),_=await $db.financeiroTitulo.le({documentoId:l});let A=[];for(let z in _)_[z].dataPagamento&&A.push(_[z]);if(A.length>0)throw new Error("N\xE3o \xE9 poss\xEDvel regerar o Financeiro. Parcelas provisionadas j\xE1 pagas!");A.length<=0&&_.length>0&&await $db.financeiroTitulo.remove(_);const q=await $db.documentoCondicaoPagamento.ler({idDocumento:l});q.sort(function(z,G){return new Date(z.dataVencimento)-new Date(G.dataVencimento)});const H=q.length;for(let z in q){const G=(v=q[z].observacao)!=null?v:"",$={id:$utils.uuid(),idFinanceiroPlanoConta:G==="Valor Frete + Seguro"?k.id:f==null?void 0:f.id,codigoFinanceiroPlanoConta:G==="Valor Frete + Seguro"?k.valor:f==null?void 0:f.valor,dataEmissao:new Date,dataCompetencia:c,dataVencimento:q[z].dataVencimento,dataVencimentoOriginal:q[z].dataVencimento,valor:q[z].valor,valorMulta:0,percentualJuros:0,documentoId:l,documentoTipo:"Nota de Compra",parcela:`${Number(z)+1}/${H}`,descricao:e,observacao:`${G}`,documentoVinculado:1,receberPagar:n,valorDesconto:0,percentualDesconto:0,idEmpresa:d,idContato:((r=q[z])==null?void 0:r.freteSeparado)&&!!this.compra.idContatoTransportadora?this.compra.idContatoTransportadora:p,formaDePagamento:`Provis\xE3o Pedido - ${i}`};await $db.financeiroTitulo.grava({atual:$,original:{}})}let X=await $db.financeiroMovimentacao.le();X=X.map(z=>{var G;return(G=z==null?void 0:z.codigoFinanceiroMovimentacaoN)!=null?G:0});const j=((C=Math.max.apply(null,X))!=null?C:0)+1,co=await $db.configuracoes.le({nome:"financeiro.planocontas.comprageral"}),to=await $db.financeiroPlanoConta.le();let lo="",ro="";to.forEach(z=>{z.codigoFinanceiroPlanoConta===co[0].valor&&(lo=z.id,ro=z.descrContaCG)});for(let z in V){const G=V[z].idPlanoContaEstoque,$=V[z].porcentagem,uo={id:$utils.uuid(),codigoFinanceiroMovimentacaoN:j,idEmpresa:d,idFinanceiroPlanoConta:lo,dataEmissao:new Date,valorCredito:s*$,valorDebito:0,descricao:ro,observacao:"Contabiliza\xE7\xE3o automatica",automatico:0,liquidando:0,dataCompetencia:new Date,dataVencimento:new Date,dataMovimento:new Date,documentoTipo:g,documentoId:l};await $db.financeiroMovimentacao.grava({atual:uo,original:{}});let eo="";to.forEach(io=>{io.idFinanceiroPlanoConta===G&&(eo=io.descricao)});const po={id:$utils.uuid(),codigoFinanceiroMovimentacaoN:j,idEmpresa:d,codigoFinanceiroPlanoConta:eo,dataEmissao:new Date,valorCredito:0,valorDebito:s*$,descricao:eo,observacao:"Contabiliza\xE7\xE3o automatica",automatico:0,liquidando:0,dataCompetencia:new Date,dataVencimento:new Date,dataMovimento:new Date,documentoTipo:g,documentoId:l};await $db.financeiroMovimentacao.grava({atual:po,original:{}})}}catch(w){console.log(w.message)}},async processarImagem(l){if(!!l){for(const e of l)if(!this.itensImagens.hasOwnProperty(e.idItem)){const m=await $db.item.leCompleto({id:e.idItem});Object.keys(m.atual).length>0&&(m.atual.imagem===""||m.atual.imagem)?this.itensImagens[e.idItem]={imagem:m.atual.imagem}:Object.keys(m.original).length>0&&(m.original.imagem===""||m.original.imagem)&&(this.itensImagens[e.idItem]={imagem:m.original.imagem})}}},async atualizaValorTotalPagamento({condicao:l,acao:e}){!l||e==="remover"&&(this.valorTotalPagamento=this.valorTotalPagamento-l.valor)}},mounted(){}},ge={class:"row items-center"},ve={class:"col-auto"},Ie={class:"col-auto"},be={class:"u-container relative-position"};function Ce(l,e,m,n,o,s){const p=N("g-label"),i=N("g-col"),c=N("badge"),u=N("BadgeCopiarUid"),g=N("g-row"),f=N("avatar"),I=N("campo"),d=N("ModalEditarProduto"),V=N("ModalEditarProdutoCompras"),v=N("PromptItemV2");return b(),O(W,null,[a(Vo,{modelValue:o.visivel,"onUpdate:modelValue":e[34]||(e[34]=r=>o.visivel=r),persistent:"",maximized:"",onKeyup:Za(s.fechar,["esc"])},{default:t(()=>[a(vo,{container:"",class:"bg-light"},{default:t(()=>[a(Io,null,{default:t(()=>[a(mo,null,{default:t(()=>[a(U,{onClick:s.fechar,icon:"arrow_back",flat:"",round:"",dense:""},null,8,["onClick"]),a(bo,null,{default:t(()=>[h(y(o.compra.operacao),1)]),_:1}),B(a(U,{onClick:s.salvar_click,label:"Salvar",color:"white","text-color":"primary",unelevated:"",class:"q-ml-sm"},null,8,["onClick"]),[[Q,o.compra.status==="Digita\xE7\xE3o"]])]),_:1})]),_:1}),a(Co,{class:"u-container"},{default:t(()=>[a(g,{gutter:"md",mg:"md",bg:"bg-white"},{default:t(()=>[a(i,{col:"12 sm12 md6"},{default:t(()=>[a(g,{items:"center",justify:"end",class:"hideondesktop"},{default:t(()=>[a(i,{col:"xs-shrink",order:"1 sm0"},{default:t(()=>[B(a(p,{text:"caption",icon:"mdi-calendar-today sm tertiary left",tip:`Emitido \xE1s ${l.$filters.hora(o.compra.dataHoraEmissao)}`},{default:t(()=>[h(y(l.$filters.data(o.compra.dataHoraEmissao)),1)]),_:1},8,["tip"]),[[Q,o.compra.dataHoraEmissao]])]),_:1}),a(i,{col:"xs-shrink",order:"1 sm0"},{default:t(()=>[B(a(p,{text:"caption",icon:"mdi-calendar-today sm tertiary left",tip:`Finalizado \xE1s ${l.$filters.hora(o.compra.dataHoraFinalizado)}`},{default:t(()=>[h(y(l.$filters.data(o.compra.dataHoraFinalizado)),1)]),_:1},8,["tip"]),[[Q,o.compra.dataHoraFinalizado]])]),_:1}),a(i,{col:"xs12 sm-shrink",order:"0 sm1",text:"right"},{default:t(()=>[a(c,{cor:o.compra.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:o.compra.status!=="Digita\xE7\xE3o",class:"q-ml-sm"},{default:t(()=>[h(y(o.compra.status),1)]),_:1},8,["cor","escuro"]),o.compra.numero?(b(),D(u,{key:0,cor:"positive",escuro:"",class:"q-ml-sm",id:o.compra.id,numero:o.compra.id.slice(-8)},null,8,["id","numero"])):(b(),D(u,{key:1,id:o.compra.id,numero:o.compra.id.slice(-8),cor:"positive",class:"q-ml-sm"},null,8,["id","numero"]))]),_:1})]),_:1}),a(g,null,{default:t(()=>[a(i,{col:"12 sm6"},{default:t(()=>[a(g,null,{default:t(()=>[a(i,{col:"xs-shrink"},{default:t(()=>[a(f,{imagem:(o.contatos[o.compra.idContato]||{}).imagem,rotulo:(o.contatos[o.compra.idContato]||{}).apelido,tamanho:"50"},null,8,["imagem","rotulo"])]),_:1}),a(i,{col:"xs"},{default:t(()=>[a(I,{modelValue:(o.contatos[o.compra.idContato]||{}).apelido,"onUpdate:modelValue":e[0]||(e[0]=r=>(o.contatos[o.compra.idContato]||{}).apelido=r),after:[{icon:"edit",handler(){s.abrirModalFornecedor()}}],disable:o.compra.status!=="Digita\xE7\xE3o",rotulo:"Fornecedor",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","after","disable"])]),_:1})]),_:1})]),_:1}),a(i,{col:"12 sm6"},{default:t(()=>[a(I,{modelValue:(o.contatos[o.compra.idContatoVendedor]||{}).apelido,"onUpdate:modelValue":e[1]||(e[1]=r=>(o.contatos[o.compra.idContatoVendedor]||{}).apelido=r),disable:o.compra.status!=="Digita\xE7\xE3o",after:[{icon:"edit",handler(){s.abrirModalVendedor()}}],rotulo:"Contato",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable","after"])]),_:1}),a(i,{col:"12 sm6"},{default:t(()=>[a(I,{modelValue:(o.contatos[o.compra.idEmpresa]||{}).apelido,"onUpdate:modelValue":e[2]||(e[2]=r=>(o.contatos[o.compra.idEmpresa]||{}).apelido=r),after:[{icon:"edit",handler(){s.abrirModalEmpresa()}}],disable:o.compra.status!=="Digita\xE7\xE3o",rotulo:"Empresa",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","after","disable"])]),_:1}),a(i,{col:"12 sm6"},{default:t(()=>[a(I,{modelValue:(o.contatos[o.compra.idContatoComprador]||{}).apelido,"onUpdate:modelValue":e[3]||(e[3]=r=>(o.contatos[o.compra.idContatoComprador]||{}).apelido=r),disable:o.compra.status!=="Digita\xE7\xE3o",after:[{icon:"edit",handler(){s.abrirModalComprador()}}],rotulo:"Comprador",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable","after"])]),_:1}),a(i,{col:"12 sm6"},{default:t(()=>[a(I,{modelValue:(o.contatos[o.compra.idContatoTransportadora]||{}).apelido,"onUpdate:modelValue":e[4]||(e[4]=r=>(o.contatos[o.compra.idContatoTransportadora]||{}).apelido=r),disable:o.compra.status!=="Digita\xE7\xE3o",after:[{icon:"edit",handler(){s.abrirModalTransportador()}}],rotulo:"Transportadora",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable","after"])]),_:1}),a(i,{col:"12 sm6"},{default:t(()=>[a(g,null,{default:t(()=>[a(i,{col:"7"},{default:t(()=>[a(So,{modelValue:o.dataPrevistaEntrega,"onUpdate:modelValue":e[5]||(e[5]=r=>o.dataPrevistaEntrega=r),disable:o.compra.status!=="Digita\xE7\xE3o",type:"date",label:"Data Prevista de Entrega",clearable:"",dense:"","stack-label":"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable"])]),_:1}),a(i,{col:"5"},{default:t(()=>[a(So,{modelValue:o.horaPrevistaEntrega,"onUpdate:modelValue":e[6]||(e[6]=r=>o.horaPrevistaEntrega=r),disable:o.compra.status!=="Digita\xE7\xE3o",type:"time",label:"Hora Prevista de Entrega",clearable:"",dense:"","stack-label":"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(i,{col:"12 sm12 md6"},{default:t(()=>[a(g,{justify:"end",items:"center",text:"right",class:"hideonmobile"},{default:t(()=>[a(i,{col:"12"},{default:t(()=>[a(c,{cor:o.compra.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:o.compra.status!=="Digita\xE7\xE3o",class:"q-ml-sm"},{default:t(()=>[h(y(o.compra.status),1)]),_:1},8,["cor","escuro"]),o.compra.numero?(b(),D(c,{key:0,cor:"positive",escuro:"",class:"q-ml-sm"},{default:t(()=>[h("#"+y(o.compra.numero.toString().padStart(6,"0")),1)]),_:1})):(b(),D(u,{key:1,id:o.compra.id,numero:o.compra.id.slice(-8),cor:"positive",class:"q-ml-sm"},null,8,["id","numero"]))]),_:1}),a(i,{col:"shrink"},{default:t(()=>[B(a(p,{text:"caption",icon:"mdi-calendar-today sm tertiary left",tip:`Emitido \xE1s ${l.$filters.hora(o.compra.dataHoraEmissao)}`},{default:t(()=>[h(y(l.$filters.data(o.compra.dataHoraEmissao)),1)]),_:1},8,["tip"]),[[Q,o.compra.dataHoraEmissao]])]),_:1}),a(i,{col:"shrink"},{default:t(()=>[B(a(p,{text:"caption",icon:"mdi-calendar sm tertiary left",tip:`Finalizado \xE1s ${l.$filters.hora(o.compra.dataHoraFinalizado)}`},{default:t(()=>[h(y(l.$filters.data(o.compra.dataHoraFinalizado)),1)]),_:1},8,["tip"]),[[Q,o.compra.dataHoraFinalizado]])]),_:1})]),_:1}),a(g,null,{default:t(()=>[a(i,null,{default:t(()=>[a(I,{modelValue:o.compra.observacao,"onUpdate:modelValue":e[7]||(e[7]=r=>o.compra.observacao=r),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",tipo:"textoArea",rotulo:"Observa\xE7\xE3o",rows:"4"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})]),_:1})]),_:1}),a(g,{gutter:"md",mg:"md",bg:"bg-white"},{default:t(()=>[o.exibeInfNota?(b(),D(ae,{key:0,"default-opened":o.compra.notaNumero>0||o.documentoNovo,"header-class":"q-px-sm",class:"notaEntrada g-col col-12"},{header:t(()=>[a(S,null,{default:t(()=>[a(p,{text:"sub1 medium",icon:"mdi-file-replace sm tertiary left"},{default:t(()=>[h("Nota de Entrada")]),_:1})]),_:1})]),default:t(()=>[a(i,{col:"12"},{default:t(()=>[a(g,null,{default:t(()=>[a(i,{col:"12 sm6 md3"},{default:t(()=>[a(I,{modelValue:o.compra.notaNumero,"onUpdate:modelValue":e[8]||(e[8]=r=>o.compra.notaNumero=r),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Numero",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),a(i,{col:"12 sm6 md3"},{default:t(()=>[a(I,{modelValue:o.compra.notaSerie,"onUpdate:modelValue":e[9]||(e[9]=r=>o.compra.notaSerie=r),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Serie",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),a(i,{col:"12 sm6 md3"},{default:t(()=>[a(I,{modelValue:o.compra.naturezaOperacao,"onUpdate:modelValue":e[10]||(e[10]=r=>o.compra.naturezaOperacao=r),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Natureza da Opera\xE7\xE3o",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),a(i,{col:"12 sm6 md3"},{default:t(()=>[a(I,{modelValue:o.compra.dataCompra,"onUpdate:modelValue":e[11]||(e[11]=r=>o.compra.dataCompra=r),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Data compra",tipo:"data",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),a(i,{col:"12"},{default:t(()=>[a(I,{modelValue:o.compra.chaveAcesso,"onUpdate:modelValue":e[12]||(e[12]=r=>o.compra.chaveAcesso=r),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Chave",dense:""},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})]),_:1})]),_:1},8,["default-opened"])):T("",!0)]),_:1}),a(g,{gutter:"md",mg:"md",bg:"bg-white"},{default:t(()=>[a(i,{col:"12"},{default:t(()=>[a(p,{text:"sub1 medium",icon:"shopping_cart sm tertiary left"},{default:t(()=>[h("Carrinho "),a(U,{onClick:e[13]||(e[13]=r=>s.adicionarItem()),disable:o.compra.status!=="Digita\xE7\xE3o",icon:"add",label:"Produto",size:"md",color:"primary",flat:"",dense:"",class:"float-right q-px-sm"},null,8,["disable"])]),_:1})]),_:1}),(b(!0),O(W,null,ao(o.compraItens,(r,C)=>(b(),D(i,{col:"12",key:C},{default:t(()=>[a(Y,{class:"full-width"},{default:t(()=>[a(R,{class:"q-px-none"},{default:t(()=>{var w;return[a(S,{avatar:"",class:"col-auto"},{default:t(()=>[a(f,{imagem:(o.itensImagens[r.idItem]||{}).imagem,rotulo:r.descricaoItem,tamanho:"50"},null,8,["imagem","rotulo"])]),_:2},1024),a(S,{class:"q-px-none"},{default:t(()=>[a(M,null,{default:t(()=>[h(y(r.descricaoItem),1)]),_:2},1024),a(M,{caption:""},{default:t(()=>{var k,_;return[h(y((_=(k=o.produtos[r.idItem])==null?void 0:k.marca)!=null?_:""),1)]}),_:2},1024)]),_:2},1024),B(a(S,{avatar:""},{default:t(()=>[a(c,{denso:""},{default:t(()=>{var k,_;return[h(y((_=(k=o.produtos[r.idItem])==null?void 0:k.referencia)!=null?_:""),1)]}),_:2},1024)]),_:2},1536),[[Q,(w=o.produtos[r.idItem])==null?void 0:w.referencia]]),a(S,{avatar:""},{default:t(()=>[x("div",ge,[x("div",ve,[a(U,{color:"primary",dense:"",flat:"",icon:"edit",round:"",onClick:k=>s.editarProduto(r),disable:o.compra.status!=="Digita\xE7\xE3o"},null,8,["onClick","disable"])]),x("div",Ie,[a(U,{color:"tertiary",dense:"",flat:"",icon:"delete",round:"",onClick:k=>s.removerItem(r),disable:o.compra.status!=="Digita\xE7\xE3o"},{default:t(()=>[a(Z,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[h("Remover Item")]),_:1})]),_:2},1032,["onClick","disable"])])])]),_:2},1024)]}),_:2},1024)]),_:2},1024),a(g,null,{default:t(()=>[a(i,{col:"4 md"},{default:t(()=>[a(I,{dense:"",align:"left",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"",rotulo:"Valor do produto",modelValue:r.valorItem,"onUpdate:modelValue":w=>r.valorItem=w,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",onBlur:w=>s.calcularTotaisItem(C,"valorItem")},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),_:2},1024),a(i,{col:"4 md"},{default:t(()=>[a(g,{items:"center"},{default:t(()=>[a(i,{col:"shrink"},{default:t(()=>[a(L,{name:"mdi-minus",color:"primary"})]),_:1}),a(i,{col:"xs"},{default:t(()=>[a(I,{dense:"",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",rotulo:"Desconto percentual",modelValue:r.descontoPercentualItem,"onUpdate:modelValue":w=>r.descontoPercentualItem=w,outlined:"",suffix:"%","somente-leitura":o.compra.status!=="Digita\xE7\xE3o",onBlur:w=>s.calcularTotaisItem(C,"descontoPercentualItem")},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(i,{col:"4 md"},{default:t(()=>[a(I,{dense:"",tipo:"decimal",modelValue:r.descontoItem,"onUpdate:modelValue":w=>r.descontoItem=w,decimals:"4",zerosDireita:"2",outlined:"",rotulo:"Desconto em reais",prefix:"R$",onBlur:w=>s.calcularTotaisItem(C,"descontoItem"),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","onBlur","somente-leitura"])]),_:2},1024),a(i,{col:"6 md"},{default:t(()=>[a(g,{items:"center"},{default:t(()=>[a(i,{col:"shrink",class:"hideonmobile"},{default:t(()=>[a(L,{name:"mdi-equal",color:"primary"})]),_:1}),a(i,{col:"xs"},{default:t(()=>[a(I,{dense:"",outlined:"",opcoes:{maximumValue:10,minimumValue:0},rotulo:"Subtotal",tipo:"decimal",decimals:"4",zerosDireita:"2",modelValue:r.subTotal,"onUpdate:modelValue":w=>r.subTotal=w,onBlur:w=>s.calcularTotaisItem(C,"subTotal"),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","onBlur","somente-leitura"])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(i,{col:"6 md"},{default:t(()=>[a(g,{items:"center"},{default:t(()=>[a(i,{col:"shrink"},{default:t(()=>[a(L,{name:"mdi-close",color:"primary"})]),_:1}),a(i,{col:"xs"},{default:t(()=>[a(I,{dense:"",max:"100",min:"0",outlined:"",modelValue:r.quantidade,"onUpdate:modelValue":w=>r.quantidade=w,decimals:"4",zerosDireita:"0",tipo:"quantidade",onBlur:w=>s.calcularTotaisItem(C),disable:o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","onBlur","disable"]),a(Z,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[h("Quantidade")]),_:1})]),_:2},1024)]),_:2},1024)]),_:2},1024),a(i,{col:"12 md"},{default:t(()=>[a(g,{items:"center"},{default:t(()=>[a(i,{col:"shrink",class:"hideonmobile"},{default:t(()=>[a(L,{name:"mdi-equal",color:"primary"})]),_:1}),a(i,{col:"xs"},{default:t(()=>[a(I,{dense:"",tipo:"decimal",decimals:"2",rotulo:"Total","somente-leitura":!0,modelValue:r.total,"onUpdate:modelValue":w=>r.total=w,outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),a(i,{col:"12"},{default:t(()=>[a(g,{gutter:"md",mg:"md-y",justify:"end",items:"center",bg:"bg-light","rounded-borders":"","min-height":"49px"},{default:t(()=>[a(i,{col:"3 sm2 md-shrink",text:"bold"},{default:t(()=>[h(" Calcular ")]),_:1}),a(i,{col:"9 sm10 md"},{default:t(()=>[a(oo,{modelValue:o.compra.calcularTributacao,"onUpdate:modelValue":[e[14]||(e[14]=r=>o.compra.calcularTributacao=r),s.calcularTotais],"checked-icon":"check",color:"green","unchecked-icon":"clear",disable:o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),a(i,{col:"6 md-shrink"},{default:t(()=>[h(" Base ICMS ")]),_:1}),a(i,{col:"6 md",text:"right"},{default:t(()=>[a(I,{dense:"",outlined:"",decimals:"2",zerosDireita:"2",tipo:"decimal",modelValue:o.compra.valorBaseIcms,"onUpdate:modelValue":e[15]||(e[15]=r=>o.compra.valorBaseIcms=r),somenteLeitura:o.compra.calcularTributacao||o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somenteLeitura"])]),_:1}),a(i,{col:"6 md-shrink"},{default:t(()=>[h(" Valor ICMS ")]),_:1}),a(i,{col:"6 md",text:"right"},{default:t(()=>[a(I,{dense:"",outlined:"",modelValue:o.compra.valorIcms,"onUpdate:modelValue":e[16]||(e[16]=r=>o.compra.valorIcms=r),decimals:"2",zerosDireita:"2",tipo:"decimal",somenteLeitura:o.compra.calcularTributacao||o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somenteLeitura"])]),_:1}),a(i,{col:"6 md-shrink"},{default:t(()=>[h(" Base ICMS ST ")]),_:1}),a(i,{col:"6 md",text:"right"},{default:t(()=>[a(I,{dense:"",outlined:"",modelValue:o.compra.valorBaseIcmsSt,"onUpdate:modelValue":e[17]||(e[17]=r=>o.compra.valorBaseIcmsSt=r),decimals:"2",zerosDireita:"2",tipo:"decimal",somenteLeitura:o.compra.calcularTributacao||o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somenteLeitura"])]),_:1}),a(i,{col:"6 md-shrink"},{default:t(()=>[h(" ICMS ST ")]),_:1}),a(i,{col:"6 md",text:"right"},{default:t(()=>[a(I,{dense:"",outlined:"",modelValue:o.compra.valorIcmsSt,"onUpdate:modelValue":e[18]||(e[18]=r=>o.compra.valorIcmsSt=r),decimals:"2",zerosDireita:"2",tipo:"decimal",somenteLeitura:o.compra.calcularTributacao||o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somenteLeitura"])]),_:1})]),_:1}),a(g,{mg:"lg-t",justify:"end"},{default:t(()=>[a(i,{col:"xs12 sm8 md4"},{default:t(()=>[a(g,{items:"center"},{default:t(()=>[a(i,{col:"3",text:"bold"},{default:t(()=>[h(" Subtotal ")]),_:1}),a(i,{col:"xs",text:"right bold"},{default:t(()=>[h(y(l.$filters.numero(o.compra.subTotalProduto,2)),1)]),_:1})]),_:1}),a(Fo,{class:"q-mb-md q-mt-xs"}),a(g,{items:"center"},{default:t(()=>[a(i,{col:"xs3"},{default:t(()=>[h(" Desconto ")]),_:1}),a(i,{col:"xs"},{default:t(()=>[a(I,{tipo:"decimal",decimals:"2",modelValue:o.compra.totalPercentualDesconto,"onUpdate:modelValue":e[19]||(e[19]=r=>o.compra.totalPercentualDesconto=r),onBlur:e[20]||(e[20]=r=>s.calcularTotais("totalPercentualDesconto")),suffix:"%",error:o.erroDesconto,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","error","somente-leitura"])]),_:1}),a(i,{col:"xs"},{default:t(()=>[a(I,{tipo:"decimal",decimals:"2",modelValue:o.compra.totalDesconto,"onUpdate:modelValue":e[21]||(e[21]=r=>o.compra.totalDesconto=r),onBlur:e[22]||(e[22]=r=>s.calcularTotais("totalDesconto")),error:o.erroDesconto,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","error","somente-leitura"])]),_:1})]),_:1}),a(g,{items:"center"},{default:t(()=>[a(i,{col:"xs3"},{default:t(()=>[h(" Frete ")]),_:1}),a(i,{col:"xs"},{default:t(()=>[a(ja,{class:"q-mr-md",label:"CIF",val:"CIF",modelValue:o.compra.tipoFrete,"onUpdate:modelValue":[e[23]||(e[23]=r=>o.compra.tipoFrete=r),s.calcularTotais],dense:"",disable:o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","disable"]),a(ja,{label:"FOB",val:"FOB",modelValue:o.compra.tipoFrete,"onUpdate:modelValue":[e[24]||(e[24]=r=>o.compra.tipoFrete=r),s.calcularTotais],dense:"",disable:o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),a(i,{col:"xs"},{default:t(()=>[a(I,{tipo:"decimal",decimals:"2",modelValue:o.compra.valorFrete,"onUpdate:modelValue":e[25]||(e[25]=r=>o.compra.valorFrete=r),onBlur:s.calcularTotais,error:o.erroFrete,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onBlur","error","somente-leitura"])]),_:1})]),_:1}),a(g,{items:"center"},{default:t(()=>[a(i,{col:"xs3"},{default:t(()=>[h(" Seguro ")]),_:1}),a(i,{col:"xs"},{default:t(()=>[a(I,{tipo:"decimal",decimals:"2",modelValue:o.compra.valorSeguro,"onUpdate:modelValue":e[26]||(e[26]=r=>o.compra.valorSeguro=r),onBlur:s.calcularTotais,error:o.erroSeguro,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onBlur","error","somente-leitura"])]),_:1})]),_:1}),a(g,{items:"center"},{default:t(()=>[a(i,{col:"xs5"},{default:t(()=>[h(" Outras despesas ")]),_:1}),a(i,{col:"xs"},{default:t(()=>[a(I,{tipo:"decimal",decimals:"2",modelValue:o.compra.valorOutrasDespesas,"onUpdate:modelValue":e[27]||(e[27]=r=>o.compra.valorOutrasDespesas=r),onBlur:s.calcularTotais,error:o.erroOutrasDespesas,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onBlur","error","somente-leitura"])]),_:1})]),_:1}),a(Fo,{class:"q-mt-md q-mb-xs"}),a(g,{items:"center"},{default:t(()=>[a(i,{col:"xs4",text:"bold"},{default:t(()=>[h(" Total ")]),_:1}),a(i,{col:"xs",text:"right bold"},{default:t(()=>[h(y(l.$filters.numero(o.compra.subTotal,2)),1)]),_:1})]),_:1}),o.compra.totalComImposto?(b(),D(g,{key:0,items:"center"},{default:t(()=>[a(i,{col:"xs4",text:"bold"},{default:t(()=>[h(" Total IPI ")]),_:1}),a(i,{col:"xs",text:"right bold"},{default:t(()=>[h(y(l.$filters.numero(o.compra.valorIpi,2)),1)]),_:1})]),_:1})):T("",!0),o.compra.totalComImposto?(b(),D(g,{key:1,items:"center"},{default:t(()=>[a(i,{col:"xs4",text:"bold"},{default:t(()=>[h(" Total ICMS ST ")]),_:1}),a(i,{col:"xs",text:"right bold"},{default:t(()=>[h(y(l.$filters.numero(o.compra.valorIcmsSt,2)),1)]),_:1})]),_:1})):T("",!0),a(g,{items:"center"},{default:t(()=>[a(i,{col:"xs5",text:"bold"},{default:t(()=>[h(" Total c/ Impostos ")]),_:1}),a(i,{col:"xs-shrink"},{default:t(()=>[a(oo,{disable:o.compra.status!=="Digita\xE7\xE3o",modelValue:o.compra.totalComImposto,"onUpdate:modelValue":[e[28]||(e[28]=r=>o.compra.totalComImposto=r),s.calcularTotais],"checked-icon":"check",color:"green","unchecked-icon":"clear"},null,8,["disable","modelValue","onUpdate:modelValue"])]),_:1}),a(i,{col:"xs",text:"right bold"},{default:t(()=>[h(y(l.$filters.numero(o.compra.totalDocumento,2)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(g,{gutter:"md",mg:"md",bg:"bg-white"},{default:t(()=>[a(i,{col:"12"},{default:t(()=>[a(p,{text:"sub1 medium",icon:"credit_card sm tertiary left"},{default:t(()=>[h("Faturar")]),_:1})]),_:1}),a(i,{col:"12"},{default:t(()=>[a(I,{modelValue:o.compra.observacaoFaturamento,"onUpdate:modelValue":e[29]||(e[29]=r=>o.compra.observacaoFaturamento=r),tipo:"textoArea",rotulo:"Observa\xE7\xE3o faturamento",rows:"5"},null,8,["modelValue"])]),_:1}),a(i,{col:"12"},{default:t(()=>[a(ee,{ref:"formAdicionarPagamento"},{default:t(()=>[a(g,{mg:"md-y",items:"center"},{default:t(()=>[a(i,{col:"12 sm6 md"},{default:t(()=>[a(I,{modelValue:o.compra.formadePagamento,"onUpdate:modelValue":e[30]||(e[30]=r=>o.compra.formadePagamento=r),rules:o.formaPagamentoRules,ajuda:"Exemplo: Boleto","somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Forma de pagamento",tipo:"text"},null,8,["modelValue","rules","somente-leitura"])]),_:1}),a(i,{col:"12 sm6 md"},{default:t(()=>[a(I,{modelValue:o.compra.condicaoPagamento,"onUpdate:modelValue":e[31]||(e[31]=r=>o.compra.condicaoPagamento=r),rules:o.condicaoPagamentoRules,ajuda:"Exemplo: 28/56/64","somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Cond. Pag",tipo:"numero"},null,8,["modelValue","rules","somente-leitura"])]),_:1}),a(i,{col:"12 sm4 md",text:"bold",class:"q-my-sm"},{default:t(()=>[h(" Frete Separado "),a(oo,{modelValue:o.compra.freteSeparado,"onUpdate:modelValue":[e[32]||(e[32]=r=>o.compra.freteSeparado=r),s.calcularTotais],disable:o.compra.status!=="Digita\xE7\xE3o",dense:"",class:"q-ml-sm"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),a(i,{col:"12 sm4 md",text:"bold",class:"q-my-sm"},{default:t(()=>[h(" N\xE3o gerar financeiro "),a(oo,{modelValue:o.compra.naoGerarFinanceiro,"onUpdate:modelValue":[e[33]||(e[33]=r=>o.compra.naoGerarFinanceiro=r),s.calcularTotais],disable:o.compra.status!=="Digita\xE7\xE3o",dense:"",class:"q-ml-sm"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),a(i,{col:"12 sm4 md",text:"center"},{default:t(()=>[a(U,{onClick:s.gerarCondicoesDePagamento,disable:o.compra.status!=="Digita\xE7\xE3o",color:"positive",icon:"add",label:"Forma de pagamento",outline:"",size:"sm"},null,8,["onClick","disable"])]),_:1})]),_:1})]),_:1},512)]),_:1}),a(i,{col:"12"},{default:t(()=>[B(a(p,{text:"sub1 medium"},{default:t(()=>[h("Condi\xE7\xF5es de pagamento")]),_:1},512),[[Q,o.condicoesDePagamento.length>0]]),(b(!0),O(W,null,ao(o.condicoesDePagamento,r=>(b(),D(Y,{highlight:"",class:"q-pa-none",key:r.id},{default:t(()=>[a(g,{gutter:"md",mg:"sm-y",items:"center",bordered:"","rounded-borders":""},{default:t(()=>[a(i,{col:"xs6 md-shrink"},{default:t(()=>[a(I,{modelValue:r.dataVencimento,"onUpdate:modelValue":C=>r.dataVencimento=C,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Data vencimento",tipo:"data",dense:""},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024),a(i,{col:"xs6 md2"},{default:t(()=>[a(I,{modelValue:r.valor,"onUpdate:modelValue":C=>r.valor=C,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",align:"left",rotulo:"Valor",decimals:"2",zerosDireita:"2",tipo:"decimal"},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024),a(i,{col:"xs-grow"},{default:t(()=>[a(I,{modelValue:r.observacao,"onUpdate:modelValue":C=>r.observacao=C,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",tipo:"text",rotulo:"Observa\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024),a(i,{col:"xs-shrink",text:"right"},{default:t(()=>[a(U,{onClick:C=>s.removerPagamento(r),icon:"delete",round:"",dense:"",flat:"",color:"tertiary",disable:o.compra.status!=="Digita\xE7\xE3o"},null,8,["onClick","disable"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),o.valorTotalPagamento>0?(b(),D(g,{key:0,mg:"sm-t"},{default:t(()=>[a(i,{col:"xs-shrink",text:"bold"},{default:t(()=>[h(" Valor total: "+y(l.$filters.numero(o.valorTotalPagamento,2)),1)]),_:1})]),_:1})):T("",!0)]),_:1})]),_:1})]),_:1}),a(qo,{class:"bg-light q-pa-sm text-right u-bordaCima"},{default:t(()=>[x("div",be,[B(a(U,{class:"q-ml-sm",color:"primary",unelevated:"",label:"Finalizar",type:"submit",onClick:s.finalizar_click},null,8,["onClick"]),[[Q,o.compra.status==="Digita\xE7\xE3o"]]),B(a(U,{class:"q-ml-sm",color:"tertiary",flat:"",label:"Reabrir",type:"submit",onClick:s.retornarParaDigitacao},null,8,["onClick"]),[[Q,o.compra.status==="Finalizado"]]),B(a(U,{class:"q-ml-sm",color:"primary",unelevated:"",label:"Transformar em Nota de Compra",type:"submit",onClick:s.enviar_click},null,8,["onClick"]),[[Q,o.compra.status==="Finalizado"&&o.compra.operacao==="Pedido de Compra"]])])]),_:1})]),_:1})]),_:1},8,["modelValue","onKeyup"]),a(d,{ref:"modalEditarProduto",onSalvar:s.fecharEdicaoProduto},null,8,["onSalvar"]),a(V,{ref:"ModalEditarProdutoCompras",onSalvar:s.fecharEdicaoProduto},null,8,["onSalvar"]),a(v,{modelValue:o.adicionar.modal.value,"onUpdate:modelValue":e[35]||(e[35]=r=>o.adicionar.modal.value=r),habilitarQuantidade:!0,filtro:{ativo:!0,idEmpresa:o.compra.idEmpresa},exibirValorVenda:!1,calculaItemCusto:!0,onSelecionarItens:s.selecionarItens,ref:"promptItem"},null,8,["modelValue","filtro","onSelecionarItens"])],64)}var Ve=go(he,[["render",Ce]]);const _e={components:{PromptItemV2:Ga},data(){return{mostrarItemModal:!1,idxItem:0,compraOriginal:{},compra:{id:$utils.uuid(),codigoDocumento:null,tipo:"Compra",operacao:"Pedido de Compra",status:"Digita\xE7\xE3o",codigoEmpresa:null,descricaoEmpresa:"",numeroDocumentoEmpresa:"",codigoContato:null,descricaoContato:"",codigoContatoComprador:null,codigoContatoVendedor:null,idContatoComprador:null,dataHoraEmissao:new Date,tipoFrete:"CIF",tipoTransporte:null,idEmpresa:null,idContato:null,calcularTributacao:!1,totalComImposto:!1,naoGerarFinanceiro:!1,freteSeparado:!1},compraItens:[],produtos:[],visivel:!1,somenteLeitura:!1}},emits:["atualizar"],methods:{editarProduto(l,e,m){l.referencia=this.produtos[l.idItem].referencia,this.$refs.ModalEditarProdutoCompras.mostrar(l,e,m)},async atualizar({id:l}){try{this.$q.loading.show()}catch(e){console.log(e.message)}finally{this.$q.loading.hide()}},verificarSeAlterouCampos(){return $utils.diferencaObjetos(this.campanhaOriginal,this.campanha)},async mostrar({id:l}){this.visivel=!0,l&&(this.compraOriginal=await $db.documento.ler({id:l}),this.compra=$utils.clonarV2(this.compraOriginal)),await this.atualizar({id:l})},fechar(){this.$emit("atualizar"),this.visivel=!1},async selecionarItens(l){this.compraItens[this.idxItem].idItem=Object.keys(l)[0],this.compraItens[this.idxItem].itemAssociadoDescricao=l[Object.keys(l)[0]].item.descricao,this.compraItens[this.idxItem].itemCompra.idItem=Object.keys(l)[0];try{const e={id:$utils.uuid(),idItem:this.compraItens[this.idxItem].itemCompra.idItem,idContato:this.compra.idContato,referencia:this.compraItens[this.idxItem].referencia,descricao:this.compraItens[this.idxItem].descricaoItem};await $db.itemFornecedor.gravar({atual:e,original:{}}),await $db.documentoItem.grava({original:{},atual:this.compraItens[this.idxItem].itemCompra}),this.compraItens.splice(this.idxItem,1)}catch(e){console.log(e.error)}this.mostrarItemModal=!1},async recalcularItem(l){var p;let e=(p=this.compraItens[l].valorPreCusto)!=null?p:0,m=0,n=0,o=0,s=0;this.compraItens[l].ipi>0&&(m=e*(this.compraItens[l].ipi/100)),this.compraItens[l].st>0&&(n=e*(this.compraItens[l].st/100)),this.compraItens[l].difal>0&&(o=e*(this.compraItens[l].difal/100)),this.compraItens[l].valorCustoReposicao=e+m+n+o,this.compraItens[l].margemLucro>0&&(s=this.compraItens[l].valorCustoReposicao*(this.compraItens[l].margemLucro/100)),this.compraItens[l].percentualMarkup=this.compraItens[l].margemLucro,this.compraItens[l].valorVenda=this.compraItens[l].valorCustoReposicao+s},async addNovoItem(l,e){const m={id:$utils.uuid(),idContato:this.compra.idContato,descricao:l.descricaoItem,descricaoConcatenada:l.descricaoItem,referencia:"",codigoBarras:l.itemCompra.codigoBarras,ncm:l.itemCompra.ncm,codigoNCM:"",CEST:"",unidade:l.unidade,valorCustoReposicao:l.valorCustoReposicao,valorVenda:l.valorVenda,percentualMarkup:l.percentualMarkup},n={id:$utils.uuid(),idItem:m.id,idContato:this.compra.idContato,referencia:l.referencia,descricao:l.descricaoItem};try{const o=await $db.item.gravaItem({original:{},atual:m}),s=await $db.itemFornecedor.gravar({original:{},atual:n});l.itemCompra.itemId=m.id,await $db.documentoItem.grava({original:{},atual:l.itemCompra}),this.compraItens.splice(e,1)}catch(o){console.log(o.message)}},async finalizar_click(){console.log(this.compraItens.length),this.compraItens.length>0?$q.notifyError("Antes de continuar verifique todos os itens!"):(this.mostrarItemModal=!1,this.visivel=!1)}}},we={class:"layout-padding q-pa-none q-pb-md"},ye={class:"u-container"},De=x("p",{class:"q-my-none text-body1"},[h("Estes produtos n\xE3o foram identificados em seu banco de dados e constam no XML que est\xE1 importando."),x("br"),x("br"),h(" Cada produto deve ser vinculado a um j\xE1 cadastrado (atrav\xE9s do campo abaixo em cada um) ou criado atrav\xE9s do bot\xE3o [+ Novo] "),x("br"),x("br"),h(" Ao finalizar todos, o sistema ir\xE1 abrir a tela de Compras para terminar o processo. ")],-1),Ee=["id"],Pe={class:"col-12"},Se={class:"col-4 col-md"},Fe={class:"col-4 col-md"},qe={class:"col-4 col-md"},xe={class:"col-6 col-md"},ke={class:"col-12 col-md"},Ne={class:"col-6 col-md"},Te={class:"col-12 col-md"},ze={class:"col-12"},Ue={class:"col-12 col-md-4"},Be=x("div",{class:"col-12 col-md-auto"},"ou",-1),Me={class:"col-12 col-md-auto q-pl-none"},Oe={class:"u-container relative-position"};function Ae(l,e,m,n,o,s){const p=N("campo"),i=N("row"),c=N("PromptItemV2");return b(),O("div",null,[a(Vo,{modelValue:o.visivel,"onUpdate:modelValue":e[0]||(e[0]=u=>o.visivel=u),persistent:"",maximized:"",onKeyup:Za(s.fechar,["esc"])},{default:t(()=>[a(vo,{container:"",class:"bg-light"},{default:t(()=>[a(Io,null,{default:t(()=>[a(mo,null,{default:t(()=>[a(U,{icon:"arrow_back",flat:"",round:"",dense:"",onClick:s.fechar},null,8,["onClick"]),a(bo,null,{default:t(()=>[h("Importar XML x Cadastro")]),_:1})]),_:1})]),_:1}),a(Co,null,{default:t(()=>[x("div",we,[x("div",ye,[a(Ra,{class:"q-pa-md q-mt-md bg-transparent no-shadow"},{default:t(()=>[De]),_:1}),(b(!0),O(W,null,ao(o.compraItens,(u,g)=>(b(),D(Ra,{key:u.id,class:"q-pa-md q-mt-md bg-white no-shadow"},{default:t(()=>[x("div",{class:"items-carrinho items-center row q-py-sm",id:g},[a(Y,{class:"full-width"},{default:t(()=>[a(R,{class:"q-px-none"},{default:t(()=>[a(S,{class:"q-px-none"},{default:t(()=>[a(M,null,{default:t(()=>[a(p,{dense:"",align:"left",tipo:"texto",outlined:"",ajuda:"With placeholder",rotulo:"Descri\xE7\xE3o Item",modelValue:u.descricaoItem,"onUpdate:modelValue":f=>u.descricaoItem=f},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),a(S,null,{default:t(()=>[a(M,null,{default:t(()=>[a(p,{dense:"",align:"left",tipo:"texto",outlined:"",ajuda:"With placeholder",rotulo:"Marca",modelValue:u.marca,"onUpdate:modelValue":f=>u.marca=f},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),a(S,null,{default:t(()=>[a(M,null,{default:t(()=>[a(p,{dense:"",align:"left",tipo:"texto",outlined:"",ajuda:"With placeholder",rotulo:"Referencia",modelValue:u.referencia,"onUpdate:modelValue":f=>u.referencia=f},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),x("div",Pe,[a(i,{class:"q-col-gutter-sm"},{default:t(()=>[x("div",Se,[a(p,{dense:"",align:"left",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"",ajuda:"With placeholder",rotulo:"Valor pr\xE9 custo",modelValue:u.valorPreCusto,"onUpdate:modelValue":f=>u.valorPreCusto=f},null,8,["modelValue","onUpdate:modelValue"])]),x("div",Fe,[a(p,{dense:"",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",ajuda:"With placeholder",rotulo:"IPI",modelValue:u.ipi,"onUpdate:modelValue":f=>u.ipi=f,outlined:"",suffix:"%",onBlur:f=>s.recalcularItem(g)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),x("div",qe,[a(p,{dense:"",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",ajuda:"With placeholder",rotulo:"ST",modelValue:u.st,"onUpdate:modelValue":f=>u.st=f,outlined:"",suffix:"%",onBlur:f=>s.recalcularItem(g)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),x("div",xe,[a(p,{dense:"",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",ajuda:"With placeholder",rotulo:"DIFAL",modelValue:u.difal,"onUpdate:modelValue":f=>u.difal=f,outlined:"",suffix:"%",onBlur:f=>s.recalcularItem(g)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),x("div",ke,[a(p,{dense:"",align:"left",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"",ajuda:"With placeholder",rotulo:"Custo de reposi\xE7\xE3o",modelValue:u.valorCustoReposicao,"onUpdate:modelValue":f=>u.valorCustoReposicao=f},null,8,["modelValue","onUpdate:modelValue"])]),x("div",Ne,[a(p,{dense:"",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",ajuda:"With placeholder",rotulo:"Margem de Lucro",modelValue:u.margemLucro,"onUpdate:modelValue":f=>u.margemLucro=f,outlined:"",suffix:"%",onBlur:f=>s.recalcularItem(g)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),x("div",Te,[a(p,{dense:"",align:"left",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"",ajuda:"With placeholder",rotulo:"Valor de Venda",modelValue:u.valorVenda,"onUpdate:modelValue":f=>u.valorVenda=f},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1024)]),x("div",ze,[a(i,{class:"q-mt-lg text-right full-width justify-end items-center"},{default:t(()=>[x("div",Ue,[a(So,{debounce:500,modelValue:u.itemAssociadoDescricao,"onUpdate:modelValue":[f=>u.itemAssociadoDescricao=f,l.buscaCampo_change],placeholder:"Vincular produto",standout:"",filled:"",dense:"",clearable:"","clear-icon":"close",class:"items-center"},{append:t(()=>[a(L,{name:"search",onClick:()=>{o.mostrarItemModal=!o.mostrarItemModal,o.idxItem=g},class:"cursor-pointer text-tertiary"},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),Be,x("div",Me,[a(U,{class:"q-ml-sm no-shadow",color:"primary",icon:"add",unelevated:"",label:"Novo",type:"submit",onClick:f=>s.addNovoItem(u,g)},null,8,["onClick"])])]),_:2},1024)])],8,Ee)]),_:2},1024))),128))])])]),_:1}),a(qo,{class:"bg-light no-shadow q-pa-sm text-right u-bordaCima"},{default:t(()=>[x("div",Oe,[a(U,{class:"q-ml-sm no-shadow",color:"primary",icon:"send",unelevated:"",label:"Continuar",type:"submit",onClick:s.finalizar_click},null,8,["onClick"])])]),_:1})]),_:1})]),_:1},8,["modelValue","onKeyup"]),a(c,{modelValue:o.mostrarItemModal,"onUpdate:modelValue":e[1]||(e[1]=u=>o.mostrarItemModal=u),habilitarQuantidade:!0,filtro:{ativo:!0,idEmpresa:o.compra.idEmpresa},exibirValorVenda:!1,onSelecionarItens:s.selecionarItens,ref:"promptItem"},null,8,["modelValue","filtro","onSelecionarItens"])])}var He=go(_e,[["render",Ae]]);const ho={paginacao:{atual:1,maximo:1,total:1,limite:25},filtros:{numero:"",numeroCompra:null,termoBusca:"",periodoEmissao:{ini:"",fim:""},periodoFinalizado:{ini:"",fim:""},fornecedor:{id:"",nome:""}}},Le={components:{Avatar:Qa,BadgeCopiarUid:Wa,Ficha:Ve,ImportacaoXML:He,Lista:ne},data(){return{showPeriodo:!1,lista:[],tabsVertical:[],resultado:{},paginacao:$utils.clonarV2(ho.paginacao),filtros:$utils.clonarV2(ho.filtros),buscaCampo:"",tabSelecionada:{valor:"Digita\xE7\xE3o"},tabSelecionada2:{valor:"Pedido de Compra"},tabs:[{rotulo:"Digita\xE7\xE3o",value:"Digita\xE7\xE3o"},{rotulo:"Finalizado",value:"Finalizado"},{rotulo:"Todos",value:"Todos"}],tabs2:[{rotulo:"Pedido de Compra",value:"Pedido de Compra"},{rotulo:"Nota de Entrada",value:"Nota de Entrada"},{rotulo:"Nota no SEFAZ",value:"Nota no SEFAZ"}],xmlDevolucao:!1,modalXMLNotaEntrada:!1,xmlNotaEntrada:{},configImpressao:[],abrirNotadeEntrada:null}},props:{permissaoNovo:{default:!0,type:Boolean},corBotao:{default:()=>"primary",type:String}},methods:{importarXml_click(){this.modalXMLNotaEntrada=!0},adicionarXml(l){this.xmlNotaEntrada.arquivo=l[0]},async importarXmlNotaDeEntrada(l){try{const m=await(c=>new Promise((u,g)=>{const f=new FileReader;f.readAsBinaryString(c),f.onload=()=>u(f.result),f.onerror=I=>g(I)}))(this.xmlNotaEntrada.arquivo),n=new DOMParser,o=new XMLSerializer,s=n.parseFromString(m,"text/xml"),p=o.serializeToString(s),i=this;if(s.documentElement.nodeName==="html")throw new Error("Arquivo inv\xE1lido ou corrompido");await $db.compra.importaXml({xmlString:p,tela:i}),this.$q.notify({type:"positive",message:"Importa\xE7\xE3o realizada com sucesso"})}catch(e){this.$q.notifyError("Ocorreu erro ao importar o xml",e)}finally{this.modalXMLNotaEntrada=!1,this.atualizar()}},async atualizar(l){var e,m;try{let{buscarDadosRecentes:n}=l!=null?l:{};$q.loading.show();let o,s,p,i,c,u=["dataFinalizacao","dataHoraEmissao"],g=["desc","desc"];if(this.tabSelecionada2Anterior&&this.tabSelecionada2Anterior!==this.tabSelecionada2.valor&&(this.setOpcoesTabs(this.tabSelecionada2.valor),this.filtros=$utils.clonarV2(ho.filtros),this.paginacao=$utils.clonarV2(ho.paginacao),this.buscaCampo="",n=!0),(m=(e=this.$route)==null?void 0:e.params)!=null&&m.id||this.$router.replace({name:this.tabSelecionada2.valor}),this.tabSelecionada2Anterior=this.tabSelecionada2.valor,n&&(o=await $utils.localIDB.getItem({objectStore:"dadosRecentes",id:this.tabSelecionada2.valor}),o!=null&&o._id&&(this.filtros=o.filtros,this.buscaCampo=o.termoBusca,this.paginacao.limite=o.limit,this.paginacao.atual=o.page,u=o.sort,g=o.dir)),l!=null&&l.aba&&(this.tabSelecionada.valor=l.aba),s=$utils.eliminarVazios(this.filtros),p=this.buscaCampo,i=this.paginacao.limite,c=this.paginacao.atual,s.status=this.tabSelecionada.valor,s.operacao=this.tabSelecionada2.valor,this.showPeriodo=!1,this.tabsVertical=[],this.tabSelecionada.valor==="Todos"&&delete s.status,s.operacao==="Nota no SEFAZ"){let f=await $db.documentoFiscalEletronico.ler({tipo:"DFe",situacao:s.status});const I=[];f.forEach(V=>{const v={id:V.id,descricaoContato:V.xNomeEmitente,dataHoraEmissao:V.dataHoraEmissao,dataHoraFinalizado:null,totalDocumento:V.vNF,qtdeContatos:null,status:V.situacao};I.push(v)});let d=(c-1)*i;this.paginacao.total=I.length,this.paginacao.maximo=Math.ceil(this.paginacao.total/i)||1,this.lista=I.splice(d,i),this.configuraImpressao(this.filtros.idEmpresa)}if(s.operacao!=="Nota no SEFAZ"){let f=await $db.compra.le({filtros:s,termoBusca:p,limit:i,page:c,sort:u,dir:g});this.paginacao.total=f.total,this.paginacao.maximo=f.totalPages,this.lista=f.data}for(let f in this.lista)this.lista.hasOwnProperty(f)&&(this.lista[f].contato=await $db.contato.le({id:this.lista[f].idContato}));o={_id:this.tabSelecionada2.valor,tabSelecionada:this.tabSelecionada.valor,filtros:$utils.clonarV2(s),termoBusca:this.buscaCampo,limit:this.paginacao.limite,page:this.paginacao.atual,sort:["dataFinalizacao","dataHoraEmissao"],dir:["desc","desc"]},await $utils.localIDB.setItem({objectStore:"dadosRecentes",data:o}),this.configuraImpressao(this.filtros.idEmpresa)}catch(n){$q.notifyError("Erro iniciar",n)}finally{$q.loading.hide()}},async abrir(l){this.tabSelecionada2.valor!=="Nota no SEFAZ"&&(this.$router.replace({params:{id:l}}),this.$refs.modalFicha.mostrar({id:l}))},criar_click(){this.$refs.modalFicha.criar()},limparFiltros_click(){this.filtros.numero="",this.filtros.termoBusca="",this.filtros.numeroCompra="",this.filtros.periodoEmissao.ini="",this.filtros.periodoEmissao.fim="",this.filtros.periodoFinalizado.ini="",this.filtros.periodoFinalizado.fim="",this.filtros.fornecedor.id=null,this.filtros.fornecedor.nome="",this.atualizar()},async configuraImpressao(l){const e=await $db.configuracoes.porNome("impressao.compra",l);this.configImpressao=[...e.length?e.map(m=>({texto:"Imprimir Compra",...m})):[{valor:"invoice",texto:"Compras e Estoque"}]]},async consultarSefaz_click(){try{let l,e,m,n,o,s,p,i,c;if(e=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data,!(e.length>0)){this.$q.notify({message:"N\xE3o h\xE1 empresa configurada",timeout:0,type:"negative",closeBtn:!0});return}if(l=e[0],e.length>1){const w={ativo:!0,empresas:!0};if(l=await $g.promptContato.show({filtro:w,placeholder:"Selecione a empresa"}),!l){this.visivel=!1,this.$q.notifyError("Empresa n\xE3o selecionada");return}}if(m=(await $erp().empresa.where({idContato:l.id}).toArray())[0],!m){this.visivel=!1,this.$q.notifyError("Erro ao selecionar empresa");return}m&&(n=await $db.contatoEndereco.leEnderecoPrincipal(l.id),o=await $db.configuracoes.leValorComFiltroEmpresa("compras.sefaz.nsu",m.id),o||(o="0"));const u=m.numeroDocumentoNacional.match(/\d+/g).join("");for(;o.length<15;)o=`0${o}`;const f={xml:`<?xml version="1.0" encoding="utf-8"?><distDFeInt versao="1.01" xmlns="http://www.portalfiscal.inf.br/nfe"><tpAmb>2</tpAmb><cUFAutor>${n.ufCod}</cUFAutor><CNPJ>${u}</CNPJ><distNSU><ultNSU>${o}</ultNSU></distNSU></distDFeInt>`,cnpj:u,dataHora:new Date},d={id:$utils.uuid(),tipo:"DFe",situacao:"",tpAmb:1,dhEmi:new Date,dataHoraEmissao:new Date,dataHoraCriacao:new Date,cpfCnpjEmitente:u,xNomeEmitente:m.nome,json:JSON.stringify(f)}.json,V=new Headers;V.append("Content-Type","application/json; charset=utf-8"),p=await fetch("https://api.b15.com.br/integradorjs/dfe/consultar",{method:"POST",headers:V,body:JSON.stringify({dfe:d,aguardarRetorno:c})}),p=await p.json();const v=p.dfe.retDistDFeInt,r=p.err,C=p.arquivos;if(v!==""&&Number(v==null?void 0:v.ultNSU[0])>Number(o)){const w=await $db.configuracoes.atualizaPorNome("compras.sefaz.nsu",m.id,v.ultNSU[0])}if(C){let w=0;for(let k in C)try{const _=C[k],A={id:$utils.uuid(),tipo:"DFe",situacao:"N\xE3o Importada",tpAmb:_.nfeProc.NFe[0].infNFe[0].ide[0].tpAmb[0],mod:_.nfeProc.NFe[0].infNFe[0].ide[0].mod[0],serie:_.nfeProc.NFe[0].infNFe[0].ide[0].serie[0],nNF:_.nfeProc.NFe[0].infNFe[0].ide[0].nNF[0],chNFe:_.nfeProc.protNFe[0].infProt[0].chNFe[0],vNF:_.nfeProc.NFe[0].infNFe[0].total[0].ICMSTot[0].vNF[0],dhEmi:_.nfeProc.NFe[0].infNFe[0].ide[0].dhEmi[0],dataHoraEmissao:_.nfeProc.NFe[0].infNFe[0].ide[0].dhEmi[0],dataHoraCriacao:null,dataHoraAlteracao:null,cpfCnpjEmitente:_.nfeProc.NFe[0].infNFe[0].emit[0].CNPJ[0],xNomeEmitente:_.nfeProc.NFe[0].infNFe[0].emit[0].xNome[0],xFantEmitente:_.nfeProc.NFe[0].infNFe[0].emit[0].xNome[0],cpfCnpjDestinatario:_.nfeProc.NFe[0].infNFe[0].dest[0].CNPJ[0],xNomeDestinatario:_.nfeProc.NFe[0].infNFe[0].dest[0].xNome[0],xFantDestinatario:_.nfeProc.NFe[0].infNFe[0].dest[0].xNome[0],json:JSON.stringify({xml:_.xml}),naturezaOperacao:_.nfeProc.NFe[0].infNFe[0].ide[0].natOp[0]};(await $db.documentoFiscalEletronico.ler({tipo:"DFe"})).some(H=>H.chNFe===A.chNFe)||(await $db.documentoFiscalEletronico.grava({atual:A,original:{}}),w++)}catch(_){console.log(_.message)}this.$q.notify(`Importa\xE7\xE3o via SEFAZ Finalizada, ${w} Notas Importadas`)}}catch(l){console.log(l.message)}},setOpcoesTabs(l){l!=="Nota no SEFAZ"&&(this.tabs=[{rotulo:"Digita\xE7\xE3o",value:"Digita\xE7\xE3o"},{rotulo:"Finalizado",value:"Finalizado"},{rotulo:"Todos",value:"Todos"}],this.tabSelecionada.valor="Digita\xE7\xE3o"),l==="Nota no SEFAZ"&&(this.tabs=[{rotulo:"N\xE3o Importada",value:"N\xE3o Importada"},{rotulo:"Importada",value:"Importada"}],this.tabSelecionada.valor="N\xE3o Importada")},async downloadXmlDFe(l){const e=await $db.documentoFiscalEletronico.ler({tipo:"DFe",id:l}),m=JSON.parse(e.json).xml;if(m){const n=document.createElement("a"),o=new Blob([m],{type:"text/plain"});n.setAttribute("href",window.URL.createObjectURL(o)),n.setAttribute("download",`${e.chNFe}.xml`),n.dataset.downloadurl=["text/plain",n.download,n.href].join(":"),n.click()}m||this.$q.notifyError("N\xE3o foi poss\xEDvel recuperar o XML")},async importarXmlDFe(l){try{const e=await $db.documentoFiscalEletronico.ler({tipo:"DFe",id:l}),m=JSON.parse(e.json).xml;if(m){const n=new DOMParser,o=new XMLSerializer,s=n.parseFromString(m,"text/xml"),p=o.serializeToString(s),i=this;await $db.compra.importaXml({xmlString:p,tela:i});const c={original:$utils.clonarV2(e),atual:$utils.clonarV2(e)};c.atual.situacao="Importada",await $db.documentoFiscalEletronico.grava(c),$q.notify("XML Importado para Compras")}}catch(e){console.log(e.message),$q.notifyError("Erro ao importar XML",e)}}},watch:{$route(){var l;this.tabSelecionada2.valor=this.$route.name,this.atualizar({buscarDadosRecentes:!0}),this.$route.name==="Nota de Entrada"&&((l=this.$route.params)==null?void 0:l.id)&&this.$refs.modalFicha.mostrar({id:this.$route.params.id})}},async mounted(){this.tabSelecionada2.valor=this.$route.name,this.atualizar({buscarDadosRecentes:!0}),this.$route.name==="Nota de Entrada"&&this.$route.params.id&&this.$route.params.id.length&&this.$refs.modalFicha.mostrar({id:this.$route.params.id})}},je={class:"text-center"},Re={class:"row q-ma-md"},Xe={key:0,class:"row q-ma-md"},Qe={class:"certificado-error-messages"};function Ge(l,e,m,n,o,s){const p=N("campo"),i=N("badge"),c=N("BadgeCopiarUid"),u=N("avatar"),g=N("g-label"),f=N("g-col"),I=N("g-row"),d=N("Lista",!0),V=N("Ficha"),v=N("ImportacaoXML");return b(),O("div",null,[a(d,{titulo:"Compras",icone:"factory",buscaCampo:o.buscaCampo,"onUpdate:buscaCampo":e[9]||(e[9]=r=>o.buscaCampo=r),onFiltro_change:s.atualizar,onLimparFiltros_click:s.limparFiltros_click,onCriar_click:s.criar_click,onImportarXml_click:s.importarXml_click,onConsultarSefaz_click:s.consultarSefaz_click,lista:o.lista,paginacao:o.paginacao,filtros:o.filtros,tabSelecionada:o.tabSelecionada,tabs:o.tabs,tabSelecionada2:o.tabSelecionada2,tabs2:o.tabs2,tabsVertical:o.tabsVertical,showPeriodo:o.showPeriodo,checkboxVisible:!1,removerTodosVisible:!1,abrirTodosVisible:!1,exportarXLSXVisible:!1,showQuickAdd:!1,permissaoExtras:!1},{botaoNovo:t(()=>[B(a(U,{unelevated:"",icon:"add",label:"Novo",color:m.corBotao,"text-color":"white",class:"hideonmobile"},{default:t(()=>[a(fo,null,{default:t(()=>[a(Y,{link:"","no-border":"",separator:""},{default:t(()=>[B((b(),D(R,{clickable:"",onClick:s.criar_click},{default:t(()=>[a(S,{avatar:""},{default:t(()=>[a(L,{name:"add"})]),_:1}),a(S,null,{default:t(()=>[a(M,null,{default:t(()=>[h("Incluir Manual")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[K]]),B((b(),D(R,{clickable:"",onClick:s.importarXml_click},{default:t(()=>[a(S,{avatar:""},{default:t(()=>[a(L,{name:"add"})]),_:1}),a(S,null,{default:t(()=>[a(M,null,{default:t(()=>[h("Importar XML")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[K]])]),_:1})]),_:1})]),_:1},8,["color"]),[[Q,m.permissaoNovo]]),B(a(U,{unelevated:"",icon:"add",color:m.corBotao,round:"","text-color":"white",class:"hideondesktop"},{default:t(()=>[a(fo,null,{default:t(()=>[a(Y,{link:"","no-border":"",separator:""},{default:t(()=>[B((b(),D(R,{clickable:"",onClick:s.criar_click},{default:t(()=>[a(S,{avatar:""},{default:t(()=>[a(L,{name:"add"})]),_:1}),a(S,null,{default:t(()=>[a(M,null,{default:t(()=>[h("Incluir Manual")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[K]]),B((b(),D(R,{clickable:"",onClick:s.importarXml_click},{default:t(()=>[a(S,{avatar:""},{default:t(()=>[a(L,{name:"add"})]),_:1}),a(S,null,{default:t(()=>[a(M,null,{default:t(()=>[h("Importar XML")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[K]])]),_:1})]),_:1})]),_:1},8,["color"]),[[Q,m.permissaoNovo]])]),filtroCampos:t(()=>[o.tabsVertical.length<1?(b(),O(W,{key:0},[a(p,{modelValue:o.filtros.numero,"onUpdate:modelValue":e[0]||(e[0]=r=>o.filtros.numero=r),rotulo:"N\xBA Nota",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),a(p,{modelValue:o.filtros.termoBusca,"onUpdate:modelValue":e[1]||(e[1]=r=>o.filtros.termoBusca=r),rotulo:"Palavra Chave",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),a(p,{modelValue:o.filtros.numeroCompra,"onUpdate:modelValue":e[2]||(e[2]=r=>o.filtros.numeroCompra=r),rotulo:"Ordem de compra",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),a(p,{modelValue:o.filtros.fornecedor.nome,"onUpdate:modelValue":e[3]||(e[3]=r=>o.filtros.fornecedor.nome=r),rotulo:"Fornecedor",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),a(p,{modelValue:o.filtros.periodoEmissao.ini,"onUpdate:modelValue":e[4]||(e[4]=r=>o.filtros.periodoEmissao.ini=r),rotulo:"Data Emiss\xE3o",dense:"",tipo:"data",class:"q-field--with-bottom"},null,8,["modelValue"]),a(p,{modelValue:o.filtros.periodoEmissao.fim,"onUpdate:modelValue":e[5]||(e[5]=r=>o.filtros.periodoEmissao.fim=r),rotulo:"at\xE9",dense:"",tipo:"data",class:"q-field--with-bottom"},null,8,["modelValue"]),a(p,{modelValue:o.filtros.periodoFinalizado.ini,"onUpdate:modelValue":e[6]||(e[6]=r=>o.filtros.periodoFinalizado.ini=r),rotulo:"Data Finalizado",dense:"",tipo:"data",class:"q-field--with-bottom"},null,8,["modelValue"]),a(p,{modelValue:o.filtros.periodoFinalizado.fim,"onUpdate:modelValue":e[7]||(e[7]=r=>o.filtros.periodoFinalizado.fim=r),rotulo:"at\xE9",dense:"",tipo:"data",class:"q-field--with-bottom"},null,8,["modelValue"]),a(p,{modelValue:o.paginacao.limite,"onUpdate:modelValue":e[8]||(e[8]=r=>o.paginacao.limite=r),min:"1",rotulo:"Quantidade por p\xE1gina",dense:"",tipo:"quantidade",class:"q-field--with-bottom"},null,8,["modelValue"])],64)):T("",!0),o.tabsVertical.length>0?(b(),O(W,{key:1},[h(" N\xE3o possui filtros. ")],64)):T("",!0)]),itemLista:t(()=>[o.lista.length>0&&o.tabsVertical.length<1?(b(),D(Y,{key:0,bordered:"",class:"bg-white q-mb-xs rounded-borders",style:{"min-height":"calc(100vh - 200px)"}},{default:t(()=>[(b(!0),O(W,null,ao(o.lista,r=>(b(),O("div",{key:r.id,class:"itemHover"},[a(R,{"manual-focus":"",class:"q-py-sm q-px-xs items-center"},{default:t(()=>[a(S,{class:"hideonmobile col-auto q-px-sm no-margin"},{default:t(()=>[x("div",je,[r.numero?(b(),D(i,{key:0,cor:"positive",escuro:""},{default:t(()=>[h(" #"+y(r.numero.toString().padStart(6,"0")),1)]),_:2},1024)):(b(),D(c,{key:1,id:r.id,numero:r.id.slice(-8),cor:"tertiary",escuro:""},null,8,["id","numero"])),a(Z,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[h("N\xFAmero da Compra")]),_:1})])]),_:2},1024),a(S,{class:"col-md col-lg col-xl no-margin"},{default:t(()=>[a(R,{class:"q-pa-none"},{default:t(()=>[a(S,{onClick:C=>s.abrir(r.id),class:"col-auto items-center"},{default:t(()=>[a(u,{imagem:r.imagem,rotulo:r.descricaoContato,tamanho:"40",style:{display:"flex","align-self":"center"}},null,8,["imagem","rotulo"])]),_:2},1032,["onClick"]),a(S,{class:"col"},{default:t(()=>[a(M,{onClick:C=>s.abrir(r.id),lines:"2",class:"text-tertiary text-weight-bold ellipsis-2-lines"},{default:t(()=>[h(y(r.descricaoContato)+" ",1),a(Z,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[h("Fornecedor")]),_:1})]),_:2},1032,["onClick"]),a(R,{class:"q-pa-none hideonmobile",style:{"min-height":"unset"}},{default:t(()=>[r.notaNumero?(b(),D(i,{key:0,cor:"blue",class:"mw50 text-center",escuro:""},{default:t(()=>[h(y(r.notaNumero)+" ",1),a(Z,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[h("N\xFAmero da Nota")]),_:1})]),_:2},1024)):(b(),D(i,{key:1,cor:"warning",class:"mw50 text-center",escuro:""},{default:t(()=>[h(" S/N "),a(Z,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[h("N\xFAmero da Nota")]),_:1})]),_:1}))]),_:2},1024),a(S,{class:"hideondesktop q-mt-sm"},{default:t(()=>[a(I,{mg:"xs-b"},{default:t(()=>[r.dataHoraEmissao?(b(),D(f,{key:0,col:"shrink"},{default:t(()=>[a(g,{icon:"mdi-calendar-today xs tertiary left",tip:`Emitido \xE1s ${l.$filters.hora(r.dataHoraEmissao)}`},{default:t(()=>[h(y(l.$filters.data(r.dataHoraEmissao)),1)]),_:2},1032,["tip"])]),_:2},1024)):T("",!0),r.dataHoraFinalizado?(b(),D(f,{key:1,col:"shrink",class:"q-ml-sm"},{default:t(()=>[a(g,{icon:"mdi-calendar xs tertiary left",tip:`Finalizado \xE1s ${l.$filters.hora(r.dataHoraFinalizado)}`},{default:t(()=>[h(y(l.$filters.data(r.dataHoraFinalizado)),1)]),_:2},1032,["tip"])]),_:2},1024)):T("",!0)]),_:2},1024),a(I,{mg:"xs-b"},{default:t(()=>[r.numero?(b(),D(f,{key:0,col:"shrink"},{default:t(()=>[a(i,{rotulo:`#${r.numero.toString().padStart(6,"0")}`,cor:"positive",escuro:""},null,8,["rotulo"])]),_:2},1024)):(b(),D(f,{key:1,col:"shrink"},{default:t(()=>[a(c,{id:r.id,numero:r.id.slice(-8),cor:"tertiary",escuro:""},null,8,["id","numero"])]),_:2},1024)),a(f,{col:"shrink",class:"q-ml-sm"},{default:t(()=>[r.notaNumero?(b(),D(i,{key:0,cor:"blue",class:"mw50",escuro:""},{default:t(()=>[h(y(r.notaNumero)+" ",1),a(Z,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[h("N\xFAmero da Nota")]),_:1})]),_:2},1024)):(b(),D(i,{key:1,cor:"warning",class:"mw50",escuro:""},{default:t(()=>[h(" S/N "),a(Z,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[h("N\xFAmero da Nota")]),_:1})]),_:1}))]),_:2},1024),a(f,{col:"shrink",class:"q-ml-sm"},{default:t(()=>[a(i,{rotulo:r.status,cor:r.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:r.status!=="Digita\xE7\xE3o"},null,8,["rotulo","cor","escuro"])]),_:2},1024)]),_:2},1024),a(I,null,{default:t(()=>[a(f,{col:"shrink",text:"bold"},{default:t(()=>[h(y(l.$filters.numero(r.totalDocumento,2)),1)]),_:2},1024),B(a(f,{col:"grow",text:"center",class:"q-ml-sm"},{default:t(()=>[h(y(r.qtdeContatos)+" Itens ",1)]),_:2},1536),[[Q,r.qtdeContatos>0]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(S,{onClick:C=>s.abrir(r.id),class:"hideonmobile maxw110 q-pl-sm no-margin"},{default:t(()=>[r.dataHoraEmissao?(b(),D(M,{key:0,lines:"1",color:"tertiary",class:"ellipsis"},{default:t(()=>[a(L,{name:"mdi-calendar-today"}),h(" "+y(l.$filters.data(r.dataHoraEmissao))+" ",1),a(Z,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[h("Emitido \xE1s "+y(l.$filters.hora(r.dataHoraEmissao)),1)]),_:2},1024)]),_:2},1024)):T("",!0),r.dataHoraFinalizado?(b(),D(M,{key:1,lines:"1",color:"tertiary",class:"ellipsis"},{default:t(()=>[a(L,{name:"mdi-calendar"}),h(" "+y(l.$filters.data(r.dataHoraFinalizado))+" ",1),a(Z,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[h("Finalizado \xE1s "+y(l.$filters.hora(r.dataHoraFinalizado)),1)]),_:2},1024)]),_:2},1024)):T("",!0)]),_:2},1032,["onClick"]),a(S,{onClick:C=>s.abrir(r.id),class:"hideonmobile maxw90 q-pl-sm no-margin"},{default:t(()=>[a(i,{cor:r.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:r.status!=="Digita\xE7\xE3o",class:"col-auto q-mx-auto"},{default:t(()=>[h(y(r.status)+" ",1),a(Z,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[h("Status")]),_:1})]),_:2},1032,["cor","escuro"])]),_:2},1032,["onClick"]),a(S,{onClick:C=>s.abrir(r.id),class:"hideonmobile maxw120 q-pl-sm no-margin"},{default:t(()=>[a(M,{class:"text-tertiary text-weight-bold text-right"},{default:t(()=>[h(y(l.$filters.numero(r.totalDocumento,2)),1)]),_:2},1024),B(a(M,{class:"text-tertiary text-right"},{default:t(()=>[h(y(r.qtdeContatos)+" Itens ",1)]),_:2},1536),[[Q,r.qtdeContatos>0]])]),_:2},1032,["onClick"]),a(S,{class:"hideonmobile col-auto q-pl-sm no-margin"},{default:t(()=>[a(R,{class:"q-pa-none"},{default:t(()=>[o.tabSelecionada2.valor!=="Nota no SEFAZ"?(b(),D(S,{key:0,class:"q-pr-sm no-margin"},{default:t(()=>[a(U,{onClick:C=>s.abrir(r.id),icon:"edit",size:"md",color:"primary",round:"",flat:"",dense:""},null,8,["onClick"])]),_:2},1024)):T("",!0),o.tabSelecionada2.valor==="Nota no SEFAZ"&&o.tabSelecionada.valor==="N\xE3o Importada"?(b(),D(S,{key:1,class:"q-pr-sm no-margin"},{default:t(()=>[a(U,{onClick:C=>s.importarXmlDFe(r.id),icon:"mdi-upload",size:"md",flat:"",round:"",dense:"",color:"tertiary",class:"buttons"},{default:t(()=>[a(Z,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[h("Importar XML")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):T("",!0),o.tabSelecionada2.valor==="Nota no SEFAZ"?(b(),D(S,{key:2,class:"q-pr-sm no-margin"},{default:t(()=>[a(U,{onClick:C=>s.downloadXmlDFe(r.id),color:"tertiary",dense:"",flat:"",icon:"mdi-download",round:"",size:"md",class:"buttons"},{default:t(()=>[a(Z,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[h("Exportar XML")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):T("",!0),a(S,{class:"no-margin"},{default:t(()=>[a(U,{icon:"print",size:"md",color:"tertiary",round:"",flat:"",dense:""},{default:t(()=>[a(fo,null,{default:t(()=>[B((b(),D(Y,{link:"","no-border":"",separator:""},{default:t(()=>[(b(!0),O(W,null,ao(o.configImpressao.filter(C=>C.valor),C=>(b(),D(R,{key:C.valor,onClick:w=>l.$imprimir(C.valor,(r==null?void 0:r.id)||"0"),clickable:""},{default:t(()=>[a(S,{avatar:""},{default:t(()=>[a(L,{name:"print"})]),_:1}),a(S,null,{default:t(()=>[a(M,null,{default:t(()=>[h(y(C.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)),[[K]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(S,{class:"hideondesktop col-auto q-pl-sm no-margin"},{default:t(()=>[a(U,{icon:"more_vert",size:"md",color:"tertiary",round:"",flat:"",dense:""},{default:t(()=>[a(fo,null,{default:t(()=>[B((b(),D(Y,{link:"","no-border":"",separator:""},{default:t(()=>[o.tabSelecionada2.valor!=="Nota no SEFAZ"?(b(),D(R,{key:0,onClick:C=>s.abrir(r.id),clickable:"",class:"itemHover"},{default:t(()=>[a(S,{avatar:""},{default:t(()=>[a(L,{name:"edit"})]),_:1}),a(S,null,{default:t(()=>[a(M,null,{default:t(()=>[h(" Editar ")]),_:1})]),_:1})]),_:2},1032,["onClick"])):T("",!0),o.tabSelecionada2.valor==="Nota no SEFAZ"&&o.tabSelecionada.valor==="N\xE3o Importada"?(b(),D(R,{key:1,onClick:C=>s.importarXmlDFe(r.id),clickable:"",class:"itemHover"},{default:t(()=>[a(S,{avatar:""},{default:t(()=>[a(L,{name:"mdi-upload"})]),_:1}),a(S,null,{default:t(()=>[a(M,null,{default:t(()=>[h(" Importar XML ")]),_:1})]),_:1})]),_:2},1032,["onClick"])):T("",!0),o.tabSelecionada2.valor==="Nota no SEFAZ"?(b(),D(R,{key:2,onClick:C=>s.downloadXmlDFe(r.id),clickable:"",class:"itemHover"},{default:t(()=>[a(S,{avatar:""},{default:t(()=>[a(L,{name:"mdi-download"})]),_:1}),a(S,null,{default:t(()=>[a(M,null,{default:t(()=>[h(" Exportar XML ")]),_:1})]),_:1})]),_:2},1032,["onClick"])):T("",!0),(b(!0),O(W,null,ao(o.configImpressao.filter(C=>C.valor),C=>(b(),D(R,{key:C.valor,onClick:w=>l.$imprimir(C.valor,(r==null?void 0:r.id)||"0"),clickable:"",class:"itemHover"},{default:t(()=>[a(S,{avatar:""},{default:t(()=>[a(L,{name:"print"})]),_:1}),a(S,null,{default:t(()=>[a(M,null,{default:t(()=>[h(y(C.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)),[[K]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(Fo)]))),128))]),_:1})):T("",!0)]),_:1},8,["buscaCampo","onFiltro_change","onLimparFiltros_click","onCriar_click","onImportarXml_click","onConsultarSefaz_click","lista","paginacao","filtros","tabSelecionada","tabs","tabSelecionada2","tabs2","tabsVertical","showPeriodo"]),a(V,{ref:"modalFicha",onAtualizar:s.atualizar},null,8,["onAtualizar"]),a(v,{ref:"importacaoXML",onAtualizar:s.atualizar},null,8,["onAtualizar"]),a(Vo,{modelValue:o.modalXMLNotaEntrada,"onUpdate:modelValue":e[12]||(e[12]=r=>o.modalXMLNotaEntrada=r)},{default:t(()=>[a(vo,{container:"",class:"bg-light",style:{height:"40vh",width:"50vw","max-width":"100vw"}},{default:t(()=>[x("form",{onSubmit:e[11]||(e[11]=te(r=>l.tryLoading(s.importarXmlNotaDeEntrada),["prevent"]))},[a(Io,null,{default:t(()=>[a(mo,null,{default:t(()=>[B(a(U,{flat:"",round:"",dense:"",icon:"arrow_back"},null,512),[[K]]),a(bo,null,{default:t(()=>[h("Importar XML Nota de Entrada")]),_:1}),a(U,{color:"white","text-color":"primary",label:"Enviar",type:"submit",unelevated:""})]),_:1})]),_:1}),a(Co,{class:"u-container"},{default:t(()=>[a(Xa,null,{default:t(()=>{var r,C,w;return[x("div",Re,[a(le,{modelValue:o.xmlDevolucao,"onUpdate:modelValue":e[10]||(e[10]=k=>o.xmlDevolucao=k),label:"Devolu\xE7\xE3o"},null,8,["modelValue"]),a(re,{class:"col-12","hide-upload-btn":"","auto-upload":"",factory:s.adicionarXml,filter:k=>k.filter(_=>_.type==="text/xml")},null,8,["factory","filter"])]),Object.keys((w=(C=(r=o.xmlNotaEntrada.error)==null?void 0:r.data)==null?void 0:C.fields)!=null?w:{}).length?(b(),O("div",Xe,[x("ul",Qe,[(b(!0),O(W,null,ao(Object.keys(o.xmlNotaEntrada.error.data.fields),k=>(b(),O("li",{key:k},[x("span",null,y(k),1),x("span",null,y(o.xmlNotaEntrada.error.data.fields[k]),1)]))),128))])])):T("",!0)]}),_:1})]),_:1})],32)]),_:1})]),_:1},8,["modelValue"])])}var tt=go(Le,[["render",Ge]]);export{tt as default};
