import{_ as P,M as T,bZ as Q,p as D,o as i,i as m,w as a,f as e,x as f,B as G,E as B,ah as y,e as n,t as c,bc as V,C,b5 as W,j as h,l as _,k as I,am as F,ai as z,d as k,F as g,r as w,aj as b,ak as r,D as q,aF as N,L as x,s as R}from"./index.83d285ce.js";import{D as j}from"./DocumentosFiscais.84b0c1f5.js";import{M as K}from"./ModalHistoricoStatus.357f17c3.js";import{e as U}from"./emitirNFe.3ad8673b.js";const L={components:{Avatar:T,DocumentosFiscais:j,VendaModal:Q,ModalHistoricoStatus:K},computed:{config(){return $db.configuracoes.valores},podeMigrarFatura(){return!~["Aguardando Estoque","Aguardando Financeiro","Aguardando Aprova\xE7\xE3o","Aguardando Pagamento","Cancelado","N\xE3o Aprovado","Or\xE7amento","Faturado"].indexOf(this.dados.venda.status)}},data(){return{dbUsuario:$db.usuario,dados:{venda:{}},contatos:{},faturasAbertas:[],detalhesVisivel:!1,visibilidade:{botao:{editar:!1,remover:!1}},modalDevolucaoGarantia:{visivel:!1,item:{},orcamento:{}},sistemaPai:"",configImpressaoOrcamento:[],configImpressaoEnvelope:[],configImpressosWhatsapp:[],documentoItemKit:{}}},emits:["executar"],methods:{async duplicarVenda(){try{await new Promise((t,s)=>{this.$q.dialog({message:"Duplicar este pedido?",cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-primary",textColor:"white",flat:!0}}).onOk(()=>{t()}).onCancel(()=>{s()})})}catch{return}try{const t=await $db.venda.duplicarVenda(this.id);this.$refs.vendaModal.mostrar({id:t}),this.$q.notify({type:"positive",message:"Pedido duplicado"})}catch(t){let s="N\xE3o foi poss\xEDvel realizar a opera\xE7\xE3o";/^GError:.+/.test(t.message)&&(s=t.message.slice(7)),this.$q.notify({type:"negative",message:s}),console.error(t)}},irParaAtendimentoFatura(t){this.$router.push({name:"AtendimentoFatura",params:{id:t}})},async migrarFatura(t){try{await new Promise((s,u)=>{this.$q.dialog({message:"Esta a\xE7\xE3o ir\xE1 migrar esta venda para outra fatura.",noRefocus:!0,preventClose:!0,title:"Tem certeza?",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Continuar",push:!0,class:"bg-primary",textColor:"white",flat:!0}}).onOk(()=>{s()}).onCancel(()=>{u()})})}catch{return}t||(t=$db.fatura.criar(this.dados.venda),await $db.fatura.grava({fatura:t})),t.id?(await $db.venda.grava({venda:{id:this.dados.venda.id,idFatura:t.id},vendaOriginal:this.dados.venda}),localStorage.setItem("idFatura",t.id),this.dados.venda.idContato&&(this.$emit("executar","atualizar"),this.irParaAtendimentoFatura(this.dados.venda.idContato))):this.$q.notify("N\xE3o foi poss\xEDvel realizar a opera\xE7\xE3o")},alternarDetalhes(){this.detalhesVisivel=!this.detalhesVisivel},async atualizar(){const t=await $db.venda.leCompleto(this.id);t.carrinho.sort((u,l)=>new Date(u.dataHoraEmissao)<new Date(l.dataHoraEmissao)?-1:1),t.oss.sort((u,l)=>new Date(u.documento.dataHoraEmissao)<new Date(l.documento.dataHoraEmissao)?-1:1),t.customs.sort((u,l)=>new Date(u.documento.dataHoraEmissao)<new Date(l.documento.dataHoraEmissao)?-1:1),t.kits.sort((u,l)=>new Date(u.documento.dataHoraEmissao)<new Date(l.documento.dataHoraEmissao)?-1:1);for(const u of t.kits){const l=u.documentosItem.find(o=>o.operacaoFator===-1&&o.operacao!=="Manipula\xE7\xE3o");this.documentoItemKit[u.documento.id]=l}if((t.venda||{}).idContato&&(t.venda||{}).idEmpresa){let u=[];u=await $db.fatura.obterAbertas(t.venda.idContato,t.venda.idEmpresa),this.faturasAbertas=u.sort((l,o)=>!l.numero||l.numero<o.numero?-1:1)}const s={};if(t.venda.idContato){const u=t.venda.idContato;s[u]||(s[u]=await $db.contato.le({id:u}))}if(t.venda.idContatoVendedor){const u=t.venda.idContatoVendedor;s[u]||(s[u]=await $db.contato.le({id:u}))}this.configuraImpressaoEnvelope(t.venda.idEmpresa),this.configuraImpressaoOrcamento(t.venda.idEmpresa),this.configuraImpressosWhatsapp(t.venda),this.contatos=s,this.dados=t,await this.$nextTick(),t.venda.id===localStorage.getItem("idVenda")&&(this.$refs.vendaModal.mostrar({id:t.venda.id}),localStorage.removeItem("idVenda"))},async atualizarComDados(){var s,u,l;const t=await $db.venda.preparaDados(this.dadosVenda);t.carrinho.sort((o,p)=>new Date(o.dataHoraEmissao)<new Date(p.dataHoraEmissao)?-1:1),t.oss.sort((o,p)=>new Date(o.documento.dataHoraEmissao)<new Date(p.documento.dataHoraEmissao)?-1:1),t.customs.sort((o,p)=>new Date(o.documento.dataHoraEmissao)<new Date(p.documento.dataHoraEmissao)?-1:1),t.kits.sort((o,p)=>new Date(o.documento.dataHoraEmissao)<new Date(p.documento.dataHoraEmissao)?-1:1);for(const o of t.kits){const p=o.documentosItem.find(H=>H.operacaoFator===-1&&H.operacao!=="Manipula\xE7\xE3o");this.documentoItemKit[o.documento.id]=p}this.faturasAbertas=((u=(s=this.vendasCompletas)==null?void 0:s.faturasAbertas)==null?void 0:u.filter(o=>o.idEmpresa===t.venda.idEmpresa))||[],this.configuraImpressaoEnvelope(t.venda.idEmpresa),this.configuraImpressaoOrcamento(t.venda.idEmpresa),this.configuraImpressosWhatsapp(t.venda),this.contatos=((l=this.vendasCompletas)==null?void 0:l.dadosContatos)||{},this.dados=t,await this.$nextTick(),t.venda.id===localStorage.getItem("idVenda")&&(this.$refs.vendaModal.mostrar({id:t.venda.id}),localStorage.removeItem("idVenda"))},async configuraImpressaoEnvelope(t){const s=await $db.configuracoes.porNome("impressao.envelope",t);this.configImpressaoEnvelope=[...s.length?s.map(u=>({texto:"Imprimir Envelope",...u})):[{valor:"envelope",texto:"Imprimir Envelope"},{valor:"envelopeMini",texto:"Imprimir Envelope Mini"}]]},async configuraImpressaoOrcamento(t){const s=await $db.configuracoes.porNome("impressao.venda",t);this.configImpressaoOrcamento=[...s.length?s.map(u=>({texto:"Imprimir Or\xE7amento",...u})):[{valor:"invoice",texto:"Or\xE7amento/Venda (Invoice)"},this.sistemaPai==="optisoul"?{valor:"orcamento",texto:"Or\xE7amento (Antigo)"}:{},this.sistemaPai==="optisoul"?{valor:"termoGarantia",texto:"Termo de Garantia"}:{}]]},async configuraImpressosWhatsapp(t){const s=await $db.configuracoes.le({prefixoNome:"venda.whatsapp.enviar.",idEmpresa:t.idEmpresa});this.configImpressosWhatsapp=s.map(u=>({...u,idVenda:t.id}))},async dialogEnviar(t){try{const s=await $db.hibrido.le({table:"documento",id:t.idVenda});$utils.verificarErro(!(s!=null&&s.id),"Erro ao obter dados"),$q.dialog({title:"Enviar impresso pelo Whatsapp?",preventClose:!0,prompt:{label:"Enviar para este n\xFAmero:",model:s.telefoneContato?s.telefoneContato:"",hint:"Ou adicione um novo n\xFAmero, ex: 19988776655",isValid:u=>u.length>0,type:"text"},cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-primary",textColor:"white",flat:!0}}).onOk(async u=>{var o;s.telefoneContato=u.replace(/\D/g,"");const l=await $db.venda.enviaImpressaoPdfwhatsapp({documento:s,nomeImpresso:t.nome.replace("venda.whatsapp.enviar.",""),mensagem:(o=t.texto)!=null?o:`Voc\xEA est\xE1 recebendo o ${t.valor} da empresa ${s.descricaoEmpresa} (${s.numeroDocumentoEmpresa}).`})})}catch{$q.notifyError("Erro ao enviar.",erro)}},copiarUid(){const t=this.$refs.uid;t.type="text";try{t.select(),document.execCommand("copy"),this.$q.notify({message:"UID copiado para a \xE1rea de transfer\xEAncia.",type:"info"})}catch{this.$q.notify("Erro ao copiar.")}t.type="hidden",window.getSelection().removeAllRanges()},descricaoEnvelope(t){if(t.itens)return t.itens.map(u=>u.descricaoItem).filter(Boolean).join(" | ");let s="";for(const u of this.dados.itensEnvelopes)u.idDocumentoAdicional===t.id&&u.descricaoItem.trim()&&(s+=u.descricaoItem.trim()+" | ");return s.slice(0,-3)},async devolucaoGarantia(t){let s=await $db.hibrido.lista({table:"documento",where:{idContato:$db.contato.selecionado.id,tipo:"Venda",status:"Or\xE7amento"}});if(s=$lodash.orderBy(s,"dataHoraEmissao","desc"),!s.length){this.$q.notify({message:"Crie um or\xE7amento para inclus\xE3o de devolu\xE7\xE3o/garantia.",type:"info"});return}this.modalDevolucaoGarantia={visivel:!0,item:t,orcamento:s[0]}},editar(){this.$refs.vendaModal.mostrar({id:this.dados.venda.id})},executar(t){switch(t){case"atualizar":this.atualizar();break;case"cancelar":case"finalizar":case"reprovar":this.$emit("executar","atualizar");break;case"retornarOrcamento":this.$emit("executar",t);break}},async finalizaDevolucaoGarantia(t,s,u){const l=$utils.clonar(t);s==="devolucao"&&(l.operacao="Devolu\xE7\xE3o de Venda"),s==="garantia"&&(l.operacao="Garantia de Venda",l.motivo=u),l.idDocumentoItemVenda=l.id,l.idDocumentoVenda=l.idDocumento,l.id=$utils.uuid(),l.idDocumento=this.modalDevolucaoGarantia.orcamento.id,l.status="Or\xE7amento",l.operacaoFator=1,l.codigoCfop=20,l.idCfop=(await $db.cfop.le({codigoCfop:20}))[0].id,l.dataHoraEmissao=$utils.dataAtual(),l.dataHoraFinalizado="",l.subTotal=l.subTotal*-1,l.total=l.total*-1,l.valorItem=l.valorItem*-1,l.descontoSubTotal=0,delete l.codigoCfop,delete l.codigoDocumento,delete l.codigoDocumentoItem,delete l.codigoItem,delete l.codigoPlanoContaDestino,delete l.codigoPlanoContaEstoque,await $db.documentoItem.grava({atual:l}),this.$q.notify({message:"Item adicionado ao or\xE7amento.",type:"positive"}),localStorage.setItem("idVenda",this.modalDevolucaoGarantia.orcamento.id),this.$emit("executar","atualizar")},async remover(){this.$q.dialog({message:"Esta a\xE7\xE3o ir\xE1 remover esta venda da fatura",title:"Tem certeza?",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Continuar",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{try{await $db.venda.checarConflitoStatus({id:this.dados.venda.id,status:this.dados.venda.status})}catch(s){return $q.notifyError(s.message),!1}let t=$utils.clonar(this.dados.venda);this.dados.venda.idFatura="",await $db.venda.grava({venda:this.dados.venda,vendaOriginal:t}),this.$emit("executar","remover")})}},mixins:[U],props:{id:{required:!0,type:String},dadosVenda:{required:!1,type:Object},vendasCompletas:{required:!1,type:Object},resetarEnvio:{required:!1,type:Function}},watch:{async dados(t){var u;this.visibilidade.botao.editar=!1,this.visibilidade.botao.visualizar=!1,this.visibilidade.botao.remover=!1;let s=(u=this.vendasCompletas)==null?void 0:u.contatosEmpresa;if(!s){const o=(await $db.hibrido.lista({table:"empresa",columns:["idContato"],whereFilter:{ativo:!0}})).map(({idContato:p})=>p);s=await $db.hibrido.lista({table:"contato",columns:["id"],whereIn:{id:o},whereFilter:{ativo:!0}})}!s.find(l=>l.id===t.venda.idEmpresa)||(t.venda.idFatura&&this.faturasAbertas.find(l=>l.id===t.venda.idFatura)&&(this.visibilidade.botao.remover=await $db.permissao.objeto("Diretiva_Vendas_RemoverVendaFatura")),!~["Cancelado","N\xE3o Aprovado"].indexOf(t.venda.status)&&!t.venda.idFatura&&(this.visibilidade.botao.editar=!0),this.visibilidade.botao.editar||(this.visibilidade.botao.visualizar=!0))}},mounted(){this.sistemaPai=$utils.sistemaPai(),this.dadosVenda&&this.vendasCompletas?this.atualizarComDados():this.atualizar()}},J={class:"col-12 col-md-6 q-pl-none"},Z={class:"q-item-section"},X={class:"col-6 col-md hideonmobile"},Y={class:"text-left q-my-none"},$={class:"col-4 col-md hideonmobile"},ee={class:"text-left q-my-none"},ae={class:"col-4 col-md hideonmobile"},te={class:"text-left q-my-none"},oe={class:"col-6 col-md hideonmobile"},se={class:"text-right text-h5 text-positive text-weight-bold q-my-none"},de={class:"text-right text-weight-normal text-tertiary text-body2 q-my-none"},ie={class:"col-12 hideondesktop"},ne={class:"text-left q-my-none"},re={class:"col-12 col-md-6"},le={class:"col-12 col-md-6 full-height items-end hideonmobile"},ue={class:"col-6"},ce={class:"text-left q-my-none"},me={class:"text-left q-my-none"},ve={class:"col-6"},fe={class:"text-right text-weight-normal text-tertiary text-body2 q-my-none"},pe={class:"text-right text-h5 text-positive text-weight-bold q-my-none"},he={class:"col-12 full-height items-end"},_e={class:"col-12 col-md-6"},be={class:"text-subtitle1 text-weight-bold q-ma-none items-center"},ye={class:"q-ma-none"},ke={key:0},ge={key:1},Ce={class:"col-6 col-md-4"},we=f("p",{class:"text-subtitle1 text-weight-bold q-ma-none"}," Faturamento ",-1),xe={class:"q-ma-none"},Ee={class:"col-6 col-md-2 text-right"},qe=f("p",{class:"text-subtitle1 text-weight-bold q-ma-none"}," Desconto ",-1),Ie={class:"q-ma-none"};function Ve(t,s,u,l,o,p){const H=D("avatar"),O=D("row"),S=D("documentos-fiscais"),A=D("VendaModal"),M=D("modal-historico-status");return o.dados.venda.id?(i(),m(R,{key:0,id:"VendaCard",class:"extratoItem bg-white q-pa-sm no-shadow"},{default:a(()=>[e(O,{class:"items-center justify-between q-mx-none q-px-none q-mb-sm"},{default:a(()=>{var v;return[f("div",J,[e(G,{class:"q-pa-none"},{default:a(()=>{var d;return[e(H,{imagem:(d=o.contatos[o.dados.venda.idContato])==null?void 0:d.imagem,rotulo:o.dados.venda.descricaoContato,tamanho:"40",style:{float:"left"}},null,8,["imagem","rotulo"]),e(B,null,{default:a(()=>[f("div",Z,[e(y,null,{default:a(()=>{var E;return[n(c((E=o.contatos[o.dados.venda.idContato])==null?void 0:E.apelido),1)]}),_:1}),e(y,{caption:""},{default:a(()=>{var E;return[n(c((E=o.contatos[o.dados.venda.idContato])==null?void 0:E.nome),1)]}),_:1})])]),_:1}),e(V,{rounded:"",color:"tertiary",small:""},{default:a(()=>[n(c(o.dados.venda.status),1)]),_:1}),e(V,{class:"q-ml-sm",color:"positive",escuro:"",onClick:p.copiarUid},{default:a(()=>[n(" #"+c(parseInt(o.dados.venda.numero)||(o.dados.venda.id||"").slice(-6))+" ",1),C(f("input",{type:"hidden","onUpdate:modelValue":s[0]||(s[0]=E=>o.dados.venda.id=E),ref:"uid"},null,512),[[W,o.dados.venda.id]])]),_:1},8,["onClick"])]}),_:1})]),f("div",X,[f("p",Y,[o.contatos[o.dados.venda.idContatoVendedor]?(i(),m(h,{key:0,name:"mdi-account-tie"})):_("",!0),n(" "+c((v=o.contatos[o.dados.venda.idContatoVendedor])==null?void 0:v.apelido)+" ",1),e(I,null,{default:a(()=>[n(" Vendedor(a) ")]),_:1})])]),f("div",$,[f("p",ee,[o.dados.venda.dataHoraEmissao?(i(),m(h,{key:0,name:"mdi-calendar-today "})):_("",!0),n(" "+c(t.$filters.data(o.dados.venda.dataHoraEmissao))+" ",1),e(I,null,{default:a(()=>[n(" Emiss\xE3o ")]),_:1})])]),f("div",ae,[f("p",te,[o.dados.venda.dataHoraFinalizado?(i(),m(h,{key:0,name:"mdi-calendar-check"})):_("",!0),n(" "+c(t.$filters.data(o.dados.venda.dataHoraFinalizado))+" ",1),o.dados.venda.dataHoraFinalizado?(i(),m(I,{key:1},{default:a(()=>[n(" Finalizado ")]),_:1})):_("",!0)])]),f("div",oe,[f("p",se,c(t.$filters.numero(o.dados.venda.totalDocumento,2)),1),f("p",de,c(t.$filters.numero(o.dados.venda.subTotal,2)),1)])]}),_:1}),e(F,{class:"hideondesktop q-mb-sm"}),e(O,{class:"q-mx-none q-px-none items-center"},{default:a(()=>{var v;return[f("div",ie,[f("p",ne,[o.contatos[o.dados.venda.idContatoVendedor]?(i(),m(h,{key:0,name:"mdi-account-tie"})):_("",!0),n(" "+c((v=o.contatos[o.dados.venda.idContatoVendedor])==null?void 0:v.apelido)+" ",1),e(I,null,{default:a(()=>[n(" Vendedor(a) ")]),_:1})])]),f("div",re,[e(z,{class:"no-border text-tertiary"},{default:a(()=>[(i(!0),k(g,null,w(o.dados.carrinho,d=>(i(),m(b,{key:d.id,class:"q-pa-none q-mb-xs",style:{"min-height":"auto"}},{default:a(()=>[e(r,{avatar:"",class:"mw80"},{default:a(()=>[e(y,null,{default:a(()=>[n(c(d.quantidade)+"x",1)]),_:2},1024)]),_:2},1024),e(r,null,{default:a(()=>[e(y,null,{default:a(()=>[n(c(d.descricaoItem),1)]),_:2},1024)]),_:2},1024),e(r,{side:"",top:""},{default:a(()=>[e(y,null,{default:a(()=>[n(c(t.$filters.numero(d.total,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),(i(!0),k(g,null,w(o.dados.customs,d=>(i(),m(b,{key:d.documento.id,class:"q-pa-none q-mb-xs",style:{"min-height":"auto"}},{default:a(()=>[e(r,{avatar:"",class:"mw80"},{default:a(()=>[e(y,null,{default:a(()=>[n(c(d.documento.numero)+"x ",1)]),_:2},1024)]),_:2},1024),e(r,null,{default:a(()=>[e(y,null,{default:a(()=>[n(c(d.documento.descricao),1)]),_:2},1024)]),_:2},1024),e(r,{side:"",top:""},{default:a(()=>[e(y,null,{default:a(()=>[n(c(t.$filters.numero(d.documento.totalDocumento,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),(i(!0),k(g,null,w(o.dados.oss,d=>(i(),m(b,{key:d.documento.id,class:"q-pa-none q-mb-xs",style:{"min-height":"auto"}},{default:a(()=>[e(r,{avatar:"",class:"mw80"},{default:a(()=>[e(y,null,{default:a(()=>[n(" OS "),e(V,{color:"tertiary",small:""},{default:a(()=>[n("#"+c(d.documento.numero),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(r,null,{default:a(()=>[e(y,null,{default:a(()=>[n(c(d.documento.descricao),1)]),_:2},1024)]),_:2},1024),e(r,{avatar:"",class:"mw50"},{default:a(()=>[d.documento.status!=="Or\xE7amento"?(i(),m(V,{key:0,rounded:"",color:"tertiary",small:""},{default:a(()=>[n(c(d.documento.status),1)]),_:2},1024)):_("",!0)]),_:2},1024),e(r,{right:"",top:""},{default:a(()=>[e(y,null,{default:a(()=>[n(c(t.$filters.numero(d.documento.totalDocumento,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),(i(!0),k(g,null,w(o.dados.kits,d=>(i(),m(b,{key:d.documento.id,class:"q-pa-none q-mb-xs",style:{"min-height":"auto"}},{default:a(()=>[e(r,{avatar:"",class:"mw80"},{default:a(()=>[e(y,null,{default:a(()=>[n(c(t.$filters.numero(o.documentoItemKit[d.documento.id].quantidade,4))+"x",1)]),_:2},1024)]),_:2},1024),e(r,null,{default:a(()=>[e(y,null,{default:a(()=>[n(c(o.documentoItemKit[d.documento.id].descricaoItem),1)]),_:2},1024)]),_:2},1024),e(r,{side:"",top:""},{default:a(()=>[e(y,null,{default:a(()=>[n(c(t.$filters.numero(o.documentoItemKit[d.documento.id].total,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),(i(!0),k(g,null,w(o.dados.envelopes,d=>(i(),m(b,{key:d.id,class:"q-pa-none q-mb-xs",style:{"min-height":"auto"}},{default:a(()=>[e(r,{avatar:"",class:"mw80"},{default:a(()=>[e(y,null,{default:a(()=>[n(" EN "),e(V,{color:"tertiary",small:""},{default:a(()=>[n(" #"+c(parseInt(d.numero)||(d.id||"").slice(-6))+" ",1),e(I,null,{default:a(()=>[n(c(d.tipo)+" - "+c(d.descricaoContato),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(r,null,{default:a(()=>[e(y,null,{default:a(()=>[n(c(p.descricaoEnvelope(d)),1)]),_:2},1024)]),_:2},1024),e(r,{avatar:""},{default:a(()=>[d.status!=="Or\xE7amento"?(i(),m(V,{key:0,rounded:"",color:"tertiary",small:""},{default:a(()=>[n(c(d.status),1)]),_:2},1024)):_("",!0)]),_:2},1024),e(r,{right:"",top:""},{default:a(()=>[e(y,null,{default:a(()=>[n(c(t.$filters.numero(d.totalDocumento,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),f("div",le,[e(F,{class:"hideondesktop q-mb-sm q-mt-xs"}),e(q,{rounded:"",dense:"",flat:"",icon:"more_vert",color:"tertiary",class:"no-shadow q-mx-xs",size:"md",style:{float:"right"}},{default:a(()=>[e(N,null,{default:a(()=>[C((i(),m(z,{link:"",separator:""},{default:a(()=>[t.$utils.mapearStatus(o.dados.venda).permiteNota?(i(),k(g,{key:0},[C((i(),m(b,{clickable:"",onClick:s[1]||(s[1]=d=>t.emitirNFeV2({idVenda:o.dados.venda.id},1,"Venda"))},{default:a(()=>[e(r,{avatar:""},{default:a(()=>[e(h,{name:"account_balance"})]),_:1}),e(r,null,{default:a(()=>[n("NFe de Sa\xEDda/Venda")]),_:1})]),_:1})),[[x]]),C((i(),m(b,{clickable:"",onClick:s[2]||(s[2]=d=>t.emitirNFeV2({idVenda:o.dados.venda.id},0,"Devolu\xE7\xE3o"))},{default:a(()=>[e(r,{avatar:""},{default:a(()=>[e(h,{name:"account_balance"})]),_:1}),e(r,null,{default:a(()=>[n("NFe de Entrada/Devolu\xE7\xE3o")]),_:1})]),_:1})),[[x]]),C((i(),m(b,{clickable:"",onClick:s[3]||(s[3]=d=>t.emitirNFeV2({idVenda:o.dados.venda.id},1,"Remessa"))},{default:a(()=>[e(r,{avatar:""},{default:a(()=>[e(h,{name:"account_balance"})]),_:1}),e(r,null,{default:a(()=>[n("NFe de Remessa")]),_:1})]),_:1})),[[x]])],64)):_("",!0),p.podeMigrarFatura?(i(),k(g,{key:1},[(i(!0),k(g,null,w(o.faturasAbertas.filter(d=>d.id!==o.dados.venda.idFatura),d=>C((i(),m(b,{clickable:"",key:d.id,onClick:E=>p.migrarFatura(d)},{default:a(()=>[e(r,{avatar:""},{default:a(()=>[e(h,{name:"mdi-folder-move"})]),_:1}),e(r,null,{default:a(()=>[n(c("Migrar para fatura #"+(d.numero||d.id.slice(-6))),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[x]])),128)),C((i(),m(b,{clickable:"",onClick:s[4]||(s[4]=d=>p.migrarFatura())},{default:a(()=>[e(r,{avatar:""},{default:a(()=>[e(h,{name:"mdi-folder-move"})]),_:1}),e(r,null,{default:a(()=>[n("Migrar para nova fatura")]),_:1})]),_:1})),[[x]])],64)):_("",!0),e(b,{clickable:"",onClick:s[5]||(s[5]=d=>t.$refs.modalHistoricoStatus.mostrar({idDocumento:o.dados.venda.id}))},{default:a(()=>[e(r,{avatar:""},{default:a(()=>[e(h,{name:"history"})]),_:1}),e(r,null,{default:a(()=>[n("Hist\xF3rico do Status")]),_:1})]),_:1}),e(b,{clickable:"",onClick:p.duplicarVenda},{default:a(()=>[e(r,{avatar:""},{default:a(()=>[e(h,{name:"mdi-content-duplicate"})]),_:1}),e(r,null,{default:a(()=>[n("Duplicar Pedido")]),_:1})]),_:1},8,["onClick"]),(i(!0),k(g,null,w(o.configImpressosWhatsapp.filter(d=>d.valor),d=>(i(),m(b,{clickable:"",key:d.valor,onClick:E=>p.dialogEnviar(d)},{default:a(()=>[e(r,{avatar:""},{default:a(()=>[e(h,{name:"mdi-whatsapp"})]),_:1}),e(r,null,{default:a(()=>[n(c(d.valor),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),u.resetarEnvio&&o.dados.venda.rotaJson&&o.dados.venda.rotaJson.length>0?(i(),m(b,{key:2,clickable:"",onClick:s[6]||(s[6]=d=>u.resetarEnvio(o.dados.venda))},{default:a(()=>[e(r,{avatar:""},{default:a(()=>[e(h,{name:"restart_alt"})]),_:1}),e(r,null,{default:a(()=>[n("Resetar Envio")]),_:1})]),_:1})):_("",!0)]),_:1})),[[x]])]),_:1})]),_:1}),o.visibilidade.botao.remover?(i(),m(q,{key:0,rounded:"",dense:"",flat:"",icon:"clear",color:"tertiary",class:"no-shadow q-mx-xs",size:"md",onClick:p.remover,style:{float:"right"}},null,8,["onClick"])):_("",!0),o.visibilidade.botao.editar?(i(),m(q,{key:1,rounded:"",dense:"",flat:"",icon:"edit",color:"primary",class:"no-shadow q-mx-xs",size:"md",onClick:p.editar,style:{float:"right"}},null,8,["onClick"])):_("",!0),o.visibilidade.botao.visualizar?(i(),m(q,{key:2,rounded:"",dense:"",flat:"",icon:"remove_red_eye",color:"primary",class:"no-shadow q-mx-xs",size:"md",onClick:p.editar,style:{float:"right"}},null,8,["onClick"])):_("",!0),e(q,{rounded:"",dense:"",flat:"",icon:"print",color:"primary",class:"no-shadow q-mx-xs",size:"md",style:{float:"right"}},{default:a(()=>[e(N,null,{default:a(()=>[e(z,{link:"",separator:""},{default:a(()=>[(i(!0),k(g,null,w(o.configImpressaoOrcamento.filter(d=>d.valor),d=>(i(),m(b,{clickable:"",key:d.valor,onClick:E=>t.$imprimir(d.valor,{id:(o.dados.venda||{}).id||"0",Oculto:"0"})},{default:a(()=>[e(r,{avatar:""},{default:a(()=>[e(h,{name:"print"})]),_:1}),e(r,null,{default:a(()=>[e(y,null,{default:a(()=>[n(c(d.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),o.sistemaPai==="optisoul"?(i(!0),k(g,{key:0},w(o.configImpressaoEnvelope,d=>(i(),m(b,{clickable:"",key:d.valor,onClick:E=>t.$imprimir(d.valor,(o.dados.venda||{}).id||"0")},{default:a(()=>[e(r,{avatar:""},{default:a(()=>[e(h,{name:"print"})]),_:1}),e(r,null,{default:a(()=>[e(y,null,{default:a(()=>[n(c(d.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):_("",!0)]),_:1})]),_:1})]),_:1}),e(q,{rounded:"",dense:"",flat:"",icon:o.detalhesVisivel?"keyboard_arrow_up":"keyboard_arrow_down",size:"md",class:"no-shadow q-mx-xs",color:"tertiary",style:{float:"right"},onClick:p.alternarDetalhes},null,8,["icon","onClick"])])]}),_:1}),e(F,{class:"hideondesktop q-mb-sm q-mt-xs"}),e(O,{class:"q-mx-none q-px-none hideondesktop"},{default:a(()=>[f("div",ue,[f("p",ce,[o.dados.venda.dataHoraEmissao?(i(),m(h,{key:0,name:"mdi-calendar-today"})):_("",!0),n(" "+c(t.$filters.data(o.dados.venda.dataHoraEmissao))+" ",1),e(I,null,{default:a(()=>[n(" Emiss\xE3o ")]),_:1})]),f("p",me,[o.dados.venda.dataHoraFinalizado?(i(),m(h,{key:0,name:"mdi-calendar-check"})):_("",!0),n(" "+c(t.$filters.data(o.dados.venda.dataHoraFinalizado))+" ",1),o.dados.venda.dataHoraFinalizado?(i(),m(I,{key:1},{default:a(()=>[n(" Finalizado ")]),_:1})):_("",!0)])]),f("div",ve,[f("p",fe,c(t.$filters.numero(o.dados.venda.subTotal,2)),1),f("p",pe,c(t.$filters.numero(o.dados.venda.totalDocumento,2)),1)]),f("div",he,[e(F,{class:"hideondesktop q-mb-sm q-mt-xs"}),e(q,{rounded:"",dense:"",flat:"",icon:"more_vert",color:"tertiary",class:"no-shadow q-mx-xs",size:"md",style:{float:"right"}},{default:a(()=>[e(N,null,{default:a(()=>[C((i(),m(z,{link:"",separator:""},{default:a(()=>[t.$utils.mapearStatus(o.dados.venda).permiteNota?(i(),k(g,{key:0},[C((i(),m(b,{clickable:"",onClick:s[7]||(s[7]=v=>t.emitirNFeV2({idVenda:o.dados.venda.id},1,"Venda"))},{default:a(()=>[e(r,{avatar:""},{default:a(()=>[e(h,{name:"account_balance"})]),_:1}),e(r,null,{default:a(()=>[n("NFe de Sa\xEDda/Venda")]),_:1})]),_:1})),[[x]]),C((i(),m(b,{clickable:"",onClick:s[8]||(s[8]=v=>t.emitirNFeV2({idVenda:o.dados.venda.id},0,"Devolu\xE7\xE3o"))},{default:a(()=>[e(r,{avatar:""},{default:a(()=>[e(h,{name:"account_balance"})]),_:1}),e(r,null,{default:a(()=>[n("NFe de Entrada/Devolu\xE7\xE3o")]),_:1})]),_:1})),[[x]]),C((i(),m(b,{clickable:"",onClick:s[9]||(s[9]=v=>t.emitirNFeV2({idVenda:o.dados.venda.id},1,"Remessa"))},{default:a(()=>[e(r,{avatar:""},{default:a(()=>[e(h,{name:"account_balance"})]),_:1}),e(r,null,{default:a(()=>[n("NFe de Remessa")]),_:1})]),_:1})),[[x]])],64)):_("",!0),p.podeMigrarFatura?(i(),k(g,{key:1},[(i(!0),k(g,null,w(o.faturasAbertas.filter(v=>v.id!==o.dados.venda.idFatura),v=>C((i(),m(b,{key:v.id,onClick:d=>p.migrarFatura(v)},{default:a(()=>[e(r,{avatar:""},{default:a(()=>[e(h,{name:"mdi-folder-move"})]),_:1}),e(r,null,{default:a(()=>[n(c("Migrar para fatura #"+(v.numero||v.id.slice(-6))),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[x]])),128)),C((i(),m(b,{onClick:s[10]||(s[10]=v=>p.migrarFatura())},{default:a(()=>[e(r,{avatar:""},{default:a(()=>[e(h,{name:"mdi-folder-move"})]),_:1}),e(r,null,{default:a(()=>[n("Migrar para nova fatura")]),_:1})]),_:1})),[[x]])],64)):_("",!0),e(b,{clickable:"",onClick:s[11]||(s[11]=v=>t.$refs.modalHistoricoStatus.mostrar({idDocumento:o.dados.venda.id}))},{default:a(()=>[e(r,{avatar:""},{default:a(()=>[e(h,{name:"history"})]),_:1}),e(r,null,{default:a(()=>[n("Hist\xF3rico do Status")]),_:1})]),_:1}),(i(!0),k(g,null,w(o.configImpressosWhatsapp.filter(v=>v.valor),v=>(i(),m(b,{clickable:"",key:v.valor,onClick:d=>p.dialogEnviar(v)},{default:a(()=>[e(r,{avatar:""},{default:a(()=>[e(h,{name:"mdi-whatsapp"})]),_:1}),e(r,null,{default:a(()=>[n(c(v.valor),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})),[[x]])]),_:1})]),_:1}),o.visibilidade.botao.remover?(i(),m(q,{key:0,rounded:"",dense:"",flat:"",icon:"clear",color:"tertiary",class:"no-shadow q-mx-xs",size:"md",onClick:p.remover,style:{float:"right"}},null,8,["onClick"])):_("",!0),o.visibilidade.botao.editar?(i(),m(q,{key:1,rounded:"",dense:"",flat:"",icon:"edit",color:"primary",class:"no-shadow q-mx-xs",size:"md",onClick:p.editar,style:{float:"right"}},null,8,["onClick"])):_("",!0),e(q,{rounded:"",dense:"",flat:"",icon:"print",color:"primary",class:"no-shadow q-mx-xs",size:"md",style:{float:"right"}},{default:a(()=>[e(N,null,{default:a(()=>[e(z,{link:"",separator:""},{default:a(()=>[(i(!0),k(g,null,w(o.configImpressaoOrcamento.filter(v=>v.valor),v=>(i(),m(b,{clickable:"",key:v.valor,onClick:d=>t.$imprimir(v.valor,{id:(o.dados.venda||{}).id||"0",Oculto:"0"})},{default:a(()=>[e(r,{avatar:""},{default:a(()=>[e(h,{name:"print"})]),_:1}),e(r,null,{default:a(()=>[e(y,null,{default:a(()=>[n(c(v.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),o.sistemaPai==="optisoul"?(i(!0),k(g,{key:0},w(o.configImpressaoEnvelope,v=>(i(),m(b,{clickable:"",key:v.valor,onClick:d=>t.$imprimir(v.valor,(o.dados.venda||{}).id||"0")},{default:a(()=>[e(r,{avatar:""},{default:a(()=>[e(h,{name:"print"})]),_:1}),e(r,null,{default:a(()=>[e(y,null,{default:a(()=>[n(c(v.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):_("",!0)]),_:1})]),_:1})]),_:1}),e(q,{rounded:"",dense:"",flat:"",icon:o.detalhesVisivel?"keyboard_arrow_up":"keyboard_arrow_down",size:"md",class:"no-shadow q-mx-xs",color:"tertiary",style:{float:"right"},onClick:p.alternarDetalhes},null,8,["icon","onClick"])])]),_:1}),o.detalhesVisivel?(i(),m(F,{key:0,class:"hideondesktop q-my-sm"})):_("",!0),o.detalhesVisivel?(i(),m(O,{key:1,class:"items-start q-mx-none q-px-none q-mt-md"},{default:a(()=>[f("div",_e,[f("p",be,[e(h,{name:"business"}),n(" "+c(o.dados.venda.descricaoEmpresa),1)]),f("p",ye,[n(c(o.dados.venda.observacao)+" ",1),o.dados.venda.observacaoInterna?(i(),k("br",ke)):_("",!0),n(" "+c(o.dados.venda.observacaoInterna)+" ",1),o.dados.venda.observacaoCancelamento?(i(),k("br",ge)):_("",!0),n(" "+c(o.dados.venda.observacaoCancelamento),1)]),e(S,{idVenda:o.dados.venda.id},null,8,["idVenda"])]),f("div",Ce,[we,f("p",xe,c(o.dados.venda.observacaoFaturamento),1)]),f("div",Ee,[qe,f("p",Ie,c(t.$filters.numero(o.dados.venda.totalDesconto,2)),1)])]),_:1})):_("",!0),e(A,{ref:"vendaModal",onExecutar:p.executar},null,8,["onExecutar"]),e(M,{ref:"modalHistoricoStatus"},null,512)]),_:1})):_("",!0)}var Oe=P(L,[["render",Ve]]);export{Oe as V};
