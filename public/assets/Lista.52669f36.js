import{_ as Co,P as ha,b4 as po,p as k,o as C,i as y,w as t,f as a,K as Vo,A as wo,B as lo,E as fo,e as h,t as w,l as T,C as M,D as U,L as K,G as yo,H as da,d as L,aG as ga,aH as So,aZ as ba,a_ as qo,T as ao,b9 as la,ba as ra,bb as J,I as No,a$ as ma,y as _o,M as ca,N as va,b2 as ua,R as ia,aB as Q,Q as xo,u as Ia,ak as F,F as W,r as eo,ai as Y,aj as X,ah as H,x,k as $,j as R,am as ko,cq as sa,z as Ca,aQ as pa,s as na,f4 as Va,aF as vo,V as wa,aE as ya,aS as _a}from"./index.8410d967.js";import"./xlsx.1ab45fd8.js";import{B as fa}from"./BadgeCopiarUid.e3cb6b8c.js";import{S as Da}from"./SeletorCfop.03443bad.js";import{C as Ea}from"./Campo.1afcce21.js";import{l as Pa}from"./Lista.ea40877a.js";import"./QBtnDropdown.d4db059f.js";import"./QBtnGroup.e88740d4.js";import"./QDate.e5cf3524.js";const Fa={components:{SeletorNcm:ha,SeletorCfop:Da,Campo:Ea},data(){return{abaSelecionada:"tab1",historicoItem:[],tabelaHistoricoItem:{colunas:[{name:"fornecedor",label:"Fornecedor",align:"left"},{name:"dataCompra",label:"Data Compra",align:"right"},{name:"quantidade",label:"Quantidade",align:"right"},{name:"valorCusto",label:"Valor de Custo",align:"right"},{name:"valorTotal",label:"Valor Total (Custo)",align:"right"}],paginacao:{page:1,rowsPerPage:5}},estoqueItem:[],tabelaEstoqueItem:{colunas:[{name:"empresa",label:"Empresa",align:"left"},{name:"tipoEstoque",label:"Tipo estoque",align:"right"},{name:"lote",label:"Lote",align:"right"},{name:"quantidade",label:"Quantidade",align:"right"}],paginacao:{page:1,rowsPerPage:5}},cfop:null,cstIcms:"",cstIpi:"",contaEstoque:[],impostoCstIpi:[],impostoIcmsModalidade:[],impostoCstIcms:[],impostoCstIcmsSt:[],documentoItem:{},imposto:{},item:{},visivel:!1,contasOpcoes:[],exibirIcms:!1,exibirIcmsSt:!1,exibirIpi:!1,somenteLeituraIcms:!1,somenteLeituraIcmsSt:!1,exibirHistorico:!1,exibirEstoque:!1,exibeCfop:!1}},emits:["salvar"],methods:{async mostrar(l,e){var i,f,r,u,p,g,b,v,c,V;this.documentoItem=$utils.clonarV2(l),this.item=$utils.clonarV2(e),await this.consultarHistoricoItem(this.item),await this.consultarEstoqueItem(this.item);const m=await po().list("impostoParametro",{filter:{impParamTipoCod:1}}),n=await po().list("impostoParametro",{filter:{impParamTipoCod:21}});this.impostoCstIcms=m.concat(n).map(s=>({rotulo:s.numero.trim()+" - "+s.descr,valor:Number(s.numero)})).sort((s,d)=>Number(s.valor)-Number(d.valor)),this.impostoIcmsModalidade=(await po().list("impostoParametro",{filter:{impParamTipoCod:3}})).map(s=>({rotulo:s.numero.trim()+" - "+s.descr,valor:Number(s.numero)})).sort((s,d)=>Number(s.valor)-Number(d.valor)),this.impostoCstIcmsSt=(await po().list("impostoParametro",{filter:{impParamTipoCod:4}})).map(s=>({rotulo:s.numero.trim()+" - "+s.descr,valor:Number(s.numero)})).sort((s,d)=>Number(s.valor)-Number(d.valor)),this.impostoCstIpi=(await po().list("impostoParametro",{filter:{impParamTipoCod:5}})).map(s=>({rotulo:s.numero.trim()+" - "+s.descr,valor:Number(s.numero)})).sort((s,d)=>Number(s.valor)-Number(d.valor)),this.contaEstoque=(await $db.financeiroPlanoConta.leV2()).map(s=>{var d,I,E;return{rotulo:(E=(I=(d=s==null?void 0:s.descricao)!=null?d:" - "+(s==null?void 0:s.classificacao))!=null?I:" - "+(s==null?void 0:s.caminho))!=null?E:"",valor:s.id}}).sort((s,d)=>Number(s.valor)-Number(d.valor));let o;(i=this.documentoItem)!=null&&i.idCfop&&(o=await $erp().cfop.where({id:this.documentoItem.idCfop}).first()),o===void 0&&console.log("CFOP inv\xE1lido"),this.documentoItem.cfop=(f=o==null?void 0:o.cfop)!=null?f:"",this.documentoItem.codigoCfop=(r=o==null?void 0:o.codigoCfop)!=null?r:null,this.documentoItem.idCfop=(u=o.id)!=null?u:null,this.documentoItem.valorBaseIcms=(g=(p=this.documentoItem.valorBaseIcms)!=null?p:this.documentoItem.total)!=null?g:0,this.documentoItem.valorBaseIpi=(v=(b=this.documentoItem.valorBaseIpi)!=null?b:this.documentoItem.total)!=null?v:0,this.documentoItem.valorBaseIcmsSt=(V=(c=this.documentoItem.valorBaseIcmsSt)!=null?c:this.documentoItem.total)!=null?V:0,this.calcularImpostos(),this.exibeCfop=!0,this.visivel=!0},async salvar(){try{if(Object.keys(this.documentoItem.cfop).length>0){const l=await $db.cfop.le({cfop:Number(this.documentoItem.cfop)});this.documentoItem.codigoCfop=l[0].codigoCfop,this.documentoItem.idCfop=l[0].id}this.documentoItem.cfop&&delete this.documentoItem.cfop,this.$emit("salvar",this.documentoItem),this.exibirIcms=!1,this.exibirIcmsSt=!1,this.exibirIpi=!1,this.visivel=!1}catch(l){$q.notifyError("Ocorreu um erro ao salvar o produto: ",l.message)}finally{$q.notifyPositive("Produto salvo com sucesso.")}},calcularImpostos(l){var b,v,c,V,s,d,I,E,N,D;let e=(b=this.documentoItem.valorBaseIcms)!=null?b:0,m=(v=this.documentoItem.valorBaseIpi)!=null?v:0,n=(c=this.documentoItem.valorBaseIcmsSt)!=null?c:0,o=(V=this.documentoItem.percentualIcms)!=null?V:0,i=(s=this.documentoItem.percentualIpi)!=null?s:0,f=(d=this.documentoItem.percentualIVA)!=null?d:0,r=(I=this.documentoItem.percentualIcmsSt)!=null?I:0,u=(E=this.documentoItem.valorIcms)!=null?E:0,p=(N=this.documentoItem.valorIpi)!=null?N:0,g=(D=this.documentoItem.valorIcmsSt)!=null?D:0;["valorBaseIcms","percentualIcms"].includes(l)&&(u=e*o/100),l==="valorIcms"&&(o=u/e*100),["valorBaseIpi","percentualIpi"].includes(l)&&(p=m*i/100),l==="valorIpi"&&(i=p/m*100),l==="valorBaseIcmsSt"&&(f=0,n>0&&e>0&&n>=e&&(f=(n-e)/e*100),g=n*r/100-u),l==="percentualIVA"&&(n=e*(1+f/100),g=n*r/100-u),l==="percentualIcmsSt"&&(g=n*r/100-u),l==="valorIcmsSt"&&(r=g/n*100),this.documentoItem.valorBaseIcmsSt=parseFloat(n.toFixed(2)),this.documentoItem.percentualIcms=parseFloat(o.toFixed(2)),this.documentoItem.percentualIcmsSt=parseFloat(r.toFixed(2)),this.documentoItem.percentualIpi=parseFloat(i.toFixed(2)),this.documentoItem.percentualIVA=parseFloat(f.toFixed(2)),this.documentoItem.valorIcms=parseFloat(u.toFixed(2)),this.documentoItem.valorIcmsSt=parseFloat(g.toFixed(2)),this.documentoItem.valorIpi=parseFloat(p.toFixed(2)),(this.documentoItem.modalidadeBaseCalculo||this.documentoItem.percentualIcms>0||this.documentoItem.valorIcms>0)&&(this.exibirIcms=!0),(this.documentoItem.modalidadeBaseCalculoST||this.documentoItem.percentualIcmsSt>0||this.documentoItem.valorIcmsSt>0)&&(this.exibirIcmsSt=!0),(this.documentoItem.codigoCSTIPI||this.documentoItem.percentualIpi>0||this.documentoItem.valorIpi>0)&&(this.exibirIpi=!0)},async consultarCFOP(){var m,n;const l=this.documentoItem.cfop,e=await $erp().cfop.where({cfop:Number(l)}).first();e===void 0&&console.log("CFOP inv\xE1lido"),this.documentoItem.idCfop=(m=e==null?void 0:e.id)!=null?m:null,this.documentoItem.codigoCfop=(n=e==null?void 0:e.CodigoCFOP)!=null?n:null},async consultarHistoricoItem(l){const e={};(l==null?void 0:l.atual)&&Object.keys(l.atual).length>0&&(l=l.atual);const n=(await $db.hibrido.lista({table:"documentoItem",where:{idItem:l.id}})).filter(o=>(o.operacao==="Compra"||o.operacao==="Compra de Mercadoria")&&o.status==="Finalizado"&&o.operacaoFator===1&&o.quantidade>0);for(const o of n){const i=await $db.hibrido.le({table:"documento",id:o.idDocumento}),f=await $db.contato.le({id:i.idContato});e[o.idItem]||(e[o.idItem]={fornecedores:[]}),e[o.idItem].fornecedores.push({idItem:o.idItem||"",idContatoFornecedor:i.idContato||"",descricaoContatoFornecedor:f.nome||"",dataCompra:i.dataCompra||"",quantidade:o.quantidade||"",valorCusto:o.valorItem||"",valorTotal:o.valorItem*o.quantidade||""})}Object.keys(e).length>0?(this.historicoItem=e,this.historicoItem[l.id].fornecedores.sort((o,i)=>{const f=new Date(o.dataCompra||"1900-01-01");return new Date(i.dataCompra||"1900-01-01")-f})):this.historicoItem[l.id]={},this.exibirHistorico=!0},async consultarEstoqueItem(l){const e={};(l==null?void 0:l.atual)&&Object.keys(l.atual).length>0&&(l=l.atual);const m=await $db.estoqueSaldoProdutoEmpresa.le({idItem:l.id,tipoEstoque:"Dispon\xEDvel"});for(const n of m){const o=await $db.contato.le({id:n.idEmpresa});e[n.idItem]||(e[n.idItem]={estoques:[]}),e[n.idItem].estoques.push({idItem:n.idItem||"",idContatoEmpresa:n.idEmpresa||"",codigoContatoEmpresa:n.codigoEmpresa||"",descricaoContatoEmpresa:o.nome||"",tipoEstoque:n.tipoEstoque||"",lote:n.lote||"",saldo:n.saldo||""})}Object.keys(e).length>0?(this.estoqueItem=e,this.estoqueItem[l.id].estoques.sort((n,o)=>{const i=Number(n.codigoContatoEmpresa||0),f=Number(o.codigoContatoEmpresa||0);return i-f})):this.estoqueItem[l.id]={},this.exibirEstoque=!0},async fechar(){this.documentoItem.cfop&&delete this.documentoItem.cfop,this.exibirIcms=!1,this.exibirIcmsSt=!1,this.exibirIpi=!1}}},Sa=["src"],qa={key:0},xa={key:0};function ka(l,e,m,n,o,i){const f=k("badge"),r=k("g-col"),u=k("g-row"),p=k("campo"),g=k("SeletorNcm"),b=k("SeletorCfop"),v=k("g-label");return C(),y(_o,{modelValue:o.visivel,"onUpdate:modelValue":e[36]||(e[36]=c=>o.visivel=c),persistent:""},{default:t(()=>[a(Vo,{container:"",view:"hHh Lpr fFf",class:"bg-white",style:{"max-width":"980px"}},{default:t(()=>[a(wo,{class:"bg-primary"},{default:t(()=>[a(lo,{class:"bg-primary text-white"},{default:t(()=>[a(fo,null,{default:t(()=>[h(w(o.documentoItem.descricaoItem),1)]),_:1}),o.item.referencia?(C(),y(f,{key:0,cor:"tertiary",class:"q-mr-sm"},{default:t(()=>[h(w(o.item.referencia),1)]),_:1})):T("",!0),M(a(U,{onClick:i.fechar,dense:"",flat:"",icon:"close",round:""},null,8,["onClick"]),[[K]])]),_:1})]),_:1}),a(yo,null,{default:t(()=>[a(da,null,{default:t(()=>[a(u,{gutter:"md"},{default:t(()=>[a(r,null,{default:t(()=>[a(u,{class:"col-12 text-center"},{default:t(()=>[a(r,null,{default:t(()=>{var c,V,s,d,I,E;return[((c=o.item)==null?void 0:c.imagem)||((s=(V=o.item)==null?void 0:V.atual)==null?void 0:s.imagem)?(C(),L("img",{key:0,src:((d=o.item)==null?void 0:d.imagem)||((E=(I=o.item)==null?void 0:I.atual)==null?void 0:E.imagem),alt:"",style:{"max-width":"33%"}},null,8,Sa)):T("",!0)]}),_:1})]),_:1}),a(ga,{modelValue:o.abaSelecionada,"onUpdate:modelValue":e[0]||(e[0]=c=>o.abaSelecionada=c),align:"justify",dense:"","indicator-color":"light-blue-4",class:"text-primary q-px-sm"},{default:t(()=>[a(So,{default:"",name:"tab1",icon:"info",label:"Detalhes",class:"cinza"}),a(So,{name:"tab2",icon:"history",label:"Compras",class:"cinza"}),a(So,{name:"tab3",icon:"compare_arrows",label:"Estoque",class:"cinza"})]),_:1},8,["modelValue"]),a(ba,{modelValue:o.abaSelecionada,"onUpdate:modelValue":e[35]||(e[35]=c=>o.abaSelecionada=c),animated:"",class:"text-tertiary"},{default:t(()=>[a(qo,{name:"tab1",class:"q-px-sm"},{default:t(()=>[a(u,null,{default:t(()=>[a(r,null,{default:t(()=>[a(p,{modelValue:o.documentoItem.observacao,"onUpdate:modelValue":e[1]||(e[1]=c=>o.documentoItem.observacao=c),tipo:"textoArea",rotulo:"Observa\xE7\xE3o",dense:"",rows:"4"},null,8,["modelValue"])]),_:1})]),_:1}),a(u,{mg:"lg-t"},{default:t(()=>[a(r,{col:"12"},{default:t(()=>[a(p,{modelValue:o.documentoItem.referenciaFornecedor,"onUpdate:modelValue":e[2]||(e[2]=c=>o.documentoItem.referenciaFornecedor=c),rotulo:"Refer\xEAncia Fornecedor"},null,8,["modelValue"])]),_:1})]),_:1}),a(u,{mg:"lg-t"},{default:t(()=>[a(r,{col:"12"},{default:t(()=>[a(g,{modelValue:o.documentoItem.ncm,"onUpdate:modelValue":e[3]||(e[3]=c=>o.documentoItem.ncm=c),class:"col-12 col-md-6",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),a(u,{mg:"lg-t"},{default:t(()=>[a(r,{col:"12"},{default:t(()=>[a(b,{modelValue:o.documentoItem.cfop,"onUpdate:modelValue":e[4]||(e[4]=c=>o.documentoItem.cfop=c),class:"col-12 col-md-6",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),a(u,{mg:"lg-t"},{default:t(()=>[a(r,null,{default:t(()=>[a(v,{text:"sub1 medium"},{default:t(()=>[h("Estoque")]),_:1})]),_:1})]),_:1}),a(u,{items:"center"},{default:t(()=>[a(r,{col:"12"},{default:t(()=>[a(p,{modelValue:o.documentoItem.idPlanoContaEstoque,"onUpdate:modelValue":e[5]||(e[5]=c=>o.documentoItem.idPlanoContaEstoque=c),opcoes:o.contaEstoque,tipo:"seletor",ajuda:"Plano de Conta de Estoque para Entrada de Mercadoria",dense:"",outlined:"",rotulo:"Conta Estoque"},null,8,["modelValue","opcoes"])]),_:1})]),_:1}),a(u,{mg:"lg-t"},{default:t(()=>[a(r,null,{default:t(()=>[a(v,{text:"sub1 medium"},{default:t(()=>[h("Impostos")]),_:1})]),_:1})]),_:1}),a(u,null,{default:t(()=>[a(ao,{label:"ICMS",modelValue:o.exibirIcms,"onUpdate:modelValue":e[6]||(e[6]=c=>o.exibirIcms=c)},null,8,["modelValue"])]),_:1}),o.exibirIcms?(C(),y(u,{key:0,items:"center"},{default:t(()=>[a(r,{col:"12 sm6"},{default:t(()=>[a(p,{modelValue:o.documentoItem.modalidadeBaseCalculo,"onUpdate:modelValue":e[7]||(e[7]=c=>o.documentoItem.modalidadeBaseCalculo=c),opcoes:o.impostoIcmsModalidade,"somente-leitura":o.somenteLeituraIcms,tipo:"seletor",outlined:"",rotulo:"ICMS (Modalidade)"},null,8,["modelValue","opcoes","somente-leitura"])]),_:1}),a(r,{col:"12 sm6"},{default:t(()=>[a(p,{modelValue:o.documentoItem.codigoCst,"onUpdate:modelValue":e[8]||(e[8]=c=>o.documentoItem.codigoCst=c),opcoes:o.impostoCstIcms,"somente-leitura":o.somenteLeituraIcms,tipo:"seletor",outlined:"",rotulo:"CST ICMS"},null,8,["modelValue","opcoes","somente-leitura"])]),_:1}),a(r,{col:"12 sm4"},{default:t(()=>[a(p,{modelValue:o.documentoItem.valorBaseIcms,"onUpdate:modelValue":e[9]||(e[9]=c=>o.documentoItem.valorBaseIcms=c),onBlur:e[10]||(e[10]=c=>i.calcularImpostos("valorBaseIcms")),"somente-leitura":o.somenteLeituraIcms,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Base ICMS"},null,8,["modelValue","somente-leitura"])]),_:1}),a(r,{col:"12 sm4"},{default:t(()=>[a(p,{modelValue:o.documentoItem.percentualIcms,"onUpdate:modelValue":e[11]||(e[11]=c=>o.documentoItem.percentualIcms=c),onBlur:e[12]||(e[12]=c=>i.calcularImpostos("percentualIcms")),"somente-leitura":o.somenteLeituraIcms,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"ICMS %"},null,8,["modelValue","somente-leitura"])]),_:1}),a(r,{col:"12 sm4"},{default:t(()=>[a(p,{modelValue:o.documentoItem.valorIcms,"onUpdate:modelValue":e[13]||(e[13]=c=>o.documentoItem.valorIcms=c),onBlur:e[14]||(e[14]=c=>i.calcularImpostos("valorIcms")),"somente-leitura":o.somenteLeituraIcms,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Valor ICMS"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})):T("",!0),a(u,null,{default:t(()=>[a(ao,{label:"ICMS ST",modelValue:o.exibirIcmsSt,"onUpdate:modelValue":e[15]||(e[15]=c=>o.exibirIcmsSt=c)},null,8,["modelValue"])]),_:1}),o.exibirIcmsSt?(C(),y(u,{key:1,items:"center"},{default:t(()=>[a(r,{col:"12 sm6"},{default:t(()=>[a(p,{modelValue:o.documentoItem.modalidadeBaseCalculoST,"onUpdate:modelValue":e[16]||(e[16]=c=>o.documentoItem.modalidadeBaseCalculoST=c),opcoes:o.impostoCstIcmsSt,"somente-leitura":o.somenteLeituraIcmsSt,tipo:"seletor",outlined:"",rotulo:"ICMS ST (Modalidade)"},null,8,["modelValue","opcoes","somente-leitura"])]),_:1}),a(r,{col:"12 sm6"},{default:t(()=>[a(p,{modelValue:o.documentoItem.percentualIVA,"onUpdate:modelValue":e[17]||(e[17]=c=>o.documentoItem.percentualIVA=c),onBlur:e[18]||(e[18]=c=>i.calcularImpostos("percentualIVA")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"IVA (%)"},null,8,["modelValue"])]),_:1}),a(r,{col:"12 sm4"},{default:t(()=>[a(p,{modelValue:o.documentoItem.valorBaseIcmsSt,"onUpdate:modelValue":e[19]||(e[19]=c=>o.documentoItem.valorBaseIcmsSt=c),onBlur:e[20]||(e[20]=c=>i.calcularImpostos("valorBaseIcmsSt")),"somente-leitura":o.somenteLeituraIcmsSt,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Base ICMS ST"},null,8,["modelValue","somente-leitura"])]),_:1}),a(r,{col:"12 sm4"},{default:t(()=>[a(p,{modelValue:o.documentoItem.percentualIcmsSt,"onUpdate:modelValue":e[21]||(e[21]=c=>o.documentoItem.percentualIcmsSt=c),onBlur:e[22]||(e[22]=c=>i.calcularImpostos("percentualIcmsSt")),"somente-leitura":o.somenteLeituraIcmsSt,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"ICMS ST (%)"},null,8,["modelValue","somente-leitura"])]),_:1}),a(r,{col:"12 sm4"},{default:t(()=>[a(p,{modelValue:o.documentoItem.valorIcmsSt,"onUpdate:modelValue":e[23]||(e[23]=c=>o.documentoItem.valorIcmsSt=c),onBlur:e[24]||(e[24]=c=>i.calcularImpostos("valorIcmsSt")),"somente-leitura":o.somenteLeituraIcmsSt,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Valor ICMS ST"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})):T("",!0),a(u,null,{default:t(()=>[a(ao,{label:"IPI",modelValue:o.exibirIpi,"onUpdate:modelValue":e[25]||(e[25]=c=>o.exibirIpi=c)},null,8,["modelValue"])]),_:1}),o.exibirIpi?(C(),y(u,{key:2,items:"center"},{default:t(()=>[a(r,{col:"12"},{default:t(()=>[a(p,{modelValue:o.documentoItem.codigoCstIpi,"onUpdate:modelValue":e[26]||(e[26]=c=>o.documentoItem.codigoCstIpi=c),opcoes:o.impostoCstIpi,tipo:"seletor",dense:"",outlined:"",rotulo:"CST IPI"},null,8,["modelValue","opcoes"])]),_:1}),a(r,{col:"12 sm4"},{default:t(()=>[a(p,{modelValue:o.documentoItem.valorBaseIpi,"onUpdate:modelValue":e[27]||(e[27]=c=>o.documentoItem.valorBaseIpi=c),onBlur:e[28]||(e[28]=c=>i.calcularImpostos("valorBaseIpi")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Base IPI"},null,8,["modelValue"])]),_:1}),a(r,{col:"12 sm4"},{default:t(()=>[a(p,{modelValue:o.documentoItem.percentualIpi,"onUpdate:modelValue":e[29]||(e[29]=c=>o.documentoItem.percentualIpi=c),onBlur:e[30]||(e[30]=c=>i.calcularImpostos("percentualIpi")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"IPI %"},null,8,["modelValue"])]),_:1}),a(r,{col:"12 sm4"},{default:t(()=>[a(p,{modelValue:o.documentoItem.valorIpi,"onUpdate:modelValue":e[31]||(e[31]=c=>o.documentoItem.valorIpi=c),onBlur:e[32]||(e[32]=c=>i.calcularImpostos("valorIpi")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Valor IPI"},null,8,["modelValue"])]),_:1})]),_:1})):T("",!0)]),_:1}),a(qo,{name:"tab2",class:"q-px-sm"},{default:t(()=>[o.exibirHistorico?(C(),y(la,{key:0,rows:o.historicoItem[o.documentoItem.idItem].fornecedores,columns:o.tabelaHistoricoItem.colunas,pagination:o.tabelaHistoricoItem.paginacao,"onUpdate:pagination":e[33]||(e[33]=c=>o.tabelaHistoricoItem.paginacao=c),"row-key":"index",class:"no-shadow text-left"},{body:t(c=>[a(ra,{props:c},{default:t(()=>[a(J,{key:"fornecedor",props:c},{default:t(()=>[h(w(c.row.descricaoContatoFornecedor),1)]),_:2},1032,["props"]),a(J,{key:"dataCompra",props:c},{default:t(()=>[c.row.dataCompra!==""?(C(),L("span",qa,w(l.$filters.data(c.row.dataCompra)),1)):T("",!0)]),_:2},1032,["props"]),a(J,{key:"quantidade",props:c},{default:t(()=>[h(w(c.row.quantidade),1)]),_:2},1032,["props"]),a(J,{key:"valorCusto",props:c},{default:t(()=>[h(w(l.$filters.numero(c.row.valorCusto,2)),1)]),_:2},1032,["props"]),a(J,{key:"valorTotal",props:c},{default:t(()=>[h(w(l.$filters.numero(c.row.valorTotal,2)),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])):T("",!0)]),_:1}),a(qo,{name:"tab3",class:"q-px-sm"},{default:t(()=>[o.exibirEstoque?(C(),y(la,{key:0,rows:o.estoqueItem[o.documentoItem.idItem].estoques,columns:o.tabelaEstoqueItem.colunas,pagination:o.tabelaEstoqueItem.paginacao,"onUpdate:pagination":e[34]||(e[34]=c=>o.tabelaEstoqueItem.paginacao=c),"row-key":"index",class:"no-shadow text-left"},{body:t(c=>[a(ra,{props:c},{default:t(()=>[a(J,{key:"empresa",props:c},{default:t(()=>[h(w(c.row.descricaoContatoEmpresa),1)]),_:2},1032,["props"]),a(J,{key:"tipoEstoque",props:c},{default:t(()=>[h(w(c.row.tipoEstoque),1)]),_:2},1032,["props"]),a(J,{key:"lote",props:c},{default:t(()=>[c.row.lote!==""?(C(),L("span",xa,w(c.row.lote),1)):T("",!0)]),_:2},1032,["props"]),a(J,{key:"quantidade",props:c},{default:t(()=>[h(w(c.row.saldo),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])):T("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),a(No,{class:"bg-light q-pa-sm",bordered:""},{default:t(()=>[a(lo,null,{default:t(()=>[a(ma),M(a(U,{onClick:i.fechar,label:"Cancelar",size:"md",flat:"","no-ripple":"",color:"tertiary",class:"q-mr-sm"},null,8,["onClick"]),[[K]]),a(U,{onClick:i.salvar,label:"Salvar",color:"primary","no-ripple":"",unelevated:""},null,8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}var Na=Co(Fa,[["render",ka]]);const Ta={components:{Avatar:ca,BadgeCopiarUid:fa,Badge:va,ModalEditarProdutoCompras:Na,PromptItemV2:ua},data(){return{ehOrcamento:!0,adicionar:{modal:{value:!1,name:""}},dataPrevistaEntrega:"",horaPrevistaEntrega:"",contatos:{},compraOriginal:{},compra:{id:$utils.uuid(),codigoDocumento:null,tipo:"Compra",operacao:"Pedido de Compra",status:"Digita\xE7\xE3o",codigoEmpresa:null,descricaoEmpresa:"",numeroDocumentoEmpresa:"",codigoContato:null,descricaoContato:"",codigoContatoComprador:null,codigoContatoVendedor:null,idContatoComprador:null,dataHoraEmissao:new Date,tipoFrete:"CIF",tipoTransporte:null,idEmpresa:null,idContato:null,totalDesconto:0,totalPercentualDesconto:0,calcularTributacao:!0,totalComImposto:!0,naoGerarFinanceiro:!1,freteSeparado:!1,dataHoraPrevisto:null,valorBaseIcms:0,valorIcms:0,valorBaseIcmsSt:0,valorIcmsSt:0},compraItens:[],compraItensOriginal:[],produtos:[],condicoesDePagamento:[],formasDePagamento:[],visivel:!1,somenteLeitura:!1,condicaoPagamentoRules:[async()=>{const l=this.compra.condicaoPagamento;return/^[\d/]*$/.test(l)}],formaPagamentoRules:[async()=>{const l=this.compra.formaDePagamento;return/^[^\d\s][a-zA-Z\s]*[^\d\s]$/.test(l)}],erroDesconto:!1,erroFrete:!1,erroSeguro:!1,erroOutrasDespesas:!1,itensImagens:{},exibeInfNota:!1,documentoNovo:!1,valorTotalPagamento:0,sku:0,operacao:"",excluir:!1}},emits:["atualizar"],computed:{skus(){return this.compraItens.length>0?`${Number(this.compraItens.length)}`:"0"}},methods:{editarProduto(l){const e=this.produtos[l.idItem];this.$refs.ModalEditarProdutoCompras.mostrar(l,e)},removerItem(l){this.compraItens=this.compraItens.filter(e=>e.id!==l.id),this.calcularTotais()},fecharEdicaoProduto(l){const e=this.compraItens.findIndex(m=>m.id===l.id);this.compraItens[e]=$utils.clonarV2(l),this.calcularTotaisItem(e)},async atualizar({id:l}){var e,m,n,o,i,f,r;try{if(this.$q.loading.show(),(e=this.compra)!=null&&e.idEmpresa){const u=this.compra.idEmpresa||null;u&&!this.contatos[u]&&(this.contatos[u]=await $db.contato.le({id:u}))}if((m=this.compra)!=null&&m.idContato){const u=this.compra.idContato;this.contatos[u]||(this.contatos[u]=await $db.contato.le({id:u}))}if((n=this.compra)!=null&&n.idContatoComprador){const u=this.compra.idContatoComprador;this.contatos[u]||(this.contatos[u]=await $db.contato.le({id:u}))}if((o=this.compra)!=null&&o.idContatoVendedor){const u=this.compra.idContatoVendedor;this.contatos[u]||(this.contatos[u]=await $db.contato.le({id:u}))}if((i=this.compra)!=null&&i.idContatoTransportadora){const u=this.compra.idContatoTransportadora;this.contatos[u]||(this.contatos[u]=await $db.contato.le({id:u}))}this.compraItensOriginal=await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:(f=this.compra)==null?void 0:f.id}}),this.compraItensImagens=$utils.clonarV2(this.compraItensOriginal),await this.processarImagem(this.compraItensImagens),this.compraItens=$utils.clonarV2(this.compraItensOriginal);for(let u in this.compraItens)this.produtos[this.compraItens[u].idItem]=await $db.item.leNew({id:this.compraItens[u].idItem});if(this.condicoesDePagamento=await $db.hibrido.lista({table:"documentoCondicaoPagamento",where:{idDocumento:(r=this.compra)==null?void 0:r.id}}),this.condicoesDePagamento.sort((u,p)=>{let g=new Date(u.dataVencimento),b=new Date(p.dataVencimento);return g-b}),this.valorTotalPagamento===0)for(const u of this.condicoesDePagamento)this.valorTotalPagamento=this.valorTotalPagamento+u.valor;this.compra.dataHoraPrevisto&&(this.dataPrevistaEntrega=this.compra.dataHoraPrevisto.slice(0,10),this.horaPrevistaEntrega=this.compra.dataHoraPrevisto.slice(11,16)),this.exibeInfNota=!0}catch(u){console.log(u.message)}finally{this.$q.loading.hide()}},verificarSeAlterouCampos(){return $utils.diferencaObjetos(this.compraOriginal,this.compra)},async salvar_click(){try{if(this.compra.idContato||(this.compra.idContato=$db.usuario.logado.id),this.dataPrevistaEntrega){const l=`${this.dataPrevistaEntrega} ${this.horaPrevistaEntrega||"00:00:00"}`;this.compra.dataHoraPrevisto=ia.formatDate(l)}$q.loading.show(),await this.salvar(),this.$emit("atualizar",{aba:"Digita\xE7\xE3o"}),this.ocultarModal()}catch(l){$q.notifyError("Ocorreu um erro ao salvar",l)}finally{$q.loading.hide(),this.compra.operacao==="Pedido de Compra"?$q.notifyPositive("O Pedido de Compra foi salvo com sucesso."):this.compra.operacao==="Nota de Entrada"&&$q.notifyPositive("A Nota de Compra foi salva com sucesso.")}},async excluir_click(){$q.dialog({title:"Excluir compra",message:`Deseja excluir ${this.compra.operacao==="Pedido de Compra"?`o ${this.compra.operacao}?`:`a ${this.compra.operacao}?`}`,cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-negative",textColor:"white",flat:!0},persistent:!0}).onOk(async()=>{try{$q.loading.show(),this.excluir=!0,this.operacao=this.compra.operacao,await $db.compra.remove(this.compra),await this.fechar()}catch(l){$q.notifyError(`Erro ao excluir o documento de ${this.operacao}!`),console.log(l)}finally{$q.loading.hide(),$q.notifyPositive(`${this.operacao} foi excluido com sucesso!`)}}).onCancel(async()=>{})},async criar(){try{let l,e,m;if(e=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data,!(e.length>0)){this.$q.notify({message:"N\xE3o h\xE1 empresa configurada",timeout:0,type:"negative",closeBtn:!0});return}if(l=e[0],e.length>1){const o={ativo:!0,empresas:!0};if(l=await $g.promptContato.show({filtro:o,placeholder:"Selecione a empresa"}),!l){this.ocultarModal(),this.$q.notifyError("Empresa n\xE3o selecionada");return}}if(m=(await $db.hibrido.lista({table:"empresa",where:{idContato:l.id}}))[0],!m){this.ocultarModal(),this.$q.notifyError("Erro ao selecionar empresa");return}if(this.contatos[l.id]||(this.contatos[l.id]=await $db.contato.le({id:l.id})),this.compra.descricaoEmpresa=m.nome,this.compra.idEmpresa=m.idContato,this.compra.numeroDocumentoEmpresa=m.numeroDocumentoNacional,this.compra.InscricaoMunicipalEmpresa=m.InscricaoMunicipalEmpresa,this.compra.codigoEmpresa=m.codigoContato,this.compra.dataHoraPrevisto=null,!await this.abrirModalFornecedor()){this.ocultarModal(),this.$q.notifyError("Fornecedor n\xE3o selecionado");return}this.documentoNovo=!0,this.exibeInfNota=!0}catch(l){console.log(l.message)}this.campanha={id:$utils.uuid(),descricao:"Descri\xE7\xE3o",dataHoraCriacao:$utils.dataAtual(),status:"Rascunho",tipo:"Whatsapp",mensagem:"Mensagem",idContato:$db.usuario.logado.id,responsavel:$db.usuario.logado.nome},this.campanhaContato=[],this.campanhaAnexo=[],this.campanhaOriginal={},this.visivel=!0,this.somenteLeitura=!1},async finalizar_click(){if(!this.compra.descricaoContato)return $q.notifyError("N\xE3o \xE9 permitido finalizar a compra sem informar o fornecedor!");if(!this.compra.formadePagamento&&!this.compra.naoGerarFinanceiro)return $q.notifyError("N\xE3o \xE9 permitido finalizar a compra sem informar a forma de pagamento!");if(this.compraItens.length===0){this.$q.notifyError("N\xE3o \xE9 permitido finalizar compra sem itens!");return}if(!this.compra.naoGerarFinanceiro&&this.condicoesDePagamento.length>0&&this.compra.totalDocumento!==this.condicoesDePagamento.map(l=>l.valor).reduce((l,e)=>l+e))return $q.notifyError("N\xE3o \xE9 permitido finalizar a compra se o valor Total difere da soma das parcelas!");if(!this.compra.naoGerarFinanceiro&&this.condicoesDePagamento.length===0)return $q.notifyError('Verifique se a op\xE7\xE3o "N\xE3o gerar financeiro" est\xE1 marcada, ou adicione as parcelas para finalizar a compra!');if(this.compra.operacao==="Pedido de Compra")try{this.compra.naoGerarFinanceiro?this.compra.naoGerarFinanceiro&&($q.loading.show(),this.compra.status="Finalizado",this.compra.dataHoraFinalizado=$utils.dataAtual(),await this.finalizarItens(),await this.salvar(),this.$emit("atualizar"),this.ocultarModal(),$q.notifyPositive("Compra finalizada com sucesso!")):$q.dialog({title:"Gerar Financeiro",message:"Deseja gerar as provis\xF5es financeiras?",cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-primary",textColor:"white",flat:!0},persistent:!0}).onOk(async()=>{this.adicionar.modal.name="GerarFinanceiro",$q.loading.show(),this.compra.status="Finalizado",this.compra.dataHoraFinalizado=$utils.dataAtual(),await this.finalizarItens(),await this.salvar(),this.gerarFinanceiro(this.compra.id),this.$emit("atualizar",{aba:"Finalizado"}),this.ocultarModal(),$q.notifyPositive("Compra finalizada com sucesso!"),$q.notifyPositive("Provisionamento gerado com sucesso!")}).onCancel(async()=>{$q.loading.show(),this.compra.status="Finalizado",this.compra.dataHoraFinalizado=$utils.dataAtual(),await this.finalizarItens(),await this.salvar(),this.$emit("atualizar"),this.ocultarModal(),$q.notifyPositive("Compra finalizada com sucesso!")})}catch(l){$q.notifyError("Ocorreu um erro!",l)}finally{$q.loading.hide()}if(this.compra.operacao==="Nota de Entrada"){if(!this.compra.notaNumero)return $q.notifyError("N\xE3o \xE9 permitido finalizar a compra sem informar o n\xFAmero da Nota de Entrada!");if(!this.compra.notaSerie)return $q.notifyError("N\xE3o \xE9 permitido finalizar a compra sem informara s\xE9rie da Nota de Entrada!");if(!this.compra.naturezaOperacao)return $q.notifyError("N\xE3o \xE9 permitido finalizar a compra sem informar natureza de opera\xE7\xE3o da Nota de Entrada!");if(!this.compra.dataCompra)return $q.notifyError("N\xE3o \xE9 permitido finalizar a compra sem informar a data de compra da Nota de Entrada!");if(!this.compra.chaveAcesso)return $q.notifyError("N\xE3o \xE9 permitido finalizar a compra sem informar a chave de acesso da Nota de Entrada!");if($q.loading.show(),this.compra.naoGerarFinanceiro){if(this.compra.naoGerarFinanceiro){try{this.compra.dataHoraFinalizado=$utils.dataAtual(),this.compra.status="Finalizado",await this.finalizarItens()}catch(l){console.log(l.message())}await this.salvar(),this.$emit("atualizar"),this.ocultarModal()}}else{try{this.compra.dataHoraFinalizado=$utils.dataAtual(),this.compra.status="Finalizado",await this.finalizarItens()}catch(l){console.log(l.message())}await this.salvar(),this.gerarFinanceiro(this.compra.id),this.$emit("atualizar"),this.ocultarModal()}}},async finalizarItens(){var l,e,m,n,o,i,f,r,u,p,g,b,v,c,V,s,d,I,E,N,D,A,z,O,Z,j,ro,ho,io,so,no,B,G,oo,go,to,bo,mo,To,zo,Uo,Bo,Mo,Oo,Ho,Ao,Lo,jo,Ro,Xo,Qo,Go,$o,Zo,Wo,Jo,Ko,Yo,oa,aa,ea;try{const _=this.compraItens,Do=$utils.dataAtual();let Eo=1,ta=0,Po=0,Fo=!1;const q=this.compra;if(q.subTotalProduto>0&&(q.tipoFrete==="FOB"&&q.freteSeparado===0&&(ta=q.valorFrete+q.valorSeguro),Eo=(q.subTotalProduto+q.valorOutrasDespesas-q.totalDesconto+ta)/q.subTotalProduto),Po=_.reduce((P,co)=>P+co.valorIcmsSt,Po),Po!==q.valorIcmsSt&&(Fo=!0),q.operacao==="Nota de Entrada")for(let P in _){let co=$utils.clonarV2(_[P]),S=$utils.clonarV2(_[P]);S.status="Finalizado",S.dataCompra=Do,S.dataHoraFinalizado=Do,Fo&&(S.valorIcmsSt=q.valorIcmsSt*(((e=(l=_[P])==null?void 0:l.total)!=null?e:0)/(q.subTotalProduto>0?q.subTotalProduto:1))),S.valorFreteRateado=q.valorFrete*(((n=(m=_[P])==null?void 0:m.total)!=null?n:0)/((o=q.subTotalProduto)!=null?o:1)),S.valorSeguroRateado=q.valorSeguro*(((f=(i=_[P])==null?void 0:i.total)!=null?f:0)/((r=q.subTotalProduto)!=null?r:1)),S.valorOutrasDespesasRateado=((u=q.valorOutrasDespesas)!=null?u:0)*(((g=(p=_[P])==null?void 0:p.total)!=null?g:0)/((b=q.subTotalProduto)!=null?b:1)),S.descontoTotalRateado=((v=q.totalDesconto)!=null?v:0)*(((V=(c=_[P])==null?void 0:c.total)!=null?V:0)/((s=q.subTotalProduto)!=null?s:1));let uo=0;((d=_[P])==null?void 0:d.valorIcmsSt)-((I=_[P])==null?void 0:I.valorIcms)>0&&(uo=((N=(E=_[P])==null?void 0:E.valorIcmsSt)!=null?N:0)-((A=(D=_[P])==null?void 0:D.valorIcms)!=null?A:0)),S.valorRealTotal=((O=(z=_[P])==null?void 0:z.total)!=null?O:0)*Eo+((j=(Z=_[P])==null?void 0:Z.valorIpi)!=null?j:0)+((ho=(ro=_[P])==null?void 0:ro.valorIcms)!=null?ho:0),S.valorRealTotalImpostos=((so=(io=_[P])==null?void 0:io.total)!=null?so:0)+S.valorFreteRateado+S.valorSeguroRateado+S.valorOutrasDespesasRateado-S.descontoTotalRateado+((B=(no=_[P])==null?void 0:no.valorIpi)!=null?B:0)+((oo=(G=_[P])==null?void 0:G.valorIcmsSt)!=null?oo:0),S.valorReal=S.valorRealTotalImpostos/((to=(go=_[P])==null?void 0:go.quantidade)!=null?to:1),S.valorCustoReposicao=(To=(mo=await $db.item.leNew({id:(bo=_[P])==null?void 0:bo.idItem}))==null?void 0:mo.valorCustoReposicao)!=null?To:0,await $db.documentoItem.grava({original:co,atual:S})}if(q.operacao==="Pedido de Compra")for(const P in _){let co=$utils.clonarV2(_[P]),S=$utils.clonarV2(_[P]);S.status="Finalizado",S.dataHoraFinalizado=Do,Fo&&(S.valorIcmsSt=$utils.arredondar(q.valorIcmsSt*(((zo=_[P].total)!=null?zo:0)/(q.subTotalProduto>0?q.subTotalProduto:1)))),S.valorFreteRateado=$utils.arredondar(((Uo=q.valorFrete)!=null?Uo:0)*(((Bo=_[P].total)!=null?Bo:0)/((Mo=q.subTotalProduto)!=null?Mo:1)),4),S.valorSeguroRateado=$utils.arredondar(((Oo=q.valorSeguro)!=null?Oo:0)*(((Ho=_[P].total)!=null?Ho:0)/((Ao=q.subTotalProduto)!=null?Ao:1)),4),S.valorOutrasDespesasRateado=$utils.arredondar(((Lo=q.valorOutrasDespesas)!=null?Lo:0)*(((jo=_[P].total)!=null?jo:0)/((Ro=q.subTotalProduto)!=null?Ro:1)),4),S.descontoTotalRateado=$utils.arredondar(((Xo=q.totalDesconto)!=null?Xo:0)*(((Qo=_[P].total)!=null?Qo:0)/((Go=q.subTotalProduto)!=null?Go:1)),4);let uo=0;_[P].valorIcmsSt-_[P].valorIcms>0&&(uo=$utils.arredondar((($o=_[P].valorIcmsSt)!=null?$o:0)-((Zo=_[P].valorIcms)!=null?Zo:0),2)),S.valorRealTotal=$utils.arredondar(((Wo=_[P].total)!=null?Wo:0)*Eo+((Jo=_[P].valorIpi)!=null?Jo:0)+(uo>0?uo:0),2),S.valorRealTotalImpostos=$utils.arredondar(((Ko=_[P].total)!=null?Ko:0)+S.valorFreteRateado+S.valorSeguroRateado+S.valorOutrasDespesasRateado-S.descontoTotalRateado+((Yo=_[P].valorIpi)!=null?Yo:0)+((oa=_[P].valorIcmsSt)!=null?oa:0),4),S.valorReal=$utils.arredondar(S.valorRealTotalImpostos/((aa=_[P].quantidade)!=null?aa:1),4),S.valorCustoReposicao=$utils.arredondar((ea=(await $db.item.leNew({id:_[P].idItem})).valorCustoReposicao)!=null?ea:0,2),await $db.documentoItem.grava({original:co,atual:S})}}catch(_){console.log(_.message)}},async enviar_click(){if(this.compra.operacao==="Pedido de Compra")try{$q.loading.show();const l=this.compraItens,e=(await $db.itemFornecedor.ler()).filter(m=>m.idContato===this.compra.idContato);for(let m in l){const n=l[m];if(!e.map(o=>o.idItem).includes(n.idItem)){const o={id:$utils.uuid(),idItem:n.idItem,idContato:this.compra.idContato,referencia:"",descricao:n.descricaoItem};await $db.itemFornecedor.gravar({atual:o,original:{}})}}this.compra.status="Digita\xE7\xE3o",this.compra.dataHoraFinalizado="",this.compra.operacao="Nota de Entrada",this.salvar(),this.$emit("atualizar"),this.ocultarModal(),this.$router.push({name:"Nota de Entrada",params:{id:this.compra.id}})}catch(l){$q.notifyError("Ocorreu um erro!",l)}finally{$q.loading.hide()}},async mostrar({id:l}){var e,m;this.visivel=!0,l&&(this.compraOriginal=await $db.hibrido.le({table:"documento",id:l}),this.compra=$utils.clonarV2(this.compraOriginal),this.compra.totalComImposto=!0,this.compra.calcularTributacao=(e=this.compra.calcularTributacao)!=null?e:!0,this.compra.naoGerarFinanceiro=(m=this.compra.naoGerarFinanceiro)!=null?m:!1),await this.atualizar({id:l})},fechar(){this.$router.replace({params:{id:""}}),this.compra.status==="Finalizado"?this.$emit("atualizar",{aba:"Finalizado"}):this.$emit("atualizar",{aba:"Digita\xE7\xE3o"}),this.ocultarModal(),this.dataPrevistaEntrega="",this.horaPrevistaEntrega="",this.compraOriginal={},this.compraItens=[],this.produtos=[],this.compra={id:$utils.uuid(),codigoDocumento:null,tipo:"Compra",operacao:"Pedido de Compra",status:"Digita\xE7\xE3o",codigoEmpresa:null,descricaoEmpresa:"",numeroDocumentoEmpresa:"",codigoContato:null,descricaoContato:"",codigoContatoComprador:null,codigoContatoVendedor:null,idContatoComprador:null,dataHoraEmissao:new Date,tipoFrete:"CIF",tipoTransporte:null,idEmpresa:null,idContato:null,calcularTributacao:!0,totalComImposto:!0,naoGerarFinanceiro:!1,freteSeparado:!1},this.condicoesDePagamento=[],this.formasDePagamento=[],this.documentoNovo=!1,this.exibeInfNota=!1,this.valorTotalPagamento=0},ocultarModal(){this.$router.replace({params:{id:""}}),this.visivel=!1},async abrirModalEmpresa(){const l={ativo:!0,empresas:!0},e=await $g.promptContato.show({filtro:l,placeholder:"Selecione"});if(!e)return;let m=(await $db.hibrido.lista({table:"empresa",where:{idContato:e.id}}))[0];if(!m){this.ocultarModal(),this.$q.notifyError("Erro ao selecionar empresa");return}this.contatos[e.id]||(this.contatos[e.id]=await $db.contato.le({id:e.id})),this.compra.descricaoEmpresa=m.nome,this.compra.idEmpresa=m.idContato,this.compra.codigoEmpresa=m.codigoContato,this.compra.numeroDocumentoEmpresa=m.numeroDocumentoNacional,this.compra.InscricaoMunicipalEmpresa=m.InscricaoMunicipalEmpresa},async abrirModalComprador(){const l=await this.selecionarContato({placeholder:"Selecione o comprador",filtro:{ativo:!0,compradores:!0}});l.id&&(this.compra.idContatoComprador=l.id),this.contatos[l.id]||(this.contatos[l.id]=await $db.contato.le({id:l.id}))},async abrirModalFornecedor(){const l={ativo:!0},e=await $g.promptContato.show({filtro:l,placeholder:"Selecione o fornecedor"});if(!e)return e;const m=await $db.contatoTelefone.le({idContato:e.id}),n=await $db.contatoEndereco.le({idContato:e.id}),o=m.find(r=>r.tipoTelefone==="Principal"||r.tipoTelefone==="WhatsApp")||m[0]||null,i=n.find(r=>r.grupo==="Principal")||n[0]||null;let f;return i&&Object.keys(i).length>0&&(f=`${i.logradouro}, ${i.numero} ${i.complemento} - ${i.bairro} - ${i.municipio}/${i.uf}`),e.id&&(this.compra.idContato=e.id,this.compra.codigoContato=e.codigoContato,this.compra.descricaoContato=e.nome,this.compra.numeroDocumentoContato=e.numeroDocumentoNacional,this.compra.emailContato=(e==null?void 0:e.email)||null,this.compra.regimeContato=(e==null?void 0:e.regime)||null,this.compra.telefoneContato=(o==null?void 0:o.telefone)||null,this.compra.descricaoContatoEndereco=f||null),this.contatos[e.id]||(this.contatos[e.id]=await $db.contato.le({id:e.id})),e},async abrirModalVendedor(){const l=(await $db.contato.leFilhos(this.compra.idContato)).map(m=>m.id),e=await this.selecionarContato({placeholder:"Selecione o vendedor",filtro:{ativo:!0,usuarios:l}});e.id&&(this.compra.CodigoContatoVendedor=e.codigoContato,this.compra.idContatoVendedor=e.id),this.contatos[e.id]||(this.contatos[e.id]=await $db.contato.le({id:e.id}))},async abrirModalTransportador(){const l=await this.selecionarContato({placeholder:"Selecione o transportadora",filtro:{ativo:!0,transportadoras:!0}});l.id&&(this.compra.idContatoTransportadora=l.id),this.contatos[l.id]||(this.contatos[l.id]=await $db.contato.le({id:l.id}))},async selecionarContato(l){const{placeholder:e,filtro:m}={placeholder:"Selecione o contato",filtro:{ativo:!0},...l},n=await $g.promptContato.show({filtro:m,placeholder:e});if(!n)throw new Error("Contato n\xE3o selecionado");return n},async adicionarItem(){let l={},e=[];for(const m of e)l[m.idItem]={item:await $db.hibrido.le({table:"item",id:m.idItem}),quantidade:m.quantidade};this.adicionar.modal.value=!0,this.adicionar.modal.name="Item"},async selecionarItens(l){var e,m,n;for(const o in l){let i=await $db.hibrido.lista({table:"estoqueSaldoProdutoEmpresa",where:{idEmpresa:this.compra.idEmpresa,tipoEstoque:"Dispon\xEDvel",idItem:o}});i=i[0];const f=await $db.configuracoes.porNome("vendas.checaestoque",this.compra.idEmpresa);Number((e=f.find(V=>V.id))==null?void 0:e.valor);const r=l[o].item||{},u=l[o].quantidade||0,p=(m=(r==null?void 0:r.valorCustoReposicao)||(i==null?void 0:i.valorCustoMedio))!=null?m:0;let g=this.compraItens.find(V=>V.idItem===o);const b=(await $erp().cfop.where({cfop:5102}).toArray())[0],v=(await $erp().configuracoes.where({nome:"financeiro.planocontas.comprageral"}).toArray())[0],c=(await $erp().financeiroPlanoConta.where({codigoFinanceiroPlanoConta:Number(v==null?void 0:v.valor)}).toArray())[0];if(g)g.quantidade=$utils.arredondar(u,4),g.quantidadeRealizado=$utils.arredondar(u,4),g.subTotal=$utils.arredondar(p,2),g.total=$utils.arredondar(u*p,2);else{let V={dataHoraEmissao:$utils.dataAtual(),dataHoraFinalizado:"",descricaoItem:r.descricao,id:$utils.uuid(),idDocumento:this.compra.id,idItem:r.id,codigoItem:r.codigoItem,referencia:r.referencia,operacao:"Compra de Mercadoria",operacaoFator:1,idCfop:b==null?void 0:b.id,idPlanoContaEstoque:c==null?void 0:c.id,quantidade:$utils.arredondar(u,4),quantidadeRealizado:$utils.arredondar(u,4),status:"Digita\xE7\xE3o",tipoItem:r.tipo,subTotal:$utils.arredondar(p,2),total:$utils.arredondar(u*p,2),unidade:r.unidade,valorCustoMedio:(n=i==null?void 0:i.valorCustoMedio)!=null?n:0,valorItem:p,valorOriginal:p};this.produtos[r.id]=await $db.item.leCompleto({id:r.id}),this.compraItens.push(V),await this.processarImagem(this.compraItens)}this.compra.subTotal=0,this.compra.subTotalProduto=0;for(let V in this.compraItens)this.compra.subTotal+=this.compraItens[V].total,this.compra.subTotalProduto+=this.compraItens[V].total;this.compra.subTotal=$utils.arredondar(this.compra.subTotal,2),this.compra.totalDocumento=this.compra.subTotal}},calcularTotaisItem(l,e){var g,b,v,c,V,s,d;const m=$utils.clonarV2(this.compraItens[l]),n=(g=m.valorOriginal)!=null?g:0,o=(b=m.quantidade)!=null?b:0;let i=(v=m.valorItem)!=null?v:0,f=(c=m.descontoPercentualItem)!=null?c:0,r=(V=m.descontoItem)!=null?V:0,u=(s=m.subTotal)!=null?s:0,p=(d=m.total)!=null?d:0;e==="descontoPercentualItem"&&((f<0||f>100)&&(f=0),r=i*f/100,u=i-r),e==="descontoItem"&&((r<0||r>i)&&(r=0),f=r/i*100,u=i-r),e==="valorItem"&&(i<n&&(i=n),r>i&&(r=0,f=0),u=i-r),e==="subTotal"&&((u<0||u>i)&&(u=i),r=i-u,f=r/i*100),p=o*u,m.valorItem=i,m.descontoItem=r,m.descontoPercentualItem=f,m.subTotal=u,m.total=p,this.compraItens[l]=m,this.calcularTotais()},calcularTotais(l){var s,d,I,E,N,D,A,z,O,Z;const e=$utils.clonarV2(this.compra);let m=0,n=0,o=0,i=(s=e.totalDesconto)!=null?s:0,f=(d=e.totalPercentualDesconto)!=null?d:0,r=(I=e.valorFrete)!=null?I:0,u=(E=e.valorSeguro)!=null?E:0,p=(N=e.valorOutrasDespesas)!=null?N:0,g=0,b=0,v=0,c=0,V=0;this.erroFrete=!1,this.erroSeguro=!1,this.erroOutrasDespesas=!1;for(const j of this.compraItens)m+=j.total,g+=(D=j.valorBaseIcms)!=null?D:0,b+=(A=j.valorIcms)!=null?A:0,v+=(z=j.valorBaseIcmsSt)!=null?z:0,c+=(O=j.valorIcmsSt)!=null?O:0,V+=(Z=j.valorIpi)!=null?Z:0;l==="totalPercentualDesconto"&&(this.erroDesconto=!1,(f<0||f>100)&&(this.erroDesconto=!0),i=m*f/100),l==="totalDesconto"&&(this.erroDesconto=!1,(i<0||i>m)&&(this.erroDesconto=!0),f=i/m*100),r<0&&(this.erroFrete=!0),r=e.tipoFrete==="FOB"?r:0,u<0&&(this.erroSeguro=!0),u=e.tipoFrete==="FOB"?u:0,p<0&&(this.erroOutrasDespesas=!0),e.calcularTributacao||(g=0,b=0,v=0,c=0),e.totalComImposto||(V=0),n=m-i+r+u+p,o=n+V+c,e.valorBaseIcms=$utils.arredondar(g,2),e.valorIcms=$utils.arredondar(b),e.valorBaseIcmsSt=$utils.arredondar(v),e.valorIcmsSt=$utils.arredondar(c),e.valorIPI=$utils.arredondar(V),e.totalDesconto=$utils.arredondar(i),e.totalPercentualDesconto=$utils.arredondar(f),e.subTotalProduto=$utils.arredondar(m),e.totalProduto=$utils.arredondar(m)-$utils.arredondar(i),e.subTotal=$utils.arredondar(n),e.totalDocumento=$utils.arredondar(o),this.compra=e},async salvar(){try{this.compra.totalComImposto&&delete this.compra.totalComImposto,await $db.documento.grava({original:this.compraOriginal,atual:this.compra}),await $db.documentoItem.remove(this.compraItensOriginal.filter(e=>!this.compraItens.find(m=>m.id===e.id)));for(const e of this.compraItens){const m=this.compraItensOriginal.find(n=>n.id===e.id);await $db.documentoItem.grava({original:m,atual:e})}const l=await $db.hibrido.lista({table:"documentoCondicaoPagamento",where:{idDocumento:this.compra.id}});for(const e of this.condicoesDePagamento){const m=l.find(o=>o.id===e.id),n=$utils.clonarV2(e);await $db.documentoCondicaoPagamento.grava({original:$utils.clonarV2(m),atual:n})}for(const e of l)this.condicoesDePagamento.some(n=>n.id===e.id)||await $db.documentoCondicaoPagamento.remover(e.id);this.compra.totalComImposto=!0}catch(l){console.log(l.message)}},async retornarParaDigitacao(){$q.loading.show();try{if(this.compra.status!=="Finalizado")throw new Error("N\xE3o foi possivel reabrir o documento");this.compra.dataHoraFinalizado="",this.compra.status="Digita\xE7\xE3o",await this.retornarItensParaDigitacao(),this.compra.naoGerarFinanceiro||await this.removerTitulosAPagar(),await this.salvar(),this.compraOriginal=$utils.clonarV2(this.compra),this.$q.notify({message:"A compra foi re-aberta para digita\xE7\xE3o",timeout:500,type:"positive"})}catch(l){console.log(l.message)}finally{$q.loading.hide()}},async removerTitulosAPagar(){try{const l=await $db.hibrido.lista({table:"FinanceiroMovimentacao",where:{documentoId:this.compra.id}}),e=await $db.hibrido.lista({table:"financeiroTitulo",where:{documentoId:this.compra.id}});await $db.hibrido.remove(l,"FinanceiroMovimentacao"),await $db.hibrido.remove(e,"financeiroTitulo")}catch(l){console.log(l.message)}},async retornarItensParaDigitacao(){var l;try{const e=await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:(l=this.compra)==null?void 0:l.id}});for(let m in e){let n=$utils.clonarV2(e[m]),o=$utils.clonarV2(e[m]);o.status="Digita\xE7\xE3o",o.dataHoraFinalizado="",await $db.documentoItem.grava({original:n,atual:o})}}catch(e){console.log(e.message)}},async alterarPagamento(l){try{const e=await $db.hibrido.le({table:"documentoCondicaoPagamento",id:l==null?void 0:l.id});await $db.documentoCondicaoPagamento.grava({original:e,atual:l})}catch(e){console.log(e.message)}},async removerPagamento(l){try{this.condicoesDePagamento=this.condicoesDePagamento.filter(e=>e.id!==l.id),this.condicoesDePagamento.sort((e,m)=>{let n=new Date(e.dataVencimento),o=new Date(m.dataVencimento);return n-o}),await this.atualizaValorTotalPagamento({condicao:l,acao:"remover"})}catch(e){console.log(e.message)}},async gerarCondicoesDePagamento(){var l;try{let e=this.compra.id,m=this.compra.codigoDocumento,n=this.compra.condicaoPagamento,o=(l=this.compra.notaNumero)!=null?l:null;this.compra.naoGerarFinanceiro||await this.gerarParcelamento(e,n,o),this.compra.naoGerarFinanceiro&&(this.condicoesDePagamento=[])}catch(e){console.log(e.message)}finally{}},async gerarParcelamento(l,e,m){var b,v,c,V;this.condicoesDePagamento=[];const n=$utils.clonarV2(this.compra),o=e.split("/").length,i=!!(n!=null&&n.dataCompra)&&(n==null?void 0:n.dataCompra)!==""?n.dataCompra:!!(n!=null&&n.dataHoraPrevisto)&&(n==null?void 0:n.dataHoraPrevisto)!==""?n.dataHoraPrevisto:!!this.dataPrevistaEntrega&&this.dataPrevistaEntrega!==""?new Date(this.dataPrevistaEntrega):$utils.dataAtual(),f=(b=n==null?void 0:n.freteSeparado)!=null?b:0;let r=$utils.arredondar(n==null?void 0:n.totalDocumento,2);const u=((v=n==null?void 0:n.valorFrete)!=null?v:0)+((c=n==null?void 0:n.valorSeguro)!=null?c:0);if(f&&(n==null?void 0:n.tipoFrete)==="FOB"&&u>0){let s={id:$utils.uuid(),codigoDocumento:n==null?void 0:n.codigoDocumento,idDocumento:n==null?void 0:n.id,dataVencimento:i,valor:u,observacao:"Valor Frete + Seguro",freteSeparado:!0};this.condicoesDePagamento.push(s),r-=u}let p=0,g=r/o;for(let s in e.split("/")){let d=!!(n!=null&&n.dataCompra)&&(n==null?void 0:n.dataCompra)!==""?n.dataCompra:!!(n!=null&&n.dataHoraPrevisto)&&(n==null?void 0:n.dataHoraPrevisto)!==""?n.dataHoraPrevisto:!!this.dataPrevistaEntrega&&this.dataPrevistaEntrega!==""?new Date(this.dataPrevistaEntrega):$utils.dataAtual();typeof d=="string"&&(d=(V=new Date(d))!=null?V:$utils.dataAtual()),d.setDate(d.getDate()+parseInt(e.split("/")[s]));let I={id:$utils.uuid(),codigoDocumento:n==null?void 0:n.codigoDocumento,idDocumento:n==null?void 0:n.id,dataVencimento:ia.formatDate(d),valor:g,observacao:""};this.condicoesDePagamento.push(I),p+=g!=null?g:0}r!==p&&(this.condicoesDePagamento[0].valor+=(r!=null?r:0)-(p!=null?p:0)),this.valorTotalPagamento=f&&(n==null?void 0:n.tipoFrete)==="FOB"?r+u:r},async gerarFinanceiro(l){var e,m,n;try{if(!l)throw new Error("idDocumento n\xE3o fornecido");const o=await $db.hibrido.le({table:"documento",id:l});if(!o)throw new Error("N\xE3o foi poss\xEDvel obter o documento");const i=o.idEmpresa,f=o.idContato,r=(e=o.notaNumero)!=null?e:0,u=(m=o.observacaoFaturamento)!=null?m:"",p=new Date,g=o.totalDocumento,b=(await $db.configuracoes.le({nome:"financeiro.planocontas.comprageral"}))[0],v=await $db.financeiroPlanoConta.leV2({codigoFinanceiroPlanoConta:Number(b.valor)}),c=0;let V=(n=o.formadePagamento)!=null?n:"",s=`Provisionamento de pedido de compra ${o.observacaoFaturamento||""}`;r!==0&&(s=`${s} | Nota nro: ${r}`),V=`${V}`;let d=[],I=0,D=(await(await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:o.id}})).filter(z=>z.idPlanoContaEstoque!==(v==null?void 0:v.id))).map(z=>{var O,Z,j;return{idPlanoContaEstoque:(O=z==null?void 0:z.idPlanoContaEstoque)!=null?O:null,totalItem:((Z=z.total)!=null?Z:0)-((j=z.descontoTotalRateado)!=null?j:0)}});D=[...new Set(D.map(z=>z))];for(let z in D)if(d.some(O=>O.idPlanoContaEstoque===D[z].codigoPlanoContaEstoque)){let O=d.findIndex(Z=>Z.idPlanoContaEstoque===D[z].codigoPlanoContaEstoque);d[O].valor+=D[z].totalItem}else d.push({idPlanoContaEstoque:D[z].idPlanoContaEstoque,idPlanoContaDestino:"",valor:D[z].totalItem,porcentagem:0});d.length>0&&(d[0].porcentagem=$utils.arredondar(d[0].valor/g,4)),this.financeiroGerarNotaEntrada(o.id,o.operacao,u,0,c,g,f,V,p,o.codigoDocumento,o.operacao,v,0,i,d);const A={atual:$utils.clonarV2(o),original:$utils.clonarV2(o)};A.atual.provisaoCompra=1,await $db.documento.grava({original:A.original,atual:A.atual})}catch(o){$q.notifyError(o)}},async financeiroGerarNotaEntrada(l,e,m,n,o,i,f,r,u,p,g,b,v,c,V){var s,d,I;try{if(!l)throw new Error("N\xE3o foi informado o Id do documento");if(!await $db.hibrido.le({table:"documento",id:l}))throw new Error("N\xE3o foi possivel recuperar o documento");const N=parseInt((await $db.hibrido.lista({table:"configuracoes",where:{nome:"financeiro.planocontas.freteaquisicao"}}))[0].valor),D=(await $db.hibrido.lista({table:"financeiroPlanoConta",where:{codigoFinanceiroPlanoConta:N}}))[0],A=await $db.hibrido.lista({table:"financeiroTitulo",where:{documentoId:l}});let z=[];for(let B in A)A[B].dataPagamento&&z.push(A[B]);if(z.length>0)throw new Error("N\xE3o \xE9 poss\xEDvel regerar o Financeiro. Parcelas provisionadas j\xE1 pagas!");z.length<=0&&A.length>0&&await $db.hibrido.remove(A,"financeiroTitulo");const O=await $db.hibrido.lista({table:"documentoCondicaoPagamento",where:{idDocumento:l}});O.sort(function(B,G){return new Date(B.dataVencimento)-new Date(G.dataVencimento)});const Z=O.length;for(let B in O){const G=(s=O[B].observacao)!=null?s:"",oo={id:$utils.uuid(),idFinanceiroPlanoConta:G==="Valor Frete + Seguro"?D.id:b==null?void 0:b.id,codigoFinanceiroPlanoConta:G==="Valor Frete + Seguro"?D.codigoFinanceiroPlanoConta:b==null?void 0:b.valor,dataEmissao:new Date().setHours(0,0,0,0),dataCompetencia:new Date(u).setHours(0,0,0,0),dataVencimento:new Date(O[B].dataVencimento).setHours(0,0,0,0),dataVencimentoOriginal:new Date(O[B].dataVencimento).setHours(0,0,0,0),valor:$utils.arredondar(O[B].valor,2),valorMulta:0,percentualJuros:0,documentoId:l,documentoTipo:g,parcela:`${Number(B)+1}/${Z}`,descricao:e,observacao:`${G}`,documentoVinculado:1,receberPagar:n,valorDesconto:0,percentualDesconto:0,idEmpresa:c,idContato:((d=O[B])==null?void 0:d.freteSeparado)&&!!this.compra.idContatoTransportadora?this.compra.idContatoTransportadora:f,formaDePagamento:`Provis\xE3o Pedido - ${r}`};await $db.financeiroTitulo.grava({atual:oo,original:{}})}let j=await $db.financeiroMovimentacao.le();j=j.map(B=>{var G;return(G=B==null?void 0:B.codigoFinanceiroMovimentacaoN)!=null?G:0});const ro=((I=Math.max.apply(null,j))!=null?I:0)+1,ho=await $db.configuracoes.le({nome:"financeiro.planocontas.comprageral"}),io=await $db.financeiroPlanoConta.le();let so="",no="";io.forEach(B=>{B.codigoFinanceiroPlanoConta===ho[0].valor&&(so=B.id,no=B.descrContaCG)});for(let B in V){const G=V[B].idPlanoContaEstoque,oo=V[B].porcentagem,go={id:$utils.uuid(),codigoFinanceiroMovimentacaoN:ro,idEmpresa:c,idFinanceiroPlanoConta:so,dataEmissao:new Date().setHours(0,0,0,0),valorCredito:i*oo,valorDebito:0,descricao:no,observacao:"Contabiliza\xE7\xE3o automatica",automatico:0,liquidando:0,dataCompetencia:new Date().setHours(0,0,0,0),dataVencimento:new Date().setHours(0,0,0,0),dataMovimento:new Date().setHours(0,0,0,0),documentoTipo:g,documentoId:l};await $db.financeiroMovimentacao.grava({atual:go,original:{}});let to="";io.forEach(mo=>{mo.idFinanceiroPlanoConta===G&&(to=mo.descricao)});const bo={id:$utils.uuid(),codigoFinanceiroMovimentacaoN:ro,idEmpresa:c,codigoFinanceiroPlanoConta:to,dataEmissao:new Date().setHours(0,0,0,0),valorCredito:0,valorDebito:i*oo,descricao:to,observacao:"Contabiliza\xE7\xE3o automatica",automatico:0,liquidando:0,dataCompetencia:new Date().setHours(0,0,0,0),dataVencimento:new Date().setHours(0,0,0,0),dataMovimento:new Date().setHours(0,0,0,0),documentoTipo:g,documentoId:l};await $db.financeiroMovimentacao.grava({atual:bo,original:{}})}}catch(E){console.log(E.message)}},async processarImagem(l){if(!!l){for(const e of l)if(!this.itensImagens.hasOwnProperty(e.idItem)){const m=await $db.item.leCompleto({id:e.idItem});Object.keys(m.atual).length>0&&(m.atual.imagem===""||m.atual.imagem)?this.itensImagens[e.idItem]={imagem:m.atual.imagem}:Object.keys(m.original).length>0&&(m.original.imagem===""||m.original.imagem)&&(this.itensImagens[e.idItem]={imagem:m.original.imagem})}}},async atualizaValorTotalPagamento({condicao:l,acao:e}){!l||e==="remover"&&(this.valorTotalPagamento=this.valorTotalPagamento-l.valor)}},mounted(){}},za={class:"row items-center"},Ua={class:"col-auto"},Ba={class:"col-auto"};function Ma(l,e,m,n,o,i){const f=k("g-label"),r=k("g-col"),u=k("Badge"),p=k("BadgeCopiarUid"),g=k("g-row"),b=k("avatar"),v=k("campo"),c=k("ModalEditarProdutoCompras"),V=k("PromptItemV2");return C(),L(W,null,[a(_o,{modelValue:o.visivel,"onUpdate:modelValue":e[34]||(e[34]=s=>o.visivel=s),persistent:"",maximized:"",onKeyup:pa(i.fechar,["esc"])},{default:t(()=>[a(Vo,{container:"",class:"bg-light"},{default:t(()=>[a(wo,null,{default:t(()=>[a(lo,null,{default:t(()=>[a(U,{onClick:i.fechar,icon:"arrow_back",flat:"",round:"",dense:""},null,8,["onClick"]),a(fo,null,{default:t(()=>[h(w(o.compra.operacao),1)]),_:1}),M(a(U,{onClick:i.salvar_click,label:"Salvar",color:"white","text-color":"primary",unelevated:"",class:"q-ml-sm"},null,8,["onClick"]),[[Q,o.compra.status==="Digita\xE7\xE3o"]])]),_:1})]),_:1}),a(yo,{class:"u-container"},{default:t(()=>[a(g,{gutter:"md",mg:"md",bg:"bg-white"},{default:t(()=>[a(r,{col:"12 sm12 md6"},{default:t(()=>[a(g,{items:"center",justify:"end",class:"hideondesktop"},{default:t(()=>[a(r,{col:"xs-shrink",order:"1 sm0"},{default:t(()=>[M(a(f,{text:"caption",icon:"mdi-calendar-today sm tertiary left",tip:`Emitido \xE1s ${l.$filters.hora(o.compra.dataHoraEmissao)}`},{default:t(()=>[h(w(l.$filters.data(o.compra.dataHoraEmissao)),1)]),_:1},8,["tip"]),[[Q,o.compra.dataHoraEmissao]])]),_:1}),a(r,{col:"xs-shrink",order:"1 sm0"},{default:t(()=>[M(a(f,{text:"caption",icon:"mdi-calendar-today sm tertiary left",tip:`Finalizado \xE1s ${l.$filters.hora(o.compra.dataHoraFinalizado)}`},{default:t(()=>[h(w(l.$filters.data(o.compra.dataHoraFinalizado)),1)]),_:1},8,["tip"]),[[Q,o.compra.dataHoraFinalizado]])]),_:1}),a(r,{col:"xs12 sm-shrink",order:"0 sm1",text:"right"},{default:t(()=>[a(u,{cor:o.compra.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:o.compra.status!=="Digita\xE7\xE3o",class:"q-ml-sm"},{default:t(()=>[h(w(o.compra.status),1)]),_:1},8,["cor","escuro"]),o.compra.numero?(C(),y(p,{key:0,cor:"positive",escuro:"",class:"q-ml-sm",id:o.compra.id,numero:o.compra.id.slice(-8)},null,8,["id","numero"])):(C(),y(p,{key:1,id:o.compra.id,numero:o.compra.id.slice(-8),cor:"positive",class:"q-ml-sm"},null,8,["id","numero"]))]),_:1})]),_:1}),a(g,null,{default:t(()=>[a(r,{col:"12 sm6"},{default:t(()=>[a(g,null,{default:t(()=>[a(r,{col:"xs-shrink"},{default:t(()=>[a(b,{imagem:(o.contatos[o.compra.idContato]||{}).imagem,rotulo:(o.contatos[o.compra.idContato]||{}).apelido,tamanho:"50"},null,8,["imagem","rotulo"])]),_:1}),a(r,{col:"xs"},{default:t(()=>[a(v,{modelValue:(o.contatos[o.compra.idContato]||{}).apelido,"onUpdate:modelValue":e[0]||(e[0]=s=>(o.contatos[o.compra.idContato]||{}).apelido=s),after:[{icon:"edit",handler(){i.abrirModalFornecedor()}}],disable:o.compra.status!=="Digita\xE7\xE3o",rotulo:"Fornecedor",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","after","disable"])]),_:1})]),_:1})]),_:1}),a(r,{col:"12 sm6"},{default:t(()=>[a(v,{modelValue:(o.contatos[o.compra.idContatoVendedor]||{}).apelido,"onUpdate:modelValue":e[1]||(e[1]=s=>(o.contatos[o.compra.idContatoVendedor]||{}).apelido=s),disable:o.compra.status!=="Digita\xE7\xE3o",after:[{icon:"edit",handler(){i.abrirModalVendedor()}}],rotulo:"Vendedor",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable","after"])]),_:1}),a(r,{col:"12 sm6"},{default:t(()=>[a(v,{modelValue:(o.contatos[o.compra.idEmpresa]||{}).apelido,"onUpdate:modelValue":e[2]||(e[2]=s=>(o.contatos[o.compra.idEmpresa]||{}).apelido=s),after:[{icon:"edit",handler(){i.abrirModalEmpresa()}}],disable:o.compra.status!=="Digita\xE7\xE3o",rotulo:"Empresa",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","after","disable"])]),_:1}),a(r,{col:"12 sm6"},{default:t(()=>[a(v,{modelValue:(o.contatos[o.compra.idContatoComprador]||{}).apelido,"onUpdate:modelValue":e[3]||(e[3]=s=>(o.contatos[o.compra.idContatoComprador]||{}).apelido=s),disable:o.compra.status!=="Digita\xE7\xE3o",after:[{icon:"edit",handler(){i.abrirModalComprador()}}],rotulo:"Comprador",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable","after"])]),_:1}),a(r,{col:"12 sm6"},{default:t(()=>[a(v,{modelValue:(o.contatos[o.compra.idContatoTransportadora]||{}).apelido,"onUpdate:modelValue":e[4]||(e[4]=s=>(o.contatos[o.compra.idContatoTransportadora]||{}).apelido=s),disable:o.compra.status!=="Digita\xE7\xE3o",after:[{icon:"edit",handler(){i.abrirModalTransportador()}}],rotulo:"Transportadora",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable","after"])]),_:1}),a(r,{col:"12 sm6"},{default:t(()=>[a(g,null,{default:t(()=>[a(r,{col:"7"},{default:t(()=>[a(xo,{modelValue:o.dataPrevistaEntrega,"onUpdate:modelValue":e[5]||(e[5]=s=>o.dataPrevistaEntrega=s),disable:o.compra.status!=="Digita\xE7\xE3o",type:"date",label:"Data Prevista de Entrega",clearable:"",dense:"","stack-label":"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable"])]),_:1}),a(r,{col:"5"},{default:t(()=>[a(xo,{modelValue:o.horaPrevistaEntrega,"onUpdate:modelValue":e[6]||(e[6]=s=>o.horaPrevistaEntrega=s),disable:o.compra.status!=="Digita\xE7\xE3o",type:"time",label:"Hora Prevista de Entrega",clearable:"",dense:"","stack-label":"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(r,{col:"12 sm12 md6"},{default:t(()=>[a(g,{justify:"end",items:"center",text:"right",class:"hideonmobile"},{default:t(()=>[a(r,{col:"12"},{default:t(()=>[a(u,{cor:o.compra.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:o.compra.status!=="Digita\xE7\xE3o",class:"q-ml-sm"},{default:t(()=>[h(w(o.compra.status),1)]),_:1},8,["cor","escuro"]),o.compra.numero?(C(),y(u,{key:0,cor:"positive",escuro:"",class:"q-ml-sm"},{default:t(()=>[h("#"+w(o.compra.numero.toString().padStart(6,"0")),1)]),_:1})):(C(),y(p,{key:1,id:o.compra.id,numero:o.compra.id.slice(-8),cor:"positive",class:"q-ml-sm"},null,8,["id","numero"]))]),_:1}),a(r,{col:"shrink"},{default:t(()=>[M(a(f,{text:"caption",icon:"mdi-calendar-today sm tertiary left",tip:`Emitido \xE1s ${l.$filters.hora(o.compra.dataHoraEmissao)}`},{default:t(()=>[h(w(l.$filters.data(o.compra.dataHoraEmissao)),1)]),_:1},8,["tip"]),[[Q,o.compra.dataHoraEmissao]])]),_:1}),a(r,{col:"shrink"},{default:t(()=>[M(a(f,{text:"caption",icon:"mdi-calendar sm tertiary left",tip:`Finalizado \xE1s ${l.$filters.hora(o.compra.dataHoraFinalizado)}`},{default:t(()=>[h(w(l.$filters.data(o.compra.dataHoraFinalizado)),1)]),_:1},8,["tip"]),[[Q,o.compra.dataHoraFinalizado]])]),_:1})]),_:1}),a(g,null,{default:t(()=>[a(r,null,{default:t(()=>[a(v,{modelValue:o.compra.observacao,"onUpdate:modelValue":e[7]||(e[7]=s=>o.compra.observacao=s),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",tipo:"textoArea",rotulo:"Observa\xE7\xE3o",rows:"4"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})]),_:1})]),_:1}),a(g,{gutter:"md",mg:"md",bg:"bg-white"},{default:t(()=>[o.exibeInfNota?(C(),y(Ia,{key:0,"default-opened":o.compra.notaNumero>0||o.documentoNovo,"header-class":"q-px-sm",class:"notaEntrada g-col col-12"},{header:t(()=>[a(F,null,{default:t(()=>[a(f,{text:"sub1 medium",icon:"mdi-file-replace sm tertiary left"},{default:t(()=>[h("Nota de Entrada")]),_:1})]),_:1})]),default:t(()=>[a(r,{col:"12"},{default:t(()=>[a(g,null,{default:t(()=>[a(r,{col:"12 sm6 md3"},{default:t(()=>[a(v,{modelValue:o.compra.notaNumero,"onUpdate:modelValue":e[8]||(e[8]=s=>o.compra.notaNumero=s),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Numero",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),a(r,{col:"12 sm6 md3"},{default:t(()=>[a(v,{modelValue:o.compra.notaSerie,"onUpdate:modelValue":e[9]||(e[9]=s=>o.compra.notaSerie=s),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Serie",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),a(r,{col:"12 sm6 md3"},{default:t(()=>[a(v,{modelValue:o.compra.naturezaOperacao,"onUpdate:modelValue":e[10]||(e[10]=s=>o.compra.naturezaOperacao=s),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Natureza da Opera\xE7\xE3o",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),a(r,{col:"12 sm6 md3"},{default:t(()=>[a(v,{modelValue:o.compra.dataCompra,"onUpdate:modelValue":e[11]||(e[11]=s=>o.compra.dataCompra=s),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Data compra",tipo:"data",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),a(r,{col:"12"},{default:t(()=>[a(v,{modelValue:o.compra.chaveAcesso,"onUpdate:modelValue":e[12]||(e[12]=s=>o.compra.chaveAcesso=s),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Chave",dense:""},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})]),_:1})]),_:1},8,["default-opened"])):T("",!0)]),_:1}),a(g,{gutter:"md",mg:"md",bg:"bg-white"},{default:t(()=>[a(r,{col:"12"},{default:t(()=>[a(f,{text:"sub1 medium",icon:"shopping_cart sm tertiary left"},{default:t(()=>[h("Carrinhos "),a(U,{onClick:e[13]||(e[13]=s=>i.adicionarItem()),disable:o.compra.status!=="Digita\xE7\xE3o",icon:"add",label:"Produto",size:"md",color:"primary",flat:"",dense:"",class:"float-right q-px-sm"},null,8,["disable"])]),_:1})]),_:1}),(C(!0),L(W,null,eo(o.compraItens,(s,d)=>(C(),y(r,{col:"12",key:d},{default:t(()=>[a(Y,{class:"full-width"},{default:t(()=>[a(X,{class:"q-px-none"},{default:t(()=>{var I;return[a(F,{avatar:"",class:"col-auto"},{default:t(()=>[a(b,{imagem:(o.itensImagens[s.idItem]||{}).imagem,rotulo:s.descricaoItem,tamanho:"50"},null,8,["imagem","rotulo"])]),_:2},1024),a(F,{class:"q-px-none"},{default:t(()=>[a(H,null,{default:t(()=>[h(w(s.descricaoItem),1)]),_:2},1024),a(H,{caption:""},{default:t(()=>{var E,N;return[h(w((N=(E=o.produtos[s.idItem])==null?void 0:E.marca)!=null?N:""),1)]}),_:2},1024)]),_:2},1024),M(a(F,{avatar:""},{default:t(()=>[a(u,{denso:""},{default:t(()=>{var E,N;return[h(w((N=(E=o.produtos[s.idItem])==null?void 0:E.referencia)!=null?N:""),1)]}),_:2},1024)]),_:2},1536),[[Q,(I=o.produtos[s.idItem])==null?void 0:I.referencia]]),a(F,{avatar:""},{default:t(()=>[x("div",za,[x("div",Ua,[a(U,{color:"primary",dense:"",flat:"",icon:"edit",round:"",onClick:E=>i.editarProduto(s),disable:o.compra.status!=="Digita\xE7\xE3o"},null,8,["onClick","disable"])]),x("div",Ba,[a(U,{color:"tertiary",dense:"",flat:"",icon:"delete",round:"",onClick:E=>i.removerItem(s),disable:o.compra.status!=="Digita\xE7\xE3o"},{default:t(()=>[a($,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[h("Remover Item")]),_:1})]),_:2},1032,["onClick","disable"])])])]),_:2},1024)]}),_:2},1024)]),_:2},1024),a(g,null,{default:t(()=>[a(r,{col:"4 md"},{default:t(()=>[a(v,{dense:"",align:"left",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"",rotulo:"Valor do produto",modelValue:s.valorItem,"onUpdate:modelValue":I=>s.valorItem=I,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",onBlur:I=>i.calcularTotaisItem(d,"valorItem")},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),_:2},1024),a(r,{col:"4 md"},{default:t(()=>[a(g,{items:"center"},{default:t(()=>[a(r,{col:"shrink"},{default:t(()=>[a(R,{name:"mdi-minus",color:"primary"})]),_:1}),a(r,{col:"xs"},{default:t(()=>[a(v,{dense:"",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",rotulo:"Desconto percentual",modelValue:s.descontoPercentualItem,"onUpdate:modelValue":I=>s.descontoPercentualItem=I,outlined:"",suffix:"%","somente-leitura":o.compra.status!=="Digita\xE7\xE3o",onBlur:I=>i.calcularTotaisItem(d,"descontoPercentualItem")},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(r,{col:"4 md"},{default:t(()=>[a(v,{dense:"",tipo:"decimal",modelValue:s.descontoItem,"onUpdate:modelValue":I=>s.descontoItem=I,decimals:"4",zerosDireita:"2",outlined:"",rotulo:"Desconto em reais",prefix:"R$",onBlur:I=>i.calcularTotaisItem(d,"descontoItem"),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","onBlur","somente-leitura"])]),_:2},1024),a(r,{col:"6 md"},{default:t(()=>[a(g,{items:"center"},{default:t(()=>[a(r,{col:"shrink",class:"hideonmobile"},{default:t(()=>[a(R,{name:"mdi-equal",color:"primary"})]),_:1}),a(r,{col:"xs"},{default:t(()=>[a(v,{dense:"",outlined:"",opcoes:{maximumValue:10,minimumValue:0},rotulo:"Subtotal",tipo:"decimal",decimals:"4",zerosDireita:"2",modelValue:s.subTotal,"onUpdate:modelValue":I=>s.subTotal=I,onBlur:I=>i.calcularTotaisItem(d,"subTotal"),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","onBlur","somente-leitura"])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(r,{col:"6 md"},{default:t(()=>[a(g,{items:"center"},{default:t(()=>[a(r,{col:"shrink"},{default:t(()=>[a(R,{name:"mdi-close",color:"primary"})]),_:1}),a(r,{col:"xs"},{default:t(()=>[a(v,{dense:"",max:"100",min:"0",outlined:"",modelValue:s.quantidade,"onUpdate:modelValue":I=>s.quantidade=I,decimals:"4",zerosDireita:"0",tipo:"quantidade",onBlur:I=>i.calcularTotaisItem(d),disable:o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","onBlur","disable"]),a($,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[h("Quantidade")]),_:1})]),_:2},1024)]),_:2},1024)]),_:2},1024),a(r,{col:"12 md"},{default:t(()=>[a(g,{items:"center"},{default:t(()=>[a(r,{col:"shrink",class:"hideonmobile"},{default:t(()=>[a(R,{name:"mdi-equal",color:"primary"})]),_:1}),a(r,{col:"xs"},{default:t(()=>[a(v,{dense:"",tipo:"decimal",decimals:"2",rotulo:"Total","somente-leitura":!0,modelValue:s.total,"onUpdate:modelValue":I=>s.total=I,outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),a(r,{col:"12"},{default:t(()=>[a(g,{gutter:"md",mg:"md-y",justify:"end",items:"center",bg:"bg-light","rounded-borders":"","min-height":"49px"},{default:t(()=>[a(r,{col:"3 sm2 md-shrink",text:"bold"},{default:t(()=>[h(" Calcular ")]),_:1}),a(r,{col:"9 sm10 md"},{default:t(()=>[a(ao,{modelValue:o.compra.calcularTributacao,"onUpdate:modelValue":[e[14]||(e[14]=s=>o.compra.calcularTributacao=s),i.calcularTotais],"checked-icon":"check",color:"green","unchecked-icon":"clear",disable:o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),a(r,{col:"6 md-shrink"},{default:t(()=>[h(" Base ICMS ")]),_:1}),a(r,{col:"6 md",text:"right"},{default:t(()=>[a(v,{dense:"",outlined:"",decimals:"2",zerosDireita:"2",tipo:"decimal",modelValue:o.compra.valorBaseIcms,"onUpdate:modelValue":e[15]||(e[15]=s=>o.compra.valorBaseIcms=s),somenteLeitura:o.compra.calcularTributacao||o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somenteLeitura"])]),_:1}),a(r,{col:"6 md-shrink"},{default:t(()=>[h(" Valor ICMS ")]),_:1}),a(r,{col:"6 md",text:"right"},{default:t(()=>[a(v,{dense:"",outlined:"",modelValue:o.compra.valorIcms,"onUpdate:modelValue":e[16]||(e[16]=s=>o.compra.valorIcms=s),decimals:"2",zerosDireita:"2",tipo:"decimal",somenteLeitura:o.compra.calcularTributacao||o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somenteLeitura"])]),_:1}),a(r,{col:"6 md-shrink"},{default:t(()=>[h(" Base ICMS ST ")]),_:1}),a(r,{col:"6 md",text:"right"},{default:t(()=>[a(v,{dense:"",outlined:"",modelValue:o.compra.valorBaseIcmsSt,"onUpdate:modelValue":e[17]||(e[17]=s=>o.compra.valorBaseIcmsSt=s),decimals:"2",zerosDireita:"2",tipo:"decimal",somenteLeitura:o.compra.calcularTributacao||o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somenteLeitura"])]),_:1}),a(r,{col:"6 md-shrink"},{default:t(()=>[h(" ICMS ST ")]),_:1}),a(r,{col:"6 md",text:"right"},{default:t(()=>[a(v,{dense:"",outlined:"",modelValue:o.compra.valorIcmsSt,"onUpdate:modelValue":e[18]||(e[18]=s=>o.compra.valorIcmsSt=s),decimals:"2",zerosDireita:"2",tipo:"decimal",somenteLeitura:o.compra.calcularTributacao||o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somenteLeitura"])]),_:1})]),_:1}),a(g,{mg:"lg-t",justify:"end"},{default:t(()=>[a(r,{col:"xs12 sm8 md4"},{default:t(()=>[a(g,{items:"center"},{default:t(()=>[a(r,{col:"3",text:"bold"},{default:t(()=>[h(" Subtotal ")]),_:1}),a(r,{col:"xs",text:"right bold"},{default:t(()=>[h(w(l.$filters.numero(o.compra.subTotalProduto,2)),1)]),_:1})]),_:1}),a(ko,{class:"q-mb-md q-mt-xs"}),a(g,{items:"center"},{default:t(()=>[a(r,{col:"xs3"},{default:t(()=>[h(" Desconto ")]),_:1}),a(r,{col:"xs"},{default:t(()=>[a(v,{tipo:"decimal",decimals:"2",modelValue:o.compra.totalPercentualDesconto,"onUpdate:modelValue":e[19]||(e[19]=s=>o.compra.totalPercentualDesconto=s),onBlur:e[20]||(e[20]=s=>i.calcularTotais("totalPercentualDesconto")),suffix:"%",error:o.erroDesconto,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","error","somente-leitura"])]),_:1}),a(r,{col:"xs"},{default:t(()=>[a(v,{tipo:"decimal",decimals:"2",modelValue:o.compra.totalDesconto,"onUpdate:modelValue":e[21]||(e[21]=s=>o.compra.totalDesconto=s),onBlur:e[22]||(e[22]=s=>i.calcularTotais("totalDesconto")),error:o.erroDesconto,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","error","somente-leitura"])]),_:1})]),_:1}),a(g,{items:"center"},{default:t(()=>[a(r,{col:"xs3"},{default:t(()=>[h(" Frete ")]),_:1}),a(r,{col:"xs"},{default:t(()=>[a(sa,{class:"q-mr-md",label:"CIF",val:"CIF",modelValue:o.compra.tipoFrete,"onUpdate:modelValue":[e[23]||(e[23]=s=>o.compra.tipoFrete=s),i.calcularTotais],dense:"",disable:o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","disable"]),a(sa,{label:"FOB",val:"FOB",modelValue:o.compra.tipoFrete,"onUpdate:modelValue":[e[24]||(e[24]=s=>o.compra.tipoFrete=s),i.calcularTotais],dense:"",disable:o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),a(r,{col:"xs"},{default:t(()=>[a(v,{tipo:"decimal",decimals:"2",modelValue:o.compra.valorFrete,"onUpdate:modelValue":e[25]||(e[25]=s=>o.compra.valorFrete=s),onBlur:i.calcularTotais,error:o.erroFrete,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onBlur","error","somente-leitura"])]),_:1})]),_:1}),a(g,{items:"center"},{default:t(()=>[a(r,{col:"xs3"},{default:t(()=>[h(" Seguro ")]),_:1}),a(r,{col:"xs"},{default:t(()=>[a(v,{tipo:"decimal",decimals:"2",modelValue:o.compra.valorSeguro,"onUpdate:modelValue":e[26]||(e[26]=s=>o.compra.valorSeguro=s),onBlur:i.calcularTotais,error:o.erroSeguro,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onBlur","error","somente-leitura"])]),_:1})]),_:1}),a(g,{items:"center"},{default:t(()=>[a(r,{col:"xs5"},{default:t(()=>[h(" Outras despesas ")]),_:1}),a(r,{col:"xs"},{default:t(()=>[a(v,{tipo:"decimal",decimals:"2",modelValue:o.compra.valorOutrasDespesas,"onUpdate:modelValue":e[27]||(e[27]=s=>o.compra.valorOutrasDespesas=s),onBlur:i.calcularTotais,error:o.erroOutrasDespesas,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onBlur","error","somente-leitura"])]),_:1})]),_:1}),a(ko,{class:"q-mt-md q-mb-xs"}),a(g,{items:"center"},{default:t(()=>[a(r,{col:"xs4",text:"bold"},{default:t(()=>[h(" Total ")]),_:1}),a(r,{col:"xs",text:"right bold"},{default:t(()=>[h(w(l.$filters.numero(o.compra.subTotal,2)),1)]),_:1})]),_:1}),o.compra.totalComImposto?(C(),y(g,{key:0,items:"center"},{default:t(()=>[a(r,{col:"xs4",text:"bold"},{default:t(()=>[h(" Total IPI ")]),_:1}),a(r,{col:"xs",text:"right bold"},{default:t(()=>[h(w(l.$filters.numero(o.compra.valorIPI,2)),1)]),_:1})]),_:1})):T("",!0),o.compra.totalComImposto?(C(),y(g,{key:1,items:"center"},{default:t(()=>[a(r,{col:"xs4",text:"bold"},{default:t(()=>[h(" Total ICMS ST ")]),_:1}),a(r,{col:"xs",text:"right bold"},{default:t(()=>[h(w(l.$filters.numero(o.compra.valorIcmsSt,2)),1)]),_:1})]),_:1})):T("",!0),a(g,{items:"center"},{default:t(()=>[a(r,{col:"xs5",text:"bold"},{default:t(()=>[h(" Total c/ Impostos ")]),_:1}),a(r,{col:"xs-shrink"},{default:t(()=>[a(ao,{disable:o.compra.status!=="Digita\xE7\xE3o",modelValue:o.compra.totalComImposto,"onUpdate:modelValue":[e[28]||(e[28]=s=>o.compra.totalComImposto=s),i.calcularTotais],"checked-icon":"check",color:"green","unchecked-icon":"clear"},null,8,["disable","modelValue","onUpdate:modelValue"])]),_:1}),a(r,{col:"xs",text:"right bold"},{default:t(()=>[h(w(l.$filters.numero(o.compra.totalDocumento,2)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(g,{gutter:"md",mg:"md",bg:"bg-white"},{default:t(()=>[a(r,{col:"12"},{default:t(()=>[a(f,{text:"sub1 medium",icon:"credit_card sm tertiary left"},{default:t(()=>[h("Faturar")]),_:1})]),_:1}),a(r,{col:"12"},{default:t(()=>[a(v,{modelValue:o.compra.observacaoFaturamento,"onUpdate:modelValue":e[29]||(e[29]=s=>o.compra.observacaoFaturamento=s),tipo:"textoArea",rotulo:"Observa\xE7\xE3o faturamento",rows:"5"},null,8,["modelValue"])]),_:1}),a(r,{col:"12"},{default:t(()=>[a(Ca,{ref:"formAdicionarPagamento"},{default:t(()=>[a(g,{mg:"md-y",items:"center"},{default:t(()=>[a(r,{col:"12 sm6 md"},{default:t(()=>[a(v,{modelValue:o.compra.formadePagamento,"onUpdate:modelValue":e[30]||(e[30]=s=>o.compra.formadePagamento=s),rules:o.formaPagamentoRules,ajuda:"Exemplo: Boleto","somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Forma de pagamento",tipo:"text"},null,8,["modelValue","rules","somente-leitura"])]),_:1}),a(r,{col:"12 sm6 md"},{default:t(()=>[a(v,{modelValue:o.compra.condicaoPagamento,"onUpdate:modelValue":e[31]||(e[31]=s=>o.compra.condicaoPagamento=s),rules:o.condicaoPagamentoRules,ajuda:"Exemplo: 28/56/64","somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Cond. Pag",tipo:"numero"},null,8,["modelValue","rules","somente-leitura"])]),_:1}),a(r,{col:"12 sm4 md",text:"bold",class:"q-my-sm"},{default:t(()=>[h(" Frete Separado "),a(ao,{modelValue:o.compra.freteSeparado,"onUpdate:modelValue":[e[32]||(e[32]=s=>o.compra.freteSeparado=s),i.calcularTotais],disable:o.compra.status!=="Digita\xE7\xE3o",dense:"",class:"q-ml-sm"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),a(r,{col:"12 sm4 md",text:"bold",class:"q-my-sm"},{default:t(()=>[h(" N\xE3o gerar financeiro "),a(ao,{modelValue:o.compra.naoGerarFinanceiro,"onUpdate:modelValue":[e[33]||(e[33]=s=>o.compra.naoGerarFinanceiro=s),i.calcularTotais],disable:o.compra.status!=="Digita\xE7\xE3o",dense:"",class:"q-ml-sm"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),a(r,{col:"12 sm4 md",text:"center"},{default:t(()=>[a(U,{onClick:i.gerarCondicoesDePagamento,disable:o.compra.status!=="Digita\xE7\xE3o",color:"positive",icon:"add",label:"Forma de pagamento",outline:"",size:"sm"},null,8,["onClick","disable"])]),_:1})]),_:1})]),_:1},512)]),_:1}),a(r,{col:"12"},{default:t(()=>[M(a(f,{text:"sub1 medium"},{default:t(()=>[h("Condi\xE7\xF5es de pagamento")]),_:1},512),[[Q,o.condicoesDePagamento.length>0]]),(C(!0),L(W,null,eo(o.condicoesDePagamento,s=>(C(),y(Y,{highlight:"",class:"q-pa-none",key:s.id},{default:t(()=>[a(g,{gutter:"md",mg:"sm-y",items:"center",bordered:"","rounded-borders":""},{default:t(()=>[a(r,{col:"xs6 md-shrink"},{default:t(()=>[a(v,{modelValue:s.dataVencimento,"onUpdate:modelValue":d=>s.dataVencimento=d,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Data vencimento",tipo:"data",dense:""},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024),a(r,{col:"xs6 md2"},{default:t(()=>[a(v,{modelValue:s.valor,"onUpdate:modelValue":d=>s.valor=d,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",align:"left",rotulo:"Valor",decimals:"2",zerosDireita:"2",tipo:"decimal"},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024),a(r,{col:"xs-grow"},{default:t(()=>[a(v,{modelValue:s.observacao,"onUpdate:modelValue":d=>s.observacao=d,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"||s.observacao==="Valor Frete + Seguro",tipo:"text",rotulo:"Observa\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024),a(r,{col:"xs-shrink",text:"right"},{default:t(()=>[a(U,{onClick:d=>i.removerPagamento(s),icon:"delete",round:"",dense:"",flat:"",color:"tertiary",disable:o.compra.status!=="Digita\xE7\xE3o"},null,8,["onClick","disable"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),o.valorTotalPagamento>0?(C(),y(g,{key:0,mg:"sm-t"},{default:t(()=>[a(r,{col:"xs-shrink",text:"bold"},{default:t(()=>[h(" Valor total: "+w(l.$filters.numero(o.valorTotalPagamento,2)),1)]),_:1})]),_:1})):T("",!0)]),_:1})]),_:1})]),_:1}),a(No,{class:"bg-light",bordered:""},{default:t(()=>[a(lo,{class:"bg-light text-tertiary q-pa-sm u-container"},{default:t(()=>[a(fo,null,{default:t(()=>[h(" Valor Total: "+w(l.$filters.numero(o.compra.totalDocumento,2))+" --- SKU(s): "+w(i.skus),1)]),_:1}),a(ma),M(a(U,{class:"q-ml-sm",color:"white","text-color":"negative",flat:"",label:"Excluir",type:"submit",onClick:i.excluir_click},null,8,["onClick"]),[[Q,o.compra.status==="Digita\xE7\xE3o"]]),M(a(U,{class:"q-ml-sm",color:"primary",unelevated:"",label:"Finalizar",type:"submit",onClick:i.finalizar_click},null,8,["onClick"]),[[Q,o.compra.status==="Digita\xE7\xE3o"]]),M(a(U,{class:"q-ml-sm",color:"tertiary",flat:"",label:"Reabrir",type:"submit",onClick:i.retornarParaDigitacao},null,8,["onClick"]),[[Q,o.compra.status==="Finalizado"]]),M(a(U,{class:"q-ml-sm",color:"primary",unelevated:"",label:"Transformar em Nota de Compra",type:"submit",onClick:i.enviar_click},null,8,["onClick"]),[[Q,o.compra.status==="Finalizado"&&o.compra.operacao==="Pedido de Compra"]])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onKeyup"]),a(c,{ref:"ModalEditarProdutoCompras",onSalvar:i.fecharEdicaoProduto},null,8,["onSalvar"]),a(V,{modelValue:o.adicionar.modal.value,"onUpdate:modelValue":e[35]||(e[35]=s=>o.adicionar.modal.value=s),habilitarQuantidade:!0,filtro:{ativo:!0,idEmpresa:o.compra.idEmpresa},exibirValorVenda:!1,calculaItemCusto:!0,onSelecionarItens:i.selecionarItens,ref:"promptItem"},null,8,["modelValue","filtro","onSelecionarItens"])],64)}var Oa=Co(Ta,[["render",Ma]]);const Ha={components:{PromptItemV2:ua},data(){return{mostrarItemModal:!1,idxItem:0,compraOriginal:{},compra:{id:$utils.uuid(),codigoDocumento:null,tipo:"Compra",operacao:"Pedido de Compra",status:"Digita\xE7\xE3o",codigoEmpresa:null,descricaoEmpresa:"",numeroDocumentoEmpresa:"",codigoContato:null,descricaoContato:"",codigoContatoComprador:null,codigoContatoVendedor:null,idContatoComprador:null,dataHoraEmissao:new Date,tipoFrete:"CIF",tipoTransporte:null,idEmpresa:null,idContato:null,calcularTributacao:!1,totalComImposto:!1,naoGerarFinanceiro:!1,freteSeparado:!1},compraItens:[],produtos:[],visivel:!1,somenteLeitura:!1}},emits:["atualizar"],methods:{editarProduto(l,e,m){l.referencia=this.produtos[l.idItem].referencia,this.$refs.ModalEditarProdutoCompras.mostrar(l,e,m)},async atualizar(l,e){try{this.$q.loading.show(),this.compraItens=e,this.visivel=!0,this.$q.notifyInfo("Existe produtos da nota de entrada n\xE3o cadastrados no sistema.")}catch(m){console.log(m.message)}finally{this.$q.loading.hide()}},verificarSeAlterouCampos(){return $utils.diferencaObjetos(this.compraOriginal,this.compra)},async mostrar(l,e){this.visivel=!0,l.id&&(this.compraOriginal=await $db.hibrido.le({table:"documento",id:l.id}),this.compra=$utils.clonarV2(this.compraOriginal)),await this.atualizar(l,e)},fechar(){this.$emit("atualizar"),this.visivel=!1},async selecionarItens(l){this.compraItens[this.idxItem].idItem=Object.keys(l)[0],this.compraItens[this.idxItem].itemAssociadoDescricao=l[Object.keys(l)[0]].item.descricao,this.compraItens[this.idxItem].itemCompra.idItem=Object.keys(l)[0];try{const e={id:$utils.uuid(),idItem:this.compraItens[this.idxItem].itemCompra.idItem,idContato:this.compra.idContato,referencia:this.compraItens[this.idxItem].referencia,descricao:this.compraItens[this.idxItem].descricaoItem};await $db.itemFornecedor.gravar({atual:e,original:{}}),await $db.documentoItem.grava({original:{},atual:this.compraItens[this.idxItem].itemCompra}),this.compraItens.splice(this.idxItem,1)}catch(e){console.log(e.error)}this.mostrarItemModal=!1},async recalcularItem(l){var f;let e=(f=this.compraItens[l].valorPreCusto)!=null?f:0,m=0,n=0,o=0,i=0;this.compraItens[l].ipi>0&&(m=e*(this.compraItens[l].ipi/100)),this.compraItens[l].st>0&&(n=e*(this.compraItens[l].st/100)),this.compraItens[l].difal>0&&(o=e*(this.compraItens[l].difal/100)),this.compraItens[l].valorCustoReposicao=e+m+n+o,this.compraItens[l].margemLucro>0&&(i=this.compraItens[l].valorCustoReposicao*(this.compraItens[l].margemLucro/100)),this.compraItens[l].percentualMarkup=this.compraItens[l].margemLucro,this.compraItens[l].valorVenda=this.compraItens[l].valorCustoReposicao+i},async addNovoItem(l,e){const m={id:$utils.uuid(),idContato:this.compra.idContato,descricao:l.descricaoItem,descricaoConcatenada:l.descricaoItem,referencia:"",codigoBarras:l.itemCompra.codigoBarras,ncm:l.itemCompra.ncm,codigoNCM:"",CEST:"",unidade:l.unidade,valorCustoReposicao:l.valorCustoReposicao,valorVenda:l.valorVenda,percentualMarkup:l.percentualMarkup},n={id:$utils.uuid(),idItem:m.id,idContato:this.compra.idContato,referencia:l.referencia,descricao:l.descricaoItem};try{const o=await $db.item.gravaItem({original:{},atual:m}),i=await $db.itemFornecedor.gravar({original:{},atual:n});l.itemCompra.idItem=m.id,l.itemCompra.dataHoraEmissao=new Date(l.itemCompra.dataHoraEmissao).toISOString(),await $db.documentoItem.grava({original:{},atual:l.itemCompra}),this.compraItens.splice(e,1)}catch(o){console.log(o.message)}},async finalizar_click(){console.log(this.compraItens.length),this.compraItens.length>0?$q.notifyError("Antes de continuar verifique todos os itens!"):(this.mostrarItemModal=!1,this.visivel=!1,this.$router.replace({params:{id:this.compra.id}}),this.$refs.fichaCompra.mostrar({id:this.compra.id}))}}},Aa={class:"layout-padding q-pa-none q-pb-md"},La={class:"u-container"},ja=x("p",{class:"q-my-none text-body1"},[h("Estes produtos n\xE3o foram identificados em seu banco de dados e constam no XML que est\xE1 importando."),x("br"),x("br"),h(" Cada produto deve ser vinculado a um j\xE1 cadastrado (atrav\xE9s do campo abaixo em cada um) ou criado atrav\xE9s do bot\xE3o [+ Novo] "),x("br"),x("br"),h(" Ao finalizar todos, clique em [Continuar] para terminar o processo de importa\xE7\xE3o da nota de compra na tela de Compras. ")],-1),Ra=["id"],Xa={class:"col-12"},Qa={class:"col-4 col-md"},Ga={class:"col-4 col-md"},$a={class:"col-4 col-md"},Za={class:"col-6 col-md"},Wa={class:"col-12 col-md"},Ja={class:"col-6 col-md"},Ka={class:"col-12 col-md"},Ya={class:"col-12"},oe={class:"col-12 col-md-4"},ae=x("div",{class:"col-12 col-md-auto"},"ou",-1),ee={class:"col-12 col-md-auto q-pl-none"},te={class:"u-container relative-position"};function le(l,e,m,n,o,i){const f=k("campo"),r=k("row"),u=k("PromptItemV2");return C(),L("div",null,[a(_o,{modelValue:o.visivel,"onUpdate:modelValue":e[0]||(e[0]=p=>o.visivel=p),persistent:"",maximized:"",onKeyup:pa(i.fechar,["esc"])},{default:t(()=>[a(Vo,{container:"",class:"bg-light"},{default:t(()=>[a(wo,null,{default:t(()=>[a(lo,null,{default:t(()=>[a(U,{icon:"arrow_back",flat:"",round:"",dense:"",onClick:i.fechar},null,8,["onClick"]),a(fo,null,{default:t(()=>[h("Importar XML x Cadastro")]),_:1})]),_:1})]),_:1}),a(yo,null,{default:t(()=>[x("div",Aa,[x("div",La,[a(na,{class:"q-pa-md q-mt-md bg-transparent no-shadow"},{default:t(()=>[ja]),_:1}),(C(!0),L(W,null,eo(o.compraItens,(p,g)=>(C(),y(na,{key:p.id,class:"q-pa-md q-mt-md bg-white no-shadow"},{default:t(()=>[x("div",{class:"items-carrinho items-center row q-py-sm",id:g},[a(Y,{class:"full-width"},{default:t(()=>[a(X,{class:"q-px-none"},{default:t(()=>[a(F,{class:"q-px-none"},{default:t(()=>[a(H,null,{default:t(()=>[a(f,{dense:"",align:"left",tipo:"texto",outlined:"",ajuda:"With placeholder",rotulo:"Descri\xE7\xE3o Item",modelValue:p.descricaoItem,"onUpdate:modelValue":b=>p.descricaoItem=b},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),a(F,null,{default:t(()=>[a(H,null,{default:t(()=>[a(f,{dense:"",align:"left",tipo:"texto",outlined:"",ajuda:"With placeholder",rotulo:"Marca",modelValue:p.marca,"onUpdate:modelValue":b=>p.marca=b},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),a(F,null,{default:t(()=>[a(H,null,{default:t(()=>[a(f,{dense:"",align:"left",tipo:"texto",outlined:"",ajuda:"With placeholder",rotulo:"Referencia",modelValue:p.referencia,"onUpdate:modelValue":b=>p.referencia=b},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),x("div",Xa,[a(r,{class:"q-col-gutter-sm"},{default:t(()=>[x("div",Qa,[a(f,{dense:"",align:"left",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"",ajuda:"With placeholder",rotulo:"Valor pr\xE9 custo",modelValue:p.valorPreCusto,"onUpdate:modelValue":b=>p.valorPreCusto=b},null,8,["modelValue","onUpdate:modelValue"])]),x("div",Ga,[a(f,{dense:"",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",ajuda:"With placeholder",rotulo:"IPI",modelValue:p.ipi,"onUpdate:modelValue":b=>p.ipi=b,outlined:"",suffix:"%",onBlur:b=>i.recalcularItem(g)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),x("div",$a,[a(f,{dense:"",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",ajuda:"With placeholder",rotulo:"ST",modelValue:p.st,"onUpdate:modelValue":b=>p.st=b,outlined:"",suffix:"%",onBlur:b=>i.recalcularItem(g)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),x("div",Za,[a(f,{dense:"",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",ajuda:"With placeholder",rotulo:"DIFAL",modelValue:p.difal,"onUpdate:modelValue":b=>p.difal=b,outlined:"",suffix:"%",onBlur:b=>i.recalcularItem(g)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),x("div",Wa,[a(f,{dense:"",align:"left",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"",ajuda:"With placeholder",rotulo:"Custo de reposi\xE7\xE3o",modelValue:p.valorCustoReposicao,"onUpdate:modelValue":b=>p.valorCustoReposicao=b},null,8,["modelValue","onUpdate:modelValue"])]),x("div",Ja,[a(f,{dense:"",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",ajuda:"With placeholder",rotulo:"Margem de Lucro",modelValue:p.margemLucro,"onUpdate:modelValue":b=>p.margemLucro=b,outlined:"",suffix:"%",onBlur:b=>i.recalcularItem(g)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),x("div",Ka,[a(f,{dense:"",align:"left",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"",ajuda:"With placeholder",rotulo:"Valor de Venda",modelValue:p.valorVenda,"onUpdate:modelValue":b=>p.valorVenda=b},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1024)]),x("div",Ya,[a(r,{class:"q-mt-lg text-right full-width justify-end items-center"},{default:t(()=>[x("div",oe,[a(xo,{debounce:500,modelValue:p.itemAssociadoDescricao,"onUpdate:modelValue":[b=>p.itemAssociadoDescricao=b,l.buscaCampo_change],placeholder:"Vincular produto",standout:"",filled:"",dense:"",clearable:"","clear-icon":"close",class:"items-center"},{append:t(()=>[a(R,{name:"search",onClick:()=>{o.mostrarItemModal=!o.mostrarItemModal,o.idxItem=g},class:"cursor-pointer text-tertiary"},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),ae,x("div",ee,[a(U,{class:"q-ml-sm no-shadow",color:"primary",icon:"add",unelevated:"",label:"Novo",type:"submit",onClick:b=>i.addNovoItem(p,g)},null,8,["onClick"])])]),_:2},1024)])],8,Ra)]),_:2},1024))),128))])])]),_:1}),a(No,{class:"bg-light no-shadow q-pa-sm text-right u-bordaCima"},{default:t(()=>[x("div",te,[a(U,{class:"q-ml-sm no-shadow",color:"primary",icon:"send",unelevated:"",label:"Continuar",type:"submit",onClick:i.finalizar_click},null,8,["onClick"])])]),_:1})]),_:1})]),_:1},8,["modelValue","onKeyup"]),a(u,{modelValue:o.mostrarItemModal,"onUpdate:modelValue":e[1]||(e[1]=p=>o.mostrarItemModal=p),habilitarQuantidade:!0,filtro:{ativo:!0,idEmpresa:o.compra.idEmpresa},exibirValorVenda:!1,onSelecionarItens:i.selecionarItens,ref:"promptItem"},null,8,["modelValue","filtro","onSelecionarItens"])])}var re=Co(Ha,[["render",le]]);const Io={paginacao:{atual:1,maximo:1,total:1,limite:25},filtros:{numero:"",numeroCompra:null,termoBusca:"",periodoEmissao:{ini:"",fim:""},periodoFinalizado:{ini:"",fim:""},fornecedor:{id:"",nome:""}}},ie={components:{Avatar:ca,BadgeCopiarUid:fa,Ficha:Oa,ImportacaoXML:re,Lista:Pa},data(){return{showPeriodo:!1,lista:[],tabsVertical:[],resultado:{},paginacao:$utils.clonarV2(Io.paginacao),filtros:$utils.clonarV2(Io.filtros),buscaCampo:"",tabSelecionada:{valor:"Digita\xE7\xE3o"},tabSelecionada2:{valor:"Pedido de Compra"},tabs:[{rotulo:"Digita\xE7\xE3o",value:"Digita\xE7\xE3o"},{rotulo:"Finalizado",value:"Finalizado"},{rotulo:"Todos",value:"Todos"}],tabs2:[{rotulo:"Pedido de Compra",value:"Pedido de Compra"},{rotulo:"Nota de Entrada",value:"Nota de Entrada"},{rotulo:"Nota no SEFAZ",value:"Nota no SEFAZ"}],xmlDevolucao:!1,modalXMLNotaEntrada:!1,xmlNotaEntrada:{},configImpressao:[],abrirNotadeEntrada:null}},props:{permissaoNovo:{default:!0,type:Boolean},corBotao:{default:()=>"primary",type:String}},methods:{importarXml_click(){this.modalXMLNotaEntrada=!0},adicionarXml(l){this.xmlNotaEntrada.arquivo=l[0]},async dialogProtocoloSefaz(){return new Promise(l=>{$q.dialog({title:"Aviso importante",message:"O XML que est\xE1 sendo importado n\xE3o foi protocolado pela Sefaz, gostaria de importar o XML sem o protocolo?",cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-primary",textColor:"white",flat:!0},persistent:!0}).onOk(()=>{l(!0)}).onCancel(()=>{l(!1)})})},async importarXmlNotaDeEntrada(l){if(!this.xmlNotaEntrada.arquivo)return this.$q.notify({type:"warning",message:"Adicione um arquivo XML antes de enviar!"});try{const m=await(v=>new Promise((c,V)=>{const s=new FileReader;s.readAsBinaryString(v),s.onload=()=>c(s.result),s.onerror=d=>V(d)}))(this.xmlNotaEntrada.arquivo),n=new DOMParser,o=new XMLSerializer,i=n.parseFromString(m,"text/xml"),f=o.serializeToString(i),r=this;if(i.documentElement.nodeName==="html")throw new Error("Arquivo inv\xE1lido ou corrompido");const u=new Va.Parser;let p;u.parseString(f,(v,c)=>{v&&console.log(v),p=c});let g=null,b=!0;p&&p.nfeProc&&p.nfeProc.protNFe?g=p.nfeProc.protNFe[0].infProt[0].nProt[0]:g||(b=await this.dialogProtocoloSefaz()),b?(await $db.compra.importaXml({xmlString:f,tela:r}),this.$q.notify({type:"positive",message:"Importa\xE7\xE3o realizada com sucesso!"})):this.$q.notify({type:"warning",message:"Opera\xE7\xE3o para importa\xE7\xE3o de XML cancelada!"})}catch(e){this.$q.notifyError(e.message)}finally{delete this.xmlNotaEntrada.arquivo,this.modalXMLNotaEntrada=!1,this.atualizar()}},async fecharXmlNotaDeEntrada(){delete this.xmlNotaEntrada.arquivo},async atualizar(l){var e,m;try{let{buscarDadosRecentes:n}=l!=null?l:{};$q.loading.show();let o,i,f,r,u,p=["dataFinalizacao","dataHoraEmissao"],g=["desc","desc"];if(this.tabSelecionada2Anterior&&this.tabSelecionada2Anterior!==this.tabSelecionada2.valor&&(this.setOpcoesTabs(this.tabSelecionada2.valor),this.filtros=$utils.clonarV2(Io.filtros),this.paginacao=$utils.clonarV2(Io.paginacao),this.buscaCampo="",n=!0),(m=(e=this.$route)==null?void 0:e.params)!=null&&m.id||this.$router.replace({name:this.tabSelecionada2.valor}),this.tabSelecionada2Anterior=this.tabSelecionada2.valor,n&&(o=await $utils.localIDB.getItem({objectStore:"dadosRecentes",id:this.tabSelecionada2.valor}),o!=null&&o._id&&(this.filtros=o.filtros,this.buscaCampo=o.termoBusca,this.paginacao.limite=o.limit,this.paginacao.atual=o.page,p=o.sort,g=o.dir)),l!=null&&l.aba&&(this.tabSelecionada.valor=l.aba),i=$utils.eliminarVazios(this.filtros),f=this.buscaCampo,r=this.paginacao.limite,u=this.paginacao.atual,i.status=this.tabSelecionada.valor,i.operacao=this.tabSelecionada2.valor,this.showPeriodo=!1,this.tabsVertical=[],this.tabSelecionada.valor==="Todos"&&delete i.status,i.operacao==="Nota no SEFAZ"){let b=await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{tipo:"DFe",situacao:i.status}});const v=[];b.forEach(V=>{const s={id:V.id,descricaoContato:V.xNomeEmitente,dataHoraEmissao:V.dataHoraEmissao,dataHoraFinalizado:null,totalDocumento:V.vNF,qtdeContatos:null,status:V.situacao};v.push(s)});let c=(u-1)*r;this.paginacao.total=v.length,this.paginacao.maximo=Math.ceil(this.paginacao.total/r)||1,this.lista=v.splice(c,r),this.configuraImpressao(this.filtros.idEmpresa)}if(i.operacao!=="Nota no SEFAZ"){let b=await $db.compra.le({filtros:i,termoBusca:f,limit:r,page:u,sort:p,dir:g});this.paginacao.total=b.total,this.paginacao.maximo=b.totalPages,this.lista=b.data}for(let b in this.lista)this.lista.hasOwnProperty(b)&&(this.lista[b].contato=await $db.contato.le({id:this.lista[b].idContato}));o={_id:this.tabSelecionada2.valor,tabSelecionada:this.tabSelecionada.valor,filtros:$utils.clonarV2(i),termoBusca:this.buscaCampo,limit:this.paginacao.limite,page:this.paginacao.atual,sort:["dataFinalizacao","dataHoraEmissao"],dir:["desc","desc"]},await $utils.localIDB.setItem({objectStore:"dadosRecentes",data:o}),this.configuraImpressao(this.filtros.idEmpresa)}catch(n){$q.notifyError("Erro iniciar",n)}finally{$q.loading.hide()}},async abrir(l){this.tabSelecionada2.valor!=="Nota no SEFAZ"&&(this.$router.replace({params:{id:l}}),this.$refs.modalFicha.mostrar({id:l}))},criar_click(){this.$refs.modalFicha.criar()},limparFiltros_click(){this.filtros.numero="",this.filtros.termoBusca="",this.filtros.numeroCompra="",this.filtros.periodoEmissao.ini="",this.filtros.periodoEmissao.fim="",this.filtros.periodoFinalizado.ini="",this.filtros.periodoFinalizado.fim="",this.filtros.fornecedor.id=null,this.filtros.fornecedor.nome="",this.atualizar()},async configuraImpressao(l){const e=await $db.configuracoes.porNome("impressao.compra",l);this.configImpressao=[...e.length?e.map(m=>({texto:"Imprimir Compra",...m})):[{valor:"invoice",texto:"Compras e Estoque"}]]},async consultarSefaz_click(){try{let l,e,m,n,o,i,f,r;if(e=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data,!(e.length>0)){this.$q.notify({message:"N\xE3o h\xE1 empresa configurada",timeout:0,type:"negative",closeBtn:!0});return}if(l=e[0],e.length>1){const E={ativo:!0,empresas:!0};if(l=await $g.promptContato.show({filtro:E,placeholder:"Selecione a empresa"}),!l){this.visivel=!1,this.$q.notifyError("Empresa n\xE3o selecionada");return}}if(m=(await $erp().empresa.where({idContato:l.id}).toArray())[0],!m){this.visivel=!1,this.$q.notifyError("Erro ao selecionar empresa");return}m&&(n=await $db.contatoEndereco.leEnderecoPrincipal(l.id),o=await $db.configuracoes.leValorComFiltroEmpresa("compras.sefaz.nsu",m.id),o||(o="0"));const u=m.numeroDocumentoNacional.match(/\d+/g).join("");for(;o.length<15;)o=`0${o}`;const p=`<?xml version="1.0" encoding="utf-8"?><distDFeInt versao="1.01" xmlns="http://www.portalfiscal.inf.br/nfe"><tpAmb>2</tpAmb><cUFAutor>${n.ufCod}</cUFAutor><CNPJ>${u}</CNPJ><distNSU><ultNSU>${o}</ultNSU></distNSU></distDFeInt>`,g={xml:p,cnpj:u,dataHora:new Date},v={id:$utils.uuid(),tipo:"DFe",situacao:"",tpAmb:1,dhEmi:new Date,dataHoraEmissao:new Date,dataHoraCriacao:new Date,cpfCnpjEmitente:u,xNomeEmitente:m.nome,json:JSON.stringify(g)}.json,c=new Headers;c.append("Content-Type","application/json; charset=utf-8"),f=await fetch("https://api.b15.com.br/integradorjs/dfe/consultar",{method:"POST",headers:c,body:JSON.stringify({xml:p})});const V=await f.json();if(!f.ok){let E="Erro desconhecido";/GError:.+/.test(V.error)&&(E=V.error.slice(7)),$q.notifyError(E);return}if(V.cStat!=="100"){$q.notifyError(V.xMotivo);return}const s=f.dfe.retDistDFeInt,d=f.err,I=f.arquivos;if(s!==""&&Number(s==null?void 0:s.ultNSU[0])>Number(o)){const E=await $db.configuracoes.atualizaPorNome("compras.sefaz.nsu",m.id,s.ultNSU[0])}if(I){let E=0;for(let N in I)try{const D=I[N],A={id:$utils.uuid(),tipo:"DFe",situacao:"N\xE3o Importada",tpAmb:D.nfeProc.NFe[0].infNFe[0].ide[0].tpAmb[0],mod:D.nfeProc.NFe[0].infNFe[0].ide[0].mod[0],serie:D.nfeProc.NFe[0].infNFe[0].ide[0].serie[0],nNF:D.nfeProc.NFe[0].infNFe[0].ide[0].nNF[0],chNFe:D.nfeProc.protNFe[0].infProt[0].chNFe[0],vNF:D.nfeProc.NFe[0].infNFe[0].total[0].ICMSTot[0].vNF[0],dhEmi:D.nfeProc.NFe[0].infNFe[0].ide[0].dhEmi[0],dataHoraEmissao:D.nfeProc.NFe[0].infNFe[0].ide[0].dhEmi[0],dataHoraCriacao:null,dataHoraAlteracao:null,cpfCnpjEmitente:D.nfeProc.NFe[0].infNFe[0].emit[0].CNPJ[0],xNomeEmitente:D.nfeProc.NFe[0].infNFe[0].emit[0].xNome[0],xFantEmitente:D.nfeProc.NFe[0].infNFe[0].emit[0].xNome[0],cpfCnpjDestinatario:D.nfeProc.NFe[0].infNFe[0].dest[0].CNPJ[0],xNomeDestinatario:D.nfeProc.NFe[0].infNFe[0].dest[0].xNome[0],xFantDestinatario:D.nfeProc.NFe[0].infNFe[0].dest[0].xNome[0],json:JSON.stringify({xml:D.xml}),naturezaOperacao:D.nfeProc.NFe[0].infNFe[0].ide[0].natOp[0]};(await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{tipo:"DFe"}})).some(O=>O.chNFe===A.chNFe)||(await $db.documentoFiscalEletronico.grava({atual:A,original:{}}),E++)}catch(D){console.log(D.message)}this.$q.notify(`Importa\xE7\xE3o via SEFAZ Finalizada, ${E} Notas Importadas`)}}catch(l){console.log(l.message)}},setOpcoesTabs(l){l!=="Nota no SEFAZ"&&(this.tabs=[{rotulo:"Digita\xE7\xE3o",value:"Digita\xE7\xE3o"},{rotulo:"Finalizado",value:"Finalizado"},{rotulo:"Todos",value:"Todos"}],this.tabSelecionada.valor="Digita\xE7\xE3o"),l==="Nota no SEFAZ"&&(this.tabs=[{rotulo:"N\xE3o Importada",value:"N\xE3o Importada"},{rotulo:"Importada",value:"Importada"}],this.tabSelecionada.valor="N\xE3o Importada")},async downloadXmlDFe(l){const e=await $db.hibrido.le({table:"documentoFiscalEletronico",id:l}),m=JSON.parse(e.json).xml;if(m){const n=document.createElement("a"),o=new Blob([m],{type:"text/plain"});n.setAttribute("href",window.URL.createObjectURL(o)),n.setAttribute("download",`${e.chNFe}.xml`),n.dataset.downloadurl=["text/plain",n.download,n.href].join(":"),n.click()}m||this.$q.notifyError("N\xE3o foi poss\xEDvel recuperar o XML")},async importarXmlDFe(l){try{const e=await $db.hibrido.le({table:"documentoFiscalEletronico",id:l}),m=JSON.parse(e.json).xml;if(m){const n=new DOMParser,o=new XMLSerializer,i=n.parseFromString(m,"text/xml"),f=o.serializeToString(i),r=this;await $db.compra.importaXml({xmlString:f,tela:r});const u={original:$utils.clonarV2(e),atual:$utils.clonarV2(e)};u.atual.situacao="Importada",await $db.documentoFiscalEletronico.grava(u),$q.notify("XML Importado para Compras")}}catch(e){console.log(e.message),$q.notifyError("Erro ao importar XML",e)}}},watch:{$route(){var l;this.tabSelecionada2.valor=this.$route.name,this.atualizar({buscarDadosRecentes:!0}),this.$route.name==="Nota de Entrada"&&((l=this.$route.params)==null?void 0:l.id)&&this.$refs.modalFicha.mostrar({id:this.$route.params.id})}},async mounted(){this.tabSelecionada2.valor=this.$route.name,this.atualizar({buscarDadosRecentes:!0}),this.$route.name==="Nota de Entrada"&&this.$route.params.id&&this.$route.params.id.length&&this.$refs.modalFicha.mostrar({id:this.$route.params.id})}},se={class:"text-center"},ne={class:"row q-ma-md"},de={key:0,class:"row q-ma-md"},me={class:"certificado-error-messages"};function ce(l,e,m,n,o,i){const f=k("campo"),r=k("badge"),u=k("BadgeCopiarUid"),p=k("avatar"),g=k("g-label"),b=k("g-col"),v=k("g-row"),c=k("Lista",!0),V=k("Ficha"),s=k("ImportacaoXML");return C(),L("div",null,[a(c,{titulo:"Compras",icone:"factory",buscaCampo:o.buscaCampo,"onUpdate:buscaCampo":e[9]||(e[9]=d=>o.buscaCampo=d),onFiltro_change:i.atualizar,onLimparFiltros_click:i.limparFiltros_click,onCriar_click:i.criar_click,onImportarXml_click:i.importarXml_click,onConsultarSefaz_click:i.consultarSefaz_click,lista:o.lista,paginacao:o.paginacao,filtros:o.filtros,tabSelecionada:o.tabSelecionada,tabs:o.tabs,tabSelecionada2:o.tabSelecionada2,tabs2:o.tabs2,tabsVertical:o.tabsVertical,showPeriodo:o.showPeriodo,checkboxVisible:!1,removerTodosVisible:!1,abrirTodosVisible:!1,exportarXLSXVisible:!1,showQuickAdd:!1,permissaoExtras:!1},{botaoNovo:t(()=>[M(a(U,{unelevated:"",icon:"add",label:"Novo",color:m.corBotao,"text-color":"white",class:"hideonmobile"},{default:t(()=>[a(vo,null,{default:t(()=>[a(Y,{link:"","no-border":"",separator:""},{default:t(()=>[M((C(),y(X,{clickable:"",onClick:i.criar_click},{default:t(()=>[a(F,{avatar:""},{default:t(()=>[a(R,{name:"add"})]),_:1}),a(F,null,{default:t(()=>[a(H,null,{default:t(()=>[h("Incluir Manual")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[K]]),M((C(),y(X,{clickable:"",onClick:i.importarXml_click},{default:t(()=>[a(F,{avatar:""},{default:t(()=>[a(R,{name:"add"})]),_:1}),a(F,null,{default:t(()=>[a(H,null,{default:t(()=>[h("Importar XML")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[K]])]),_:1})]),_:1})]),_:1},8,["color"]),[[Q,m.permissaoNovo]]),M(a(U,{unelevated:"",icon:"add",color:m.corBotao,round:"","text-color":"white",class:"hideondesktop"},{default:t(()=>[a(vo,null,{default:t(()=>[a(Y,{link:"","no-border":"",separator:""},{default:t(()=>[M((C(),y(X,{clickable:"",onClick:i.criar_click},{default:t(()=>[a(F,{avatar:""},{default:t(()=>[a(R,{name:"add"})]),_:1}),a(F,null,{default:t(()=>[a(H,null,{default:t(()=>[h("Incluir Manual")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[K]]),M((C(),y(X,{clickable:"",onClick:i.importarXml_click},{default:t(()=>[a(F,{avatar:""},{default:t(()=>[a(R,{name:"add"})]),_:1}),a(F,null,{default:t(()=>[a(H,null,{default:t(()=>[h("Importar XML")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[K]])]),_:1})]),_:1})]),_:1},8,["color"]),[[Q,m.permissaoNovo]])]),filtroCampos:t(()=>[o.tabsVertical.length<1?(C(),L(W,{key:0},[a(f,{modelValue:o.filtros.numero,"onUpdate:modelValue":e[0]||(e[0]=d=>o.filtros.numero=d),rotulo:"N\xBA Nota",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),a(f,{modelValue:o.filtros.termoBusca,"onUpdate:modelValue":e[1]||(e[1]=d=>o.filtros.termoBusca=d),rotulo:"Palavra Chave",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),a(f,{modelValue:o.filtros.numeroCompra,"onUpdate:modelValue":e[2]||(e[2]=d=>o.filtros.numeroCompra=d),rotulo:"Ordem de compra",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),a(f,{modelValue:o.filtros.fornecedor.nome,"onUpdate:modelValue":e[3]||(e[3]=d=>o.filtros.fornecedor.nome=d),rotulo:"Fornecedor",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),a(f,{modelValue:o.filtros.periodoEmissao.ini,"onUpdate:modelValue":e[4]||(e[4]=d=>o.filtros.periodoEmissao.ini=d),rotulo:"Data Emiss\xE3o",dense:"",tipo:"data",class:"q-field--with-bottom"},null,8,["modelValue"]),a(f,{modelValue:o.filtros.periodoEmissao.fim,"onUpdate:modelValue":e[5]||(e[5]=d=>o.filtros.periodoEmissao.fim=d),rotulo:"at\xE9",dense:"",tipo:"data",class:"q-field--with-bottom"},null,8,["modelValue"]),a(f,{modelValue:o.filtros.periodoFinalizado.ini,"onUpdate:modelValue":e[6]||(e[6]=d=>o.filtros.periodoFinalizado.ini=d),rotulo:"Data Finalizado",dense:"",tipo:"data",class:"q-field--with-bottom"},null,8,["modelValue"]),a(f,{modelValue:o.filtros.periodoFinalizado.fim,"onUpdate:modelValue":e[7]||(e[7]=d=>o.filtros.periodoFinalizado.fim=d),rotulo:"at\xE9",dense:"",tipo:"data",class:"q-field--with-bottom"},null,8,["modelValue"]),a(f,{modelValue:o.paginacao.limite,"onUpdate:modelValue":e[8]||(e[8]=d=>o.paginacao.limite=d),min:"1",rotulo:"Quantidade por p\xE1gina",dense:"",tipo:"quantidade",class:"q-field--with-bottom"},null,8,["modelValue"])],64)):T("",!0),o.tabsVertical.length>0?(C(),L(W,{key:1},[h(" N\xE3o possui filtros. ")],64)):T("",!0)]),itemLista:t(()=>[o.lista.length>0&&o.tabsVertical.length<1?(C(),y(Y,{key:0,bordered:"",class:"bg-white q-mb-xs rounded-borders",style:{"min-height":"calc(100vh - 200px)"}},{default:t(()=>[(C(!0),L(W,null,eo(o.lista,d=>(C(),L("div",{key:d.id,class:"itemHover"},[a(X,{"manual-focus":"",class:"q-py-sm q-px-xs items-center"},{default:t(()=>[a(F,{class:"hideonmobile col-auto q-px-sm no-margin"},{default:t(()=>[x("div",se,[d.numero?(C(),y(r,{key:0,cor:"positive",escuro:""},{default:t(()=>[h(" #"+w(d.numero.toString().padStart(6,"0")),1)]),_:2},1024)):(C(),y(u,{key:1,id:d.id,numero:d.id.slice(-8),cor:"tertiary",escuro:""},null,8,["id","numero"])),a($,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[h("N\xFAmero da Compra")]),_:1})])]),_:2},1024),a(F,{class:"col-md col-lg col-xl no-margin"},{default:t(()=>[a(X,{class:"q-pa-none"},{default:t(()=>[a(F,{onClick:I=>i.abrir(d.id),class:"col-auto items-center"},{default:t(()=>[a(p,{imagem:d.imagem,rotulo:d.descricaoContato,tamanho:"40",style:{display:"flex","align-self":"center"}},null,8,["imagem","rotulo"])]),_:2},1032,["onClick"]),a(F,{class:"col"},{default:t(()=>[a(H,{onClick:I=>i.abrir(d.id),lines:"2",class:"text-tertiary text-weight-bold ellipsis-2-lines"},{default:t(()=>[h(w(d.descricaoContato)+" ",1),a($,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[h("Fornecedor")]),_:1})]),_:2},1032,["onClick"]),a(X,{class:"q-pa-none hideonmobile",style:{"min-height":"unset"}},{default:t(()=>[d.notaNumero?(C(),y(r,{key:0,cor:"blue",class:"mw50 text-center",escuro:""},{default:t(()=>[h(w(d.notaNumero)+" ",1),a($,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[h("N\xFAmero da Nota")]),_:1})]),_:2},1024)):(C(),y(r,{key:1,cor:"warning",class:"mw50 text-center",escuro:""},{default:t(()=>[h(" S/N "),a($,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[h("N\xFAmero da Nota")]),_:1})]),_:1}))]),_:2},1024),a(F,{class:"hideondesktop q-mt-sm"},{default:t(()=>[a(v,{mg:"xs-b"},{default:t(()=>[d.dataHoraEmissao?(C(),y(b,{key:0,col:"shrink"},{default:t(()=>[a(g,{icon:"mdi-calendar-today xs tertiary left",tip:`Emitido \xE1s ${l.$filters.hora(d.dataHoraEmissao)}`},{default:t(()=>[h(w(l.$filters.data(d.dataHoraEmissao)),1)]),_:2},1032,["tip"])]),_:2},1024)):T("",!0),d.dataHoraFinalizado?(C(),y(b,{key:1,col:"shrink",class:"q-ml-sm"},{default:t(()=>[a(g,{icon:"mdi-calendar xs tertiary left",tip:`Finalizado \xE1s ${l.$filters.hora(d.dataHoraFinalizado)}`},{default:t(()=>[h(w(l.$filters.data(d.dataHoraFinalizado)),1)]),_:2},1032,["tip"])]),_:2},1024)):T("",!0)]),_:2},1024),a(v,{mg:"xs-b"},{default:t(()=>[d.numero?(C(),y(b,{key:0,col:"shrink"},{default:t(()=>[a(r,{rotulo:`#${d.numero.toString().padStart(6,"0")}`,cor:"positive",escuro:""},null,8,["rotulo"])]),_:2},1024)):(C(),y(b,{key:1,col:"shrink"},{default:t(()=>[a(u,{id:d.id,numero:d.id.slice(-8),cor:"tertiary",escuro:""},null,8,["id","numero"])]),_:2},1024)),a(b,{col:"shrink",class:"q-ml-sm"},{default:t(()=>[d.notaNumero?(C(),y(r,{key:0,cor:"blue",class:"mw50",escuro:""},{default:t(()=>[h(w(d.notaNumero)+" ",1),a($,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[h("N\xFAmero da Nota")]),_:1})]),_:2},1024)):(C(),y(r,{key:1,cor:"warning",class:"mw50",escuro:""},{default:t(()=>[h(" S/N "),a($,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[h("N\xFAmero da Nota")]),_:1})]),_:1}))]),_:2},1024),a(b,{col:"shrink",class:"q-ml-sm"},{default:t(()=>[a(r,{rotulo:d.status,cor:d.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:d.status!=="Digita\xE7\xE3o"},null,8,["rotulo","cor","escuro"])]),_:2},1024)]),_:2},1024),a(v,null,{default:t(()=>[a(b,{col:"shrink",text:"bold"},{default:t(()=>[h(w(l.$filters.numero(d.totalDocumento,2)),1)]),_:2},1024),M(a(b,{col:"grow",text:"center",class:"q-ml-sm"},{default:t(()=>[h(w(d.qtdeContatos)+" Itens ",1)]),_:2},1536),[[Q,d.qtdeContatos>0]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(F,{onClick:I=>i.abrir(d.id),class:"hideonmobile maxw110 q-pl-sm no-margin"},{default:t(()=>[d.dataHoraEmissao?(C(),y(H,{key:0,lines:"1",color:"tertiary",class:"ellipsis"},{default:t(()=>[a(R,{name:"mdi-calendar-today"}),h(" "+w(l.$filters.data(d.dataHoraEmissao))+" ",1),a($,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[h("Emitido \xE1s "+w(l.$filters.hora(d.dataHoraEmissao)),1)]),_:2},1024)]),_:2},1024)):T("",!0),d.dataHoraFinalizado?(C(),y(H,{key:1,lines:"1",color:"tertiary",class:"ellipsis"},{default:t(()=>[a(R,{name:"mdi-calendar"}),h(" "+w(l.$filters.data(d.dataHoraFinalizado))+" ",1),a($,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[h("Finalizado \xE1s "+w(l.$filters.hora(d.dataHoraFinalizado)),1)]),_:2},1024)]),_:2},1024)):T("",!0)]),_:2},1032,["onClick"]),a(F,{onClick:I=>i.abrir(d.id),class:"hideonmobile maxw90 q-pl-sm no-margin"},{default:t(()=>[a(r,{cor:d.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:d.status!=="Digita\xE7\xE3o",class:"col-auto q-mx-auto"},{default:t(()=>[h(w(d.status)+" ",1),a($,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[h("Status")]),_:1})]),_:2},1032,["cor","escuro"])]),_:2},1032,["onClick"]),a(F,{onClick:I=>i.abrir(d.id),class:"hideonmobile maxw120 q-pl-sm no-margin"},{default:t(()=>[a(H,{class:"text-tertiary text-weight-bold text-right"},{default:t(()=>[h(w(l.$filters.numero(d.totalDocumento,2)),1)]),_:2},1024),M(a(H,{class:"text-tertiary text-right"},{default:t(()=>[h(w(d.qtdeContatos)+" Itens ",1)]),_:2},1536),[[Q,d.qtdeContatos>0]])]),_:2},1032,["onClick"]),a(F,{class:"hideonmobile col-auto q-pl-sm no-margin"},{default:t(()=>[a(X,{class:"q-pa-none"},{default:t(()=>[o.tabSelecionada2.valor!=="Nota no SEFAZ"?(C(),y(F,{key:0,class:"q-pr-sm no-margin"},{default:t(()=>[a(U,{onClick:I=>i.abrir(d.id),icon:"edit",size:"md",color:"primary",round:"",flat:"",dense:""},null,8,["onClick"])]),_:2},1024)):T("",!0),o.tabSelecionada2.valor==="Nota no SEFAZ"&&o.tabSelecionada.valor==="N\xE3o Importada"?(C(),y(F,{key:1,class:"q-pr-sm no-margin"},{default:t(()=>[a(U,{onClick:I=>i.importarXmlDFe(d.id),icon:"mdi-upload",size:"md",flat:"",round:"",dense:"",color:"tertiary",class:"buttons"},{default:t(()=>[a($,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[h("Importar XML")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):T("",!0),o.tabSelecionada2.valor==="Nota no SEFAZ"?(C(),y(F,{key:2,class:"q-pr-sm no-margin"},{default:t(()=>[a(U,{onClick:I=>i.downloadXmlDFe(d.id),color:"tertiary",dense:"",flat:"",icon:"mdi-download",round:"",size:"md",class:"buttons"},{default:t(()=>[a($,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[h("Exportar XML")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):T("",!0),a(F,{class:"no-margin"},{default:t(()=>[a(U,{icon:"print",size:"md",color:"tertiary",round:"",flat:"",dense:""},{default:t(()=>[a(vo,null,{default:t(()=>[M((C(),y(Y,{link:"","no-border":"",separator:""},{default:t(()=>[(C(!0),L(W,null,eo(o.configImpressao.filter(I=>I.valor),I=>(C(),y(X,{key:I.valor,onClick:E=>l.$imprimir(I.valor,(d==null?void 0:d.id)||"0"),clickable:""},{default:t(()=>[a(F,{avatar:""},{default:t(()=>[a(R,{name:"print"})]),_:1}),a(F,null,{default:t(()=>[a(H,null,{default:t(()=>[h(w(I.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)),[[K]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(F,{class:"hideondesktop col-auto q-pl-sm no-margin"},{default:t(()=>[a(U,{icon:"more_vert",size:"md",color:"tertiary",round:"",flat:"",dense:""},{default:t(()=>[a(vo,null,{default:t(()=>[M((C(),y(Y,{link:"","no-border":"",separator:""},{default:t(()=>[o.tabSelecionada2.valor!=="Nota no SEFAZ"?(C(),y(X,{key:0,onClick:I=>i.abrir(d.id),clickable:"",class:"itemHover"},{default:t(()=>[a(F,{avatar:""},{default:t(()=>[a(R,{name:"edit"})]),_:1}),a(F,null,{default:t(()=>[a(H,null,{default:t(()=>[h(" Editar ")]),_:1})]),_:1})]),_:2},1032,["onClick"])):T("",!0),o.tabSelecionada2.valor==="Nota no SEFAZ"&&o.tabSelecionada.valor==="N\xE3o Importada"?(C(),y(X,{key:1,onClick:I=>i.importarXmlDFe(d.id),clickable:"",class:"itemHover"},{default:t(()=>[a(F,{avatar:""},{default:t(()=>[a(R,{name:"mdi-upload"})]),_:1}),a(F,null,{default:t(()=>[a(H,null,{default:t(()=>[h(" Importar XML ")]),_:1})]),_:1})]),_:2},1032,["onClick"])):T("",!0),o.tabSelecionada2.valor==="Nota no SEFAZ"?(C(),y(X,{key:2,onClick:I=>i.downloadXmlDFe(d.id),clickable:"",class:"itemHover"},{default:t(()=>[a(F,{avatar:""},{default:t(()=>[a(R,{name:"mdi-download"})]),_:1}),a(F,null,{default:t(()=>[a(H,null,{default:t(()=>[h(" Exportar XML ")]),_:1})]),_:1})]),_:2},1032,["onClick"])):T("",!0),(C(!0),L(W,null,eo(o.configImpressao.filter(I=>I.valor),I=>(C(),y(X,{key:I.valor,onClick:E=>l.$imprimir(I.valor,(d==null?void 0:d.id)||"0"),clickable:"",class:"itemHover"},{default:t(()=>[a(F,{avatar:""},{default:t(()=>[a(R,{name:"print"})]),_:1}),a(F,null,{default:t(()=>[a(H,null,{default:t(()=>[h(w(I.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)),[[K]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(ko)]))),128))]),_:1})):T("",!0)]),_:1},8,["buscaCampo","onFiltro_change","onLimparFiltros_click","onCriar_click","onImportarXml_click","onConsultarSefaz_click","lista","paginacao","filtros","tabSelecionada","tabs","tabSelecionada2","tabs2","tabsVertical","showPeriodo"]),a(V,{ref:"modalFicha",onAtualizar:i.atualizar},null,8,["onAtualizar"]),a(s,{ref:"importacaoXML",onAtualizar:i.atualizar},null,8,["onAtualizar"]),a(_o,{modelValue:o.modalXMLNotaEntrada,"onUpdate:modelValue":e[12]||(e[12]=d=>o.modalXMLNotaEntrada=d),persistent:""},{default:t(()=>[a(Vo,{container:"",class:"bg-light",style:{height:"40vh",width:"50vw","max-width":"100vw"}},{default:t(()=>[x("form",{onSubmit:e[11]||(e[11]=wa((...d)=>i.importarXmlNotaDeEntrada&&i.importarXmlNotaDeEntrada(...d),["prevent"]))},[a(wo,null,{default:t(()=>[a(lo,null,{default:t(()=>[M(a(U,{onClick:i.fecharXmlNotaDeEntrada,flat:"",round:"",dense:"",icon:"arrow_back"},null,8,["onClick"]),[[K]]),a(fo,null,{default:t(()=>[h("Importar XML Nota de Entrada")]),_:1}),a(U,{color:"white","text-color":"primary",label:"Enviar",type:"submit",unelevated:""})]),_:1})]),_:1}),a(yo,{class:"u-container"},{default:t(()=>[a(da,null,{default:t(()=>{var d,I,E;return[x("div",ne,[a(ya,{modelValue:o.xmlDevolucao,"onUpdate:modelValue":e[10]||(e[10]=N=>o.xmlDevolucao=N),label:"Devolu\xE7\xE3o"},null,8,["modelValue"]),a(_a,{class:"col-12","hide-upload-btn":"","auto-upload":"",factory:i.adicionarXml,filter:N=>N.filter(D=>D.type==="text/xml")},null,8,["factory","filter"])]),Object.keys((E=(I=(d=o.xmlNotaEntrada.error)==null?void 0:d.data)==null?void 0:I.fields)!=null?E:{}).length?(C(),L("div",de,[x("ul",me,[(C(!0),L(W,null,eo(Object.keys(o.xmlNotaEntrada.error.data.fields),N=>(C(),L("li",{key:N},[x("span",null,w(N),1),x("span",null,w(o.xmlNotaEntrada.error.data.fields[N]),1)]))),128))])])):T("",!0)]}),_:1})]),_:1})],32)]),_:1})]),_:1},8,["modelValue"])])}var Ve=Co(ie,[["render",ce]]);export{Ve as default};
