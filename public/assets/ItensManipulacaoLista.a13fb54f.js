import{_ as Y,M as $,N as J,b2 as oo,aT as to,ci as N,ch as Z,cj as eo,R as ao,cl as L,Z as io,p as z,o as u,d as y,f as e,w as i,K as so,G as lo,A as ro,B as j,C as no,D as w,L as co,E as U,e as h,H as uo,t as m,l as g,i as _,s as G,x as l,n as K,Q as X,j as Q,k as V,ai as R,aj as F,ak as I,ah as C,am as H,F as T,r as S,I as mo,y as po,Y as O,aX as fo,U as ho,d4 as vo,bc as go,aF as _o}from"./index.5f3d4c88.js";import{l as bo}from"./listaV2.9b1f80cd.js";import{B as W}from"./BadgeCopiarUid.2d47d54f.js";import{P as yo}from"./ItensManipulacaoApontamento.049d08bf.js";import"./QBreadcrumbs.9439e2c3.js";import"./xlsx.581f1758.js";const Io={components:{Avatar:$,Badge:J,BadgeCopiarUid:W,PromptItemV2:oo,PromptApontamento:yo,SeletorCampoTabela:to},data(){return{itens:{},documentoAnterior:{},documentoItensAnterior:[],documento:{id:"",codigoDocumento:"",idEmpresa:"",codigoEmpresa:"",descricaoEmpresa:"",numeroDocumentoEmpresa:"",inscricaoMunicipalEmpresa:"",operacao:"Manipulacao",tipo:"Produ\xE7\xE3o",status:"",dataEmissao:N(),dataFinalizacao:"",observacao:""},documentoItens:[],adicionar:{modal:{name:"",value:!1}},listaApontamentos:[],apontamento:{modal:{name:"",value:!1}},totalOrigem:0,totalDestino:0,visivel:!1,promptApontamento:{},equipamentos:[],composicoes:[],quantidadeOriginal:0,contatos:[],dataPrevistaEntrega:"",horaPrevistaEntrega:"",lote:{show:!1,readonly:!1,value:""}}},emits:["atualizar"],methods:{onHide(){this.$router.replace({params:{id:""}})},zerarCampos(){this.documentoAnterior={},this.documentoItensAnterior=[],this.documento={id:Z(),idEmpresa:"",descricaoEmpresa:"",operacao:"Manipula\xE7\xE3o",tipo:"Produ\xE7\xE3o",status:"Digita\xE7\xE3o",dataHoraEmissao:N(),dataHoraFinalizado:"",observacao:""},this.documentoItens=[],this.totalOrigem=0,this.totalDestino=0,this.dataPrevistaEntrega="",this.horaPrevistaEntrega="",this.lote={show:!1,readonly:!1,value:""}},async atualizar(o){var t,r;if(this.zerarCampos(),o){if(this.documentoAnterior=await $db.itemManipulacao.le({id:o}),this.documento=$utils.clonarV2(this.documentoAnterior),this.documentoItensAnterior=await $db.itemManipulacao.leItens({idDocumento:o}),this.documentoItens=eo(this.documentoItensAnterior),(t=this.documento)!=null&&t.idContato){const d=this.documento.idContato;this.contatos[d]||(this.contatos[d]=await $db.contato.le({id:d}))}if((r=this.documento)!=null&&r.idEmpresa){const d=this.documento.idEmpresa;this.contatos[d]||(this.contatos[d]=await $db.contato.le({id:d}))}this.documento.dataHoraPrevisto&&(this.dataPrevistaEntrega=this.documento.dataHoraPrevisto.slice(0,10),this.horaPrevistaEntrega=this.documento.dataHoraPrevisto.slice(11,16));for(const d of this.documentoItens){if(!this.lote.value&&d.operacaoFator===1&&d.lote&&(this.lote.value=d.lote),!d.idItem)continue;const a=await $erp().item.get(d.idItem);!a||a.id in this.itens||(this.itens[a.id]={codigoItem:a.codigoItem,referencia:a.referencia})}}else{let d,a,n;if(a=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data,!(a.length>0)){this.$q.notify({message:"N\xE3o h\xE1 empresa configurada",timeout:0,type:"negative",closeBtn:!0});return}if(d=a[0],a.length>1){const p={ativo:!0,empresas:!0};if(d=await $g.promptContato.show({filtro:p,placeholder:"Selecione"}),!d){this.visivel=!1,this.$q.notifyError("Empresa n\xE3o selecionada");return}}if(n=(await $erp().empresa.where({idContato:d.id}).toArray())[0],!n){this.visivel=!1,this.$q.notifyError("Erro ao selecionar empresa");return}this.documento.descricaoEmpresa=n.nome,this.documento.idEmpresa=n.idContato,this.documento.numeroDocumentoEmpresa=n.numeroDocumentoNacional,this.documento.inscricaoMunicipalEmpresa=n.numeroDocumentoMunicipal}this.somarValorTotal(),this.buscarApontamentos(),await this.configLote()},async configLote(){var t,r;let o;this.usaLote=!1,this.pcpLote="",o=await $erp().configuracoes.where({nome:"usa.lote"}).toArray(),o=(t=o.find(d=>d.idEmpresa===this.documento.idEmpresa))!=null?t:o.find(d=>!d.idEmpresa),this.usaLote=(o==null?void 0:o.valor)==="1",o=await $erp().configuracoes.where({nome:"pcp.lote"}).toArray(),o=(r=o.find(d=>d.idEmpresa===this.documento.idEmpresa))!=null?r:o.find(d=>!d.idEmpresa),this.pcpLote=o==null?void 0:o.valor,this.lote.show=this.usaLote,this.lote.readonly=!!this.pcpLote,!this.lote.value&&this.pcpLote&&(this.lote.value=this.pcpLote)},async salvar(o,t){try{if(this.dataPrevistaEntrega){const r=`${this.dataPrevistaEntrega} ${this.horaPrevistaEntrega||"00:00:00"}`;this.documento.dataHoraPrevisto=ao.formatDate(r)}if(this.dataPrevistaEntrega===null&&(this.documento.dataHoraPrevisto=""),this.lote.value!==this.pcpLote)for(const r of this.documentoItens)r.operacaoFator===1&&(!r.idItem||(r.lote=this.lote.value));await $db.itemManipulacao.grava({documentoAnterior:this.documentoAnterior,documento:this.documento,documentoItensAnterior:this.documentoItensAnterior,documentoItens:this.documentoItens})}catch(r){this.$q.notifyError("Erro ao salvar",r)}await this.atualizar(this.documento.id),t&&this.$q.notify(t),o||this.$emit("atualizar"),this.visivel=o},async aguardarGeracaoNroPCP(){var r,d;let o=!0,t=0;$q.loading.show({message:"Aguardando gera\xE7\xE3o do n\xFAmero do PCP para composi\xE7\xE3o do n\xFAmero do lote."}),this.numeroPCP=null;do{await new Promise((a,n)=>setTimeout(a,1e3));try{const a=await this.$utils.geeksApi({consultaNumero:{funcao:"185D6D10-9A2A-4965-8C86-90FA2F7F73A2",id:this.documento.id}});(d=(r=a==null?void 0:a.data)==null?void 0:r.consultaNumero)!=null&&d.numero&&(this.numeroPCP=a==null?void 0:a.data.consultaNumero.numero,o=!1),++t===10&&(o=!1)}catch(a){console.error(a)}}while(o);if($q.loading.hide(),!this.numeroPCP){const a="N\xE3o foi poss\xEDvel obter o n\xFAmero do lote. Por favor, tente novamente.";throw $q.notify({type:"negative",message:a}),new Error(a)}},async gerarNroLote(){const o=new Date;if(this.pcpLote){let t=this.pcpLote;t=t.replace("AAAA",o.toISOString().slice(0,4)),t=t.replace("AA",o.toISOString().slice(2,4)),t=t.replace("MM",o.toISOString().slice(5,7)),t=t.replace("DD",o.toISOString().slice(8,10)),t=t.replace("PCP",String(this.numeroPCP)),this.lote.value=t}},async finalizar(){let o;if(o=this.verificarTotal(),!!o){if(this.usaLote&&this.pcpLote){let t=!0;for(let r of this.documentoItens)if(r.operacaoFator===1&&r.lote){t=!1;break}t&&(await this.salvar(!0),await this.aguardarGeracaoNroPCP(),await this.gerarNroLote())}this.documento.status="Finalizado",this.documento.dataHoraFinalizado=N();for(let t of this.documentoItens)t.status="Finalizado",t.dataHoraFinalizado=N();this.salvar(!1,"Produ\xE7\xE3o Finalizada")}},reabrir(){try{this.documento.status="Digita\xE7\xE3o",this.documento.dataHoraFinalizado="";for(let o of this.documentoItens)o.status="Digita\xE7\xE3o",o.dataHoraFinalizado="";this.salvar(!0,"Produ\xE7\xE3o reaberta")}catch(o){this.$q.notifyError("Erro ao reabrir",o)}},async excluirItem(o){this.documentoItens=this.documentoItens.filter(t=>t.id!==o),this.somarValorTotal()},async removerTodosItens(o){$q.dialog({title:"Remover todos os itens",message:`Deseja remover todos os itens de ${o}`,cancel:!0,persistent:!0}).onOk(()=>{let t=[];const r=o==="Destino"?1:-1;t=this.documentoItens.filter(d=>d.operacaoFator===r);for(const d of t)this.excluirItem(d.id)})},async recalcularTotal(o,t=!1){if(o.subTotal=L(o.quantidade*o.valorItem),o.total=L(o.quantidade*o.valorItem),t){let r={titulo:"Composi\xE7\xE3o",msg:"Deseja recalcular a origem?"};o.operacaoFator===1&&await this.verificarComposicao(o.idItem,o.quantidade,r)}this.somarValorTotal()},async recalcularQuantidade(o){o.quantidade=L(o.subTotal/o.valorItem),o.total=o.subTotal,this.somarValorTotal()},async recalcularValorItem(o){o.valorItem=L(o.subTotal/o.quantidade),o.total=o.subTotal,this.somarValorTotal()},somarValorTotal(){const o=this.documentoItens.filter(r=>r.operacaoFator===-1).reduce((r,d)=>r+=d.total,0),t=this.documentoItens.filter(r=>r.operacaoFator===1).reduce((r,d)=>r+=d.total,0);this.totalOrigem=$utils.arredondar(o,2),this.totalDestino=$utils.arredondar(t,2)},verificarTotal(){return this.documentoItens.length===0&&this.totalDestino===0&&this.totalOrigem===0?(this.$q.notifyError("Selecione alguns itens na lista"),!1):this.totalOrigem!==this.totalDestino?(this.$q.notifyError("Valores Totais de Origem e Destino devem ser iguais!"),!1):!0},async abrirModal(o,t=""){let r={},d=[];const a=o==="Destino"?1:-1;t?d=this.documentoItens.filter(n=>n.idItem===t):d=this.documentoItens.filter(n=>n.operacaoFator===a);for(const n of d)r[n.idItem]={item:await io().item.get(n.idItem)||{},quantidade:n.quantidade};this.$refs.promptItem.itensSelecionados=r,this.$refs.promptItem.termo=t,this.$refs.promptItem.atualizar(),this.adicionar.modal.value=!0,this.adicionar.modal.name=o},async selecionarItens(o){var d,a,n;let t={};const r=this.adicionar.modal.name==="Destino"?1:-1;for(const p in o){let b=await $db.estoqueSaldoProdutoEmpresa.le({idEmpresa:this.documento.idEmpresa,tipoEstoque:"Dispon\xEDvel",idItem:p});b=b[0];const k=await $db.configuracoes.porNome("vendas.checaestoque",this.documento.idEmpresa),q=!!Number((d=k.find(E=>E.id))==null?void 0:d.valor),f=o[p].item||{},c=o[p].quantidade||0,v=(a=(b==null?void 0:b.valorCustoMedio)||(f==null?void 0:f.valorCustoReposicao))!=null?a:0;if(f.id in this.itens||(this.itens[f.id]={codigoItem:f.codigoItem,referencia:f.referencia}),q&&r===-1&&(!(b!=null&&b.saldo)||c>(b==null?void 0:b.saldo))){this.$q.notifyError(`${f.descricao} n\xE3o dispon\xEDvel no estoque`);continue}let M=this.documentoItens.find(E=>E.idItem===p);M?(M.quantidade=c,M.quantidadeRealizado=c,M.subTotal=L(c*v),M.total=L(c*v)):this.documentoItens.push({dataHoraEmissao:N(),dataHoraFinalizado:"",descricaoItem:f.descricao,id:Z(),idDocumento:this.documento.id,idItem:f.id,operacao:"Manipula\xE7\xE3o",operacaoFator:r,quantidade:c,quantidadeRealizado:c,status:"Digita\xE7\xE3o",tipoItem:f.tipo,subTotal:L(c*v),total:L(c*v),unidade:f.unidade,valorCustoMedio:(n=b==null?void 0:b.valorCustoMedio)!=null?n:0,valorItem:v,valorOriginal:v});let s=await $db.item.leCompleto({id:f.id});!this.composicoes.includes(s.atual.composicao[0].idItemUtilizado)&&s.atual.composicao[0].idItemUtilizado!==""?(t={titulo:"Composi\xE7\xE3o",msg:"O item selecionado possui itens de composi\xE7\xE3o, deseja preencher?"},r===1&&await this.verificarComposicao(f.id,c,t)):t={}}this.somarValorTotal()},async verificarComposicao(o,t,r){var p,b;let d=[],a=await $db.item.leCompleto({id:o});(b=(p=a==null?void 0:a.atual)==null?void 0:p.composicao)==null||b.sort((k,q)=>k.ordem<q.ordem?-1:1);for(let k of a.atual.composicao)k.idItemUtilizado&&(k.quantidade=k.quantidade*t,d.push(k),this.composicoes.push(k.idItemUtilizado));const n=d.reduce((k,q)=>(k[q.idItemUtilizado]||(k[q.idItemUtilizado]=q),k),{});r.titulo?$q.dialog({title:r.titulo,message:r.msg,cancel:!0,persistent:!0}).onOk(()=>{this.adicionar.modal.name="Origem",this.selecionarItens(n),r.titulo=""}):(this.adicionar.modal.name="Origem",this.selecionarItens(n))},async abrirModalApontamento(){this.$refs.promptApontamento.show()},async incluirApontamento(o){let t={id:Z(),documentoItemIdContato:o.operador,idItem:o.equipamento,tipoItem:"ApontamentoPCP",quantidade:o.quantidade,dataHoraEmissao:o.dataIni,dataHoraFinalizado:o.dataFim,peso:o.peso,idDocumento:this.documento.id};try{await $db.documentoItem.grava({atual:t})}catch(r){this.$q.notifyError("Erro ao salvar",r)}this.buscarApontamentos()},async buscarApontamentos(){try{this.listaApontamentos=[],(await $db.documentoItem.leApontamento({tipoItem:"ApontamentoPCP",idDocumento:this.documento.id})).forEach((t,r)=>{this.listaApontamentos[r]={id:t.id,operador:t.documentoItemIdContato,equipamento:t.idItem,quantidade:t.quantidade,dataIni:t.dataHoraEmissao,dataFim:t.dataHoraFinalizado,peso:t.peso,idDocumento:t.idDocumento}})}catch(o){this.$q.notifyError("Erro ao consultar apontamentos",o)}},async carregarEquipamentos(){let o=await $db.item.leRefatorado({filtros:{tipo:"Servi\xE7o"}});this.equipamentos=o.data.map(t=>({descricao:t.descricao,id:t.id}))},buscaEquipamentoApontado(o){let t=this.equipamentos.find(r=>r.id===o);return t?t.descricao:""},async carregarOperadores(){let o=await $db.contato.leRefatorado({filtros:{}});this.operadores=o.data.map(t=>({nome:t.nome,id:t.id}))},async carregarOperacoes(){let o=await $db.hibrido.lista({table:"documento",where:{tipo:"Produ\xE7\xE3o"}});this.documento.operacoes=o.map(t=>({rotulo:t.operacao,valor:t.operacao}))},buscaOperadorApontado(o){let t=this.operadores.find(r=>r.id===o);return t?t.nome:""},calculoHorasProducao(o,t){let r=new Date(o)-new Date(t),d=Math.floor(r%864e5/36e5),a=Math.round(r%864e5%36e5/6e4);return d+"h "+a+"m"},async removerTodosApontamentos(){$q.dialog({title:"Remover todos os apontamentos",message:"Deseja remover todos os apontamentos de produ\xE7\xE3o",cancel:!0,persistent:!0}).onOk(()=>{for(const o of this.listaApontamentos)this.excluirApontamento(o.id)})},async excluirApontamento(o){try{await $db.documentoItem.removeApontamento(o),this.listaApontamentos=this.listaApontamentos.filter(t=>t.id!==o),this.$q.notify("Apontamento removido!")}catch{this.$q.notifyError("N\xE3o foi possivel remover o apontamento!")}},qtdOriginal(o=0){this.quantidadeOriginal=o},async abrirModalContato(){const o=await this.selecionarContato({placeholder:"Selecione o cliente",filtro:{ativo:!0}});o.id&&(this.documento.idContato=o.id),o.nome&&(this.documento.descricaoContato=o.nome),this.contatos[o.id]||(this.contatos[o.id]=await $db.contato.le({id:o.id}))},async selecionarContato(o){const{placeholder:t,filtro:r}={placeholder:"Selecione o contato",filtro:{ativo:!0},...o},d=await $g.promptContato.show({filtro:r,placeholder:t});if(!d)throw new Error("Contato n\xE3o selecionado");return d}},async beforeMount(){await this.carregarEquipamentos(),await this.carregarOperadores()}},qo={key:0},xo={ref:"form"},wo={class:"col-12 col-md"},Co={class:"col-auto"},ko={class:"col"},Eo={class:"col-12 col-md"},zo={class:"col-auto"},Ao={class:"col"},Vo={key:0,class:"col-4"},Po={class:"col-6 bg-transparent"},Fo={class:"col-6 bg-transparent"},Do={class:"col-12"},Mo={class:"col-12 col-md-6"},Lo={class:"q-item-label q-mb-none",style:{color:"#0c0c0c"}},Oo=l("div",{class:"col-2 col-md"},"Ref/C\xF3d.",-1),To=l("div",{class:"col-10 col-md-4"},"Descri\xE7\xE3o",-1),So=l("div",{class:"col-6 col-md text-right"},"Quantidade",-1),Uo=l("div",{class:"col-6 col-md text-right"},"Valor",-1),Ho=l("div",{class:"col-6 col-md text-right"},"Total",-1),Qo=l("div",{class:"col-6 col-md-1 text-right"},"A\xE7\xF5es",-1),Bo={class:"col-2 col-md"},No={key:0},jo={key:1},Ro={class:"col-10 col-md-4"},Go={class:"col-6 col-md text-right"},Zo={class:"col-6 col-md text-right"},Ko={class:"col-6 col-md text-right"},Xo={key:0,class:"col-6 col-md-1 text-right"},Yo=l("div",{class:"col-2 col-md"},null,-1),Jo=l("div",{class:"col-10 col-md-4"},null,-1),Wo=l("div",{class:"col-6 col-md text-right"},null,-1),$o=l("div",{class:"col-6 col-md text-right"},null,-1),ot={class:"col-6 col-md text-right"},tt=l("div",{class:"col-6 col-md-1 text-right"},"\xA0",-1),et={class:"col-12 col-md-6"},at={class:"q-item-label q-mb-none",style:{color:"#0c0c0c"}},it=l("div",{class:"col-2 col-md"},"Ref/C\xF3d.",-1),st=l("div",{class:"col-10 col-md-4"},"Descri\xE7\xE3o",-1),lt=l("div",{class:"col-6 col-md text-right"},"Quantidade",-1),rt=l("div",{class:"col-6 col-md text-right"},"Unidade",-1),nt=l("div",{class:"col-6 col-md text-right"},"Valor",-1),dt=l("div",{class:"col-6 col-md text-right"},"Total",-1),ct=l("div",{class:"col-6 col-md-1 text-right"},"A\xE7\xF5es",-1),ut={class:"col-2 col-md"},mt={key:0},pt={key:1},ft={class:"col-10 col-md-4"},ht={class:"col-6 col-md text-right"},vt={class:"col-6 col-md text-right"},gt={class:"col-6 col-md text-right"},_t={class:"col-6 col-md text-right"},bt={key:0,class:"col-6 col-md-1 text-right"},yt=l("div",{class:"col-2 col-md"},null,-1),It=l("div",{class:"col-10 col-md-4"},null,-1),qt=l("div",{class:"col-6 col-md text-right"},null,-1),xt=l("div",{class:"col-6 col-md text-right"},null,-1),wt={class:"col-6 col-md text-right"},Ct=l("div",{class:"col-6 col-md-1 text-right"},"\xA0",-1),kt={class:"col-12 col-md-12"},Et={class:"q-item-label q-mb-none",style:{color:"#0c0c0c"}},zt=l("div",{class:"col-6 col-md"},"Data hora inicio",-1),At=l("div",{class:"col-6 col-md"},"Data hora fim",-1),Vt=l("div",{class:"col-6 col-md text-right"},"Tempo total",-1),Pt=l("div",{class:"col-6 col-md text-right"},"Equipamentos",-1),Ft=l("div",{class:"col-6 col-md text-right"},"Operador",-1),Dt=l("div",{class:"col-6 col-md text-right"},"Quantidade",-1),Mt=l("div",{class:"col-6 col-md text-right"},"Peso",-1),Lt=l("div",{class:"col-6 col-md-1 text-right"},"A\xE7\xF5es",-1),Ot={class:"col-6 col-md"},Tt={class:"col-6 col-md"},St={class:"col-6 col-md text-right"},Ut={class:"col-6 col-md text-right"},Ht={class:"col-6 col-md text-right"},Qt={class:"col-6 col-md text-right"},Bt={class:"col-6 col-md text-right"},Nt={class:"col-6 col-md-1 text-right"},jt={class:"u-container relative-position"};function Rt(o,t,r,d,a,n){const p=z("badge"),b=z("BadgeCopiarUid"),k=z("avatar"),q=z("campo"),f=z("row"),c=z("SeletorCampoTabela"),v=z("PromptItemV2"),M=z("PromptApontamento");return u(),y("div",null,[e(po,{modelValue:a.visivel,"onUpdate:modelValue":t[18]||(t[18]=s=>a.visivel=s),maximized:"",onHide:n.onHide},{default:i(()=>[e(so,{class:"bg-light",container:""},{default:i(()=>[e(lo,{class:"u-container"},{default:i(()=>[e(ro,null,{default:i(()=>[e(j,null,{default:i(()=>[no(e(w,{dense:"",flat:"",icon:"arrow_back",round:""},null,512),[[co]]),e(U,null,{default:i(()=>[h("Produ\xE7\xE3o (PCP)")]),_:1}),e(w,{class:"q-ml-sm no-shadow",color:"white",unelevated:"","text-color":"primary",label:"Salvar",onClick:t[0]||(t[0]=s=>n.salvar(!1,"Produ\xE7\xE3o salva!"))})]),_:1})]),_:1}),e(uo,null,{default:i(()=>[e(j,{class:"q-pa-none q-ma-none q-my-md",color:"none","text-color":"black",style:{"min-height":"auto"}},{default:i(()=>[e(U,{class:"text-black q-px-none text-body2"},{default:i(()=>[h("Emiss\xE3o: "+m(o.$filters.data(a.documento.dataHoraEmissao))+" ",1),a.documento.dataHoraFinalizado?(u(),y("span",qo,"Cancelamento: "+m(o.$filters.data(a.documento.dataHoraFinalizado)),1)):g("",!0)]),_:1}),a.documento.status?(u(),_(p,{key:0,cor:"positive",class:"q-mx-sm",icone:"flag",escuro:""},{default:i(()=>[h(m(a.documento.status),1)]),_:1})):g("",!0),a.documento.numero?(u(),_(p,{key:1,class:"q-mr-sm",cor:"tertiary",escuro:""},{default:i(()=>[h(" #"+m(a.documento.numero.toString().padStart(6,"0")),1)]),_:1})):(u(),_(b,{key:2,id:a.documento.id,numero:a.documento.id.slice(-8),cor:"tertiary"},null,8,["id","numero"]))]),_:1}),e(G,{class:"bg-white q-pa-md q-mt-md no-shadow"},{default:i(()=>[l("form",xo,[e(f,{class:"q-col-gutter-sm"},{default:i(()=>[l("div",wo,[e(f,null,{default:i(()=>{var s,E,A,P;return[l("div",Co,[e(k,{imagem:(E=(s=a.contatos[a.documento.idEmpresa])==null?void 0:s.imagem)!=null?E:"",rotulo:(P=(A=a.contatos[a.documento.idEmpresa])==null?void 0:A.nome)!=null?P:"",tamanho:"30",style:{float:"left"},class:"q-mr-sm"},null,8,["imagem","rotulo"])]),l("div",ko,[e(q,{somenteLeitura:"",rotulo:"Empresa",tipo:"texto",class:"col-10",modelValue:a.documento.descricaoEmpresa,"onUpdate:modelValue":t[1]||(t[1]=D=>a.documento.descricaoEmpresa=D)},null,8,["modelValue"])])]}),_:1})]),l("div",Eo,[e(f,null,{default:i(()=>{var s,E,A,P;return[l("div",zo,[e(k,{imagem:(E=(s=a.contatos[a.documento.idContato])==null?void 0:s.imagem)!=null?E:"",rotulo:(P=(A=a.contatos[a.documento.idEmpresa])==null?void 0:A.nome)!=null?P:"",tamanho:"30",style:{float:"left"},class:"q-mr-sm"},null,8,["imagem","rotulo"])]),l("div",Ao,[e(q,{somenteLeitura:"",placeholder:"Cliente",rotulo:"Cliente",tipo:"texto",after:[{icon:"search",handler(){n.abrirModalContato()}}],modelValue:a.documento.descricaoContato,"onUpdate:modelValue":t[2]||(t[2]=D=>a.documento.descricaoContato=D)},null,8,["after","modelValue"])])]}),_:1})])]),_:1}),e(f,null,{default:i(()=>[a.lote.show?(u(),y("div",Vo,[e(q,{modelValue:a.lote.value,"onUpdate:modelValue":t[3]||(t[3]=s=>a.lote.value=s),"somente-leitura":a.lote.readonly,rotulo:"Lote",tipo:"texto"},null,8,["modelValue","somente-leitura"])])):g("",!0),l("div",{class:K(a.lote.show?"col-4":"col-6"),onClick:t[5]||(t[5]=(...s)=>n.carregarOperacoes&&n.carregarOperacoes(...s))},[e(c,{modelValue:a.documento.operacao,"onUpdate:modelValue":t[4]||(t[4]=s=>a.documento.operacao=s),filtro:{tipo:"Produ\xE7\xE3o"},tabela:"documento",campo:"operacao",label:"Opera\xE7\xE3o",buscarSemCaractere:!0,enableAdd:""},null,8,["modelValue"])],2),l("div",{class:K(a.lote.show?"col-4":"col-6")},[e(f,null,{default:i(()=>[l("div",Po,[e(X,{modelValue:a.dataPrevistaEntrega,"onUpdate:modelValue":t[6]||(t[6]=s=>a.dataPrevistaEntrega=s),type:"date",clearable:"",dense:"","stack-label":"",label:"Data Prevista de Entrega"},null,8,["modelValue"])]),l("div",Fo,[e(X,{modelValue:a.horaPrevistaEntrega,"onUpdate:modelValue":t[7]||(t[7]=s=>a.horaPrevistaEntrega=s),type:"time",clearable:"",dense:"","stack-label":"",label:"Hora Prevista de Entrega"},null,8,["modelValue"])])]),_:1})],2),l("div",Do,[e(q,{modelValue:a.documento.observacao,"onUpdate:modelValue":t[8]||(t[8]=s=>a.documento.observacao=s),rotulo:"Observa\xE7\xE3o",rows:"1",tipo:"textoArea"},null,8,["modelValue"])])]),_:1})],512)]),_:1}),e(f,{class:"q-col-gutter-x-sm q-mt-md"},{default:i(()=>[l("div",Mo,[e(G,{class:"no-shadow bg-white full-width fit q-pa-md"},{default:i(()=>[e(j,{class:"q-pa-none q-ma-none q-mb-md",color:"none","text-color":"black",style:{"min-height":"auto"}},{default:i(()=>[l("p",Lo,[e(Q,{class:"q-mr-md",name:"shopping_cart",size:"24px",style:{color:"#737373"}}),h(" Origem ")]),e(U,{class:"q-pa-none q-ma-none",style:{height:"0 !important","min-height":"auto"}}),a.documento.status==="Digita\xE7\xE3o"?(u(),_(w,{key:0,color:"tertiary",dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:t[9]||(t[9]=s=>n.removerTodosItens("Origem"))},{default:i(()=>[e(V,null,{default:i(()=>[h("Remover todos")]),_:1})]),_:1})):g("",!0),a.documento.status==="Digita\xE7\xE3o"?(u(),_(w,{key:1,color:"positive",dense:"",flat:"",icon:"add",round:"",size:"md",onClick:t[10]||(t[10]=s=>n.abrirModal("Origem"))},{default:i(()=>[e(V,null,{default:i(()=>[h("Adicionar Item")]),_:1})]),_:1})):g("",!0)]),_:1}),e(R,{class:"col-12 no-border q-mx-none q-pa-none"},{default:i(()=>[e(F,{class:"q-pa-none"},{default:i(()=>[e(I,null,{default:i(()=>[e(C,null,{default:i(()=>[e(f,{class:"q-col-gutter-md text-weight-bold text-left justify-around"},{default:i(()=>[Oo,To,So,Uo,Ho,Qo]),_:1})]),_:1}),e(H,{class:"q-my-xs"}),(u(!0),y(T,null,S(a.documentoItens,(s,E)=>(u(),y("div",{key:E},[s.operacaoFator===-1?(u(),_(C,{key:0,caption:""},{default:i(()=>[e(f,{class:"text-left justify-around"},{default:i(()=>{var A,P,D,B;return[l("div",Bo,[(A=a.itens[s.idItem])!=null&&A.referencia?(u(),y("span",No,m((P=a.itens[s.idItem])==null?void 0:P.referencia),1)):(D=a.itens[s.idItem])!=null&&D.codigoItem?(u(),y("span",jo," #"+m((B=a.itens[s.idItem])==null?void 0:B.codigoItem),1)):g("",!0)]),l("div",Ro,m(s.descricaoItem||"-"),1),l("div",Go,[e(q,{modelValue:s.quantidade,"onUpdate:modelValue":x=>s.quantidade=x,somenteLeitura:a.documento.status==="Finalizado",decimals:"4",tipo:"decimal",onBlur:x=>n.recalcularTotal(s,!0)},null,8,["modelValue","onUpdate:modelValue","somenteLeitura","onBlur"])]),l("div",Zo,[e(q,{modelValue:s.valorItem,"onUpdate:modelValue":x=>s.valorItem=x,decimals:"4",disable:"",tipo:"decimal",somenteLeitura:a.documento.status==="Finalizado",onBlur:x=>n.recalcularTotal(s)},null,8,["modelValue","onUpdate:modelValue","somenteLeitura","onBlur"])]),l("div",Ko,[e(q,{modelValue:s.subTotal,"onUpdate:modelValue":x=>s.subTotal=x,somenteLeitura:a.documento.status==="Finalizado",decimals:"4",tipo:"decimal",onBlur:x=>n.recalcularQuantidade(s)},null,8,["modelValue","onUpdate:modelValue","somenteLeitura","onBlur"])]),a.documento.status==="Digita\xE7\xE3o"?(u(),y("div",Xo,[e(w,{dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:x=>n.excluirItem(s.id)},{default:i(()=>[e(V,null,{default:i(()=>[h("Excluir")]),_:1})]),_:2},1032,["onClick"])])):g("",!0)]}),_:2},1024)]),_:2},1024)):g("",!0),s.operacaoFator===-1?(u(),_(H,{key:1,class:"q-my-xs"})):g("",!0),s.operacaoFator===-1?(u(),_(C,{key:2,caption:""})):g("",!0)]))),128))]),_:1})]),_:1}),e(F,{class:"q-pa-none"},{default:i(()=>[e(I,null,{default:i(()=>[e(C,null,{default:i(()=>[e(f,{class:"text-weight-bold text-left justify-around"},{default:i(()=>[Yo,Jo,Wo,$o,l("div",ot,m(o.$filters.numero(a.totalOrigem,2)),1),tt]),_:1})]),_:1})]),_:1})]),_:1}),e(F,{class:"q-px-none"},{default:i(()=>[e(I,null,{default:i(()=>[e(C,{class:"text-center"},{default:i(()=>[e(w,{class:"q-mx-auto",color:"positive",icon:"add",label:"Adicionar item",outline:"",size:"xs",onClick:t[11]||(t[11]=s=>n.abrirModal("Origem"))})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),l("div",et,[e(G,{class:"no-shadow bg-white full-width fit q-pa-md"},{default:i(()=>[e(j,{class:"q-pa-none q-ma-none q-mb-md",color:"none","text-color":"black",style:{"min-height":"auto"}},{default:i(()=>[l("p",at,[e(Q,{class:"q-mr-md",name:"shopping_cart",size:"24px",style:{color:"#737373"}}),h(" Destino ")]),e(U,{class:"q-pa-none q-ma-none",style:{height:"0 !important","min-height":"auto"}}),a.documento.status==="Digita\xE7\xE3o"?(u(),_(w,{key:0,color:"tertiary",dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:t[12]||(t[12]=s=>n.removerTodosItens("Destino"))},{default:i(()=>[e(V,null,{default:i(()=>[h("Remover todos")]),_:1})]),_:1})):g("",!0),a.documento.status==="Digita\xE7\xE3o"?(u(),_(w,{key:1,color:"positive",dense:"",flat:"",icon:"add",round:"",size:"md",onClick:t[13]||(t[13]=s=>n.abrirModal("Destino"))},{default:i(()=>[e(V,null,{default:i(()=>[h("Adicionar Item")]),_:1})]),_:1})):g("",!0)]),_:1}),e(R,{class:"col-12 no-border q-mx-none q-pa-none"},{default:i(()=>[e(F,{class:"q-pa-none"},{default:i(()=>[e(I,null,{default:i(()=>[e(C,null,{default:i(()=>[e(f,{class:"q-col-gutter-md text-weight-bold text-left justify-around"},{default:i(()=>[it,st,lt,rt,nt,dt,ct]),_:1})]),_:1}),e(H,{class:"q-my-xs"}),(u(!0),y(T,null,S(a.documentoItens,(s,E)=>(u(),y("div",{key:E},[s.operacaoFator===1?(u(),_(C,{key:0,caption:""},{default:i(()=>[e(f,{class:"text-left justify-around"},{default:i(()=>{var A,P,D,B;return[l("div",ut,[(A=a.itens[s.idItem])!=null&&A.referencia?(u(),y("span",mt,m((P=a.itens[s.idItem])==null?void 0:P.referencia),1)):(D=a.itens[s.idItem])!=null&&D.codigoItem?(u(),y("span",pt," #"+m((B=a.itens[s.idItem])==null?void 0:B.codigoItem),1)):g("",!0)]),l("div",ft,m(s.descricaoItem||"-"),1),l("div",ht,[e(q,{modelValue:s.quantidade,"onUpdate:modelValue":x=>s.quantidade=x,somenteLeitura:a.documento.status==="Finalizado",decimals:"4",tipo:"decimal",onMouseover:x=>n.qtdOriginal(s.quantidade),onBlur:x=>n.recalcularTotal(s,s.quantidade!==a.quantidadeOriginal)},null,8,["modelValue","onUpdate:modelValue","somenteLeitura","onMouseover","onBlur"])]),l("div",vt,m(s.unidade),1),l("div",gt,[e(q,{modelValue:s.valorItem,"onUpdate:modelValue":x=>s.valorItem=x,somenteLeitura:a.documento.status==="Finalizado",class:"col",decimals:"4",tipo:"decimal",onBlur:x=>n.recalcularTotal(s)},null,8,["modelValue","onUpdate:modelValue","somenteLeitura","onBlur"])]),l("div",_t,[e(q,{modelValue:s.subTotal,"onUpdate:modelValue":x=>s.subTotal=x,somenteLeitura:a.documento.status==="Finalizado",decimals:"4",tipo:"decimal",onBlur:x=>n.recalcularValorItem(s)},null,8,["modelValue","onUpdate:modelValue","somenteLeitura","onBlur"])]),a.documento.status==="Digita\xE7\xE3o"?(u(),y("div",bt,[e(w,{dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:x=>n.excluirItem(s.id)},{default:i(()=>[e(V,null,{default:i(()=>[h("Excluir")]),_:1})]),_:2},1032,["onClick"])])):g("",!0)]}),_:2},1024)]),_:2},1024)):g("",!0),s.operacaoFator===1?(u(),_(H,{key:1,class:"q-my-xs"})):g("",!0),s.operacaoFator===1?(u(),_(C,{key:2,caption:""})):g("",!0)]))),128))]),_:1})]),_:1}),e(F,{class:"q-pa-none"},{default:i(()=>[e(I,null,{default:i(()=>[e(C,null,{default:i(()=>[e(f,{class:"text-weight-bold text-left justify-around"},{default:i(()=>[yt,It,qt,xt,l("div",wt,m(o.$filters.numero(a.totalDestino,2)),1),Ct]),_:1})]),_:1})]),_:1})]),_:1}),e(F,{class:"q-px-none"},{default:i(()=>[e(I,null,{default:i(()=>[e(C,{class:"text-center"},{default:i(()=>[e(w,{class:"q-mx-auto",color:"positive",icon:"add",label:"Adicionar item",outline:"",size:"xs",onClick:t[14]||(t[14]=s=>n.abrirModal("Destino"))})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1}),e(f,{class:"q-col-gutter-x-sm q-mt-md"},{default:i(()=>[l("div",kt,[e(G,{class:"no-shadow bg-white full-width fit q-pa-md"},{default:i(()=>[e(j,{class:"q-pa-none q-ma-none q-mb-md",color:"none","text-color":"black",style:{"min-height":"auto"}},{default:i(()=>[l("p",Et,[e(Q,{class:"q-mr-md",name:"content_paste",size:"24px",style:{color:"#737373"}}),h(" Apontamentos ")]),e(U,{class:"q-pa-none q-ma-none",style:{height:"0 !important","min-height":"auto"}}),a.documento.status==="Digita\xE7\xE3o"?(u(),_(w,{key:0,color:"tertiary",dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:t[15]||(t[15]=s=>n.removerTodosApontamentos())},{default:i(()=>[e(V,null,{default:i(()=>[h("Remover todos")]),_:1})]),_:1})):g("",!0),a.documento.status==="Digita\xE7\xE3o"?(u(),_(w,{key:1,color:"positive",dense:"",flat:"",icon:"add",round:"",size:"md",onClick:t[16]||(t[16]=s=>n.abrirModalApontamento())},{default:i(()=>[e(V,null,{default:i(()=>[h("Adicionar Apontamento")]),_:1})]),_:1})):g("",!0)]),_:1}),e(R,{class:"col-12 no-border q-mx-none q-pa-none"},{default:i(()=>[e(F,{class:"q-pa-none"},{default:i(()=>[e(I,null,{default:i(()=>[e(C,null,{default:i(()=>[e(f,{class:"q-col-gutter-md text-weight-bold text-left justify-around"},{default:i(()=>[zt,At,Vt,Pt,Ft,Dt,Mt,Lt]),_:1})]),_:1}),e(H,{class:"q-my-xs"}),(u(!0),y(T,null,S(a.listaApontamentos,(s,E)=>(u(),y("div",{key:E},[e(C,{caption:""},{default:i(()=>[e(f,{class:"text-left justify-around"},{default:i(()=>[l("div",Ot,m(o.$filters.dataHora(s.dataIni)),1),l("div",Tt,m(o.$filters.dataHora(s.dataFim)),1),l("div",St,m(n.calculoHorasProducao(s.dataFim,s.dataIni)),1),l("div",Ut,m(n.buscaEquipamentoApontado(s.equipamento)),1),l("div",Ht,m(n.buscaOperadorApontado(s.operador)),1),l("div",Qt,m(o.$filters.numeroZerosDireita(s.quantidade,4,0)),1),l("div",Bt,m(o.$filters.numeroZerosDireita(s.peso,4,0)),1),l("div",Nt,[e(w,{dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:A=>n.excluirApontamento(s.id)},{default:i(()=>[e(V,null,{default:i(()=>[h("Excluir")]),_:1})]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024)]))),128))]),_:1})]),_:1}),e(F,{class:"q-px-none"},{default:i(()=>[e(I,null,{default:i(()=>[e(C,{class:"text-center"},{default:i(()=>[e(w,{class:"q-mx-auto",color:"positive",icon:"add",label:"Adicionar apontamento",outline:"",size:"xs",onClick:t[17]||(t[17]=s=>n.abrirModalApontamento())})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),e(mo,{class:"bg-light no-shadow q-pa-sm text-right",bordered:""},{default:i(()=>[l("div",jt,[e(U,{class:"text-right"},{default:i(()=>[a.documento.status==="Finalizado"?(u(),_(w,{key:0,color:"primary",label:"Reabrir",onClick:n.reabrir},null,8,["onClick"])):g("",!0),a.documento.status==="Digita\xE7\xE3o"?(u(),_(w,{key:1,color:"primary",label:"Finalizar",onClick:n.finalizar},null,8,["onClick"])):g("",!0)]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onHide"]),e(v,{modelValue:a.adicionar.modal.value,"onUpdate:modelValue":t[19]||(t[19]=s=>a.adicionar.modal.value=s),habilitarQuantidade:!0,filtro:{ativo:!0,idEmpresa:a.documento.idEmpresa},exibirValorVenda:!1,onSelecionarItens:n.selecionarItens,ref:"promptItem"},null,8,["modelValue","filtro","onSelecionarItens"]),e(M,{onIncluirApontamento:n.incluirApontamento,habilitarQuantidade:!0,ref:"promptApontamento"},null,8,["onIncluirApontamento"])])}var Gt=Y(Io,[["render",Rt]]);const Zt={components:{lista:bo,Badge:J,ItensManipulacao:Gt,BadgeCopiarUid:W},data(){return{paginacao:{atual:1,minimo:1,maximo:1,total:1,limite:25},filtros:{tab:"digitacao",empresa:{selecionada:"",opcoes:[]},periodoEmissao:{ini:"",fim:""},periodoFinalizado:{ini:"",fim:""}},documentos:[],tabs:[{rotulo:"Digita\xE7\xE3o",value:"digitacao"},{rotulo:"Finalizados",value:"finalizado"},{rotulo:"Todos",value:"Todos"}],tabSelecionada:{valor:"digitacao"},listaLayout:{},documentoItens:null,buscaCampo:"",checkboxModel:[],configImpressao:[]}},watch:{showFilters:function(o){o===!0?this.showList=!1:(this.section===!0||this.kanban===!0||this.gantt===!0)&&(this.showList=!0)}},methods:{async atualizar(){this.filtros.tab=this.tabSelecionada.valor;try{this.$q.loading.show();const o=this.paginacao.limite,t=this.paginacao.atual,r="descricao";let d="";this.filtros.tab==="digitacao"?d="Digita\xE7\xE3o":this.filtros.tab==="finalizado"&&(d="Finalizado");let a=this.filtros.empresa.selecionada.value||"";this.filtros.idEmpresa=a;let n={};if(this.buscaCampo){let p=this.$utils.eliminarVazios(this.filtros);p.termoBusca=this.buscaCampo,p.status=d,n=await this.filtrarCampos(p,o,t,r)}else{let p=this.$utils.eliminarVazios(this.filtros);p.status=d,n=await this.filtrarCampos(p,o,t,r)}this.listaLayout={};for(let p of n.data)this.listaLayout[p.id]={detalhes:!1};this.documentos=n.data,this.calcularPorcentagem(this.documentos),this.paginacao.total=n.total,this.paginacao.maximo=n.totalPages,this.configuraImpressao(this.filtros.idEmpresa)}catch(o){this.$q.notifyError("Erro iniciar",o)}finally{this.$q.loading.hide()}},async filtrarCampos(o,t,r,d){return console.log({filtros:o}),O.itemManipulacao.leRefatorado({filtros:o,limit:t,page:r,sort:d})},limparFiltros_click(){this.filtros={tab:this.tabAtiva,empresa:{selecionada:"",opcoes:[]},periodoEmissao:{ini:"",fim:""},periodoFinalizado:{ini:"",fim:""}},this.atualizar()},async showDetails(o){let t=await O.itemManipulacao.leItens({idDocumento:o.id});o.documentoItens=t,o.showPreviewDetail=!o.showPreviewDetail},async editarManipulacao(o){this.$router.replace({params:{id:o}}),await this.$refs.itensManipulacao.atualizar(o),this.$refs.itensManipulacao.visivel=!0},async adicionarManipulacaoItens(){await this.$refs.itensManipulacao.atualizar(),this.$refs.itensManipulacao.visivel=!0},async filtrar(o=1){this.buscaCampo="";const t=(o-1)*this.pageSize;this.documentos.status="digitacao";let r=await O.itemManipulacao.le({periodoEmissao:{ini:this.filtro.periodoEmissao.ini,fim:this.filtro.periodoEmissao.fim},periodoFinalizado:{ini:this.filtro.periodoFinalizado.ini,fim:this.filtro.periodoFinalizado.fim},status:this.page.ativa,idEmpresa:this.filtro.empresas.selected,offset:t,limit:this.pageSize});this.documentos=r[0].map(a=>({...a,showPreviewDetail:!1,documentoItens:[]})),this.documentos=fo.exports.orderBy(this.documentos,["dataHoraFinalizado","dataHoraEmissao"],["desc","desc"]);let d=r[1];this.page.digitacao.max=Math.ceil(d/this.pageSize),this.page.finalizado.max=Math.ceil(d/this.pageSize)},excluir(o){$q.dialog({cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},title:"Remover",message:"Ao continuar voc\xEA ir\xE1 remover este item.",ok:{label:"Sim",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{try{$q.loading.show(),await O.itemManipulacao.remove(o),this.atualizar(),$q.notifyPositive("O item foi exclu\xEDdo com sucesso.")}catch(t){$q.notifyError("Ocorreu um erro ao remover item",t)}finally{$q.loading.hide()}})},async empresaOpcoesCarregar(){console.log("carregar empresas"),this.filtros.empresa.opcoes=(await O.empresa.le()).map(o=>({rotulo:o.nome,valor:o.idContato}))},async configuraImpressao(o){const t=await $db.configuracoes.porNome("impressao.producao",o);this.configImpressao=[...t.length?t.map(r=>({texto:"Imprimir Composi\xE7\xE3o",...r})):[{valor:"Impressao-ordem-producao",texto:"Ordem de Produ\xE7\xE3o"},{valor:"impressao-etiqueta-pcp1",texto:"Etiq. 2 - Semi Acabado"},{valor:"impressao-etiqueta-pcp2",texto:"Etiq. 1 - Acabado"}]]},async calcularPorcentagem(o){for(let t=0;t<o.length;t++){let r=0,d=0,a=await O.itemManipulacao.leItens({idDocumento:o[t].id}),n=await O.documentoItem.leApontamento({tipoItem:"ApontamentoPCP",idDocumento:o[t].id});a.forEach((p,b)=>{p?p.operacaoFator===1&&(r+=p.quantidade):r+=0}),n.forEach((p,b)=>{p?p.tipoItem==="ApontamentoPCP"&&(d+=p.quantidade):d+=0}),r===0?(o[t].porcentagemApontamento=0,o[t].porcentagemApontamentoLabel="0 %"):(o[t].porcentagemApontamento=d/r,o[t].porcentagemApontamentoLabel=`${Math.round(d/r*100)} %`)}}},created(){this.atualizar()},mounted(){this.$route.params.id&&this.$route.params.id.length&&(this.$refs.itensManipulacao.atualizar(this.$route.params.id),this.$refs.itensManipulacao.visivel=!0)}},Kt={class:"row"},Xt={class:"col-12 row q-px-md q-mt-lg"},Yt=l("strong",{class:"col-12 text-body1 text-dark"},"Per\xEDodo de Emiss\xE3o",-1),Jt={class:"col-6"},Wt={class:"col-6"},$t={class:"col-12 row q-px-md q-mt-lg"},oe=l("strong",{class:"col-12 text-body1 text-dark"},"Per\xEDodo de Finaliza\xE7\xE3o",-1),te={class:"col-6"},ee={class:"col-6"},ae={class:"col-12 row q-px-md q-mt-lg"},ie={class:"row items-center"},se={key:0},le={class:"absolute-full flex flex-center"},re={class:"text-tertiary q-gutter-xs"};function ne(o,t,r,d,a,n){const p=z("campo"),b=z("badge"),k=z("BadgeCopiarUid"),q=z("lista"),f=z("ItensManipulacao");return u(),y("div",null,[e(q,{titulo:"Produ\xE7\xE3o (PCP)",onCriar_click:n.adicionarManipulacaoItens,showAdd:!1,showToolbar:!1,icone:"mdi-set-center-right",onFiltro_change:n.atualizar,onLimparFiltros_click:n.limparFiltros_click,tabSelecionada:a.tabSelecionada,tabs:a.tabs,listaLayout:a.listaLayout,paginacao:a.paginacao,filtros:a.filtros,buscaCampo:a.buscaCampo,"onUpdate:buscaCampo":t[7]||(t[7]=c=>a.buscaCampo=c),checkboxModel:a.checkboxModel,"onUpdate:checkboxModel":t[8]||(t[8]=c=>a.checkboxModel=c)},{filtroCampos:i(()=>[l("div",Kt,[l("div",{class:"col-12 q-px-sm",onClick:t[1]||(t[1]=(...c)=>n.empresaOpcoesCarregar&&n.empresaOpcoesCarregar(...c))},[e(p,{modelValue:a.filtros.empresa.selecionada,"onUpdate:modelValue":t[0]||(t[0]=c=>a.filtros.empresa.selecionada=c),opcoes:a.filtros.empresa.opcoes,rotulo:"Por Empresa",tipo:"seletor"},null,8,["modelValue","opcoes"])]),l("div",Xt,[Yt,l("div",Jt,[e(p,{modelValue:a.filtros.periodoEmissao.ini,"onUpdate:modelValue":t[2]||(t[2]=c=>a.filtros.periodoEmissao.ini=c),after:[{icon:"mdi-close-circle",handler(){a.filtros.periodoEmissao.ini=""}}],class:"no-shadow full-width",rotulo:"De",tipo:"data"},null,8,["modelValue","after"])]),l("div",Wt,[e(p,{modelValue:a.filtros.periodoEmissao.fim,"onUpdate:modelValue":t[3]||(t[3]=c=>a.filtros.periodoEmissao.fim=c),after:[{icon:"mdi-close-circle",handler(){a.filtros.periodoEmissao.fim=""}}],class:"no-shadow full-width",rotulo:"at\xE9",tipo:"data"},null,8,["modelValue","after"])])]),l("div",$t,[oe,l("div",te,[e(p,{modelValue:a.filtros.periodoFinalizado.ini,"onUpdate:modelValue":t[4]||(t[4]=c=>a.filtros.periodoFinalizado.ini=c),after:[{icon:"mdi-close-circle",handler(){a.filtros.periodoFinalizado.ini=""}}],class:"no-shadow full-width",rotulo:"De",tipo:"data"},null,8,["modelValue","after"])]),l("div",ee,[e(p,{modelValue:a.filtros.periodoFinalizado.fim,"onUpdate:modelValue":t[5]||(t[5]=c=>a.filtros.periodoFinalizado.fim=c),after:[{icon:"mdi-close-circle",handler(){a.filtros.periodoFinalizado.fim=""}}],class:"no-shadow full-width",rotulo:"at\xE9",tipo:"data"},null,8,["modelValue","after"])])]),l("div",ae,[e(ho,{modelValue:a.paginacao.limite,"onUpdate:modelValue":t[6]||(t[6]=c=>a.paginacao.limite=c),options:[10,25,50,100],placeholder:"Quantidade por p\xE1gina"},null,8,["modelValue"])])])]),itemLista:i(()=>[(u(!0),y(T,null,S(a.documentos,c=>(u(),_(R,{key:c.id,class:"q-py-none qListaItems",style:{border:"none !important"}},{default:i(()=>[e(F,{class:"items-center d-flex"},{default:i(()=>[e(I,{avatar:"",center:""},{default:i(()=>[l("div",ie,[c.numero?(u(),_(b,{key:0,class:"q-mr-sm",cor:"tertiary",escuro:""},{default:i(()=>[h(" #"+m(c.numero.toString().padStart(6,"0")),1)]),_:2},1024)):(u(),_(k,{key:1,id:c.id,numero:c.id.slice(-8),cor:"tertiary"},null,8,["id","numero"]))])]),_:2},1024),e(I,null,{default:i(()=>[e(C,null,{default:i(()=>[h(m(c.descricaoEmpresa),1)]),_:2},1024)]),_:2},1024),e(I,null,{default:i(()=>[e(C,null,{default:i(()=>[h(m(c.descricaoContato),1)]),_:2},1024)]),_:2},1024),e(I,{caption:""},{default:i(()=>[e(C,null,{default:i(()=>[e(Q,{class:"text-tertiary",name:"event"}),h(" "+m(o.$filters.data(c.dataHoraEmissao)),1)]),_:2},1024),e(V,null,{default:i(()=>[h("Data Emiss\xE3o "+m(o.$filters.dataHora(c.dataHoraEmissao)),1)]),_:2},1024)]),_:2},1024),a.tabSelecionada.valor!=="digitacao"?(u(),_(I,{key:0,caption:""},{default:i(()=>[e(C,null,{default:i(()=>[e(Q,{class:"text-tertiary",name:"event"}),h(" "+m(o.$filters.data(c.dataHoraFinalizado)),1)]),_:2},1024),e(V,null,{default:i(()=>[h("Data Finalizado "+m(o.$filters.dataHora(c.dataHoraFinalizado)),1)]),_:2},1024)]),_:2},1024)):g("",!0),e(I,{caption:""},{default:i(()=>[c.porcentagemApontamento>0?(u(),y("div",se,[e(C,null,{default:i(()=>[e(vo,{stripe:"",rounded:"",size:"20px",value:c.porcentagemApontamento,color:"secondary",class:"q-mt-sm"},{default:i(()=>[l("div",le,[e(go,{color:"white","text-color":"secondary",label:c.porcentagemApontamentoLabel},null,8,["label"])])]),_:2},1032,["value"])]),_:2},1024),e(V,null,{default:i(()=>[h(m(c.porcentagemApontamentoLabel)+" Conclu\xEDda ",1)]),_:2},1024)])):g("",!0)]),_:2},1024),e(I,{avatar:""},{default:i(()=>[e(b,{class:"q-mr-sm",cor:"warning",escuro:""},{default:i(()=>[h(m(c.status),1)]),_:2},1024)]),_:2},1024),e(I,{avatar:""},{default:i(()=>[e(b,{class:"q-mr-sm",cor:"primary",escuro:""},{default:i(()=>[h(m(c.operacao),1)]),_:2},1024)]),_:2},1024),e(I,{side:"",top:""},{default:i(()=>[l("div",re,[e(w,{icon:c.showPreviewDetail?"keyboard_arrow_up":"keyboard_arrow_down",class:"buttons",color:"tertiary",dense:"",flat:"",round:"",size:"md",onClick:v=>n.showDetails(c)},null,8,["icon","onClick"]),e(w,{rounded:"",dense:"",flat:"",icon:"print",color:"primary",class:"no-shadow q-mx-xs",size:"md",style:{float:"right"}},{default:i(()=>[e(_o,null,{default:i(()=>[e(R,{link:"",separator:""},{default:i(()=>[(u(!0),y(T,null,S(a.configImpressao.filter(v=>v.valor),v=>(u(),_(F,{clickable:"",key:v.valor,onClick:M=>o.$imprimir(v.valor,(c||{}).id||"0")},{default:i(()=>[e(I,{avatar:""},{default:i(()=>[e(Q,{name:"print"})]),_:1}),e(I,null,{default:i(()=>[e(C,null,{default:i(()=>[h(m(v.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024),e(w,{class:"buttons",color:"primary",dense:"",flat:"",icon:"edit",round:"",size:"md",onClick:v=>n.editarManipulacao(c.id)},null,8,["onClick"]),a.tabSelecionada.valor==="digitacao"?(u(),_(w,{key:0,class:"buttons",color:"tertiary",dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:v=>n.excluir(c.id)},null,8,["onClick"])):g("",!0)])]),_:2},1024)]),_:2},1024),c.showPreviewDetail?(u(),_(F,{key:0,class:"q-pa-md"},{default:i(()=>[e(I,null,{default:i(()=>[h(" Origem "),(u(!0),y(T,null,S(c.documentoItens,v=>(u(),y("div",{key:v.id},[v.operacaoFator===-1?(u(),_(I,{key:0,stamp:""},{default:i(()=>[h(m(v.quantidade)+" "+m(v.unidade)+" - "+m(v.descricaoItem),1)]),_:2},1024)):g("",!0)]))),128))]),_:2},1024),e(C,null,{default:i(()=>[h(" Destino "),(u(!0),y(T,null,S(c.documentoItens,v=>(u(),y("div",{key:v.id},[v.operacaoFator===1?(u(),_(I,{key:0,stamp:""},{default:i(()=>[h(m(v.quantidade)+" "+m(v.unidade)+" - "+m(v.descricaoItem),1)]),_:2},1024)):g("",!0)]))),128))]),_:2},1024)]),_:2},1024)):g("",!0),e(H)]),_:2},1024))),128))]),_:1},8,["onCriar_click","onFiltro_change","onLimparFiltros_click","tabSelecionada","tabs","listaLayout","paginacao","filtros","buscaCampo","checkboxModel"]),e(f,{ref:"itensManipulacao",onAtualizar:n.atualizar},null,8,["onAtualizar"])])}var he=Y(Zt,[["render",ne]]);export{he as default};
