import{_ as O,o as u,i as v,w as e,f as a,s as Y,B as Q,E as N,e as d,C as b,D as k,L as D,aS as X,y as I,p as g,aK as Z,bi as da,K as aa,A as ea,t as C,G as oa,H as ca,z as ta,d as B,F as T,r as K,l as A,x as y,Q as J,I as la,aT as ua,aV as ma,f5 as pa,b2 as fa,aB as P,aF as W,aj as E,ak as m,j as F,ai as G,ah as V,k as H,am as ia,aQ as ha,M as va,N as ga}from"./index.6f8ff6bd.js";import{l as _a}from"./Lista.a93bb2ef.js";import{Q as Ca}from"./QDate.91ef2387.js";import{B as sa}from"./BadgeCopiarUid.b58aa471.js";import{G as ba}from"./GenericModal.7cca5704.js";import{G as ya}from"./GChipsV2.03f98807.js";import{J as ra}from"./JsonViewer.3abe6a3a.js";import"./xlsx.74095fe1.js";import"./QBtnDropdown.27faac66.js";import"./QBtnGroup.c75afb67.js";import"./QSpace.f8f6c471.js";const wa={data(){return{visivel:!1}},methods:{async anexar(o){const t=await this.toBase64(o[0]);await $utils.geeksApi({ret:{funcao:"D280149A-F8EA-4103-B4AA-656707767F19",idCampanha:this.idCampanha,anexo:t,nomeArquivo:o[0].name}}),this.resolve(!0),this.visivel=!1},onHide(){this.resolve()},async mostrar({idCampanha:o}){return this.idCampanha=o,this.visivel=!0,new Promise((t,i)=>{this.resolve=t})},toBase64(o){return new Promise((t,i)=>{const c=new FileReader;c.readAsDataURL(o),c.onload=()=>t(c.result),c.onerror=l=>i(l)})}}};function ka(o,t,i,c,l,s){return u(),v(I,{modelValue:l.visivel,"onUpdate:modelValue":t[0]||(t[0]=f=>l.visivel=f),onHide:t[1]||(t[1]=f=>s.onHide())},{default:e(()=>[a(Y,null,{default:e(()=>[a(Q,null,{default:e(()=>[a(N,null,{default:e(()=>[d("Anexar")]),_:1}),b(a(k,{dense:"",flat:"",icon:"close",round:""},null,512),[[D]])]),_:1}),a(X,{"auto-expand":"",color:"none",class:"mobile-only",label:"Foto","hide-upload-btn":"","hide-upload-progress":"","dark-light":"",url:"",ref:"fotoCampo",factory:s.anexar},null,8,["factory"]),a(X,{"auto-expand":"",color:"none",class:"mobile-hide",extensions:".jpg,.mp3,.mp4",label:"Anexo","hide-upload-btn":"","auto-upload":"","dark-light":"",url:"",ref:"fotoCampo",factory:s.anexar},null,8,["factory"])]),_:1})]),_:1},8,["modelValue"])}var Aa=O(wa,[["render",ka]]);const Va={data(){return{visivel:!1,idContato:"",nome:"",apelido:"",email:"",telefone:""}},methods:{onHide(){this.resolve()},async mostrar({idCampanha:o}){return this.idCampanha=o,this.visivel=!0,new Promise((t,i)=>{this.resolve=t})},async salvarContato(){try{this.$q.loading.show(),(await $utils.geeksApi({ret:{funcao:"B18C0CB3-5EA1-4E1C-8C31-EB354E5E3DB1",idCampanha:this.idCampanha,idContato:this.idContato,nome:this.nome,apelido:this.apelido,telefone:this.telefone,email:this.email}})).data.ret.erro?$q.notifyError("ret.data.ret.erro"):(this.resolve(!0),this.cancelarContato())}finally{this.$q.loading.hide()}},cancelarContato(){this.idContato="",this.nome="",this.apelido="",this.email="",this.telefone="",this.visivel=!1},async abrirModalContato(){const o={ativo:!0},t=await $g.promptContato.show({filtro:o,placeholder:"Selecione"});if(!t)return;let c=(await $db.contato.leCompletoV3(t.id)).telefone.filter(function(l){return l.tipoTelefone.indexOf("WhatsApp")!==-1});this.idContato=t.id,this.nome=t.nome,this.apelido=t.apelido,this.telefone="",c.length!==0&&c[0].telefone&&(this.telefone=c[0].telefone),this.email=""}}};function qa(o,t,i,c,l,s){const f=g("campo");return u(),v(I,{modelValue:l.visivel,"onUpdate:modelValue":t[3]||(t[3]=p=>l.visivel=p),onHide:t[4]||(t[4]=p=>s.onHide())},{default:e(()=>[a(Y,{class:"row"},{default:e(()=>[a(Q,{class:"bg-primary text-white row"},{default:e(()=>[a(N,null,{default:e(()=>[d("Contato")]),_:1}),b(a(k,{dense:"",flat:"",icon:"close",round:""},null,512),[[D]])]),_:1}),a(Z,{class:"col-12"},{default:e(()=>[a(f,{modelValue:l.nome,"onUpdate:modelValue":t[0]||(t[0]=p=>l.nome=p),rotulo:"Nome",after:[{icon:"search",handler:s.abrirModalContato}],rules:[p=>!!p||"Campo Obrigat\xF3rio"]},null,8,["modelValue","after","rules"]),a(f,{modelValue:l.apelido,"onUpdate:modelValue":t[1]||(t[1]=p=>l.apelido=p),class:"col-12",tipo:"texto",rotulo:"Apelido",rules:[p=>!!p||""]},null,8,["modelValue","rules"]),a(f,{modelValue:l.telefone,"onUpdate:modelValue":t[2]||(t[2]=p=>l.telefone=p),class:"col-12",tipo:"Telefone",rotulo:"Telefone",mask:"(##) #####-####",rules:[p=>!!p||"Campo Obrigat\xF3rio"]},null,8,["modelValue","rules"])]),_:1}),a(Z,{class:"col-12"},{default:e(()=>[a(da,{align:"right",class:"row"},{default:e(()=>[a(k,{flat:"",class:"bg-primary text-white row",onClick:s.salvarContato},{default:e(()=>[d("Salvar")]),_:1},8,["onClick"]),a(k,{flat:"",onClick:s.cancelarContato},{default:e(()=>[d("Cancelar")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}var Da=O(Va,[["render",qa]]);const xa={components:{GChipsV2:ya},data(){return{show:!1,filtro:[]}},emits:["hide","aplicar"],methods:{async handlerSeletor(o){var c,l;const t=(l=(c=this.props)==null?void 0:c.filtro[o])==null?void 0:l.handler;let i;!t||(i=await t(),i&&this.filtro[o].valor.push(i))},async aplicar(){let o=!1;this.$refs.form.getValidationComponents().forEach(t=>{!t.validate()&&!o&&(o=!0)}),!o&&this.$emit("aplicar",$utils.clonarV2(this.filtro))}},props:{props:Object},watch:{props(){var t,i,c,l;const o=[];for(const s of(i=(t=this.props)==null?void 0:t.filtro)!=null?i:[]){const f={};"campo"in s&&(f.campo=s.campo),"operador"in s&&(f.operador=s.operador),"valor"in s&&(f.valor=s.valor),o.push(f)}this.filtro=o,this.show=(l=(c=this.props)==null?void 0:c.show)!=null?l:!1}}},Ea={key:0,class:"row q-mb-lg"},Fa={key:0,class:"col-4"},Ua={class:"col-8"},Ba=["onClick"],Ha={key:1,class:"col-12 q-mb-lg"},$a={key:2,class:"col-12 q-mb-lg"},Pa={class:"col-12 q-mb-sm"},Sa={class:"col-md-6"},za={class:"row"},Ma={class:"col-6 col-md-6"},Ra={class:"col-6 col-md-6"},La={class:"col-md-6"},Ta={class:"row"},Qa={class:"col-6 col-md-6"},Na={class:"col-6 col-md-6"},Oa={key:3,class:"col-12 q-mb-lg"},Ga={class:"col-12 q-mb-sm"},Ia={class:"col-6 col-sm"},ja={class:"col-6 col-sm"};function Ja(o,t,i,c,l,s){const f=g("campo"),p=g("GChipsV2"),x=g("row");return u(),v(I,{modelValue:l.show,"onUpdate:modelValue":t[0]||(t[0]=_=>l.show=_),onHide:t[1]||(t[1]=_=>o.$emit("hide"))},{default:e(()=>[a(aa,{container:"",view:"hHh lpR fFf",class:"q-layout-modal bg-white"},{default:e(()=>[a(ea,null,{default:e(()=>[a(Q,null,{default:e(()=>[a(N,null,{default:e(()=>[d(C(i.props.titulo),1)]),_:1}),b(a(k,{dense:"",flat:"",icon:"close",round:""},null,512),[[D]])]),_:1})]),_:1}),a(oa,null,{default:e(()=>[a(ca,null,{default:e(()=>[a(ta,{ref:"form",class:"col q-pa-md"},{default:e(()=>[(u(!0),B(T,null,K(l.filtro,(_,h)=>(u(),B("div",{key:h},[i.props.filtro[h].tipo==="seletor"&&i.props.filtro[h].handler?(u(),B("div",Ea,[_.operador?(u(),B("div",Fa,[a(f,{tipo:"seletor","rotulo-fixo":i.props.filtro[h].titulo,options:i.props.filtro[h].operadores,modelValue:_.operador,"onUpdate:modelValue":w=>_.operador=w},null,8,["rotulo-fixo","options","modelValue","onUpdate:modelValue"])])):A("",!0),y("div",Ua,[y("div",{onClick:w=>s.handlerSeletor(h)},[a(p,{modelValue:_.valor,"onUpdate:modelValue":w=>_.valor=w,class:"q-px-none",useInput:!1,placeholder:"Filtre por C\xF3digo, N\xFAmero..."},null,8,["modelValue","onUpdate:modelValue"])],8,Ba)])])):A("",!0),i.props.filtro[h].tipo==="seletor"&&i.props.filtro[h].opcoes?(u(),B("div",Ha,[a(f,{tipo:"seletor","rotulo-fixo":i.props.filtro[h].titulo,options:i.props.filtro[h].opcoes,modelValue:_.valor,"onUpdate:modelValue":w=>_.valor=w},null,8,["rotulo-fixo","options","modelValue","onUpdate:modelValue"])])):A("",!0),i.props.filtro[h].tipo==="periodoDiaMes"?(u(),B("div",$a,[y("div",Pa,[y("strong",null,C(i.props.filtro[h].titulo),1)]),a(x,null,{default:e(()=>{var w,M,R,z,L,n,U,j;return[y("div",Sa,[d(" Data Inicial "),y("div",za,[y("div",Ma,[a(J,{label:"Dia",modelValue:_.valor.diaInicio,"onUpdate:modelValue":$=>_.valor.diaInicio=$,rules:(M=(w=i.props.filtro[h].rules)==null?void 0:w.diaInicio)!=null?M:[],mask:"#","reverse-fill-mask":"",dense:""},null,8,["modelValue","onUpdate:modelValue","rules"])]),y("div",Ra,[a(J,{label:"M\xEAs",modelValue:_.valor.mesInicio,"onUpdate:modelValue":$=>_.valor.mesInicio=$,rules:(z=(R=i.props.filtro[h].rules)==null?void 0:R.mesInicio)!=null?z:[],mask:"#","reverse-fill-mask":"",dense:""},null,8,["modelValue","onUpdate:modelValue","rules"])])])]),y("div",La,[d(" Data Final "),y("div",Ta,[y("div",Qa,[a(J,{label:"Dia",modelValue:_.valor.diaFim,"onUpdate:modelValue":$=>_.valor.diaFim=$,rules:(n=(L=i.props.filtro[h].rules)==null?void 0:L.diaFim)!=null?n:[],mask:"#","reverse-fill-mask":"",dense:""},null,8,["modelValue","onUpdate:modelValue","rules"])]),y("div",Na,[a(J,{label:"M\xEAs",modelValue:_.valor.mesFim,"onUpdate:modelValue":$=>_.valor.mesFim=$,rules:(j=(U=i.props.filtro[h].rules)==null?void 0:U.mesFim)!=null?j:[],mask:"#","reverse-fill-mask":"",dense:""},null,8,["modelValue","onUpdate:modelValue","rules"])])])])]}),_:2},1024)])):A("",!0),i.props.filtro[h].tipo==="periodoData"?(u(),B("div",Oa,[y("div",Ga,[y("strong",null,C(i.props.filtro[h].titulo),1)]),a(x,null,{default:e(()=>[y("div",Ia,[a(f,{modelValue:_.valor.inicio,"onUpdate:modelValue":w=>_.valor.inicio=w,rotulo:"In\xEDcio",clearable:"",tipo:"data"},null,8,["modelValue","onUpdate:modelValue"])]),y("div",ja,[a(f,{modelValue:_.valor.fim,"onUpdate:modelValue":w=>_.valor.fim=w,rotulo:"Fim",clearable:"",tipo:"data"},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1024)])):A("",!0)]))),128))]),_:1},512)]),_:1})]),_:1}),a(la,null,{default:e(()=>[a(Q,{class:"bg-light"},{default:e(()=>[a(N,{class:"text-right"},{default:e(()=>[b(a(k,{flat:"",size:"md","no-ripple":"",color:"tertiary",label:"Cancelar",class:"q-mr-sm"},null,512),[[D]]),a(k,{"no-ripple":"",label:"Aplicar",color:"primary",unelevated:"",class:"no-shadow",onClick:s.aplicar},null,8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}var Ka=O(xa,[["render",Ja]]);const Wa={data(){return{visivel:!1,telefone:"",anexo:[],campanha:{},socket:{conectado:!1,socket:{}}}},emits:["atualizar"],methods:{onHide(){this.resolve({})},testarEnvio(){try{console.log("Envio de teste");const o=this.telefone,t=this.campanha.mensagem,i=localStorage.getItem("bancoDeDados"),c=this.anexo;this.whatsEnvia({funcao:"enviar mensagem",telDestino:o,mensa:t,anexo:c,banco:i}),console.log("Teste de campanha enviado"),this.visivel=!1}catch(o){console.log(o.message)}},whatsEnvia(o){if(this.socket=$g.conexaoWpp,this.socket.conectado)try{this.socket.socket.send(JSON.stringify(o))}catch(t){console.log(t.message)}},show(o,t){return this.visivel=!0,this.telefone="",this.campanha=o,this.anexo=t,new Promise((i,c)=>{this.resolve=i})}}},Ya={class:"layout-padding"},Xa={class:"col-12"},Za={class:"q-mt-lg text-right"};function ae(o,t,i,c,l,s){const f=g("campo"),p=g("row");return u(),v(I,{modelValue:l.visivel,"onUpdate:modelValue":t[1]||(t[1]=x=>l.visivel=x),onHide:t[2]||(t[2]=x=>s.onHide())},{default:e(()=>[a(Y,{class:"q-dialog-plugin"},{default:e(()=>[a(Q,{class:"bg-primary text-white"},{default:e(()=>[a(N,null,{default:e(()=>[d("Testar Envio da Campanha")]),_:1}),b(a(k,{dense:"",flat:"",icon:"close",round:""},null,512),[[D]])]),_:1}),y("div",Ya,[a(ta,{class:"q-pa-md",onSubmit:s.testarEnvio},{default:e(()=>[a(p,{class:"items-center q-col-gutter-md"},{default:e(()=>[y("div",Xa,[a(f,{modelValue:l.telefone,"onUpdate:modelValue":t[0]||(t[0]=x=>l.telefone=x),tipo:"texto",rotulo:"Telefone"},null,8,["modelValue"])])]),_:1}),y("div",Za,[b(a(k,{color:"tertiary",flat:"",label:"Cancelar"},null,512),[[D]]),a(k,{color:"primary",class:"text-white",unelevated:"",label:"Enviar Teste",type:"submit"})])]),_:1},8,["onSubmit"])])]),_:1})]),_:1},8,["modelValue"])}var ee=O(Wa,[["render",ae]]);const oe={components:{modalAnexo:Aa,modalContato:Da,BadgeCopiarUid:sa,SeletorCampoTabela:ua,GenericModal:ba,PromptGrupoUnico:ma,PromptSegmentoUnico:pa,FiltroDinamico:Ka,JsonViewer:ra,CampanhaTesteEnvio:ee},data(){const o=new Date(new Date($utils.dataAtual()).toDateString()),i=new Date(o).setDate(1);return{campanha:{id:"",descricao:"Descri\xE7\xE3o",dataHoraCriacao:$utils.dataAtual(),status:"Rascunho",tipo:"",idContato:"",mensagem:"Mensagem",responsavel:""},campanhaOriginal:{},campanhaContato:[],campanhaAnexo:[],contatoGrupo:[],vendedores:[],filtro:{periodo:{aniversario:{from:`${o.getFullYear()}-${o.getMonth()}-${o.getDate()}`,to:`${o.getFullYear()}-${o.getMonth()}-${o.getDate()+1}`},receitaVencida:{from:i,to:""}}},lastFimReceita:null,opcaoAdicionar:"",grupo:"",segmento:"",vendedor:"",visivel:!1,somenteLeitura:!1,modalTitle:"Filtre contatos",txtSistemaPai:fa(),filtroDinamico:null}},emits:["atualizar"],methods:{async atualizar({id:o}){try{this.$q.loading.show();const t=await $utils.geeksApi({ret:{funcao:"5FBF590B-9B92-4C38-A205-3B4233541140",id:o}});this.campanha=$utils.clonar(t.data.ret.campanha),this.campanhaContato=$utils.clonar(t.data.ret.campanhaContato),this.campanhaAnexo=$utils.clonar(t.data.ret.campanhaAnexo),this.somenteLeitura=t.data.ret.campanha.status!=="Rascunho",this.campanhaOriginal=$utils.clonar(this.campanha)}finally{this.$q.loading.hide()}},verificarSeAlterouCampos(){return $utils.diferencaObjetos(this.campanhaOriginal,this.campanha)},async salvar(){const o=this.verificarSeAlterouCampos();Object.keys(o).length!==0&&(o.funcao="65A200F2-9B9F-40E6-BD3A-282B77FC6BFB",o.id=this.campanha.id,await $utils.geeksApi({ret:o}),this.$emit("atualizar"))},async salvar_click(){try{this.campanha.idContato||(this.campanha.idContato=$db.usuario.logado.id);const o=this.verificarSeAlterouCampos();if(Object.keys(o).length===0)return $q.notifyPositive("N\xE3o h\xE1 dados alterados.");$q.loading.show(),await this.salvar(),this.$router.replace({params:{id:""}}),this.visivel=!1}catch(o){$q.notifyError("Ocorreu um erro ao salvar",o)}finally{$q.loading.hide()}},async enviar_click(){if(this.campanhaContato.length===0){this.$q.notifyError("N\xE3o \xE9 permitido enviar campanha sem lista de contatos!");return}try{$q.loading.show(),this.campanha.status="Enviando",this.campanha.dataHoraDisparo=$utils.dataAtual(),this.campanha.log=`${$utils.dataAtual()} - Campanha disparada por ${$db.usuario.logado.nome}`,this.salvar(),this.fechar()}catch(o){$q.notifyError("Ocorreu um erro!",o)}finally{$q.loading.hide()}},async rascunho_click(){if(this.campanhaContato.length===0){this.$q.notifyError("N\xE3o \xE9 permitido enviar campanha sem lista de contatos!");return}try{$q.loading.show(),this.campanha.status="Rascunho",this.campanha.log=`${$utils.dataAtual()} - Campanha retornada para Rascunho por ${$db.usuario.logado.nome}`,this.salvar(),this.fechar()}catch(o){$q.notifyError("Ocorreu um erro!",o)}finally{$q.loading.hide()}},async mostrar({id:o}){this.visivel=!0,await this.atualizar({id:o})},fechar(){this.$router.replace({params:{id:""}}),this.$emit("atualizar"),this.visivel=!1},async anexar_click(){const o=this.campanha.id;await this.$refs.modalAnexo.mostrar({idCampanha:o})&&(await this.salvar(),await this.atualizar({id:o}))},showFiltersModal(o){o==="carteira-aniversariantes"?this.modalTitle="Aniversariantes":o==="carteira-receitas-vencidas"&&(this.modalTitle="Receitas vencidas"),this.opcaoAdicionar=o,this.$refs.filtersModal.show()},async anexoDownload(o){const t=await $utils.geeksApi({item:{funcao:"B546B803-45E8-40B5-9F28-CFCC323AD5FD",id:o.id}});let i=document.createElement("a");i.href=t.data.item.anexo,i.download=t.data.item.nomeArquivo,i.click()},async anexoRemove(o){this.$q.dialog({cancel:{label:"Manter",push:!0,color:"tertiary",flat:!0},title:"Tem certeza?",message:"Ao continuar voc\xEA ir\xE1 perder esse anexo.",ok:{label:"Continuar",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{try{if(this.campanhaContato.find(l=>l.status==="Enviado")){this.$q.notifyError("N\xE3o \xE9 permitido remover o anexo de uma campanha que j\xE1 foi enviada!");return}this.$q.loading.show();const t=this.campanha,i=t.id,c=await $utils.geeksApi({ret:{funcao:"BE8B810E-A49A-4B38-84B8-B758AD5064EF",id:o.id}});await this.atualizar({id:i}),this.campanha=t}finally{this.$q.loading.hide()}})},async adicionarContato(){const o=this.campanha.id;await this.$refs.modalContato.mostrar({idCampanha:o})&&(await this.salvar(),await this.atualizar({id:o}))},async adicionarPorGrupo(){let o=this.grupo;try{this.$q.loading.show(),await this.salvar();const t=this.campanha,i=t.id,c=await $utils.geeksApi({ret:{funcao:"ACC16F3A-88EC-43C6-A9B1-82828ED6E593",idCampanha:i,grupo:o}});this.showAddPositiveMsg(),await this.atualizar({id:i}),this.campanha=t}finally{this.$q.loading.hide()}},async adicionarPorSegmento(){let o=this.segmento;try{this.$q.loading.show(),await this.salvar();const t=this.campanha,i=t.id,c=await $utils.geeksApi({ret:{funcao:"3127C40C-0DD3-42A3-A37E-8ACACB52B88D",idCampanha:i,segmento:o}});this.showAddPositiveMsg(),await this.atualizar({id:i}),this.campanha=t}finally{this.$q.loading.hide()}},async adicionarPorVendedor(o){this.grupo="",this.$forceUpdate();try{this.$q.loading.show(),await this.salvar();const t=this.campanha,i=t.id,c=await $utils.geeksApi({ret:{funcao:"7B03B118-39D4-4BFB-9F64-12A7020F441F",idCampanha:i,idVendedor:o.id}});this.showAddPositiveMsg(),await this.atualizar({id:i}),this.campanha=t}finally{this.$q.loading.hide()}},async adicionarPorContato(o){this.grupo="",this.$forceUpdate();try{this.$q.loading.show(),await this.salvar();const t=this.campanha,i=t.id,c=await $utils.geeksApi({ret:{funcao:"61003235-3E37-4E2F-A7B7-A1F25FD12470",idCampanha:i,idContato:o.id}});this.showAddPositiveMsg(),await this.atualizar({id:i}),this.campanha=t}finally{this.$q.loading.hide()}},async adicionarPorDataAniversario(){let o=new Date(this.filtro.periodo.aniversario.from),t=new Date(this.filtro.periodo.aniversario.to);typeof this.filtro.periodo.aniversario=="string"&&(o=new Date(this.filtro.periodo.aniversario),t=new Date(this.filtro.periodo.aniversario));try{this.$q.loading.show(),await this.salvar();const c=this.campanha.id,l=await $utils.geeksApi({ret:{funcao:"E3BDE3F3-6D9A-424A-B4EB-B28E9757A1E5",idCampanha:c,ini:{mes:o.getMonth()+1,dia:o.getDate()},fim:{mes:t.getMonth()+1,dia:t.getDate()}}});this.showAddPositiveMsg(),await this.atualizar({id:c})}finally{this.$q.loading.hide()}},async adicionarPorDataReceitaVencida(){const o=new Date(this.filtro.periodo.receitaVencida.from),t=new Date(this.filtro.periodo.receitaVencida.to);if(this.lastFimReceita&&this.lastFimReceita===t.toString())return!1;this.lastFimReceita=t.toString();try{this.$q.loading.show(),await this.salvar();const c=this.campanha.id,l=await $utils.geeksApi({ret:{funcao:"BA806BC5-CAF1-4673-AD4C-572B4AF8DB25",idCampanha:c,ini:{ano:o.getFullYear(),mes:o.getMonth()+1,dia:o.getDate()},fim:{ano:t.getFullYear(),mes:t.getMonth()+1,dia:t.getDate()}}});this.showAddPositiveMsg(),await this.atualizar({id:c})}finally{this.$q.loading.hide()}},showAddPositiveMsg(){$q.notifyPositive("Contatos vinculados com sucesso!")},async contatoRemoveTodos(){this.$q.dialog({cancel:{label:"Voltar",push:!0,color:"tertiary",flat:!0},title:"Limpar?",message:"Ao continuar sua lista de envio ficar\xE1 limpa.",ok:{label:"Continuar",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{try{if(this.campanhaContato.find(c=>c.status==="Enviado")){this.$q.notifyError("N\xE3o \xE9 permitido remover um contato para o qual a campanha j\xE1 foi enviada!");return}this.$q.loading.show();const o=this.campanha,t=o.id,i=await $utils.geeksApi({ret:{funcao:"AE0FFC21-984C-46E0-A9E6-6E8A192DC750",id:t}});await this.atualizar({id:t}),this.campanha=o}finally{this.$q.loading.hide()}})},async contatoRemove(o){try{if((o==null?void 0:o.status)!=="Enviado"){this.$q.loading.show();const t=this.campanha,i=t.id,c=await $utils.geeksApi({ret:{funcao:"15D77453-DEE7-4DD1-B34C-3F6C8D2CC687",id:o.id}});await this.atualizar({id:i}),this.campanha=t}o.status==="Enviado"&&this.$q.notifyError("N\xE3o \xE9 permitido remover um contato para o qual a campanha j\xE1 foi enviada!")}finally{this.$q.loading.hide()}},async concluirFiltros(){this.opcaoAdicionar==="contato-grupo"&&this.adicionarPorGrupo(),this.opcaoAdicionar==="carteira-vendedor"&&this.adicionarPorVendedor(),this.opcaoAdicionar==="carteira-aniversariantes"&&this.adicionarPorDataAniversario(),this.opcaoAdicionar==="carteira-receitas-vencidas"&&this.adicionarPorDataReceitaVencida()},async abrirPromptVendedor(){const o=await $g.promptContato.show({filtro:{ativo:!0,vendedores:!0},placeholder:"Selecione o vendedor"});if(!o)return!1;this.adicionarPorVendedor(o)},async abrirPromptCliente(){const o=await $g.promptContato.show({filtro:{ativo:!0},placeholder:"Selecione o contato"});if(!o)return!1;this.adicionarPorContato(o)},async abrirPromptGrupo(){const o=await this.$refs.PromptGrupoUnico.show();if(!o)return!1;this.grupo=o.descricao,this.adicionarPorGrupo()},async abrirPromptSegmento(){const o=await this.$refs.PromptSegmentoUnico.show();if(!o)return!1;this.segmento=o.descricao,this.adicionarPorSegmento()},async abrirModalMultiplos(){this.filtroDinamico={show:!0,titulo:"Filtro",filtro:[{titulo:"Grupo",campo:"contatoGrupoDescricao",tipo:"seletor",operador:"and",operadores:[{label:"Cont\xE9m todos",value:"and"},{label:"Cont\xE9m pelo menos um",value:"or"}],valor:[],handler:async()=>{const o=await $g.promptGrupoUnico.show();if(!!o.descricao)return{value:o.descricao,label:o.descricao}}},{titulo:"Carteira do Vendedor",campo:"contatoIdContatoVendedor",tipo:"seletor",operador:"or",operadores:[{label:"Pelo menos um",value:"or"}],valor:[],handler:async()=>{const o=await $g.promptContato.show({filtro:{ativo:!0,vendedores:!0},placeholder:"Selecione o vendedor"});if(!!o)return{value:o.id,label:o.nome}}},{titulo:"Segmento",campo:"contatoSegmento",tipo:"seletor",operador:"or",operadores:[{label:"Pelo menos um",value:"or"}],valor:[],handler:async()=>{const o=await $g.promptSegmentoUnico.show();if(!!o.descricao)return{value:o.descricao,label:o.descricao}}},{titulo:"Sexo",campo:"contatoSexo",tipo:"seletor",opcoes:[{label:"Masculino",value:"Masculino"},{label:"Feminino",value:"Feminino"},{label:"Outro",value:"Outro"}],valor:null},{titulo:"Anivers\xE1rio",campo:"contatoDataAbertura",tipo:"periodoDiaMes",valor:{diaInicio:"",mesInicio:"",diaFim:"",mesFim:""},rules:{diaInicio:[o=>Number(o)>0&&Number(o)<32?!0:"Informe o dia do m\xEAs entre 1 - 31"],diaFim:[o=>Number(o)>0&&Number(o)<32?!0:"Informe o dia do m\xEAs entre 1 - 31"],mesInicio:[o=>Number(o)>0&&Number(o)<13?!0:"Informe o m\xEAs entre 1 - 12"],mesFim:[o=>Number(o)>0&&Number(o)<13?!0:"Informe o m\xEAs entre 1 - 12"]}},{titulo:"Receitas Vencidas",campo:"receitaDataHoraFinalizado",tipo:"periodoData",valor:{inicio:null,fim:null}}]}},async aplicarFiltroDinamico(o){try{$q.loading.show(),await this.salvar(),await $utils.geeksApi({payload:{funcao:"A8198AC8-69C0-41E2-92AE-109161145256",idCampanha:this.campanha.id,filtro:o}}),this.filtroDinamico=null,this.showAddPositiveMsg(),await this.atualizar({id:this.campanha.id})}catch(t){$q.notify({type:"negative",message:t.message})}finally{$q.loading.hide()}},criar(){this.campanha={id:$utils.uuid(),descricao:"Descri\xE7\xE3o",dataHoraCriacao:$utils.dataAtual(),status:"Rascunho",tipo:"Whatsapp",mensagem:"Mensagem",idContato:$db.usuario.logado.id,responsavel:$db.usuario.logado.nome},this.campanhaContato=[],this.campanhaAnexo=[],this.campanhaOriginal={},this.visivel=!0,this.somenteLeitura=!1},uploadClick(){this.$refs.Upload.click()},async abrirArquivo(o){const t=this.$refs.Upload.files;if(FileReader&&t&&t.length){var i=new FileReader;i.onload=()=>{},i.readAsDataURL(t[0]),await this.anexar(t[0])}},toBase64(o){return new Promise((t,i)=>{const c=new FileReader;c.readAsDataURL(o),c.onload=()=>t(c.result),c.onerror=l=>i(l)})},async anexar(o){await this.salvar();const t=await this.toBase64(o);await $utils.geeksApi({ret:{funcao:"D280149A-F8EA-4103-B4AA-656707767F19",idCampanha:this.campanha.id,anexo:t,nomeArquivo:o.name}}),await this.atualizar({id:this.campanha.id})},async mostrarJsonViewer(){await this.$refs.jsonViewer.show(this)},async testarEnvio_click(){console.log("teste de Enveio de Campanha");const o=[];this.campanhaAnexo&&this.campanhaAnexo.forEach(async t=>{const i=await this.buscaAnexo(t.id);o.push(i)}),$utils.dormir(2e3),await this.$refs.testeEnvio.show(this.campanha,o)},async buscaAnexo(o){try{const t=await $utils.geeksApi({item:{funcao:"B546B803-45E8-40B5-9F28-CFCC323AD5FD",id:o}});return{anexo:t.data.item.anexo,nomeArquivo:t.data.item.nomeArquivo}}catch(t){console.log(t.message)}}}},te={class:"mw80 text-center"},le={style:{padding:"10px","padding-bottom":"0px"}},ie={class:"u-container relative-position"};function se(o,t,i,c,l,s){const f=g("g-label"),p=g("g-col"),x=g("badge"),_=g("BadgeCopiarUid"),h=g("g-row"),w=g("campo"),M=g("modalAnexo"),R=g("modalContato"),z=g("SeletorCampoTabela"),L=g("GenericModal"),n=g("PromptGrupoUnico"),U=g("PromptSegmentoUnico"),j=g("FiltroDinamico"),$=g("JsonViewer"),na=g("CampanhaTesteEnvio");return u(),B(T,null,[a(I,{modelValue:l.visivel,"onUpdate:modelValue":t[13]||(t[13]=r=>l.visivel=r),persistent:"",maximized:"",onKeyup:ha(s.fechar,["esc"])},{default:e(()=>[a(aa,{container:"",class:"bg-light"},{default:e(()=>[a(ea,null,{default:e(()=>[a(Q,null,{default:e(()=>[a(k,{onClick:s.fechar,icon:"arrow_back",round:"",flat:"",dense:""},null,8,["onClick"]),a(N,null,{default:e(()=>[d("Campanha: "+C(l.campanha.descricao),1)]),_:1}),b(a(k,{onClick:s.salvar_click,label:"Salvar",color:"white","text-color":"primary",class:"q-ml-sm",unelevated:""},null,8,["onClick"]),[[P,!l.somenteLeitura]]),o.$db.usuario.desenvolvedor()?(u(),v(k,{key:0,icon:"more_vert",size:"md",round:"",flat:"",dense:""},{default:e(()=>[a(W,null,{default:e(()=>[b((u(),v(E,{clickable:"",onClick:t[0]||(t[0]=r=>s.mostrarJsonViewer())},{default:e(()=>[a(m,{avatar:""},{default:e(()=>[a(F,{name:"mdi-file-replace",size:"sm"})]),_:1}),a(m,null,{default:e(()=>[d("Ver Objeto")]),_:1})]),_:1})),[[D]])]),_:1})]),_:1})):A("",!0)]),_:1})]),_:1}),a(oa,{class:"u-container"},{default:e(()=>[a(h,{gutter:"md",mg:"md",bg:"bg-white"},{default:e(()=>[a(p,{col:"12"},{default:e(()=>[a(h,null,{default:e(()=>[a(p,{col:"xs"},{default:e(()=>[a(f,{text:"sub1 medium",icon:"edit_note sm tertiary left"},{default:e(()=>[d("Detalhes")]),_:1})]),_:1}),a(p,{col:"xs-shrink"},{default:e(()=>[a(x,{rotulo:l.campanha.status,cor:l.campanha.status==="Enviada"?"tertiary":"light",escuro:l.campanha.status==="Enviada",class:"q-mr-sm"},null,8,["rotulo","cor","escuro"]),a(_,{id:l.campanha.id||"0000",numero:(l.campanha.id||"0000").slice(-8),cor:"positive",class:"float-right q-px-sm"},null,8,["id","numero"])]),_:1})]),_:1})]),_:1}),a(p,{col:"12 md6"},{default:e(()=>{var r;return[a(w,{somenteLeitura:l.somenteLeitura||typeof((r=this.campanhaContato.find(q=>q.status==="Enviado"))==null?void 0:r.id)!="undefined",modelValue:l.campanha.descricao,"onUpdate:modelValue":t[1]||(t[1]=q=>l.campanha.descricao=q),rotulo:"Titulo da campanha",filled:"",dense:"",class:"q-md-b"},null,8,["somenteLeitura","modelValue"])]}),_:1}),a(p,{col:"12 md6"},{default:e(()=>[a(w,{modelValue:l.campanha.responsavel,"onUpdate:modelValue":t[2]||(t[2]=r=>l.campanha.responsavel=r),rotulo:"Respons\xE1vel",somenteLeitura:"",filled:"",dense:"",class:"q-md-b"},null,8,["modelValue"])]),_:1}),a(p,{col:"12"},{default:e(()=>{var r;return[a(w,{modelValue:l.campanha.mensagem,"onUpdate:modelValue":t[3]||(t[3]=q=>l.campanha.mensagem=q),tipo:"textoArea",rotulo:"Mensagem",somenteLeitura:l.somenteLeitura||typeof((r=this.campanhaContato.find(q=>q.status==="Enviado"))==null?void 0:r.id)!="undefined"},null,8,["modelValue","somenteLeitura"])]}),_:1}),a(p,{col:"12"},{default:e(()=>[a(f,{caption:""},{default:e(()=>[d(" Voc\xEA pode usar os seguintes argumentos na mensagem para deixar ainda mais personalizado sua campanha: "),a(x,{class:"q-mr-xs"},{default:e(()=>[d("[Nome]")]),_:1}),a(x,{class:"q-mr-xs"},{default:e(()=>[d("[PrimeiroNome]")]),_:1}),a(x,{class:"q-mr-xs"},{default:e(()=>[d("[Apelido]")]),_:1}),a(x,{class:"q-mr-xs"},{default:e(()=>[d("[PrimeiroApelido]")]),_:1})]),_:1})]),_:1})]),_:1}),a(h,{gutter:"md",mg:"md",bg:"bg-white"},{default:e(()=>[a(p,{col:"12"},{default:e(()=>[a(k,{onClick:s.uploadClick,disable:!!l.campanhaContato.find(r=>r.status==="Enviado"),icon:"image",label:"Anexos","icon-right":"add",size:"md",outline:"","text-color":"tertiary",class:"full-width"},null,8,["onClick","disable"]),y("input",{ref:"Upload",type:"file",id:"Upload",onChange:t[4]||(t[4]=(...r)=>s.abrirArquivo&&s.abrirArquivo(...r)),style:{visibility:"hidden"}},null,544),(u(!0),B(T,null,K(l.campanhaAnexo,r=>(u(),v(h,{key:r,gutter:"sm",mg:"sm-y",items:"center",bordered:"","rounded-borders":"",class:"itemHover"},{default:e(()=>[a(p,{col:"xs-shrink"},{default:e(()=>{var q,S;return[a(_,{id:(q=r==null?void 0:r.id)!=null?q:"",numero:((S=r==null?void 0:r.id)!=null?S:"").slice(-8),cor:"positive"},null,8,["id","numero"])]}),_:2},1024),a(p,{col:"xs",onClick:q=>s.anexoDownload(r),class:"cursor-pointer"},{default:e(()=>[a(f,{text:"bold",color:"tertiary"},{default:e(()=>[d(C(r.nomeArquivo),1)]),_:2},1024)]),_:2},1032,["onClick"]),a(p,{col:"xs-shrink"},{default:e(()=>[b(a(k,{onClick:q=>s.anexoRemove(r),disable:!!l.campanhaContato.find(q=>q.status==="Enviado"),icon:"delete",size:"md",color:"tertiary",round:"",flat:"",dense:""},null,8,["onClick","disable"]),[[P,!l.somenteLeitura]])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),a(h,{gutter:"md",mg:"md",items:"center",bg:"bg-white"},{default:e(()=>[a(p,{col:"xs"},{default:e(()=>[a(f,{text:"sub1 medium",icon:"person sm tertiary left"},{default:e(()=>[d("Contatos")]),_:1})]),_:1}),a(p,{col:"xs-shrink"},{default:e(()=>[b(a(k,{icon:"add",size:"md",round:"",flat:"",dense:""},{default:e(()=>[a(W,null,{default:e(()=>[a(G,{link:"","no-border":"",separator:""},{default:e(()=>[b((u(),v(E,{clickable:"",onClick:s.abrirPromptCliente},{default:e(()=>[a(m,{avatar:""},{default:e(()=>[a(F,{name:"people"})]),_:1}),a(m,null,{default:e(()=>[a(V,null,{default:e(()=>[d("Adicionar Contato")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[D]]),b((u(),v(E,{clickable:"",onClick:s.abrirPromptGrupo},{default:e(()=>[a(m,{avatar:""},{default:e(()=>[a(F,{name:"local_offer"})]),_:1}),a(m,null,{default:e(()=>[a(V,null,{default:e(()=>[d("Contato Grupo")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[D]]),b((u(),v(E,{clickable:"",onClick:s.abrirPromptVendedor},{default:e(()=>[a(m,{avatar:""},{default:e(()=>[a(F,{name:"menu_book"})]),_:1}),a(m,null,{default:e(()=>[a(V,null,{default:e(()=>[d("Carteira do Vendedor")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[D]]),b((u(),v(E,{clickable:"",onClick:t[5]||(t[5]=r=>s.showFiltersModal("carteira-aniversariantes"))},{default:e(()=>[a(m,{avatar:""},{default:e(()=>[a(F,{name:"celebration"})]),_:1}),a(m,null,{default:e(()=>[a(V,null,{default:e(()=>[d("Anivers\xE1rio")]),_:1})]),_:1})]),_:1})),[[D]]),l.txtSistemaPai==="optisoul"?b((u(),v(E,{key:0,clickable:"",onClick:t[6]||(t[6]=r=>s.showFiltersModal("carteira-receitas-vencidas"))},{default:e(()=>[a(m,{avatar:""},{default:e(()=>[a(F,{name:"error_outline"})]),_:1}),a(m,null,{default:e(()=>[a(V,null,{default:e(()=>[d("Receitas Vencidas")]),_:1})]),_:1})]),_:1})),[[D]]):A("",!0),b((u(),v(E,{clickable:"",onClick:s.abrirPromptSegmento},{default:e(()=>[a(m,{avatar:""},{default:e(()=>[a(F,{name:"segment"})]),_:1}),a(m,null,{default:e(()=>[a(V,null,{default:e(()=>[d("Segmento")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[D]]),b((u(),v(E,{clickable:"",onClick:s.abrirModalMultiplos},{default:e(()=>[a(m,{avatar:""},{default:e(()=>[a(F,{name:"filter_alt"})]),_:1}),a(m,null,{default:e(()=>[a(V,null,{default:e(()=>[d("Filtro combinado")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[D]])]),_:1})]),_:1})]),_:1},512),[[P,!l.somenteLeitura]]),b(a(k,{onClick:t[7]||(t[7]=r=>s.contatoRemoveTodos({})),disable:!!l.campanhaContato.find(r=>r.status==="Enviado"),icon:"delete",size:"md",color:"tertiary",round:"",flat:"",dense:"",class:"q-mr-xs"},{default:e(()=>[a(H,{anchor:"bottom middle",self:"center middle"},{default:e(()=>[d("Excluir todos")]),_:1})]),_:1},8,["disable"]),[[P,!l.somenteLeitura]])]),_:1}),l.campanhaContato.length>0?(u(),v(p,{key:0,col:"xs12"},{default:e(()=>[a(G,{bordered:"",class:"bg-white q-mb-xs rounded-borders"},{default:e(()=>[(u(!0),B(T,null,K(l.campanhaContato,r=>(u(),B("div",{key:r,class:"itemHover"},[a(E,{"manual-focus":"",class:"q-py-sm q-px-xs items-center"},{default:e(()=>[a(m,{class:"hideonmobile col-auto q-pr-sm no-margin"},{default:e(()=>{var q,S;return[y("div",te,[a(_,{id:(q=r==null?void 0:r.idContato)!=null?q:"",numero:((S=r==null?void 0:r.idContato)!=null?S:"").slice(-8),cor:"positive"},null,8,["id","numero"])])]}),_:2},1024),a(m,{clickable:""},{default:e(()=>[a(V,{lines:"2",class:"text-tertiary text-weight-bold ellipsis-2-lines"},{default:e(()=>[d(C(r.nome)+" ",1),a(H,{anchor:"bottom middle",self:"center middle"},{default:e(()=>[d("Nome")]),_:1})]),_:2},1024),a(V,{caption:"",lines:"1",class:"text-tertiary ellipsis"},{default:e(()=>[d(C(r.apelido)+" ",1),a(H,{anchor:"bottom middle",self:"center middle"},{default:e(()=>[d("Apelido")]),_:1})]),_:2},1024),a(m,{class:"hideondesktop q-mt-sm"},{default:e(()=>[a(h,{items:"center",class:"hideondesktop"},{default:e(()=>[a(p,{col:"12 sm-shrink"},{default:e(()=>{var q,S;return[r!=null&&r.idContato?(u(),v(_,{key:0,id:(q=r==null?void 0:r.idContato)!=null?q:"",numero:((S=r==null?void 0:r.idContato)!=null?S:"").slice(-8),cor:"positive",class:"q-mr-sm"},null,8,["id","numero"])):A("",!0),a(x,{cor:r.status==="Enviado"?"tertiary":"light",escuro:r.status==="Enviado",rotulo:r.status==="Enviado"?"Enviado":"Rascunho",class:"q-mr-sm"},null,8,["cor","escuro","rotulo"])]}),_:2},1024),r.dataHoraEnvio?(u(),v(p,{key:0,col:"12 sm-shrink",class:"q-mr-sm"},{default:e(()=>[a(f,{caption:"",icon:"mdi-calendar-today xs tertiary left"},{default:e(()=>[d(C(o.$filters.dataHora(r.dataHoraEnvio)),1)]),_:2},1024)]),_:2},1024)):A("",!0),r.telefone?(u(),v(p,{key:1,col:"12 sm-shrink",class:"q-mr-sm"},{default:e(()=>[a(f,{caption:"",icon:"phone xs tertiary left"},{default:e(()=>[d(C(r.telefone),1)]),_:2},1024)]),_:2},1024)):A("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(m,{class:"hideonmobile maxw160 q-pl-sm no-margin"},{default:e(()=>[a(V,null,{default:e(()=>[a(f,{icon:"phone xs tertiary left",tip:"Telefone"},{default:e(()=>[d(C(r.telefone),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(m,{class:"hideonmobile maxw110 q-pl-sm no-margin"},{default:e(()=>[r.dataHoraEnvio?(u(),v(V,{key:0,lines:"1",color:"tertiary",class:"ellipsis"},{default:e(()=>[a(F,{name:"mdi-calendar-today"}),d(" "+C(o.$filters.data(r.dataHoraEnvio))+" ",1),a(H,{anchor:"bottom middle",self:"center middle"},{default:e(()=>[d("Enviado \xE1s "+C(o.$filters.hora(r.dataHoraEnvio)),1)]),_:2},1024)]),_:2},1024)):A("",!0)]),_:2},1024),a(m,{class:"hideonmobile maxw90 q-pl-sm no-margin"},{default:e(()=>[a(x,{cor:r.status==="Enviado"?"tertiary":"light",escuro:r.status==="Enviado",rotulo:r.status==="Enviado"?"Enviado":"Rascunho",class:"col-auto q-mx-auto"},{default:e(()=>[a(H,{anchor:"bottom middle",self:"center middle"},{default:e(()=>[d("Status")]),_:1})]),_:2},1032,["cor","escuro","rotulo"])]),_:2},1024),b(a(m,{class:"col-auto q-pl-sm no-margin"},{default:e(()=>[a(k,{onClick:q=>s.contatoRemove(r),disable:r.status==="Enviado",icon:"delete",size:"md",color:"tertiary",round:"",flat:"",dense:""},null,8,["onClick","disable"])]),_:2},1536),[[P,!l.somenteLeitura]])]),_:2},1024),a(ia)]))),128))]),_:1})]),_:1})):A("",!0)]),_:1})]),_:1}),a(M,{ref:"modalAnexo"},null,512),a(R,{ref:"modalContato"},null,512),a(L,{ref:"filtersModal"},{genericHeader:e(()=>[d(C(l.modalTitle),1)]),genericContent:e(()=>[b(y("div",le,[a(h,{items:"center",justify:"center"},{default:e(()=>[a(p,{class:"q-my-none q-mx-auto"},{default:e(()=>[l.opcaoAdicionar==="contato-grupo"?(u(),v(z,{key:0,modelValue:l.grupo,"onUpdate:modelValue":t[8]||(t[8]=r=>l.grupo=r),tabela:"contatoGrupo",campo:"label",label:"Filtre",buscarSemCaractere:!0,filtro:{ativo:!0,vendedores:!0}},null,8,["modelValue"])):A("",!0),l.opcaoAdicionar==="carteira-vendedor"?(u(),v(z,{key:1,modelValue:l.vendedor,"onUpdate:modelValue":t[9]||(t[9]=r=>l.vendedor=r),tabela:"contato",campo:"nome",label:"Filtre",buscarSemCaractere:!0,filtro:{ativo:!0,vendedores:!0},enableObj:!0},null,8,["modelValue"])):A("",!0),l.opcaoAdicionar==="carteira-aniversariantes"?(u(),v(h,{key:2,gutter:"md",mg:"md-l-ng",class:"date-without-year"},{default:e(()=>[a(p,{col:"12"},{default:e(()=>[a(Ca,{modelValue:l.filtro.periodo.aniversario,"onUpdate:modelValue":t[10]||(t[10]=r=>l.filtro.periodo.aniversario=r),title:"Aniversariantes",range:"",subtitle:"Selecione um periodo"},null,8,["modelValue"])]),_:1})]),_:1})):A("",!0),l.opcaoAdicionar==="carteira-receitas-vencidas"?(u(),v(h,{key:3,gutter:"md",mg:"md-t",class:"invalid-recipes"},{default:e(()=>[a(p,{col:"12"},{default:e(()=>[a(w,{modelValue:l.filtro.periodo.receitaVencida.from,"onUpdate:modelValue":t[11]||(t[11]=r=>l.filtro.periodo.receitaVencida.from=r),tipo:"data",class:"no-shadow full-width",after:[{icon:"mdi-close-circle",handler(){l.filtro.periodo.receitaVencida.ini=""}}],rotulo:"De",dense:""},null,8,["modelValue","after"])]),_:1}),a(p,{col:"12"},{default:e(()=>[a(w,{modelValue:l.filtro.periodo.receitaVencida.to,"onUpdate:modelValue":t[12]||(t[12]=r=>l.filtro.periodo.receitaVencida.to=r),tipo:"data",class:"no-shadow full-width",after:[{icon:"mdi-close-circle",handler(){l.filtro.periodo.receitaVencida.fim=""}}],rotulo:"at\xE9",col:"12",dense:""},null,8,["modelValue","after"])]),_:1})]),_:1})):A("",!0)]),_:1})]),_:1})],512),[[P,!l.somenteLeitura]])]),genericFooter:e(()=>[b(a(k,{onClick:s.concluirFiltros,label:"Avan\xE7ar",color:"primary",flat:""},null,8,["onClick"]),[[D]])]),_:1},512),a(la,{class:"bg-light q-pa-sm text-right u-bordaCima"},{default:e(()=>[y("div",ie,[b(a(k,{onClick:s.testarEnvio_click,type:"submit",icon:"send",label:"Testar Envio",color:"primary",unelevated:""},null,8,["onClick"]),[[P,!l.somenteLeitura]]),b(a(k,{onClick:s.enviar_click,type:"submit",icon:"send",label:"Enviar",color:"primary",unelevated:"",class:"q-ml-sm"},null,8,["onClick"]),[[P,!l.somenteLeitura]]),b(a(k,{onClick:s.rascunho_click,type:"submit",label:"Voltar para Rascunho",color:"primary",unelevated:"",class:"q-ml-sm"},null,8,["onClick"]),[[P,l.somenteLeitura]])])]),_:1})]),_:1})]),_:1},8,["modelValue","onKeyup"]),a(n,{ref:"PromptGrupoUnico"},null,512),a(U,{ref:"PromptSegmentoUnico"},null,512),a(j,{props:l.filtroDinamico,onAplicar:s.aplicarFiltroDinamico},null,8,["props","onAplicar"]),a($,{ref:"jsonViewer"},null,512),a(na,{ref:"testeEnvio",onAtualizar:s.atualizar},null,8,["onAtualizar"])],64)}var re=O(oe,[["render",se]]);const ne={components:{lista:_a,Avatar:va,Badge:ga,campanhaFicha:re,BadgeCopiarUid:sa,JsonViewer:ra},data(){return{lista:[],listaOriginal:[],listaLayout:{},paginacao:{atual:1,maximo:1,total:1,limite:25},filtros:{descricao:null,dataHoraCriacaoDe:null,dataHoraCriacaoAte:null,dataHoraDisparoDe:null,dataHoraDisparoAte:null,dataHoraUltimoDisparoDe:null,dataHoraUltimoDisparoAte:null,tipo:null,mensagem:null},buscaCampo:"",opcoesTipo:["Whatsapp"],tabSelecionada:{valor:"Rascunho"},tabs:[{rotulo:"Rascunhos",value:"Rascunho"},{rotulo:"Enviando",value:"Enviando"},{rotulo:"Enviadas",value:"Enviada"},{rotulo:"Todos",value:"Todos"}]}},methods:{async atualizar(){try{$q.loading.show();const o=this.paginacao.limite,t=this.paginacao.atual,i="descricao",c=$utils.eliminarVazios(this.filtros);c.status=this.tabSelecionada.valor,this.tabSelecionada.valor==="Todos"&&delete c.status,this.buscaCampo&&(c.termoBusca=this.buscaCampo);const l=(await $utils.geeksApi({ret:{funcao:"5FBF590B-9B92-4C38-A205-3B4233541140",filtros:c,limit:50}})).data.ret;l.total||(l.total=l.total=l.data.length),l.totalPages||(l.totalPages=1),this.listaLayout={};for(let s of l.data)this.listaLayout[s.id]={detalhes:!1};this.listaOriginal=$utils.clonarV2(l.data),this.lista=l.data,this.paginacao.total=l.total,this.paginacao.maximo=l.totalPages}catch(o){$q.notifyError("Erro iniciar",o)}finally{$q.loading.hide()}},async abrir(o){this.$router.replace({params:{id:o}}).finally(()=>{this.$refs.modalFicha.mostrar({id:o})})},async copiarCampanha(o){this.$q.dialog({title:"Duplicar Campanha?",message:"Deseja criar uma c\xF3pia desta campanha?",cancel:{label:"Voltar",push:!0,color:"tertiary",flat:!0},ok:{label:"Continuar",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{try{this.$q.loading.show();const t=await $utils.geeksApi({ret:{funcao:"5FBF590B-9B92-4C38-A205-3B4233541140",id:o}}),i=$utils.clonar(t.data.ret.campanha),c=$utils.clonar(t.data.ret.campanhaContato),l=$utils.clonar(t.data.ret.campanhaAnexo);if(i.id=$utils.uuid(),i.status="Rascunho",i.dataHoraCriacao=new Date,i.dataHoraDisparo=null,i.dataHoraUltimoDisparo=null,i.log=null,await $utils.geeksApi({ret:{funcao:"65A200F2-9B9F-40E6-BD3A-282B77FC6BFB",...i}}),l.length>0)for(let s in l)l[s].id=$utils.uuid(),l[s].idCampanha=i.id,await $utils.geeksApi({ret:{funcao:"D280149A-F8EA-4103-B4AA-656707767F19",idCampanha:i.id,anexo:l[s].anexo,nomeArquivo:l[s].nomeArquivo}});if(c.length>0)for(let s of c)(await $utils.geeksApi({ret:{funcao:"B18C0CB3-5EA1-4E1C-8C31-EB354E5E3DB1",idCampanha:i.id,idContato:s.idContato,nome:s.nome,apelido:s.apelido,telefone:s.telefone,email:s.email}})).data.ret.erro?$q.notifyError("ret.data.ret.erro"):console.log("contato adicionado!");this.atualizar(),this.editarCopiaCampanha_click(i.id)}catch(t){console.log(t.message)}finally{this.$q.loading.hide()}})},editarCopiaCampanha_click(o){this.$q.dialog({title:"Campanha duplicada",message:"Deseja editar agora a c\xF3pia da campanha?",cancel:{label:"N\xE3o",push:!0,class:"bg-linght",textColor:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-primary",textColor:"white",flat:!0}}).onOk(async()=>{try{this.$q.loading.show(),this.abrir(o)}catch(t){console.log(t.message)}finally{this.$q.loading.hide()}})},criar_click(){this.$refs.modalFicha.criar()},limparFiltros_click(){this.filtros={descricao:null,dataHoraCriacaoDe:null,dataHoraCriacaoAte:null,dataHoraDisparoDe:null,dataHoraDisparoAte:null,dataHoraUltimoDisparoDe:null,dataHoraUltimoDisparoAte:null,tipo:null,mensagem:null},this.atualizar()},async mostrarJsonViewer(){await this.$refs.jsonViewer.show(this)}},async mounted(){this.atualizar(),this.$route.params.id&&this.$route.params.id.length&&this.$refs.modalFicha.mostrar({id:this.$route.params.id})}},de={class:"mw80 text-center"},ce={class:"text-weight-bold"},ue={class:"text-weight-bold"};function me(o,t,i,c,l,s){const f=g("campo"),p=g("BadgeCopiarUid"),x=g("avatar"),_=g("badge"),h=g("g-col"),w=g("g-label"),M=g("g-row"),R=g("lista"),z=g("campanhaFicha"),L=g("JsonViewer");return u(),B(T,null,[a(R,{titulo:"Campanhas",icone:"campaign",buscaCampo:l.buscaCampo,"onUpdate:buscaCampo":t[10]||(t[10]=n=>l.buscaCampo=n),onCriar_click:s.criar_click,onFiltro_change:s.atualizar,onLimparFiltros_click:s.limparFiltros_click,lista:l.lista,listaLayout:l.listaLayout,paginacao:l.paginacao,filtros:l.filtros,tabSelecionada:l.tabSelecionada,tabs:l.tabs,opcoesTipo:l.opcoesTipo,checkboxVisible:!1,removerTodosVisible:!1,abrirTodosVisible:!1,exportarXLSXVisible:!1,multiplosBtnNovo:!1,showQuickAdd:!1,permissaoExtras:o.$db.usuario.desenvolvedor()},{menuExtras:e(()=>[b((u(),v(E,{clickable:"",onClick:t[0]||(t[0]=n=>s.mostrarJsonViewer())},{default:e(()=>[a(m,{avatar:""},{default:e(()=>[a(F,{name:"mdi-file-replace",size:"sm"})]),_:1}),a(m,null,{default:e(()=>[d("Ver Objeto")]),_:1})]),_:1})),[[D]])]),filtroCampos:e(()=>[a(f,{modelValue:l.filtros.descricao,"onUpdate:modelValue":t[1]||(t[1]=n=>l.filtros.descricao=n),rotulo:"Titulo",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),a(f,{modelValue:l.filtros.dataHoraCriacaoDe,"onUpdate:modelValue":t[2]||(t[2]=n=>l.filtros.dataHoraCriacaoDe=n),rotulo:"Data cria\xE7\xE3o",tipo:"data",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),a(f,{modelValue:l.filtros.dataHoraCriacaoAte,"onUpdate:modelValue":t[3]||(t[3]=n=>l.filtros.dataHoraCriacaoAte=n),rotulo:"at\xE9",tipo:"data",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),a(f,{modelValue:l.filtros.dataHoraDisparoDe,"onUpdate:modelValue":t[4]||(t[4]=n=>l.filtros.dataHoraDisparoDe=n),rotulo:"Data disparo",tipo:"data",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),a(f,{modelValue:l.filtros.dataHoraDisparoAte,"onUpdate:modelValue":t[5]||(t[5]=n=>l.filtros.dataHoraDisparoAte=n),rotulo:"at\xE9",tipo:"data",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),a(f,{modelValue:l.filtros.dataHoraUltimoDisparoDe,"onUpdate:modelValue":t[6]||(t[6]=n=>l.filtros.dataHoraUltimoDisparoDe=n),rotulo:"Data \xFAltimo disparo",tipo:"data",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),a(f,{modelValue:l.filtros.dataHoraUltimoDisparoAte,"onUpdate:modelValue":t[7]||(t[7]=n=>l.filtros.dataHoraUltimoDisparoAte=n),rotulo:"at\xE9",tipo:"data",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),a(f,{modelValue:l.filtros.mensagem,"onUpdate:modelValue":t[8]||(t[8]=n=>l.filtros.mensagem=n),rotulo:"Mensagem",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),a(f,{modelValue:l.paginacao.limite,"onUpdate:modelValue":t[9]||(t[9]=n=>l.paginacao.limite=n),rotulo:"Quantidade por p\xE1gina",tipo:"quantidade",min:"1",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"])]),itemLista:e(()=>[a(G,{bordered:"",class:"bg-white q-mb-xs rounded-borders"},{default:e(()=>[(u(!0),B(T,null,K(l.lista,n=>(u(),B("div",{key:n.id,class:"itemHover cursor-pointer"},[a(E,{"manual-focus":"",class:"q-py-sm q-px-xs items-center"},{default:e(()=>[a(m,{class:"hideonmobile col-auto q-pr-sm no-margin"},{default:e(()=>[y("div",de,[a(p,{id:n.id,numero:n.id.slice(-8),cor:"positive"},null,8,["id","numero"])])]),_:2},1024),a(m,{onClick:U=>s.abrir(n.id)},{default:e(()=>[a(E,{class:"q-pa-none"},{default:e(()=>[a(m,{class:"col-auto items-center"},{default:e(()=>[a(x,{imagem:n.imagem,rotulo:n.descricao,tamanho:"40",style:{display:"flex","align-self":"center"}},null,8,["imagem","rotulo"])]),_:2},1024),a(m,{class:"col"},{default:e(()=>[a(V,{lines:"2",class:"text-tertiary text-weight-bold ellipsis-2-lines"},{default:e(()=>[d(C(n.descricao),1)]),_:2},1024),a(m,{class:"hideondesktop q-mt-sm"},{default:e(()=>[a(M,{mg:"xs-b"},{default:e(()=>[a(h,{col:"xs12 sm-shrink"},{default:e(()=>[a(p,{id:n.id,numero:n.id.slice(-8),cor:"positive",escuro:"",class:"q-mr-sm"},null,8,["id","numero"]),a(_,{rotulo:n.status,cor:n.status!=="Rascunho"?"tertiary":"light",escuro:n.status!=="Rascunho",class:"q-mr-sm"},null,8,["rotulo","cor","escuro"])]),_:2},1024),a(h,{col:"xs12 sm-shrink"},{default:e(()=>[n.dataHoraCriacao?(u(),v(w,{key:0,tip:`Criado \xE1s ${o.$filters.hora(n.dataHoraCriacao)}`,icon:"mdi-calendar-today xs tertiary",inline:"",class:"q-mr-sm"},{default:e(()=>[d(C(o.$filters.data(n.dataHoraCriacao)),1)]),_:2},1032,["tip"])):A("",!0),n.dataHoraDisparo?(u(),v(w,{key:1,tip:`Disparado \xE1s ${o.$filters.hora(n.dataHoraDisparo)}`,icon:"mdi-calendar-today xs tertiary",inline:"",class:"q-mr-sm"},{default:e(()=>[d(C(o.$filters.data(n.dataHoraDisparo)),1)]),_:2},1032,["tip"])):A("",!0),n.dataHoraUltimoDisparo?(u(),v(w,{key:2,tip:`\xDAltimo disparo \xE1s ${o.$filters.hora(n.dataHoraUltimoDisparo)}`,icon:"mdi-calendar xs tertiary",inline:"",class:"q-mr-sm"},{default:e(()=>[d(C(o.$filters.data(n.dataHoraUltimoDisparo)),1)]),_:2},1032,["tip"])):A("",!0)]),_:2},1024),a(h,{col:"xs12 sm-shrink",class:"q-mr-sm"},{default:e(()=>[a(w,{inline:"",class:"q-mr-sm"},{default:e(()=>[d("Contatos: "),y("span",ce,C(n.qtdeContatos),1)]),_:2},1024),a(w,{inline:"",class:"q-mr-sm"},{default:e(()=>[d("Enviados: "),y("span",ue,C(n.qtdeEnviado),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]),a(m,{onClick:U=>s.abrir(n.id),class:"hideonmobile maxw110 q-pl-sm no-margin"},{default:e(()=>[n.dataHoraCriacao?(u(),v(V,{key:0,lines:"1",color:"tertiary",class:"ellipsis"},{default:e(()=>[a(F,{name:"mdi-calendar-today"}),d(" "+C(o.$filters.data(n.dataHoraCriacao))+" ",1),a(H,{anchor:"bottom middle",self:"center middle"},{default:e(()=>[d("Criado \xE1s "+C(o.$filters.hora(n.dataHoraCriacao)),1)]),_:2},1024)]),_:2},1024)):A("",!0)]),_:2},1032,["onClick"]),a(m,{onClick:U=>s.abrir(n.id),class:"hideonmobile maxw110 q-pl-sm no-margin"},{default:e(()=>[n.dataHoraDisparo?(u(),v(V,{key:0,lines:"1",color:"tertiary",class:"ellipsis"},{default:e(()=>[a(F,{name:"mdi-calendar-today"}),d(" "+C(o.$filters.data(n.dataHoraDisparo))+" ",1),a(H,{anchor:"bottom middle",self:"center middle"},{default:e(()=>[d("Disparado \xE1s "+C(o.$filters.hora(n.dataHoraDisparo)),1)]),_:2},1024)]),_:2},1024)):A("",!0)]),_:2},1032,["onClick"]),a(m,{onClick:U=>s.abrir(n.id),class:"hideonmobile maxw110 q-pl-sm no-margin"},{default:e(()=>[n.dataHoraUltimoDisparo?(u(),v(V,{key:0,lines:"1",color:"tertiary",class:"ellipsis"},{default:e(()=>[a(F,{name:"mdi-calendar"}),d(" "+C(o.$filters.data(n.dataHoraUltimoDisparo))+" ",1),a(H,{anchor:"bottom middle",self:"center middle"},{default:e(()=>[d("\xDAltimo disparo \xE1s "+C(o.$filters.hora(n.dataHoraUltimoDisparo)),1)]),_:2},1024)]),_:2},1024)):A("",!0)]),_:2},1032,["onClick"]),a(m,{onClick:U=>s.abrir(n.id),class:"hideonmobile maxw90 q-pl-sm no-margin"},{default:e(()=>[a(_,{cor:n.status!=="Rascunho"?"tertiary":"light",escuro:n.status!=="Rascunho",class:"col-auto q-mx-auto"},{default:e(()=>[d(C(n.status)+" ",1),a(H,{anchor:"bottom middle",self:"center middle"},{default:e(()=>[d("Status")]),_:1})]),_:2},1032,["cor","escuro"])]),_:2},1032,["onClick"]),a(m,{onClick:U=>s.abrir(n.id),class:"hideonmobile maxw90 q-pl-sm no-margin"},{default:e(()=>[a(V,{lines:"1",class:"ellipsis text-tertiary text-weight-bold text-right"},{default:e(()=>[d(C(n.qtdeContatos),1)]),_:2},1024),a(V,{caption:"",class:"text-tertiary text-right"},{default:e(()=>[d("Contatos")]),_:1})]),_:2},1032,["onClick"]),a(m,{onClick:U=>s.abrir(n.id),class:"hideonmobile maxw90 q-pl-sm no-margin"},{default:e(()=>[a(V,{lines:"1",class:"ellipsis text-tertiary text-weight-bold text-right"},{default:e(()=>[d(C(n.qtdeEnviado),1)]),_:2},1024),a(V,{caption:"",class:"text-tertiary text-right"},{default:e(()=>[d("Enviados")]),_:1})]),_:2},1032,["onClick"]),a(m,{class:"hideonmobile col-auto q-pl-sm no-margin"},{default:e(()=>[a(E,{class:"q-pa-none"},{default:e(()=>[a(m,{class:"q-pr-sm no-margin"},{default:e(()=>[a(k,{onClick:U=>s.abrir(n.id),icon:"edit",size:"md",color:"primary",round:"",flat:"",dense:""},{default:e(()=>[a(H,{anchor:"bottom middle",self:"center middle"},{default:e(()=>[d("Editar")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),a(m,{class:"no-margin"},{default:e(()=>[a(k,{icon:"more_vert",size:"md",round:"",flat:"",dense:""},{default:e(()=>[a(W,null,{default:e(()=>[b((u(),v(G,{link:"","no-border":"",separator:""},{default:e(()=>[a(E,{onClick:U=>s.copiarCampanha(n.id),clickable:"",class:"itemHover"},{default:e(()=>[a(m,{avatar:""},{default:e(()=>[a(F,{name:"content_copy"})]),_:1}),a(m,null,{default:e(()=>[a(V,null,{default:e(()=>[d(" Duplicar ")]),_:1})]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[D]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(m,{class:"hideondesktop col-auto q-pl-sm no-margin"},{default:e(()=>[a(k,{icon:"more_vert",size:"md",color:"tertiary",round:"",flat:"",dense:""},{default:e(()=>[a(W,null,{default:e(()=>[b((u(),v(G,{link:"","no-border":"",separator:""},{default:e(()=>[a(E,{onClick:U=>s.abrir(n.id),clickable:"",class:"itemHover"},{default:e(()=>[a(m,{avatar:""},{default:e(()=>[a(F,{name:"edit"})]),_:1}),a(m,null,{default:e(()=>[a(V,null,{default:e(()=>[d(" Editar ")]),_:1})]),_:1})]),_:2},1032,["onClick"]),a(E,{onClick:U=>s.copiarCampanha(n.id),clickable:"",class:"itemHover"},{default:e(()=>[a(m,{avatar:""},{default:e(()=>[a(F,{name:"content_copy"})]),_:1}),a(m,null,{default:e(()=>[a(V,null,{default:e(()=>[d(" Duplicar ")]),_:1})]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[D]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(ia)]))),128))]),_:1})]),_:1},8,["buscaCampo","onCriar_click","onFiltro_change","onLimparFiltros_click","lista","listaLayout","paginacao","filtros","tabSelecionada","tabs","opcoesTipo","permissaoExtras"]),a(z,{ref:"modalFicha",onAtualizar:s.atualizar},null,8,["onAtualizar"]),a(L,{ref:"jsonViewer"},null,512)],64)}var Ae=O(ne,[["render",me]]);export{Ae as default};
