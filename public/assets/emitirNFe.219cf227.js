var $={methods:{async emitirNFeV2({idVenda:c,idFatura:s},l=1,i=""){var u;try{$utils.verificarExcecao(![1,0].includes(l)||!(c||s),"Par\xE2metros inv\xE1lidos.");const t=s||c,a=await $db.hibrido.le({table:"documento",id:t});if($utils.verificarErro(!a||!a.status||!a.tipo,"Erro ao emitir nota. Falha na consulta da fatura/venda."),$utils.verificarErro(!this.$utils.mapearStatus(a).permiteNota,`A ${a.tipo} n\xE3o foi finalizada.`),i!=="Remessa"){const f=await $db.documentoFiscalEletronico.ler({idDocumento:t});if($utils.verificarErro(!f,"Falha na consulta das notas"),$utils.verificarErro(f.find(o=>o.situacao!=="Cancelado"&&o.operacao===i),`${a.tipo} j\xE1 possui nota de ${i}`),c){$utils.verificarErro(a.tipo!=="Venda","Venda inv\xE1lida");const o=await $db.documentoFiscalEletronico.ler({idDocumento:a.idFatura});$utils.verificarErro(!o,"Falha na consulta das notas"),$utils.verificarErro(o.find(r=>r.situacao!=="Cancelado"&&r.operacao===i),`Fatura da Venda j\xE1 possui nota de ${i}`)}if(s){$utils.verificarErro(a.tipo!=="Fatura","Fatura inv\xE1lida");const o=await $db.documento.ler({idFatura:s});let r;for(const n of o){const d=Number(n==null?void 0:n.codigoDocumentoOperacao);if(Number.isInteger(d)&&d>0){const e=await $erp().documentoOperacao.where({codigoDocumentoOperacao:d}).toArray();r||(r=e[0]),$utils.verificarErro((r==null?void 0:r.finalidade)!==((u=e[0])==null?void 0:u.finalidade),"Vendas possuem opera\xE7\xF5es com finalidades diferentes. Favor emitir a NFe a partir de cada venda da fatura.")}const m=await $db.documentoFiscalEletronico.ler({idDocumento:n.id});$utils.verificarErro(!m,"Falha na consulta das notas"),$utils.verificarErro(m.find(e=>e.situacao!=="Cancelado"&&e.operacao===i),`Fatura/Venda j\xE1 possui nota de ${i}. Favor emitir a NFe a partir de cada venda da fatura.`)}}}await $utils.atualizarCfop(t),this.$q.loading.show({message:"Processando"}),$utils.emitter.emit("gerarNFe",t,l,i)}catch(t){this.$q.notifyError("Ocorreu um erro ao gerar NFe",t)}finally{this.$q.loading.hide()}}}};export{$ as e};
