import{_ as k,M as S,bd as D,p as u,o as l,d as x,f as n,w as i,B as y,x as f,E as B,e as m,t as $,i as d,D as b,k as V,l as h,aF as I,C as q,aj as N,ak as v,j as R,L as P,aM as O,H as Q}from"./index.1748e8ff.js";import{M as U}from"./MenuAbas.f49342a7.js";import{J}from"./JsonViewer.b71dde3f.js";const M={components:{Avatar:S,MenuAbas:U,Tutorial:D,JsonViewer:J},data(){return{contato:{},permissoes:{},sistemaPai:""}},methods:{async atualizar(){try{await this.obterContatoUsuario()}catch(e){$q.notifyError("N\xE3o foi poss\xEDvel carregar os dados do cockpit",e)}},async criarObjStoreIDB(){if(!("indexedDB"in window)){console.log("Navegador sem suporte ao IndexedDB");return}let e=indexedDB.open("cockpit",1);return e.onupgradeneeded=function(a){var o=a.target.result;o.createObjectStore("consultasRecentes",{keyPath:"id"}).createIndex("id","id",{unique:!0})},new Promise((a,o)=>{e.onsuccess=function(t){a()},e.onerror=function(t){a()}})},salvarObjIDb(e){if(!("indexedDB"in window))return;let a,o,t;return a=new Promise((s,r)=>{t=s}),o=indexedDB.open("cockpit",1),o.onsuccess=function(){o=o.result.transaction(["consultasRecentes"],"readwrite").objectStore("consultasRecentes").put(e),o.onsuccess=function(c){t()},o.onerror=function(c){t()}},a},obterObjIDb(e){if(!("indexedDB"in window))return;let a,o,t;return a=new Promise((s,r)=>{t=s}),o=indexedDB.open("cockpit",1),o.onsuccess=function(){o=o.result.transaction(["consultasRecentes"],"readwrite").objectStore("consultasRecentes").get(e),o.onsuccess=function(c){t(c.target.result)},o.onerror=function(c){t()}},a},async obterContatoUsuario(){const e=JSON.parse(localStorage.getItem("usuario"))||{},a=this.$route.params.id,o=e.numeroDocumentoNacional;let t={};if(o){if(a&&(t=await $erp().contato.get(a)||{},(!t.ativo||t.excluido||t.numeroDocumentoNacional!==o)&&(t={})),!t.id){let s;s=await $erp().contato.where({numeroDocumentoNacional:o}).toArray(),t=s.find(r=>r.ativo&&!r.excluido&&r.codigoUsuario)||{}}this.selecionarContato(t)}if(!t.id){this.$q.notifyError("Usu\xE1rio logado n\xE3o encontrado. Selecione um vendedor para continuar.");const s=await $g.promptContato.show({filtro:{ativo:!0,vendedores:!0},placeholder:"Selecione o usu\xE1rio"});$lodash.get(s,"id")&&this.selecionarContato(s)}},async btBuscar_click(){const e=await $g.promptContato.show({filtro:{ativo:!0,vendedores:!0},placeholder:"Selecione o usu\xE1rio"});$lodash.get(e,"id")&&this.selecionarContato(e)},selecionarContato(e){e.id&&(this.contato={id:e.id,nome:e.nome||"",apelido:e.apelido||"",imagem:e.imagem||""},this.$router.push({name:this.$route.name==="Cockpit"?"CockpitVendedor":this.$route.name,params:{id:e.id||""}}),this.salvarConsultaRecente())},async salvarConsultaRecente(){await this.criarObjStoreIDB();let e,a;e=JSON.parse(localStorage.getItem("clienteSistema"))||{},a=e.codigoClienteSistema,this.salvarObjIDb({id:a,idContato:this.contato.id})},async mostrarJsonViewer(){await this.$refs.jsonViewer.show(this)}},mounted(){this.permissoes={obterUsuario:!1,envelope:!1,vendas:!1,faturas:!1},$db.permissao.objeto("Diretiva_Cockpit_MudarUsuario").then(e=>{this.permissoes.obterUsuario=e}),$db.permissao.objeto("cockpit/envelope").then(e=>{this.permissoes.envelope=e}),$db.permissao.objeto("cockpit/vendas").then(e=>{this.permissoes.vendas=e}),$db.permissao.objeto("cockpit/faturas").then(e=>{this.permissoes.faturas=e}),this.sistemaPai=$utils.sistemaPai(),this.atualizar()}},T={class:"u-container"},z={class:"u-container"};function A(e,a,o,t,s,r){const c=u("avatar"),_=u("Tutorial"),w=u("row"),g=u("RouterView"),C=u("MenuAbas"),j=u("JsonViewer");return l(),x("div",null,[n(Q,null,{default:i(()=>[n(y,{class:"bg-gradiente text-white"},{default:i(()=>[f("div",T,[n(w,{class:"items-center q-mx-none q-px-none q-py-xs"},{default:i(()=>[n(c,{imagem:s.contato.imagem,rotulo:s.contato.apelido,tamanho:"40"},null,8,["imagem","rotulo"]),n(B,null,{default:i(()=>[m($(s.contato.nome),1)]),_:1}),s.permissoes.obterUsuario?(l(),d(b,{key:0,flat:"",dense:"",icon:"search",round:"",size:"md",onClick:r.btBuscar_click},{default:i(()=>[n(V,null,{default:i(()=>[m("Buscar vendedor/empresa")]),_:1})]),_:1},8,["onClick"])):h("",!0),n(_,{componente:"CockpitLayout"}),e.$db.usuario.desenvolvedor()?(l(),d(b,{key:1,icon:"more_vert",size:"md",round:"",flat:"",dense:""},{default:i(()=>[n(I,null,{default:i(()=>[q((l(),d(N,{clickable:"",onClick:a[0]||(a[0]=p=>r.mostrarJsonViewer())},{default:i(()=>[n(v,{avatar:""},{default:i(()=>[n(R,{name:"mdi-file-replace",size:"sm"})]),_:1}),n(v,null,{default:i(()=>[m("Ver Objeto")]),_:1})]),_:1})),[[P]])]),_:1})]),_:1})):h("",!0)]),_:1})])]),_:1}),n(C,{objetoPai:"cockpit"},{default:i(()=>[f("div",z,[n(g,null,{default:i(({Component:p})=>[(l(),d(O(p),{usuario:s.contato},null,8,["usuario"]))]),_:1})])]),_:1})]),_:1}),n(j,{ref:"jsonViewer"},null,512)])}var H=k(M,[["render",A]]);export{H as default};
