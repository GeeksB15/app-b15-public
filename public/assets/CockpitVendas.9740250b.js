import{_ as E,bZ as U,bK as q,p as x,o,d,x as f,f as s,w as p,j as A,i as C,D as P,aF as O,C as Q,aj as j,ak as D,e as N,L as H,l as m,s as B,u as z,aJ as F,F as w,r as y,ai as J,cx as R}from"./index.0c60fad9.js";import{G as S}from"./GChipsV2.38d2a726.js";import{n as T}from"./nfePrincipal.7713dca2.js";import{V as G}from"./VendaCard.b9d864f0.js";import{J as L}from"./JsonViewer.8d89ad41.js";import"./compactarValidarNFe.83039ce2.js";import"./obterItens.517f633e.js";import"./codigosANP.a6c1a264.js";import"./BadgeCopiarUid.a04330a6.js";import"./DocumentosFiscais.e82ebde2.js";import"./Campo.bc7c7f94.js";import"./ModalHistoricoStatus.1a212e1f.js";import"./emitirNFe.3ad8673b.js";const M={components:{GChipsV2:S,nfePrincipal:T,VendaCard:G,VendaModal:U,JsonViewer:L},computed:{temVendasAbertas(){return!!this.vendasAbertas.length},temVendasCanceladas(){return!!this.vendasCanceladas.length},temVendasFinalizadas(){return!!this.vendasFinalizadas.length},temRegistros(){return this.temVendasAbertas||this.temVendasCanceladas||this.temVendasFinalizadas}},data(){return{grupos:[],vendasAbertas:[],vendasCanceladas:[],vendasFinalizadas:[],dataIni:null,dataFim:null,carregando:!1,paginacao:{page:1,rowsPerPage:25},modalDevolucaoGarantia:{visivel:!1},pagination:{maxPages:7,perPage:5,vendasAbertas:{page:1,min:1,max:1},vendasFinalizadas:{page:1,min:1,max:1},vendasCanceladas:{page:1,min:1,max:1}}}},methods:{adicionarOrcamento(){this.$refs.modalVenda.mostrar()},fechouNFe(n){n&&$utils.emitter.emit("atualizarDocumentosFiscais")},async atualizar(){this.paginacao={page:1,rowsPerPage:25},this.carregando=!0,await this.filtrar(),this.carregando=!1},executar(n){this.atualizar()},async filtrar(){let n,i,V={};this.$route.params.id&&(V=await $db.contato.le({id:this.$route.params.id})),V.id||this.$router.go(-1),n=await $db.hibrido.lista({table:"documento",where:{tipo:"Venda",idContatoVendedor:V.id}}),i=n.map(t=>t.id),n=n.concat((await $db.hibrido.lista({table:"documento",where:{tipo:"Venda",idContatoDigitador:V.id}})).filter(t=>!i.includes(t.id)&&i.push(t.id))),n=n.concat((await $db.hibrido.lista({table:"documento",where:{tipo:"Venda",idEmpresa:V.id}})).filter(t=>!i.includes(t.id)));const k=await $db.permissao.objeto("Diretiva_Venda/Fatura_OutrasLojas_VerTodos"),a=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;if(k||(n=n.filter(t=>a.find(r=>r.id===t.idEmpresa))),this.dataIni&&this.dataFim){const t=new Date(this.dataIni).setHours(0,0,0,0),r=new Date(this.dataFim).setHours(0,0,0,0);n=n.filter(g=>{let c=g.dataHoraFinalizado||g.dataHoraEmissao;if(c)return c=new Date(c).setHours(0,0,0,0),c>=t&&c<=r})}if(this.grupos.length){const t=[];for(const r of n){const g=[];let c=!0,v="";const e=await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:r.id}});for(const u of e){if(!u.idItem)continue;const h=await $erp().item.get(u.idItem);g.find(I=>I===h.id)||(v+=`${h.codigoItem} ${h.referencia||""} ${h.codigoBarras||""} ${h.marca||""} ${h.descricao||""} `,g.push(h.id))}v+=`#${r.numero} ${r.descricaoEmpresa||""} ${r.descricaoContato||""} `,v+=`${r.numeroDocumentoContato||""} ${(r.numeroDocumentoContato||"").replace(/\D/g,"")}`,v=$utils.tratamentoCompletoString(v),t.push(r.id);for(const u of this.grupos)if(c=v.search($utils.tratamentoCompletoString(u))>-1,!c){t.pop();break}}n=n.filter(r=>t.find(g=>g===r.id))}n=$lodash.orderBy(n,["dataHoraFinalizado","dataHoraEmissao"],["desc","desc"]);const l=n.filter(t=>t.status==="Or\xE7amento"),_=n.filter(t=>!["N\xE3o Aprovado","Cancelado","Or\xE7amento"].includes(t.status)),b=n.filter(t=>["N\xE3o Aprovado","Cancelado"].includes(t.status));this.pagination.vendasAbertas.max=(l.length/5|0)+(l.length%5>0?1:0),this.pagination.vendasFinalizadas.max=(_.length/5|0)+(_.length%5>0?1:0),this.pagination.vendasCanceladas.max=(b.length/5|0)+(b.length%5>0?1:0),this.vendasAbertas=l,this.vendasFinalizadas=_,this.vendasCanceladas=b},limparFiltro(){this.grupos=[],this.dataFim=new Date,this.dataIni=new Date(q().add(-7,"days"))},async mostrarJsonViewer(){await this.$refs.jsonViewer.show(this)}},props:{periodo:Object},watch:{"$route.params.id"(n){!~this.$route.name.indexOf("CockpitVendas")||(this.limparFiltro(),this.atualizar())}},mounted(){if(this.$route.params.id){if(this.limparFiltro(),this.periodo&&this.periodo.ini&&this.periodo.fim){const n=new Date(new Date().setHours(0,0,0,0)).toISOString().replace(/\d{4}-\d{2}-\d{2}/g,"");this.dataIni=this.periodo.ini.replace(/T.+$/g,n),this.dataFim=this.periodo.fim.replace(/T.+$/g,n)}this.atualizar()}}},K={class:"AtendimentoVenda q-pb-md"},Z={class:"col-12 col-md-6"},W={class:"col"},X=f("div",{class:"col-auto",style:{"align-items":"center",display:"flex"}},[f("label",null,"at\xE9")],-1),Y={class:"col"},$={key:0,class:"col-12",style:{"margin-bottom":"50px"}},aa={key:1,class:"col-12",style:{"margin-bottom":"50px"}},ea={key:0,class:"col-12",style:{"margin-bottom":"50px"}},na={key:1,class:"col-12",style:{"margin-bottom":"50px"}},ia={key:0,class:"col-12",style:{"margin-bottom":"50px"}},sa={key:1,class:"col-12",style:{"margin-bottom":"50px"}},ta={key:1,class:"q-pa-lg text-center"},oa=f("p",null,[f("small",null,"Registros n\xE3o encontrados")],-1),la=[oa],ra={key:2,class:"q-mt-lg text-center"};function da(n,i,V,k,a,l){const _=x("GChipsV2"),b=x("campo"),t=x("row"),r=x("venda-card"),g=x("VendaModal"),c=x("nfePrincipal"),v=x("JsonViewer");return o(),d(w,null,[f("div",K,[s(B,{class:"q-pa-sm no-shadow"},{default:p(()=>[s(t,{class:"items-center q-col-gutter-md"},{default:p(()=>[f("div",Z,[s(_,{modelValue:a.grupos,"onUpdate:modelValue":[i[0]||(i[0]=e=>a.grupos=e),l.atualizar],placeholder:"Filtre por C\xF3digo, Produto, Marca, N\xFAmero..."},{prepend:p(()=>[s(A,{name:"mdi-filter"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),f("div",W,[s(b,{modelValue:a.dataIni,"onUpdate:modelValue":[i[1]||(i[1]=e=>a.dataIni=e),l.atualizar],tipo:"data",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),X,f("div",Y,[s(b,{modelValue:a.dataFim,"onUpdate:modelValue":[i[2]||(i[2]=e=>a.dataFim=e),l.atualizar],tipo:"data",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),n.$db.usuario.desenvolvedor()?(o(),C(P,{key:0,icon:"more_vert",round:"",flat:""},{default:p(()=>[s(O,null,{default:p(()=>[Q((o(),C(j,{clickable:"",onClick:i[3]||(i[3]=e=>l.mostrarJsonViewer())},{default:p(()=>[s(D,{avatar:""},{default:p(()=>[s(A,{name:"mdi-file-replace",size:"sm"})]),_:1}),s(D,null,{default:p(()=>[N("Ver Objeto")]),_:1})]),_:1})),[[H]])]),_:1})]),_:1})):m("",!0)]),_:1})]),_:1}),!a.carregando&&l.temRegistros?(o(),C(J,{key:0,class:"no-border row"},{default:p(()=>[l.temVendasAbertas?(o(),C(z,{key:0,class:"col-12 q-mb-xl","default-opened":"",label:"Abertas (Total R$ "+n.$filters.numero(a.vendasAbertas.reduce((e,u)=>e+u.totalDocumento,0),2)+")",group:"vendasAbertas"},{default:p(()=>[a.pagination.vendasAbertas.max>1?(o(),d("div",$,[s(F,{modelValue:a.pagination.vendasAbertas.page,"onUpdate:modelValue":i[4]||(i[4]=e=>a.pagination.vendasAbertas.page=e),min:a.pagination.vendasAbertas.min,max:a.pagination.vendasAbertas.max,ellipses:"","max-pages":a.pagination.maxPages,class:"float-right"},null,8,["modelValue","min","max","max-pages"])])):m("",!0),(o(!0),d(w,null,y(a.vendasAbertas.slice((a.pagination.vendasAbertas.page-1)*a.pagination.perPage,a.pagination.vendasAbertas.page*a.pagination.perPage),e=>(o(),d("div",{key:e.id},[s(r,{id:e.id,onExecutar:l.executar,class:"q-mb-md"},null,8,["id","onExecutar"])]))),128)),a.pagination.vendasAbertas.max>1?(o(),d("div",aa,[s(F,{modelValue:a.pagination.vendasAbertas.page,"onUpdate:modelValue":i[5]||(i[5]=e=>a.pagination.vendasAbertas.page=e),min:a.pagination.vendasAbertas.min,max:a.pagination.vendasAbertas.max,ellipses:"","max-pages":a.pagination.maxPages,class:"float-right"},null,8,["modelValue","min","max","max-pages"])])):m("",!0)]),_:1},8,["label"])):m("",!0),l.temVendasFinalizadas?(o(),C(z,{key:1,class:"col-12 q-mb-xl","default-opened":"",label:"Finalizadas (Total R$ "+n.$filters.numero(a.vendasFinalizadas.reduce((e,u)=>e+u.totalDocumento,0),2)+")",group:"vendasFinalizadas"},{default:p(()=>[a.pagination.vendasFinalizadas.max>1?(o(),d("div",ea,[s(F,{modelValue:a.pagination.vendasFinalizadas.page,"onUpdate:modelValue":i[6]||(i[6]=e=>a.pagination.vendasFinalizadas.page=e),min:a.pagination.vendasFinalizadas.min,max:a.pagination.vendasFinalizadas.max,ellipses:"","max-pages":a.pagination.maxPages,class:"float-right"},null,8,["modelValue","min","max","max-pages"])])):m("",!0),(o(!0),d(w,null,y(a.vendasFinalizadas.slice((a.pagination.vendasFinalizadas.page-1)*a.pagination.perPage,a.pagination.vendasFinalizadas.page*a.pagination.perPage),e=>(o(),d("div",{key:e.id},[s(r,{id:e.id,onExecutar:l.executar,class:"q-mb-md"},null,8,["id","onExecutar"])]))),128)),a.pagination.vendasFinalizadas.max>1?(o(),d("div",na,[s(F,{modelValue:a.pagination.vendasFinalizadas.page,"onUpdate:modelValue":i[7]||(i[7]=e=>a.pagination.vendasFinalizadas.page=e),min:a.pagination.vendasFinalizadas.min,max:a.pagination.vendasFinalizadas.max,ellipses:"","max-pages":a.pagination.maxPages,class:"float-right"},null,8,["modelValue","min","max","max-pages"])])):m("",!0)]),_:1},8,["label"])):m("",!0),l.temVendasCanceladas?(o(),C(z,{key:2,class:"col-12 q-mb-xl","default-opened":"",label:"Canceladas (Total R$ "+n.$filters.numero(a.vendasCanceladas.reduce((e,u)=>e+u.totalDocumento,0),2)+")",group:"vendasCanceladas"},{default:p(()=>[a.pagination.vendasCanceladas.max>1?(o(),d("div",ia,[s(F,{modelValue:a.pagination.vendasCanceladas.page,"onUpdate:modelValue":i[8]||(i[8]=e=>a.pagination.vendasCanceladas.page=e),min:a.pagination.vendasCanceladas.min,max:a.pagination.vendasCanceladas.max,ellipses:"","max-pages":a.pagination.maxPages,class:"float-right"},null,8,["modelValue","min","max","max-pages"])])):m("",!0),(o(!0),d(w,null,y(a.vendasCanceladas.slice((a.pagination.vendasCanceladas.page-1)*a.pagination.perPage,a.pagination.vendasCanceladas.page*a.pagination.perPage),e=>(o(),d("div",{key:e.id},[s(r,{id:e.id,onExecutar:l.executar,class:"q-mb-md"},null,8,["id","onExecutar"])]))),128)),a.pagination.vendasCanceladas.max>1?(o(),d("div",sa,[s(F,{modelValue:a.pagination.vendasCanceladas.page,"onUpdate:modelValue":i[9]||(i[9]=e=>a.pagination.vendasCanceladas.page=e),min:a.pagination.vendasCanceladas.min,max:a.pagination.vendasCanceladas.max,ellipses:"","max-pages":a.pagination.maxPages,class:"float-right"},null,8,["modelValue","min","max","max-pages"])])):m("",!0)]),_:1},8,["label"])):m("",!0)]),_:1})):m("",!0),!a.carregando&&!l.temRegistros?(o(),d("div",ta,la)):m("",!0),a.carregando?(o(),d("div",ra,[s(R,{color:"tertiary",size:50})])):m("",!0),s(P,{round:"",color:"primary",class:"fixed",icon:"add",size:"lg",style:{right:"18px",bottom:"18px"},onClick:l.adicionarOrcamento},null,8,["onClick"]),s(g,{ref:"modalVenda",onExecutar:l.executar},null,8,["onExecutar"]),s(c,{onFechar:l.fechouNFe},null,8,["onFechar"])]),s(v,{ref:"jsonViewer"},null,512)],64)}var _a=E(M,[["render",da]]);export{_a as default};
