import{_ as V,p,o as r,d as l,f as n,w as d,x as u,j as A,s as k,i as x,u as b,aJ as f,l as o,F as _,r as z,ai as v}from"./index.7a11122e.js";import{F as w}from"./FaturaCard.2cf09de7.js";import{G as y}from"./GChipsV2.349839c1.js";import{n as q}from"./nfePrincipal.35993e93.js";import"./QSpinnerHourglass.b915aca0.js";import"./QSpinnerDots.e1a0c407.js";import"./DocumentosFiscais.8226f47f.js";import"./Campo.18bf7f93.js";import"./compactarValidarNFe.3301b4e4.js";import"./obterItens.6df9c6c0.js";import"./codigosANP.a6c1a264.js";import"./emitirNFe.3ad8673b.js";import"./FaturaModal.707c7e83.js";import"./VendaCard.cbca6212.js";import"./ModalHistoricoStatus.e01a33be.js";import"./BadgeCopiarUid.419f08f7.js";const I={components:{FaturaCard:w,GChipsV2:y,nfePrincipal:q},computed:{temFaturasAbertas(){return!!this.faturasAbertas.length},temFaturasFinalizadas(){return!!this.faturasFinalizadas.length},temFaturasCanceladas(){return!!this.faturasCanceladas.length},temRegistros(){return this.temFaturasAbertas||this.temFaturasFinalizadas||this.temFaturasCanceladas}},data(){return{contato:null,grupos:[],faturasAbertas:[],faturasFinalizadas:[],faturasCanceladas:[],totalFaturasAbertas:0,totalFaturasCanceladas:0,totalFaturasFinalizadas:0,filtro:{},tipoData:"",tiposData:[{label:"Emiss\xE3o",value:"emissao"},{label:"Finalizado",value:"finalizado"}],dataIni:null,dataFim:null,carregando:!1,faturasPorSecao:"10",faturasPorSecaoOpts:[{value:"5",label:"5"},{value:"10",label:"10"},{value:"15",label:"15"},{value:"20",label:"20"},{value:"25",label:"25"},{value:"50",label:"50"}],faturaCardPagination:{maxPages:7,perPage:5,faturasAbertas:{page:1,min:1,max:1},faturasFinalizadas:{page:1,min:1,max:1},faturasCanceladas:{page:1,min:1,max:1}}}},methods:{async atualizar(){const s=$utils.logarIni("AtendimentoFatura");await $tryLoading(async()=>{await this.filtrar()},{mensagem:"Carregando faturas...",erro:"Ocorreu um erro ao consultar faturas",carregando:t=>this.carregando=t}),$utils.logarFim(s,1)},executar(s){this.atualizar()},fechouNFe(s){s&&$utils.emitter.emit("atualizarDocumentosFiscais")},async filtrar(){var P,a,i,C,g,h,m,F,e;let s,t,c;s=await $db.fatura.filtrar({where:{idContato:this.contato.id,periodo:{dataIni:this.dataIni,dataFim:this.dataFim},status:"aberta",grupos:this.grupos},page:this.faturaCardPagination.faturasAbertas.page,limit:5}),t=await $db.fatura.filtrar({where:{idContato:this.contato.id,periodo:{dataIni:this.dataIni,dataFim:this.dataFim},status:"finalizada",grupos:this.grupos},page:this.faturaCardPagination.faturasFinalizadas.page,limit:5}),c=await $db.fatura.filtrar({where:{idContato:this.contato.id,periodo:{dataIni:this.dataIni,dataFim:this.dataFim},status:"cancelada",grupos:this.grupos},page:this.faturaCardPagination.faturasCanceladas.page,limit:5}),this.faturaCardPagination.faturasAbertas.max=(P=s.totalPages)!=null?P:0,this.faturaCardPagination.faturasFinalizadas.max=(a=t.totalPages)!=null?a:0,this.faturaCardPagination.faturasCanceladas.max=(i=c.totalPages)!=null?i:0,this.faturasAbertas=(C=s.data)!=null?C:[],this.faturasFinalizadas=(g=t.data)!=null?g:[],this.faturasCanceladas=(h=c.data)!=null?h:[],this.totalFaturasAbertas=$filters.numero((m=s.somaTotalDocumento)!=null?m:0,2),this.totalFaturasFinalizadas=$filters.numero((F=t.somaTotalDocumento)!=null?F:0,2),this.totalFaturasCanceladas=$filters.numero((e=c.somaTotalDocumento)!=null?e:0,2)},async limparFiltro(){this.grupos=[],this.dataFim=new Date;const s=new Date;if(s.setMonth(s.getMonth()-3),this.dataIni=s,this.contato.codigoContato){const t=await $db.configuracoes.leValorNumerico("venda.codigoconsumidor");this.contato.codigoContato===t&&(this.dataIni=this.dataFim)}}},watch:{"$route.params.id"(){const s=this.$route.params.id;!s||$db.contato.le({id:s}).then(t=>{this.contato=t,this.limparFiltro().then(()=>{this.atualizar()})})}},mounted(){$utils.emitter.off("atualizarAtendimentoFatura"),$utils.emitter.on("atualizarAtendimentoFatura",this.atualizar);const s=this.$route.params.id;!s||$db.contato.le({id:s}).then(t=>{this.contato=t,this.limparFiltro().then(()=>{this.atualizar()})})},unmounted(){$utils.emitter.off("atualizarAtendimentoFatura")}},U={class:"AtendimentoFatura q-pb-md"},E={class:"col-12 col-md-6"},B={class:"col"},D=u("div",{class:"col-auto",style:{"align-items":"center",display:"flex"}},[u("label",null,"at\xE9")],-1),j={class:"col"},N={key:0,class:"row justify-end q-mb-md"},R={class:"row"},T={key:1,class:"row justify-end q-mb-md"},Q={key:0,class:"row justify-end q-mb-md"},G={class:"row"},L={key:1,class:"row justify-end q-mb-md"},M={key:0,class:"row justify-end q-mb-md"},O={class:"row"},S={key:1,class:"row justify-end q-mb-md"},J={key:1,class:"q-pa-lg text-center"},H=u("p",null,[u("small",null,"Registros n\xE3o encontrados")],-1),K=[H];function W(s,t,c,P,a,i){const C=p("GChipsV2"),g=p("campo"),h=p("row"),m=p("fatura-card"),F=p("nfePrincipal");return r(),l("div",U,[n(k,{class:"q-pa-sm q-mx-sm no-shadow"},{default:d(()=>[n(h,{class:"items-center q-col-gutter-md"},{default:d(()=>[u("div",E,[n(C,{modelValue:a.grupos,"onUpdate:modelValue":[t[0]||(t[0]=e=>a.grupos=e),i.filtrar],class:"q-px-none",placeholder:"Filtre por C\xF3digo, N\xFAmero..."},{prepend:d(()=>[n(A,{name:"mdi-filter"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),u("div",B,[n(g,{modelValue:a.dataIni,"onUpdate:modelValue":t[1]||(t[1]=e=>a.dataIni=e),tipo:"data",onBlur:i.atualizar,dense:"",outlined:""},null,8,["modelValue","onBlur"])]),D,u("div",j,[n(g,{modelValue:a.dataFim,"onUpdate:modelValue":t[2]||(t[2]=e=>a.dataFim=e),tipo:"data",onBlur:i.atualizar,dense:"",outlined:""},null,8,["modelValue","onBlur"])])]),_:1})]),_:1}),!a.carregando&&i.temRegistros?(r(),x(v,{key:0,class:"no-border"},{default:d(()=>[i.temFaturasAbertas?(r(),x(b,{key:0,"default-opened":"",label:`Abertas (Total R$ ${a.totalFaturasAbertas})`,group:"faturasAbertas"},{default:d(()=>[a.faturaCardPagination.faturasAbertas.max>1?(r(),l("div",N,[n(f,{modelValue:a.faturaCardPagination.faturasAbertas.page,"onUpdate:modelValue":t[3]||(t[3]=e=>a.faturaCardPagination.faturasAbertas.page=e),min:a.faturaCardPagination.faturasAbertas.min,max:a.faturaCardPagination.faturasAbertas.max,ellipses:"","max-pages":a.faturaCardPagination.maxPages,class:"float-right",onClick:i.filtrar},null,8,["modelValue","min","max","max-pages","onClick"])])):o("",!0),u("div",R,[(r(!0),l(_,null,z(a.faturasAbertas,e=>(r(),l("div",{class:"q-px-sm full-width",key:e.id},[n(m,{id:e.id,onExecutar:i.executar,class:"q-mb-md"},null,8,["id","onExecutar"])]))),128))]),a.faturaCardPagination.faturasAbertas.max>1?(r(),l("div",T,[n(f,{modelValue:a.faturaCardPagination.faturasAbertas.page,"onUpdate:modelValue":t[4]||(t[4]=e=>a.faturaCardPagination.faturasAbertas.page=e),min:a.faturaCardPagination.faturasAbertas.min,max:a.faturaCardPagination.faturasAbertas.max,ellipses:"","max-pages":a.faturaCardPagination.maxPages,class:"float-right",onClick:i.filtrar},null,8,["modelValue","min","max","max-pages","onClick"])])):o("",!0)]),_:1},8,["label"])):o("",!0),i.temFaturasFinalizadas?(r(),x(b,{key:1,"default-opened":"",label:`Finalizadas (Total R$ ${a.totalFaturasFinalizadas})`,group:"faturasFinalizadas"},{default:d(()=>[a.faturaCardPagination.faturasFinalizadas.max>1?(r(),l("div",Q,[n(f,{modelValue:a.faturaCardPagination.faturasFinalizadas.page,"onUpdate:modelValue":t[5]||(t[5]=e=>a.faturaCardPagination.faturasFinalizadas.page=e),min:a.faturaCardPagination.faturasFinalizadas.min,max:a.faturaCardPagination.faturasFinalizadas.max,ellipses:"","max-pages":a.faturaCardPagination.maxPages,class:"float-right",onClick:i.filtrar},null,8,["modelValue","min","max","max-pages","onClick"])])):o("",!0),u("div",G,[(r(!0),l(_,null,z(a.faturasFinalizadas,e=>(r(),l("div",{class:"q-px-sm full-width",key:e.id},[n(m,{id:e.id,onExecutar:i.executar,class:"q-mb-md"},null,8,["id","onExecutar"])]))),128))]),a.faturaCardPagination.faturasFinalizadas.max>1?(r(),l("div",L,[n(f,{modelValue:a.faturaCardPagination.faturasFinalizadas.page,"onUpdate:modelValue":t[6]||(t[6]=e=>a.faturaCardPagination.faturasFinalizadas.page=e),min:a.faturaCardPagination.faturasFinalizadas.min,max:a.faturaCardPagination.faturasFinalizadas.max,ellipses:"","max-pages":a.faturaCardPagination.maxPages,class:"float-right",onClick:i.filtrar},null,8,["modelValue","min","max","max-pages","onClick"])])):o("",!0)]),_:1},8,["label"])):o("",!0),i.temFaturasCanceladas?(r(),x(b,{key:2,"default-opened":"",label:`Canceladas (Total R$ ${a.totalFaturasCanceladas})`,group:"faturasCanceladas"},{default:d(()=>[a.faturaCardPagination.faturasCanceladas.max>1?(r(),l("div",M,[n(f,{modelValue:a.faturaCardPagination.faturasCanceladas.page,"onUpdate:modelValue":t[7]||(t[7]=e=>a.faturaCardPagination.faturasCanceladas.page=e),min:a.faturaCardPagination.faturasCanceladas.min,max:a.faturaCardPagination.faturasCanceladas.max,ellipses:"","max-pages":a.faturaCardPagination.maxPages,class:"float-right",onClick:i.filtrar},null,8,["modelValue","min","max","max-pages","onClick"])])):o("",!0),u("div",O,[(r(!0),l(_,null,z(a.faturasCanceladas,e=>(r(),l("div",{class:"q-px-sm full-width",key:e.id},[n(m,{id:e.id,onExecutar:i.executar,class:"q-mb-md"},null,8,["id","onExecutar"])]))),128))]),a.faturaCardPagination.faturasCanceladas.max>1?(r(),l("div",S,[n(f,{modelValue:a.faturaCardPagination.faturasCanceladas.page,"onUpdate:modelValue":t[8]||(t[8]=e=>a.faturaCardPagination.faturasCanceladas.page=e),min:a.faturaCardPagination.faturasCanceladas.min,max:a.faturaCardPagination.faturasCanceladas.max,ellipses:"","max-pages":a.faturaCardPagination.maxPages,class:"float-right",onClick:i.filtrar},null,8,["modelValue","min","max","max-pages","onClick"])])):o("",!0)]),_:1},8,["label"])):o("",!0)]),_:1})):o("",!0),!a.carregando&&!i.temRegistros?(r(),l("div",J,K)):o("",!0),n(F,{onFechar:i.fechouNFe},null,8,["onFechar"])])}var fa=V(I,[["render",W]]);export{fa as default};
