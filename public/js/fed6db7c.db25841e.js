(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["fed6db7c"],{"0e0d":function(a,t,e){},3558:function(a,t,e){},"423ee":function(a,t,e){"use strict";var o=e("7985"),i=e.n(o);i.a},6622:function(a,t,e){"use strict";var o=e("0e0d"),i=e.n(o);i.a},"67dd":function(a,t,e){},7985:function(a,t,e){},b4be:function(a,t,e){"use strict";var o=e("3558"),i=e.n(o);i.a},c865:function(a,t,e){"use strict";var o=function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("q-modal",{attrs:{maximized:""},on:{show:a.mostrar,hide:a.fechar},model:{value:a.visibilidade.modal,callback:function(t){a.$set(a.visibilidade,"modal",t)},expression:"visibilidade.modal"}},[e("q-modal-layout",{staticClass:"bg-grey-4"},[e("q-toolbar",{attrs:{slot:"header"},slot:"header"},[e("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"arrow_back",round:""}}),e("q-toolbar-title",[a._v("Fatura")]),a.visibilidade.botao.salvar?e("q-btn",{staticClass:"q-ml-sm no-shadow",attrs:{color:"white","text-color":"primary",label:"Salvar"},on:{click:a.salvar}}):a._e(),a.visibilidade.botao.reabrir&&a.temPermissaoCorrigir?e("q-btn",{staticClass:"q-ml-sm no-shadow",attrs:{color:"white","text-color":"negative",label:"Corrigir"},on:{click:a.corrigir}}):a._e()],1),e("div",{staticClass:"layout-padding q-pa-none q-pb-xl"},[e("div",{staticClass:"u-container"},[a.carregando?a._e():e("div",[a.fatura.id?e("fatura",{ref:"fatura",attrs:{prop:{id:a.fatura.id},receberTitulo:a.receberTitulo},on:{executar:a.executar}}):a._e()],1),a.carregando?e("div",{staticClass:"q-mt-lg text-center"},[e("q-spinner",{attrs:{color:"faded",size:50}})],1):a._e()])]),e("q-toolbar",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[e("q-toolbar-title",{staticClass:"text-right"},[a.visibilidade.botao.reabrir?e("q-btn",{staticClass:"q-mx-md",attrs:{color:"negative",flat:"",label:"Reabrir"},on:{click:function(t){a.executar("reabrir")}}}):a._e(),a.visibilidade.botao.finalizar?e("q-btn",{attrs:{color:"primary",label:"Finalizar"},on:{click:function(t){a.executar("finalizar")}}}):a._e()],1)],1)],1)],1)},i=[];o._withStripped=!0;e("96cf");var r=e("c973"),n=e.n(r),s=function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{staticClass:"Fatura round-borders bg-grey-2 q-pb-sm"},[e("q-toolbar",{staticClass:"Fatura-barra bg-grey-2 q-py-md",attrs:{color:"black",inverted:""}},[e("q-toolbar-title",[e("div",{staticClass:"row items-center"},[e("avatar",{attrs:{imagem:(a.contatos[a.fatura.idContato]||{}).imagem,rotulo:a.fatura.descricaoContato,tamanho:"60"}}),e("div",{staticClass:"col q-ma-sm q-title"},[a._v(a._s(a.fatura.descricaoContato))])],1),e("div",{staticClass:"q-headline"})]),a.fatura.id?e("documento-codigo",{attrs:{documento:a.fatura}}):a._e(),e("q-btn",{attrs:{color:"primary",flat:"",icon:"print",round:""}},[e("q-popover",[e("q-list",{attrs:{link:"",separator:""}},[a._l(a.configImpressaoFatura,function(t){return e("q-item",{key:t.valor,nativeOn:{click:function(e){a.imprimir(t.valor,(a.fatura||{}).id||"0")}}},[e("q-item-side",{attrs:{icon:"print"}}),e("q-item-main",{attrs:{label:t.texto}})],1)}),"optisoul"===a.sistemaPai?a._l(a.configImpressaoEnvelope,function(t){return e("q-item",{key:t.valor,nativeOn:{click:function(e){a.imprimir(t.valor,(a.fatura||{}).id||"0")}}},[e("q-item-side",{attrs:{icon:"print"}}),e("q-item-main",{attrs:{label:t.texto}})],1)}):a._e(),a._l(a.configImpressaoCarne,function(t){return e("q-item",{key:t.valor,nativeOn:{click:function(e){a.imprimir(t.valor,(a.fatura||{}).id||"0")}}},[e("q-item-side",{attrs:{icon:"print"}}),e("q-item-main",{attrs:{label:t.texto}})],1)}),a._l(a.configImpressaoConvenio,function(t){return e("q-item",{key:t.valor,nativeOn:{click:function(e){a.imprimir(t.valor,(a.fatura||{}).id||"0")}}},[e("q-item-side",{attrs:{icon:"print"}}),e("q-item-main",{attrs:{label:t.texto}})],1)})],2)],1)],1),e("q-btn",{attrs:{color:"faded",flat:"",icon:"more_vert",round:""}},[e("q-popover",[e("q-list",{attrs:{link:"",separator:""}},[a.fatura.id?e("q-item",[e("q-item-side",{attrs:{icon:"account_balance"}}),e("q-item-main",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{label:"Emitir cupom"},nativeOn:{click:function(t){a.$refs.documentosFiscais.emitirCupom(a.fatura.id)}}})],1):a._e(),a.fatura.id&&a.$utils.mapearStatus(a.fatura).permiteNota?[e("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],nativeOn:{click:function(t){a.emitirNFeV2({idFatura:a.fatura.id},1,"Venda")}}},[e("q-item-side",{attrs:{icon:"account_balance"}}),e("q-item-main",{attrs:{label:"NFe de Saída/Venda"}})],1),e("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],nativeOn:{click:function(t){a.emitirNFeV2({idFatura:a.fatura.id},0,"Devolução")}}},[e("q-item-side",{attrs:{icon:"account_balance"}}),e("q-item-main",{attrs:{label:"NFe de Entrada/Devolução"}})],1),e("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],nativeOn:{click:function(t){a.emitirNFeV2({idFatura:a.fatura.id},1,"Remessa")}}},[e("q-item-side",{attrs:{icon:"account_balance"}}),e("q-item-main",{attrs:{label:"NFe de Remessa"}})],1)]:a._e()],2)],1)],1)],1),e("div",{staticClass:"bg-grey-2"},[e("documento-metas",{attrs:{slot:"subtitle",documento:a.fatura},slot:"subtitle"})],1),e("div",{staticClass:"q-ma-sm"},[a.vendas.length>0?e("p",{staticClass:"q-item-label ",staticStyle:{color:"#0c0c0c"}},[e("q-icon",{staticClass:"q-mr-md",staticStyle:{color:"#737373"},attrs:{name:"shopping_cart",size:"24px"}}),a._v(" Vendas\n    ")],1):a._e(),a._l(a.vendas,function(t){return e("div",{key:t.id,staticClass:"bg-white q-mt-sm round-borders"},[e("venda-card",{attrs:{id:t.id},on:{atualizar:a.atualizar,executar:a.executar}})],1)}),a.carnes.length>0?e("p",{staticClass:"q-item-label q-mt-md",staticStyle:{color:"#0c0c0c"}},[e("q-icon",{staticClass:"q-mr-md",staticStyle:{color:"#737373"},attrs:{name:"attach_money",size:"24px"}}),a._v(" Carnês\n    ")],1):a._e(),a._l(a.carnes,function(t){return e("div",{key:t.id,staticClass:"bg-white q-mt-sm round-borders"},[e("titulo-card",{staticClass:"q-mt-md",attrs:{dados:t},on:{executar:a.executar}})],1)})],2),e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 col-lg-4 offset-lg-8 border-1 q-my-md"},[e("div",{staticClass:"row gutter-x-sm q-mb-sm"},[e("div",{staticClass:"col-4 col-lg-3",staticStyle:{"line-height":"35px"}},[a._v("Subtotal")]),e("strong",{staticClass:"col-8 text-right"},[a._v(a._s(a._f("numero")(a.fatura.subTotal,2)))])]),a.permissaoDesconto?e("div",{staticClass:"row gutter-x-sm"},[e("div",{staticClass:"col-4 col-lg-3",staticStyle:{"line-height":"50px"}},[a._v("Desconto")]),e("q-field",{staticClass:"col-3"},[e("campo",{attrs:{tipo:"decimal",decimals:"2",suffix:"%","somente-leitura":"Aberta"!==a.fatura.status,erro:a.erroCalculo},on:{input:function(t){a.calculaTotais("descontoPercentual")}},model:{value:a.fatura.totalPercentualDesconto,callback:function(t){a.$set(a.fatura,"totalPercentualDesconto",t)},expression:"fatura.totalPercentualDesconto"}})],1),e("q-field",{staticClass:"col-5"},[e("campo",{attrs:{tipo:"decimal",decimals:"2","somente-leitura":"Aberta"!==a.fatura.status,erro:a.erroCalculo,"erro-rotulo":a.erroCalculoMsg},on:{input:function(t){a.calculaTotais("desconto")}},model:{value:a.fatura.totalDesconto,callback:function(t){a.$set(a.fatura,"totalDesconto",t)},expression:"fatura.totalDesconto"}})],1)],1):a._e(),e("div",{staticClass:"row gutter-x-sm q-mt-sm"},[e("div",{staticClass:"col-4 col-lg-3",staticStyle:{"line-height":"35px"}},[a._v("Total")]),e("strong",{staticClass:"col-8 q-mt-sm text-right"},[a._v(a._s(a._f("numero")(a.fatura.totalDocumento,2)))])])])]),e("div",{staticClass:"Fatura-faturamento round-borders q-ma-sm q-pa-md"},[e("faturamento",{ref:"faturamento",attrs:{documento:a.fatura}})],1),e("div",{staticClass:" round-borders q-ma-sm q-pa-md"},[e("documentos-fiscais",{ref:"documentosFiscais",attrs:{idFatura:a.fatura.id}})],1)],1)},c=[];s._withStripped=!0;e("456d");var d=e("7037"),u=e.n(d),l=(e("2fdb"),e("cadf"),e("6762"),e("ac4d"),e("8a81"),e("ac6a"),e("3156")),m=e.n(l),v=e("448a"),f=e.n(v),p=(e("7514"),e("680c")),h=e.n(p),b=e("df3a"),x=e("88db"),C=e("5d5c"),g=e("a9d2"),q=e("e3f4"),_=e("dd9d"),F=e("1148"),k=e("d4aa"),D=e("1fe0c"),y=e("ed08"),w=e("8149"),P=e("3e8a"),O=e("2ef0"),j={components:{Avatar:b["a"],Campo:x["a"],DocumentoCodigo:C["a"],DocumentoMetas:g["a"],DocumentosFiscais:q["a"],Faturamento:F["a"],TituloCard:k["a"],VendaCard:D["a"]},computed:{config:function(){return w["a"].configuracoes.valores}},data:function(){return{dbUsuario:w["a"].usuario,contatos:{},faturaOriginal:{},fatura:{totalDocumento:0,subTotal:0,totalDesconto:0,totalPercentualDesconto:0},vendas:[],vendasOriginal:[],envelopes:[],envelopesOriginal:[],documentoItens:[],documentoItensOriginal:[],carnes:[],carnesOriginal:[],documentoStatus:[],erroCalculo:!1,erroCalculoMsg:"",sistemaPai:"",configImpressaoCarne:[],configImpressaoConvenio:[],configImpressaoFatura:[],configImpressaoEnvelope:[],permissaoDesconto:!1}},methods:{atualizar:function(){var a=n()(regeneratorRuntime.mark(function a(){var t,e,o,i=this;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,w["a"].permissao.objeto("Diretiva_Caixa_DescontoFatura");case 2:if(this.permissaoDesconto=a.sent,this.vendas=[],this.envelopes=[],this.envelopesOriginal=[],this.documentoItens=[],this.documentoitensOriginal=[],this.carnes=[],this.carnesOriginal=[],this.documentoStatus=[],this.contatos={},this.erroCalculo=!1,this.erroCalculoMsg="",!this.prop.id){a.next=45;break}return a.next=17,w["a"].fatura.leCompleto(this.prop.id);case 17:if(t=a.sent,this.faturaOriginal=Object(y["clonar"])(t.fatura),this.fatura=t.fatura,this.$refs.faturamento&&(this.$refs.faturamento.condicaoPagamentoOriginal=Object(y["clonar"])(t.condicaoPagamento),this.$refs.faturamento.condicaoPagamento=t.condicaoPagamento),this.vendasOriginal=Object(y["clonar"])(t.vendas),this.vendas=t.vendas,!this.receberTitulo.id||t.carnes.find(function(a){return a.id===i.receberTitulo.id})){a.next=29;break}return a.t0=t.carnes,a.next=27,w["a"].financeiroTitulo.le({id:this.receberTitulo.id});case 27:a.t1=a.sent,a.t0.push.call(a.t0,a.t1);case 29:if(this.carnesOriginal=Object(y["clonar"])(t.carnes),this.carnes=t.carnes,e={},!t.fatura.idContato){a.next=38;break}if(o=t.fatura.idContato,e[o]){a.next=38;break}return a.next=37,w["a"].contato.le({id:o});case 37:e[o]=a.sent;case 38:return this.configuraImpressaoCarne(t.fatura.idEmpresa),this.configuraImpressaoConvenio(t.fatura.idEmpresa),this.configuraImpressaoEnvelope(t.fatura.idEmpresa),this.configuraImpressaoFatura(t.fatura.idEmpresa),this.contatos=e,a.next=45,this.calculaTotais();case 45:case"end":return a.stop()}},a,this)}));return function(){return a.apply(this,arguments)}}(),executar:function(){var a=n()(regeneratorRuntime.mark(function a(t){var e;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:if("recalcular"!==t){a.next=11;break}if(!this.prop.id){a.next=9;break}return a.next=4,w["a"].fatura.leCompleto(this.prop.id);case 4:return e=a.sent,this.carnesOriginal=Object(y["clonar"])(e.carnes),this.carnes=e.carnes,a.next=9,this.calculaTotais();case 9:a.next=14;break;case 11:return a.next=13,this.atualizar();case 13:this.$emit("executar",t);case 14:case"end":return a.stop()}},a,this)}));return function(t){return a.apply(this,arguments)}}(),calculaTotais:function(){var a=n()(regeneratorRuntime.mark(function a(t){var e,o;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return e=Object(y["arredondar"])(this.vendas.reduce(function(a,t){return a+t.totalDocumento||0},0)),o=Object(y["arredondar"])(this.carnes.reduce(function(a,t){return a+t.valorARealizar||0},0)),t||(this.fatura.subTotal=Object(y["arredondar"])(e+o),t="desconto"),"descontoPercentual"===t&&(this.fatura.totalDesconto=Object(y["arredondar"])((this.fatura.totalPercentualDesconto||0)/100*this.fatura.subTotal)),"desconto"===t&&(this.fatura.totalPercentualDesconto=Object(y["arredondar"])((this.fatura.totalDesconto||0)/this.fatura.subTotal*100)),this.fatura.totalDocumento=Object(y["arredondar"])(this.fatura.subTotal-(this.fatura.totalDesconto||0)),this.erroCalculo=!1,this.erroCalculoMsg="",0!==this.fatura.totalDesconto&&this.fatura.totalDesconto>e&&(this.erroCalculo=!0,this.erroCalculoMsg="Desconto maior que o total das vendas"),0!==this.fatura.totalDesconto&&this.fatura.totalDocumento>this.fatura.subTotal&&(this.erroCalculo=!0),a.prev=10,a.next=13,this.$refs.faturamento.resumeCondicaoPagamento();case 13:return a.next=15,this.$refs.faturamento.atualizaValorRestante();case 15:return a.next=17,this.$refs.faturamento.redefinirCampos();case 17:a.next=21;break;case 19:a.prev=19,a.t0=a["catch"](10);case 21:case"end":return a.stop()}},a,this,[[10,19]])}));return function(t){return a.apply(this,arguments)}}(),configuraImpressaoConvenio:function(){var a=n()(regeneratorRuntime.mark(function a(t){var e;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,w["a"].configuracoes.porNome("impressao.convenio",t);case 2:e=a.sent,this.configImpressaoConvenio=f()(e.length?e.map(function(a){return m()({texto:"Imprimir Convênio"},a)}):[{valor:"convenio",texto:"Imprimir Convênio"}]);case 4:case"end":return a.stop()}},a,this)}));return function(t){return a.apply(this,arguments)}}(),configuraImpressaoCarne:function(){var a=n()(regeneratorRuntime.mark(function a(t){var e;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,w["a"].configuracoes.porNome("impressao.carne",t);case 2:e=a.sent,this.configImpressaoCarne=f()(e.length?e.map(function(a){return m()({texto:"Imprimir Carnê"},a)}):[{valor:"carne-crediario",texto:"Reimprimir carnê e notas promissórias da fatura"}]);case 4:case"end":return a.stop()}},a,this)}));return function(t){return a.apply(this,arguments)}}(),configuraImpressaoEnvelope:function(){var a=n()(regeneratorRuntime.mark(function a(t){var e;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,w["a"].configuracoes.porNome("impressao.envelope",t);case 2:e=a.sent,this.configImpressaoEnvelope=f()(e.length?e.map(function(a){return m()({texto:"Imprimir Envelope"},a)}):[{valor:"envelope",texto:"Imprimir Envelope"},{valor:"envelopeMini",texto:"Imprimir Envelope Mini"}]);case 4:case"end":return a.stop()}},a,this)}));return function(t){return a.apply(this,arguments)}}(),configuraImpressaoFatura:function(){var a=n()(regeneratorRuntime.mark(function a(t){var e;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,w["a"].configuracoes.porNome("impressao.fatura",t);case 2:e=a.sent,this.configImpressaoFatura=f()(e.length?e.map(function(a){return m()({texto:"Imprimir Fatura"},a)}):[{valor:"invoice",texto:"Fatura (Invoice)"},{valor:"fatura-recibo",texto:"Recibo"}]);case 4:case"end":return a.stop()}},a,this)}));return function(t){return a.apply(this,arguments)}}(),finalizar:function(){var a=n()(regeneratorRuntime.mark(function a(t){var e,o=this;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.delegateYield(regeneratorRuntime.mark(function a(){var e,i,r,n,s,c,d,u,l,m,v,f,p,h,b,x,C,g,q,_,F,k,D,j,E,S,M,T,z,A,$,R,I,V,N,H,B,L,U,J,Y,W,Q,G,K,X,Z,aa,ta,ea,oa,ia,ra,na,sa,ca,da,ua,la,ma,va,fa,pa,ha,ba,xa,Ca,ga,qa,_a,Fa,ka,Da,ya,wa,Pa,Oa,ja,Ea,Sa,Ma,Ta,za,Aa,$a,Ra,Ia,Va,Na,Ha,Ba,La,Ua,Ja,Ya,Wa,Qa,Ga,Ka,Xa,Za,at,tt,et,ot,it,rt,nt,st,ct,dt,ut,lt,mt,vt,ft,pt,ht,bt,xt,Ct,gt,qt,_t,Ft,kt,Dt,yt,wt,Pt,Ot,jt,Et,St,Mt,Tt,zt,At,$t,Rt,It,Vt,Nt,Ht,Bt,Lt,Ut;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:if(Object(y["verificarErro"])(o.erroCalculo,"Erro de cálculo encontrado."),t){a.next=10;break}return a.prev=2,a.next=5,o.$q.dialog({cancel:"Cancelar",message:"Esta ação irá finalizar esta fatura.",noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 5:a.next=10;break;case 7:return a.prev=7,a.t0=a["catch"](2),a.abrupt("return",{v:!1});case 10:return o.$q.loading.show({message:"Processando..."}),e=Object(y["clonar"])(o.fatura),i=Object(y["clonar"])(o.vendas),r=Object(y["clonar"])(o.carnes),a.next=16,o.$refs.faturamento.validar();case 16:if(n=Object(O["orderBy"])(o.$refs.faturamento.condicaoPagamento.filter(function(a){return a.valor}),["idFormaPagamento","autorizacao","dataVencimento"]),Object(y["verificarErro"])(i.find(function(a){return!a.dataHoraFinalizado}),"Existe pedido de venda sem data de finalização."),s=Object(y["arredondar"])(o.carnes.reduce(function(a,t){return a+(t.valorARealizar||0)},0)),c=Object(y["arredondar"])(n.reduce(function(a,t){return a+(t.valor||0)},0)),d=0,t&&(n=n.filter(function(a){return!o.$refs.faturamento.condicaoPagamentoOriginal.find(function(t){return t.id===a.id})})),!(e.totalDocumento>=0)){a.next=41;break}if(!o.carnes.length){a.next=40;break}if(!(c<s)){a.next=27;break}return o.$q.notify("Valor pago menor que a soma dos títulos à faturar!"),a.abrupt("return",{v:!1});case 27:return a.next=29,w["a"].permissao.objeto("Diretiva_Caixa_PagarCarneCartao");case 29:if(u=a.sent,u){a.next=40;break}l=n.reduce(function(a,t){var e="".concat(t.autorizacao||"").concat(t.documento||"").concat(t.idFormaPagamento);return a[e]||(a[e]={parcelas:0,formaPagamento:t.formaPagamento}),a[e].parcelas++,a},{}),a.t1=regeneratorRuntime.keys(l);case 33:if((a.t2=a.t1()).done){a.next=40;break}if(m=a.t2.value,!(l[m].parcelas>o.carnes.length)){a.next=38;break}return o.$q.notify("Quantidade de parcelas da forma de pagamento ".concat(l[m].formaPagamento," acima do permitido.")),a.abrupt("return",{v:!1});case 38:a.next=33;break;case 40:c<e.totalDocumento&&(d=1);case 41:return v=t?e.dataHoraFinalizado:Object(y["dataAtual"])(),f=v,a.next=45,w["a"].documento.le({id:o.$refs.faturamento.idDocumentoCaixa});case 45:if(p=a.sent,h=1===d?"Aguardando Pagamento":"Finalizada",o.documentoStatus=[],t){a.next=162;break}o.documentoStatus.push({id:Object(y["uuid"])(),idDocumento:e.id,operacao:"Fatura",statusOriginal:e.status,statusFinalizado:h,dataHoraEmissao:v,idUsuarioAlterou:w["a"].usuario.logado.id,idDocumentoCaixa:p.id||""}),e.status=h,e.dataHoraFinalizado=v,h="Faturado",b=0,x=!0,C=!1,g=void 0,a.prev=57,q=i[Symbol.iterator]();case 59:if(x=(_=q.next()).done){a.next=125;break}return F=_.value,o.documentoStatus.push({id:Object(y["uuid"])(),idDocumento:F.id,operacao:"Venda de Mercadoria",statusOriginal:F.status,statusFinalizado:h,dataHoraEmissao:v,idUsuarioAlterou:w["a"].usuario.logado.id,idDocumentoCaixa:p.id||""}),F.status=h,a.next=65,w["a"].documento.le({tipo:"Envelope",documentoId:F.id,documentoTipo:"Venda"});case 65:if(k=a.sent,o.envelopesOriginal=o.envelopesOriginal.concat(Object(y["clonar"])(k)),D=k.find(function(a){return"Entregue"!==a.status}),!D){a.next=97;break}return a.prev=69,o.$q.loading.hide(),a.next=73,o.$q.dialog({cancel:"Não",message:"Existe envelope(s) não entregue. Deseja dar baixa no(s) mesmo(s)?",noRefocus:!0,ok:"Sim",preventClose:!0,title:"Confirma?"});case 73:for(o.$q.loading.show({message:"Processando..."}),j=!0,E=!1,S=void 0,a.prev=77,M=k[Symbol.iterator]();!(j=(T=M.next()).done);j=!0)z=T.value,o.documentoStatus.push({id:Object(y["uuid"])(),idDocumento:z.id,operacao:"Envelope",statusOriginal:z.status,statusFinalizado:"Entregue",dataHoraEmissao:v,idUsuarioAlterou:w["a"].usuario.logado.id,idDocumentoCaixa:o.$refs.faturamento.idDocumentoCaixa}),z.status="Entregue",z.dataHoraFinalizado=Object(y["dataAtual"])();a.next=85;break;case 81:a.prev=81,a.t3=a["catch"](77),E=!0,S=a.t3;case 85:a.prev=85,a.prev=86,j||null==M.return||M.return();case 88:if(a.prev=88,!E){a.next=91;break}throw S;case 91:return a.finish(88);case 92:return a.finish(85);case 93:a.next=97;break;case 95:a.prev=95,a.t4=a["catch"](69);case 97:return o.envelopes=o.envelopes.concat(k),a.next=100,w["a"].documentoItem.le({idDocumento:F.id});case 100:for(A=a.sent,o.documentoItensOriginal=o.documentoItensOriginal.concat(Object(y["clonar"])(A)),$=!0,R=!1,I=void 0,a.prev=105,V=A[Symbol.iterator]();!($=(N=V.next()).done);$=!0)H=N.value,H.status=h,H.total>0&&(H.quantidade=H.quantidade||1,H.valorItem=H.valorItem||0,H.descontoItem=H.descontoItem||0,H.descontoTotalRateado=H.descontoTotalRateado||0,e.subTotal=e.subTotal||0,e.totalDesconto=e.totalDesconto||0,B=(H.valorItem-H.descontoItem)*H.quantidade-H.descontoTotalRateado,L=Object(y["arredondar"])(e.totalDesconto*B/e.subTotal||0),H.descontoFaturaRateado=Object(y["arredondar"])(L),H.valorRealTotal=Object(y["arredondar"])(B-L),H.valorReal=Object(y["arredondar"])(H.valorRealTotal/H.quantidade),b+=L);a.next=113;break;case 109:a.prev=109,a.t5=a["catch"](105),R=!0,I=a.t5;case 113:a.prev=113,a.prev=114,$||null==V.return||V.return();case 116:if(a.prev=116,!R){a.next=119;break}throw I;case 119:return a.finish(116);case 120:return a.finish(113);case 121:o.documentoItens=o.documentoItens.concat(A);case 122:x=!0,a.next=59;break;case 125:a.next=131;break;case 127:a.prev=127,a.t6=a["catch"](57),C=!0,g=a.t6;case 131:a.prev=131,a.prev=132,x||null==q.return||q.return();case 134:if(a.prev=134,!C){a.next=137;break}throw g;case 137:return a.finish(134);case 138:return a.finish(131);case 139:if(e.totalDesconto===Object(y["arredondar"])(b)){a.next=162;break}for(U=Object(y["arredondar"])((e.totalDesconto||0)-(b||0)),Y=0,W=!0,Q=!1,G=void 0,a.prev=145,K=o.documentoItens[Symbol.iterator]();!(W=(X=K.next()).done);W=!0)Z=X.value,Z.total>Y&&(Y=Z.total,J=Z);a.next=153;break;case 149:a.prev=149,a.t7=a["catch"](145),Q=!0,G=a.t7;case 153:a.prev=153,a.prev=154,W||null==K.return||K.return();case 156:if(a.prev=156,!Q){a.next=159;break}throw G;case 159:return a.finish(156);case 160:return a.finish(153);case 161:J&&(aa=(J.descontoFaturaRateado||0)+(U||0),ta=((J.valorItem||0)-(J.descontoItem||0))*(J.quantidade||1)-(J.descontoTotalRateado||0)-(aa||0),ea=(ta||0)/(J.quantidade||1),J.descontoFaturaRateado=Object(y["arredondar"])(aa),J.valorReal=Object(y["arredondar"])(ea),J.valorRealTotal=Object(y["arredondar"])(ta));case 162:return a.t8=parseInt,a.next=165,w["a"].configuracoes.le({nome:"financeiro.planocontas.renegociacao"});case 165:return a.t9=a.sent[0].valor,oa=(0,a.t8)(a.t9),a.next=169,w["a"].financeiroPlanoConta.le({codigoFinanceiroPlanoConta:oa});case 169:return ia=a.sent,a.t10=parseInt,a.next=173,w["a"].configuracoes.le({nome:"financeiro.planocontas.duplicatareceber"});case 173:return a.t11=a.sent[0].valor,ra=(0,a.t10)(a.t11),a.next=177,w["a"].financeiroPlanoConta.le({codigoFinanceiroPlanoConta:ra});case 177:return na=a.sent,a.t12=parseInt,a.next=181,w["a"].configuracoes.le({nome:"financeiro.planocontas.duplicatapagar"});case 181:return a.t13=a.sent[0].valor,sa=(0,a.t12)(a.t13),a.next=185,w["a"].financeiroPlanoConta.le({codigoFinanceiroPlanoConta:sa});case 185:return ca=a.sent,a.t14=parseInt,a.next=189,w["a"].configuracoes.le({nome:"financeiro.planocontas.cheque"});case 189:return a.t15=a.sent[0].valor,da=(0,a.t14)(a.t15),a.next=193,w["a"].financeiroPlanoConta.le({codigoFinanceiroPlanoConta:da});case 193:return ua=a.sent,a.t16=parseInt,a.next=197,w["a"].configuracoes.le({nome:"financeiro.planocontas.faturamentogeral"});case 197:return a.t17=a.sent[0].valor,la=(0,a.t16)(a.t17),a.next=201,w["a"].financeiroPlanoConta.le({codigoFinanceiroPlanoConta:la});case 201:return ma=a.sent,a.t18=parseInt,a.next=205,w["a"].configuracoes.le({nome:"financeiro.planocontas.comprageral"});case 205:return a.t19=a.sent[0].valor,va=(0,a.t18)(a.t19),a.next=209,w["a"].financeiroPlanoConta.le({codigoFinanceiroPlanoConta:va});case 209:return fa=a.sent,a.t20=parseInt,a.next=213,w["a"].configuracoes.le({nome:"financeiro.planocontas.frete"});case 213:return a.t21=a.sent[0].valor,pa=(0,a.t20)(a.t21),a.next=217,w["a"].financeiroPlanoConta.le({codigoFinanceiroPlanoConta:pa});case 217:return ha=a.sent,a.t22=parseInt,a.next=221,w["a"].configuracoes.le({nome:"financeiro.planocontas.cmv"});case 221:return a.t23=a.sent[0].valor,ba=(0,a.t22)(a.t23),a.next=225,w["a"].financeiroPlanoConta.le({codigoFinanceiroPlanoConta:ba});case 225:return xa=a.sent,a.t24=parseInt,a.next=229,w["a"].configuracoes.le({nome:"financeiro.planocontas.creditoclientes"});case 229:return a.t25=a.sent[0].valor,Ca=(0,a.t24)(a.t25),a.next=233,w["a"].financeiroPlanoConta.le({codigoFinanceiroPlanoConta:Ca});case 233:return ga=a.sent,a.next=236,w["a"].formaPagamento.le();case 236:qa=a.sent,_a=Object(y["arredondar"])(i.reduce(function(a,t){return a+t.totalDocumento},0)),_a=Object(y["arredondar"])(_a-e.totalDesconto),Fa=e.totalDocumento,ka=[],Da=[],ya=[],wa=[],Pa=[],Oa=1,ja="",Ea=1,Sa="",Ma=!0,Ta=!1,za=void 0,a.prev=252,Aa=regeneratorRuntime.mark(function a(){var t,i,r,c,u,l,m,h,b,x,C,g,q,_,F,k,D,O,j,E,S,M,T,z,A,$,R;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:if(t=Ra.value,t.sinal=t.sinal||d,i=qa.filter(function(a){return a.id===t.idFormaPagamento})[0],!(Fa<0)){a.next=9;break}Sa=Object(y["uuid"])(),Da.push({id:Object(y["uuid"])(),idFinanceiroMovimentacaoN:Sa,idContato:e.idContato,idEmpresa:e.idEmpresa,idFinanceiroPlanoConta:ma.id,dataEmissao:v,valorCredito:0,valorDebito:Object(y["arredondar"])(-1*Fa),descricao:ma.descricao,observacao:"Movimentação de débito da devolução de clientes no(s) pedido(s) da fatura código (".concat(e.id,")"),automatico:0,liquidando:0,dataCompetencia:f,dataVencimento:t.dataVencimento,dataMovimento:t.dataVencimento,documentoTipo:"Fatura",documentoId:e.id,idDocumentoCaixa:p.id}),Da.push({id:Object(y["uuid"])(),idFinanceiroMovimentacaoN:Sa,idContato:e.idContato,idEmpresa:e.idEmpresa,idFinanceiroPlanoConta:ga.id,dataEmissao:v,valorCredito:Object(y["arredondar"])(-1*Fa),valorDebito:0,descricao:"Crédito proveniente de produtos devolvidos no(s) pedido(s) da fatura código (".concat(e.id,")"),observacao:"Movimentação de crédito na conta de clientes",automatico:0,liquidando:0,dataCompetencia:f,dataVencimento:t.dataVencimento,dataMovimento:t.dataVencimento,documentoTipo:"Fatura",documentoId:e.id,idDocumentoCaixa:p.id}),a.next=65;break;case 9:if(ja!==t.idFormaPagamento+t.autorizacao&&(ja=t.idFormaPagamento+t.autorizacao,Oa=1,Ea=n.reduce(function(a,t){return t.idFormaPagamento+t.autorizacao===ja?a+1:a},0)),"Título Liquidado"===i.tipoFinanceiro&&(Sa=Object(y["uuid"])()),!(s>0)){a.next=25;break}if(r=Object(y["uuid"])(),c=Object(y["arredondar"])(t.valor*(s/Fa)),u=0,l=0,m=0,h=0,5!==i.tipo){a.next=21;break}return a.next=18,Object(P["a"])().financeiroBanco.toArray();case 18:a.t0=function(a){return 122===a.codigoBanco},b=a.sent.find(a.t0),b&&(l=b.percentualMulta||0,h=b.percentualJuros||0,u=Object(y["arredondar"])(l/100*c),m=Object(y["arredondar"])(h/100*c));case 21:ka.push({id:r,idFinanceiroPlanoConta:ia.id,idContato:e.idContato,dataEmissao:v,dataCompetencia:f,dataVencimento:t.dataVencimento,dataVencimentoOriginal:t.dataVencimento,valor:c,valorTotal:c,valorARealizar:c,valorMulta:u,percentualMulta:l,valorJuros:m,percentualJuros:h,documentoId:e.id,documentoTipo:"Fatura",parcela:Oa+"/"+Ea,descricao:"Fatura de Venda Mercadoria",observacao:"".concat(o.$refs.faturamento.observacaoFaturamento||""," ").concat(t.observacao||"").trim(),documentoVinculado:1,receberPagar:1,valorDesconto:0,percentualDesconto:0,idEmpresa:e.idEmpresa,formaDePagamento:i.descricao,carne:5===i.tipo?1:0,dataEmissaoCarne:5===i.tipo?v:"",idDocumentoCaixa:p.id,idFinanceiroMovimentacaoAgrupamento:"Título Liquidado"===i.tipoFinanceiro?Sa:""}),t.idFinanceiroTitulo=r,2===i.tipo&&wa.push({idTitulo:r,idDocumentoCondicaoPagamento:t.id,valor:c,dataVencimento:t.dataVencimento,idBanco:t.idBanco,agencia:t.agencia,conta:t.conta,numeroCheque:t.numeroCheque,formaPagamento:i}),Pa.push({idTitulo:r,valor:c,desconto:0});case 25:if(!(_a>0)){a.next=38;break}if(x=Object(y["uuid"])(),C=Object(y["arredondar"])(t.valor*(_a/Fa)),g=0,q=0,_=0,F=0,5!==i.tipo){a.next=35;break}return a.next=32,Object(P["a"])().financeiroBanco.toArray();case 32:a.t1=function(a){return 122===a.codigoBanco},k=a.sent.find(a.t1),k&&(q=k.percentualMulta||0,F=k.percentualJuros||0,g=Object(y["arredondar"])(q/100*C),_=Object(y["arredondar"])(F/100*C));case 35:ka.push({id:x,idFinanceiroPlanoConta:ma.id,idContato:e.idContato,dataEmissao:v,dataCompetencia:f,dataVencimento:t.dataVencimento,dataVencimentoOriginal:t.dataVencimento,valor:C,valorTotal:C,valorARealizar:C,valorMulta:g,percentualMulta:q,valorJuros:_,percentualJuros:F,documentoId:e.id,documentoTipo:"Fatura",parcela:Oa+"/"+Ea,descricao:"Fatura de Venda Mercadoria",observacao:"".concat(o.$refs.faturamento.observacaoFaturamento||""," ").concat(t.observacao||"").trim(),documentoVinculado:1,receberPagar:1,valorDesconto:0,percentualDesconto:0,idEmpresa:e.idEmpresa,formaDePagamento:i.descricao,carne:5===i.tipo?1:0,dataEmissaoCarne:5===i.tipo?v:"",idDocumentoCaixa:p.id,idFinanceiroMovimentacaoAgrupamento:"Título Liquidado"===i.tipoFinanceiro?Sa:""}),t.idFinanceiroTitulo=x,2===i.tipo&&wa.push({idTitulo:x,idDocumentoCondicaoPagamento:t.id,valor:C,dataVencimento:t.dataVencimento,idBanco:t.idBanco,agencia:t.agencia,conta:t.conta,numeroCheque:t.numeroCheque,formaPagamento:i});case 38:if(!("Título Liquidado"===i.tipoFinanceiro&&_a>=0)){a.next=49;break}return Da.push({id:Object(y["uuid"])(),idFinanceiroMovimentacaoN:Sa,idEmpresa:e.idEmpresa,idContato:e.idContato,idFinanceiroPlanoConta:na.id,idFinanceiroTitulo:t.idFinanceiroTitulo,dataEmissao:v,valorCredito:t.valor,valorDebito:0,descricao:na.descricao,observacao:"Liquidação referente título fatura (".concat(e.id,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:f,dataVencimento:t.dataVencimento,dataMovimento:t.dataVencimento,documentoTipo:"Fatura",documentoId:e.id,idDocumentoCaixa:p.id}),D=i.idFinanceiroPlanoConta,1===i.tipo&&(p||{}).idFinanceiroPlanoContaCaixa&&(D=p.idFinanceiroPlanoContaCaixa),a.next=44,w["a"].financeiroPlanoConta.le({id:D});case 44:for(O=a.sent,Da.push({id:Object(y["uuid"])(),idFinanceiroMovimentacaoN:Sa,idEmpresa:e.idEmpresa,idContato:e.idContato,idFinanceiroPlanoConta:O.id,idFinanceiroTitulo:t.idFinanceiroTitulo,dataEmissao:v,valorCredito:0,valorDebito:t.valor,descricao:O.descricao,observacao:"Liquidação referente título fatura (".concat(e.id,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:f,dataVencimento:t.dataVencimento,dataMovimento:t.dataVencimento,documentoTipo:"Fatura",documentoId:e.id,idDocumentoCaixa:p.id}),j=0;j<ka.length;j++)E=ka[j],E.idFinanceiroMovimentacaoAgrupamento===Sa&&(E.valorRealizado=E.valorARealizar,E.dataPagamento=t.dataVencimento,E.dataMovimento=t.dataVencimento,E.idDocumentoCaixaLiquidacao=p.id);a.next=49;break;case 49:if(!i.aliquota){a.next=64;break}if(S=Object(y["uuid"])(),M=Object(y["arredondar"])(t.valor*(i.aliquota/100)),ka.push({id:S,idFinanceiroPlanoConta:i.idFinanceiroPlanoContaAliquota,idContato:i.idContatoOperadoraCartao,dataEmissao:v,dataCompetencia:f,dataVencimento:t.dataVencimento,dataVencimentoOriginal:t.dataVencimento,valor:M,valorTotal:M,valorARealizar:M,valorMulta:0,percentualJuros:0,documentoId:e.id,documentoTipo:"Fatura",parcela:Oa+"/"+Ea,descricao:"Título referente a alíquota da forma de pagamento: ".concat(i.descricao),observacao:"Título referente a alíquota. ".concat(o.$refs.faturamento.observacaoFaturamento||""," ").concat(t.observacao||"").trim(),documentoVinculado:1,receberPagar:0,valorDesconto:0,percentualDesconto:0,idEmpresa:e.idEmpresa,formaDePagamento:i.descricao,idDocumentoCaixa:p.id}),t.idFinanceiroTituloPagar=S,"Título Liquidado"!==i.tipoFinanceiro){a.next=64;break}return T=Object(y["uuid"])(),Da.push({id:Object(y["uuid"])(),idFinanceiroMovimentacaoN:T,idEmpresa:e.idEmpresa,idFinanceiroPlanoConta:ca.id,dataEmissao:v,valorCredito:0,valorDebito:M,descricao:ca.descricao,observacao:"Liquidação alíquota cartão referente fatura (".concat(e.id,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:f,dataVencimento:t.dataVencimento,dataMovimento:t.dataVencimento,documentoTipo:"Fatura",documentoId:e.id,idFinanceiroTitulo:S,idContato:i.idContatoOperadoraCartao,idDocumentoCaixa:p.id}),z=i.idFinanceiroPlanoConta,1===i.tipo&&(p||{}).idFinanceiroPlanoContaCaixa&&(z=p.idFinanceiroPlanoContaCaixa),a.next=61,w["a"].financeiroPlanoConta.le({id:z});case 61:for(A=a.sent,Da.push({id:Object(y["uuid"])(),idFinanceiroMovimentacaoN:T,idEmpresa:e.idEmpresa,idFinanceiroPlanoConta:A.id,dataEmissao:v,valorCredito:M,valorDebito:0,descricao:A.descricao,observacao:"Liquidação alíquota cartão referente fatura (".concat(e.id,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:f,dataVencimento:t.dataVencimento,dataMovimento:t.dataVencimento,documentoTipo:"Fatura",documentoId:e.id,idFinanceiroTitulo:S,idContato:i.idContatoOperadoraCartao,idDocumentoCaixa:p.id}),$=0;$<ka.length;$++)R=ka[$],R.id===S&&(R.idFinanceiroMovimentacaoAgrupamento=T,R.valorRealizado=M,R.dataPagamento=t.dataVencimento,R.dataMovimento=t.dataVencimento,R.idDocumentoCaixaLiquidacao=p.id);case 64:Oa++;case 65:case"end":return a.stop()}},a)}),$a=n.filter(function(a){return!a.sinal})[Symbol.iterator]();case 255:if(Ma=(Ra=$a.next()).done){a.next=260;break}return a.delegateYield(Aa(),"t26",257);case 257:Ma=!0,a.next=255;break;case 260:a.next=266;break;case 262:a.prev=262,a.t27=a["catch"](252),Ta=!0,za=a.t27;case 266:a.prev=266,a.prev=267,Ma||null==$a.return||$a.return();case 269:if(a.prev=269,!Ta){a.next=272;break}throw za;case 272:return a.finish(269);case 273:return a.finish(266);case 274:Ia=[],Va=function(){for(var a=wa[Na],t=Object(y["uuid"])(),o=Object(y["uuid"])(),i=0;i<ka.length;i++){var r=ka[i];r.id===a.idTitulo&&(r.idFinanceiroMovimentacaoAgrupamento=o,r.valorRealizado=r.valorARealizar,r.dataPagamento=a.dataVencimento,r.dataMovimento=a.dataVencimento,r.idDocumentoCaixaLiquidacao=p.id)}if(Ia.includes(a.idDocumentoCondicaoPagamento))return"continue";Ia.push(a.idDocumentoCondicaoPagamento);var n=Object(y["arredondar"])(wa.reduce(function(t,e){return e.idDocumentoCondicaoPagamento===a.idDocumentoCondicaoPagamento&&(t+=t+(e.valor||0)),t},0));ka.push({id:t,idFinanceiroPlanoConta:ia.id,idContato:e.idContato,dataEmissao:v,dataCompetencia:f,dataVencimento:a.dataVencimento,dataVencimentoOriginal:a.dataVencimento,valor:n,valorTotal:n,valorARealizar:n,valorMulta:0,percentualJuros:0,receberPagar:1,valorDesconto:0,percentualDesconto:0,documentoId:e.id,documentoTipo:"Fatura",idEmpresa:e.idEmpresa,formaDePagamento:a.formaPagamento.descricao,idDocumentoCaixa:p.id,cheque:1,idBanco:a.idBanco,agencia:a.agencia,conta:a.conta,numeroCheque:a.numeroCheque,observacao:"Liquidação de Cheques da Fatura #".concat(e.id," - CódigoN #").concat(o),descricao:"Cheque"}),Da.push({id:Object(y["uuid"])(),idFinanceiroMovimentacaoN:o,idEmpresa:e.idEmpresa,idContato:e.idContato,idFinanceiroPlanoConta:ua.id,idFinanceiroTitulo:t,dataEmissao:v,valorCredito:0,valorDebito:n,descricao:"Cheque - Crédito de títulos a receber",observacao:"Crédito de títulos a receber",automatico:0,liquidando:0,dataCompetencia:f,dataVencimento:a.dataVencimento,dataMovimento:a.dataVencimento,idFinanceiroCheque:t,idDocumentoCaixa:p.id}),Da.push({id:Object(y["uuid"])(),idFinanceiroMovimentacaoN:o,idEmpresa:e.idEmpresa,idContato:e.idContato,idFinanceiroPlanoConta:na.id,idFinanceiroTitulo:t,dataEmissao:v,valorCredito:n,valorDebito:0,descricao:na.descricao,observacao:"Contabilização automática",automatico:0,liquidando:0,dataCompetencia:f,dataVencimento:a.dataVencimento,dataMovimento:a.dataVencimento,idFinanceiroCheque:t,idDocumentoCaixa:p.id})},Na=0;case 277:if(!(Na<wa.length)){a.next=284;break}if(Ha=Va(),"continue"!==Ha){a.next=281;break}return a.abrupt("continue",281);case 281:Na++,a.next=277;break;case 284:if(!(s>0)){a.next=326;break}for(Ba=Object(y["uuid"])(),Da.push({id:Object(y["uuid"])(),idFinanceiroMovimentacaoN:Ba,idEmpresa:e.idEmpresa,idContato:e.idContato,idFinanceiroPlanoConta:na.id,dataEmissao:v,valorCredito:s,valorDebito:0,descricao:na.descricao,observacao:"Contabilização automática",automatico:1,liquidando:0,dataCompetencia:f,dataVencimento:v,dataMovimento:v,idDocumentoCaixa:p.id}),Da.push({id:Object(y["uuid"])(),idFinanceiroMovimentacaoN:Ba,idEmpresa:e.idEmpresa,idContato:e.idContato,idFinanceiroPlanoConta:ia.id,dataEmissao:v,valorCredito:0,valorDebito:s,descricao:ia.descricao,observacao:"Contabilização automática - Complemento",automatico:0,liquidando:0,dataCompetencia:f,dataVencimento:v,dataMovimento:v,documentoTipo:"Renegociação",documentoId:Ba,idDocumentoCaixa:p.id}),La=0;La<Pa.length;La++)Ua=Pa[La],ya.push({idFinanceiroMovimentacaoN:Ba,idFinanceiroTitulo:Ua.idTitulo,dataVencimento:v,valorOriginal:Ua.valor,valorDesconto:Ua.desconto,valorTotal:Object(y["arredondar"])(Ua.valor-Ua.desconto)});Ja=!0,Ya=!1,Wa=void 0,a.prev=292,Qa=r[Symbol.iterator]();case 294:if(Ja=(Ga=Qa.next()).done){a.next=311;break}if(Ka=Ga.value,Ka.idFinanceiroMovimentacaoAgrupamento=Ba,Ka.idDocumentoCaixaLiquidacao=p.id,Ka.dataPagamento=v,Ka.dataMovimento=v,Ka.renegociado=1,1!==Ka.cheque){a.next=304;break}return Ka.valorRealizado=Ka.valor,a.abrupt("continue",308);case 304:if(Ka.valorARealizar){a.next=307;break}return Ka.valorRealizado=Ka.valorTotal,a.abrupt("continue",308);case 307:Ka.valorRealizado=Ka.valorARealizar;case 308:Ja=!0,a.next=294;break;case 311:a.next=317;break;case 313:a.prev=313,a.t28=a["catch"](292),Ya=!0,Wa=a.t28;case 317:a.prev=317,a.prev=318,Ja||null==Qa.return||Qa.return();case 320:if(a.prev=320,!Ya){a.next=323;break}throw Wa;case 323:return a.finish(320);case 324:return a.finish(317);case 325:ka=ka.concat(r);case 326:if(0!==d){a.next=494;break}if(Xa=Object(y["uuid"])(),Za=e.valorFrete||0,at=0,tt=0,et=[],Za>0&&(Da.push({id:Object(y["uuid"])(),idFinanceiroMovimentacaoN:Xa,idEmpresa:e.idEmpresa,idFinanceiroPlanoConta:ma.id,dataEmissao:v,valorCredito:0,valorDebito:Za,descricao:ma.descricao,observacao:"Lançamento frete da fatura (".concat(e.id,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:f,dataVencimento:v,dataMovimento:v,documentoTipo:"Fatura",documentoId:e.id,idDocumentoCaixa:p.id}),Da.push({id:Object(y["uuid"])(),idFinanceiroMovimentacaoN:Xa,idEmpresa:e.idEmpresa,idFinanceiroPlanoConta:ha.id,dataEmissao:v,valorCredito:Za,valorDebito:0,descricao:ha.descricao,observacao:"Lançamento frete da fatura (".concat(e.id,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:f,dataVencimento:v,dataMovimento:v,documentoTipo:"Fatura",documentoId:e.id,idDocumentoCaixa:p.id})),t){a.next=494;break}Xa=Object(y["uuid"])(),ot=!0,it=!1,rt=void 0,a.prev=338,nt=o.documentoItens[Symbol.iterator]();case 340:if(ot=(st=nt.next()).done){a.next=425;break}return ct=st.value,dt="",ut={},lt="",mt={},vt="",ft={},a.next=350,w["a"].item.leNew({id:ct.idItem});case 350:if(pt=a.sent,dt=ct.idPlanoContaEstoque,dt){a.next=357;break}return a.next=355,w["a"].perfilContabilItem.le({idPerfilContabil:pt.idPerfilContabil,idCfop:ct.idCfop,and:{idPerfilContabil:pt.idPerfilContabil,idCfop:ct.idCfop}});case 355:ht=a.sent,ht.length&&ht[0].idPlanoContaEstoque&&(dt=ht[0].idPlanoContaEstoque);case 357:if(!dt&&fa.id&&(dt=fa.id),dt||!ct.idCfop){a.next=363;break}return a.next=361,w["a"].cfop.le({id:ct.idCfop});case 361:bt=a.sent,dt=bt.idPlanoContaEstoque;case 363:return a.next=365,w["a"].financeiroPlanoConta.le({id:dt});case 365:if(ut=a.sent,ut.id){a.next=369;break}return o.$q.notify("Não foi possível localizar Conta de Estoque."),a.abrupt("return",{v:void 0});case 369:if(lt="",lt){a.next=375;break}return a.next=373,w["a"].perfilContabilItem.le({idPerfilContabil:pt.idPerfilContabil,idCfop:ct.idCfop,and:{idPerfilContabil:pt.idPerfilContabil,idCfop:ct.idCfop}});case 373:xt=a.sent,xt.length&&xt[0].idPlanoContaDespesa&&(lt=xt[0].idPlanoContaDespesa);case 375:if(!lt&&xa.id&&(lt=xa.id),lt||!ct.idCfop){a.next=381;break}return a.next=379,w["a"].cfop.le({id:ct.idCfop});case 379:Ct=a.sent,lt=Ct.idPlanoContaDestino;case 381:return a.next=383,w["a"].financeiroPlanoConta.le({id:lt});case 383:if(mt=a.sent,mt.id){a.next=387;break}return o.$q.notify("Não foi possível localizar Conta de Despesa."),a.abrupt("return",{v:void 0});case 387:if(gt=Object(y["arredondar"])(ct.total-(ct.descontoTotalRateado||0)-(ct.descontoFaturaRateado||0)),qt=Object(y["arredondar"])(ct.valorCustoMedio*ct.quantidade),!qt){a.next=422;break}if(ct.operacaoFator<0?(Da.push({id:Object(y["uuid"])(),idFinanceiroMovimentacaoN:Xa,idEmpresa:e.idEmpresa,idFinanceiroPlanoConta:ut.id,dataEmissao:ct.dataHoraFinalizado||v,valorCredito:qt,valorDebito:0,descricao:ut.descricao,observacao:"Movimentações de CMV referente fatura (".concat(e.id,") e item (").concat(ct.idItem,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:f,dataVencimento:v,dataMovimento:v,documentoTipo:e.tipo,documentoId:e.id,idDocumentoCaixa:p.id}),Da.push({id:Object(y["uuid"])(),idFinanceiroMovimentacaoN:Xa,idEmpresa:e.idEmpresa,idFinanceiroPlanoConta:mt.id,dataEmissao:ct.dataHoraFinalizado||v,valorCredito:0,valorDebito:qt,descricao:mt.descricao,observacao:"Movimentações de CMV referente fatura (".concat(e.id,") e item (").concat(ct.idItem,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:f,dataVencimento:v,dataMovimento:v,documentoTipo:e.tipo,documentoId:e.id,idDocumentoCaixa:p.id})):(Da.push({id:Object(y["uuid"])(),idFinanceiroMovimentacaoN:Xa,idEmpresa:e.idEmpresa,idFinanceiroPlanoConta:ut.id,dataEmissao:ct.dataHoraFinalizado||v,valorCredito:0,valorDebito:qt,descricao:ut.descricao,observacao:"Movimentações de CMV referente fatura (".concat(e.id,") e item (").concat(ct.idItem,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:f,dataVencimento:v,dataMovimento:v,documentoTipo:e.tipo,documentoId:e.id,idDocumentoCaixa:p.id}),Da.push({id:Object(y["uuid"])(),idFinanceiroMovimentacaoN:Xa,idEmpresa:e.idEmpresa,idFinanceiroPlanoConta:mt.id,dataEmissao:ct.dataHoraFinalizado||v,valorCredito:qt,valorDebito:0,descricao:mt.descricao,observacao:"Movimentações de CMV referente fatura (".concat(e.id,") e item (").concat(ct.idItem,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:f,dataVencimento:v,dataMovimento:v,documentoTipo:e.tipo,documentoId:e.id,idDocumentoCaixa:p.id})),vt=ct.idPlanoContaDestino,vt){a.next=397;break}return a.next=395,w["a"].perfilContabilItem.le({idPerfilContabil:pt.idPerfilContabil,idCfop:ct.idCfop,and:{idPerfilContabil:pt.idPerfilContabil,idCfop:ct.idCfop}});case 395:_t=a.sent,_t.length&&_t[0].idPlanoContaDespesa&&(vt=_t[0].idPlanoContaDespesa);case 397:if(!vt&&xa.id&&(vt=xa.id),vt||!ct.idCfop){a.next=403;break}return a.next=401,w["a"].cfop.le({id:ct.idCfop});case 401:Ft=a.sent,vt=Ft.idPlanoContaDestino;case 403:return a.next=405,w["a"].financeiroPlanoConta.le({id:vt});case 405:if(ft=a.sent,ft.id){a.next=409;break}return o.$q.notify("Não foi possível localizar Conta de Receita."),a.abrupt("return",{v:void 0});case 409:kt=!0,Dt=0;case 411:if(!(Dt<et.length)){a.next=420;break}if(yt=et[Dt],yt.idPlanoContaDestino!==ft.id||yt.idPlanoContaEstoque!==ut.id){a.next=417;break}return yt.valor=Object(y["arredondar"])(yt.valor+gt),kt=!1,a.abrupt("break",420);case 417:Dt++,a.next=411;break;case 420:kt&&et.push({idPlanoContaDestino:ft.id,idPlanoContaEstoque:ut.id,valor:gt}),at+=gt;case 422:ot=!0,a.next=340;break;case 425:a.next=431;break;case 427:a.prev=427,a.t29=a["catch"](338),it=!0,rt=a.t29;case 431:a.prev=431,a.prev=432,ot||null==nt.return||nt.return();case 434:if(a.prev=434,!it){a.next=437;break}throw rt;case 437:return a.finish(434);case 438:return a.finish(431);case 439:for(wt=0;wt<et.length;wt++)Pt=et[wt],Pt.valor<0&&(tt+=Pt.valor);Ot=0;case 441:if(!(Ot<et.length)){a.next=494;break}if(jt=et[Ot],!(jt.valor>0)){a.next=491;break}return a.next=446,w["a"].financeiroPlanoConta.le({id:jt.idPlanoContaDestino});case 446:if(Et=a.sent,St=Object(y["arredondar"])(tt*(jt.valor/(at||1))),!(St>0)){a.next=472;break}for(Da.push({id:Object(y["uuid"])(),idFinanceiroMovimentacaoN:Xa,idEmpresa:e.idEmpresa,idFinanceiroPlanoConta:ma.id,dataEmissao:v,valorCredito:0,valorDebito:St,descricao:ma.descricao,observacao:"Lançamento entrada faturamento geral da devolução referente fatura (".concat(e.id,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:f,dataVencimento:v,dataMovimento:v,documentoTipo:"Fatura",documentoId:e.id,idDocumentoCaixa:p.id}),Da.push({id:Object(y["uuid"])(),idFinanceiroMovimentacaoN:Xa,idEmpresa:e.idEmpresa,idFinanceiroPlanoConta:Et.id,dataEmissao:v,valorCredito:St,valorDebito:0,descricao:Et.descricao,observacao:"Lançamento saída na conta de destino referente fatura (".concat(e.id,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:f,dataVencimento:v,dataMovimento:v,documentoTipo:"Fatura",documentoId:e.id,idDocumentoCaixa:p.id}),Mt=!0,Tt=!1,zt=void 0,a.prev=454,At=n[Symbol.iterator]();!(Mt=($t=At.next()).done);Mt=!0)Rt=$t.value,Da.push({id:Object(y["uuid"])(),idFinanceiroMovimentacaoN:Xa,idEmpresa:e.idEmpresa,idFinanceiroPlanoConta:ma.id,dataEmissao:v,valorCredito:0,valorDebito:Object(y["arredondar"])((jt.valor-St)*(Rt.valor/(Fa||1))),descricao:ma.descricao,observacao:"Lançamento saída na conta de faturamento geral referente fatura (".concat(e.id,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:f,dataVencimento:Rt.dataVencimento,dataMovimento:Rt.dataVencimento,documentoTipo:"Fatura",documentoId:e.id,idDocumentoCaixa:p.id}),Da.push({id:Object(y["uuid"])(),idFinanceiroMovimentacaoN:Xa,idEmpresa:e.idEmpresa,idFinanceiroPlanoConta:Et.id,dataEmissao:v,valorCredito:Object(y["arredondar"])((jt.valor-St)*(Rt.valor/(Fa||1))),valorDebito:0,descricao:Et.descricao,observacao:"Lançamento entrada na conta de venda do produto referente fatura (".concat(e.id,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:f,dataVencimento:Rt.dataVencimento,dataMovimento:Rt.dataVencimento,documentoTipo:"Fatura",documentoId:e.id,idDocumentoCaixa:p.id});a.next=462;break;case 458:a.prev=458,a.t30=a["catch"](454),Tt=!0,zt=a.t30;case 462:a.prev=462,a.prev=463,Mt||null==At.return||At.return();case 465:if(a.prev=465,!Tt){a.next=468;break}throw zt;case 468:return a.finish(465);case 469:return a.finish(462);case 470:a.next=491;break;case 472:for(It=!0,Vt=!1,Nt=void 0,a.prev=475,Ht=n[Symbol.iterator]();!(It=(Bt=Ht.next()).done);It=!0)Lt=Bt.value,Ut=Object(y["arredondar"])(jt.valor*(Lt.valor/(Fa||1))),Da.push({id:Object(y["uuid"])(),idFinanceiroMovimentacaoN:Xa,idEmpresa:e.idEmpresa,idFinanceiroPlanoConta:ma.id,dataEmissao:v,valorCredito:0,valorDebito:Ut,descricao:ma.descricao,observacao:"Lançamento saída na conta de faturamento geral referente fatura (".concat(e.id,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:f,dataVencimento:Lt.dataVencimento,dataMovimento:Lt.dataVencimento,documentoTipo:"Fatura",documentoId:e.id,idDocumentoCaixa:p.id}),Da.push({id:Object(y["uuid"])(),idFinanceiroMovimentacaoN:Xa,idEmpresa:e.idEmpresa,idFinanceiroPlanoConta:Et.id,dataEmissao:v,valorCredito:Ut,valorDebito:0,descricao:Et.descricao,observacao:"Lançamento entrada na conta de venda do produto referente fatura (".concat(e.id,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:f,dataVencimento:Lt.dataVencimento,dataMovimento:Lt.dataVencimento,documentoTipo:"Fatura",documentoId:e.id,idDocumentoCaixa:p.id});a.next=483;break;case 479:a.prev=479,a.t31=a["catch"](475),Vt=!0,Nt=a.t31;case 483:a.prev=483,a.prev=484,It||null==Ht.return||Ht.return();case 486:if(a.prev=486,!Vt){a.next=489;break}throw Nt;case 489:return a.finish(486);case 490:return a.finish(483);case 491:Ot++,a.next=441;break;case 494:if(o.financeiroTitulo=ka,o.financeiroMovimentacao=Da,o.financeiroRenegociacao=ya,o.fatura=e,o.vendas=i,o.carnes=r,t){a.next=507;break}return a.next=503,o.salvarFatura();case 503:if(!o.vendas.length){a.next=506;break}return a.next=506,o.$refs.documentosFiscais.emitirCupom(o.fatura.id);case 506:o.$q.notifyPositive("Fatura finalizada");case 507:return a.abrupt("return",{v:!0});case 508:case"end":return a.stop()}},a,null,[[2,7],[57,127,131,139],[69,95],[77,81,85,93],[86,,88,92],[105,109,113,121],[114,,116,120],[132,,134,138],[145,149,153,161],[154,,156,160],[252,262,266,274],[267,,269,273],[292,313,317,325],[318,,320,324],[338,427,431,439],[432,,434,438],[454,458,462,470],[463,,465,469],[475,479,483,491],[484,,486,490]])})(),"t0",2);case 2:if(e=a.t0,"object"!==u()(e)){a.next=5;break}return a.abrupt("return",e.v);case 5:a.next=10;break;case 7:a.prev=7,a.t1=a["catch"](0),this.$q.notifyError("Não foi possível finalizar a fatura",a.t1);case 10:return a.prev=10,this.$q.loading.hide(),a.finish(10);case 13:case"end":return a.stop()}},a,this,[[0,7,10,13]])}));return function(t){return a.apply(this,arguments)}}(),reabrir:function(){var a=n()(regeneratorRuntime.mark(function a(t){var e,o,i,r,n,s,c,d,l,v,p,b,x=this;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:if(t){a.next=13;break}return a.next=3,w["a"].documentoSat.le({idDocumento:this.fatura.id});case 3:return e=a.sent,o=e.filter(function(a){return a.cancelamento}).map(function(a){return a.chaveCupomCancelado}),i=e.filter(function(a){return!o.includes(a.chaveCupom)}),r=i.filter(function(a){return!a.cancelamento}),a.next=9,w["a"].documentoFiscalEletronico.le({idDocumento:this.fatura.id,situacao:"Emitido"});case 9:if(n=a.sent,!r.length&&!n.length){a.next=13;break}return this.$q.notify("Documento fiscal emitido. Operação não permitida."),a.abrupt("return");case 13:if(t){a.next=22;break}return a.prev=14,a.next=17,this.$q.dialog({cancel:"Cancelar",message:"Esta ação irá reabrir esta fatura",noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 17:a.next=22;break;case 19:return a.prev=19,a.t0=a["catch"](14),a.abrupt("return",!1);case 22:return a.prev=22,a.delegateYield(regeneratorRuntime.mark(function a(){var e,o,i,r,n,u,b,C,g,q,_,F,k,D,O,j,E,S,M,T,z,A,$,R,I,V,N,H,B,L,U,J,Y,W,Q,G,K,X,Z,aa,ta,ea,oa,ia,ra,na,sa,ca,da,ua,la,ma,va,fa,pa,ha,ba,xa,Ca,ga,qa,_a,Fa,ka,Da,ya,wa,Pa,Oa,ja,Ea,Sa,Ma,Ta,za,Aa,$a,Ra,Ia,Va,Na,Ha,Ba,La,Ua,Ja,Ya,Wa,Qa,Ga,Ka,Xa,Za,at,tt,et,ot,it,rt,nt,st,ct,dt,ut,lt,mt,vt,ft,pt,ht,bt,xt,Ct,gt,qt,_t,Ft,kt,Dt,yt,wt,Pt,Ot,jt,Et,St,Mt,Tt,zt,At,$t,Rt,It,Vt,Nt,Ht,Bt,Lt,Ut,Jt,Yt,Wt,Qt,Gt,Kt,Xt,Zt,ae,te,ee,oe,ie,re;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:if(x.$q.loading.show({message:"Processando..."}),e=Object(y["clonar"])(x.fatura),o=Object(y["clonar"])(x.vendas),i=Object(y["clonar"])(x.envelopes),r=Object(y["clonar"])(x.documentoItens),n=x.$refs.faturamento.condicaoPagamento.filter(function(a){return a.valor}),t){a.next=44;break}u=[],n.reduce(function(a,t){return t.idDocumentoCaixa&&!a[t.idDocumentoCaixa]&&(a[t.idDocumentoCaixa]=!0,u.push(w["a"].documento.le({id:t.idDocumentoCaixa}))),a},{}),s=!0,c=!1,a.prev=11,l=h()(u);case 13:return a.next=15,l.next();case 15:return v=a.sent,s=v.done,a.next=19,v.value;case 19:if(p=a.sent,s){a.next=28;break}if(b=p,"Aberto"===b.status){a.next=25;break}return x.$q.notify({message:"Não é possível reabrir fatura de caixas fechados!"}),a.abrupt("return",{v:!1});case 25:s=!0,a.next=13;break;case 28:a.next=34;break;case 30:a.prev=30,a.t0=a["catch"](11),c=!0,d=a.t0;case 34:if(a.prev=34,a.prev=35,s||null==l.return){a.next=39;break}return a.next=39,l.return();case 39:if(a.prev=39,!c){a.next=42;break}throw d;case 42:return a.finish(39);case 43:return a.finish(34);case 44:return a.next=46,w["a"].permissao.objeto("Diretiva_Vendas_Reabertura_EstornaTitulosLiquidados");case 46:if(a.sent){a.next=77;break}C=!0,g=!1,q=void 0,a.prev=50,_=x.$refs.faturamento.condicaoPagamentoOriginal.filter(function(a){return a.valor})[Symbol.iterator]();case 52:if(C=(F=_.next()).done){a.next=63;break}return k=F.value,a.next=56,w["a"].financeiroTitulo.le({id:k.idFinanceiroTitulo});case 56:if(D=a.sent,!D.dataPagamento){a.next=60;break}return x.$q.notify({message:"Não é possível excluir o financeiro. Parcelas da fatura já foram pagas!"}),a.abrupt("return",{v:!1});case 60:C=!0,a.next=52;break;case 63:a.next=69;break;case 65:a.prev=65,a.t1=a["catch"](50),g=!0,q=a.t1;case 69:a.prev=69,a.prev=70,C||null==_.return||_.return();case 72:if(a.prev=72,!g){a.next=75;break}throw q;case 75:return a.finish(72);case 76:return a.finish(69);case 77:if(O=[],j=[],E=[],t){a.next=464;break}return a.next=81,w["a"].financeiroTitulo.le({documentoId:e.id});case 81:O=a.sent,S=!0,M=!1,T=void 0,a.prev=85,z=O[Symbol.iterator]();case 87:if(S=(A=z.next()).done){a.next=187;break}if($=A.value,!$.idFinanceiroBoleto){a.next=184;break}return a.next=92,Object(P["a"])().financeiroBoleto.get($.idFinanceiroBoleto);case 92:return R=a.sent,a.next=95,w["a"].financeiroBanco.le({id:R.idFinanceiroBanco});case 95:return I=a.sent,a.next=98,w["a"].banco.le({id:I.idBanco});case 98:if(V=a.sent,N=R.revisao,H=V.baixa,B=V.registro,R.remessaOperacao===H){a.next=184;break}return L=$.idFinanceiroBoleto,U=Object(y["uuid"])(),J={id:U,idFinanceiroBanco:R.idFinanceiroBanco,nossoNumero:R.nossoNumero,nossoNumeroDv:R.nossoNumeroDv,revisao:N+1,idEmpresa:R.idEmpresa,idContato:R.idContato,empresaNome:R.empresaNome,empresaNumeroDocumento:R.empresaNumeroDocumento,contatoNome:R.contatoNome,contatoNumeroDocumento:R.contatoNumeroDocumento,contatoLogradouro:R.contatoLogradouro,contatoCEP:R.contatoCEP,contatoBairro:R.contatoBairro,contatoCidade:R.contatoCidade,contatoUF:R.contatoUF,dataEmissao:Object(y["dataAtual"])(),dataVencimento:R.dataVencimento,dataImpressao:R.dataImpressao,valor:R.valor,valorJuros:R.valorJuros,tipoJuros:R.tipoJuros,valorMulta:R.valorMulta,valorDesconto:R.valorDesconto,valorTotal:R.valorTotal,codigoBarras:R.codigoBarras,linhaDigitavel:R.linhaDigitavel,mensagem1:R.mensagem1,mensagem2:R.mensagem2,mensagem3:R.mensagem3,mensagem4:R.mensagem4,mensagem5:R.mensagem5,gerarRemessa:1,remessaOperacao:H},a.next=108,w["a"].financeiroBoleto.grava({atual:J});case 108:if(Y=[],!L){a.next=113;break}return a.next=112,w["a"].financeiroTitulo.le({idFinanceiroBoleto:L});case 112:Y=a.sent;case 113:W=!0,Q=!1,G=void 0,a.prev=116,K=Y[Symbol.iterator]();case 118:if(W=(X=K.next()).done){a.next=159;break}if(Z=X.value,aa=Object(y["clonar"])(Z),Z.idFinanceiroBoleto=U,ta=[],!L){a.next=127;break}return a.next=126,w["a"].financeiroBoletoTitulo.le({idFinanceiroBoleto:L});case 126:ta=a.sent;case 127:ea=!0,oa=!1,ia=void 0,a.prev=130,ra=ta[Symbol.iterator]();case 132:if(ea=(na=ra.next()).done){a.next=140;break}return sa=na.value,ca={id:Object(y["uuid"])(),idFinanceiroBoleto:U,idFinanceiroTitulo:sa.idFinanceiroTitulo},a.next=137,w["a"].financeiroBoletoTitulo.grava({atual:ca});case 137:ea=!0,a.next=132;break;case 140:a.next=146;break;case 142:a.prev=142,a.t2=a["catch"](130),oa=!0,ia=a.t2;case 146:a.prev=146,a.prev=147,ea||null==ra.return||ra.return();case 149:if(a.prev=149,!oa){a.next=152;break}throw ia;case 152:return a.finish(149);case 153:return a.finish(146);case 154:return a.next=156,w["a"].financeiroTitulo.grava({atual:Z,original:aa});case 156:W=!0,a.next=118;break;case 159:a.next=165;break;case 161:a.prev=161,a.t3=a["catch"](116),Q=!0,G=a.t3;case 165:a.prev=165,a.prev=166,W||null==K.return||K.return();case 168:if(a.prev=168,!Q){a.next=171;break}throw G;case 171:return a.finish(168);case 172:return a.finish(165);case 173:if(R.remessaOperacao!==B||1!==R.gerarRemessa){a.next=184;break}da=[R,J],ua=0;case 176:if(!(ua<da.length)){a.next=184;break}return la=da[ua],ma=m()({},la,{gerarRemessa:0}),a.next=181,w["a"].financeiroBoleto.grava({original:la,atual:ma});case 181:ua++,a.next=176;break;case 184:S=!0,a.next=87;break;case 187:a.next=193;break;case 189:a.prev=189,a.t4=a["catch"](85),M=!0,T=a.t4;case 193:a.prev=193,a.prev=194,S||null==z.return||z.return();case 196:if(a.prev=196,!M){a.next=199;break}throw T;case 199:return a.finish(196);case 200:return a.finish(193);case 201:if(va=[],!x.$refs.faturamento.idDocumentoCaixa){a.next=206;break}return a.next=205,w["a"].financeiroMovimentacao.le({idDocumentoCaixa:x.$refs.faturamento.idDocumentoCaixa});case 205:va=a.sent;case 206:return a.next=208,w["a"].financeiroTitulo.le({idFatura:e.id});case 208:return O=a.sent,a.next=211,w["a"].financeiroTitulo.le({idFatura:e.id});case 211:fa=a.sent,pa=!0,ha=!1,ba=void 0,a.prev=215,xa=Object(y["clonar"])(O)[Symbol.iterator]();case 217:if(pa=(Ca=xa.next()).done){a.next=255;break}if(ga=Ca.value,ga.idFinanceiroMovimentacaoAgrupamento){a.next=221;break}return a.abrupt("continue",252);case 221:return a.next=223,w["a"].financeiroRenegociacao.le({idFinanceiroMovimentacaoN:ga.idFinanceiroMovimentacaoAgrupamento});case 223:qa=a.sent,_a=!0,Fa=!1,ka=void 0,a.prev=227,Da=qa[Symbol.iterator]();case 229:if(_a=(ya=Da.next()).done){a.next=238;break}return wa=ya.value,a.next=233,w["a"].financeiroTitulo.le({id:wa.idFinanceiroTitulo});case 233:Pa=a.sent,Pa.idDocumentoCaixa===x.$refs.faturamento.idDocumentoCaixa&&(O=O.concat(Pa));case 235:_a=!0,a.next=229;break;case 238:a.next=244;break;case 240:a.prev=240,a.t5=a["catch"](227),Fa=!0,ka=a.t5;case 244:a.prev=244,a.prev=245,_a||null==Da.return||Da.return();case 247:if(a.prev=247,!Fa){a.next=250;break}throw ka;case 250:return a.finish(247);case 251:return a.finish(244);case 252:pa=!0,a.next=217;break;case 255:a.next=261;break;case 257:a.prev=257,a.t6=a["catch"](215),ha=!0,ba=a.t6;case 261:a.prev=261,a.prev=262,pa||null==xa.return||xa.return();case 264:if(a.prev=264,!ha){a.next=267;break}throw ba;case 267:return a.finish(264);case 268:return a.finish(261);case 269:Oa=!1,ja=!0,Ea=!1,Sa=void 0,a.prev=273,Ma=regeneratorRuntime.mark(function a(){var t,e,o;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return t=za.value,a.next=3,w["a"].financeiroTitulo.le({id:t.idFinanceiroTitulo});case 3:e=a.sent,Object.keys(e).length&&(o=[],o=va.filter(function(a){return a.idFinanceiroMovimentacaoN===e.idFinanceiroMovimentacaoAgrupamento}),j=j.concat(o),o=va.filter(function(a){return a.idFinanceiroTitulo===e.id}),j=j.concat(o),o=va.filter(function(a){return a.idFinanceiroCheque===e.id}),j=j.concat(o),O=O.concat(e)),t.idFinanceiroTitulo="",1===t.sinal&&(Oa=!0);case 7:case"end":return a.stop()}},a)}),Ta=n[Symbol.iterator]();case 276:if(ja=(za=Ta.next()).done){a.next=281;break}return a.delegateYield(Ma(),"t7",278);case 278:ja=!0,a.next=276;break;case 281:a.next=287;break;case 283:a.prev=283,a.t8=a["catch"](273),Ea=!0,Sa=a.t8;case 287:a.prev=287,a.prev=288,ja||null==Ta.return||Ta.return();case 290:if(a.prev=290,!Ea){a.next=293;break}throw Sa;case 293:return a.finish(290);case 294:return a.finish(287);case 295:return a.next=297,w["a"].financeiroTitulo.le({idFatura:e.id,idDocumentoCaixa:x.$refs.faturamento.idDocumentoCaixa});case 297:fa=a.sent,Aa=!0,$a=!1,Ra=void 0,a.prev=301,Ia=fa[Symbol.iterator]();case 303:if(Aa=(Va=Ia.next()).done){a.next=318;break}if(Na=Va.value,Na.idFinanceiroMovimentacaoAgrupamento){a.next=307;break}return a.abrupt("continue",315);case 307:return a.next=309,w["a"].financeiroMovimentacao.le({idFinanceiroMovimentacaoN:Na.idFinanceiroMovimentacaoAgrupamento});case 309:return Ha=a.sent,j=j.concat(Ha),a.next=313,w["a"].financeiroRenegociacao.le({idFinanceiroMovimentacaoN:Na.idFinanceiroMovimentacaoAgrupamento});case 313:Ba=a.sent,E=E.concat(Ba);case 315:Aa=!0,a.next=303;break;case 318:a.next=324;break;case 320:a.prev=320,a.t9=a["catch"](301),$a=!0,Ra=a.t9;case 324:a.prev=324,a.prev=325,Aa||null==Ia.return||Ia.return();case 327:if(a.prev=327,!$a){a.next=330;break}throw Ra;case 330:return a.finish(327);case 331:return a.finish(324);case 332:return a.next=334,w["a"].financeiroTitulo.le({idDocumentoCaixa:x.$refs.faturamento.idDocumentoCaixa,documentoId:e.id});case 334:if(fa=a.sent,O=O.concat(fa),!e.id){a.next=376;break}return a.next=339,w["a"].financeiroMovimentacao.leNew({documentoTipo:"Devolução",documentoId:e.id});case 339:return La=a.sent,j=j.concat(La),a.next=343,w["a"].financeiroMovimentacao.leNew({idDocumentoCaixa:x.$refs.faturamento.idDocumentoCaixa,documentoId:e.id});case 343:return La=a.sent,j=j.concat(La),a.next=347,w["a"].financeiroMovimentacao.leNew({documentoId:e.id});case 347:La=a.sent,Ua=!0,Ja=!1,Ya=void 0,a.prev=351,Wa=La[Symbol.iterator]();case 353:if(Ua=(Qa=Wa.next()).done){a.next=362;break}return Ga=Qa.value,a.next=357,w["a"].financeiroTitulo.le({id:Ga.idFinanceiroTitulo});case 357:Ka=a.sent,Ka.id||(j=j.concat(Ga));case 359:Ua=!0,a.next=353;break;case 362:a.next=368;break;case 364:a.prev=364,a.t10=a["catch"](351),Ja=!0,Ya=a.t10;case 368:a.prev=368,a.prev=369,Ua||null==Wa.return||Wa.return();case 371:if(a.prev=371,!Ja){a.next=374;break}throw Ya;case 374:return a.finish(371);case 375:return a.finish(368);case 376:return a.next=378,w["a"].documento.le({idFatura:e.id});case 378:Xa=a.sent,Za=!0,at=!1,tt=void 0,a.prev=382,et=Xa[Symbol.iterator]();case 384:if(Za=(ot=et.next()).done){a.next=393;break}return it=ot.value,a.next=388,w["a"].financeiroMovimentacao.le({idDocumentoCaixa:x.$refs.faturamento.idDocumentoCaixa,documentoId:it.id});case 388:rt=a.sent,j=j.concat(rt);case 390:Za=!0,a.next=384;break;case 393:a.next=399;break;case 395:a.prev=395,a.t11=a["catch"](382),at=!0,tt=a.t11;case 399:a.prev=399,a.prev=400,Za||null==et.return||et.return();case 402:if(a.prev=402,!at){a.next=405;break}throw tt;case 405:return a.finish(402);case 406:return a.finish(399);case 407:for(st in nt=[],O)ct=O[st].id,nt.includes(ct)?delete O[st]:nt.push(ct);for(dt in O=O.filter(function(a){return a}),nt=[],j)ut=j[dt].id,nt.includes(ut)?delete j[dt]:nt.push(ut);for(lt in j=j.filter(function(a){return a}),nt=[],E)mt=E[lt].id,nt.includes(mt)?delete E[lt]:nt.push(mt);for(E=E.filter(function(a){return a}),vt=Object(y["dataAtual"])(),ft=Oa?"Aguardando Pagamento":"Aberta",x.documentoStatus=[{id:Object(y["uuid"])(),idDocumento:e.id,operacao:"Fatura",statusOriginal:e.status,statusFinalizado:ft,dataHoraEmissao:vt,idUsuarioAlterou:w["a"].usuario.logado.id,idDocumentoCaixa:x.$refs.faturamento.idDocumentoCaixa}],e.status=ft,"Aberta"===ft&&(e.dataHoraFinalizado=""),ft=Oa?"Aguardando Pagamento":"Aguardando Faturamento",pt=!0,ht=!1,bt=void 0,a.prev=425,xt=o[Symbol.iterator]();!(pt=(Ct=xt.next()).done);pt=!0)gt=Ct.value,x.documentoStatus.push({id:Object(y["uuid"])(),idDocumento:gt.id,operacao:"Venda de Mercadoria",statusOriginal:gt.status,statusFinalizado:ft,dataHoraEmissao:vt,idUsuarioAlterou:w["a"].usuario.logado.id,idDocumentoCaixa:x.$refs.faturamento.idDocumentoCaixa}),gt.status=ft;a.next=433;break;case 429:a.prev=429,a.t12=a["catch"](425),ht=!0,bt=a.t12;case 433:a.prev=433,a.prev=434,pt||null==xt.return||xt.return();case 436:if(a.prev=436,!ht){a.next=439;break}throw bt;case 439:return a.finish(436);case 440:return a.finish(433);case 441:for(qt=!0,_t=!1,Ft=void 0,a.prev=444,kt=r[Symbol.iterator]();!(qt=(Dt=kt.next()).done);qt=!0)yt=Dt.value,yt.status=ft;a.next=452;break;case 448:a.prev=448,a.t13=a["catch"](444),_t=!0,Ft=a.t13;case 452:a.prev=452,a.prev=453,qt||null==kt.return||kt.return();case 455:if(a.prev=455,!_t){a.next=458;break}throw Ft;case 458:return a.finish(455);case 459:return a.finish(452);case 460:x.fatura=e,x.vendas=o,x.envelopes=i,x.documentoItens=r;case 464:if(x.$q.loading.hide(),!t){a.next=468;break}return a.next=468,x.finalizar(t);case 468:if(x.$q.loading.show({message:"Processando..."}),!t){a.next=575;break}wt=[],Pt=[],Ot=[],jt=[],Et=[],St=[],wt=x.$refs.faturamento.condicaoPagamento.map(function(a){return a.id}),Pt=x.$refs.faturamento.condicaoPagamentoOriginal.filter(function(a){return!wt.includes(a.id)}),Mt=!0,Tt=!1,zt=void 0,a.prev=476,At=Pt[Symbol.iterator]();case 478:if(Mt=($t=At.next()).done){a.next=490;break}if(Rt=$t.value,Rt.idFinanceiroTitulo&&Ot.push(Rt.idFinanceiroTitulo),!Rt.idFormaPagamento){a.next=487;break}return It=void 0,a.next=485,Object(P["a"])().formaPagamento.get(Rt.idFormaPagamento);case 485:It=a.sent,(It||{}).aliquota&&(Rt.idFinanceiroTituloPagar?Ot.push(Rt.idFinanceiroTituloPagar):x.$q.notify("Não foi possível excluir as movimentações referentes à aliquota. Exclua-as manualmente."));case 487:Mt=!0,a.next=478;break;case 490:a.next=496;break;case 492:a.prev=492,a.t14=a["catch"](476),Tt=!0,zt=a.t14;case 496:a.prev=496,a.prev=497,Mt||null==At.return||At.return();case 499:if(a.prev=499,!Tt){a.next=502;break}throw zt;case 502:return a.finish(499);case 503:return a.finish(496);case 504:Vt=0;case 505:if(!(Vt<Ot.length)){a.next=527;break}return Nt=Ot[Vt],Ht=void 0,a.next=510,Object(P["a"])().financeiroTitulo.get(Nt);case 510:if(Ht=a.sent,Ht.id&&jt.push(Ht),!Ht.idFinanceiroMovimentacaoAgrupamento){a.next=524;break}return Bt=void 0,Lt=void 0,a.next=516,Object(P["a"])().financeiroMovimentacao.where({idFinanceiroMovimentacaoN:Ht.idFinanceiroMovimentacaoAgrupamento}).toArray();case 516:if(Bt=a.sent,Lt=(Bt.find(function(a){return a.idFinanceiroCheque})||{}).idFinanceiroCheque,!Lt){a.next=523;break}return a.next=521,Object(P["a"])().financeiroTitulo.get(Lt);case 521:Ut=a.sent,Ut.id&&jt.push(Ut);case 523:Et.push.apply(Et,f()(Bt));case 524:Vt++,a.next=505;break;case 527:Jt=!0,Yt=!1,Wt=void 0,a.prev=530,Qt=x.carnes[Symbol.iterator]();case 532:if(Jt=(Gt=Qt.next()).done){a.next=553;break}if(Kt=Gt.value,Kt.id){a.next=536;break}return a.abrupt("continue",550);case 536:return a.next=538,Object(P["a"])().financeiroTitulo.get(Kt.id);case 538:if(Kt=a.sent,(Kt||{}).idFinanceiroMovimentacaoAgrupamento){a.next=541;break}return a.abrupt("continue",550);case 541:return Xt=void 0,Zt=void 0,a.next=544,Object(P["a"])().financeiroMovimentacao.where({idFinanceiroMovimentacaoN:Kt.idFinanceiroMovimentacaoAgrupamento}).toArray();case 544:return Xt=a.sent,a.next=547,Object(P["a"])().financeiroRenegociacao.where({idFinanceiroMovimentacaoN:Kt.idFinanceiroMovimentacaoAgrupamento}).toArray();case 547:Zt=a.sent,Et.push.apply(Et,f()(Xt)),St.push.apply(St,f()(Zt));case 550:Jt=!0,a.next=532;break;case 553:a.next=559;break;case 555:a.prev=555,a.t15=a["catch"](530),Yt=!0,Wt=a.t15;case 559:a.prev=559,a.prev=560,Jt||null==Qt.return||Qt.return();case 562:if(a.prev=562,!Yt){a.next=565;break}throw Wt;case 565:return a.finish(562);case 566:return a.finish(559);case 567:return a.next=569,w["a"].financeiroTitulo.remove(jt);case 569:return a.next=571,w["a"].financeiroMovimentacao.remove(Et);case 571:return a.next=573,w["a"].financeiroRenegociacao.remove(St);case 573:a.next=607;break;case 575:return a.next=577,w["a"].financeiroTitulo.remove(O.filter(function(a){return!(a.carne&&a.idFatura===e.id)}));case 577:return a.next=579,w["a"].financeiroMovimentacao.remove(j);case 579:return a.next=581,w["a"].financeiroRenegociacao.remove(E);case 581:ae=!0,te=!1,ee=void 0,a.prev=584,oe=O.filter(function(a){return a.carne&&a.idFatura===e.id})[Symbol.iterator]();case 586:if(ae=(ie=oe.next()).done){a.next=593;break}return re=ie.value,a.next=590,w["a"].financeiroTitulo.grava({original:re,atual:{valorRealizado:0,receberPagar:1,dataPagamento:""}});case 590:ae=!0,a.next=586;break;case 593:a.next=599;break;case 595:a.prev=595,a.t16=a["catch"](584),te=!0,ee=a.t16;case 599:a.prev=599,a.prev=600,ae||null==oe.return||oe.return();case 602:if(a.prev=602,!te){a.next=605;break}throw ee;case 605:return a.finish(602);case 606:return a.finish(599);case 607:return a.next=609,x.salvarFatura();case 609:return t?x.$q.notifyPositive("Fatura corrigida."):x.$q.notifyPositive("Fatura reaberta."),a.abrupt("return",{v:!0});case 611:case"end":return a.stop()}},a,null,[[11,30,34,44],[35,,39,43],[50,65,69,77],[70,,72,76],[85,189,193,201],[116,161,165,173],[130,142,146,154],[147,,149,153],[166,,168,172],[194,,196,200],[215,257,261,269],[227,240,244,252],[245,,247,251],[262,,264,268],[273,283,287,295],[288,,290,294],[301,320,324,332],[325,,327,331],[351,364,368,376],[369,,371,375],[382,395,399,407],[400,,402,406],[425,429,433,441],[434,,436,440],[444,448,452,460],[453,,455,459],[476,492,496,504],[497,,499,503],[530,555,559,567],[560,,562,566],[584,595,599,607],[600,,602,606]])})(),"t1",24);case 24:if(b=a.t1,"object"!==u()(b)){a.next=27;break}return a.abrupt("return",b.v);case 27:a.next=33;break;case 29:a.prev=29,a.t2=a["catch"](22),this.$q.notify("Não foi possível reabrir a fatura."),this.$q.loading.hide();case 33:return a.prev=33,this.$q.loading.hide(),a.finish(33);case 36:case"end":return a.stop()}},a,this,[[14,19],[22,29,33,36]])}));return function(t){return a.apply(this,arguments)}}(),corrigir:function(){var a=n()(regeneratorRuntime.mark(function a(){var t,e,o,i,r,n,s,c,d,u,l,m;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:if(t=this.$refs.faturamento.condicaoPagamentoOriginal,e=this.$refs.faturamento.condicaoPagamento,i=Object(y["arredondar"])(this.fatura.totalDocumento||0),o=Object(y["arredondar"])(e.reduce(function(a,t){return a+t.valor||0},0)),o===i){a.next=7;break}return this.$q.notify("Total das condições de pagamento difere do total da fatura"),a.abrupt("return");case 7:if(!t.length){a.next=40;break}r=!1,e.length||(r=!0),n=!0,s=!1,c=void 0,a.prev=13,d=function(){var a=l.value;if(!t.find(function(t){return t.id===a.id}))return r=!0,"break"},u=e[Symbol.iterator]();case 16:if(n=(l=u.next()).done){a.next=23;break}if(m=d(),"break"!==m){a.next=20;break}return a.abrupt("break",23);case 20:n=!0,a.next=16;break;case 23:a.next=29;break;case 25:a.prev=25,a.t0=a["catch"](13),s=!0,c=a.t0;case 29:a.prev=29,a.prev=30,n||null==u.return||u.return();case 32:if(a.prev=32,!s){a.next=35;break}throw c;case 35:return a.finish(32);case 36:return a.finish(29);case 37:if(r){a.next=40;break}return this.$q.notify("Não há correção a ser realizada"),a.abrupt("return");case 40:return a.prev=40,a.next=43,this.$q.dialog({cancel:"Cancelar",message:"Esta ação irá corrigir esta fatura.",noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 43:return a.next=45,this.reabrir(!0);case 45:return a.abrupt("return",!0);case 48:return a.prev=48,a.t1=a["catch"](40),a.abrupt("return",!1);case 51:case"end":return a.stop()}},a,this,[[13,25,29,37],[30,,32,36],[40,48]])}));return function(){return a.apply(this,arguments)}}(),salvarFatura:function(){var a=n()(regeneratorRuntime.mark(function a(){var t,e,o,i,r=this;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:for(e in a.prev=0,this.$q.loading.show({message:"Processando..."}),t=Object(y["clonar"])(this.$refs.faturamento.condicaoPagamento.filter(function(a){return a.valor})),t)delete t[e].idDocumentoCondicaoPagamento,delete t[e].parcelas,delete t[e].formaPagamento,delete t[e].edicao,delete t[e].codigoDocumento,delete t[e].codigoDocumentoCaixa;return this.fatura.observacaoFaturamento=this.$refs.faturamento.observacaoFaturamento,o=(this.carnesOriginal||[]).filter(function(a){return(r.financeiroTitulo||[]).find(function(t){return t.id===a.id})}),a.next=8,w["a"].fatura.grava({faturaOriginal:this.faturaOriginal,fatura:this.fatura,vendasOriginal:this.vendasOriginal,vendas:this.vendas,envelopesOriginal:this.envelopesOriginal,envelopes:this.envelopes,documentoItensOriginal:this.documentoItensOriginal,documentoItens:this.documentoItens,condicaoPagamentoOriginal:this.$refs.faturamento.condicaoPagamentoOriginal,condicaoPagamento:t,documentoStatus:this.documentoStatus,financeiroTitulo:this.financeiroTitulo,financeiroTituloOriginal:o,financeiroMovimentacao:this.financeiroMovimentacao,financeiroRenegociacao:this.financeiroRenegociacao});case 8:if(!this.receberTitulo.id){a.next=13;break}if(i=this.carnes.find(function(a){return a.id===r.receberTitulo.id}),!i.id){a.next=13;break}return a.next=13,w["a"].financeiroTitulo.grava({original:i,atual:{idFatura:this.fatura.id}});case 13:a.next=19;break;case 15:a.prev=15,a.t0=a["catch"](0),this.$q.notify("Não foi possível salvar a fatura."),this.$q.loading.hide();case 19:return a.prev=19,this.$q.loading.hide(),a.finish(19);case 22:case"end":return a.stop()}},a,this,[[0,15,19,22]])}));return function(){return a.apply(this,arguments)}}()},mixins:[_["a"]],props:{prop:{default:function(){return{}},required:!0,type:Object},receberTitulo:{default:function(){return{}},type:Object}},watch:{prop:function(){this.atualizar()}},mounted:function(){this.sistemaPai=Object(y["sistemaPai"])(),this.atualizar()}},E=j,S=(e("423ee"),e("2877")),M=Object(S["a"])(E,s,c,!1,null,null,null);M.options.__file="Fatura.vue";var T=M.exports,z={components:{Fatura:T},computed:{},data:function(){return{fatura:{},visibilidade:{modal:!1,botao:{finalizar:!1,reabrir:!1,corrigir:!1}},carregando:!0,temPermissaoCorrigir:!1,emitirAoFechar:""}},methods:{atualizar:function(){var a=n()(regeneratorRuntime.mark(function a(){var t;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:if(t={},!this.id){a.next=5;break}return a.next=4,w["a"].documento.le({id:this.id});case 4:t=a.sent;case 5:this.fatura=t,this.verificarPermissoes(),this.visibilidade.modal=!0;case 8:case"end":return a.stop()}},a,this)}));return function(){return a.apply(this,arguments)}}(),executar:function(){var a=n()(regeneratorRuntime.mark(function a(t){return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:a.t0=t,a.next="finalizar"===a.t0?3:"reabrir"===a.t0?8:"retornarOrcamento"===a.t0?15:"remover"===a.t0?15:19;break;case 3:return a.next=5,this.$refs.fatura.finalizar();case 5:if(a.sent){a.next=7;break}return a.abrupt("return");case 7:return a.abrupt("break",19);case 8:return a.next=10,this.$refs.fatura.reabrir();case 10:if(!a.sent){a.next=14;break}return a.next=13,this.atualizar();case 13:this.$emit("executar",t);case 14:return a.abrupt("return");case 15:return a.next=17,this.atualizar();case 17:return this.emitirAoFechar=t,a.abrupt("return");case 19:this.$emit("executar",t),this.fechar();case 21:case"end":return a.stop()}},a,this)}));return function(t){return a.apply(this,arguments)}}(),fechar:function(){this.fatura={},this.carregando=!0,this.visibilidade={modal:!1,botao:{finalizar:!1,reabrir:!1,corrigir:!1}},this.$emit("executar",this.emitirAoFechar)},mostrar:function(){var a=n()(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(y["dormir"])(500);case 2:this.carregando=!1;case 3:case"end":return a.stop()}},a,this)}));return function(){return a.apply(this,arguments)}}(),salvar:function(){var a=n()(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,this.$q.dialog({cancel:"Cancelar",message:"Esta ação irá salvar esta fatura.",noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 3:a.next=8;break;case 5:return a.prev=5,a.t0=a["catch"](0),a.abrupt("return");case 8:return a.next=10,this.$refs.fatura.salvarFatura();case 10:this.$emit("executar","atualizar"),this.fechar();case 12:case"end":return a.stop()}},a,this,[[0,5]])}));return function(){return a.apply(this,arguments)}}(),corrigir:function(){var a=n()(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,this.$refs.fatura.corrigir();case 2:if(!a.sent){a.next=5;break}this.$emit("executar","atualizar"),this.fechar();case 5:case"end":return a.stop()}},a,this)}));return function(){return a.apply(this,arguments)}}(),verificarPermissoes:function(){var a=this;w["a"].permissao.objeto("caixa/tesouraria").then(function(t){a.temPermissaoCorrigir=t}).catch(function(){a.temPermissaoCorrigir=!1})}},props:{id:{default:"",type:String},receberTitulo:{default:function(){return{}},type:Object},value:{default:!1,required:!0,type:Boolean}},watch:{fatura:function(a){this.visibilidade.botao.finalizar=!1,this.visibilidade.botao.reabrir=!1,this.visibilidade.botao.salvar=!1,"Aberta"===a.status&&(this.visibilidade.botao.salvar=!0),"Finalizada"!==a.status&&(this.visibilidade.botao.finalizar=!0),"Finalizada"===a.status&&(this.visibilidade.botao.reabrir=!0)},value:function(a){a&&this.atualizar()},"visibilidade.modal":function(a){this.$emit("input",a)}}},A=z,$=(e("6622"),Object(S["a"])(A,o,i,!1,null,"4ebae790",null));$.options.__file="FaturaModal.vue";t["a"]=$.exports},c980:function(a,t,e){"use strict";var o=e("e062"),i=e.n(o);i.a},d4aa:function(a,t,e){"use strict";var o=function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{class:a.tema},[e("div",{staticClass:"gutter-sm row"},[e("div",{staticClass:"col-12 col-lg-6"},[e("q-toolbar",{staticClass:"u-autoHeight q-mb-md q-pa-none",attrs:{color:"none",inverted:""}},[e("avatar",{attrs:{imagem:(a.contatos[a.titulo.idContato]||{}).imagem,rotulo:(a.contatos[a.titulo.idContato]||{}).apelido,tamanho:"30"}}),e("q-toolbar-title",[a._v("\n          "+a._s((a.contatos[a.titulo.idContato]||{}).nome)+"\n          "),e("div",{attrs:{slot:"subtitle"},slot:"subtitle"},[a._v(a._s((a.contatos[a.titulo.idContato]||{}).apelido))])])],1),e("q-chip",{staticClass:"TituloCard-selo",attrs:{color:"grey",rounded:"",small:""}},[a._v(a._s(a.titulo.parcela))]),e("div",{staticClass:"q-body-1 q-mt-sm"},[a._v("\n        "+a._s(a.titulo.descricao)+"\n      ")])],1),e("div",{staticClass:"col-12 col-sm-4 col-lg-2"},[e("dl",{staticClass:"q-ma-none"},[e("dt",[a._v(a._s(a.titulo.documentoTipo)+" #"+a._s(a.titulo.documentoCodigo))]),e("dd",[a._v(a._s(a.titulo.formaDePagamento))]),e("dt",{staticClass:"q-mt-md"},[a._v(a._s(a.titulo.descricaoPlanoConta))])])]),e("div",{staticClass:"col-2 col-lg-1"},[e("q-tooltip",[a._v("Vencimento original")]),e("span",{staticClass:"block text-center"},[e("small",[a._v(a._s(a._f("mesNome")(a.titulo.dataVencimentoOriginal)))])]),e("strong",{staticClass:"block q-title text-center"},[a._v(a._s(a._f("dia")(a.titulo.dataVencimentoOriginal)))]),e("span",{staticClass:"block text-center"},[e("small",[a._v(a._s(a._f("ano")(a.titulo.dataVencimentoOriginal)))])])],1),e("div",{staticClass:"col-2 col-lg-1"},[e("q-tooltip",[a._v("Vencimento")]),e("span",{staticClass:"block text-center"},[e("small",[a._v(a._s(a._f("mesNome")(a.titulo.dataVencimento)))])]),e("strong",{staticClass:"block q-title text-center"},[a._v(a._s(a._f("dia")(a.titulo.dataVencimento)))]),e("span",{staticClass:"block text-center"},[e("small",[a._v(a._s(a._f("ano")(a.titulo.dataVencimento)))])])],1),e("div",{staticClass:"col-6 col-lg-2"},[e("dl",{staticClass:"float-right full-width q-mb-sm"},[e("dt",{staticClass:"text-right q-headline text-positive text-weight-bold"},[a._v("\n          "+a._s(a._f("numero")(a.titulo.valorTotal,2))+"\n          "),e("p",{staticClass:"text-weight-normal text-tertiary q-body-1"},[a._v("\n            "+a._s(a._f("numero")(a.titulo.valor,2))+"\n          ")])])]),e("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{float:"right"},attrs:{rounded:"",dense:"",flat:"",icon:"keyboard_arrow_"+(a.detalhes?"up":"down"),size:"md",color:"grey"},on:{click:a.alternarDetalhes}}),a.visibilidade.botao.editar?e("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{float:"right"},attrs:{rounded:"",dense:"",flat:"",icon:"edit",size:"md",color:"grey"},on:{click:a.editar}}):a._e(),a.visibilidade.botao.remover?e("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{float:"right"},attrs:{rounded:"",dense:"",flat:"",icon:"clear",color:"grey",size:"md"},on:{click:a.remover}},[e("q-tooltip",[a._v("\n          Remover da Fatura #"+a._s(parseInt(a.fatura.numero)||(a.fatura.id||"").slice(-6))+"\n        ")])],1):a._e(),a.mostrarMenuTresPontos?e("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{float:"right"},attrs:{rounded:"",dense:"",flat:"",icon:"more_vert",color:"grey",size:"md"}},[e("q-popover",[e("q-list",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{link:"",separator:""}},[a.mostrarOpcaoMigrarFatura?[a._l(a.faturasAbertas,function(t){return e("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],key:t.id,nativeOn:{click:function(e){a.migrarFatura(t)}}},[e("q-item-side",{attrs:{icon:"mdi-folder-move"}}),e("q-item-main",{attrs:{label:"Migrar para fatura #"+(t.numero||t.id.slice(-6))}})],1)}),e("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],nativeOn:{click:function(t){a.migrarFatura()}}},[e("q-item-side",{attrs:{icon:"mdi-folder-move"}}),e("q-item-main",{attrs:{label:"Migrar para nova fatura"}})],1)]:a._e()],2)],1)],1):a._e(),a._t("default")],2)]),a.detalhes?e("div",{staticClass:"u-bordaCima gutter-sm q-mt-md q-pt-md row"},[e("div",{staticClass:"col-12 col-lg-6"},[e("q-toolbar",{staticClass:"u-autoHeight q-mb-md q-pa-none",attrs:{color:"none",inverted:""}},[e("q-icon",{attrs:{name:"business"}}),e("q-toolbar-title",[a._v(a._s((a.contatos[a.titulo.idEmpresa]||{}).apelido))])],1),e("div",{staticClass:"q-body-1"},[a._v("\n        "+a._s(a.titulo.observacao)+"\n      ")])],1),e("div",{staticClass:"col-12 col-sm-4 col-lg-2"},[e("dl",{staticClass:"q-ma-none"},[e("dt",[a._v(a._s(a.titulo.descricaoCentroCusto))])])]),e("div",{staticClass:"col-2 col-lg-1"},[e("q-tooltip",[a._v("Emissão")]),e("span",{staticClass:"block text-center"},[e("small",[a._v(a._s(a._f("mesNome")(a.titulo.dataEmissao)))])]),e("strong",{staticClass:"block q-title text-center"},[a._v(a._s(a._f("dia")(a.titulo.dataEmissao)))]),e("span",{staticClass:"block text-center"},[e("small",[a._v(a._s(a._f("ano")(a.titulo.dataEmissao)))])])],1),e("div",{staticClass:"col-2 col-lg-1"},[e("q-tooltip",[a._v("Competência")]),e("span",{staticClass:"block text-center"},[e("small",[a._v(a._s(a._f("mesNome")(a.titulo.dataCompetencia)))])]),e("strong",{staticClass:"block q-title text-center"},[a._v(a._s(a._f("dia")(a.titulo.dataCompetencia)))]),e("span",{staticClass:"block text-center"},[e("small",[a._v(a._s(a._f("ano")(a.titulo.dataCompetencia)))])])],1),e("div",{staticClass:"col-8 col-sm-4 col-lg-2 text-right"},[e("div",[e("small",{staticClass:"block q-caption"},[a._v("Desconto")]),e("strong",[a._v(a._s(a._f("numero")(a.titulo.valorDesconto||0,2)))])]),a.titulo.diasEmAtraso?[e("div",{staticClass:"q-mt-xs"},[e("small",{staticClass:"block q-caption"},[a._v("Multa")]),e("strong",[a._v("\n            "+a._s(a._f("numero")(a.titulo.valorMulta||0,2))+" ("+a._s(a._f("numero")(a.titulo.percentualMulta||0,2))+"%)\n          ")])]),e("div",{staticClass:"q-mt-xs"},[e("small",{staticClass:"block q-caption"},[a._v("Juros")]),e("strong",[a._v("\n            "+a._s(a._f("numero")(a.titulo.valorTotalJuros||0,2))+" ("+a._s(a._f("numero")(a.titulo.percentualJuros||0,2))+"% dia)\n          ")])])]:a._e()],2)]):a._e(),e("q-modal",{attrs:{"content-css":{minWidth:"30vw"}},model:{value:a.modalEditar.visivel,callback:function(t){a.$set(a.modalEditar,"visivel",t)},expression:"modalEditar.visivel"}},[e("q-modal-layout",[e("q-toolbar",{attrs:{slot:"header"},slot:"header"},[e("q-toolbar-title",[a._v("Editar Título")]),e("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"close",round:""}})],1),e("form",{staticClass:"layout-padding",on:{submit:function(t){return t.preventDefault(),a.salvar(t)}}},[e("dl",{staticClass:"horizontal"},[e("dt",{staticStyle:{"text-align":"left"}},[a._v("Valor")]),e("dd",{staticClass:"text-right"},[a._v(a._s(a._f("numero")(a.titulo.valor,2)))])]),e("dl",{staticClass:"horizontal"},[e("dt",{staticStyle:{"text-align":"left"}},[a._v("Dias em Atraso")]),e("dd",{staticClass:"text-right"},[a._v(a._s(a._f("numero")(a.titulo.diasEmAtraso,0)))])]),e("dl",{staticClass:"horizontal"},[e("dt",{staticStyle:{"text-align":"left"}},[a._v("Multa")]),e("dd",{staticClass:"text-right"},[a._v(a._s(a._f("numero")(a.titulo.valorMulta,2)))])]),e("dl",{staticClass:"horizontal"},[e("dt",{staticStyle:{"text-align":"left"}},[a._v("Juros")]),e("dd",{staticClass:"text-right"},[a._v(a._s(a._f("numero")(a.titulo.valorTotalJuros,2)))])]),e("dl",{staticClass:"horizontal"},[e("dt",{staticStyle:{"text-align":"left"}},[a._v("Desconto")]),e("dd",{staticClass:"text-right"},[e("campo",{attrs:{"inverted-light":"",color:"light",tipo:"decimal",decimals:"2",erro:a.modalEditar.erroCalculo},on:{input:function(t){a.desconto()}},model:{value:a.titulo.valorDesconto,callback:function(t){a.$set(a.titulo,"valorDesconto",t)},expression:"titulo.valorDesconto"}})],1)]),e("dl",{staticClass:"horizontal"},[e("dt",{staticStyle:{"text-align":"left"}},[a._v("Total")]),e("dd",{staticClass:"text-right"},[a._v(a._s(a._f("numero")(a.titulo.valorTotal,2)))])]),e("div",{staticClass:"q-mt-lg text-center"},[e("q-btn",{staticClass:"q-ml-sm no-shadow",attrs:{color:"primary",label:"Salvar",type:"submit"}})],1)])],1)],1)],1)},i=[];o._withStripped=!0;e("55dd"),e("7514"),e("96cf");var r=e("c973"),n=e.n(r),s=e("df3a"),c=e("88db"),d=e("3e8a"),u=e("8149"),l=e("2ef0"),m=e("ed08"),v={components:{Avatar:s["a"],Campo:c["a"]},computed:{mostrarMenuTresPontos:function(){return this.mostrarOpcaoMigrarFatura}},data:function(){return{titulo:{},tituloOriginal:{},detalhes:!1,contatos:{},fatura:{},faturasAbertas:[],mostrarOpcaoMigrarFatura:!1,visibilidade:{botao:{remover:!1,editar:!1}},modalEditar:{visivel:!1,erroCalculo:!1},tema:["TituloCard","bg-white","q-pa-md","round-borders"]}},methods:{irParaAtendimentoFatura:function(a){this.$router.push({name:"AtendimentoFatura",params:{id:a}})},migrarFatura:function(){var a=n()(regeneratorRuntime.mark(function a(t){var e,o,i,r,n;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,this.$q.dialog({cancel:"Cancelar",message:"Esta ação irá migrar esta venda para outra fatura.",noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 3:a.next=8;break;case 5:return a.prev=5,a.t0=a["catch"](0),a.abrupt("return");case 8:if(t||!this.titulo.idContato||!this.titulo.idEmpresa){a.next=36;break}return a.next=11,Object(d["a"])().contato.get(this.titulo.idContato);case 11:if(a.t1=a.sent,a.t1){a.next=14;break}a.t1={};case 14:return e=a.t1,a.next=17,Object(d["a"])().contatoEndereco.where({idContato:this.titulo.idContato}).toArray();case 17:return o=a.sent,a.next=20,Object(d["a"])().contatoTelefone.where({idContato:this.titulo.idContato}).toArray();case 20:return i=a.sent,o=o.find(function(a){return"Principal"===a.grupo.trim().toLowerCase()})||o[0]||{},i=i.find(function(a){return"Principal"===a.tipoTelefone.trim().toLowerCase()})||i[0]||{},a.next=25,Object(d["a"])().contato.get(this.titulo.idEmpresa);case 25:if(a.t2=a.sent,a.t2){a.next=28;break}a.t2={};case 28:return r=a.t2,a.next=31,Object(d["a"])().contatoEndereco.where({idContato:this.titulo.idEmpresa}).toArray();case 31:return n=a.sent,n=n.find(function(a){return"Principal"===a.grupo.trim().toLowerCase()})||n[0]||{},t=u["a"].fatura.criar({idEmpresa:r.id,idEmpresaEndereco:n.id||"",descricaoEmpresa:r.nome||"",numeroDocumentoEmpresa:r.numeroDocumentoNacional||"",inscricaoMunicipalEmpresa:r.numeroDocumentoMunicipal||"",optanteSimplesNacional:"SimplesNacional"===r.regime?"1":"0",idContato:e.id,idContatoEndereco:o.id||"",numeroDocumentoContato:e.numeroDocumentoNacional||"",descricaoContato:e.nome||"",descricaoContatoEndereco:"".concat(o.logradouro||"",", ",o.numero||""," ",o.complemento||""," - ",o.bairro||""," - ",o.municipio||"","/",o.uf||""),telefoneContato:i.telefone||"",emailContato:e.email||"",regimeContato:e.regime||"",observacaoFaturamento:""}),a.next=36,u["a"].fatura.grava({fatura:t});case 36:if(!t.id){a.next=43;break}return a.next=39,u["a"].financeiroTitulo.grava({atual:{id:this.titulo.id,idFatura:t.id},original:this.titulo});case 39:localStorage.setItem("idFatura",t.id),this.titulo.idContato&&(this.$emit("executar","atualizar"),this.irParaAtendimentoFatura(this.titulo.idContato)),a.next=44;break;case 43:this.$q.notify("Não foi possível realizar a operação");case 44:case"end":return a.stop()}},a,this,[[0,5]])}));return function(t){return a.apply(this,arguments)}}(),salvar:function(){var a=n()(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:if(!this.modalEditar.erroCalculo){a.next=3;break}return this.$q.notify("Não é possível salvar o título. Erro de cálculo encontrado."),a.abrupt("return");case 3:return a.prev=3,a.next=6,u["a"].financeiroTitulo.grava({atual:this.titulo,original:this.tituloOriginal});case 6:this.tituloOriginal=Object(m["clonar"])(this.titulo),this.modalEditar.visivel=!1,this.$q.notifyPositive("Título salvo."),this.$emit("executar","recalcular"),a.next=15;break;case 12:a.prev=12,a.t0=a["catch"](3),this.$q.notifyPositive("Não foi possível salvar o título. Por favor, tente novamente.");case 15:case"end":return a.stop()}},a,this,[[3,12]])}));return function(){return a.apply(this,arguments)}}(),editar:function(){this.modalEditar.visivel=!0},permissaoEditar:function(){var a=n()(regeneratorRuntime.mark(function a(){var t;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,u["a"].permissao.objeto("Diretiva_Caixa_DescontoTitulo");case 2:return t=a.sent,a.abrupt("return",t);case 4:case"end":return a.stop()}},a)}));return function(){return a.apply(this,arguments)}}(),desconto:function(){var a=Object(m["arredondar"])((this.titulo.valorMulta||0)+(this.titulo.valorJuros||0)*(this.titulo.diasEmAtraso||0));if(this.titulo.valorDesconto<0||this.titulo.valorDesconto>a)return this.modalEditar.erroCalculo=!0,this.titulo.valorTotal=this.tituloOriginal.valorTotal,this.titulo.valorARealizar=this.tituloOriginal.valorARealizar,void(this.titulo.percentualDesconto=this.tituloOriginal.percentualDesconto);this.titulo.valorTotal=Object(m["arredondar"])((this.titulo.valor||0)-(this.titulo.valorDesconto||0)+(this.titulo.valorMulta||0)+(this.titulo.valorJuros||0)*(this.titulo.diasEmAtraso||0)),this.titulo.valorARealizar=this.titulo.valorTotal,this.titulo.percentualDesconto=Object(m["arredondar"])(100*(this.titulo.valorDesconto||0)/(this.titulo.valor||1)),this.modalEditar.erroCalculo=!1},alternarDetalhes:function(){this.detalhes=!this.detalhes},remover:function(){var a=n()(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,this.$q.dialog({cancel:"Cancelar",message:"Esta ação irá remover este título da fatura.",noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 3:a.next=8;break;case 5:return a.prev=5,a.t0=a["catch"](0),a.abrupt("return");case 8:return this.titulo.idFatura="",a.next=11,u["a"].financeiroTitulo.grava({atual:this.titulo,original:this.tituloOriginal});case 11:this.visibilidade.botao.remover=!1,this.$q.notifyPositive("Título removido da fatura."),this.$emit("executar","remover");case 14:case"end":return a.stop()}},a,this,[[0,5]])}));return function(){return a.apply(this,arguments)}}()},props:{dados:{required:!0,type:Object}},mounted:function(){var a=this,t=new Date(this.dados.dataVencimento).setHours(0,0,0,0),e=(new Date).setHours(0,0,0,0);t<e?this.tema.push("vencido"):this.tema=Object(l["remove"])(this.tema,function(a){return"vencido"!==a}),this.tituloOriginal=Object(m["clonar"])(this.dados),this.titulo=Object(m["clonar"])(this.dados),this.visibilidade.botao.remover=!1,this.permissaoEditar().then(function(t){return a.visibilidade.botao.editar=t&&!a.tituloOriginal.valorRealizado}),this.contatos={},this.titulo.idContato&&u["a"].contato.le({id:this.titulo.idContato}).then(function(t){a.$set(a.contatos,a.titulo.idContato,t)}),this.titulo.idEmpresa&&u["a"].contato.le({id:this.titulo.idEmpresa}).then(function(t){a.$set(a.contatos,a.titulo.idEmpresa,t)}),this.mostrarOpcaoMigrarFatura=!1,this.titulo.idFatura&&u["a"].fatura.leNew({id:this.titulo.idFatura}).then(function(t){a.fatura=t,"Aberta"===t.status&&(u["a"].contatoBusca.filtrar(null,{ativo:!0,empresas:!0},0).then(function(t){t.find(function(t){return t.id===a.titulo.idEmpresa})&&(a.visibilidade.botao.remover=!0)}),a.titulo.idContato&&a.titulo.idEmpresa&&u["a"].fatura.obterAbertas(a.titulo.idContato,a.titulo.idEmpresa).then(function(t){t=t.filter(function(t){return t.id!==a.titulo.idFatura}),a.faturasAbertas=t.sort(function(a,t){return!a.numero||a.numero<t.numero?-1:1}),a.mostrarOpcaoMigrarFatura=!0}))})}},f=v,p=(e("e38f"),e("2877")),h=Object(p["a"])(f,o,i,!1,null,null,null);h.options.__file="TituloCard.vue";t["a"]=h.exports},d90a:function(a,t,e){},e062:function(a,t,e){},e22f:function(a,t,e){},e2e6:function(a,t,e){"use strict";var o=e("67dd"),i=e.n(o);i.a},e38f:function(a,t,e){"use strict";var o=e("e22f"),i=e.n(o);i.a},eab3:function(a,t,e){"use strict";var o=e("d90a"),i=e.n(o);i.a},f377:function(a,t,e){"use strict";var o=function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("q-modal",{attrs:{value:a.visivel,maximized:""},on:{input:a.eventoInput}},[e("q-modal-layout",{staticClass:"bg-light"},[e("q-toolbar",{attrs:{slot:"header"},slot:"header"},[e("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"arrow_back",round:""}}),e("q-toolbar-title",[a._v("Fechar caixa")])],1),e("div",{staticClass:"gutter-md layout-padding row"},[e("div",{staticClass:"col-12 col-lg-7"},[e("div",{staticClass:"bg-white round-borders q-pa-md"},[e("div",{staticClass:"items-center row"},[e("div",{staticClass:"col q-title"},[a._v(a._s(a.campos.caixaDescricao))]),e("div",{staticClass:"col text-faded text-right"},[e("q-icon",{attrs:{name:"place"}}),a._v("\n              "+a._s(a.campos.caixaEmpresaNome)+"\n            ")],1)]),e("form",{staticClass:"q-mt-lg"},[e("div",{staticClass:"q-subheading text-weight-medium"},[a._v("Dinheiro")]),e("div",{staticClass:"row q-mt-sm"},[e("div",{staticClass:"col-12 col-lg-8 items-center gutter-sm q-body-1 row"},[e("div",{staticClass:"col-5"},[a._v("Abertura")]),e("div",{staticClass:"col-7"},[e("campo",{staticClass:"bg-grey-2",attrs:{tipo:"decimal",decimals:"2"},model:{value:a.campos.abertura,callback:function(t){a.$set(a.campos,"abertura",t)},expression:"campos.abertura"}})],1),e("div",{staticClass:"col-5"},[a._v("Recebimentos")]),e("div",{staticClass:"col-7 text-right"},[a._v("\n                  "+a._s(a._f("numero")(a.recebimentos,2))+"\n                  "),e("q-tooltip",[a._v("Fechamento - Abertura + Despesas - Suprimentos + Sangrias = "),e("strong",[a._v("Recebimentos")])])],1),e("div",{staticClass:"col-5"},[a._v("Sangrias")]),e("div",{staticClass:"col-7 text-right"},[a._v(a._s(a._f("numero")(a.campos.sangrias,2)))]),e("div",{staticClass:"col-5"},[a._v("Suprimentos")]),e("div",{staticClass:"col-7 text-right"},[a._v(a._s(a._f("numero")(a.campos.suprimentos,2)))]),e("div",{staticClass:"col-5"},[a._v("Despesas")]),e("div",{staticClass:"col-7 text-right"},[a._v(a._s(a._f("numero")(a.campos.despesas,2)))]),e("div",{staticClass:"col-5"},[a._v("Fechamento")]),e("div",{staticClass:"col-7"},[e("campo",{staticClass:"bg-grey-2",attrs:{tipo:"decimal",decimals:"2"},on:{blur:a.calculaSangriaFinal},model:{value:a.campos.fechamento,callback:function(t){a.$set(a.campos,"fechamento",t)},expression:"campos.fechamento"}})],1),e("div",{staticClass:"col-5"},[a._v("Fundo de caixa")]),e("div",{staticClass:"col-7"},[e("campo",{staticClass:"bg-grey-2",attrs:{tipo:"decimal",decimals:"2"},on:{blur:a.calculaSangriaFinal},model:{value:a.campos.fundoCaixa,callback:function(t){a.$set(a.campos,"fundoCaixa",t)},expression:"campos.fundoCaixa"}})],1),e("div",{staticClass:"col-5"},[a._v("Sangria Final")]),e("div",{staticClass:"col-7 text-right"},[a._v(a._s(a._f("numero")(a.campos.sangriaFinal,2)))])]),e("div",{staticClass:"Faturamento-historico col-12 col-lg-4 q-caption text-faded text-right"},[e("div",[a._v("\n                  "+a._s(a._f("dataHora")(a.campos.dataHoraAbertura))+" "),e("q-icon",{attrs:{name:"calendar_today"}}),e("br"),a._v("\n                  "+a._s(a.campos.nomeUsuarioAbertura)+" "),e("q-icon",{attrs:{name:"person"}})],1)])]),e("div",{staticClass:"q-subheading text-weight-medium q-mt-lg"},[a._v("Outras formas de pagamento")]),e("div",{staticClass:"q-mt-sm"},a._l(a.condicaoPagamento,function(t){return e("div",{key:t.id,staticClass:"gutter-x-sm items-center q-mt-sm row"},[e("div",{staticClass:"col-7"},[a._v(a._s(t.descricao))]),e("div",{staticClass:"col-5"},[[5,99].includes(t.tipo)?e("div",{staticClass:"text-right",staticStyle:{"padding-top":"6px","padding-right":"8px"}},[a._v(a._s(a._f("numero")(t.valor,2)))]):e("campo",{attrs:{classCampo:"bg-grey-2 q-px-sm",tipo:"decimal",decimals:"2"},model:{value:t.valor,callback:function(e){a.$set(t,"valor",e)},expression:"c.valor"}})],1)])})),e("campo",{staticClass:"bg-grey-2 q-mt-lg q-pa-xs",attrs:{rotulo:"Observação",rows:"2",tipo:"textoArea"},model:{value:a.campos.observacao,callback:function(t){a.$set(a.campos,"observacao",t)},expression:"campos.observacao"}})],1)])]),e("div",{staticClass:"col-12 col-lg-5"},[e("div",{staticClass:"q-title text-primary"},[a._v("Sangrias")]),e("table",{staticClass:"Tabela q-mt-md"},[e("thead",[e("tr",[e("th",[a._v("Data Emissão")]),e("th",[a._v("Observação")]),e("th",[a._v("Valor")])])]),e("tbody",a._l(a.sangrias,function(t){return e("tr",{key:t.id},[e("td",[a._v(a._s(a._f("data")(t.dataEmissao)))]),e("td",[a._v(a._s(t.observacao))]),e("td",[a._v(a._s(a._f("numero")(t.valorCredito,2)))])])}))]),e("div",{staticClass:"q-title q-mt-xl text-primary"},[a._v("Transferências")]),e("table",{staticClass:"Tabela q-mt-md"},[e("thead",[e("tr",[e("th",[a._v("Data Emissão")]),e("th",[a._v("Observação")]),e("th",[a._v("Valor")])])]),e("tbody",a._l(a.suprimentos,function(t){return e("tr",{key:t.id},[e("td",[a._v(a._s(a._f("data")(t.dataEmissao)))]),e("td",[a._v(a._s(t.observacao))]),e("td",[a._v(a._s(a._f("numero")(t.valorDebito,2)))])])}))]),e("div",{staticClass:"q-title q-mt-xl text-primary"},[a._v("Despesas simples")]),e("table",{staticClass:"Tabela q-mt-md"},[e("thead",[e("tr",[e("th",[a._v("Data emissão")]),e("th",[a._v("Pago à")]),e("th",[a._v("Conta despesa")]),e("th",[a._v("Valor")])])]),e("tbody",a._l(a.despesas,function(t){return e("tr",{key:t.id},[e("td",[a._v(a._s(a._f("data")(t.dataEmissao)))]),e("td",[a._v(a._s((t.contato||{}).nome))]),e("td",[a._v(a._s(((t.financeiroPlanoConta||{}).descricao||"").trim()))]),e("td",[a._v(a._s(a._f("numero")(t.valorTotal,2)))])])}))])])]),e("q-toolbar",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[e("q-toolbar-title",{staticClass:"text-right"},[e("q-btn",{staticClass:"q-ml-sm",attrs:{color:"primary",label:"Concluir"},on:{click:a.fecharCaixa}})],1)],1)],1)],1)},i=[];o._withStripped=!0;e("ac4d"),e("8a81"),e("ac6a"),e("6762"),e("2fdb"),e("96cf");var r=e("c973"),n=e.n(r),s=e("88db"),c=e("8149"),d=e("ed08"),u=e("2ef0"),l={components:{Campo:s["a"]},computed:{recebimentos:function(){var a=Object(d["arredondar"])((this.campos.fechamento||0)-(this.campos.abertura||0)+(this.campos.despesas||0)-(this.campos.suprimentos||0)+(this.campos.sangrias||0));return a}},data:function(){return{visivel:!1,campos:{sangrias:0,despesas:0,suprimentos:0,sangriaFinal:0,fundoCaixa:0,abertura:0,dataHoraAbertura:"",nomeUsuarioAbertura:"",caixaDescricao:"",caixaEmpresaNome:"",observacao:""},sangrias:[],despesas:[],suprimentos:[],condicaoPagamento:[],condicaoPagamentoDinheiro:[]}},methods:{calculaSangriaFinal:function(){var a=Object(d["arredondar"])(this.campos.fechamento-this.campos.fundoCaixa);a<0&&(this.$q.notify({message:"Sangria final não pode ser maior do que o recebimento",type:"warning"}),this.campos.fundoCaixa=0,a=Object(d["arredondar"])(this.campos.fechamento)),this.campos.sangriaFinal=a},atualizar:function(){var a=n()(regeneratorRuntime.mark(function a(){var t,e,o,i,r,n,s,l,m,v,f,p,h,b,x,C,g,q,_,F,k,D,y,w,P=this;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:if(a.prev=0,this.$q.loading.show({message:"Processando..."}),this.campos.sangrias=0,this.campos.despesas=0,this.campos.suprimentos=0,this.campos.sangriaFinal=0,this.campos.fundoCaixa=0,this.campos.abertura=0,this.campos.dataHoraAbertura="",this.campos.nomeUsuarioAbertura="",this.campos.caixaDescricao="",this.campos.caixaEmpresaNome="",this.campos.observacao="",this.documentoCaixa={},!this.idDocumentoCaixa){a.next=19;break}return a.next=17,c["a"].documento.le({id:this.idDocumentoCaixa});case 17:t=a.sent,"Caixa"===t.tipo&&["Aberto","Reaberto"].includes(t.status)&&(this.documentoCaixa=t);case 19:if(this.documentoCaixa&&this.documentoCaixa.id){a.next=23;break}return this.$q.notify({message:"Selecione um caixa aberto",type:"warning"}),this.$emit("input",!1),a.abrupt("return");case 23:return a.next=25,c["a"].documentoCondicaoPagamento.le({idDocumentoCaixa:this.idDocumentoCaixa});case 25:e=a.sent,o={},i=!0,r=!1,n=void 0,a.prev=30,s=e[Symbol.iterator]();case 32:if(i=(l=s.next()).done){a.next=45;break}if(m=l.value,!m.idDocumento||o[m.idDocumento]){a.next=42;break}return a.next=37,c["a"].documento.le({id:m.idDocumento});case 37:if(o[m.idDocumento]=a.sent,o[m.idDocumento].dataHoraFinalizado){a.next=42;break}return this.$q.notify({message:"Existem faturas abertas com condição de pagamento lançada. Não é possível finalizar o caixa sem finalizar ou excluir essas faturas!",type:"warning"}),this.$emit("input",!1),a.abrupt("return");case 42:i=!0,a.next=32;break;case 45:a.next=51;break;case 47:a.prev=47,a.t0=a["catch"](30),r=!0,n=a.t0;case 51:a.prev=51,a.prev=52,i||null==s.return||s.return();case 54:if(a.prev=54,!r){a.next=57;break}throw n;case 57:return a.finish(54);case 58:return a.finish(51);case 59:return a.next=61,c["a"].caixa.le({id:this.documentoCaixa.idCaixa});case 61:return this.caixa=a.sent,a.next=64,c["a"].financeiroTitulo.le({idDocumentoCaixa:this.documentoCaixa.id});case 64:return v=a.sent,a.next=67,c["a"].empresa.le({idContato:this.documentoCaixa.idEmpresa});case 67:return f=a.sent,f.length&&(this.empresa=f[0]),a.next=71,c["a"].financeiroMovimentacao.le({idDocumentoCaixa:this.documentoCaixa.id,documentoTipo:"Sangria"});case 71:p=a.sent,this.sangrias=p.filter(function(a){return a.valorCredito>0}),this.campos.sangrias=Object(d["arredondar"])(this.sangrias.reduce(function(a,t){return a+=t.valorCredito,a},0)),this.despesas=v.filter(function(a){return"DespesaSimples"===a.documentoTipo}),h=0,b=!0,x=!1,C=void 0,a.prev=79,g=this.despesas[Symbol.iterator]();case 81:if(b=(q=g.next()).done){a.next=93;break}return _=q.value,h+=_.valorTotal,a.next=86,c["a"].contato.le({id:_.idContato});case 86:return _.contato=a.sent,a.next=89,c["a"].financeiroPlanoConta.le({id:_.idFinanceiroPlanoConta});case 89:_.financeiroPlanoConta=a.sent;case 90:b=!0,a.next=81;break;case 93:a.next=99;break;case 95:a.prev=95,a.t1=a["catch"](79),x=!0,C=a.t1;case 99:a.prev=99,a.prev=100,b||null==g.return||g.return();case 102:if(a.prev=102,!x){a.next=105;break}throw C;case 105:return a.finish(102);case 106:return a.finish(99);case 107:return this.campos.despesas=Object(d["arredondar"])(h),a.next=110,c["a"].financeiroMovimentacao.le({idDocumentoCaixa:this.documentoCaixa.id,documentoTipo:"Suprimento"});case 110:return F=a.sent,this.suprimentos=F.filter(function(a){return a.valorDebito>0}),this.campos.suprimentos=Object(d["arredondar"])(this.suprimentos.reduce(function(a,t){return a+=t.valorDebito,a},0)),a.next=115,c["a"].formaPagamento.le();case 115:for(y in a.t2=function(a){return(!a.idContatoEmpresa||a.idContatoEmpresa===P.documentoCaixa.idEmpresa)&&!!a.ativo},a.t3=function(a){return{id:a.id,tipo:a.tipo,descricao:a.descricao,valor:0,idFinanceiroPlanoConta:a.idFinanceiroPlanoConta}},k=a.sent.filter(a.t2).map(a.t3),D=function(a){var t=e.filter(function(t){return t.idDocumento===a}),o=!0,i=!1,r=void 0;try{for(var n,s=t[Symbol.iterator]();!(o=(n=s.next()).done);o=!0){var c=n.value,u=!0,l=!1,m=void 0;try{for(var v,f=k[Symbol.iterator]();!(u=(v=f.next()).done);u=!0){var p=v.value;p.id===c.idFormaPagamento&&[5,97,99].includes(p.tipo)&&(p.valor=Object(d["arredondar"])(p.valor+c.valor))}}catch(a){l=!0,m=a}finally{try{u||null==f.return||f.return()}finally{if(l)throw m}}}}catch(a){i=!0,r=a}finally{try{o||null==s.return||s.return()}finally{if(i)throw r}}},o)D(y);return this.condicaoPagamento=Object(u["orderBy"])(k.filter(function(a){return a.idFinanceiroPlanoConta!==P.caixa.idPlanoConta}),"descricao","asc"),this.condicaoPagamentoDinheiro=k.filter(function(a){return a.idFinanceiroPlanoConta===P.caixa.idPlanoConta}),this.campos.abertura=this.documentoCaixa.valorAbertura,this.campos.dataHoraAbertura=this.documentoCaixa.dataHoraEmissao,a.next=126,c["a"].usuario.le({id:this.documentoCaixa.idContato});case 126:w=a.sent,this.campos.nomeUsuarioAbertura=w.nome||"",this.campos.caixaDescricao=this.caixa.descricao,this.campos.caixaEmpresaNome=this.empresa.nome,this.calculaSangriaFinal(),this.$q.loading.hide(),this.visivel=!0,this.$emit("input",this.visivel),a.next=139;break;case 136:a.prev=136,a.t4=a["catch"](0),this.$q.notifyError("Não foi possível realizar o Fechamento de Caixa.",a.t4);case 139:return a.prev=139,this.$q.loading.hide(),a.finish(139);case 142:case"end":return a.stop()}},a,this,[[0,136,139,142],[30,47,51,59],[52,,54,58],[79,95,99,107],[100,,102,106]])}));return function(){return a.apply(this,arguments)}}(),fecharCaixa:function(){var a=n()(regeneratorRuntime.mark(function a(){var t,e,o,i,r,n,s,l,m,v,f,p,h,b,x,C,g,q,_,F,k,D,y,w,P,O,j,E,S,M,T,z,A,$,R,I,V,N,H,B,L,U,J,Y,W,Q,G,K,X,Z,aa,ta;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:if(a.prev=0,this.$q.loading.show({message:"Processando..."}),!(this.campos.sangriaFinal<0)){a.next=5;break}return this.$q.notify({message:"Sangria final não pode ser negativa.",type:"warning"}),a.abrupt("return");case 5:return t=Object(d["dataAtual"])(),e=Object(d["clonar"])(this.documentoCaixa),e.status="Aguardando Conferência",e.dataHoraFinalizado=t,e.observacao=this.observacao,e.valorAbertura=this.campos.abertura,a.next=13,c["a"].caixa.le({id:e.idCaixa});case 13:return o=a.sent,Object(d["verificarErro"])(!o.id,"Caixa não existe"),a.next=17,c["a"].financeiroPlanoConta.le({id:o.idPlanoConta});case 17:return i=a.sent,a.next=20,c["a"].financeiroPlanoConta.le({id:o.idPlanoContaSangria});case 20:return r=a.sent,a.next=23,c["a"].documentoStatus.le({idDocumento:e.id});case 23:return n=a.sent,n=n.filter(function(a){return"Fechamento Caixa"===a.operacao&&"Aguardando Conferência"===a.statusFinalizado&&"Aberto"===a.statusOriginal}),this.campos.sangriaFinal>0&&(s=n.length?n[0].dataHoraEmissao:t,l=c["a"].usuario.logado.id,m=Object(d["uuid"])(),v={id:Object(d["uuid"])(),idFinanceiroMovimentacaoN:m,idEmpresa:e.idEmpresa,idContato:l,idFinanceiroPlanoConta:i.id,dataEmissao:t,dataCompetencia:s,dataVencimento:s,dataMovimento:s,valorDebito:0,valorCredito:this.campos.sangriaFinal,descricao:"Sangria final de ".concat(c["a"].usuario.logado.apelido," no Caixa #").concat(e.id),observacao:"Transferência entre contas",documentoTipo:"Sangria Final",documentoId:e.id,idDocumentoCaixa:e.id},f={id:Object(d["uuid"])(),idFinanceiroMovimentacaoN:m,idEmpresa:e.idEmpresa,idContato:l,idFinanceiroPlanoConta:r.id,dataEmissao:t,dataCompetencia:s,dataVencimento:s,dataMovimento:s,valorDebito:this.campos.sangriaFinal,valorCredito:0,descricao:"Sangria final de ".concat(c["a"].usuario.logado.apelido," no Caixa #").concat(e.id),observacao:"Transferência entre contas",documentoTipo:"Sangria Final",documentoId:e.id,idDocumentoCaixa:e.id},c["a"].financeiroMovimentacaoN.grava({atual:{id:m}}),c["a"].financeiroMovimentacao.grava({atual:v}),c["a"].financeiroMovimentacao.grava({atual:f})),a.next=28,c["a"].documentoStatus.le({idDocumento:e.id});case 28:for(p=a.sent,h="",p.length&&(p=Object(u["orderBy"])(p,"dataHoraEmissao","desc"),h=p[0].statusFinalizado),b=Object(d["uuid"])(),x={id:b,idDocumento:e.id,operacao:"Fechamento Caixa",statusOriginal:h,statusFinalizado:"Aguardando Conferência",dataHoraEmissao:t,idUsuarioAlterou:c["a"].usuario.logado.id,idDocumentoCaixa:e.id},C=[],g=!0,q=!1,_=void 0,a.prev=37,F=this.condicaoPagamento[Symbol.iterator]();!(g=(k=F.next()).done);g=!0)D=k.value,C.push({id:Object(d["uuid"])(),idDocumento:e.id,idFormaPagamento:D.id,dataVencimento:t,valor:D.valor,ordem:b});a.next=45;break;case 41:a.prev=41,a.t0=a["catch"](37),q=!0,_=a.t0;case 45:a.prev=45,a.prev=46,g||null==F.return||F.return();case 48:if(a.prev=48,!q){a.next=51;break}throw _;case 51:return a.finish(48);case 52:return a.finish(45);case 53:for(y=!0,w=!1,P=void 0,a.prev=56,O=this.condicaoPagamentoDinheiro[Symbol.iterator]();!(y=(j=O.next()).done);y=!0)E=j.value,C.push({id:Object(d["uuid"])(),idDocumento:e.id,idFormaPagamento:E.id,dataVencimento:t,valor:this.campos.fechamento,ordem:b});a.next=64;break;case 60:a.prev=60,a.t1=a["catch"](56),w=!0,P=a.t1;case 64:a.prev=64,a.prev=65,y||null==O.return||O.return();case 67:if(a.prev=67,!w){a.next=70;break}throw P;case 70:return a.finish(67);case 71:return a.finish(64);case 72:return a.next=74,c["a"].documentoCondicaoPagamento.le({idDocumentoCaixa:e.id});case 74:return S=a.sent,a.next=77,c["a"].financeiroTitulo.le({idDocumentoCaixa:e.id,idDocumentoCaixaLiquidacao:e.id});case 77:return M=a.sent,a.next=80,c["a"].financeiroMovimentacao.le({idDocumentoCaixa:e.id});case 80:for(T=a.sent,z=[],A=!0,$=!1,R=void 0,a.prev=85,I=S[Symbol.iterator]();!(A=(V=I.next()).done);A=!0)N=V.value,z.push({id:Object(d["uuid"])(),idDocumentoCaixa:e.id,idDocumentoStatus:b,tabela:"documentoCondicaoPagamento",idTabela:N.id,json:JSON.stringify(N),dataHoraEmissao:t});a.next=93;break;case 89:a.prev=89,a.t2=a["catch"](85),$=!0,R=a.t2;case 93:a.prev=93,a.prev=94,A||null==I.return||I.return();case 96:if(a.prev=96,!$){a.next=99;break}throw R;case 99:return a.finish(96);case 100:return a.finish(93);case 101:for(H=0;H<C.length;H++)B=C[H],z.push({id:Object(d["uuid"])(),idDocumentoCaixa:e.id,idDocumentoStatus:b,tabela:"documentoCondicaoPagamento",idTabela:B.id,json:JSON.stringify(B),dataHoraEmissao:t});for(L=!0,U=!1,J=void 0,a.prev=105,Y=M[Symbol.iterator]();!(L=(W=Y.next()).done);L=!0)Q=W.value,z.push({id:Object(d["uuid"])(),idDocumentoCaixa:e.id,idDocumentoStatus:b,tabela:"financeiroTitulo",idTabela:Q.id,json:JSON.stringify(Q),dataHoraEmissao:t});a.next=113;break;case 109:a.prev=109,a.t3=a["catch"](105),U=!0,J=a.t3;case 113:a.prev=113,a.prev=114,L||null==Y.return||Y.return();case 116:if(a.prev=116,!U){a.next=119;break}throw J;case 119:return a.finish(116);case 120:return a.finish(113);case 121:for(G=!0,K=!1,X=void 0,a.prev=124,Z=T[Symbol.iterator]();!(G=(aa=Z.next()).done);G=!0)ta=aa.value,z.push({id:Object(d["uuid"])(),idDocumentoCaixa:e.id,idDocumentoStatus:b,tabela:"financeiroMovimentacao",idTabela:ta.id,json:JSON.stringify(ta),dataHoraEmissao:t});a.next=132;break;case 128:a.prev=128,a.t4=a["catch"](124),K=!0,X=a.t4;case 132:a.prev=132,a.prev=133,G||null==Z.return||Z.return();case 135:if(a.prev=135,!K){a.next=138;break}throw X;case 138:return a.finish(135);case 139:return a.finish(132);case 140:return a.next=142,c["a"].caixa.fecha({documentoCaixa:e,documentoCaixaOriginal:this.documentoCaixa,documentoStatus:[x],caixaConsolidacao2:z});case 142:this.$q.loading.hide(),this.visivel=!1,this.$emit("input",!1),this.$emit("fechado"),this.imprimir("fechamento-de-caixa",this.documentoCaixa.id),this.$q.notifyPositive("Caixa fechado com sucesso"),a.next=153;break;case 150:a.prev=150,a.t5=a["catch"](0),this.$q.notifyError("Não foi possível realizar o Fechamento de Caixa.",a.t5);case 153:return a.prev=153,this.$q.loading.hide(),a.finish(153);case 156:case"end":return a.stop()}},a,this,[[0,150,153,156],[37,41,45,53],[46,,48,52],[56,60,64,72],[65,,67,71],[85,89,93,101],[94,,96,100],[105,109,113,121],[114,,116,120],[124,128,132,140],[133,,135,139]])}));return function(){return a.apply(this,arguments)}}(),eventoInput:function(a){this.visivel=a,this.$emit("input",a)}},props:{idDocumentoCaixa:{default:"",required:!0,type:String},value:{default:!1,required:!0,type:Boolean}},watch:{value:function(a){a&&this.atualizar()}}},m=l,v=(e("c980"),e("2877")),f=Object(v["a"])(m,o,i,!1,null,"6077c736",null);f.options.__file="CaixaFechar.vue";t["a"]=f.exports},fdd0:function(a,t,e){"use strict";e.r(t);var o=function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{staticClass:"CaixaTesouraria"},[e("div",{staticClass:"q-pb-md"},[e("q-card",{staticClass:"shadow-3 row no-shadow"},[e("div",{staticClass:"col-12 q-pt-md"},[e("q-toolbar",{staticClass:"no-shadow q-pa-none",attrs:{"text-color":"black",color:"transparent"}},[e("q-toolbar-title",{staticClass:"q-pa-none"},[e("div",{staticClass:"filters row q-pa-sm q-ma-md gutter-x-sm bg-white",staticStyle:{"border-radius":"5px","min-height":"50px"}},[e("div",{staticClass:"col-12 col-md q-pl-none"},[e("div",{staticClass:"row "},[e("q-btn",{staticClass:"no-shadow",attrs:{icon:"filter_list",round:"",color:"faded"}}),e("q-chips-input",{staticClass:"col q-mx-sm",attrs:{color:"faded"},on:{input:a.filtrar},model:{value:a.grupos,callback:function(t){a.grupos=t},expression:"grupos"}})],1)]),e("div",{staticClass:"col-11 col-md"},[e("div",{staticClass:"row"},[e("campo",{attrs:{tipo:"data"},on:{input:a.filtrar},model:{value:a.dataIni,callback:function(t){a.dataIni=t},expression:"dataIni"}}),e("label",{staticClass:"q-ma-sm"},[a._v("até")]),e("campo",{attrs:{tipo:"data"},on:{input:a.filtrar},model:{value:a.dataFim,callback:function(t){a.dataFim=t},expression:"dataFim"}})],1)])])]),e("q-btn",{attrs:{round:"",dense:"",flat:"",icon:"more_vert",color:"primary",size:"lg"}},[e("q-tooltip",[a._v("\n              Outras opções\n            ")])],1)],1)],1)]),e("div",{staticClass:"no-shadow"},[e("q-list",{staticClass:"no-border"},[e("q-collapsible",{attrs:{opened:"",label:"Aguardando Conferência"}},[a._l(a.documentosCaixaConferencia.documentos,function(t){return e("div",{key:t.id},[e("caixa-card",{attrs:{documento:t},on:{atualizar:a.atualizar}})],1)}),e("p",{staticClass:"text-right q-mt-sm"},[a._v("\n            Total\n            "),e("strong",[a._v(a._s(a._f("numero")(a.documentosCaixaConferencia.total,2)))])])],2)],1),e("q-list",{staticClass:"no-border"},[e("q-collapsible",{attrs:{opened:"",label:"Fechado"}},a._l(a.documentosCaixaFechado.documentos,function(t){return e("div",{key:t.id},[e("caixa-card",{attrs:{documento:t},on:{atualizar:a.atualizar}})],1)}))],1)],1)],1)])},i=[];o._withStripped=!0;e("ac4d"),e("8a81"),e("ac6a"),e("6762"),e("2fdb");var r=e("448a"),n=e.n(r),s=(e("386d"),e("a481"),e("28a5"),e("7514"),e("96cf"),e("c973")),c=e.n(s),d=function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{staticClass:"q-mb-md"},[e("q-card",{staticClass:"extratoItem bg-white q-pa-md"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 col-lg-6"},[e("div",{staticClass:"q-px-sm"},[e("avatar",{staticStyle:{float:"left"},attrs:{imagem:a.usuarioAbertura.imagem,rotulo:a.usuarioAbertura.nome,tamanho:"40"}}),e("q-toolbar-title",[e("div",[a._v("\n              "+a._s(a.usuarioAbertura.apelido)+"\n            ")]),e("div",{attrs:{slot:"subtitle"},slot:"subtitle"},[a._v("\n              "+a._s(a.usuarioAbertura.nome)+"\n            ")])]),e("q-chip",{staticClass:"q-ma-sm q-my-sm",attrs:{rounded:"",color:"grey",small:""}},[a._v("\n            "+a._s(a.documento.status)+"\n          ")]),e("p",{staticClass:"q-mt-sm"},[e("q-toolbar-title",{staticClass:"q-mx-none q-mt-sm q-px-none"},[e("q-icon",{attrs:{name:"business"}}),a._v("\n              "+a._s(a.empresa.apelido)+"\n              "),e("div",{attrs:{slot:"subtitle"},slot:"subtitle"},[a._v("\n                "+a._s(a.empresa.nome)+"\n              ")])],1)],1)],1)]),e("div",{staticClass:"col-12 col-lg-2"},[e("div",{staticClass:"q-px-sm"},[e("badge",{staticClass:"q-mr-sm",attrs:{escuro:"",cor:"positive"}},[a._v("\n            #"+a._s(parseInt(a.documento.numero)||(a.documento.id||"").slice(-6))+"\n          ")])],1)]),e("div",{staticClass:"col-3 col-lg-1"},[e("q-tooltip",[a._v("\n          Abertura\n        ")]),e("p",{staticClass:"text-center q-my-none"},[e("small",[a._v(a._s(a._f("mesNome")(a.documento.dataHoraEmissao)))])]),e("p",{staticClass:"text-center q-my-none q-headline text-weight-bold"},[e("strong",[a._v(a._s(a._f("dia")(a.documento.dataHoraEmissao)))])]),e("p",{staticClass:"text-center q-my-none"},[e("small",[a._v(a._s(a._f("ano")(a.documento.dataHoraEmissao)))])]),e("p",{staticClass:"text-center q-my-none"},[e("small",[a._v(a._s(a._f("hora")(a.documento.dataHoraEmissao)))])])],1),e("div",{staticClass:"col-3 col-lg-1"},[a.documento.dataHoraFinalizado?e("q-tooltip",[a._v("\n          Fechamento\n        ")]):a._e(),e("p",{staticClass:"text-center q-my-none"},[e("small",[a._v(a._s(a._f("mesNome")(a.documento.dataHoraFinalizado)))])]),e("p",{staticClass:"text-center q-my-none q-headline text-weight-bold"},[e("strong",[a._v(a._s(a._f("dia")(a.documento.dataHoraFinalizado)))])]),e("p",{staticClass:"text-center q-my-none"},[e("small",[a._v(a._s(a._f("ano")(a.documento.dataHoraFinalizado)))])]),e("p",{staticClass:"text-center q-my-none"},[e("small",[a._v(a._s(a._f("hora")(a.documento.dataHoraFinalizado)))])])],1),e("div",{staticClass:"col-6 col-lg-2"},[e("dl",{staticClass:"float-right full-width q-mb-sm"},[e("dt",{staticClass:"text-right q-headline text-positive text-weight-bold"},[a.documento.totalDocumento?e("span",[a._v(a._s(a._f("numero")(a.documento.totalDocumento,2)))]):e("span",[a._v("-")]),e("p",{staticClass:"text-weight-normal text-tertiary q-body-1"},[a.documento.subTotal?e("span",[a._v(a._s(a._f("numero")(a.documento.subTotal,2)))]):e("span",[a._v("-")])])])]),e("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{float:"right"},attrs:{rounded:"",dense:"",flat:"",icon:"edit",size:"md",color:"primary"},on:{click:a.abrirCaixaConferirModal}},[e("q-tooltip",[a._v("\n            Abrir conferência\n          ")])],1),e("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{float:"right"},attrs:{rounded:"",dense:"",flat:"",icon:"print",size:"md",color:"primary"}},[e("q-popover",[e("q-list",{attrs:{link:"",separator:""}},[e("q-item",{nativeOn:{click:function(t){a.imprimir("fechamento-de-caixa",a.documento.id)}}},[e("q-item-side",{attrs:{icon:"print"}}),e("q-item-main",{attrs:{label:"Imprimir Fechamento"}})],1),e("q-item",{nativeOn:{click:function(t){a.imprimir("conferencia-de-caixa",a.documento.id)}}},[e("q-item-side",{attrs:{icon:"print"}}),e("q-item-main",{attrs:{label:"Imprimir Conferência"}})],1)],1)],1)],1)],1)])]),e("caixa-conferir",{attrs:{idDocumentoCaixa:a.documento.id},on:{executar:a.executar},model:{value:a.caixaConferirModal.visivel,callback:function(t){a.$set(a.caixaConferirModal,"visivel",t)},expression:"caixaConferirModal.visivel"}})],1)},u=[];d._withStripped=!0;var l=e("df3a"),m=e("a0fd"),v=function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("q-modal",{staticClass:"caixaconferir",attrs:{maximized:""},on:{hide:a.aoFecharModal},model:{value:a.visivel,callback:function(t){a.visivel=t},expression:"visivel"}},[e("q-modal-layout",{staticClass:"bg-light"},[e("q-toolbar",{attrs:{slot:"header"},slot:"header"},[e("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{flat:"",round:"",dense:"",icon:"arrow_back"}}),e("q-toolbar-title",[a._v("Conferir caixa")]),e("q-btn",{attrs:{dense:"",flat:"",icon:"print",round:""}})],1),e("div",{staticClass:"layout-padding",staticStyle:{"max-width":"1280px",padding:"0","padding-bottom":"53px"}},[e("div",{staticClass:"bg-white round-borders q-pa-md"},[e("div",{staticClass:"items-center row"},[e("div",{staticClass:"col-12 col-lg-8 text-faded"},[e("q-icon",{attrs:{name:"place"}}),a._v("\n            "+a._s(a.campos.caixaEmpresaNome)+"\n          ")],1),e("div",{staticClass:"Faturamento-historico col-12 col-lg-4 q-caption text-faded text-right"},[e("div",[a._v("\n              "+a._s(a._f("dataHora")(a.campos.dataHoraAbertura))+" "),e("q-icon",{attrs:{name:"calendar_today"}}),e("br"),a._v("\n              "+a._s(a.campos.nomeUsuarioAbertura)+" "),e("q-icon",{attrs:{name:"person"}})],1)])]),e("q-field",{staticClass:"row q-mb-sm"},[e("q-select",{staticStyle:{"white-space":"pre-wrap !important"},attrs:{"float-label":"Histórico",options:a.documentoStatus,filter:""},on:{input:a.preencherConferencia},model:{value:a.idDocumentoStatus,callback:function(t){a.idDocumentoStatus=t},expression:"idDocumentoStatus"}})],1),a.carregando?e("div",{staticClass:"q-mt-lg text-center"},[e("q-spinner",{attrs:{color:"faded",size:50}})],1):a._e(),a.carregando?a._e():e("div",[e("div",{staticClass:"row justify-around"},[e("div",{staticClass:"col-auto"},[e("q-card-main",{staticClass:"q-pa-none text-tertiary text-center"},[a._v("\n                "+a._s(a._f("numero")(a.valorAberturaSistema,2))+"\n                "),e("q-tooltip",[a._v("Valor no sistema")])],1),e("q-toolbar-title",{staticClass:"q-display-1 text-weight-bold text-center",class:a.cor("abertura")},[a._v("\n                "+a._s(a._f("numero")(a.documentoCaixa.valorAbertura,2))+"\n                "),e("q-tooltip",[a._v("Valor digitado pelo usuário")])],1),e("q-card-main",{staticClass:"q-pa-none text-tertiary text-center"},[a._v("\n                "+a._s(a._f("numero")(a.diferencaAbertura,2))+"\n                "),e("q-tooltip",[a._v("Diferença")])],1),e("q-card-main",{staticClass:"q-pa-none text-tertiary text-center"},[a._v("\n                Abertura\n              ")])],1),e("div",{staticClass:"col-auto"},[e("q-card-main",{staticClass:"q-pa-none text-tertiary text-center"},[a._v(" ")]),e("q-toolbar-title",{staticClass:"q-display-1 text-weight-bold text-center",class:a.cor("fundo")},[a._v("\n                "+a._s(a._f("numero")(a.valorFechamento,2))+"\n                "),e("q-tooltip",[a._v("Valor digitado pelo usuário")])],1),e("q-card-main",{staticClass:"q-pa-none text-tertiary text-center"},[a._v(" ")]),e("q-card-main",{staticClass:"q-pa-none text-tertiary text-center"},[a._v("\n                Fechamento\n              ")])],1),a.acertoDinheiro?e("div",{staticClass:"col-auto"},[e("q-card-main",{staticClass:"q-pa-none text-tertiary text-center"},[a._v(" ")]),e("q-toolbar-title",{staticClass:"q-display-1 text-weight-bold text-center text-warning"},[a._v("\n                "+a._s(a._f("numero")(a.acertoDinheiro,2))+"\n              ")]),e("q-card-main",{staticClass:"q-pa-none text-tertiary text-center"},[a._v(" ")]),e("q-card-main",{staticClass:"q-pa-none text-tertiary text-center"},[a._v("\n                Acerto\n              ")])],1):a._e(),e("div",{staticClass:"col-auto"},[e("q-card-main",{staticClass:"q-pa-none text-tertiary text-center"},[a._v("\n                "+a._s(a._f("numero")(a.valorFundoCaixaSistema,2))+"\n                "),e("q-tooltip",[a._v("Valor no sistema")])],1),e("q-toolbar-title",{staticClass:"q-display-1 text-weight-bold text-center",class:a.cor("fundo")},[a._v("\n                "+a._s(a._f("numero")(a.valorFundoCaixa,2))+"\n              ")]),e("q-card-main",{staticClass:"q-pa-none text-tertiary text-center"},[a._v("\n                "+a._s(a._f("numero")(a.diferencaFundo,2))+"\n                "),e("q-tooltip",[a._v("Diferença")])],1),e("q-card-main",{staticClass:"q-pa-none text-tertiary text-center"},[a._v("\n                Fundo Caixa\n              ")])],1)]),a.suprimentos.length?e("q-card",{staticClass:"itemOk q-mt-md"},[e("div",{staticClass:"q-pr-md q-pl-xs q-pt-md"},[e("div",{staticClass:"row"},[e("q-toolbar-title",[a._v("\n                  Suprimentos\n                ")]),e("div",{staticClass:"q-pa-xs"},[e("badge",{staticClass:"q-mr-sm",attrs:{cor:"primary",escuro:""}},[a._v("\n                    "+a._s(a.suprimentos.length)+"\n                  ")])],1),e("div",{staticClass:"text-right q-headline text-positive text-weight-bold q-mb-sm"},[a._v("\n                  "+a._s(a._f("numero")(a.totalSuprimentos,2))+"\n                ")])],1)]),e("q-card-actions",{staticClass:"content-center justify-center q-mt-lg"},[a.mostrarSuprimentos?e("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{"margin-top":"-30px"},attrs:{outline:"",size:"sm",icon:"keyboard_arrow_up",color:"grey",label:"Ocultar Detalhes"},on:{click:function(t){a.mostrarSuprimentos=!a.mostrarSuprimentos}}}):a._e(),a.mostrarSuprimentos?a._e():e("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{"margin-top":"-30px"},attrs:{outline:"",size:"sm",icon:"keyboard_arrow_down",color:"grey",label:"Ver Detalhes"},on:{click:function(t){a.mostrarSuprimentos=!a.mostrarSuprimentos}}})],1),a.mostrarSuprimentos?e("div",{staticClass:"q-px-md q-pb-md"},[e("q-list",{staticClass:"q-pa-none",attrs:{highlight:""}},a._l(a.suprimentos,function(t){return e("q-item",{key:t.id,staticClass:"row u-separador q-my-none q-pa-xs"},[e("div",{staticClass:"col-9 col-lg-10 q-pl-sm"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 col-sm"},[a._v("\n                        "+a._s((a.usuarios[t.idContato]||{}).nome||"Nome não encontrado")+"\n                      ")]),e("div",{staticClass:"col-12 col-sm "},[a._v("\n                        "+a._s(t.documentoTipo)+"\n                      ")]),e("div",{staticClass:"col-12 col-sm"},[a._v("\n                        "+a._s(a._f("numero")(t.valorDebito,2))+"\n                      ")]),e("div",{staticClass:"col-12 col-sm"},[a._v("\n                        "+a._s(a._f("dataHora")(t.dataMovimento))+"\n                      ")])])])])}))],1):a._e()],1):a._e(),a.despesas.length?e("q-card",{staticClass:"itemOk q-mt-md"},[e("div",{staticClass:"q-pr-md q-pl-xs q-pt-md"},[e("div",{staticClass:"row"},[e("q-toolbar-title",[a._v("\n                  Despesas\n                ")]),e("div",{staticClass:"q-pa-xs"},[e("badge",{staticClass:"q-mr-sm",attrs:{cor:"primary",escuro:""}},[a._v("\n                    "+a._s(a.despesas.length)+"\n                  ")])],1),e("div",{staticClass:"text-right q-headline text-positive text-weight-bold q-mb-sm"},[a._v("\n                  "+a._s(a._f("numero")(a.totalDespesas,2))+"\n                ")])],1)]),e("q-card-actions",{staticClass:"content-center justify-center q-mt-lg"},[a.mostrarDespesas?e("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{"margin-top":"-30px"},attrs:{outline:"",size:"sm",icon:"keyboard_arrow_up",color:"grey",label:"Ocultar Detalhes"},on:{click:function(t){a.mostrarDespesas=!a.mostrarDespesas}}}):a._e(),a.mostrarDespesas?a._e():e("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{"margin-top":"-30px"},attrs:{outline:"",size:"sm",icon:"keyboard_arrow_down",color:"grey",label:"Ver Detalhes"},on:{click:function(t){a.mostrarDespesas=!a.mostrarDespesas}}})],1),a.mostrarDespesas?e("div",{staticClass:"q-px-md q-pb-md"},[e("q-list",{staticClass:"q-pa-none",attrs:{highlight:""}},a._l(a.despesas,function(t){return e("q-item",{key:t.id,staticClass:"row u-separador q-my-none q-pa-xs"},[e("div",{staticClass:"col-9 col-lg-10 q-pl-sm"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 col-sm"},[a._v("\n                        "+a._s((a.contatos[t.idContato]||{}).nome||"Nome não encontrado")+"\n                      ")]),e("div",{staticClass:"col-12 col-sm "},[a._v("\n                        "+a._s(t.documentoTipo)+"\n                      ")]),e("div",{staticClass:"col-12 col-sm"},[a._v("\n                        "+a._s(a._f("numero")(t.valorRealizado,2))+"\n                      ")]),e("div",{staticClass:"col-12 col-sm"},[a._v("\n                        "+a._s(a._f("dataHora")(t.dataMovimento))+"\n                      ")])])])])}))],1):a._e()],1):a._e(),e("q-card",{staticClass:"itemOk q-my-md"},[e("div",{staticClass:"q-pr-md q-pl-xs q-pt-md"},[e("div",{staticClass:"row"},[e("q-toolbar-title",[a._v("\n                  Dinheiro\n                ")]),e("div",{staticClass:"q-pa-xs"},[e("badge",{staticClass:"q-mr-sm",attrs:{cor:"primary",escuro:""}},[a._v("\n                    "+a._s(a.dinheiro.length)+"\n                  ")])],1),e("div",{staticClass:"text-right q-headline text-positive text-weight-bold q-mb-sm"},[a._v("\n                  "+a._s(a._f("numero")((a.totaisFormasPagamento[(a.dinheiro[0]||{}).idFormaPagamento]||{}).totalSistema,2))+"\n                ")])],1)]),a.dinheiro.length?e("q-card-actions",{staticClass:"content-center justify-center q-mt-lg"},[a.mostrarDinheiro?e("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{"margin-top":"-30px"},attrs:{outline:"",size:"sm",icon:"keyboard_arrow_up",color:"grey",label:"Ocultar Detalhes"},on:{click:function(t){a.mostrarDinheiro=!a.mostrarDinheiro}}}):a._e(),a.mostrarDinheiro?a._e():e("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{"margin-top":"-30px"},attrs:{outline:"",size:"sm",icon:"keyboard_arrow_down",color:"grey",label:"Ver Detalhes"},on:{click:function(t){a.mostrarDinheiro=!a.mostrarDinheiro}}})],1):a._e(),a.mostrarDinheiro?e("div",{staticClass:"q-px-md q-pb-md"},[e("q-list",{staticClass:"q-pa-none",attrs:{highlight:""}},a._l(a.dinheiro,function(t){return e("q-item",{key:t.id,staticClass:"row u-separador q-my-none q-pa-xs"},[e("div",{staticClass:"col-9 col-lg-10 q-pl-sm"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 col-sm"},[a._v("\n                        "+a._s(a.documentos[t.idDocumento].descricaoContato)+"\n                        "),e("badge",{staticClass:"q-mx-sm",attrs:{cor:"primary",escuro:""}},[a._v("#"+a._s(a.documentos[t.idDocumento].numero))])],1),e("div",{staticClass:"col-12 col-sm "},[a._v("\n                        Dinheiro\n                      ")]),e("div",{staticClass:"col-12 col-sm"},[a._v("\n                        "+a._s(a._f("numero")(t.valor,2))+"\n                      ")]),e("div",{staticClass:"col-12 col-sm"},[a._v("\n                        "+a._s(a._f("data")(t.dataVencimento))+"\n                      ")])])])])}))],1):a._e()],1),a.sangrias.length?e("q-card",{staticClass:"itemOk q-my-md q-mb-xl"},[e("div",{staticClass:"q-pr-md q-pl-xs q-pt-md"},[e("div",{staticClass:"row"},[e("q-toolbar-title",[a._v("\n                  Sangrias\n                ")]),e("div",{staticClass:"q-pa-xs"},[e("badge",{staticClass:"q-mr-sm",attrs:{cor:"primary",escuro:""}},[a._v("\n                    "+a._s(a.sangrias.length)+"\n                  ")])],1),e("div",{staticClass:"text-right q-headline text-positive text-weight-bold q-mb-sm"},[a._v("\n                  "+a._s(a._f("numero")(a.totalSangrias,2))+"\n                ")])],1)]),e("q-card-actions",{staticClass:"content-center justify-center q-mt-lg"},[a.mostrarSangrias?e("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{"margin-top":"-30px"},attrs:{outline:"",size:"sm",icon:"keyboard_arrow_up",color:"grey",label:"Ocultar Detalhes"},on:{click:function(t){a.mostrarSangrias=!a.mostrarSangrias}}}):a._e(),a.mostrarSangrias?a._e():e("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{"margin-top":"-30px"},attrs:{outline:"",size:"sm",icon:"keyboard_arrow_down",color:"grey",label:"Ver Detalhes"},on:{click:function(t){a.mostrarSangrias=!a.mostrarSangrias}}})],1),a.mostrarSangrias?e("div",{staticClass:"q-px-md q-pb-md"},[e("q-list",{staticClass:"q-pa-none",attrs:{highlight:""}},a._l(a.sangrias,function(t){return e("q-item",{key:t.id,staticClass:"row u-separador q-my-none q-pa-xs"},[e("div",{staticClass:"col-9 col-lg-10 q-pl-sm"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 col-sm"},[a._v("\n                        "+a._s((a.usuarios[t.idContato]||{}).nome||"Nome não encontrado")+"\n                      ")]),e("div",{staticClass:"col-12 col-sm "},[a._v("\n                        "+a._s(t.documentoTipo)+"\n                      ")]),e("div",{staticClass:"col-12 col-sm"},[a._v("\n                        "+a._s(a._f("numero")(t.valorCredito,2))+"\n                      ")]),e("div",{staticClass:"col-12 col-sm"},[a._v("\n                        "+a._s(a._f("dataHora")(t.dataMovimento))+"\n                      ")])])])])}))],1):a._e()],1):a._e(),a.acertos.length||a.formasPagamento.filter(function(t){return 1!==t.tipo&&(a.outrasFormasPagamento[t.id]||(a.totaisFormasPagamento[t.id]||{}).totalInformadoUsuario)}).length?e("div",{staticClass:"q-title"},[a._v("\n            Outras formas de pagamento\n          ")]):a._e(),a.acertos.length?e("q-card",{staticClass:"itemWarning q-mt-md"},[e("div",{staticClass:"q-pr-md q-pl-xs q-pt-md"},[e("div",{staticClass:"row"},[e("q-toolbar-title",[a._v("\n                  Acertos\n                ")]),e("div",{staticClass:"text-right q-headline text-warning text-weight-bold q-mb-sm"},[a._v("\n                  "+a._s(a._f("numero")(a.totalAcertos,2))+"\n                ")])],1)]),e("div",{staticClass:"q-px-md q-pb-md"},[e("q-list",{staticClass:"q-pa-none",attrs:{highlight:""}},a._l(a.acertos,function(t,o){return e("q-item",{key:o,staticClass:"row u-separador q-my-none q-pa-xs"},[e("div",{staticClass:"col-9 col-lg-10 q-pl-sm"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 col-sm"},[a._v("\n                        "+a._s(t.descricao)+"\n                      ")]),e("div",{staticClass:"col-12 col-sm"},[a._v("\n                        "+a._s(a._f("numero")(t.valor,2))+"\n                      ")])])])])}))],1)]):a._e(),a._l(a.formasPagamento.filter(function(t){return 1!==t.tipo&&(a.outrasFormasPagamento[t.id]||(a.totaisFormasPagamento[t.id]||{}).totalInformadoUsuario)}),function(t){return e("q-card",{key:t.id,staticClass:"q-mt-md",class:a.cor("outraFormaPagamento","card",t.id)},[e("div",{staticClass:"q-pr-md q-pl-xs q-pt-md"},[e("div",{staticClass:"row"},[e("q-toolbar-title",[a._v("\n                  "+a._s(t.descricao)+"\n                ")]),e("div",{staticClass:"q-pa-xs"},[e("badge",{staticClass:"q-mr-sm",attrs:{cor:"primary",escuro:""}},[a._v("\n                    "+a._s(a.outrasFormasPagamento[t.id]?(a.outrasFormasPagamento[t.id]||[]).length:0)+"\n                  ")])],1),e("div",{staticClass:"text-right q-headline text-weight-bold q-mb-sm",class:a.cor("outraFormaPagamento","",t.id)},[e("span",[a._v("\n                    "+a._s(a._f("numero")((a.totaisFormasPagamento[t.id]||{}).totalInformadoUsuario,2))+"\n                    "),e("q-tooltip",[a._v("Digitado pelo usuário")])],1),e("p",{staticClass:"text-weight-normal text-tertiary q-body-1 q-pa-none q-ma-none"},[a._v("\n                    "+a._s(a._f("numero")((a.totaisFormasPagamento[t.id]||{}).totalSistema-(a.totaisFormasPagamento[t.id]||{}).totalInformadoUsuario,2))+"\n                    "),e("q-tooltip",[a._v("Diferença")])],1)])],1)]),a.outrasFormasPagamento[t.id]?e("q-card-actions",{staticClass:"content-center justify-center q-mt-lg"},[t.mostrar?e("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{"margin-top":"-30px"},attrs:{outline:"",size:"sm",icon:"keyboard_arrow_up",color:"grey",label:"Ocultar Detalhes"},on:{click:function(a){t.mostrar=!t.mostrar}}}):a._e(),t.mostrar?a._e():e("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{"margin-top":"-30px"},attrs:{outline:"",size:"sm",icon:"keyboard_arrow_down",color:"grey",label:"Ver Detalhes"},on:{click:function(a){t.mostrar=!t.mostrar}}})],1):a._e(),t.mostrar?e("div",{staticClass:"q-px-md q-pb-md"},[e("q-list",{staticClass:"q-pa-none",attrs:{highlight:""}},a._l(a.outrasFormasPagamento[t.id],function(t){return e("q-item",{key:t.id,staticClass:"row u-separador q-my-none q-pa-xs"},[e("div",{staticClass:"col-9 col-lg-10 q-pl-sm"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 col-sm"},[a._v("\n                        "+a._s(a.documentos[t.idDocumento].descricaoContato)+"\n                        "),e("badge",{staticClass:"q-mx-sm",attrs:{cor:"primary",escuro:""}},[a._v("\n                          #"+a._s(a.documentos[t.idDocumento].id.slice(-6)))])],1),e("div",{staticClass:"col-12 col-sm"},[a._v("\n                        "+a._s(a._f("numero")(t.valor,2))+"\n                      ")]),e("div",{staticClass:"col-12 col-sm"},[a._v("\n                        "+a._s(a._f("data")(t.dataVencimento))+"\n                      ")])])])])}))],1):a._e()],1)})],2)],1)]),e("q-toolbar",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[e("q-toolbar-title",{staticClass:"text-right"},[a.visibilidade.botao.reabrir?e("q-btn",{attrs:{color:"negative",flat:"",label:"Reabrir"},on:{click:a.reabrir}}):a._e(),a.visibilidade.botao.finalizar?e("q-btn",{staticClass:"q-ml-sm no-shadow",attrs:{color:"primary",label:"finalizar"},on:{click:a.finalizar}}):a._e(),a.visibilidade.botao.fechar?e("q-btn",{staticClass:"q-ml-sm no-shadow",attrs:{color:"primary",label:"refechar caixa"},on:{click:a.fechar}}):a._e()],1)],1)],1),e("fatura-modal",{attrs:{id:a.faturaModal.id},model:{value:a.faturaModal.visivel,callback:function(t){a.$set(a.faturaModal,"visivel",t)},expression:"faturaModal.visivel"}}),e("venda-modal",{attrs:{id:a.vendaModal.id},model:{value:a.vendaModal.visivel,callback:function(t){a.$set(a.vendaModal,"visivel",t)},expression:"vendaModal.visivel"}}),e("caixa-fechar",{attrs:{idDocumentoCaixa:a.documentoCaixa.id},on:{fechado:a.atualizar},model:{value:a.caixaFecharModal,callback:function(t){a.caixaFecharModal=t},expression:"caixaFecharModal"}})],1)},f=[];v._withStripped=!0;e("cadf"),e("c5f6"),e("7cdf");var p=e("3156"),h=e.n(p),b=e("f377"),x=e("c865"),C=e("2335"),g=e("8149"),q=e("ed08"),_=e("2ef0"),F={components:{Badge:m["a"],CaixaFechar:b["a"],FaturaModal:x["a"],VendaModal:C["a"]},data:function(){return{documentoCaixa:{},mostrarDinheiro:!1,idDocumentoStatus:"",documentoStatus:[],caixa:{},campos:{},dinheiro:{},acertoDinheiro:0,acertos:[],totalAcertos:0,totalDinheiro:0,formasPagamento:[],totaisFormasPagamento:{},outrasFormasPagamento:{},condicoesPagamentoFechamento:{},valorAberturaSistema:0,valorFundoCaixa:0,valorFundoCaixaSistema:0,valorFechamento:0,diferencaFundo:0,diferencaAbertura:0,contatos:{},usuarios:{},documentos:{},mostrarSangrias:!1,sangrias:[],totalSangrias:0,mostrarDespesas:!1,despesas:[],totalDespesas:0,mostrarSuprimentos:!1,suprimentos:[],totalSuprimentos:0,visivel:!1,edicao:!1,carregando:!0,faturaModal:{visivel:!1,id:""},vendaModal:{visivel:!1,id:""},caixaFecharModal:!1,visibilidade:{botao:{reabrir:!1,finalizar:!1}},atualizarAoFecharModal:!1}},methods:{aoFecharModal:function(){this.atualizarAoFecharModal&&this.$emit("executar","atualizar")},obterDivergencias:function(){var a=[],t=Object(q["arredondar"])(this.diferencaAbertura-this.diferencaFundo);if(t){var e=this.formasPagamento.filter(function(a){return 1===a.tipo});e.length&&(e=e[0],a.push(h()({},e,{diferenca:t})))}var o=!0,i=!1,r=void 0;try{for(var n,s=this.formasPagamento.filter(function(a){return 1!==a.tipo&&"Título Liquidado"===a.tipoFinanceiro})[Symbol.iterator]();!(o=(n=s.next()).done);o=!0){var c=n.value,d=(this.totaisFormasPagamento[c.id]||{}).totalSistema||0,u=(this.totaisFormasPagamento[c.id]||{}).totalInformadoUsuario||0;t=Object(q["arredondar"])(d-u),t&&a.push(h()({},c,{diferenca:t}))}}catch(a){i=!0,r=a}finally{try{o||null==s.return||s.return()}finally{if(i)throw r}}return a},cor:function(a,t,e){var o=(this.totaisFormasPagamento[e]||{}).totalSistema||0,i=(this.totaisFormasPagamento[e]||{}).totalInformadoUsuario||0,r=Object(q["arredondar"])(o-i);if("card"===t){switch(a){case"outraFormaPagamento":if(r)return"itemError";break}return"itemOk"}switch(a){case"abertura":if(this.diferencaAbertura)return"text-negative";break;case"fundo":if(this.diferencaFundo)return"text-negative";break;case"outraFormaPagamento":if(r)return"text-negative";break}return"text-blue-8"},abrirModalDocumento:function(){var a=c()(regeneratorRuntime.mark(function a(t){var e;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,g["a"].documento.le({id:t});case 2:e=a.sent,"Fatura"===e.tipo&&(this.faturaModal={visivel:!0,id:t}),"Venda"===e.tipo&&(this.vendaModal={visivel:!0,id:t});case 5:case"end":return a.stop()}},a,this)}));return function(t){return a.apply(this,arguments)}}(),atualizar:function(){var a=c()(regeneratorRuntime.mark(function a(){var t,e,o,i,r,n,s,c,d,u,l,m,v,f,p,h,b,x,C=this;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,this.$q.loading.show({message:"Processando..."}),a.next=4,g["a"].documento.le({id:this.idDocumentoCaixa});case 4:return this.documentoCaixa=a.sent,a.next=7,g["a"].caixa.le({id:this.documentoCaixa.idCaixa});case 7:return this.caixa=a.sent,a.next=10,g["a"].contato.le({id:this.documentoCaixa.idEmpresa});case 10:return t=a.sent,a.next=13,g["a"].usuario.le({id:this.documentoCaixa.idContato});case 13:return e=a.sent,a.next=16,g["a"].documentoStatus.le({idDocumento:this.documentoCaixa.id});case 16:o=a.sent,o=Object(_["orderBy"])(o,"dataHoraEmissao","desc"),o.pop(),this.visibilidade={botao:{reabrir:!1,finalizar:!1,fechar:!1}},a.t0=o[0].statusFinalizado,a.next="Aguardando Conferência"===a.t0?23:"Reaberto"===a.t0?26:"Fechado"===a.t0?28:30;break;case 23:return this.visibilidade.botao.reabrir=!0,this.visibilidade.botao.finalizar=!0,a.abrupt("break",30);case 26:return this.visibilidade.botao.fechar=!0,a.abrupt("break",30);case 28:return this.visibilidade.botao.reabrir=!0,a.abrupt("break",30);case 30:i={},r=!0,n=!1,s=void 0,a.prev=34,c=o[Symbol.iterator]();case 36:if(r=(d=c.next()).done){a.next=45;break}if(u=d.value,i[u.idUsuarioAlterou]){a.next=42;break}return a.next=41,g["a"].usuario.le({id:u.idUsuarioAlterou});case 41:i[u.idUsuarioAlterou]=a.sent;case 42:r=!0,a.next=36;break;case 45:a.next=51;break;case 47:a.prev=47,a.t1=a["catch"](34),n=!0,s=a.t1;case 51:a.prev=51,a.prev=52,r||null==c.return||c.return();case 54:if(a.prev=54,!n){a.next=57;break}throw s;case 57:return a.finish(54);case 58:return a.finish(51);case 59:return this.documentoStatus=o.map(function(a){return{label:"".concat(a.statusFinalizado," - ").concat(C.$filters.dataHora(a.dataHoraEmissao)," - ").concat(i[a.idUsuarioAlterou].nome),value:a.id,statusFinalizado:a.statusFinalizado}}),this.idDocumentoStatus=this.documentoStatus[0].value,this.campos.caixaEmpresaNome=t.nome,this.campos.dataHoraAbertura=this.documentoCaixa.dataHoraEmissao,this.campos.nomeUsuarioAbertura=e.nome,a.next=66,g["a"].financeiroMovimentacao.le({idDocumentoCaixa:this.documentoCaixa.id,idFinanceiroPlanoConta:this.caixa.idPlanoConta});case 66:if(l=a.sent,l=Object(_["orderBy"])(l,["dataMovimento","ordem"],["asc","asc"]),this.valorAberturaSistema=0,a.prev=69,!l.length){a.next=80;break}return m="select top 1 valorSaldo - valorDebito + valorCredito valorSaldo\n            from financeiroMovimentacao\n            where idDocumentoCaixa = ".concat(Object(q["sqlStr"])(this.documentoCaixa.id),"\n              and idFinanceiroPlanoConta = ").concat(Object(q["sqlStr"])(this.caixa.idPlanoConta),"\n            order by DataMovimento asc, ordem asc"),a.next=74,Object(q["executarSql"])(m);case 74:v=a.sent,f=l[0].valorDebito||0,p=l[0].valorCredito||0,v.length?this.valorAberturaSistema=Object(q["arredondar"])(v[0].valorSaldo||0):(h=l[0].valorSaldo||0,this.valorAberturaSistema=Object(q["arredondar"])(h-f+p)),a.next=85;break;case 80:return b="declare @codigoFinanceiroPlanoConta int = (select codigoFinanceiroPlanoConta from financeiroPlanoConta where id = ".concat(Object(q["sqlStr"])(this.caixa.idPlanoConta),")\n            declare @codigoEmpresa int = (select codigoEmpresa from documento where id = ").concat(Object(q["sqlStr"])(this.documentoCaixa.id),")\n            declare @dataAbertura varchar(10) = (select format(cast(dataHoraEmissao as date), 'dd/MM/yyyy') dataAbertura from documento where id = ").concat(Object(q["sqlStr"])(this.documentoCaixa.id),")\n\n            if (@codigoFinanceiroPlanoConta is not null and @codigoEmpresa is not null and @dataAbertura is not null)\n              exec sp_financeiroMovimentacao_calcula_saldoPeriodo @codigoFinanceiroPlanoConta, @codigoEmpresa, 'DataPagamento', @dataAbertura, @dataAbertura, 0"),a.next=83,Object(q["executarSql"])(b);case 83:x=a.sent,x.length&&(this.valorAberturaSistema=Object(q["arredondar"])(x[x.length-1].ValorSaldo||0));case 85:a.next=90;break;case 87:a.prev=87,a.t2=a["catch"](69),this.$q.notifyError("Não foi possível obter o saldo inicial do caixa.");case 90:this.diferencaAbertura=Object(q["arredondar"])(((this.documentoCaixa||{}).valorAbertura||0)-this.valorAberturaSistema),this.$q.loading.hide(),this.visivel=!0,this.preencherConferencia(),a.next=99;break;case 96:a.prev=96,a.t3=a["catch"](0),this.$q.notifyError("Não foi possível abrir a conferência.",a.t3);case 99:return a.prev=99,this.$q.loading.hide(),a.finish(99);case 102:case"end":return a.stop()}},a,this,[[0,96,99,102],[34,47,51,59],[52,,54,58],[69,87]])}));return function(){return a.apply(this,arguments)}}(),fechar:function(){this.caixaFecharModal=!0},finalizar:function(){var a=c()(regeneratorRuntime.mark(function a(){var t,e,o,i,r,n,s,c,d,u,l,m,v,f,p,b,x,C,_,F,k,D,y,w,P,O,j,E,S,M;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,t=this.obterDivergencias(),e="Deseja finalizar a conferência?",o="Deseja finalizar a conferência e lançar movimentações financeiras para acertar as divergências?",a.prev=4,a.next=7,this.$q.dialog({cancel:"Cancelar",message:t.length?o:e,noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 7:this.$q.loading.show({message:"Processando..."}),a.next=13;break;case 10:return a.prev=10,a.t0=a["catch"](4),a.abrupt("return");case 13:if(i=Object(q["dataAtual"])(),r=[],n=[],!t.length){a.next=53;break}return a.next=19,g["a"].documentoStatus.le({idDocumento:this.documentoCaixa.id});case 19:return s=a.sent,s=s.filter(function(a){return"Fechamento Caixa"===a.operacao&&"Aguardando Conferência"===a.statusFinalizado&&"Aberto"===a.statusOriginal}),c=s.length?s[0].dataHoraEmissao:i,a.next=24,g["a"].configuracoes.le({nome:"financeiro.planocontas.diferencacaixa"});case 24:if(d=a.sent,!d.length){a.next=31;break}if(u=parseInt(d[0].valor),!Number.isInteger(u)){a.next=31;break}return a.next=30,g["a"].financeiroPlanoConta.le({codigoFinanceiroPlanoConta:u});case 30:d=a.sent;case 31:if((d||{}).id){a.next=34;break}return this.$q.notify("Faltando parâmetro da conta Diferença de Caixa."),a.abrupt("return");case 34:for(l=!0,m=!1,v=void 0,a.prev=37,f=t[Symbol.iterator]();!(l=(p=f.next()).done);l=!0)b=p.value,x=Object(q["uuid"])(),n.push(x),r.push({id:Object(q["uuid"])(),idFinanceiroMovimentacaoN:x,idEmpresa:this.documentoCaixa.idEmpresa,idContato:g["a"].usuario.logado.id,idFinanceiroPlanoConta:d.id,valorDebito:b.diferenca>0?b.diferenca:0,valorCredito:b.diferenca<0?Math.abs(b.diferenca):0,dataEmissao:i,dataCompetencia:c,dataVencimento:c,dataMovimento:c,descricao:"Acerto do caixa #".concat(this.documentoCaixa.id," Conta ").concat(b.descricao),observacao:"Transferência entre contas",documentoTipo:"Acerto",documentoId:this.documentoCaixa.id,idDocumentoCaixa:this.documentoCaixa.id}),r.push({id:Object(q["uuid"])(),idFinanceiroMovimentacaoN:x,idEmpresa:this.documentoCaixa.idEmpresa,idContato:g["a"].usuario.logado.id,idFinanceiroPlanoConta:1===b.tipo?this.documentoCaixa.idFinanceiroPlanoContaCaixa:b.idFinanceiroPlanoConta,valorDebito:b.diferenca<0?Math.abs(b.diferenca):0,valorCredito:b.diferenca>0?b.diferenca:0,dataEmissao:i,dataCompetencia:c,dataVencimento:c,dataMovimento:c,descricao:"Acerto do caixa #".concat(this.documentoCaixa.id," Conta ").concat(b.descricao),observacao:"Transferência entre contas",documentoTipo:"Acerto",documentoId:this.documentoCaixa.id,idDocumentoCaixa:this.documentoCaixa.id});a.next=45;break;case 41:a.prev=41,a.t1=a["catch"](37),m=!0,v=a.t1;case 45:a.prev=45,a.prev=46,l||null==f.return||f.return();case 48:if(a.prev=48,!m){a.next=51;break}throw v;case 51:return a.finish(48);case 52:return a.finish(45);case 53:return C={id:Object(q["uuid"])(),idDocumento:this.documentoCaixa.id,operacao:"Conferência Finalizada",statusOriginal:"Aguardando Conferência",statusFinalizado:"Fechado",dataHoraEmissao:i,idUsuarioAlterou:g["a"].usuario.logado.id,idDocumentoCaixa:this.documentoCaixa.id},_=Object(q["clonar"])(this.documentoCaixa),_.status="Fechado",a.next=58,g["a"].caixaConsolidacao2.le({idDocumentoStatus:this.documentoStatus[0].value});case 58:return F=a.sent,F=F.map(function(a){return h()({},a,{id:Object(q["uuid"])(),idDocumentoStatus:C.id,dataHoraEmissao:i})}),a.next=62,g["a"].documento.grava({atual:_,original:this.documentoCaixa});case 62:return a.next=64,g["a"].documentoStatus.grava({atual:C});case 64:k=0;case 65:if(!(k<n.length)){a.next=72;break}return D=n[k],a.next=69,g["a"].financeiroMovimentacaoN.grava({atual:{id:D}});case 69:k++,a.next=65;break;case 72:y=0;case 73:if(!(y<r.length)){a.next=81;break}return w=r[y],F.push({id:Object(q["uuid"])(),idDocumentoCaixa:_.id,idDocumentoStatus:C.id,tabela:"financeiroMovimentacao",idTabela:w.id,json:JSON.stringify(w),dataHoraEmissao:i}),a.next=78,g["a"].financeiroMovimentacao.grava({atual:w});case 78:y++,a.next=73;break;case 81:P=!0,O=!1,j=void 0,a.prev=84,E=F[Symbol.iterator]();case 86:if(P=(S=E.next()).done){a.next=93;break}return M=S.value,a.next=90,g["a"].caixaConsolidacao2.grava({atual:M});case 90:P=!0,a.next=86;break;case 93:a.next=99;break;case 95:a.prev=95,a.t2=a["catch"](84),O=!0,j=a.t2;case 99:a.prev=99,a.prev=100,P||null==E.return||E.return();case 102:if(a.prev=102,!O){a.next=105;break}throw j;case 105:return a.finish(102);case 106:return a.finish(99);case 107:this.$q.loading.hide(),this.$emit("executar","atualizar"),this.visivel=!1,this.$q.notify({message:"Conferência finalizada.",type:"positive"}),a.next=116;break;case 113:a.prev=113,a.t3=a["catch"](0),this.$q.notifyError("Não foi possível finalizar a conferência.",a.t3);case 116:return a.prev=116,this.$q.loading.hide(),a.finish(116);case 119:case"end":return a.stop()}},a,this,[[0,113,116,119],[4,10],[37,41,45,53],[46,,48,52],[84,95,99,107],[100,,102,106]])}));return function(){return a.apply(this,arguments)}}(),preencherConferencia:function(){var a=c()(regeneratorRuntime.mark(function a(){var t,e,o,i,r,n,s,c,d,u,l,m,v,f,p,b,x,C,_,F,k=this;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return this.carregando=!0,a.next=3,Object(q["dormir"])(500);case 3:return this.refreshData(),a.next=6,g["a"].caixaConsolidacao2.le({idDocumentoStatus:this.idDocumentoStatus});case 6:t=a.sent,t=t.map(function(a){return h()({},a,{json:JSON.parse(a.json)})}),e={},o={},i=!0,r=!1,n=void 0,a.prev=13,s=t[Symbol.iterator]();case 15:if(i=(c=s.next()).done){a.next=28;break}if(d=c.value,!d.json.idContato||["Sangria Final","Sangria","Suprimento"].includes(d.json.documentoTipo)||e[d.json.idContato]){a.next=21;break}return a.next=20,g["a"].contato.le({id:d.json.idContato});case 20:e[d.json.idContato]=a.sent;case 21:if(!d.json.idContato||!["Sangria Final","Sangria","Suprimento"].includes(d.json.documentoTipo)||o[d.json.idContato]){a.next=25;break}return a.next=24,g["a"].usuario.le({id:d.json.idContato});case 24:o[d.json.idContato]=a.sent;case 25:i=!0,a.next=15;break;case 28:a.next=34;break;case 30:a.prev=30,a.t0=a["catch"](13),r=!0,n=a.t0;case 34:a.prev=34,a.prev=35,i||null==s.return||s.return();case 37:if(a.prev=37,!r){a.next=40;break}throw n;case 40:return a.finish(37);case 41:return a.finish(34);case 42:return this.contatos=e,this.usuarios=o,u=t.filter(function(a){return"financeiroMovimentacao"===a.tabela&&"Acerto"===a.json.documentoTipo}).map(function(a){return a.json}),l=t.filter(function(a){return"financeiroTitulo"===a.tabela}).map(function(a){return a.json}),m=t.filter(function(a){return"financeiroMovimentacao"===a.tabela}).map(function(a){return a.json}),this.sangrias=m.filter(function(a){return["Sangria","Sangria Final"].includes(a.documentoTipo)&&a.valorCredito>0}),this.totalSangrias=Object(q["arredondar"])(this.sangrias.reduce(function(a,t){return a+(t.valorCredito||0)},0)),this.suprimentos=m.filter(function(a){return"Suprimento"===a.documentoTipo&&a.valorDebito>0}),this.totalSuprimentos=Object(q["arredondar"])(this.suprimentos.reduce(function(a,t){return a+(t.valorDebito||0)},0)),v=m.filter(function(a){return"DespesaSimples"===a.documentoTipo&&a.valorCredito>0}),this.despesas=l.filter(function(a){return v.find(function(t){return t.idFinanceiroMovimentacaoN===a.idFinanceiroMovimentacaoAgrupamento})}),this.totalDespesas=Object(q["arredondar"])(this.despesas.reduce(function(a,t){return a+(t.valorRealizado||0)},0)),a.next=56,g["a"].formaPagamento.le();case 56:for(C in a.t1=function(a){return{id:a.id,idFinanceiroPlanoConta:a.idFinanceiroPlanoConta,tipoFinanceiro:a.tipoFinanceiro,tipo:a.tipo,descricao:a.descricao,mostrar:!1}},this.formasPagamento=a.sent.map(a.t1),f=t.filter(function(a){return"documentoCondicaoPagamento"===a.tabela&&a.json.ordem}).map(function(a){return a.json}),this.valorFechamento=Object(q["arredondar"])(f.reduce(function(a,t){return k.formasPagamento.find(function(a){return a.id===t.idFormaPagamento&&a.idFinanceiroPlanoConta===k.caixa.idPlanoConta})&&(a+=t.valor||0),a},0)),this.condicoesPagamentoFechamento=f.reduce(function(a,t){return a[t.idFormaPagamento]=t,a},{}),p=t.filter(function(a){return"documentoCondicaoPagamento"===a.tabela&&!a.json.ordem}).map(function(a){return a.json}),this.dinheiro=p.reduce(function(a,t){return k.formasPagamento.find(function(a){return a.id===t.idFormaPagamento&&a.idFinanceiroPlanoConta===k.caixa.idPlanoConta})&&a.push(t),a},[]),this.totalDinheiro=Object(q["arredondar"])(this.dinheiro.reduce(function(a,t){return a+(t.valor||0)},0)),this.valorFundoCaixa=Object(q["arredondar"])(this.valorFechamento-this.sangrias.filter(function(a){return"Sangria Final"===a.documentoTipo}).reduce(function(a,t){return a+(t.valorCredito||0)},0)),b=this.valorAberturaSistema+this.totalDinheiro-this.totalSangrias-this.totalDespesas+this.totalSuprimentos,this.diferencaFundo=Object(q["arredondar"])(this.valorFundoCaixa-b),this.acertoDinheiro=u.filter(function(a){return a.idFinanceiroPlanoConta===k.documentoCaixa.idFinanceiroPlanoContaCaixa}).reduce(function(a,t){return a+(t.valorDebito||0)-(t.valorCredito||0)},0),this.valorFundoCaixaSistema=Object(q["arredondar"])(b+this.acertoDinheiro),this.acertoDinheiro=Object(q["arredondar"])(-1*this.acertoDinheiro),this.outrasFormasPagamento=p.reduce(function(a,t){return!a[t.idFormaPagamento]&&k.formasPagamento.find(function(a){return a.id===t.idFormaPagamento&&a.idFinanceiroPlanoConta!==k.caixa.idPlanoConta})&&(a[t.idFormaPagamento]=[]),a[t.idFormaPagamento]&&a[t.idFormaPagamento].push(t),a},{}),x=p.reduce(function(a,t){return a[t.idFormaPagamento]||(a[t.idFormaPagamento]={totalInformadoUsuario:0}),a[t.idFormaPagamento]&&(void 0===a[t.idFormaPagamento].totalSistema?a[t.idFormaPagamento].totalSistema=t.valor||0:a[t.idFormaPagamento].totalSistema+=t.valor||0),a},{}),x=f.reduce(function(a,t){return a[t.idFormaPagamento]||(a[t.idFormaPagamento]={totalSistema:0}),a[t.idFormaPagamento]&&(void 0===a[t.idFormaPagamento].totalInformadoUsuario?a[t.idFormaPagamento].totalInformadoUsuario=t.valor||0:a[t.idFormaPagamento].totalInformadoUsuario+=t.valor||0),a},x),x)x[C].totalSistema=Object(q["arredondar"])(x[C].totalSistema),x[C].totalInformadoUsuario=Object(q["arredondar"])(x[C].totalInformadoUsuario);this.totaisFormasPagamento=x,_=p.reduce(function(a,t){return a[t.idDocumento]||(a[t.idDocumento]={}),a},{}),a.t2=regeneratorRuntime.keys(_);case 77:if((a.t3=a.t2()).done){a.next=84;break}return F=a.t3.value,a.next=81,g["a"].documento.le({id:F});case 81:_[F]=a.sent,a.next=77;break;case 84:this.documentos=_,this.acertos=u.filter(function(a){return a.idFinanceiroPlanoConta!==k.documentoCaixa.idFinanceiroPlanoContaCaixa}).reduce(function(a,t){var e=k.formasPagamento.find(function(a){return a.idFinanceiroPlanoConta===t.idFinanceiroPlanoConta});return e&&a.push({descricao:e.descricao,valor:Object(q["arredondar"])((t.valorCredito||0)-(t.valorDebito||0))}),a},[]),this.totalAcertos=Object(q["arredondar"])(this.acertos.reduce(function(a,t){return a+t.valor},0)),this.carregando=!1;case 88:case"end":return a.stop()}},a,this,[[13,30,34,42],[35,,37,41]])}));return function(){return a.apply(this,arguments)}}(),reabrir:function(){var a=c()(regeneratorRuntime.mark(function a(){var t,e,o,i,r,s,c,d,u,l,m,v,f;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.prev=1,a.next=4,this.$q.dialog({cancel:"Cancelar",message:"Deseja reabrir o caixa para correção?",noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 4:this.$q.loading.show({message:"Processando..."}),a.next=10;break;case 7:return a.prev=7,a.t0=a["catch"](1),a.abrupt("return");case 10:return t=Object(q["dataAtual"])(),e=Object(q["clonar"])(this.documentoCaixa),a.next=14,g["a"].caixaConsolidacao2.le({idDocumentoStatus:this.documentoStatus[0].value});case 14:return o=a.sent,o=o.map(function(a){return h()({},a,{json:JSON.parse(a.json)})}),i=o.filter(function(a){return"financeiroMovimentacao"===a.tabela}).map(function(a){return a.json}),r=i.filter(function(a){return"Sangria Final"===a.documentoTipo}),s=i.filter(function(a){return"Acerto"===a.documentoTipo}),c={id:Object(q["uuid"])(),idDocumento:e.id,operacao:"Fechamento Caixa",statusOriginal:this.documentoStatus[0].statusFinalizado,statusFinalizado:"Reaberto",dataHoraEmissao:t,idUsuarioAlterou:g["a"].usuario.logado.id,idDocumentoCaixa:e.id},o=o.filter(function(a){return!["Sangria Final","Acerto"].includes(a.json.documentoTipo)}),o=o.map(function(a){return h()({},a,{id:Object(q["uuid"])(),idDocumentoStatus:c.id,dataHoraEmissao:t,json:JSON.stringify(a.json)})}),e.status="Reaberto",e.dataHoraFinalizado="",a.next=26,g["a"].documento.grava({atual:e,original:this.documentoCaixa});case 26:return a.next=28,g["a"].documentoStatus.grava({atual:c});case 28:return a.next=30,g["a"].financeiroMovimentacao.remove(n()(r).concat(n()(s)));case 30:d=!0,u=!1,l=void 0,a.prev=33,m=o[Symbol.iterator]();case 35:if(d=(v=m.next()).done){a.next=42;break}return f=v.value,a.next=39,g["a"].caixaConsolidacao2.grava({atual:f});case 39:d=!0,a.next=35;break;case 42:a.next=48;break;case 44:a.prev=44,a.t1=a["catch"](33),u=!0,l=a.t1;case 48:a.prev=48,a.prev=49,d||null==m.return||m.return();case 51:if(a.prev=51,!u){a.next=54;break}throw l;case 54:return a.finish(51);case 55:return a.finish(48);case 56:this.atualizar(),this.atualizarAoFecharModal=!0,this.$q.loading.hide(),a.next=64;break;case 61:a.prev=61,a.t2=a["catch"](0),this.$q.notifyError("Não foi possível abrir a conferência.",a.t2);case 64:return a.prev=64,this.$q.loading.hide(),a.finish(64);case 67:case"end":return a.stop()}},a,this,[[0,61,64,67],[1,7],[33,44,48,56],[49,,51,55]])}));return function(){return a.apply(this,arguments)}}(),refreshData:function(){this.mostrarDinheiro=!1,this.dinheiro={},this.acertoDinheiro=0,this.acertos=[],this.totalAcertos=0,this.formasPagamento=[],this.totaisFormasPagamento={},this.outrasFormasPagamento={},this.condicoesPagamentoFechamento={},this.valorFechamento=0,this.diferencaFundo=0,this.contatos={},this.usuarios={},this.documentos={},this.mostrarSangrias=!1,this.sangrias=[],this.totalSangrias=0,this.mostrarDespesas=!1,this.despesas=[],this.totalDespesas=0,this.mostrarSuprimentos=!1,this.suprimentos=[],this.totalSuprimentos=0,this.mostrarDivergencias=!1,this.divergencias=[],this.totalDivergencias=0,this.edicao=!1,this.faturaModal={visivel:!1,id:""},this.vendaModal={visivel:!1,id:""}}},props:{idDocumentoCaixa:{required:!0,type:String},value:{required:!0,type:Boolean}},watch:{value:function(a){a&&(this.atualizar(),this.refreshData())},visivel:function(a){this.$emit("input",a)}}},k=F,D=(e("b4be"),e("2877")),y=Object(D["a"])(k,v,f,!1,null,"12369572",null);y.options.__file="CaixaConferir.vue";var w=y.exports,P={components:{Avatar:l["a"],Badge:m["a"],CaixaConferir:w},data:function(){return{empresa:{},contato:{},usuarioAbertura:{},caixaConferirModal:{visivel:!1}}},methods:{abrirCaixaConferirModal:function(){this.caixaConferirModal.visivel=!0},atualizar:function(){var a=c()(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,g["a"].contato.le({id:this.documento.idEmpresa});case 2:return this.empresa=a.sent,a.next=5,g["a"].contato.le({id:this.documento.idContato});case 5:return this.contato=a.sent,a.next=8,g["a"].usuario.le({id:this.documento.idContato});case 8:this.usuarioAbertura=a.sent;case 9:case"end":return a.stop()}},a,this)}));return function(){return a.apply(this,arguments)}}(),executar:function(a){switch(a){case"atualizar":this.atualizar(),this.$emit("atualizar")}}},props:{documento:{required:!0,type:Object}},mounted:function(){this.atualizar()}},O=P,j=(e("eab3"),Object(D["a"])(O,d,u,!1,null,"4be44909",null));j.options.__file="CaixaCard.vue";var E=j.exports,S=e("88db"),M=e("3e8a"),T={components:{CaixaCard:E,Campo:S["a"]},data:function(){return{documentosCaixaConferencia:{documentos:[],total:0},documentosCaixaFechado:{documentos:[],total:0},dataIni:"",dataFim:"",grupos:[]}},methods:{atualizar:function(){var a=c()(regeneratorRuntime.mark(function a(){var t,e;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:t=(new Date).setHours(0,0,0,0),e=new Date(t),e.setDate(e.getDate()-7),this.dataIni=new Date(e),this.dataFim=new Date(t),this.filtrar();case 6:case"end":return a.stop()}},a,this)}));return function(){return a.apply(this,arguments)}}(),filtrar:function(){var a=c()(regeneratorRuntime.mark(function a(){var t,e,o,i,r,s,c,d,u,l,m,v,f,p,h,b,x,C,q,F,k,D,y=this;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,g["a"].contatoBusca.filtrar(null,{ativo:!0,empresas:!0},0);case 2:return t=a.sent,e=t.map(function(a){return a.id}),a.next=6,g["a"].documento.le({tipo:"Caixa"});case 6:if(o=a.sent,o=o.filter(function(a){return e.find(function(t){return t===a.idEmpresa})}),i=[],!this.grupos.length){a.next=67;break}return r=this.grupos.map(function(a){return a.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().split(" ")}),s=[],c=[],a.next=15,Object(M["a"])().empresa.toArray();case 15:for(d=a.sent,u=!0,l=!1,m=void 0,a.prev=19,v=r[Symbol.iterator]();!(u=(f=v.next()).done);u=!0)p=f.value,s.push.apply(s,n()(p));a.next=27;break;case 23:a.prev=23,a.t0=a["catch"](19),l=!0,m=a.t0;case 27:a.prev=27,a.prev=28,u||null==v.return||v.return();case 30:if(a.prev=30,!l){a.next=33;break}throw m;case 33:return a.finish(30);case 34:return a.finish(27);case 35:h=!0,b=!1,x=void 0,a.prev=38,C=d[Symbol.iterator]();case 40:if(h=(q=C.next()).done){a.next=51;break}if(F=q.value,!F.idContato){a.next=48;break}return a.t1=c,a.next=46,Object(M["a"])().contato.get(F.idContato);case 46:a.t2=a.sent,a.t1.push.call(a.t1,a.t2);case 48:h=!0,a.next=40;break;case 51:a.next=57;break;case 53:a.prev=53,a.t3=a["catch"](38),b=!0,x=a.t3;case 57:a.prev=57,a.prev=58,h||null==C.return||C.return();case 60:if(a.prev=60,!b){a.next=63;break}throw x;case 63:return a.finish(60);case 64:return a.finish(57);case 65:i=c.filter(function(a){for(var t=(a.nome||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().split(" "),e=(a.apelido||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().split(" "),o=0;o<s.length;o++){var i=s[o];if(-1===n()(t).concat(n()(e)).join("").search(i))return!1}return!0}).map(function(a){return a.id}),o=o.filter(function(a){return i.includes(a.idEmpresa)});case 67:k=o.filter(function(a){var t=new Date(a.dataHoraFinalizado).setHours(0,0,0,0);return"Aguardando Conferência"===a.status&&t>=y.dataIni&&t<=y.dataFim}),k=Object(_["orderBy"])(k,"dataHoraFinalizado","desc"),k={documentos:k,total:k.reduce(function(a,t){return a+=t.totalDocumento||0,a},0)},D=o.filter(function(a){var t=new Date(a.dataHoraFinalizado).setHours(0,0,0,0);return"Fechado"===a.status&&t>=y.dataIni&&t<=y.dataFim}),D=Object(_["orderBy"])(D,"dataHoraFinalizado","desc"),D={documentos:D,total:D.reduce(function(a,t){return a+=t.totalDocumento||0,a},0)},this.documentosCaixaConferencia=k,this.documentosCaixaFechado=D;case 75:case"end":return a.stop()}},a,this,[[19,23,27,35],[28,,30,34],[38,53,57,65],[58,,60,64]])}));return function(){return a.apply(this,arguments)}}()},mounted:function(){this.atualizar()}},z=T,A=(e("e2e6"),Object(D["a"])(z,o,i,!1,null,"1c7c9461",null));A.options.__file="CaixaTesouraria.vue";t["default"]=A.exports}}]);