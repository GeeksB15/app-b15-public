(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["4cd594d9"],{"0e0d":function(a,e,t){},1093:function(a,e,t){"use strict";t.r(e);var o=function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"CaixaEmpresas"},[t("div",{staticClass:"q-pb-md"},[t("campo",{staticClass:"col-10",attrs:{opcoes:a.caixas,tipo:"seletor"},on:{input:a.carregarDocumentos},model:{value:a.idDocumentoCaixa,callback:function(e){a.idDocumentoCaixa=e},expression:"idDocumentoCaixa"}}),t("div",{staticClass:"row gutter-xs q-pt-sm"},a._l(a.menuFaturamento,function(a,e){return t("div",{key:e,staticClass:"col-3 col-md "},[t("q-btn",{staticClass:"botaoAcesso full-width",attrs:{color:"primary",outline:"",icon:a.icone,label:a.rotulo,size:"lg"},nativeOn:{click:function(e){return a.manipulador(e)}}})],1)})),t("div",{staticClass:"no-shadow"},[a.vendas.encontradas?t("q-list",[t("q-collapsible",{attrs:{opened:"",label:"Vendas"}},a._l(a.vendas.status,function(e){return t("q-collapsible",{key:e,attrs:{opened:"",label:e}},a._l(a.vendas[e],function(e){return t("venda-card",{key:e.id,attrs:{id:e.id},on:{atualizar:a.atualizar}})}))}))],1):a._e(),a.faturas.encontradas?t("q-list",[t("q-collapsible",{attrs:{opened:"",label:"Faturas"}},a._l(a.faturas.status,function(e){return t("q-collapsible",{key:e,attrs:{opened:"",label:e}},a._l(a.faturas[e],function(e){return t("fatura-card",{key:e.id,attrs:{id:e.id},on:{atualizar:a.atualizar}})}))}))],1):a._e()],1)],1),t("caixa-abrir",{on:{aberto:a.atualizar},model:{value:a.modalCaixaAbrir,callback:function(e){a.modalCaixaAbrir=e},expression:"modalCaixaAbrir"}}),t("caixa-fechar",{attrs:{idDocumentoCaixa:a.idDocumentoCaixa},on:{fechado:a.atualizar},model:{value:a.modalCaixaFechar,callback:function(e){a.modalCaixaFechar=e},expression:"modalCaixaFechar"}}),t("caixa-transferencia",{attrs:{titulo:a.tituloCaixaTransferencia},model:{value:a.modalCaixaTransferencia,callback:function(e){a.modalCaixaTransferencia=e},expression:"modalCaixaTransferencia"}}),t("caixa-sangria-lancar",{attrs:{idDocumentoCaixa:a.idDocumentoCaixa},model:{value:a.modalCaixaSangriaLancar,callback:function(e){a.modalCaixaSangriaLancar=e},expression:"modalCaixaSangriaLancar"}}),t("caixa-suprimento-lancar",{attrs:{idDocumentoCaixa:a.idDocumentoCaixa},model:{value:a.modalCaixaSuprimentoLancar,callback:function(e){a.modalCaixaSuprimentoLancar=e},expression:"modalCaixaSuprimentoLancar"}}),t("caixa-despesa-lancar",{attrs:{idDocumentoCaixa:a.idDocumentoCaixa},model:{value:a.modalCaixaDespesaLancar,callback:function(e){a.modalCaixaDespesaLancar=e},expression:"modalCaixaDespesaLancar"}}),t("caixa-conferencia",{model:{value:a.modalCaixaConferencia,callback:function(e){a.modalCaixaConferencia=e},expression:"modalCaixaConferencia"}})],1)},i=[];o._withStripped=!0;t("cadf"),t("456d"),t("ac4d"),t("8a81"),t("ac6a"),t("6762"),t("2fdb");var n=t("448a"),r=t.n(n),s=(t("7514"),t("96cf"),t("c973")),c=t.n(s),l=t("680c"),u=t.n(l),d=t("ebdd"),m=function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",[t("q-modal",{attrs:{"no-esc-dismiss":a.abrindo,"no-backdrop-dismiss":a.abrindo,"content-css":{minWidth:"30vw"}},model:{value:a.visivel,callback:function(e){a.visivel=e},expression:"visivel"}},[t("q-modal-layout",[t("q-toolbar",{attrs:{slot:"header"},slot:"header"},[t("q-toolbar-title",[a._v("Conferência de Caixa")]),a.abrindo?a._e():t("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"close",round:""}})],1),t("form",{staticClass:"layout-padding",on:{submit:function(e){return e.preventDefault(),a.abrir(e)}}},[t("campo",{attrs:{value:a.empresa.descricao,before:[{icon:"search",handler:a.abrirModalContatoEmpresas}],placeholder:"Selecione","rotulo-fixo":a.empresa.descricao?"Empresa":"","somente-leitura":"",disable:a.abrindo}}),t("div",{staticClass:"row"},[t("div",{staticClass:"col-6"},[t("campo",{attrs:{tipo:"data",rotulo:"De",disable:a.abrindo},on:{input:function(e){a.getDocumentosCaixa()}},model:{value:a.periodo.de,callback:function(e){a.$set(a.periodo,"de",e)},expression:"periodo.de"}})],1),t("div",{staticClass:"col-6"},[t("campo",{attrs:{tipo:"data",rotulo:"Até",disable:a.abrindo},on:{input:function(e){a.getDocumentosCaixa()}},model:{value:a.periodo.ate,callback:function(e){a.$set(a.periodo,"ate",e)},expression:"periodo.ate"}})],1)]),a.documentosCaixaEncontrados?t("campo",{attrs:{opcoes:a.documentosCaixa,tipo:"seletor",disable:a.abrindo},on:{input:a.limparSeletor},model:{value:a.idDocumentoCaixa,callback:function(e){a.idDocumentoCaixa=e},expression:"idDocumentoCaixa"}}):t("div",{staticClass:"text-center q-mt-md"},[t("span",{staticStyle:{"font-size":"80%"}},[a._v(a._s(a.msg))])]),t("div",{staticClass:"q-mt-lg text-center"},[t("q-btn",{staticClass:"q-ml-sm no-shadow",attrs:{loading:a.abrindo,color:"primary",label:"Abrir",type:"submit",disable:!a.idDocumentoCaixa}})],1)],1)],1)],1),t("prompt-contato-novo",{attrs:{filtro:a.modalContato.filtro,placeholder:a.modalContato.placeholder},on:{selecionar:a.modalContato.selecionar},model:{value:a.modalContato.visivel,callback:function(e){a.$set(a.modalContato,"visivel",e)},expression:"modalContato.visivel"}})],1)},v=[];m._withStripped=!0;var p=t("88db"),f=t("8149"),h=t("2ef0"),b=t("ed08"),x=t("41ff"),C={components:{Campo:p["a"],PromptContatoNovo:x["a"]},computed:{documentosCaixaEncontrados:function(){return!!this.documentosCaixa.filter(function(a){return a.valor}).length}},data:function(){return{abrindo:!1,documentosCaixa:[],empresa:{},idDocumentoCaixa:"",modalContato:{},msg:"",periodo:{},visivel:!1}},methods:{abrir:function(){var a=c()(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:this.idDocumentoCaixa&&(this.abrindo=!0,this.imprimir("conferencia-de-caixa",this.idDocumentoCaixa),this.visivel=!1);case 1:case"end":return a.stop()}},a,this)}));return function(){return a.apply(this,arguments)}}(),abrirModalContatoEmpresas:function(){this.abrindo||(this.modalContato={visivel:!0,filtro:{ativo:!0,empresas:!0},placeholder:"Selecione a empresa",selecionar:this.selecionarEmpresa})},getDocumentosCaixa:function(){var a=c()(regeneratorRuntime.mark(function a(){var e,t,o,i,n,s,c,l,u=this;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:if(a.prev=0,this.empresa.id){a.next=3;break}return a.abrupt("return");case 3:return this.documentosCaixa=[],this.idDocumentoCaixa="",this.msg="Carregando caixas...",a.next=8,Object(b["dormir"])(500);case 8:return a.next=10,f["a"].documento.le({tipo:"Caixa",idEmpresa:this.empresa.id});case 10:e=a.sent,t=e.filter(function(a){var e=new Date(a.dataHoraFinalizado).setHours(0,0,0,0);return["Aguardando Conferência","Fechado"].includes(a.status)&&e>=u.periodo.de&&e<=u.periodo.ate}),t=Object(h["orderBy"])(t,"dataHoraFinalizado","desc"),o=!0,i=!1,n=void 0,a.prev=16,s=t[Symbol.iterator]();case 18:if(o=(c=s.next()).done){a.next=36;break}return l=c.value,a.next=22,f["a"].caixa.le({id:l.idCaixa});case 22:if(a.t1=a.sent,a.t1){a.next=25;break}a.t1={};case 25:if(a.t0=a.t1.descricao,a.t0){a.next=28;break}a.t0="";case 28:a.t2=a.t0,a.t3=a.t2+" - Fechado em ",a.t4=this.$filters.dataHora(l.dataHoraFinalizado),l.rotulo=a.t3+a.t4,l.valor=l.id;case 33:o=!0,a.next=18;break;case 36:a.next=42;break;case 38:a.prev=38,a.t5=a["catch"](16),i=!0,n=a.t5;case 42:a.prev=42,a.prev=43,o||null==s.return||s.return();case 45:if(a.prev=45,!i){a.next=48;break}throw n;case 48:return a.finish(45);case 49:return a.finish(42);case 50:this.documentosCaixa=[{rotulo:"Selecione um caixa",valor:""}].concat(r()(t)),this.documentosCaixaEncontrados||(this.msg="Nenhum caixa encontrado para este filtro"),a.next=57;break;case 54:a.prev=54,a.t6=a["catch"](0),this.$q.notifyError("Erro ao carregar caixas.");case 57:case"end":return a.stop()}},a,this,[[0,54],[16,38,42,50],[43,,45,49]])}));return function(){return a.apply(this,arguments)}}(),limparSeletor:function(){this.documentosCaixa=this.documentosCaixa.filter(function(a){return a.valor})},selecionarEmpresa:function(){var a=c()(regeneratorRuntime.mark(function a(e){var t;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:if(a.prev=0,e){a.next=3;break}return a.abrupt("return");case 3:return a.next=5,f["a"].empresa.le({idContato:e});case 5:t=a.sent,Object(b["verificarErro"])(!t.length||!t[0].id,"Não foi possível recuperar os dados da empresa."),this.empresa={id:e,descricao:t[0].nome||"Empresa sem nome"},this.getDocumentosCaixa(),a.next=15;break;case 11:a.prev=11,a.t0=a["catch"](0),this.refreshData(),this.$q.notifyError("Erro ao selecionar a empresa.",a.t0);case 15:case"end":return a.stop()}},a,this,[[0,11]])}));return function(e){return a.apply(this,arguments)}}(),refreshData:function(){this.abrindo=!1,this.empresa={id:"",descricao:""},this.idDocumentoCaixa="",this.documentosCaixa=[];var a=new Date;this.periodo={de:new Date(a.setDate(a.getDate()-7)),ate:new Date},this.modalContato={visivel:!1,filtro:{},placeholder:"",selecionar:function(){}},this.msg="Preencha o filtro para buscar caixas"}},props:{value:{required:!0,type:Boolean}},watch:{visivel:function(a){a||this.$emit("input",!1)},value:function(a){a&&(this.visivel=!0),a||this.refreshData()}},created:function(){this.refreshData()}},g=C,q=t("2877"),k=Object(q["a"])(g,m,v,!1,null,null,null);k.options.__file="CaixaConferencia.vue";var _=k.exports,F=t("f377"),y=function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("q-modal",{attrs:{value:a.aberto,"content-css":{minWidth:"30vw"}},on:{input:a.eventoInput}},[t("q-modal-layout",[t("q-toolbar",{attrs:{slot:"header"},slot:"header"},[t("q-toolbar-title",[a._v(a._s(a.titulo))]),t("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"close",round:""}})],1),t("form",{staticClass:"layout-padding",on:{submit:a.salvar}},[t("campo",{attrs:{before:[{icon:"trending_down"}],opcoes:a.caixas,tipo:"seletor",rotulo:"Origem"},model:{value:a.campos.origem,callback:function(e){a.$set(a.campos,"origem",e)},expression:"campos.origem"}}),t("campo",{attrs:{before:[{icon:"trending_up"}],rotulo:"Destino"},model:{value:a.campos.destino,callback:function(e){a.$set(a.campos,"destino",e)},expression:"campos.destino"}}),t("campo",{attrs:{before:[{icon:"attach_money"}],rotulo:"Valor",tipo:"dinheiro"},model:{value:a.campos.valor,callback:function(e){a.$set(a.campos,"valor",e)},expression:"campos.valor"}}),t("campo",{attrs:{before:[{icon:"date_range"}],rotulo:"Data",tipo:"data"},model:{value:a.campos.data,callback:function(e){a.$set(a.campos,"data",e)},expression:"campos.data"}}),t("div",{staticClass:"q-mt-lg text-center"},[t("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{color:"faded",flat:"",label:"Cancelar"}}),t("q-btn",{staticClass:"q-ml-sm no-shadow",attrs:{color:"primary",label:"Salvar",type:"submit"}})],1)],1)],1)],1)},D=[];y._withStripped=!0;var w=t("f490"),E={components:{Campo:p["a"]},data:function(){return{aberto:!1,campos:{data:"",destino:"",origem:"",valor:0},caixas:[]}},methods:{atualizar:function(){var a=c()(regeneratorRuntime.mark(function a(){var e,t,o,i,n,r,s,c;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return e=(new Date).setHours(0,0,0,0),a.next=3,f["a"].caixa.le({aberto:!0});case 3:if(t=a.sent,t=t.filter(function(a){return new Date(a.dataHoraEmissao).setHours(0,0,0,0)===e}),t.length){a.next=9;break}return this.$q.notify({message:"Favor abrir o caixa para efetuar operações!",type:"warning"}),this.$emit("input",!1),a.abrupt("return");case 9:o=!0,i=!1,n=void 0,a.prev=12,r=t[Symbol.iterator]();case 14:if(o=(s=r.next()).done){a.next=26;break}return c=s.value,a.next=18,f["a"].caixa.le({id:c.idCaixa});case 18:if(a.t0=a.sent,a.t0){a.next=21;break}a.t0={};case 21:c.rotulo=a.t0.descricao,c.valor=c.idCaixa;case 23:o=!0,a.next=14;break;case 26:a.next=32;break;case 28:a.prev=28,a.t1=a["catch"](12),i=!0,n=a.t1;case 32:a.prev=32,a.prev=33,o||null==r.return||r.return();case 35:if(a.prev=35,!i){a.next=38;break}throw n;case 38:return a.finish(35);case 39:return a.finish(32);case 40:this.caixas=t,this.campos.origem=(t[0]||{}).valor,this.campos.data=w["d"].formatDate(e),this.aberto=!0;case 44:case"end":return a.stop()}},a,this,[[12,28,32,40],[33,,35,39]])}));return function(){return a.apply(this,arguments)}}(),eventoInput:function(a){a||(this.aberto=!1),this.$emit("input",a)},salvar:function(a){a.preventDefault()}},props:{value:{default:!1,required:!0,type:Boolean},titulo:{default:"Transferência",type:String}},watch:{value:function(a){a&&(this.campos={data:"",destino:"",origem:"",valor:0},this.atualizar())}}},O=E,P=Object(q["a"])(O,y,D,!1,null,null,null);P.options.__file="CaixaTransferencia.vue";var j=P.exports,T=function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("q-modal",{attrs:{value:a.visivel,"content-css":{minWidth:"30vw"}},on:{input:a.eventoInput}},[t("q-modal-layout",[t("q-toolbar",{attrs:{slot:"header"},slot:"header"},[t("q-toolbar-title",[a._v("Lançar Sangria")]),t("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"close",round:""}})],1),t("form",{staticClass:"layout-padding",on:{submit:function(e){return e.preventDefault(),a.lancar(e)}}},[t("campo",{attrs:{before:[{icon:"attach_money"}],rotulo:"Valor",tipo:"decimal",decimals:"2"},model:{value:a.campos.valor,callback:function(e){a.$set(a.campos,"valor",e)},expression:"campos.valor"}}),t("campo",{attrs:{before:[{icon:"message"}],rotulo:"Descrição",tipo:"texto"},model:{value:a.campos.descricao,callback:function(e){a.$set(a.campos,"descricao",e)},expression:"campos.descricao"}}),t("div",{staticClass:"q-mt-lg text-center"},[t("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{color:"faded",flat:"",label:"Cancelar"}}),t("q-btn",{staticClass:"q-ml-sm no-shadow",attrs:{color:"primary",label:"Lançar",type:"submit"}})],1)],1)],1)],1)},S=[];T._withStripped=!0;var R={components:{Campo:p["a"]},data:function(){return{visivel:!1,campos:{},contaOrigem:"",contaDestino:""}},methods:{atualizar:function(){var a=c()(regeneratorRuntime.mark(function a(){var e,t,o;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,e={},t={},a.next=5,f["a"].documento.le({id:this.idDocumentoCaixa});case 5:return e=a.sent,Object(b["verificarAlerta"])(!("Caixa"===e.tipo&&"Aberto"===e.status),"Selecione um caixa aberto"),Object(b["verificarErro"])(!e.idEmpresa,"Caixa sem empresa"),a.next=10,f["a"].caixa.le({id:e.idCaixa});case 10:return t=a.sent,Object(b["verificarErro"])(!t.id,"Caixa não existe"),a.next=14,f["a"].financeiroPlanoConta.le({id:t.idPlanoConta});case 14:return this.contaOrigem=a.sent,a.next=17,f["a"].financeiroPlanoConta.le({id:t.idPlanoContaSangria});case 17:return this.contaDestino=a.sent,this.campos.valor=0,this.campos.descricao="Transf. de ".concat(this.contaOrigem.descricao.trim()||""," para ").concat(this.contaDestino.descricao.trim()||""),this.idContatoEmpresa=e.idEmpresa,a.next=23,f["a"].empresa.le({idContato:this.idContatoEmpresa});case 23:o=a.sent,Object(b["verificarErro"])(!o||!o.length||!o[0].id,"Caixa sem empresa válida"),this.idEmpresa=o[0].idContato,this.visivel=!0,a.next=33;break;case 29:a.prev=29,a.t0=a["catch"](0),this.$q.notifyError("Erro no lancamento de Sangria",a.t0),this.eventoInput(!1);case 33:case"end":return a.stop()}},a,this,[[0,29]])}));return function(){return a.apply(this,arguments)}}(),eventoInput:function(a){this.visivel=a,this.$emit("input",a)},lancar:function(){var a=c()(regeneratorRuntime.mark(function a(){var e,t,o,i,n,r;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:try{this.$q.loading.show({message:"Processando..."}),e=Object(b["dataAtual"])(),t=f["a"].usuario.logado.id,Object(b["verificarAlerta"])(!this.campos.valor,"Valor não preenchido"),o={id:Object(b["uuid"])(),idEmpresa:this.idEmpresa,tipo:"Financeiro",operacao:"Sangria",status:"Finalizado",dataHoraEmissao:e,dataHoraFinalizado:e,totalDocumento:this.campos.valor,idContato:t,observacao:this.campos.descricao,idDocumentoAdicional:this.idDocumentoCaixa,idDocumentoOperacao:""},i=Object(b["uuid"])(),n={id:Object(b["uuid"])(),idFinanceiroMovimentacaoN:i,idEmpresa:this.idEmpresa,idContato:t,idFinanceiroPlanoConta:this.contaOrigem.id,dataEmissao:e,dataCompetencia:e,dataVencimento:e,dataMovimento:e,valorDebito:0,valorCredito:this.campos.valor,descricao:"Sangria de ".concat(f["a"].usuario.logado.apelido," no Caixa #").concat(this.idDocumentoCaixa),observacao:"Transferência entre contas",documentoTipo:"Sangria",documentoId:this.idDocumentoCaixa,idDocumentoCaixa:this.idDocumentoCaixa},r={id:Object(b["uuid"])(),idFinanceiroMovimentacaoN:i,idEmpresa:this.idEmpresa,idContato:t,idFinanceiroPlanoConta:this.contaDestino.id,dataEmissao:e,dataCompetencia:e,dataVencimento:e,dataMovimento:e,valorDebito:this.campos.valor,valorCredito:0,descricao:"Sangria de ".concat(f["a"].usuario.logado.apelido," no Caixa #").concat(this.idDocumentoCaixa),observacao:"Transferência entre contas",documentoTipo:"Sangria",documentoId:this.idDocumentoCaixa,idDocumentoCaixa:this.idDocumentoCaixa},f["a"].financeiroMovimentacaoN.grava({atual:{id:i}}),f["a"].documento.grava({atual:o}),f["a"].financeiroMovimentacao.grava({atual:n}),f["a"].financeiroMovimentacao.grava({atual:r}),this.eventoInput(!1),this.$q.notifyPositive("Sangria lançada com sucesso")}catch(a){this.$q.notifyError("Erro no lancamento de Sangria",a)}finally{this.$q.loading.hide()}case 1:case"end":return a.stop()}},a,this)}));return function(){return a.apply(this,arguments)}}()},props:{idDocumentoCaixa:{required:!0,type:String},value:{required:!0,type:Boolean}},watch:{value:function(a){a&&this.atualizar()}}},z=R,$=Object(q["a"])(z,T,S,!1,null,null,null);$.options.__file="CaixaSangriaLancar.vue";var M=$.exports,B=function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("q-modal",{attrs:{value:a.visivel,"content-css":{minWidth:"30vw"}},on:{input:a.eventoInput}},[t("q-modal-layout",[t("q-toolbar",{attrs:{slot:"header"},slot:"header"},[t("q-toolbar-title",[a._v("Lançar Suprimento")]),t("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"close",round:""}})],1),t("form",{staticClass:"layout-padding",on:{submit:a.lancar}},[t("campo",{attrs:{before:[{icon:"attach_money"}],rotulo:"Valor",tipo:"decimal",decimals:"2"},model:{value:a.campos.valor,callback:function(e){a.$set(a.campos,"valor",e)},expression:"campos.valor"}}),t("campo",{attrs:{before:[{icon:"message"}],rotulo:"Descrição",tipo:"texto"},model:{value:a.campos.descricao,callback:function(e){a.$set(a.campos,"descricao",e)},expression:"campos.descricao"}}),t("div",{staticClass:"q-mt-lg text-center"},[t("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{color:"faded",flat:"",label:"Cancelar"}}),t("q-btn",{staticClass:"q-ml-sm no-shadow",attrs:{color:"primary",label:"Lançar",type:"submit"}})],1)],1)],1)],1)},I=[];B._withStripped=!0;var V={components:{Campo:p["a"]},data:function(){return{visivel:!1,campos:{},contaOrigem:"",contaDestino:""}},methods:{atualizar:function(){var a=c()(regeneratorRuntime.mark(function a(){var e,t,o;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,e={},t={},a.next=5,f["a"].documento.le({id:this.idDocumentoCaixa});case 5:return e=a.sent,Object(b["verificarAlerta"])(!("Caixa"===e.tipo&&"Aberto"===e.status),"Selecione um caixa aberto"),Object(b["verificarErro"])(!e.idEmpresa,"Caixa sem empresa"),a.next=10,f["a"].caixa.le({id:e.idCaixa});case 10:return t=a.sent,Object(b["verificarErro"])(!t.id,"Caixa não existe"),a.next=14,f["a"].financeiroPlanoConta.le({id:t.idPlanoContaSangria});case 14:return this.contaOrigem=a.sent,a.next=17,f["a"].financeiroPlanoConta.le({id:t.idPlanoConta});case 17:return this.contaDestino=a.sent,this.campos.valor=0,this.campos.descricao="Transf. de ".concat(this.contaOrigem.descricao.trim()||""," para ").concat(this.contaDestino.descricao.trim()||""),this.idContatoEmpresa=e.idEmpresa,a.next=23,f["a"].empresa.le({idContato:this.idContatoEmpresa});case 23:o=a.sent,Object(b["verificarErro"])(!o||!o.length||!o[0].id,"Caixa sem empresa válida"),this.idEmpresa=o[0].idContato,this.visivel=!0,a.next=33;break;case 29:a.prev=29,a.t0=a["catch"](0),this.$q.notifyError("Erro no lancamento de Suprimento",a.t0),this.eventoInput(!1);case 33:case"end":return a.stop()}},a,this,[[0,29]])}));return function(){return a.apply(this,arguments)}}(),eventoInput:function(a){this.visivel=a,this.$emit("input",a)},lancar:function(){var a=c()(regeneratorRuntime.mark(function a(e){var t,o,i,n,r,s;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:e.preventDefault();try{this.$q.loading.show({message:"Processando..."}),t=Object(b["dataAtual"])(),o=f["a"].usuario.logado.id,Object(b["verificarAlerta"])(!this.campos.valor,"Valor não preenchido"),i={id:Object(b["uuid"])(),idEmpresa:this.idEmpresa,tipo:"Financeiro",operacao:"Suprimento",status:"Finalizado",dataHoraEmissao:t,dataHoraFinalizado:t,totalDocumento:this.campos.valor,idContato:o,observacao:this.campos.descricao,idDocumentoAdicional:this.idDocumentoCaixa,idDocumentoOperacao:""},n=Object(b["uuid"])(),r={id:Object(b["uuid"])(),idFinanceiroMovimentacaoN:n,idEmpresa:this.idEmpresa,idContato:o,idFinanceiroPlanoConta:this.contaOrigem.id,dataEmissao:t,dataCompetencia:t,dataVencimento:t,dataMovimento:t,valorDebito:0,valorCredito:this.campos.valor,descricao:"Suprimento de ".concat(f["a"].usuario.logado.apelido," no Caixa #").concat(this.idDocumentoCaixa),observacao:"Transferência entre contas",documentoTipo:"Suprimento",documentoId:this.idDocumentoCaixa,idDocumentoCaixa:this.idDocumentoCaixa},s={id:Object(b["uuid"])(),idFinanceiroMovimentacaoN:n,idEmpresa:this.idEmpresa,idContato:o,idFinanceiroPlanoConta:this.contaDestino.id,dataEmissao:t,dataCompetencia:t,dataVencimento:t,dataMovimento:t,valorDebito:this.campos.valor,valorCredito:0,descricao:"Suprimento de ".concat(f["a"].usuario.logado.apelido," no Caixa #").concat(this.idDocumentoCaixa),observacao:"Transferência entre contas",documentoTipo:"Suprimento",documentoId:this.idDocumentoCaixa,idDocumentoCaixa:this.idDocumentoCaixa},f["a"].financeiroMovimentacaoN.grava({atual:{id:n}}),f["a"].documento.grava({atual:i}),f["a"].financeiroMovimentacao.grava({atual:r}),f["a"].financeiroMovimentacao.grava({atual:s}),this.eventoInput(!1),this.$q.notifyPositive("Suprimento lançado com sucesso")}catch(a){this.$q.notifyError("Erro no lancamento de Suprimento",a)}finally{this.$q.loading.hide()}case 2:case"end":return a.stop()}},a,this)}));return function(e){return a.apply(this,arguments)}}()},props:{idDocumentoCaixa:{required:!0,type:String},value:{required:!0,type:Boolean}},watch:{value:function(a){a&&this.atualizar()}}},N=V,A=Object(q["a"])(N,B,I,!1,null,null,null);A.options.__file="CaixaSuprimentoLancar.vue";var L=A.exports,H=function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",[t("q-modal",{attrs:{value:a.visivel,"content-css":{minWidth:"30vw"}},on:{input:a.eventoInput}},[t("q-modal-layout",[t("q-toolbar",{attrs:{slot:"header"},slot:"header"},[t("q-toolbar-title",[a._v("Lançar Despesa")]),t("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"close",round:""}})],1),t("form",{staticClass:"layout-padding",on:{submit:a.lancar}},[t("campo",{attrs:{value:a.contaDestino.descricao,before:[{icon:"search",handler:a.abrirModalFinanceiroContas}],readonly:"",rotulo:"Destino"},on:{click:a.abrirModalFinanceiroContas}}),t("campo",{attrs:{value:a.contato.nome,before:[{icon:"search",handler:a.abrirModalContato}],readonly:"",rotulo:"Pagar a"},on:{click:a.abrirModalContato}}),t("campo",{attrs:{before:[{icon:"attach_money"}],rotulo:"Valor",tipo:"decimal",decimals:"2"},model:{value:a.campos.valor,callback:function(e){a.$set(a.campos,"valor",e)},expression:"campos.valor"}}),t("campo",{attrs:{before:[{icon:"message"}],rotulo:"Descrição",tipo:"texto"},model:{value:a.campos.descricao,callback:function(e){a.$set(a.campos,"descricao",e)},expression:"campos.descricao"}}),t("div",{staticClass:"q-mt-lg text-center"},[t("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{color:"faded",flat:"",label:"Cancelar"}}),t("q-btn",{staticClass:"q-ml-sm no-shadow",attrs:{color:"primary",label:"Lançar",type:"submit"}})],1)],1)],1)],1),t("prompt-financeiro-contas",{attrs:{filtro:a.modalFinanceiroContas.filtros},on:{selecionar:a.selecionarFinanceiroConta},model:{value:a.modalFinanceiroContas.visivel,callback:function(e){a.$set(a.modalFinanceiroContas,"visivel",e)},expression:"modalFinanceiroContas.visivel"}}),t("prompt-contato-novo",{attrs:{filtro:{ativo:!0}},on:{selecionar:a.selecionarContato},model:{value:a.modalContato,callback:function(e){a.modalContato=e},expression:"modalContato"}})],1)},J=[];H._withStripped=!0;t("c5f6");var U=function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("q-modal",{attrs:{maximized:""},model:{value:a.visivel,callback:function(e){a.visivel=e},expression:"visivel"}},[t("q-modal-layout",[t("q-toolbar",{attrs:{slot:"header"},slot:"header"},[t("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"arrow_back",round:""}}),t("q-toolbar-title",[t("q-search",{attrs:{color:"none",inverted:"",placeholder:a.placeholder,debounce:600,after:[{icon:"close",content:!0,handler:function(){a.limparTermo()}}]},on:{input:a.atualizar},model:{value:a.termo,callback:function(e){a.termo=e},expression:"termo"}})],1)],1),t("div",{staticClass:"layout-padding"},[a.carregando?t("div",{staticClass:"q-mt-lg text-center"},[t("q-spinner",{attrs:{color:"faded",size:50}})],1):a._e(),!a.carregando&&a.contasEncontradas?t("div",[t("q-list",{attrs:{link:"","no-border":"",separator:""}},a._l(a.contas,function(e){return t("q-item",{key:e.id,nativeOn:{click:function(t){a.selecionar(e)}}},[t("q-item-main",[t("q-item-tile",{attrs:{label:""}},[a._v(a._s((e.apelido||"").trim()+" - "+(e.descricao||"").trim())+"\n              ")]),t("q-item-tile",{attrs:{sublabel:""}},[a._v(a._s(e.caminho))])],1)],1)}))],1):a._e(),a.carregando||a.contasEncontradas?a._e():t("div",{staticClass:"bg-light q-pa-lg round-borders text-black text-center"},[a._v("\n        Não encontramos contas com os critérios selecionados.\n      ")])])],1)],1)},W=[];U._withStripped=!0;t("386d"),t("a481");var Y=t("ffe7"),G=t.n(Y),Q={computed:{contasEncontradas:function(){return this.contas.length}},data:function(){return{carregando:!0,contas:[],termo:"",visivel:!1}},methods:{atualizar:function(){var a=c()(regeneratorRuntime.mark(function a(){var e,t,o;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:if(this.carregando=!0,e=f["a"].financeiroPlanoConta.le(this.filtro),!this.termo){a.next=13;break}return t=!!this.termo.replace(/[^\d]/g,""),a.t0=G.a,a.next=7,e;case 7:a.t1=a.sent,a.t2={keys:[{name:"descricao",weight:.9},{name:"apelido",weight:.9},t?{name:"codigoFinanceiroPlanoConta"}:{}]},o=new a.t0(a.t1,a.t2),e=o.search(this.termo.trim()),a.next=20;break;case 13:return a.t3=h["orderBy"],a.next=16,e;case 16:a.t4=a.sent,a.t5=["descricao","apelido"],a.t6=["asc","asc"],e=(0,a.t3)(a.t4,a.t5,a.t6);case 20:this.contas=e,this.carregando=!1;case 22:case"end":return a.stop()}},a,this)}));return function(){return a.apply(this,arguments)}}(),limparTermo:function(){this.termo="",this.atualizar()},refreshData:function(){this.visivel=!1,this.carregando=!0,this.contas=[],this.conta={}},selecionar:function(a){this.conta=a,this.visivel=!1}},props:{filtro:{default:function(){return{}},type:Object},placeholder:{default:"Buscar",type:String},value:{required:!0,type:Boolean}},watch:{visivel:function(a){a||(this.$emit("selecionar",this.conta||{}),this.$emit("input",!1))},value:function(a){a&&(this.visivel=!0,this.atualizar()),a||this.refreshData()}}},K=Q,X=Object(q["a"])(K,U,W,!1,null,null,null);X.options.__file="PromptFinanceiroContas.vue";var Z=X.exports,aa={components:{Campo:p["a"],PromptContatoNovo:x["a"],PromptFinanceiroContas:Z},data:function(){return{visivel:!1,campos:{},contaOrigem:{},contaDestino:{},contato:{},idEmpresa:"",idContatoEmpresa:"",modalFinanceiroContas:{visivel:!1,filtros:{}},modalContato:!1}},methods:{atualizar:function(){var a=c()(regeneratorRuntime.mark(function a(){var e,t,o;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,e={},t={},a.next=5,f["a"].documento.le({id:this.idDocumentoCaixa});case 5:return e=a.sent,Object(b["verificarAlerta"])(!("Caixa"===e.tipo&&"Aberto"===e.status),"Selecione um caixa aberto"),Object(b["verificarErro"])(!e.idEmpresa,"Caixa sem empresa"),a.next=10,f["a"].caixa.le({id:e.idCaixa});case 10:return t=a.sent,Object(b["verificarErro"])(!t.id,"Caixa não existe"),a.next=14,f["a"].financeiroPlanoConta.le({id:t.idPlanoConta});case 14:return this.contaOrigem=a.sent,this.contaDestino={},this.contato={},this.campos.valor=0,this.campos.descricao="",this.idContatoEmpresa=e.idEmpresa,a.next=22,f["a"].empresa.le({idContato:this.idContatoEmpresa});case 22:o=a.sent,Object(b["verificarErro"])(!o||!o.length||!o[0].id,"Caixa sem empresa válida"),this.idEmpresa=o[0].idContato,this.visivel=!0,a.next=32;break;case 28:a.prev=28,a.t0=a["catch"](0),this.$q.notifyError("Erro no lancamento de Despesa",a.t0),this.eventoInput(!1);case 32:case"end":return a.stop()}},a,this,[[0,28]])}));return function(){return a.apply(this,arguments)}}(),eventoInput:function(a){this.visivel=a,this.$emit("input",a)},lancar:function(){var a=c()(regeneratorRuntime.mark(function a(e){var t,o,i,n,r,s,c,l;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return e.preventDefault(),a.prev=1,this.$q.loading.show({message:"Processando..."}),t=Object(b["dataAtual"])(),o=Object(b["uuid"])(),i=Object(b["uuid"])(),a.next=8,f["a"].configuracoes.le({nome:"financeiro.planocontas.duplicatapagar"});case 8:return n=a.sent,Object(b["verificarAlerta"])(!n||!n.length,"Falta configuração para 'financeiro.planocontas.duplicatapagar'"),a.next=12,f["a"].financeiroPlanoConta.le({codigoFinanceiroPlanoConta:Number(n[0].valor)});case 12:r=a.sent,Object(b["verificarAlerta"])(!r||!r.id,"Falta plano de conta para 'financeiro.planocontas.duplicatapagar'"),Object(b["verificarAlerta"])(!this.contaDestino||!this.contaDestino.id,"Conta destino não selecionada"),Object(b["verificarAlerta"])(!this.contato||!this.contato.id,"Contato para pagamento não selecionado"),Object(b["verificarAlerta"])(!this.campos.valor,"Valor não preenchido"),s={id:o,idEmpresa:this.idEmpresa,idContato:this.contato.id,idFinanceiroPlanoConta:this.contaDestino.id,dataEmissao:t,dataCompetencia:t,dataVencimento:t,dataVencimentoOriginal:t,dataPagamento:t,dataMovimento:t,valor:this.campos.valor,descricao:(this.campos.descricao||"").substr(0,100),observacao:this.campos.descricao||"",receberPagar:0,valorOriginal:this.campos.valor,valorTotal:this.campos.valor,valorARealizar:this.campos.valor,valorRealizado:this.campos.valor,documentoTipo:"DespesaSimples",formaDePagamento:"Caixa",documentoId:this.idDocumentoCaixa,idDocumentoCaixa:this.idDocumentoCaixa,idDocumentoCaixaLiquidacao:this.idDocumentoCaixa,idFinanceiroMovimentacaoAgrupamento:i},c={id:Object(b["uuid"])(),idFinanceiroMovimentacaoN:i,idEmpresa:this.idEmpresa,idFinanceiroPlanoConta:r.id,dataEmissao:t,dataCompetencia:t,dataVencimento:t,dataMovimento:t,valorDebito:this.campos.valor,valorCredito:0,descricao:"Pagamento de despesa simples por ".concat(f["a"].usuario.logado.apelido," no Caixa #").concat(this.idDocumentoCaixa),observacao:"Liquidação Despesa Simples - Título",documentoTipo:"DespesaSimples",automatico:0,liquidando:0,documentoId:this.idDocumentoCaixa,idDocumentoCaixa:this.idDocumentoCaixa},l={id:Object(b["uuid"])(),idFinanceiroMovimentacaoN:i,idEmpresa:this.idEmpresa,idFinanceiroPlanoConta:this.contaOrigem.id,dataEmissao:t,dataCompetencia:t,dataVencimento:t,dataMovimento:t,valorDebito:0,valorCredito:this.campos.valor,descricao:"Pagamento de despesa simples por ".concat(f["a"].usuario.logado.apelido," no Caixa #").concat(this.idDocumentoCaixa),observacao:"Liquidação Despesa Simples - Título",documentoTipo:"DespesaSimples",automatico:0,liquidando:0,documentoId:this.idDocumentoCaixa,idDocumentoCaixa:this.idDocumentoCaixa},f["a"].financeiroMovimentacaoN.grava({atual:{id:i}}),f["a"].financeiroTitulo.grava({atual:s}),f["a"].financeiroMovimentacao.grava({atual:c}),f["a"].financeiroMovimentacao.grava({atual:l}),this.eventoInput(!1),this.$q.notifyPositive("Despesa lançada com sucesso"),this.imprimir("titulo-recibo",o),a.next=32;break;case 29:a.prev=29,a.t0=a["catch"](1),this.$q.notifyError("Erro no lancamento de Despesa",a.t0);case 32:return a.prev=32,this.$q.loading.hide(),a.finish(32);case 35:case"end":return a.stop()}},a,this,[[1,29,32,35]])}));return function(e){return a.apply(this,arguments)}}(),abrirModalFinanceiroContas:function(){var a=c()(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:this.modalFinanceiroContas.filtros.despesa={idContatoEmpresa:this.idContatoEmpresa},this.modalFinanceiroContas.visivel=!0;case 2:case"end":return a.stop()}},a,this)}));return function(){return a.apply(this,arguments)}}(),selecionarFinanceiroConta:function(){var a=c()(regeneratorRuntime.mark(function a(e){return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:e.descricao=(e.descricao||"").trim(),this.contaDestino=e;case 2:case"end":return a.stop()}},a,this)}));return function(e){return a.apply(this,arguments)}}(),abrirModalContato:function(){var a=c()(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:this.modalContato=!0;case 1:case"end":return a.stop()}},a,this)}));return function(){return a.apply(this,arguments)}}(),selecionarContato:function(){var a=c()(regeneratorRuntime.mark(function a(e){var t;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,f["a"].contato.le({id:e});case 2:t=a.sent,t.nome=(t.nome||"").trim(),this.contato=t;case 5:case"end":return a.stop()}},a,this)}));return function(e){return a.apply(this,arguments)}}()},props:{idDocumentoCaixa:{required:!0,type:String},value:{required:!0,type:Boolean}},watch:{value:function(a){a&&this.atualizar()}}},ea=aa,ta=Object(q["a"])(ea,H,J,!1,null,null,null);ta.options.__file="CaixaDespesaLancar.vue";var oa=ta.exports,ia=t("ee4a"),na=t("1fe0c"),ra={components:{Campo:p["a"],CaixaAbrir:d["a"],CaixaConferencia:_,CaixaFechar:F["a"],CaixaTransferencia:j,CaixaSangriaLancar:M,CaixaSuprimentoLancar:L,CaixaDespesaLancar:oa,FaturaCard:ia["a"],VendaCard:na["a"]},data:function(){var a=this;return{idDocumentoCaixa:"",caixas:[],vendas:{},faturas:{},totalEmpresasPermitidas:[],intervaloAtualizar:void 0,intervaloCarregaCaixas:void 0,modalCaixaAbrir:!1,modalCaixaConferencia:!1,modalCaixaTransferencia:!1,modalCaixaSangriaLancar:!1,modalCaixaSuprimentoLancar:!1,modalCaixaDespesaLancar:!1,modalCaixaFechar:!1,tituloCaixaTransferencia:"",menuFaturamento:[{icone:"lock_open",rotulo:"Abrir caixa",manipulador:function(){a.modalCaixaAbrir=!0}},{icone:"attach_money",rotulo:"Suprimento",manipulador:function(){a.modalCaixaSuprimentoLancar=!0}},{icone:"money_off",rotulo:"Sangria",manipulador:function(){a.modalCaixaSangriaLancar=!0}},{icone:"payment",rotulo:"Despesa",manipulador:function(){a.modalCaixaDespesaLancar=!0}},{icone:"lock",rotulo:"Fechar caixa",manipulador:function(){a.modalCaixaFechar=!0}}]}},methods:{atualizar:function(){var a=c()(regeneratorRuntime.mark(function a(){var e=this;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:if(a.t0=!this.menuFaturamento.find(function(a){return"Imprimir Conferência de caixa"===a.rotulo}),!a.t0){a.next=5;break}return a.next=4,f["a"].permissao.objeto("Diretiva_Caixa_ImprimirConferenciaCaixa");case 4:a.t0=a.sent;case 5:if(!a.t0){a.next=7;break}this.menuFaturamento=r()(this.menuFaturamento).concat([{icone:"print",rotulo:"Imprimir Conferência de caixa",manipulador:function(){e.idDocumentoCaixa?e.imprimir("conferencia-de-caixa",e.idDocumentoCaixa):e.$q.notifyError("Caixa não selecionada")}}]);case 7:if(a.t1=!this.menuFaturamento.find(function(a){return"Reimprimir Conferência de caixa"===a.rotulo}),!a.t1){a.next=12;break}return a.next=11,f["a"].permissao.objeto("Diretiva_Caixa_VisualizaDiferenca");case 11:a.t1=a.sent;case 12:if(!a.t1){a.next=14;break}this.menuFaturamento=r()(this.menuFaturamento).concat([{icone:"print",rotulo:"Reimprimir Conferência de caixa",manipulador:function(){e.modalCaixaConferencia=!0}}]);case 14:return this.vendas={},this.faturas={},this.idDocumentoCaixa="",this.caixas=[],a.next=20,this.carregaCaixas();case 20:this.idDocumentoCaixa=(this.caixas[0]||{}).valor||"",this.idDocumentoCaixa&&this.carregarDocumentos();case 22:case"end":return a.stop()}},a,this)}));return function(){return a.apply(this,arguments)}}(),carregaCaixas:function(){var a=c()(regeneratorRuntime.mark(function a(){var e,t,o,i,n,r,s,c,l,u;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return e=f["a"].usuario.logado.codigoContato,a.prev=1,a.next=4,f["a"].permissao.objeto("Diretiva_Caixa_LivreUtilizacao");case 4:t=a.sent,t&&(e=""),a.next=11;break;case 8:a.prev=8,a.t0=a["catch"](1),this.$q.notify("Não foi possível recuperar informações de permissão.");case 11:return a.next=13,f["a"].caixa.le({aberto:!0});case 13:return a.t1=function(a){return!e||a.codigoContato===e},o=a.sent.filter(a.t1),a.next=17,f["a"].contatoBusca.filtrar(null,{ativo:!0,empresas:!0},0);case 17:if(a.t2=function(a){return a.id},i=a.sent.map(a.t2),o=o.filter(function(a){return i.includes(a.idEmpresa)}),!o.length){a.next=60;break}n=!0,r=!1,s=void 0,a.prev=24,c=o[Symbol.iterator]();case 26:if(n=(l=c.next()).done){a.next=46;break}return u=l.value,a.next=30,f["a"].caixa.le({id:u.idCaixa});case 30:if(a.t4=a.sent,a.t4){a.next=33;break}a.t4={};case 33:if(a.t3=a.t4.descricao,a.t3){a.next=36;break}a.t3="";case 36:a.t5=a.t3,a.t6=a.t5+" - Aberto em ",a.t7=this.$filters.dataHora(u.dataHoraEmissao),a.t8=a.t6+a.t7,a.t9="Reaberto"===u.status?" - Reaberto":"",u.rotulo=a.t8+a.t9,u.valor=u.id;case 43:n=!0,a.next=26;break;case 46:a.next=52;break;case 48:a.prev=48,a.t10=a["catch"](24),r=!0,s=a.t10;case 52:a.prev=52,a.prev=53,n||null==c.return||c.return();case 55:if(a.prev=55,!r){a.next=58;break}throw s;case 58:return a.finish(55);case 59:return a.finish(52);case 60:this.caixas=o.length?Object(h["orderBy"])(o,"dataHoraEmissao","desc"):[{rotulo:"Não há caixas abertos",valor:""}];case 61:case"end":return a.stop()}},a,this,[[1,8],[24,48,52,60],[53,,55,59]])}));return function(){return a.apply(this,arguments)}}(),carregarDocumentos:function(){var a=this;f["a"].documentoCondicaoPagamento.le({idDocumentoCaixa:this.idDocumentoCaixa}).then(function(){var e=c()(regeneratorRuntime.mark(function e(t){var o,i,n,r,s,c,l,d,m,v,p,b,x,C,g,q,k;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:o=[],t.reduce(function(a,e){return a.includes(e.idDocumento)||(a.push(e.idDocumento),o.push(f["a"].documento.le({id:e.idDocumento}))),a},[]),i=[],n=!0,r=!1,e.prev=5,c=u()(o);case 7:return e.next=9,c.next();case 9:return l=e.sent,n=l.done,e.next=13,l.value;case 13:if(d=e.sent,n){e.next=20;break}m=d,i.push(m);case 17:n=!0,e.next=7;break;case 20:e.next=26;break;case 22:e.prev=22,e.t0=e["catch"](5),r=!0,s=e.t0;case 26:if(e.prev=26,e.prev=27,n||null==c.return){e.next=31;break}return e.next=31,c.return();case 31:if(e.prev=31,!r){e.next=34;break}throw s;case 34:return e.finish(31);case 35:return e.finish(26);case 36:for(i=Object(h["orderBy"])(i,"dataHoraEmissao","desc"),v={},p={},b=!0,x=!1,C=void 0,e.prev=42,g=i[Symbol.iterator]();!(b=(q=g.next()).done);b=!0)k=q.value,"Venda"===k.tipo&&k.status&&(v[k.status]||(v[k.status]=[]),v[k.status].push(k)),"Fatura"===k.tipo&&k.status&&(p[k.status]||(p[k.status]=[]),p[k.status].push(k));e.next=50;break;case 46:e.prev=46,e.t1=e["catch"](42),x=!0,C=e.t1;case 50:e.prev=50,e.prev=51,b||null==g.return||g.return();case 53:if(e.prev=53,!x){e.next=56;break}throw C;case 56:return e.finish(53);case 57:return e.finish(50);case 58:a.vendas=v,a.vendas.encontradas=!!Object.keys(v).length,a.vendas.status=Object.keys(v).filter(function(a){return"encontradas"!==a}),a.faturas=p,a.faturas.encontradas=!!Object.keys(p).length,a.faturas.status=Object.keys(p).filter(function(a){return"encontradas"!==a});case 64:case"end":return e.stop()}},e,null,[[5,22,26,36],[27,,31,35],[42,46,50,58],[51,,53,57]])}));return function(a){return e.apply(this,arguments)}}())}},mounted:function(){var a=c()(regeneratorRuntime.mark(function a(){var e,t,o,i,n,r,s=this;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return this.caixas=[{rotulo:"Carregando caixas...",valor:""}],e=!1,a.next=4,f["a"].contatoBusca.filtrar(null,{ativo:!0,empresas:!0},0);case 4:t=a.sent,t.length?(this.atualizar(),e=!0):(o=0,this.intervaloAtualizar=setInterval(c()(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return o++,(o>60||t.length)&&(clearInterval(s.intervaloAtualizar),s.atualizar(),e=!0),a.next=4,f["a"].contatoBusca.filtrar(null,{ativo:!0,empresas:!0},0);case 4:t=a.sent;case 5:case"end":return a.stop()}},a)})),1e3)),i=0,n=500,r=function a(){s.intervaloCarregaCaixas=setInterval(c()(regeneratorRuntime.mark(function t(){var o;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!e){t.next=11;break}return i++,i>5&&(n=5e3,clearInterval(s.intervaloCarregaCaixas),a()),t.next=5,s.carregaCaixas();case 5:if(o=s.caixas.find(function(a){return a.valor===s.idDocumentoCaixa}),o){t.next=11;break}if(s.idDocumentoCaixa=(s.caixas[0]||{}).valor||"",!s.idDocumentoCaixa){t.next=11;break}return t.next=11,s.carregarDocumentos();case 11:case"end":return t.stop()}},t)})),n)},r();case 9:case"end":return a.stop()}},a,this)}));return function(){return a.apply(this,arguments)}}(),beforeDestroy:function(){this.intervaloAtualizar&&clearInterval(this.intervaloAtualizar),this.intervaloCarregaCaixas&&clearInterval(this.intervaloCarregaCaixas)}},sa=ra,ca=(t("3b28"),Object(q["a"])(sa,o,i,!1,null,"36fad9ec",null));ca.options.__file="CaixaEmpresas.vue";e["default"]=ca.exports},"3b28":function(a,e,t){"use strict";var o=t("c5a9"),i=t.n(o);i.a},"423ee":function(a,e,t){"use strict";var o=t("7985"),i=t.n(o);i.a},6622:function(a,e,t){"use strict";var o=t("0e0d"),i=t.n(o);i.a},7985:function(a,e,t){},c5a9:function(a,e,t){},c865:function(a,e,t){"use strict";var o=function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("q-modal",{attrs:{maximized:""},on:{show:a.mostrar,hide:a.fechar},model:{value:a.visibilidade.modal,callback:function(e){a.$set(a.visibilidade,"modal",e)},expression:"visibilidade.modal"}},[t("q-modal-layout",{staticClass:"bg-grey-4"},[t("q-toolbar",{attrs:{slot:"header"},slot:"header"},[t("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"arrow_back",round:""}}),t("q-toolbar-title",[a._v("Fatura")]),a.visibilidade.botao.salvar?t("q-btn",{staticClass:"q-ml-sm no-shadow",attrs:{color:"white","text-color":"primary",label:"Salvar"},on:{click:a.salvar}}):a._e(),a.visibilidade.botao.reabrir&&a.temPermissaoCorrigir?t("q-btn",{staticClass:"q-ml-sm no-shadow",attrs:{color:"white","text-color":"negative",label:"Corrigir"},on:{click:a.corrigir}}):a._e()],1),t("div",{staticClass:"layout-padding q-pa-none q-pb-xl"},[t("div",{staticClass:"u-container"},[a.carregando?a._e():t("div",[a.fatura.id?t("fatura",{ref:"fatura",attrs:{prop:{id:a.fatura.id},receberTitulo:a.receberTitulo},on:{executar:a.executar}}):a._e()],1),a.carregando?t("div",{staticClass:"q-mt-lg text-center"},[t("q-spinner",{attrs:{color:"faded",size:50}})],1):a._e()])]),t("q-toolbar",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[t("q-toolbar-title",{staticClass:"text-right"},[a.visibilidade.botao.reabrir?t("q-btn",{staticClass:"q-mx-md",attrs:{color:"negative",flat:"",label:"Reabrir"},on:{click:function(e){a.executar("reabrir")}}}):a._e(),a.visibilidade.botao.finalizar?t("q-btn",{attrs:{color:"primary",label:"Finalizar"},on:{click:function(e){a.executar("finalizar")}}}):a._e()],1)],1)],1)],1)},i=[];o._withStripped=!0;t("96cf");var n=t("c973"),r=t.n(n),s=function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"Fatura round-borders bg-grey-2 q-pb-sm"},[t("q-toolbar",{staticClass:"Fatura-barra bg-grey-2 q-py-md",attrs:{color:"black",inverted:""}},[t("q-toolbar-title",[t("div",{staticClass:"row items-center"},[t("avatar",{attrs:{imagem:(a.contatos[a.fatura.idContato]||{}).imagem,rotulo:a.fatura.descricaoContato,tamanho:"60"}}),t("div",{staticClass:"col q-ma-sm q-title"},[a._v(a._s(a.fatura.descricaoContato))])],1),t("div",{staticClass:"q-headline"})]),a.fatura.id?t("documento-codigo",{attrs:{documento:a.fatura}}):a._e(),t("q-btn",{attrs:{color:"primary",flat:"",icon:"print",round:""}},[t("q-popover",[t("q-list",{attrs:{link:"",separator:""}},[a._l(a.configImpressaoFatura,function(e){return t("q-item",{key:e.valor,nativeOn:{click:function(t){a.imprimir(e.valor,(a.fatura||{}).id||"0")}}},[t("q-item-side",{attrs:{icon:"print"}}),t("q-item-main",{attrs:{label:e.texto}})],1)}),"optisoul"===a.sistemaPai?a._l(a.configImpressaoEnvelope,function(e){return t("q-item",{key:e.valor,nativeOn:{click:function(t){a.imprimir(e.valor,(a.fatura||{}).id||"0")}}},[t("q-item-side",{attrs:{icon:"print"}}),t("q-item-main",{attrs:{label:e.texto}})],1)}):a._e(),a._l(a.configImpressaoCarne,function(e){return t("q-item",{key:e.valor,nativeOn:{click:function(t){a.imprimir(e.valor,(a.fatura||{}).id||"0")}}},[t("q-item-side",{attrs:{icon:"print"}}),t("q-item-main",{attrs:{label:e.texto}})],1)}),a._l(a.configImpressaoConvenio,function(e){return t("q-item",{key:e.valor,nativeOn:{click:function(t){a.imprimir(e.valor,(a.fatura||{}).id||"0")}}},[t("q-item-side",{attrs:{icon:"print"}}),t("q-item-main",{attrs:{label:e.texto}})],1)})],2)],1)],1),t("q-btn",{attrs:{color:"faded",flat:"",icon:"more_vert",round:""}},[t("q-popover",[t("q-list",{attrs:{link:"",separator:""}},[a.fatura.id?t("q-item",[t("q-item-side",{attrs:{icon:"account_balance"}}),t("q-item-main",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{label:"Emitir cupom"},nativeOn:{click:function(e){a.$refs.documentosFiscais.emitirCupom(a.fatura.id)}}})],1):a._e(),a.fatura.id&&a.$utils.mapearStatus(a.fatura).permiteNota?[t("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],nativeOn:{click:function(e){a.emitirNFeV2({idFatura:a.fatura.id},1,"Venda")}}},[t("q-item-side",{attrs:{icon:"account_balance"}}),t("q-item-main",{attrs:{label:"NFe de Saída/Venda"}})],1),t("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],nativeOn:{click:function(e){a.emitirNFeV2({idFatura:a.fatura.id},0,"Devolução")}}},[t("q-item-side",{attrs:{icon:"account_balance"}}),t("q-item-main",{attrs:{label:"NFe de Entrada/Devolução"}})],1),t("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],nativeOn:{click:function(e){a.emitirNFeV2({idFatura:a.fatura.id},1,"Remessa")}}},[t("q-item-side",{attrs:{icon:"account_balance"}}),t("q-item-main",{attrs:{label:"NFe de Remessa"}})],1)]:a._e()],2)],1)],1)],1),t("div",{staticClass:"bg-grey-2"},[t("documento-metas",{attrs:{slot:"subtitle",documento:a.fatura},slot:"subtitle"})],1),t("div",{staticClass:"q-ma-sm"},[a.vendas.length>0?t("p",{staticClass:"q-item-label ",staticStyle:{color:"#0c0c0c"}},[t("q-icon",{staticClass:"q-mr-md",staticStyle:{color:"#737373"},attrs:{name:"shopping_cart",size:"24px"}}),a._v(" Vendas\n    ")],1):a._e(),a._l(a.vendas,function(e){return t("div",{key:e.id,staticClass:"bg-white q-mt-sm round-borders"},[t("venda-card",{attrs:{id:e.id},on:{atualizar:a.atualizar,executar:a.executar}})],1)}),a.carnes.length>0?t("p",{staticClass:"q-item-label q-mt-md",staticStyle:{color:"#0c0c0c"}},[t("q-icon",{staticClass:"q-mr-md",staticStyle:{color:"#737373"},attrs:{name:"attach_money",size:"24px"}}),a._v(" Carnês\n    ")],1):a._e(),a._l(a.carnes,function(e){return t("div",{key:e.id,staticClass:"bg-white q-mt-sm round-borders"},[t("titulo-card",{staticClass:"q-mt-md",attrs:{dados:e},on:{executar:a.executar}})],1)})],2),t("div",{staticClass:"row"},[t("div",{staticClass:"col-12 col-lg-4 offset-lg-8 border-1 q-my-md"},[t("div",{staticClass:"row gutter-x-sm q-mb-sm"},[t("div",{staticClass:"col-4 col-lg-3",staticStyle:{"line-height":"35px"}},[a._v("Subtotal")]),t("strong",{staticClass:"col-8 text-right"},[a._v(a._s(a._f("numero")(a.fatura.subTotal,2)))])]),a.permissaoDesconto?t("div",{staticClass:"row gutter-x-sm"},[t("div",{staticClass:"col-4 col-lg-3",staticStyle:{"line-height":"50px"}},[a._v("Desconto")]),t("q-field",{staticClass:"col-3"},[t("campo",{attrs:{tipo:"decimal",decimals:"2",suffix:"%","somente-leitura":"Aberta"!==a.fatura.status,erro:a.erroCalculo},on:{input:function(e){a.calculaTotais("descontoPercentual")}},model:{value:a.fatura.totalPercentualDesconto,callback:function(e){a.$set(a.fatura,"totalPercentualDesconto",e)},expression:"fatura.totalPercentualDesconto"}})],1),t("q-field",{staticClass:"col-5"},[t("campo",{attrs:{tipo:"decimal",decimals:"2","somente-leitura":"Aberta"!==a.fatura.status,erro:a.erroCalculo,"erro-rotulo":a.erroCalculoMsg},on:{input:function(e){a.calculaTotais("desconto")}},model:{value:a.fatura.totalDesconto,callback:function(e){a.$set(a.fatura,"totalDesconto",e)},expression:"fatura.totalDesconto"}})],1)],1):a._e(),t("div",{staticClass:"row gutter-x-sm q-mt-sm"},[t("div",{staticClass:"col-4 col-lg-3",staticStyle:{"line-height":"35px"}},[a._v("Total")]),t("strong",{staticClass:"col-8 q-mt-sm text-right"},[a._v(a._s(a._f("numero")(a.fatura.totalDocumento,2)))])])])]),t("div",{staticClass:"Fatura-faturamento round-borders q-ma-sm q-pa-md"},[t("faturamento",{ref:"faturamento",attrs:{documento:a.fatura}})],1),t("div",{staticClass:" round-borders q-ma-sm q-pa-md"},[t("documentos-fiscais",{ref:"documentosFiscais",attrs:{idFatura:a.fatura.id}})],1)],1)},c=[];s._withStripped=!0;t("456d");var l=t("7037"),u=t.n(l),d=(t("2fdb"),t("cadf"),t("6762"),t("ac4d"),t("8a81"),t("ac6a"),t("3156")),m=t.n(d),v=t("448a"),p=t.n(v),f=(t("7514"),t("680c")),h=t.n(f),b=t("df3a"),x=t("88db"),C=t("5d5c"),g=t("a9d2"),q=t("e3f4"),k=t("dd9d"),_=t("1148"),F=t("d4aa"),y=t("1fe0c"),D=t("ed08"),w=t("8149"),E=t("3e8a"),O=t("2ef0"),P={components:{Avatar:b["a"],Campo:x["a"],DocumentoCodigo:C["a"],DocumentoMetas:g["a"],DocumentosFiscais:q["a"],Faturamento:_["a"],TituloCard:F["a"],VendaCard:y["a"]},computed:{config:function(){return w["a"].configuracoes.valores}},data:function(){return{dbUsuario:w["a"].usuario,contatos:{},faturaOriginal:{},fatura:{totalDocumento:0,subTotal:0,totalDesconto:0,totalPercentualDesconto:0},vendas:[],vendasOriginal:[],envelopes:[],envelopesOriginal:[],documentoItens:[],documentoItensOriginal:[],carnes:[],carnesOriginal:[],documentoStatus:[],erroCalculo:!1,erroCalculoMsg:"",sistemaPai:"",configImpressaoCarne:[],configImpressaoConvenio:[],configImpressaoFatura:[],configImpressaoEnvelope:[],permissaoDesconto:!1}},methods:{atualizar:function(){var a=r()(regeneratorRuntime.mark(function a(){var e,t,o,i=this;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,w["a"].permissao.objeto("Diretiva_Caixa_DescontoFatura");case 2:if(this.permissaoDesconto=a.sent,this.vendas=[],this.envelopes=[],this.envelopesOriginal=[],this.documentoItens=[],this.documentoitensOriginal=[],this.carnes=[],this.carnesOriginal=[],this.documentoStatus=[],this.contatos={},this.erroCalculo=!1,this.erroCalculoMsg="",!this.prop.id){a.next=45;break}return a.next=17,w["a"].fatura.leCompleto(this.prop.id);case 17:if(e=a.sent,this.faturaOriginal=Object(D["clonar"])(e.fatura),this.fatura=e.fatura,this.$refs.faturamento&&(this.$refs.faturamento.condicaoPagamentoOriginal=Object(D["clonar"])(e.condicaoPagamento),this.$refs.faturamento.condicaoPagamento=e.condicaoPagamento),this.vendasOriginal=Object(D["clonar"])(e.vendas),this.vendas=e.vendas,!this.receberTitulo.id||e.carnes.find(function(a){return a.id===i.receberTitulo.id})){a.next=29;break}return a.t0=e.carnes,a.next=27,w["a"].financeiroTitulo.le({id:this.receberTitulo.id});case 27:a.t1=a.sent,a.t0.push.call(a.t0,a.t1);case 29:if(this.carnesOriginal=Object(D["clonar"])(e.carnes),this.carnes=e.carnes,t={},!e.fatura.idContato){a.next=38;break}if(o=e.fatura.idContato,t[o]){a.next=38;break}return a.next=37,w["a"].contato.le({id:o});case 37:t[o]=a.sent;case 38:return this.configuraImpressaoCarne(e.fatura.idEmpresa),this.configuraImpressaoConvenio(e.fatura.idEmpresa),this.configuraImpressaoEnvelope(e.fatura.idEmpresa),this.configuraImpressaoFatura(e.fatura.idEmpresa),this.contatos=t,a.next=45,this.calculaTotais();case 45:case"end":return a.stop()}},a,this)}));return function(){return a.apply(this,arguments)}}(),executar:function(){var a=r()(regeneratorRuntime.mark(function a(e){var t;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:if("recalcular"!==e){a.next=11;break}if(!this.prop.id){a.next=9;break}return a.next=4,w["a"].fatura.leCompleto(this.prop.id);case 4:return t=a.sent,this.carnesOriginal=Object(D["clonar"])(t.carnes),this.carnes=t.carnes,a.next=9,this.calculaTotais();case 9:a.next=14;break;case 11:return a.next=13,this.atualizar();case 13:this.$emit("executar",e);case 14:case"end":return a.stop()}},a,this)}));return function(e){return a.apply(this,arguments)}}(),calculaTotais:function(){var a=r()(regeneratorRuntime.mark(function a(e){var t,o;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return t=Object(D["arredondar"])(this.vendas.reduce(function(a,e){return a+e.totalDocumento||0},0)),o=Object(D["arredondar"])(this.carnes.reduce(function(a,e){return a+e.valorARealizar||0},0)),e||(this.fatura.subTotal=Object(D["arredondar"])(t+o),e="desconto"),"descontoPercentual"===e&&(this.fatura.totalDesconto=Object(D["arredondar"])((this.fatura.totalPercentualDesconto||0)/100*this.fatura.subTotal)),"desconto"===e&&(this.fatura.totalPercentualDesconto=Object(D["arredondar"])((this.fatura.totalDesconto||0)/this.fatura.subTotal*100)),this.fatura.totalDocumento=Object(D["arredondar"])(this.fatura.subTotal-(this.fatura.totalDesconto||0)),this.erroCalculo=!1,this.erroCalculoMsg="",0!==this.fatura.totalDesconto&&this.fatura.totalDesconto>t&&(this.erroCalculo=!0,this.erroCalculoMsg="Desconto maior que o total das vendas"),0!==this.fatura.totalDesconto&&this.fatura.totalDocumento>this.fatura.subTotal&&(this.erroCalculo=!0),a.prev=10,a.next=13,this.$refs.faturamento.resumeCondicaoPagamento();case 13:return a.next=15,this.$refs.faturamento.atualizaValorRestante();case 15:return a.next=17,this.$refs.faturamento.redefinirCampos();case 17:a.next=21;break;case 19:a.prev=19,a.t0=a["catch"](10);case 21:case"end":return a.stop()}},a,this,[[10,19]])}));return function(e){return a.apply(this,arguments)}}(),configuraImpressaoConvenio:function(){var a=r()(regeneratorRuntime.mark(function a(e){var t;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,w["a"].configuracoes.porNome("impressao.convenio",e);case 2:t=a.sent,this.configImpressaoConvenio=p()(t.length?t.map(function(a){return m()({texto:"Imprimir Convênio"},a)}):[{valor:"convenio",texto:"Imprimir Convênio"}]);case 4:case"end":return a.stop()}},a,this)}));return function(e){return a.apply(this,arguments)}}(),configuraImpressaoCarne:function(){var a=r()(regeneratorRuntime.mark(function a(e){var t;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,w["a"].configuracoes.porNome("impressao.carne",e);case 2:t=a.sent,this.configImpressaoCarne=p()(t.length?t.map(function(a){return m()({texto:"Imprimir Carnê"},a)}):[{valor:"carne-crediario",texto:"Reimprimir carnê e notas promissórias da fatura"}]);case 4:case"end":return a.stop()}},a,this)}));return function(e){return a.apply(this,arguments)}}(),configuraImpressaoEnvelope:function(){var a=r()(regeneratorRuntime.mark(function a(e){var t;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,w["a"].configuracoes.porNome("impressao.envelope",e);case 2:t=a.sent,this.configImpressaoEnvelope=p()(t.length?t.map(function(a){return m()({texto:"Imprimir Envelope"},a)}):[{valor:"envelope",texto:"Imprimir Envelope"},{valor:"envelopeMini",texto:"Imprimir Envelope Mini"}]);case 4:case"end":return a.stop()}},a,this)}));return function(e){return a.apply(this,arguments)}}(),configuraImpressaoFatura:function(){var a=r()(regeneratorRuntime.mark(function a(e){var t;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,w["a"].configuracoes.porNome("impressao.fatura",e);case 2:t=a.sent,this.configImpressaoFatura=p()(t.length?t.map(function(a){return m()({texto:"Imprimir Fatura"},a)}):[{valor:"invoice",texto:"Fatura (Invoice)"},{valor:"fatura-recibo",texto:"Recibo"}]);case 4:case"end":return a.stop()}},a,this)}));return function(e){return a.apply(this,arguments)}}(),finalizar:function(){var a=r()(regeneratorRuntime.mark(function a(e){var t,o=this;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.delegateYield(regeneratorRuntime.mark(function a(){var t,i,n,r,s,c,l,u,d,m,v,p,f,h,b,x,C,g,q,k,_,F,y,P,j,T,S,R,z,$,M,B,I,V,N,A,L,H,J,U,W,Y,G,Q,K,X,Z,aa,ea,ta,oa,ia,na,ra,sa,ca,la,ua,da,ma,va,pa,fa,ha,ba,xa,Ca,ga,qa,ka,_a,Fa,ya,Da,wa,Ea,Oa,Pa,ja,Ta,Sa,Ra,za,$a,Ma,Ba,Ia,Va,Na,Aa,La,Ha,Ja,Ua,Wa,Ya,Ga,Qa,Ka,Xa,Za,ae,ee,te,oe,ie,ne,re,se,ce,le,ue,de,me,ve,pe,fe,he,be,xe,Ce,ge,qe,ke,_e,Fe,ye,De,we,Ee,Oe,Pe,je,Te,Se,Re,ze,$e,Me,Be,Ie,Ve,Ne,Ae,Le,He,Je;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:if(Object(D["verificarErro"])(o.erroCalculo,"Erro de cálculo encontrado."),e){a.next=10;break}return a.prev=2,a.next=5,o.$q.dialog({cancel:"Cancelar",message:"Esta ação irá finalizar esta fatura.",noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 5:a.next=10;break;case 7:return a.prev=7,a.t0=a["catch"](2),a.abrupt("return",{v:!1});case 10:return o.$q.loading.show({message:"Processando..."}),t=Object(D["clonar"])(o.fatura),i=Object(D["clonar"])(o.vendas),n=Object(D["clonar"])(o.carnes),a.next=16,o.$refs.faturamento.validar();case 16:if(r=Object(O["orderBy"])(o.$refs.faturamento.condicaoPagamento.filter(function(a){return a.valor}),["idFormaPagamento","autorizacao","dataVencimento"]),Object(D["verificarErro"])(i.find(function(a){return!a.dataHoraFinalizado}),"Existe pedido de venda sem data de finalização."),s=Object(D["arredondar"])(o.carnes.reduce(function(a,e){return a+(e.valorARealizar||0)},0)),c=Object(D["arredondar"])(r.reduce(function(a,e){return a+(e.valor||0)},0)),l=0,e&&(r=r.filter(function(a){return!o.$refs.faturamento.condicaoPagamentoOriginal.find(function(e){return e.id===a.id})})),!(t.totalDocumento>=0)){a.next=41;break}if(!o.carnes.length){a.next=40;break}if(!(c<s)){a.next=27;break}return o.$q.notify("Valor pago menor que a soma dos títulos à faturar!"),a.abrupt("return",{v:!1});case 27:return a.next=29,w["a"].permissao.objeto("Diretiva_Caixa_PagarCarneCartao");case 29:if(u=a.sent,u){a.next=40;break}d=r.reduce(function(a,e){var t="".concat(e.autorizacao||"").concat(e.documento||"").concat(e.idFormaPagamento);return a[t]||(a[t]={parcelas:0,formaPagamento:e.formaPagamento}),a[t].parcelas++,a},{}),a.t1=regeneratorRuntime.keys(d);case 33:if((a.t2=a.t1()).done){a.next=40;break}if(m=a.t2.value,!(d[m].parcelas>o.carnes.length)){a.next=38;break}return o.$q.notify("Quantidade de parcelas da forma de pagamento ".concat(d[m].formaPagamento," acima do permitido.")),a.abrupt("return",{v:!1});case 38:a.next=33;break;case 40:c<t.totalDocumento&&(l=1);case 41:return v=e?t.dataHoraFinalizado:Object(D["dataAtual"])(),p=v,a.next=45,w["a"].documento.le({id:o.$refs.faturamento.idDocumentoCaixa});case 45:if(f=a.sent,h=1===l?"Aguardando Pagamento":"Finalizada",o.documentoStatus=[],e){a.next=162;break}o.documentoStatus.push({id:Object(D["uuid"])(),idDocumento:t.id,operacao:"Fatura",statusOriginal:t.status,statusFinalizado:h,dataHoraEmissao:v,idUsuarioAlterou:w["a"].usuario.logado.id,idDocumentoCaixa:f.id||""}),t.status=h,t.dataHoraFinalizado=v,h="Faturado",b=0,x=!0,C=!1,g=void 0,a.prev=57,q=i[Symbol.iterator]();case 59:if(x=(k=q.next()).done){a.next=125;break}return _=k.value,o.documentoStatus.push({id:Object(D["uuid"])(),idDocumento:_.id,operacao:"Venda de Mercadoria",statusOriginal:_.status,statusFinalizado:h,dataHoraEmissao:v,idUsuarioAlterou:w["a"].usuario.logado.id,idDocumentoCaixa:f.id||""}),_.status=h,a.next=65,w["a"].documento.le({tipo:"Envelope",documentoId:_.id,documentoTipo:"Venda"});case 65:if(F=a.sent,o.envelopesOriginal=o.envelopesOriginal.concat(Object(D["clonar"])(F)),y=F.find(function(a){return"Entregue"!==a.status}),!y){a.next=97;break}return a.prev=69,o.$q.loading.hide(),a.next=73,o.$q.dialog({cancel:"Não",message:"Existe envelope(s) não entregue. Deseja dar baixa no(s) mesmo(s)?",noRefocus:!0,ok:"Sim",preventClose:!0,title:"Confirma?"});case 73:for(o.$q.loading.show({message:"Processando..."}),P=!0,j=!1,T=void 0,a.prev=77,S=F[Symbol.iterator]();!(P=(R=S.next()).done);P=!0)z=R.value,o.documentoStatus.push({id:Object(D["uuid"])(),idDocumento:z.id,operacao:"Envelope",statusOriginal:z.status,statusFinalizado:"Entregue",dataHoraEmissao:v,idUsuarioAlterou:w["a"].usuario.logado.id,idDocumentoCaixa:o.$refs.faturamento.idDocumentoCaixa}),z.status="Entregue",z.dataHoraFinalizado=Object(D["dataAtual"])();a.next=85;break;case 81:a.prev=81,a.t3=a["catch"](77),j=!0,T=a.t3;case 85:a.prev=85,a.prev=86,P||null==S.return||S.return();case 88:if(a.prev=88,!j){a.next=91;break}throw T;case 91:return a.finish(88);case 92:return a.finish(85);case 93:a.next=97;break;case 95:a.prev=95,a.t4=a["catch"](69);case 97:return o.envelopes=o.envelopes.concat(F),a.next=100,w["a"].documentoItem.le({idDocumento:_.id});case 100:for($=a.sent,o.documentoItensOriginal=o.documentoItensOriginal.concat(Object(D["clonar"])($)),M=!0,B=!1,I=void 0,a.prev=105,V=$[Symbol.iterator]();!(M=(N=V.next()).done);M=!0)A=N.value,A.status=h,A.total>0&&(A.quantidade=A.quantidade||1,A.valorItem=A.valorItem||0,A.descontoItem=A.descontoItem||0,A.descontoTotalRateado=A.descontoTotalRateado||0,t.subTotal=t.subTotal||0,t.totalDesconto=t.totalDesconto||0,L=A.valorItem*A.quantidade-A.descontoItem-A.descontoTotalRateado,H=Object(D["arredondar"])(t.totalDesconto*L/t.subTotal||0),A.descontoFaturaRateado=Object(D["arredondar"])(H),A.valorRealTotal=Object(D["arredondar"])(L-H),A.valorReal=Object(D["arredondar"])(A.valorRealTotal/A.quantidade),b+=H);a.next=113;break;case 109:a.prev=109,a.t5=a["catch"](105),B=!0,I=a.t5;case 113:a.prev=113,a.prev=114,M||null==V.return||V.return();case 116:if(a.prev=116,!B){a.next=119;break}throw I;case 119:return a.finish(116);case 120:return a.finish(113);case 121:o.documentoItens=o.documentoItens.concat($);case 122:x=!0,a.next=59;break;case 125:a.next=131;break;case 127:a.prev=127,a.t6=a["catch"](57),C=!0,g=a.t6;case 131:a.prev=131,a.prev=132,x||null==q.return||q.return();case 134:if(a.prev=134,!C){a.next=137;break}throw g;case 137:return a.finish(134);case 138:return a.finish(131);case 139:if(t.totalDesconto===Object(D["arredondar"])(b)){a.next=162;break}for(J=Object(D["arredondar"])((t.totalDesconto||0)-(b||0)),W=0,Y=!0,G=!1,Q=void 0,a.prev=145,K=o.documentoItens[Symbol.iterator]();!(Y=(X=K.next()).done);Y=!0)Z=X.value,Z.total>W&&(W=Z.total,U=Z);a.next=153;break;case 149:a.prev=149,a.t7=a["catch"](145),G=!0,Q=a.t7;case 153:a.prev=153,a.prev=154,Y||null==K.return||K.return();case 156:if(a.prev=156,!G){a.next=159;break}throw Q;case 159:return a.finish(156);case 160:return a.finish(153);case 161:U&&(aa=(U.descontoFaturaRateado||0)+(J||0),ea=(U.valorItem||0)*(U.quantidade||1)-(U.descontoItem||0)-(U.descontoTotalRateado||0)-(aa||0),ta=(ea||0)/(U.quantidade||1),U.descontoFaturaRateado=Object(D["arredondar"])(aa),U.valorReal=Object(D["arredondar"])(ta),U.valorRealTotal=Object(D["arredondar"])(ea));case 162:return a.t8=parseInt,a.next=165,w["a"].configuracoes.le({nome:"financeiro.planocontas.renegociacao"});case 165:return a.t9=a.sent[0].valor,oa=(0,a.t8)(a.t9),a.next=169,w["a"].financeiroPlanoConta.le({codigoFinanceiroPlanoConta:oa});case 169:return ia=a.sent,a.t10=parseInt,a.next=173,w["a"].configuracoes.le({nome:"financeiro.planocontas.duplicatareceber"});case 173:return a.t11=a.sent[0].valor,na=(0,a.t10)(a.t11),a.next=177,w["a"].financeiroPlanoConta.le({codigoFinanceiroPlanoConta:na});case 177:return ra=a.sent,a.t12=parseInt,a.next=181,w["a"].configuracoes.le({nome:"financeiro.planocontas.duplicatapagar"});case 181:return a.t13=a.sent[0].valor,sa=(0,a.t12)(a.t13),a.next=185,w["a"].financeiroPlanoConta.le({codigoFinanceiroPlanoConta:sa});case 185:return ca=a.sent,a.t14=parseInt,a.next=189,w["a"].configuracoes.le({nome:"financeiro.planocontas.cheque"});case 189:return a.t15=a.sent[0].valor,la=(0,a.t14)(a.t15),a.next=193,w["a"].financeiroPlanoConta.le({codigoFinanceiroPlanoConta:la});case 193:return ua=a.sent,a.t16=parseInt,a.next=197,w["a"].configuracoes.le({nome:"financeiro.planocontas.faturamentogeral"});case 197:return a.t17=a.sent[0].valor,da=(0,a.t16)(a.t17),a.next=201,w["a"].financeiroPlanoConta.le({codigoFinanceiroPlanoConta:da});case 201:return ma=a.sent,a.t18=parseInt,a.next=205,w["a"].configuracoes.le({nome:"financeiro.planocontas.comprageral"});case 205:return a.t19=a.sent[0].valor,va=(0,a.t18)(a.t19),a.next=209,w["a"].financeiroPlanoConta.le({codigoFinanceiroPlanoConta:va});case 209:return pa=a.sent,a.t20=parseInt,a.next=213,w["a"].configuracoes.le({nome:"financeiro.planocontas.frete"});case 213:return a.t21=a.sent[0].valor,fa=(0,a.t20)(a.t21),a.next=217,w["a"].financeiroPlanoConta.le({codigoFinanceiroPlanoConta:fa});case 217:return ha=a.sent,a.t22=parseInt,a.next=221,w["a"].configuracoes.le({nome:"financeiro.planocontas.cmv"});case 221:return a.t23=a.sent[0].valor,ba=(0,a.t22)(a.t23),a.next=225,w["a"].financeiroPlanoConta.le({codigoFinanceiroPlanoConta:ba});case 225:return xa=a.sent,a.t24=parseInt,a.next=229,w["a"].configuracoes.le({nome:"financeiro.planocontas.creditoclientes"});case 229:return a.t25=a.sent[0].valor,Ca=(0,a.t24)(a.t25),a.next=233,w["a"].financeiroPlanoConta.le({codigoFinanceiroPlanoConta:Ca});case 233:return ga=a.sent,a.next=236,w["a"].formaPagamento.le();case 236:qa=a.sent,ka=Object(D["arredondar"])(i.reduce(function(a,e){return a+e.totalDocumento},0)),ka=Object(D["arredondar"])(ka-t.totalDesconto),_a=t.totalDocumento,Fa=[],ya=[],Da=[],wa=[],Ea=[],Oa=1,Pa="",ja=1,Ta="",Sa=!0,Ra=!1,za=void 0,a.prev=252,$a=regeneratorRuntime.mark(function a(){var e,i,n,c,u,d,m,h,b,x,C,g,q,k,_,F,y,O,P,j,T,S,R,z,$,M,B;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:if(e=Ba.value,e.sinal=e.sinal||l,i=qa.filter(function(a){return a.id===e.idFormaPagamento})[0],!(_a<0)){a.next=9;break}Ta=Object(D["uuid"])(),ya.push({id:Object(D["uuid"])(),idFinanceiroMovimentacaoN:Ta,idContato:t.idContato,idEmpresa:t.idEmpresa,idFinanceiroPlanoConta:ma.id,dataEmissao:v,valorCredito:0,valorDebito:Object(D["arredondar"])(-1*_a),descricao:ma.descricao,observacao:"Movimentação de débito da devolução de clientes no(s) pedido(s) da fatura código (".concat(t.id,")"),automatico:0,liquidando:0,dataCompetencia:p,dataVencimento:e.dataVencimento,dataMovimento:e.dataVencimento,documentoTipo:"Fatura",documentoId:t.id,idDocumentoCaixa:f.id}),ya.push({id:Object(D["uuid"])(),idFinanceiroMovimentacaoN:Ta,idContato:t.idContato,idEmpresa:t.idEmpresa,idFinanceiroPlanoConta:ga.id,dataEmissao:v,valorCredito:Object(D["arredondar"])(-1*_a),valorDebito:0,descricao:"Crédito proveniente de produtos devolvidos no(s) pedido(s) da fatura código (".concat(t.id,")"),observacao:"Movimentação de crédito na conta de clientes",automatico:0,liquidando:0,dataCompetencia:p,dataVencimento:e.dataVencimento,dataMovimento:e.dataVencimento,documentoTipo:"Fatura",documentoId:t.id,idDocumentoCaixa:f.id}),a.next=65;break;case 9:if(Pa!==e.idFormaPagamento+e.autorizacao&&(Pa=e.idFormaPagamento+e.autorizacao,Oa=1,ja=r.reduce(function(a,e){return e.idFormaPagamento+e.autorizacao===Pa?a+1:a},0)),"Título Liquidado"===i.tipoFinanceiro&&(Ta=Object(D["uuid"])()),!(s>0)){a.next=25;break}if(n=Object(D["uuid"])(),c=Object(D["arredondar"])(e.valor*(s/_a)),u=0,d=0,m=0,h=0,5!==i.tipo){a.next=21;break}return a.next=18,Object(E["a"])().financeiroBanco.toArray();case 18:a.t0=function(a){return 122===a.codigoBanco},b=a.sent.find(a.t0),b&&(d=b.percentualMulta||0,h=b.percentualJuros||0,u=Object(D["arredondar"])(d/100*c),m=Object(D["arredondar"])(h/100*c));case 21:Fa.push({id:n,idFinanceiroPlanoConta:ia.id,idContato:t.idContato,dataEmissao:v,dataCompetencia:p,dataVencimento:e.dataVencimento,dataVencimentoOriginal:e.dataVencimento,valor:c,valorTotal:c,valorARealizar:c,valorMulta:u,percentualMulta:d,valorJuros:m,percentualJuros:h,documentoId:t.id,documentoTipo:"Fatura",parcela:Oa+"/"+ja,descricao:"Fatura de Venda Mercadoria",observacao:"".concat(o.$refs.faturamento.observacaoFaturamento||""," ").concat(e.observacao||"").trim(),documentoVinculado:1,receberPagar:1,valorDesconto:0,percentualDesconto:0,idEmpresa:t.idEmpresa,formaDePagamento:i.descricao,carne:5===i.tipo?1:0,dataEmissaoCarne:5===i.tipo?v:"",idDocumentoCaixa:f.id,idFinanceiroMovimentacaoAgrupamento:"Título Liquidado"===i.tipoFinanceiro?Ta:""}),e.idFinanceiroTitulo=n,2===i.tipo&&wa.push({idTitulo:n,idDocumentoCondicaoPagamento:e.id,valor:c,dataVencimento:e.dataVencimento,idBanco:e.idBanco,agencia:e.agencia,conta:e.conta,numeroCheque:e.numeroCheque,formaPagamento:i}),Ea.push({idTitulo:n,valor:c,desconto:0});case 25:if(!(ka>0)){a.next=38;break}if(x=Object(D["uuid"])(),C=Object(D["arredondar"])(e.valor*(ka/_a)),g=0,q=0,k=0,_=0,5!==i.tipo){a.next=35;break}return a.next=32,Object(E["a"])().financeiroBanco.toArray();case 32:a.t1=function(a){return 122===a.codigoBanco},F=a.sent.find(a.t1),F&&(q=F.percentualMulta||0,_=F.percentualJuros||0,g=Object(D["arredondar"])(q/100*C),k=Object(D["arredondar"])(_/100*C));case 35:Fa.push({id:x,idFinanceiroPlanoConta:ma.id,idContato:t.idContato,dataEmissao:v,dataCompetencia:p,dataVencimento:e.dataVencimento,dataVencimentoOriginal:e.dataVencimento,valor:C,valorTotal:C,valorARealizar:C,valorMulta:g,percentualMulta:q,valorJuros:k,percentualJuros:_,documentoId:t.id,documentoTipo:"Fatura",parcela:Oa+"/"+ja,descricao:"Fatura de Venda Mercadoria",observacao:"".concat(o.$refs.faturamento.observacaoFaturamento||""," ").concat(e.observacao||"").trim(),documentoVinculado:1,receberPagar:1,valorDesconto:0,percentualDesconto:0,idEmpresa:t.idEmpresa,formaDePagamento:i.descricao,carne:5===i.tipo?1:0,dataEmissaoCarne:5===i.tipo?v:"",idDocumentoCaixa:f.id,idFinanceiroMovimentacaoAgrupamento:"Título Liquidado"===i.tipoFinanceiro?Ta:""}),e.idFinanceiroTitulo=x,2===i.tipo&&wa.push({idTitulo:x,idDocumentoCondicaoPagamento:e.id,valor:C,dataVencimento:e.dataVencimento,idBanco:e.idBanco,agencia:e.agencia,conta:e.conta,numeroCheque:e.numeroCheque,formaPagamento:i});case 38:if(!("Título Liquidado"===i.tipoFinanceiro&&ka>=0)){a.next=49;break}return ya.push({id:Object(D["uuid"])(),idFinanceiroMovimentacaoN:Ta,idEmpresa:t.idEmpresa,idContato:t.idContato,idFinanceiroPlanoConta:ra.id,idFinanceiroTitulo:e.idFinanceiroTitulo,dataEmissao:v,valorCredito:e.valor,valorDebito:0,descricao:ra.descricao,observacao:"Liquidação referente título fatura (".concat(t.id,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:p,dataVencimento:e.dataVencimento,dataMovimento:e.dataVencimento,documentoTipo:"Fatura",documentoId:t.id,idDocumentoCaixa:f.id}),y=i.idFinanceiroPlanoConta,1===i.tipo&&(f||{}).idFinanceiroPlanoContaCaixa&&(y=f.idFinanceiroPlanoContaCaixa),a.next=44,w["a"].financeiroPlanoConta.le({id:y});case 44:for(O=a.sent,ya.push({id:Object(D["uuid"])(),idFinanceiroMovimentacaoN:Ta,idEmpresa:t.idEmpresa,idContato:t.idContato,idFinanceiroPlanoConta:O.id,idFinanceiroTitulo:e.idFinanceiroTitulo,dataEmissao:v,valorCredito:0,valorDebito:e.valor,descricao:O.descricao,observacao:"Liquidação referente título fatura (".concat(t.id,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:p,dataVencimento:e.dataVencimento,dataMovimento:e.dataVencimento,documentoTipo:"Fatura",documentoId:t.id,idDocumentoCaixa:f.id}),P=0;P<Fa.length;P++)j=Fa[P],j.idFinanceiroMovimentacaoAgrupamento===Ta&&(j.valorRealizado=j.valorARealizar,j.dataPagamento=e.dataVencimento,j.dataMovimento=e.dataVencimento,j.idDocumentoCaixaLiquidacao=f.id);a.next=49;break;case 49:if(!i.aliquota){a.next=64;break}if(T=Object(D["uuid"])(),S=Object(D["arredondar"])(e.valor*(i.aliquota/100)),Fa.push({id:T,idFinanceiroPlanoConta:i.idFinanceiroPlanoContaAliquota,idContato:i.idContatoOperadoraCartao,dataEmissao:v,dataCompetencia:p,dataVencimento:e.dataVencimento,dataVencimentoOriginal:e.dataVencimento,valor:S,valorTotal:S,valorARealizar:S,valorMulta:0,percentualJuros:0,documentoId:t.id,documentoTipo:"Fatura",parcela:Oa+"/"+ja,descricao:"Título referente a alíquota da forma de pagamento: ".concat(i.descricao),observacao:"Título referente a alíquota. ".concat(o.$refs.faturamento.observacaoFaturamento||""," ").concat(e.observacao||"").trim(),documentoVinculado:1,receberPagar:0,valorDesconto:0,percentualDesconto:0,idEmpresa:t.idEmpresa,formaDePagamento:i.descricao,idDocumentoCaixa:f.id}),e.idFinanceiroTituloPagar=T,"Título Liquidado"!==i.tipoFinanceiro){a.next=64;break}return R=Object(D["uuid"])(),ya.push({id:Object(D["uuid"])(),idFinanceiroMovimentacaoN:R,idEmpresa:t.idEmpresa,idFinanceiroPlanoConta:ca.id,dataEmissao:v,valorCredito:0,valorDebito:S,descricao:ca.descricao,observacao:"Liquidação alíquota cartão referente fatura (".concat(t.id,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:p,dataVencimento:e.dataVencimento,dataMovimento:e.dataVencimento,documentoTipo:"Fatura",documentoId:t.id,idFinanceiroTitulo:T,idContato:i.idContatoOperadoraCartao,idDocumentoCaixa:f.id}),z=i.idFinanceiroPlanoConta,1===i.tipo&&(f||{}).idFinanceiroPlanoContaCaixa&&(z=f.idFinanceiroPlanoContaCaixa),a.next=61,w["a"].financeiroPlanoConta.le({id:z});case 61:for($=a.sent,ya.push({id:Object(D["uuid"])(),idFinanceiroMovimentacaoN:R,idEmpresa:t.idEmpresa,idFinanceiroPlanoConta:$.id,dataEmissao:v,valorCredito:S,valorDebito:0,descricao:$.descricao,observacao:"Liquidação alíquota cartão referente fatura (".concat(t.id,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:p,dataVencimento:e.dataVencimento,dataMovimento:e.dataVencimento,documentoTipo:"Fatura",documentoId:t.id,idFinanceiroTitulo:T,idContato:i.idContatoOperadoraCartao,idDocumentoCaixa:f.id}),M=0;M<Fa.length;M++)B=Fa[M],B.id===T&&(B.idFinanceiroMovimentacaoAgrupamento=R,B.valorRealizado=S,B.dataPagamento=e.dataVencimento,B.dataMovimento=e.dataVencimento,B.idDocumentoCaixaLiquidacao=f.id);case 64:Oa++;case 65:case"end":return a.stop()}},a)}),Ma=r.filter(function(a){return!a.sinal})[Symbol.iterator]();case 255:if(Sa=(Ba=Ma.next()).done){a.next=260;break}return a.delegateYield($a(),"t26",257);case 257:Sa=!0,a.next=255;break;case 260:a.next=266;break;case 262:a.prev=262,a.t27=a["catch"](252),Ra=!0,za=a.t27;case 266:a.prev=266,a.prev=267,Sa||null==Ma.return||Ma.return();case 269:if(a.prev=269,!Ra){a.next=272;break}throw za;case 272:return a.finish(269);case 273:return a.finish(266);case 274:Ia=[],Va=function(){for(var a=wa[Na],e=Object(D["uuid"])(),o=Object(D["uuid"])(),i=0;i<Fa.length;i++){var n=Fa[i];n.id===a.idTitulo&&(n.idFinanceiroMovimentacaoAgrupamento=o,n.valorRealizado=n.valorARealizar,n.dataPagamento=a.dataVencimento,n.dataMovimento=a.dataVencimento,n.idDocumentoCaixaLiquidacao=f.id)}if(Ia.includes(a.idDocumentoCondicaoPagamento))return"continue";Ia.push(a.idDocumentoCondicaoPagamento);var r=Object(D["arredondar"])(wa.reduce(function(e,t){return t.idDocumentoCondicaoPagamento===a.idDocumentoCondicaoPagamento&&(e+=e+(t.valor||0)),e},0));Fa.push({id:e,idFinanceiroPlanoConta:ia.id,idContato:t.idContato,dataEmissao:v,dataCompetencia:p,dataVencimento:a.dataVencimento,dataVencimentoOriginal:a.dataVencimento,valor:r,valorTotal:r,valorARealizar:r,valorMulta:0,percentualJuros:0,receberPagar:1,valorDesconto:0,percentualDesconto:0,documentoId:t.id,documentoTipo:"Fatura",idEmpresa:t.idEmpresa,formaDePagamento:a.formaPagamento.descricao,idDocumentoCaixa:f.id,cheque:1,idBanco:a.idBanco,agencia:a.agencia,conta:a.conta,numeroCheque:a.numeroCheque,observacao:"Liquidação de Cheques da Fatura #".concat(t.id," - CódigoN #").concat(o),descricao:"Cheque"}),ya.push({id:Object(D["uuid"])(),idFinanceiroMovimentacaoN:o,idEmpresa:t.idEmpresa,idContato:t.idContato,idFinanceiroPlanoConta:ua.id,idFinanceiroTitulo:e,dataEmissao:v,valorCredito:0,valorDebito:r,descricao:"Cheque - Crédito de títulos a receber",observacao:"Crédito de títulos a receber",automatico:0,liquidando:0,dataCompetencia:p,dataVencimento:a.dataVencimento,dataMovimento:a.dataVencimento,idFinanceiroCheque:e,idDocumentoCaixa:f.id}),ya.push({id:Object(D["uuid"])(),idFinanceiroMovimentacaoN:o,idEmpresa:t.idEmpresa,idContato:t.idContato,idFinanceiroPlanoConta:ra.id,idFinanceiroTitulo:e,dataEmissao:v,valorCredito:r,valorDebito:0,descricao:ra.descricao,observacao:"Contabilização automática",automatico:0,liquidando:0,dataCompetencia:p,dataVencimento:a.dataVencimento,dataMovimento:a.dataVencimento,idFinanceiroCheque:e,idDocumentoCaixa:f.id})},Na=0;case 277:if(!(Na<wa.length)){a.next=284;break}if(Aa=Va(),"continue"!==Aa){a.next=281;break}return a.abrupt("continue",281);case 281:Na++,a.next=277;break;case 284:if(!(s>0)){a.next=326;break}for(La=Object(D["uuid"])(),ya.push({id:Object(D["uuid"])(),idFinanceiroMovimentacaoN:La,idEmpresa:t.idEmpresa,idContato:t.idContato,idFinanceiroPlanoConta:ra.id,dataEmissao:v,valorCredito:s,valorDebito:0,descricao:ra.descricao,observacao:"Contabilização automática",automatico:1,liquidando:0,dataCompetencia:p,dataVencimento:v,dataMovimento:v,idDocumentoCaixa:f.id}),ya.push({id:Object(D["uuid"])(),idFinanceiroMovimentacaoN:La,idEmpresa:t.idEmpresa,idContato:t.idContato,idFinanceiroPlanoConta:ia.id,dataEmissao:v,valorCredito:0,valorDebito:s,descricao:ia.descricao,observacao:"Contabilização automática - Complemento",automatico:0,liquidando:0,dataCompetencia:p,dataVencimento:v,dataMovimento:v,documentoTipo:"Renegociação",documentoId:La,idDocumentoCaixa:f.id}),Ha=0;Ha<Ea.length;Ha++)Ja=Ea[Ha],Da.push({idFinanceiroMovimentacaoN:La,idFinanceiroTitulo:Ja.idTitulo,dataVencimento:v,valorOriginal:Ja.valor,valorDesconto:Ja.desconto,valorTotal:Object(D["arredondar"])(Ja.valor-Ja.desconto)});Ua=!0,Wa=!1,Ya=void 0,a.prev=292,Ga=n[Symbol.iterator]();case 294:if(Ua=(Qa=Ga.next()).done){a.next=311;break}if(Ka=Qa.value,Ka.idFinanceiroMovimentacaoAgrupamento=La,Ka.idDocumentoCaixaLiquidacao=f.id,Ka.dataPagamento=v,Ka.dataMovimento=v,Ka.renegociado=1,1!==Ka.cheque){a.next=304;break}return Ka.valorRealizado=Ka.valor,a.abrupt("continue",308);case 304:if(Ka.valorARealizar){a.next=307;break}return Ka.valorRealizado=Ka.valorTotal,a.abrupt("continue",308);case 307:Ka.valorRealizado=Ka.valorARealizar;case 308:Ua=!0,a.next=294;break;case 311:a.next=317;break;case 313:a.prev=313,a.t28=a["catch"](292),Wa=!0,Ya=a.t28;case 317:a.prev=317,a.prev=318,Ua||null==Ga.return||Ga.return();case 320:if(a.prev=320,!Wa){a.next=323;break}throw Ya;case 323:return a.finish(320);case 324:return a.finish(317);case 325:Fa=Fa.concat(n);case 326:if(0!==l){a.next=494;break}if(Xa=Object(D["uuid"])(),Za=t.valorFrete||0,ae=0,ee=0,te=[],Za>0&&(ya.push({id:Object(D["uuid"])(),idFinanceiroMovimentacaoN:Xa,idEmpresa:t.idEmpresa,idFinanceiroPlanoConta:ma.id,dataEmissao:v,valorCredito:0,valorDebito:Za,descricao:ma.descricao,observacao:"Lançamento frete da fatura (".concat(t.id,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:p,dataVencimento:v,dataMovimento:v,documentoTipo:"Fatura",documentoId:t.id,idDocumentoCaixa:f.id}),ya.push({id:Object(D["uuid"])(),idFinanceiroMovimentacaoN:Xa,idEmpresa:t.idEmpresa,idFinanceiroPlanoConta:ha.id,dataEmissao:v,valorCredito:Za,valorDebito:0,descricao:ha.descricao,observacao:"Lançamento frete da fatura (".concat(t.id,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:p,dataVencimento:v,dataMovimento:v,documentoTipo:"Fatura",documentoId:t.id,idDocumentoCaixa:f.id})),e){a.next=494;break}Xa=Object(D["uuid"])(),oe=!0,ie=!1,ne=void 0,a.prev=338,re=o.documentoItens[Symbol.iterator]();case 340:if(oe=(se=re.next()).done){a.next=425;break}return ce=se.value,le="",ue={},de="",me={},ve="",pe={},a.next=350,w["a"].item.leNew({id:ce.idItem});case 350:if(fe=a.sent,le=ce.idPlanoContaEstoque,le){a.next=357;break}return a.next=355,w["a"].perfilContabilItem.le({idPerfilContabil:fe.idPerfilContabil,idCfop:ce.idCfop,and:{idPerfilContabil:fe.idPerfilContabil,idCfop:ce.idCfop}});case 355:he=a.sent,he.length&&he[0].idPlanoContaEstoque&&(le=he[0].idPlanoContaEstoque);case 357:if(!le&&pa.id&&(le=pa.id),le||!ce.idCfop){a.next=363;break}return a.next=361,w["a"].cfop.le({id:ce.idCfop});case 361:be=a.sent,le=be.idPlanoContaEstoque;case 363:return a.next=365,w["a"].financeiroPlanoConta.le({id:le});case 365:if(ue=a.sent,ue.id){a.next=369;break}return o.$q.notify("Não foi possível localizar Conta de Estoque."),a.abrupt("return",{v:void 0});case 369:if(de="",de){a.next=375;break}return a.next=373,w["a"].perfilContabilItem.le({idPerfilContabil:fe.idPerfilContabil,idCfop:ce.idCfop,and:{idPerfilContabil:fe.idPerfilContabil,idCfop:ce.idCfop}});case 373:xe=a.sent,xe.length&&xe[0].idPlanoContaDespesa&&(de=xe[0].idPlanoContaDespesa);case 375:if(!de&&xa.id&&(de=xa.id),de||!ce.idCfop){a.next=381;break}return a.next=379,w["a"].cfop.le({id:ce.idCfop});case 379:Ce=a.sent,de=Ce.idPlanoContaDestino;case 381:return a.next=383,w["a"].financeiroPlanoConta.le({id:de});case 383:if(me=a.sent,me.id){a.next=387;break}return o.$q.notify("Não foi possível localizar Conta de Despesa."),a.abrupt("return",{v:void 0});case 387:if(ge=Object(D["arredondar"])(ce.total-(ce.descontoTotalRateado||0)-(ce.descontoFaturaRateado||0)),qe=Object(D["arredondar"])(ce.valorCustoMedio*ce.quantidade),!qe){a.next=422;break}if(ce.operacaoFator<0?(ya.push({id:Object(D["uuid"])(),idFinanceiroMovimentacaoN:Xa,idEmpresa:t.idEmpresa,idFinanceiroPlanoConta:ue.id,dataEmissao:ce.dataHoraFinalizado||v,valorCredito:qe,valorDebito:0,descricao:ue.descricao,observacao:"Movimentações de CMV referente fatura (".concat(t.id,") e item (").concat(ce.idItem,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:p,dataVencimento:v,dataMovimento:v,documentoTipo:t.tipo,documentoId:t.id,idDocumentoCaixa:f.id}),ya.push({id:Object(D["uuid"])(),idFinanceiroMovimentacaoN:Xa,idEmpresa:t.idEmpresa,idFinanceiroPlanoConta:me.id,dataEmissao:ce.dataHoraFinalizado||v,valorCredito:0,valorDebito:qe,descricao:me.descricao,observacao:"Movimentações de CMV referente fatura (".concat(t.id,") e item (").concat(ce.idItem,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:p,dataVencimento:v,dataMovimento:v,documentoTipo:t.tipo,documentoId:t.id,idDocumentoCaixa:f.id})):(ya.push({id:Object(D["uuid"])(),idFinanceiroMovimentacaoN:Xa,idEmpresa:t.idEmpresa,idFinanceiroPlanoConta:ue.id,dataEmissao:ce.dataHoraFinalizado||v,valorCredito:0,valorDebito:qe,descricao:ue.descricao,observacao:"Movimentações de CMV referente fatura (".concat(t.id,") e item (").concat(ce.idItem,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:p,dataVencimento:v,dataMovimento:v,documentoTipo:t.tipo,documentoId:t.id,idDocumentoCaixa:f.id}),ya.push({id:Object(D["uuid"])(),idFinanceiroMovimentacaoN:Xa,idEmpresa:t.idEmpresa,idFinanceiroPlanoConta:me.id,dataEmissao:ce.dataHoraFinalizado||v,valorCredito:qe,valorDebito:0,descricao:me.descricao,observacao:"Movimentações de CMV referente fatura (".concat(t.id,") e item (").concat(ce.idItem,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:p,dataVencimento:v,dataMovimento:v,documentoTipo:t.tipo,documentoId:t.id,idDocumentoCaixa:f.id})),ve=ce.idPlanoContaDestino,ve){a.next=397;break}return a.next=395,w["a"].perfilContabilItem.le({idPerfilContabil:fe.idPerfilContabil,idCfop:ce.idCfop,and:{idPerfilContabil:fe.idPerfilContabil,idCfop:ce.idCfop}});case 395:ke=a.sent,ke.length&&ke[0].idPlanoContaDespesa&&(ve=ke[0].idPlanoContaDespesa);case 397:if(!ve&&xa.id&&(ve=xa.id),ve||!ce.idCfop){a.next=403;break}return a.next=401,w["a"].cfop.le({id:ce.idCfop});case 401:_e=a.sent,ve=_e.idPlanoContaDestino;case 403:return a.next=405,w["a"].financeiroPlanoConta.le({id:ve});case 405:if(pe=a.sent,pe.id){a.next=409;break}return o.$q.notify("Não foi possível localizar Conta de Receita."),a.abrupt("return",{v:void 0});case 409:Fe=!0,ye=0;case 411:if(!(ye<te.length)){a.next=420;break}if(De=te[ye],De.idPlanoContaDestino!==pe.id||De.idPlanoContaEstoque!==ue.id){a.next=417;break}return De.valor=Object(D["arredondar"])(De.valor+ge),Fe=!1,a.abrupt("break",420);case 417:ye++,a.next=411;break;case 420:Fe&&te.push({idPlanoContaDestino:pe.id,idPlanoContaEstoque:ue.id,valor:ge}),ae+=ge;case 422:oe=!0,a.next=340;break;case 425:a.next=431;break;case 427:a.prev=427,a.t29=a["catch"](338),ie=!0,ne=a.t29;case 431:a.prev=431,a.prev=432,oe||null==re.return||re.return();case 434:if(a.prev=434,!ie){a.next=437;break}throw ne;case 437:return a.finish(434);case 438:return a.finish(431);case 439:for(we=0;we<te.length;we++)Ee=te[we],Ee.valor<0&&(ee+=Ee.valor);Oe=0;case 441:if(!(Oe<te.length)){a.next=494;break}if(Pe=te[Oe],!(Pe.valor>0)){a.next=491;break}return a.next=446,w["a"].financeiroPlanoConta.le({id:Pe.idPlanoContaDestino});case 446:if(je=a.sent,Te=Object(D["arredondar"])(ee*(Pe.valor/(ae||1))),!(Te>0)){a.next=472;break}for(ya.push({id:Object(D["uuid"])(),idFinanceiroMovimentacaoN:Xa,idEmpresa:t.idEmpresa,idFinanceiroPlanoConta:ma.id,dataEmissao:v,valorCredito:0,valorDebito:Te,descricao:ma.descricao,observacao:"Lançamento entrada faturamento geral da devolução referente fatura (".concat(t.id,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:p,dataVencimento:v,dataMovimento:v,documentoTipo:"Fatura",documentoId:t.id,idDocumentoCaixa:f.id}),ya.push({id:Object(D["uuid"])(),idFinanceiroMovimentacaoN:Xa,idEmpresa:t.idEmpresa,idFinanceiroPlanoConta:je.id,dataEmissao:v,valorCredito:Te,valorDebito:0,descricao:je.descricao,observacao:"Lançamento saída na conta de destino referente fatura (".concat(t.id,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:p,dataVencimento:v,dataMovimento:v,documentoTipo:"Fatura",documentoId:t.id,idDocumentoCaixa:f.id}),Se=!0,Re=!1,ze=void 0,a.prev=454,$e=r[Symbol.iterator]();!(Se=(Me=$e.next()).done);Se=!0)Be=Me.value,ya.push({id:Object(D["uuid"])(),idFinanceiroMovimentacaoN:Xa,idEmpresa:t.idEmpresa,idFinanceiroPlanoConta:ma.id,dataEmissao:v,valorCredito:0,valorDebito:Object(D["arredondar"])((Pe.valor-Te)*(Be.valor/(_a||1))),descricao:ma.descricao,observacao:"Lançamento saída na conta de faturamento geral referente fatura (".concat(t.id,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:p,dataVencimento:Be.dataVencimento,dataMovimento:Be.dataVencimento,documentoTipo:"Fatura",documentoId:t.id,idDocumentoCaixa:f.id}),ya.push({id:Object(D["uuid"])(),idFinanceiroMovimentacaoN:Xa,idEmpresa:t.idEmpresa,idFinanceiroPlanoConta:je.id,dataEmissao:v,valorCredito:Object(D["arredondar"])((Pe.valor-Te)*(Be.valor/(_a||1))),valorDebito:0,descricao:je.descricao,observacao:"Lançamento entrada na conta de venda do produto referente fatura (".concat(t.id,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:p,dataVencimento:Be.dataVencimento,dataMovimento:Be.dataVencimento,documentoTipo:"Fatura",documentoId:t.id,idDocumentoCaixa:f.id});a.next=462;break;case 458:a.prev=458,a.t30=a["catch"](454),Re=!0,ze=a.t30;case 462:a.prev=462,a.prev=463,Se||null==$e.return||$e.return();case 465:if(a.prev=465,!Re){a.next=468;break}throw ze;case 468:return a.finish(465);case 469:return a.finish(462);case 470:a.next=491;break;case 472:for(Ie=!0,Ve=!1,Ne=void 0,a.prev=475,Ae=r[Symbol.iterator]();!(Ie=(Le=Ae.next()).done);Ie=!0)He=Le.value,Je=Object(D["arredondar"])(Pe.valor*(He.valor/(_a||1))),ya.push({id:Object(D["uuid"])(),idFinanceiroMovimentacaoN:Xa,idEmpresa:t.idEmpresa,idFinanceiroPlanoConta:ma.id,dataEmissao:v,valorCredito:0,valorDebito:Je,descricao:ma.descricao,observacao:"Lançamento saída na conta de faturamento geral referente fatura (".concat(t.id,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:p,dataVencimento:He.dataVencimento,dataMovimento:He.dataVencimento,documentoTipo:"Fatura",documentoId:t.id,idDocumentoCaixa:f.id}),ya.push({id:Object(D["uuid"])(),idFinanceiroMovimentacaoN:Xa,idEmpresa:t.idEmpresa,idFinanceiroPlanoConta:je.id,dataEmissao:v,valorCredito:Je,valorDebito:0,descricao:je.descricao,observacao:"Lançamento entrada na conta de venda do produto referente fatura (".concat(t.id,") - contabilização automática"),automatico:0,liquidando:0,dataCompetencia:p,dataVencimento:He.dataVencimento,dataMovimento:He.dataVencimento,documentoTipo:"Fatura",documentoId:t.id,idDocumentoCaixa:f.id});a.next=483;break;case 479:a.prev=479,a.t31=a["catch"](475),Ve=!0,Ne=a.t31;case 483:a.prev=483,a.prev=484,Ie||null==Ae.return||Ae.return();case 486:if(a.prev=486,!Ve){a.next=489;break}throw Ne;case 489:return a.finish(486);case 490:return a.finish(483);case 491:Oe++,a.next=441;break;case 494:if(o.financeiroTitulo=Fa,o.financeiroMovimentacao=ya,o.financeiroRenegociacao=Da,o.fatura=t,o.vendas=i,o.carnes=n,e){a.next=507;break}return a.next=503,o.salvarFatura();case 503:if(!o.vendas.length){a.next=506;break}return a.next=506,o.$refs.documentosFiscais.emitirCupom(o.fatura.id);case 506:o.$q.notifyPositive("Fatura finalizada");case 507:return a.abrupt("return",{v:!0});case 508:case"end":return a.stop()}},a,null,[[2,7],[57,127,131,139],[69,95],[77,81,85,93],[86,,88,92],[105,109,113,121],[114,,116,120],[132,,134,138],[145,149,153,161],[154,,156,160],[252,262,266,274],[267,,269,273],[292,313,317,325],[318,,320,324],[338,427,431,439],[432,,434,438],[454,458,462,470],[463,,465,469],[475,479,483,491],[484,,486,490]])})(),"t0",2);case 2:if(t=a.t0,"object"!==u()(t)){a.next=5;break}return a.abrupt("return",t.v);case 5:a.next=10;break;case 7:a.prev=7,a.t1=a["catch"](0),this.$q.notifyError("Não foi possível finalizar a fatura",a.t1);case 10:return a.prev=10,this.$q.loading.hide(),a.finish(10);case 13:case"end":return a.stop()}},a,this,[[0,7,10,13]])}));return function(e){return a.apply(this,arguments)}}(),reabrir:function(){var a=r()(regeneratorRuntime.mark(function a(e){var t,o,i,n,r,s,c,l,d,v,f,b,x=this;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:if(e){a.next=13;break}return a.next=3,w["a"].documentoSat.le({idDocumento:this.fatura.id});case 3:return t=a.sent,o=t.filter(function(a){return a.cancelamento}).map(function(a){return a.chaveCupomCancelado}),i=t.filter(function(a){return!o.includes(a.chaveCupom)}),n=i.filter(function(a){return!a.cancelamento}),a.next=9,w["a"].documentoFiscalEletronico.le({idDocumento:this.fatura.id,situacao:"Emitido"});case 9:if(r=a.sent,!n.length&&!r.length){a.next=13;break}return this.$q.notify("Documento fiscal emitido. Operação não permitida."),a.abrupt("return");case 13:if(e){a.next=22;break}return a.prev=14,a.next=17,this.$q.dialog({cancel:"Cancelar",message:"Esta ação irá reabrir esta fatura",noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 17:a.next=22;break;case 19:return a.prev=19,a.t0=a["catch"](14),a.abrupt("return",!1);case 22:return a.prev=22,a.delegateYield(regeneratorRuntime.mark(function a(){var t,o,i,n,r,u,b,C,g,q,k,_,F,y,O,P,j,T,S,R,z,$,M,B,I,V,N,A,L,H,J,U,W,Y,G,Q,K,X,Z,aa,ea,ta,oa,ia,na,ra,sa,ca,la,ua,da,ma,va,pa,fa,ha,ba,xa,Ca,ga,qa,ka,_a,Fa,ya,Da,wa,Ea,Oa,Pa,ja,Ta,Sa,Ra,za,$a,Ma,Ba,Ia,Va,Na,Aa,La,Ha,Ja,Ua,Wa,Ya,Ga,Qa,Ka,Xa,Za,ae,ee,te,oe,ie,ne,re,se,ce,le,ue,de,me,ve,pe,fe,he,be,xe,Ce,ge,qe,ke,_e,Fe,ye,De,we,Ee,Oe,Pe,je,Te,Se,Re,ze,$e,Me,Be,Ie,Ve,Ne,Ae,Le,He,Je,Ue,We,Ye,Ge,Qe,Ke,Xe,Ze,at,et,tt,ot,it,nt;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:if(x.$q.loading.show({message:"Processando..."}),t=Object(D["clonar"])(x.fatura),o=Object(D["clonar"])(x.vendas),i=Object(D["clonar"])(x.envelopes),n=Object(D["clonar"])(x.documentoItens),r=x.$refs.faturamento.condicaoPagamento.filter(function(a){return a.valor}),e){a.next=44;break}u=[],r.reduce(function(a,e){return e.idDocumentoCaixa&&!a[e.idDocumentoCaixa]&&(a[e.idDocumentoCaixa]=!0,u.push(w["a"].documento.le({id:e.idDocumentoCaixa}))),a},{}),s=!0,c=!1,a.prev=11,d=h()(u);case 13:return a.next=15,d.next();case 15:return v=a.sent,s=v.done,a.next=19,v.value;case 19:if(f=a.sent,s){a.next=28;break}if(b=f,"Aberto"===b.status){a.next=25;break}return x.$q.notify({message:"Não é possível reabrir fatura de caixas fechados!"}),a.abrupt("return",{v:!1});case 25:s=!0,a.next=13;break;case 28:a.next=34;break;case 30:a.prev=30,a.t0=a["catch"](11),c=!0,l=a.t0;case 34:if(a.prev=34,a.prev=35,s||null==d.return){a.next=39;break}return a.next=39,d.return();case 39:if(a.prev=39,!c){a.next=42;break}throw l;case 42:return a.finish(39);case 43:return a.finish(34);case 44:return a.next=46,w["a"].permissao.objeto("Diretiva_Vendas_Reabertura_EstornaTitulosLiquidados");case 46:if(a.sent){a.next=77;break}C=!0,g=!1,q=void 0,a.prev=50,k=x.$refs.faturamento.condicaoPagamentoOriginal.filter(function(a){return a.valor})[Symbol.iterator]();case 52:if(C=(_=k.next()).done){a.next=63;break}return F=_.value,a.next=56,w["a"].financeiroTitulo.le({id:F.idFinanceiroTitulo});case 56:if(y=a.sent,!y.dataPagamento){a.next=60;break}return x.$q.notify({message:"Não é possível excluir o financeiro. Parcelas da fatura já foram pagas!"}),a.abrupt("return",{v:!1});case 60:C=!0,a.next=52;break;case 63:a.next=69;break;case 65:a.prev=65,a.t1=a["catch"](50),g=!0,q=a.t1;case 69:a.prev=69,a.prev=70,C||null==k.return||k.return();case 72:if(a.prev=72,!g){a.next=75;break}throw q;case 75:return a.finish(72);case 76:return a.finish(69);case 77:if(O=[],P=[],j=[],e){a.next=464;break}return a.next=81,w["a"].financeiroTitulo.le({documentoId:t.id});case 81:O=a.sent,T=!0,S=!1,R=void 0,a.prev=85,z=O[Symbol.iterator]();case 87:if(T=($=z.next()).done){a.next=187;break}if(M=$.value,!M.idFinanceiroBoleto){a.next=184;break}return a.next=92,Object(E["a"])().financeiroBoleto.get(M.idFinanceiroBoleto);case 92:return B=a.sent,a.next=95,w["a"].financeiroBanco.le({id:B.idFinanceiroBanco});case 95:return I=a.sent,a.next=98,w["a"].banco.le({id:I.idBanco});case 98:if(V=a.sent,N=B.revisao,A=V.baixa,L=V.registro,B.remessaOperacao===A){a.next=184;break}return H=M.idFinanceiroBoleto,J=Object(D["uuid"])(),U={id:J,idFinanceiroBanco:B.idFinanceiroBanco,nossoNumero:B.nossoNumero,nossoNumeroDv:B.nossoNumeroDv,revisao:N+1,idEmpresa:B.idEmpresa,idContato:B.idContato,empresaNome:B.empresaNome,empresaNumeroDocumento:B.empresaNumeroDocumento,contatoNome:B.contatoNome,contatoNumeroDocumento:B.contatoNumeroDocumento,contatoLogradouro:B.contatoLogradouro,contatoCEP:B.contatoCEP,contatoBairro:B.contatoBairro,contatoCidade:B.contatoCidade,contatoUF:B.contatoUF,dataEmissao:Object(D["dataAtual"])(),dataVencimento:B.dataVencimento,dataImpressao:B.dataImpressao,valor:B.valor,valorJuros:B.valorJuros,tipoJuros:B.tipoJuros,valorMulta:B.valorMulta,valorDesconto:B.valorDesconto,valorTotal:B.valorTotal,codigoBarras:B.codigoBarras,linhaDigitavel:B.linhaDigitavel,mensagem1:B.mensagem1,mensagem2:B.mensagem2,mensagem3:B.mensagem3,mensagem4:B.mensagem4,mensagem5:B.mensagem5,gerarRemessa:1,remessaOperacao:A},a.next=108,w["a"].financeiroBoleto.grava({atual:U});case 108:if(W=[],!H){a.next=113;break}return a.next=112,w["a"].financeiroTitulo.le({idFinanceiroBoleto:H});case 112:W=a.sent;case 113:Y=!0,G=!1,Q=void 0,a.prev=116,K=W[Symbol.iterator]();case 118:if(Y=(X=K.next()).done){a.next=159;break}if(Z=X.value,aa=Object(D["clonar"])(Z),Z.idFinanceiroBoleto=J,ea=[],!H){a.next=127;break}return a.next=126,w["a"].financeiroBoletoTitulo.le({idFinanceiroBoleto:H});case 126:ea=a.sent;case 127:ta=!0,oa=!1,ia=void 0,a.prev=130,na=ea[Symbol.iterator]();case 132:if(ta=(ra=na.next()).done){a.next=140;break}return sa=ra.value,ca={id:Object(D["uuid"])(),idFinanceiroBoleto:J,idFinanceiroTitulo:sa.idFinanceiroTitulo},a.next=137,w["a"].financeiroBoletoTitulo.grava({atual:ca});case 137:ta=!0,a.next=132;break;case 140:a.next=146;break;case 142:a.prev=142,a.t2=a["catch"](130),oa=!0,ia=a.t2;case 146:a.prev=146,a.prev=147,ta||null==na.return||na.return();case 149:if(a.prev=149,!oa){a.next=152;break}throw ia;case 152:return a.finish(149);case 153:return a.finish(146);case 154:return a.next=156,w["a"].financeiroTitulo.grava({atual:Z,original:aa});case 156:Y=!0,a.next=118;break;case 159:a.next=165;break;case 161:a.prev=161,a.t3=a["catch"](116),G=!0,Q=a.t3;case 165:a.prev=165,a.prev=166,Y||null==K.return||K.return();case 168:if(a.prev=168,!G){a.next=171;break}throw Q;case 171:return a.finish(168);case 172:return a.finish(165);case 173:if(B.remessaOperacao!==L||1!==B.gerarRemessa){a.next=184;break}la=[B,U],ua=0;case 176:if(!(ua<la.length)){a.next=184;break}return da=la[ua],ma=m()({},da,{gerarRemessa:0}),a.next=181,w["a"].financeiroBoleto.grava({original:da,atual:ma});case 181:ua++,a.next=176;break;case 184:T=!0,a.next=87;break;case 187:a.next=193;break;case 189:a.prev=189,a.t4=a["catch"](85),S=!0,R=a.t4;case 193:a.prev=193,a.prev=194,T||null==z.return||z.return();case 196:if(a.prev=196,!S){a.next=199;break}throw R;case 199:return a.finish(196);case 200:return a.finish(193);case 201:if(va=[],!x.$refs.faturamento.idDocumentoCaixa){a.next=206;break}return a.next=205,w["a"].financeiroMovimentacao.le({idDocumentoCaixa:x.$refs.faturamento.idDocumentoCaixa});case 205:va=a.sent;case 206:return a.next=208,w["a"].financeiroTitulo.le({idFatura:t.id});case 208:return O=a.sent,a.next=211,w["a"].financeiroTitulo.le({idFatura:t.id});case 211:pa=a.sent,fa=!0,ha=!1,ba=void 0,a.prev=215,xa=Object(D["clonar"])(O)[Symbol.iterator]();case 217:if(fa=(Ca=xa.next()).done){a.next=255;break}if(ga=Ca.value,ga.idFinanceiroMovimentacaoAgrupamento){a.next=221;break}return a.abrupt("continue",252);case 221:return a.next=223,w["a"].financeiroRenegociacao.le({idFinanceiroMovimentacaoN:ga.idFinanceiroMovimentacaoAgrupamento});case 223:qa=a.sent,ka=!0,_a=!1,Fa=void 0,a.prev=227,ya=qa[Symbol.iterator]();case 229:if(ka=(Da=ya.next()).done){a.next=238;break}return wa=Da.value,a.next=233,w["a"].financeiroTitulo.le({id:wa.idFinanceiroTitulo});case 233:Ea=a.sent,Ea.idDocumentoCaixa===x.$refs.faturamento.idDocumentoCaixa&&(O=O.concat(Ea));case 235:ka=!0,a.next=229;break;case 238:a.next=244;break;case 240:a.prev=240,a.t5=a["catch"](227),_a=!0,Fa=a.t5;case 244:a.prev=244,a.prev=245,ka||null==ya.return||ya.return();case 247:if(a.prev=247,!_a){a.next=250;break}throw Fa;case 250:return a.finish(247);case 251:return a.finish(244);case 252:fa=!0,a.next=217;break;case 255:a.next=261;break;case 257:a.prev=257,a.t6=a["catch"](215),ha=!0,ba=a.t6;case 261:a.prev=261,a.prev=262,fa||null==xa.return||xa.return();case 264:if(a.prev=264,!ha){a.next=267;break}throw ba;case 267:return a.finish(264);case 268:return a.finish(261);case 269:Oa=!1,Pa=!0,ja=!1,Ta=void 0,a.prev=273,Sa=regeneratorRuntime.mark(function a(){var e,t,o;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return e=za.value,a.next=3,w["a"].financeiroTitulo.le({id:e.idFinanceiroTitulo});case 3:t=a.sent,Object.keys(t).length&&(o=[],o=va.filter(function(a){return a.idFinanceiroMovimentacaoN===t.idFinanceiroMovimentacaoAgrupamento}),P=P.concat(o),o=va.filter(function(a){return a.idFinanceiroTitulo===t.id}),P=P.concat(o),o=va.filter(function(a){return a.idFinanceiroCheque===t.id}),P=P.concat(o),O=O.concat(t)),e.idFinanceiroTitulo="",1===e.sinal&&(Oa=!0);case 7:case"end":return a.stop()}},a)}),Ra=r[Symbol.iterator]();case 276:if(Pa=(za=Ra.next()).done){a.next=281;break}return a.delegateYield(Sa(),"t7",278);case 278:Pa=!0,a.next=276;break;case 281:a.next=287;break;case 283:a.prev=283,a.t8=a["catch"](273),ja=!0,Ta=a.t8;case 287:a.prev=287,a.prev=288,Pa||null==Ra.return||Ra.return();case 290:if(a.prev=290,!ja){a.next=293;break}throw Ta;case 293:return a.finish(290);case 294:return a.finish(287);case 295:return a.next=297,w["a"].financeiroTitulo.le({idFatura:t.id,idDocumentoCaixa:x.$refs.faturamento.idDocumentoCaixa});case 297:pa=a.sent,$a=!0,Ma=!1,Ba=void 0,a.prev=301,Ia=pa[Symbol.iterator]();case 303:if($a=(Va=Ia.next()).done){a.next=318;break}if(Na=Va.value,Na.idFinanceiroMovimentacaoAgrupamento){a.next=307;break}return a.abrupt("continue",315);case 307:return a.next=309,w["a"].financeiroMovimentacao.le({idFinanceiroMovimentacaoN:Na.idFinanceiroMovimentacaoAgrupamento});case 309:return Aa=a.sent,P=P.concat(Aa),a.next=313,w["a"].financeiroRenegociacao.le({idFinanceiroMovimentacaoN:Na.idFinanceiroMovimentacaoAgrupamento});case 313:La=a.sent,j=j.concat(La);case 315:$a=!0,a.next=303;break;case 318:a.next=324;break;case 320:a.prev=320,a.t9=a["catch"](301),Ma=!0,Ba=a.t9;case 324:a.prev=324,a.prev=325,$a||null==Ia.return||Ia.return();case 327:if(a.prev=327,!Ma){a.next=330;break}throw Ba;case 330:return a.finish(327);case 331:return a.finish(324);case 332:return a.next=334,w["a"].financeiroTitulo.le({idDocumentoCaixa:x.$refs.faturamento.idDocumentoCaixa,documentoId:t.id});case 334:if(pa=a.sent,O=O.concat(pa),!t.id){a.next=376;break}return a.next=339,w["a"].financeiroMovimentacao.leNew({documentoTipo:"Devolução",documentoId:t.id});case 339:return Ha=a.sent,P=P.concat(Ha),a.next=343,w["a"].financeiroMovimentacao.leNew({idDocumentoCaixa:x.$refs.faturamento.idDocumentoCaixa,documentoId:t.id});case 343:return Ha=a.sent,P=P.concat(Ha),a.next=347,w["a"].financeiroMovimentacao.leNew({documentoId:t.id});case 347:Ha=a.sent,Ja=!0,Ua=!1,Wa=void 0,a.prev=351,Ya=Ha[Symbol.iterator]();case 353:if(Ja=(Ga=Ya.next()).done){a.next=362;break}return Qa=Ga.value,a.next=357,w["a"].financeiroTitulo.le({id:Qa.idFinanceiroTitulo});case 357:Ka=a.sent,Ka.id||(P=P.concat(Qa));case 359:Ja=!0,a.next=353;break;case 362:a.next=368;break;case 364:a.prev=364,a.t10=a["catch"](351),Ua=!0,Wa=a.t10;case 368:a.prev=368,a.prev=369,Ja||null==Ya.return||Ya.return();case 371:if(a.prev=371,!Ua){a.next=374;break}throw Wa;case 374:return a.finish(371);case 375:return a.finish(368);case 376:return a.next=378,w["a"].documento.le({idFatura:t.id});case 378:Xa=a.sent,Za=!0,ae=!1,ee=void 0,a.prev=382,te=Xa[Symbol.iterator]();case 384:if(Za=(oe=te.next()).done){a.next=393;break}return ie=oe.value,a.next=388,w["a"].financeiroMovimentacao.le({idDocumentoCaixa:x.$refs.faturamento.idDocumentoCaixa,documentoId:ie.id});case 388:ne=a.sent,P=P.concat(ne);case 390:Za=!0,a.next=384;break;case 393:a.next=399;break;case 395:a.prev=395,a.t11=a["catch"](382),ae=!0,ee=a.t11;case 399:a.prev=399,a.prev=400,Za||null==te.return||te.return();case 402:if(a.prev=402,!ae){a.next=405;break}throw ee;case 405:return a.finish(402);case 406:return a.finish(399);case 407:for(se in re=[],O)ce=O[se].id,re.includes(ce)?delete O[se]:re.push(ce);for(le in O=O.filter(function(a){return a}),re=[],P)ue=P[le].id,re.includes(ue)?delete P[le]:re.push(ue);for(de in P=P.filter(function(a){return a}),re=[],j)me=j[de].id,re.includes(me)?delete j[de]:re.push(me);for(j=j.filter(function(a){return a}),ve=Object(D["dataAtual"])(),pe=Oa?"Aguardando Pagamento":"Aberta",x.documentoStatus=[{id:Object(D["uuid"])(),idDocumento:t.id,operacao:"Fatura",statusOriginal:t.status,statusFinalizado:pe,dataHoraEmissao:ve,idUsuarioAlterou:w["a"].usuario.logado.id,idDocumentoCaixa:x.$refs.faturamento.idDocumentoCaixa}],t.status=pe,"Aberta"===pe&&(t.dataHoraFinalizado=""),pe=Oa?"Aguardando Pagamento":"Aguardando Faturamento",fe=!0,he=!1,be=void 0,a.prev=425,xe=o[Symbol.iterator]();!(fe=(Ce=xe.next()).done);fe=!0)ge=Ce.value,x.documentoStatus.push({id:Object(D["uuid"])(),idDocumento:ge.id,operacao:"Venda de Mercadoria",statusOriginal:ge.status,statusFinalizado:pe,dataHoraEmissao:ve,idUsuarioAlterou:w["a"].usuario.logado.id,idDocumentoCaixa:x.$refs.faturamento.idDocumentoCaixa}),ge.status=pe;a.next=433;break;case 429:a.prev=429,a.t12=a["catch"](425),he=!0,be=a.t12;case 433:a.prev=433,a.prev=434,fe||null==xe.return||xe.return();case 436:if(a.prev=436,!he){a.next=439;break}throw be;case 439:return a.finish(436);case 440:return a.finish(433);case 441:for(qe=!0,ke=!1,_e=void 0,a.prev=444,Fe=n[Symbol.iterator]();!(qe=(ye=Fe.next()).done);qe=!0)De=ye.value,De.status=pe;a.next=452;break;case 448:a.prev=448,a.t13=a["catch"](444),ke=!0,_e=a.t13;case 452:a.prev=452,a.prev=453,qe||null==Fe.return||Fe.return();case 455:if(a.prev=455,!ke){a.next=458;break}throw _e;case 458:return a.finish(455);case 459:return a.finish(452);case 460:x.fatura=t,x.vendas=o,x.envelopes=i,x.documentoItens=n;case 464:if(x.$q.loading.hide(),!e){a.next=468;break}return a.next=468,x.finalizar(e);case 468:if(x.$q.loading.show({message:"Processando..."}),!e){a.next=575;break}we=[],Ee=[],Oe=[],Pe=[],je=[],Te=[],we=x.$refs.faturamento.condicaoPagamento.map(function(a){return a.id}),Ee=x.$refs.faturamento.condicaoPagamentoOriginal.filter(function(a){return!we.includes(a.id)}),Se=!0,Re=!1,ze=void 0,a.prev=476,$e=Ee[Symbol.iterator]();case 478:if(Se=(Me=$e.next()).done){a.next=490;break}if(Be=Me.value,Be.idFinanceiroTitulo&&Oe.push(Be.idFinanceiroTitulo),!Be.idFormaPagamento){a.next=487;break}return Ie=void 0,a.next=485,Object(E["a"])().formaPagamento.get(Be.idFormaPagamento);case 485:Ie=a.sent,(Ie||{}).aliquota&&(Be.idFinanceiroTituloPagar?Oe.push(Be.idFinanceiroTituloPagar):x.$q.notify("Não foi possível excluir as movimentações referentes à aliquota. Exclua-as manualmente."));case 487:Se=!0,a.next=478;break;case 490:a.next=496;break;case 492:a.prev=492,a.t14=a["catch"](476),Re=!0,ze=a.t14;case 496:a.prev=496,a.prev=497,Se||null==$e.return||$e.return();case 499:if(a.prev=499,!Re){a.next=502;break}throw ze;case 502:return a.finish(499);case 503:return a.finish(496);case 504:Ve=0;case 505:if(!(Ve<Oe.length)){a.next=527;break}return Ne=Oe[Ve],Ae=void 0,a.next=510,Object(E["a"])().financeiroTitulo.get(Ne);case 510:if(Ae=a.sent,Ae.id&&Pe.push(Ae),!Ae.idFinanceiroMovimentacaoAgrupamento){a.next=524;break}return Le=void 0,He=void 0,a.next=516,Object(E["a"])().financeiroMovimentacao.where({idFinanceiroMovimentacaoN:Ae.idFinanceiroMovimentacaoAgrupamento}).toArray();case 516:if(Le=a.sent,He=(Le.find(function(a){return a.idFinanceiroCheque})||{}).idFinanceiroCheque,!He){a.next=523;break}return a.next=521,Object(E["a"])().financeiroTitulo.get(He);case 521:Je=a.sent,Je.id&&Pe.push(Je);case 523:je.push.apply(je,p()(Le));case 524:Ve++,a.next=505;break;case 527:Ue=!0,We=!1,Ye=void 0,a.prev=530,Ge=x.carnes[Symbol.iterator]();case 532:if(Ue=(Qe=Ge.next()).done){a.next=553;break}if(Ke=Qe.value,Ke.id){a.next=536;break}return a.abrupt("continue",550);case 536:return a.next=538,Object(E["a"])().financeiroTitulo.get(Ke.id);case 538:if(Ke=a.sent,(Ke||{}).idFinanceiroMovimentacaoAgrupamento){a.next=541;break}return a.abrupt("continue",550);case 541:return Xe=void 0,Ze=void 0,a.next=544,Object(E["a"])().financeiroMovimentacao.where({idFinanceiroMovimentacaoN:Ke.idFinanceiroMovimentacaoAgrupamento}).toArray();case 544:return Xe=a.sent,a.next=547,Object(E["a"])().financeiroRenegociacao.where({idFinanceiroMovimentacaoN:Ke.idFinanceiroMovimentacaoAgrupamento}).toArray();case 547:Ze=a.sent,je.push.apply(je,p()(Xe)),Te.push.apply(Te,p()(Ze));case 550:Ue=!0,a.next=532;break;case 553:a.next=559;break;case 555:a.prev=555,a.t15=a["catch"](530),We=!0,Ye=a.t15;case 559:a.prev=559,a.prev=560,Ue||null==Ge.return||Ge.return();case 562:if(a.prev=562,!We){a.next=565;break}throw Ye;case 565:return a.finish(562);case 566:return a.finish(559);case 567:return a.next=569,w["a"].financeiroTitulo.remove(Pe);case 569:return a.next=571,w["a"].financeiroMovimentacao.remove(je);case 571:return a.next=573,w["a"].financeiroRenegociacao.remove(Te);case 573:a.next=607;break;case 575:return a.next=577,w["a"].financeiroTitulo.remove(O.filter(function(a){return!(a.carne&&a.idFatura===t.id)}));case 577:return a.next=579,w["a"].financeiroMovimentacao.remove(P);case 579:return a.next=581,w["a"].financeiroRenegociacao.remove(j);case 581:at=!0,et=!1,tt=void 0,a.prev=584,ot=O.filter(function(a){return a.carne&&a.idFatura===t.id})[Symbol.iterator]();case 586:if(at=(it=ot.next()).done){a.next=593;break}return nt=it.value,a.next=590,w["a"].financeiroTitulo.grava({original:nt,atual:{valorRealizado:0,receberPagar:1,dataPagamento:""}});case 590:at=!0,a.next=586;break;case 593:a.next=599;break;case 595:a.prev=595,a.t16=a["catch"](584),et=!0,tt=a.t16;case 599:a.prev=599,a.prev=600,at||null==ot.return||ot.return();case 602:if(a.prev=602,!et){a.next=605;break}throw tt;case 605:return a.finish(602);case 606:return a.finish(599);case 607:return a.next=609,x.salvarFatura();case 609:return e?x.$q.notifyPositive("Fatura corrigida."):x.$q.notifyPositive("Fatura reaberta."),a.abrupt("return",{v:!0});case 611:case"end":return a.stop()}},a,null,[[11,30,34,44],[35,,39,43],[50,65,69,77],[70,,72,76],[85,189,193,201],[116,161,165,173],[130,142,146,154],[147,,149,153],[166,,168,172],[194,,196,200],[215,257,261,269],[227,240,244,252],[245,,247,251],[262,,264,268],[273,283,287,295],[288,,290,294],[301,320,324,332],[325,,327,331],[351,364,368,376],[369,,371,375],[382,395,399,407],[400,,402,406],[425,429,433,441],[434,,436,440],[444,448,452,460],[453,,455,459],[476,492,496,504],[497,,499,503],[530,555,559,567],[560,,562,566],[584,595,599,607],[600,,602,606]])})(),"t1",24);case 24:if(b=a.t1,"object"!==u()(b)){a.next=27;break}return a.abrupt("return",b.v);case 27:a.next=33;break;case 29:a.prev=29,a.t2=a["catch"](22),this.$q.notify("Não foi possível reabrir a fatura."),this.$q.loading.hide();case 33:return a.prev=33,this.$q.loading.hide(),a.finish(33);case 36:case"end":return a.stop()}},a,this,[[14,19],[22,29,33,36]])}));return function(e){return a.apply(this,arguments)}}(),corrigir:function(){var a=r()(regeneratorRuntime.mark(function a(){var e,t,o,i,n,r,s,c,l,u,d,m;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:if(e=this.$refs.faturamento.condicaoPagamentoOriginal,t=this.$refs.faturamento.condicaoPagamento,i=Object(D["arredondar"])(this.fatura.totalDocumento||0),o=Object(D["arredondar"])(t.reduce(function(a,e){return a+e.valor||0},0)),o===i){a.next=7;break}return this.$q.notify("Total das condições de pagamento difere do total da fatura"),a.abrupt("return");case 7:if(!e.length){a.next=40;break}n=!1,t.length||(n=!0),r=!0,s=!1,c=void 0,a.prev=13,l=function(){var a=d.value;if(!e.find(function(e){return e.id===a.id}))return n=!0,"break"},u=t[Symbol.iterator]();case 16:if(r=(d=u.next()).done){a.next=23;break}if(m=l(),"break"!==m){a.next=20;break}return a.abrupt("break",23);case 20:r=!0,a.next=16;break;case 23:a.next=29;break;case 25:a.prev=25,a.t0=a["catch"](13),s=!0,c=a.t0;case 29:a.prev=29,a.prev=30,r||null==u.return||u.return();case 32:if(a.prev=32,!s){a.next=35;break}throw c;case 35:return a.finish(32);case 36:return a.finish(29);case 37:if(n){a.next=40;break}return this.$q.notify("Não há correção a ser realizada"),a.abrupt("return");case 40:return a.prev=40,a.next=43,this.$q.dialog({cancel:"Cancelar",message:"Esta ação irá corrigir esta fatura.",noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 43:return a.next=45,this.reabrir(!0);case 45:return a.abrupt("return",!0);case 48:return a.prev=48,a.t1=a["catch"](40),a.abrupt("return",!1);case 51:case"end":return a.stop()}},a,this,[[13,25,29,37],[30,,32,36],[40,48]])}));return function(){return a.apply(this,arguments)}}(),salvarFatura:function(){var a=r()(regeneratorRuntime.mark(function a(){var e,t,o,i,n=this;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:for(t in a.prev=0,this.$q.loading.show({message:"Processando..."}),e=Object(D["clonar"])(this.$refs.faturamento.condicaoPagamento.filter(function(a){return a.valor})),e)delete e[t].idDocumentoCondicaoPagamento,delete e[t].parcelas,delete e[t].formaPagamento,delete e[t].edicao,delete e[t].codigoDocumento,delete e[t].codigoDocumentoCaixa;return this.fatura.observacaoFaturamento=this.$refs.faturamento.observacaoFaturamento,o=(this.carnesOriginal||[]).filter(function(a){return(n.financeiroTitulo||[]).find(function(e){return e.id===a.id})}),a.next=8,w["a"].fatura.grava({faturaOriginal:this.faturaOriginal,fatura:this.fatura,vendasOriginal:this.vendasOriginal,vendas:this.vendas,envelopesOriginal:this.envelopesOriginal,envelopes:this.envelopes,documentoItensOriginal:this.documentoItensOriginal,documentoItens:this.documentoItens,condicaoPagamentoOriginal:this.$refs.faturamento.condicaoPagamentoOriginal,condicaoPagamento:e,documentoStatus:this.documentoStatus,financeiroTitulo:this.financeiroTitulo,financeiroTituloOriginal:o,financeiroMovimentacao:this.financeiroMovimentacao,financeiroRenegociacao:this.financeiroRenegociacao});case 8:if(!this.receberTitulo.id){a.next=13;break}if(i=this.carnes.find(function(a){return a.id===n.receberTitulo.id}),!i.id){a.next=13;break}return a.next=13,w["a"].financeiroTitulo.grava({original:i,atual:{idFatura:this.fatura.id}});case 13:a.next=19;break;case 15:a.prev=15,a.t0=a["catch"](0),this.$q.notify("Não foi possível salvar a fatura."),this.$q.loading.hide();case 19:return a.prev=19,this.$q.loading.hide(),a.finish(19);case 22:case"end":return a.stop()}},a,this,[[0,15,19,22]])}));return function(){return a.apply(this,arguments)}}()},mixins:[k["a"]],props:{prop:{default:function(){return{}},required:!0,type:Object},receberTitulo:{default:function(){return{}},type:Object}},watch:{prop:function(){this.atualizar()}},mounted:function(){this.sistemaPai=Object(D["sistemaPai"])(),this.atualizar()}},j=P,T=(t("423ee"),t("2877")),S=Object(T["a"])(j,s,c,!1,null,null,null);S.options.__file="Fatura.vue";var R=S.exports,z={components:{Fatura:R},computed:{},data:function(){return{fatura:{},visibilidade:{modal:!1,botao:{finalizar:!1,reabrir:!1,corrigir:!1}},carregando:!0,temPermissaoCorrigir:!1,emitirAoFechar:""}},methods:{atualizar:function(){var a=r()(regeneratorRuntime.mark(function a(){var e;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:if(e={},!this.id){a.next=5;break}return a.next=4,w["a"].documento.le({id:this.id});case 4:e=a.sent;case 5:this.fatura=e,this.verificarPermissoes(),this.visibilidade.modal=!0;case 8:case"end":return a.stop()}},a,this)}));return function(){return a.apply(this,arguments)}}(),executar:function(){var a=r()(regeneratorRuntime.mark(function a(e){return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:a.t0=e,a.next="finalizar"===a.t0?3:"reabrir"===a.t0?8:"retornarOrcamento"===a.t0?15:"remover"===a.t0?15:19;break;case 3:return a.next=5,this.$refs.fatura.finalizar();case 5:if(a.sent){a.next=7;break}return a.abrupt("return");case 7:return a.abrupt("break",19);case 8:return a.next=10,this.$refs.fatura.reabrir();case 10:if(!a.sent){a.next=14;break}return a.next=13,this.atualizar();case 13:this.$emit("executar",e);case 14:return a.abrupt("return");case 15:return a.next=17,this.atualizar();case 17:return this.emitirAoFechar=e,a.abrupt("return");case 19:this.$emit("executar",e),this.fechar();case 21:case"end":return a.stop()}},a,this)}));return function(e){return a.apply(this,arguments)}}(),fechar:function(){this.fatura={},this.carregando=!0,this.visibilidade={modal:!1,botao:{finalizar:!1,reabrir:!1,corrigir:!1}},this.$emit("executar",this.emitirAoFechar)},mostrar:function(){var a=r()(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(D["dormir"])(500);case 2:this.carregando=!1;case 3:case"end":return a.stop()}},a,this)}));return function(){return a.apply(this,arguments)}}(),salvar:function(){var a=r()(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,this.$q.dialog({cancel:"Cancelar",message:"Esta ação irá salvar esta fatura.",noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 3:a.next=8;break;case 5:return a.prev=5,a.t0=a["catch"](0),a.abrupt("return");case 8:return a.next=10,this.$refs.fatura.salvarFatura();case 10:this.$emit("executar","atualizar"),this.fechar();case 12:case"end":return a.stop()}},a,this,[[0,5]])}));return function(){return a.apply(this,arguments)}}(),corrigir:function(){var a=r()(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,this.$refs.fatura.corrigir();case 2:if(!a.sent){a.next=5;break}this.$emit("executar","atualizar"),this.fechar();case 5:case"end":return a.stop()}},a,this)}));return function(){return a.apply(this,arguments)}}(),verificarPermissoes:function(){var a=this;w["a"].permissao.objeto("caixa/tesouraria").then(function(e){a.temPermissaoCorrigir=e}).catch(function(){a.temPermissaoCorrigir=!1})}},props:{id:{default:"",type:String},receberTitulo:{default:function(){return{}},type:Object},value:{default:!1,required:!0,type:Boolean}},watch:{fatura:function(a){this.visibilidade.botao.finalizar=!1,this.visibilidade.botao.reabrir=!1,this.visibilidade.botao.salvar=!1,"Aberta"===a.status&&(this.visibilidade.botao.salvar=!0),"Finalizada"!==a.status&&(this.visibilidade.botao.finalizar=!0),"Finalizada"===a.status&&(this.visibilidade.botao.reabrir=!0)},value:function(a){a&&this.atualizar()},"visibilidade.modal":function(a){this.$emit("input",a)}}},$=z,M=(t("6622"),Object(T["a"])($,o,i,!1,null,"4ebae790",null));M.options.__file="FaturaModal.vue";e["a"]=M.exports},c980:function(a,e,t){"use strict";var o=t("e062"),i=t.n(o);i.a},d4aa:function(a,e,t){"use strict";var o=function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{class:a.tema},[t("div",{staticClass:"gutter-sm row"},[t("div",{staticClass:"col-12 col-lg-6"},[t("q-toolbar",{staticClass:"u-autoHeight q-mb-md q-pa-none",attrs:{color:"none",inverted:""}},[t("avatar",{attrs:{imagem:(a.contatos[a.titulo.idContato]||{}).imagem,rotulo:(a.contatos[a.titulo.idContato]||{}).apelido,tamanho:"30"}}),t("q-toolbar-title",[a._v("\n          "+a._s((a.contatos[a.titulo.idContato]||{}).nome)+"\n          "),t("div",{attrs:{slot:"subtitle"},slot:"subtitle"},[a._v(a._s((a.contatos[a.titulo.idContato]||{}).apelido))])])],1),t("q-chip",{staticClass:"TituloCard-selo",attrs:{color:"grey",rounded:"",small:""}},[a._v(a._s(a.titulo.parcela))]),t("div",{staticClass:"q-body-1 q-mt-sm"},[a._v("\n        "+a._s(a.titulo.descricao)+"\n      ")])],1),t("div",{staticClass:"col-12 col-sm-4 col-lg-2"},[t("dl",{staticClass:"q-ma-none"},[t("dt",[a._v(a._s(a.titulo.documentoTipo)+" #"+a._s(a.titulo.documentoCodigo))]),t("dd",[a._v(a._s(a.titulo.formaDePagamento))]),t("dt",{staticClass:"q-mt-md"},[a._v(a._s(a.titulo.descricaoPlanoConta))])])]),t("div",{staticClass:"col-2 col-lg-1"},[t("q-tooltip",[a._v("Vencimento original")]),t("span",{staticClass:"block text-center"},[t("small",[a._v(a._s(a._f("mesNome")(a.titulo.dataVencimentoOriginal)))])]),t("strong",{staticClass:"block q-title text-center"},[a._v(a._s(a._f("dia")(a.titulo.dataVencimentoOriginal)))]),t("span",{staticClass:"block text-center"},[t("small",[a._v(a._s(a._f("ano")(a.titulo.dataVencimentoOriginal)))])])],1),t("div",{staticClass:"col-2 col-lg-1"},[t("q-tooltip",[a._v("Vencimento")]),t("span",{staticClass:"block text-center"},[t("small",[a._v(a._s(a._f("mesNome")(a.titulo.dataVencimento)))])]),t("strong",{staticClass:"block q-title text-center"},[a._v(a._s(a._f("dia")(a.titulo.dataVencimento)))]),t("span",{staticClass:"block text-center"},[t("small",[a._v(a._s(a._f("ano")(a.titulo.dataVencimento)))])])],1),t("div",{staticClass:"col-6 col-lg-2"},[t("dl",{staticClass:"float-right full-width q-mb-sm"},[t("dt",{staticClass:"text-right q-headline text-positive text-weight-bold"},[a._v("\n          "+a._s(a._f("numero")(a.titulo.valorTotal,2))+"\n          "),t("p",{staticClass:"text-weight-normal text-tertiary q-body-1"},[a._v("\n            "+a._s(a._f("numero")(a.titulo.valor,2))+"\n          ")])])]),t("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{float:"right"},attrs:{rounded:"",dense:"",flat:"",icon:"keyboard_arrow_"+(a.detalhes?"up":"down"),size:"md",color:"grey"},on:{click:a.alternarDetalhes}}),a.visibilidade.botao.editar?t("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{float:"right"},attrs:{rounded:"",dense:"",flat:"",icon:"edit",size:"md",color:"grey"},on:{click:a.editar}}):a._e(),a.visibilidade.botao.remover?t("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{float:"right"},attrs:{rounded:"",dense:"",flat:"",icon:"clear",color:"grey",size:"md"},on:{click:a.remover}},[t("q-tooltip",[a._v("\n          Remover da Fatura #"+a._s(parseInt(a.fatura.numero)||(a.fatura.id||"").slice(-6))+"\n        ")])],1):a._e(),a.mostrarMenuTresPontos?t("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{float:"right"},attrs:{rounded:"",dense:"",flat:"",icon:"more_vert",color:"grey",size:"md"}},[t("q-popover",[t("q-list",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{link:"",separator:""}},[a.mostrarOpcaoMigrarFatura?[a._l(a.faturasAbertas,function(e){return t("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],key:e.id,nativeOn:{click:function(t){a.migrarFatura(e)}}},[t("q-item-side",{attrs:{icon:"mdi-folder-move"}}),t("q-item-main",{attrs:{label:"Migrar para fatura #"+(e.numero||e.id.slice(-6))}})],1)}),t("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],nativeOn:{click:function(e){a.migrarFatura()}}},[t("q-item-side",{attrs:{icon:"mdi-folder-move"}}),t("q-item-main",{attrs:{label:"Migrar para nova fatura"}})],1)]:a._e()],2)],1)],1):a._e(),a._t("default")],2)]),a.detalhes?t("div",{staticClass:"u-bordaCima gutter-sm q-mt-md q-pt-md row"},[t("div",{staticClass:"col-12 col-lg-6"},[t("q-toolbar",{staticClass:"u-autoHeight q-mb-md q-pa-none",attrs:{color:"none",inverted:""}},[t("q-icon",{attrs:{name:"business"}}),t("q-toolbar-title",[a._v(a._s((a.contatos[a.titulo.idEmpresa]||{}).apelido))])],1),t("div",{staticClass:"q-body-1"},[a._v("\n        "+a._s(a.titulo.observacao)+"\n      ")])],1),t("div",{staticClass:"col-12 col-sm-4 col-lg-2"},[t("dl",{staticClass:"q-ma-none"},[t("dt",[a._v(a._s(a.titulo.descricaoCentroCusto))])])]),t("div",{staticClass:"col-2 col-lg-1"},[t("q-tooltip",[a._v("Emissão")]),t("span",{staticClass:"block text-center"},[t("small",[a._v(a._s(a._f("mesNome")(a.titulo.dataEmissao)))])]),t("strong",{staticClass:"block q-title text-center"},[a._v(a._s(a._f("dia")(a.titulo.dataEmissao)))]),t("span",{staticClass:"block text-center"},[t("small",[a._v(a._s(a._f("ano")(a.titulo.dataEmissao)))])])],1),t("div",{staticClass:"col-2 col-lg-1"},[t("q-tooltip",[a._v("Competência")]),t("span",{staticClass:"block text-center"},[t("small",[a._v(a._s(a._f("mesNome")(a.titulo.dataCompetencia)))])]),t("strong",{staticClass:"block q-title text-center"},[a._v(a._s(a._f("dia")(a.titulo.dataCompetencia)))]),t("span",{staticClass:"block text-center"},[t("small",[a._v(a._s(a._f("ano")(a.titulo.dataCompetencia)))])])],1),t("div",{staticClass:"col-8 col-sm-4 col-lg-2 text-right"},[t("div",[t("small",{staticClass:"block q-caption"},[a._v("Desconto")]),t("strong",[a._v(a._s(a._f("numero")(a.titulo.valorDesconto||0,2)))])]),a.titulo.diasEmAtraso?[t("div",{staticClass:"q-mt-xs"},[t("small",{staticClass:"block q-caption"},[a._v("Multa")]),t("strong",[a._v("\n            "+a._s(a._f("numero")(a.titulo.valorMulta||0,2))+" ("+a._s(a._f("numero")(a.titulo.percentualMulta||0,2))+"%)\n          ")])]),t("div",{staticClass:"q-mt-xs"},[t("small",{staticClass:"block q-caption"},[a._v("Juros")]),t("strong",[a._v("\n            "+a._s(a._f("numero")(a.titulo.valorTotalJuros||0,2))+" ("+a._s(a._f("numero")(a.titulo.percentualJuros||0,2))+"% dia)\n          ")])])]:a._e()],2)]):a._e(),t("q-modal",{attrs:{"content-css":{minWidth:"30vw"}},model:{value:a.modalEditar.visivel,callback:function(e){a.$set(a.modalEditar,"visivel",e)},expression:"modalEditar.visivel"}},[t("q-modal-layout",[t("q-toolbar",{attrs:{slot:"header"},slot:"header"},[t("q-toolbar-title",[a._v("Editar Título")]),t("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"close",round:""}})],1),t("form",{staticClass:"layout-padding",on:{submit:function(e){return e.preventDefault(),a.salvar(e)}}},[t("dl",{staticClass:"horizontal"},[t("dt",{staticStyle:{"text-align":"left"}},[a._v("Valor")]),t("dd",{staticClass:"text-right"},[a._v(a._s(a._f("numero")(a.titulo.valor,2)))])]),t("dl",{staticClass:"horizontal"},[t("dt",{staticStyle:{"text-align":"left"}},[a._v("Dias em Atraso")]),t("dd",{staticClass:"text-right"},[a._v(a._s(a._f("numero")(a.titulo.diasEmAtraso,0)))])]),t("dl",{staticClass:"horizontal"},[t("dt",{staticStyle:{"text-align":"left"}},[a._v("Multa")]),t("dd",{staticClass:"text-right"},[a._v(a._s(a._f("numero")(a.titulo.valorMulta,2)))])]),t("dl",{staticClass:"horizontal"},[t("dt",{staticStyle:{"text-align":"left"}},[a._v("Juros")]),t("dd",{staticClass:"text-right"},[a._v(a._s(a._f("numero")(a.titulo.valorTotalJuros,2)))])]),t("dl",{staticClass:"horizontal"},[t("dt",{staticStyle:{"text-align":"left"}},[a._v("Desconto")]),t("dd",{staticClass:"text-right"},[t("campo",{attrs:{"inverted-light":"",color:"light",tipo:"decimal",decimals:"2",erro:a.modalEditar.erroCalculo},on:{input:function(e){a.desconto()}},model:{value:a.titulo.valorDesconto,callback:function(e){a.$set(a.titulo,"valorDesconto",e)},expression:"titulo.valorDesconto"}})],1)]),t("dl",{staticClass:"horizontal"},[t("dt",{staticStyle:{"text-align":"left"}},[a._v("Total")]),t("dd",{staticClass:"text-right"},[a._v(a._s(a._f("numero")(a.titulo.valorTotal,2)))])]),t("div",{staticClass:"q-mt-lg text-center"},[t("q-btn",{staticClass:"q-ml-sm no-shadow",attrs:{color:"primary",label:"Salvar",type:"submit"}})],1)])],1)],1)],1)},i=[];o._withStripped=!0;t("55dd"),t("7514"),t("96cf");var n=t("c973"),r=t.n(n),s=t("df3a"),c=t("88db"),l=t("3e8a"),u=t("8149"),d=t("2ef0"),m=t("ed08"),v={components:{Avatar:s["a"],Campo:c["a"]},computed:{mostrarMenuTresPontos:function(){return this.mostrarOpcaoMigrarFatura}},data:function(){return{titulo:{},tituloOriginal:{},detalhes:!1,contatos:{},fatura:{},faturasAbertas:[],mostrarOpcaoMigrarFatura:!1,visibilidade:{botao:{remover:!1,editar:!1}},modalEditar:{visivel:!1,erroCalculo:!1},tema:["TituloCard","bg-white","q-pa-md","round-borders"]}},methods:{irParaAtendimentoFatura:function(a){this.$router.push({name:"AtendimentoFatura",params:{id:a}})},migrarFatura:function(){var a=r()(regeneratorRuntime.mark(function a(e){var t,o,i,n,r;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,this.$q.dialog({cancel:"Cancelar",message:"Esta ação irá migrar esta venda para outra fatura.",noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 3:a.next=8;break;case 5:return a.prev=5,a.t0=a["catch"](0),a.abrupt("return");case 8:if(e||!this.titulo.idContato||!this.titulo.idEmpresa){a.next=36;break}return a.next=11,Object(l["a"])().contato.get(this.titulo.idContato);case 11:if(a.t1=a.sent,a.t1){a.next=14;break}a.t1={};case 14:return t=a.t1,a.next=17,Object(l["a"])().contatoEndereco.where({idContato:this.titulo.idContato}).toArray();case 17:return o=a.sent,a.next=20,Object(l["a"])().contatoTelefone.where({idContato:this.titulo.idContato}).toArray();case 20:return i=a.sent,o=o.find(function(a){return"Principal"===a.grupo.trim().toLowerCase()})||o[0]||{},i=i.find(function(a){return"Principal"===a.tipoTelefone.trim().toLowerCase()})||i[0]||{},a.next=25,Object(l["a"])().contato.get(this.titulo.idEmpresa);case 25:if(a.t2=a.sent,a.t2){a.next=28;break}a.t2={};case 28:return n=a.t2,a.next=31,Object(l["a"])().contatoEndereco.where({idContato:this.titulo.idEmpresa}).toArray();case 31:return r=a.sent,r=r.find(function(a){return"Principal"===a.grupo.trim().toLowerCase()})||r[0]||{},e=u["a"].fatura.criar({idEmpresa:n.id,idEmpresaEndereco:r.id||"",descricaoEmpresa:n.nome||"",numeroDocumentoEmpresa:n.numeroDocumentoNacional||"",inscricaoMunicipalEmpresa:n.numeroDocumentoMunicipal||"",optanteSimplesNacional:"SimplesNacional"===n.regime?"1":"0",idContato:t.id,idContatoEndereco:o.id||"",numeroDocumentoContato:t.numeroDocumentoNacional||"",descricaoContato:t.nome||"",descricaoContatoEndereco:"".concat(o.logradouro||"",", ",o.numero||""," ",o.complemento||""," - ",o.bairro||""," - ",o.municipio||"","/",o.uf||""),telefoneContato:i.telefone||"",emailContato:t.email||"",regimeContato:t.regime||"",observacaoFaturamento:""}),a.next=36,u["a"].fatura.grava({fatura:e});case 36:if(!e.id){a.next=43;break}return a.next=39,u["a"].financeiroTitulo.grava({atual:{id:this.titulo.id,idFatura:e.id},original:this.titulo});case 39:localStorage.setItem("idFatura",e.id),this.titulo.idContato&&(this.$emit("executar","atualizar"),this.irParaAtendimentoFatura(this.titulo.idContato)),a.next=44;break;case 43:this.$q.notify("Não foi possível realizar a operação");case 44:case"end":return a.stop()}},a,this,[[0,5]])}));return function(e){return a.apply(this,arguments)}}(),salvar:function(){var a=r()(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:if(!this.modalEditar.erroCalculo){a.next=3;break}return this.$q.notify("Não é possível salvar o título. Erro de cálculo encontrado."),a.abrupt("return");case 3:return a.prev=3,a.next=6,u["a"].financeiroTitulo.grava({atual:this.titulo,original:this.tituloOriginal});case 6:this.tituloOriginal=Object(m["clonar"])(this.titulo),this.modalEditar.visivel=!1,this.$q.notifyPositive("Título salvo."),this.$emit("executar","recalcular"),a.next=15;break;case 12:a.prev=12,a.t0=a["catch"](3),this.$q.notifyPositive("Não foi possível salvar o título. Por favor, tente novamente.");case 15:case"end":return a.stop()}},a,this,[[3,12]])}));return function(){return a.apply(this,arguments)}}(),editar:function(){this.modalEditar.visivel=!0},permissaoEditar:function(){var a=r()(regeneratorRuntime.mark(function a(){var e;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,u["a"].permissao.objeto("Diretiva_Caixa_DescontoTitulo");case 2:return e=a.sent,a.abrupt("return",e);case 4:case"end":return a.stop()}},a)}));return function(){return a.apply(this,arguments)}}(),desconto:function(){var a=Object(m["arredondar"])((this.titulo.valorMulta||0)+(this.titulo.valorJuros||0)*(this.titulo.diasEmAtraso||0));if(this.titulo.valorDesconto<0||this.titulo.valorDesconto>a)return this.modalEditar.erroCalculo=!0,this.titulo.valorTotal=this.tituloOriginal.valorTotal,this.titulo.valorARealizar=this.tituloOriginal.valorARealizar,void(this.titulo.percentualDesconto=this.tituloOriginal.percentualDesconto);this.titulo.valorTotal=Object(m["arredondar"])((this.titulo.valor||0)-(this.titulo.valorDesconto||0)+(this.titulo.valorMulta||0)+(this.titulo.valorJuros||0)*(this.titulo.diasEmAtraso||0)),this.titulo.valorARealizar=this.titulo.valorTotal,this.titulo.percentualDesconto=Object(m["arredondar"])(100*(this.titulo.valorDesconto||0)/(this.titulo.valor||1)),this.modalEditar.erroCalculo=!1},alternarDetalhes:function(){this.detalhes=!this.detalhes},remover:function(){var a=r()(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,this.$q.dialog({cancel:"Cancelar",message:"Esta ação irá remover este título da fatura.",noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 3:a.next=8;break;case 5:return a.prev=5,a.t0=a["catch"](0),a.abrupt("return");case 8:return this.titulo.idFatura="",a.next=11,u["a"].financeiroTitulo.grava({atual:this.titulo,original:this.tituloOriginal});case 11:this.visibilidade.botao.remover=!1,this.$q.notifyPositive("Título removido da fatura."),this.$emit("executar","remover");case 14:case"end":return a.stop()}},a,this,[[0,5]])}));return function(){return a.apply(this,arguments)}}()},props:{dados:{required:!0,type:Object}},mounted:function(){var a=this,e=new Date(this.dados.dataVencimento).setHours(0,0,0,0),t=(new Date).setHours(0,0,0,0);e<t?this.tema.push("vencido"):this.tema=Object(d["remove"])(this.tema,function(a){return"vencido"!==a}),this.tituloOriginal=Object(m["clonar"])(this.dados),this.titulo=Object(m["clonar"])(this.dados),this.visibilidade.botao.remover=!1,this.permissaoEditar().then(function(e){return a.visibilidade.botao.editar=e&&!a.tituloOriginal.valorRealizado}),this.contatos={},this.titulo.idContato&&u["a"].contato.le({id:this.titulo.idContato}).then(function(e){a.$set(a.contatos,a.titulo.idContato,e)}),this.titulo.idEmpresa&&u["a"].contato.le({id:this.titulo.idEmpresa}).then(function(e){a.$set(a.contatos,a.titulo.idEmpresa,e)}),this.mostrarOpcaoMigrarFatura=!1,this.titulo.idFatura&&u["a"].fatura.leNew({id:this.titulo.idFatura}).then(function(e){a.fatura=e,"Aberta"===e.status&&(u["a"].contatoBusca.filtrar(null,{ativo:!0,empresas:!0},0).then(function(e){e.find(function(e){return e.id===a.titulo.idEmpresa})&&(a.visibilidade.botao.remover=!0)}),a.titulo.idContato&&a.titulo.idEmpresa&&u["a"].fatura.obterAbertas(a.titulo.idContato,a.titulo.idEmpresa).then(function(e){e=e.filter(function(e){return e.id!==a.titulo.idFatura}),a.faturasAbertas=e.sort(function(a,e){return!a.numero||a.numero<e.numero?-1:1}),a.mostrarOpcaoMigrarFatura=!0}))})}},p=v,f=(t("e38f"),t("2877")),h=Object(f["a"])(p,o,i,!1,null,null,null);h.options.__file="TituloCard.vue";e["a"]=h.exports},e062:function(a,e,t){},e22f:function(a,e,t){},e38f:function(a,e,t){"use strict";var o=t("e22f"),i=t.n(o);i.a},ee4a:function(a,e,t){"use strict";var o=function(){var a=this,e=a.$createElement,t=a._self._c||e;return a.dados.fatura.id?t("q-card",{staticClass:"extratoItem bg-grey-2 q-mb-md q-pa-md no-shadow"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12 col-md-6"},[t("div",{staticClass:"q-px-sm"},[t("avatar",{staticStyle:{float:"left"},attrs:{imagem:(a.contatos[a.dados.fatura.idContato]||{}).imagem,rotulo:a.dados.fatura.descricaoContato,tamanho:"40"}}),t("q-toolbar-title",[t("div",[a._v("\n            "+a._s(a.dados.fatura.descricaoContato)+"\n          ")])]),t("q-chip",{staticClass:"q-ma-sm q-my-sm",attrs:{rounded:"",color:"grey",small:""}},[a._v("\n          "+a._s(a.dados.fatura.status)+"\n        ")]),t("q-list",{staticClass:"no-border"},[a._l(a.dados.vendas,function(e){return t("q-item",{key:e.id,staticClass:"q-pa-none",staticStyle:{"min-height":"auto"}},[t("q-item-side",[t("small",[a._v("#"+a._s(parseInt(e.numero)||(e.id||"").slice(-6)))])]),t("q-item-main",[t("small",[t("q-tooltip",[a._v("\n                  "+a._s(a._f("dataHora")(e.dataHoraFinalizado))+"\n                ")]),a._v("\n                "+a._s(a._f("data")(e.dataHoraFinalizado))+"\n              ")],1),t("small",[a._v(" - ")]),t("small",[t("q-tooltip",[a._v("\n                  Vendedor(a)\n                ")]),a._v("\n                "+a._s((a.contatos[e.idContatoVendedor]||{}).apelido)+"\n              ")],1),t("small",[t("badge",{staticClass:"q-mx-sm",attrs:{escuro:"",cor:"grey-5",denso:"",round:""}},[a._v(a._s(e.status))])],1)]),t("q-item-side",{attrs:{right:""}},[t("small",[a._v(a._s(a._f("numero")(e.totalDocumento,2)))])])],1)}),a._l(a.dados.carnes,function(e){return t("q-item",{key:e.id,staticClass:"q-pa-none",staticStyle:{"min-height":"auto"}},[t("q-item-side",[t("small",[a._v("#"+a._s((e.id||"").slice(-6)))])]),t("q-item-main",[t("small",[t("q-tooltip",[a._v("\n                  Vencimento\n                ")]),a._v("\n                "+a._s(a._f("data")(e.dataVencimento))+"\n              ")],1),t("small",[a._v(" - "+a._s(e.formaDePagamento))])]),t("q-item-side",{attrs:{right:""}},[t("small",[a._v(a._s(a._f("numero")(e.valorTotal,2)))])])],1)})],2)],1)]),t("div",{staticClass:"col-12 col-md-2"},[t("div",{staticClass:"q-px-sm"},[t("badge",{staticClass:"q-mr-sm",attrs:{escuro:"",cor:"positive"},nativeOn:{click:function(e){return a.copiarUid(e)}}},[a._v("\n          #"+a._s(parseInt(a.dados.fatura.numero)||(a.dados.fatura.id||"").slice(-6))+"\n          "),t("input",{ref:"uid",attrs:{type:"hidden"},domProps:{value:a.dados.fatura.id}})])],1)]),t("div",{staticClass:"col-3 col-md-1"},[t("q-tooltip",[a._v("\n        Emissão\n      ")]),t("p",{staticClass:"text-center q-my-none"},[t("small",[a._v(a._s(a._f("mesNome")(a.dados.fatura.dataHoraEmissao)))])]),t("p",{staticClass:"text-center q-my-none q-headline text-weight-bold"},[t("strong",[a._v(a._s(a._f("dia")(a.dados.fatura.dataHoraEmissao)))])]),t("p",{staticClass:"text-center q-my-none"},[t("small",[a._v(a._s(a._f("ano")(a.dados.fatura.dataHoraEmissao)))])])],1),t("div",{staticClass:"col-3 col-md-1"},[(a.dados.fatura||{}).dataHoraFinalizado?t("q-tooltip",[a._v("\n        Finalizado\n      ")]):a._e(),t("p",{staticClass:"text-center q-my-none"},[t("small",[a._v(a._s(a._f("mesNome")(a.dados.fatura.dataHoraFinalizado)))])]),t("p",{staticClass:"text-center q-my-none q-headline text-weight-bold"},[t("strong",[a._v(a._s(a._f("dia")(a.dados.fatura.dataHoraFinalizado)))])]),t("p",{staticClass:"text-center q-my-none"},[t("small",[a._v(a._s(a._f("ano")(a.dados.fatura.dataHoraFinalizado)))])])],1),t("div",{staticClass:"col-6 col-md-2"},[t("dl",{staticClass:"float-right full-width q-mb-sm"},[t("dt",{staticClass:"text-right q-headline text-positive text-weight-bold"},[a._v("\n          "+a._s(a._f("numero")(a.dados.fatura.totalDocumento,2))+"\n          "),t("p",{staticClass:"text-weight-normal text-tertiary q-body-1"},[a._v("\n            "+a._s(a._f("numero")(a.dados.fatura.subTotal,2))+"\n          ")])])]),t("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{float:"right"},attrs:{rounded:"",dense:"",flat:"",icon:"more_vert",color:"grey",size:"md"}},[t("q-popover",[t("q-list",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{link:"",separator:""}},[a.$utils.mapearStatus(a.dados.fatura).permiteNota?[t("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],nativeOn:{click:function(e){a.emitirNFeV2({idFatura:a.dados.fatura.id},1,"Venda")}}},[t("q-item-side",{attrs:{icon:"account_balance"}}),t("q-item-main",{attrs:{label:"NFe de Saída/Venda"}})],1),t("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],nativeOn:{click:function(e){a.emitirNFeV2({idFatura:a.dados.fatura.id},0,"Devolução")}}},[t("q-item-side",{attrs:{icon:"account_balance"}}),t("q-item-main",{attrs:{label:"NFe de Entrada/Devolução"}})],1),t("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],nativeOn:{click:function(e){a.emitirNFeV2({idFatura:a.dados.fatura.id},1,"Remessa")}}},[t("q-item-side",{attrs:{icon:"account_balance"}}),t("q-item-main",{attrs:{label:"NFe de Remessa"}})],1)]:a._e(),a.mostrarOpcaoRemoverFatura?t("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],nativeOn:{click:function(e){a.removerFatura()}}},[t("q-item-side",{attrs:{icon:"mdi-trash-can"}}),t("q-item-main",{attrs:{label:"Remover Fatura"}})],1):a._e()],2)],1)],1),a.podeEditar?t("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{float:"right"},attrs:{rounded:"",dense:"",flat:"",icon:"edit",color:"primary",size:"md"},on:{click:a.editar}}):a._e(),t("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{float:"right"},attrs:{rounded:"",dense:"",flat:"",icon:"print",color:"primary",size:"md"}},[t("q-popover",[t("q-list",{attrs:{link:"",separator:""}},[a.mostrarOpcaoEmitirBoleto?t("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],nativeOn:{click:function(e){a.abrirModalBoleto()}}},[t("q-item-side",{attrs:{icon:"mdi-printer"}}),t("q-item-main",{attrs:{label:"Emitir Boleto"}})],1):a._e(),a._l(a.configImpressaoFatura,function(e){return t("q-item",{key:e.valor,nativeOn:{click:function(t){a.imprimir(e.valor,(a.dados.fatura||{}).id||"0")}}},[t("q-item-side",{attrs:{icon:"print"}}),t("q-item-main",{attrs:{label:e.texto}})],1)}),"optisoul"===a.sistemaPai?a._l(a.configImpressaoEnvelope,function(e){return t("q-item",{key:e.valor,nativeOn:{click:function(t){a.imprimir(e.valor,(a.dados.fatura||{}).id||"0")}}},[t("q-item-side",{attrs:{icon:"print"}}),t("q-item-main",{attrs:{label:e.texto}})],1)}):a._e(),a._l(a.configImpressaoCarne,function(e){return t("q-item",{key:e.valor,nativeOn:{click:function(t){a.imprimir(e.valor,(a.dados.fatura||{}).id||"0")}}},[t("q-item-side",{attrs:{icon:"print"}}),t("q-item-main",{attrs:{label:e.texto}})],1)}),a._l(a.configImpressaoConvenio,function(e){return t("q-item",{key:e.valor,nativeOn:{click:function(t){a.imprimir(e.valor,(a.dados.fatura||{}).id||"0")}}},[t("q-item-side",{attrs:{icon:"print"}}),t("q-item-main",{attrs:{label:e.texto}})],1)})],2)],1)],1),t("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{float:"right"},attrs:{rounded:"",dense:"",flat:"",icon:a.detalhesVisivel?"keyboard_arrow_up":"keyboard_arrow_down",size:"md",color:"grey"},on:{click:a.alternarDetalhes}})],1)]),a.detalhesVisivel?t("div",{staticClass:"row"},[t("div",{staticClass:"col-12 col-md-6"},[t("div",{staticClass:"q-px-sm"},[t("q-toolbar-title",{staticClass:"q-mx-none q-mt-sm q-px-none"},[t("q-icon",{attrs:{name:"business"}}),a._v("\n          "+a._s(a.dados.fatura.descricaoEmpresa)+"\n        ")],1),t("div",{staticClass:"round-borders q-mt-lg"},[t("documentos-fiscais",{attrs:{idFatura:a.dados.fatura.id}})],1)],1)]),t("div",{staticClass:"col-12 col-md-4"},[t("div",{staticClass:"q-px-sm"},[t("q-toolbar-title",{staticClass:"q-mx-none q-mt-sm q-px-none"},[a._v("\n          Faturamento\n        ")]),t("p",{staticClass:"q-mt-sm"},[t("small",{staticStyle:{display:"block"}},[a._v("\n            "+a._s(a.dados.fatura.observacaoFaturamento)+"\n          ")])]),t("q-list",{staticClass:"no-border "},a._l(a.condicaoPagamentoResumo,function(e){return t("q-item",{key:e.id,staticClass:"q-pa-none row",staticStyle:{"min-height":"auto"}},[t("q-item-side",[t("small",[a._v(a._s(e.formaPagamento))])]),t("q-item-main",{staticClass:"text-right"},[t("small",[a._v(a._s(a._f("numero")(e.valor,2))+a._s(e.parcelas>1?" (em "+e.parcelas+"x)":""))])]),t("q-item-side",{attrs:{right:""}},[t("small",[a._v(a._s(a._f("data")(e.dataVencimento)))])])],1)}))],1)]),t("div",{staticClass:"col-12 col-md-2"},[t("div",{staticClass:"q-px-sm text-right"},[t("dl",{staticClass:"q-mt-none text-right"},[t("dd",[t("small",{staticClass:"q-mr-xs"},[a._v("Desconto")]),t("span",{staticClass:"q-subheading"},[t("strong",[a._v(a._s(a._f("numero")(a.dados.fatura.totalDesconto,2)))])])])])])])]):a._e(),t("fatura-modal",{attrs:{id:a.dados.fatura.id},on:{executar:a.executar},model:{value:a.faturaVisivel,callback:function(e){a.faturaVisivel=e},expression:"faturaVisivel"}}),a.modalBoleto.ativo?t("q-modal",{attrs:{minimized:""},on:{hide:a.fecharModalBoleto},model:{value:a.modalBoleto.visivel,callback:function(e){a.$set(a.modalBoleto,"visivel",e)},expression:"modalBoleto.visivel"}},[t("q-modal-layout",[t("q-toolbar",{attrs:{slot:"header"},slot:"header"},[t("q-toolbar-title",[a._v("\n          Emissão de Boleto\n        ")])],1),a.modalBoleto.condicoesPagamento.filter(function(a){return a.disable}).length?t("q-list",{staticClass:"q-mb-sm",attrs:{dense:"",highlight:""}},[t("q-list-header",[a._v("Recuperando informações do servidor\n          "),t("q-spinner-hourglass")],1),t("q-item-separator"),a._l(a.modalBoleto.condicoesPagamento.filter(function(a){return a.disable}),function(e,o){return t("q-item",{key:o,attrs:{tag:"label"}},[t("q-item-side",[e.disable?t("q-spinner-dots"):a._e()],1),t("q-item-main",[t("q-item-tile",{attrs:{label:""}},[a._v(a._s(e.descricao)+" - "+a._s(a._f("numero")(e.valor,2))+" - Venc.\n              "+a._s(a._f("data")(e.dataVencimento))+"\n            ")])],1)],1)})],2):a._e(),t("form",{staticClass:"q-pa-sm",on:{submit:function(e){e.preventDefault(),a.emitirImprimirBoleto()}}},[a.modalBoleto.condicoesPagamento.filter(function(a){return!a.disable&&a.codigoFinanceiroBoleto}).length?t("q-list",{staticClass:"q-mb-sm",attrs:{dense:"",highlight:""}},[t("q-list-header",[a._v("Boletos emitidos")]),t("q-item-separator"),a._l(a.modalBoleto.condicoesPagamento.filter(function(a){return!a.disable&&a.codigoFinanceiroBoleto}),function(e,o){return t("q-item",{key:o,attrs:{tag:"label"}},[t("q-item-side",[t("q-checkbox",{model:{value:e.checked,callback:function(t){a.$set(e,"checked",t)},expression:"cond.checked"}})],1),t("q-item-main",[t("q-item-tile",{attrs:{label:""}},[a._v("\n                "+a._s(e.descricao)+" - "+a._s(a._f("numero")(e.valor,2))+" - Venc. "+a._s(a._f("data")(e.dataVencimento))+"\n              ")]),t("q-item-tile",{attrs:{sublabel:""}},[a._v("\n                "+a._s(e.banco.descricao)+" - Ag. "+a._s(e.banco.agencia)+" C/C "+a._s(e.banco.conta)+" - Emitido em\n                "+a._s(a._f("dataHora")(e.banco.dataEmissao))+"\n              ")])],1)],1)})],2):a._e(),a.modalBoleto.condicoesPagamento.filter(function(a){return!a.disable&&!a.codigoFinanceiroBoleto}).length?t("q-list",{attrs:{dense:"",highlight:""}},[t("q-list-header",[a._v("Boletos a emitir")]),t("q-item-separator"),t("q-item",[t("q-item-main",[t("q-select",{attrs:{options:a.modalBoleto.bancos},model:{value:a.modalBoleto.codigoFinanceiroBanco,callback:function(e){a.$set(a.modalBoleto,"codigoFinanceiroBanco",e)},expression:"modalBoleto.codigoFinanceiroBanco"}})],1)],1),a._l(a.modalBoleto.condicoesPagamento.filter(function(a){return!a.disable&&!a.codigoFinanceiroBoleto}),function(e,o){return t("q-item",{key:o,attrs:{tag:"label"}},[t("q-item-side",[t("q-checkbox",{model:{value:e.checked,callback:function(t){a.$set(e,"checked",t)},expression:"cond.checked"}})],1),t("q-item-main",[t("q-item-tile",{attrs:{label:""}},[a._v(a._s(e.descricao)+" - "+a._s(a._f("numero")(e.valor,2))+" - Venc.\n                "+a._s(a._f("data")(e.dataVencimento))+"\n              ")])],1)],1)})],2):a._e(),t("div",{staticClass:"q-mt-lg text-center"},[t("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{color:"faded",flat:"",label:"Cancelar"}}),t("q-btn",{staticClass:"q-ml-sm no-shadow",attrs:{color:"primary",label:"Imprimir",type:"submit",disable:!a.ativarBotaoEmissaoBoleto}})],1)],1),t("q-inner-loading",{attrs:{visible:a.modalBoleto.loading}},[t("q-spinner",{attrs:{size:"50px",color:"primary"}})],1)],1)],1):a._e()],1):a._e()},i=[];o._withStripped=!0;var n=t("3156"),r=t.n(n),s=(t("28a5"),t("cadf"),t("4f7f"),t("448a")),c=t.n(s),l=(t("ac4d"),t("8a81"),t("ac6a"),t("96cf"),t("c973")),u=t.n(l),d=(t("7514"),t("7cdf"),t("c5f6"),t("df3a")),m=t("a0fd"),v=t("e3f4"),p=t("dd9d"),f=t("c865"),h=t("0ebd"),b=t("8149"),x=t("3e8a"),C=t("2ef0"),g=t("ed08"),q={components:{Avatar:d["a"],Badge:m["a"],DocumentosFiscais:v["a"],FaturaModal:f["a"]},computed:{config:function(){return b["a"].configuracoes.valores},mostrarOpcaoEmitirBoleto:function(){return(this.modalBoleto.condicoesPagamento||[]).length&&(this.modalBoleto.bancos||[]).length},mostrarOpcaoRemoverFatura:function(){return"Aberta"===this.dados.fatura.status&&!this.dados.carnes.length&&!this.dados.condicaoPagamento.length&&!this.dados.vendas.length},ativarBotaoEmissaoBoleto:function(){var a=Number(this.modalBoleto.codigoFinanceiroBanco);return Number.isInteger(a)&&a&&this.modalBoleto.condicoesPagamento.find(function(a){return a.checked})}},data:function(){return{dbUsuario:b["a"].usuario,dados:{fatura:{}},contatos:{},faturaVisivel:!1,detalhesVisivel:!1,sistemaPai:"",configImpressaoCarne:[],configImpressaoConvenio:[],configImpressaoFatura:[],configImpressaoEnvelope:[],modalBoleto:{},podeEditar:!1}},methods:{removerFatura:function(){var a=u()(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,this.$q.dialog({cancel:"Cancelar",message:"Esta ação irá remover esta fatura.",noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 3:a.next=8;break;case 5:return a.prev=5,a.t0=a["catch"](0),a.abrupt("return");case 8:if(!this.dados.fatura.id){a.next=14;break}return a.next=11,b["a"].fatura.remover(this.dados.fatura.id);case 11:this.$emit("executar","atualizar"),a.next=15;break;case 14:this.$q.notify("Não foi possível realizar a operação");case 15:case"end":return a.stop()}},a,this,[[0,5]])}));return function(){return a.apply(this,arguments)}}(),abrirModalBoleto:function(){var a=this,e=!0,t=!1,o=void 0;try{for(var i,n=this.modalBoleto.condicoesPagamento[Symbol.iterator]();!(e=(i=n.next()).done);e=!0){var r=i.value;r.checked=!1,r.disable=!0,r.codigoFinanceiroBoleto="",r.codigoFinanceiroTitulo="",r.banco={}}}catch(a){t=!0,o=a}finally{try{e||null==n.return||n.return()}finally{if(t)throw o}}this.modalBoleto.checked=!1,this.modalBoleto.codigoFinanceiroBanco=this.modalBoleto.bancos[0].value,this.modalBoleto.ativo=!0,this.$nextTick().then(function(){a.modalBoleto.visivel=!0,a.atualizarBoletos()})},alternarCheckboxModalBoleto:function(a){var e=this;"todos"!==a?this.modalBoleto.checked=!this.modalBoleto.condicoesPagamento.find(function(a){return!a.checked}):this.modalBoleto.condicoesPagamento.forEach(function(a){a.checked=e.modalBoleto.checked})},atualizarBoletos:function(){var a=u()(regeneratorRuntime.mark(function a(){var e,t,o,i,n,r,s,c,l,u,d;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:i=this.modalBoleto.condicoesPagamento,o=i.reduce(function(a,e){return a+"'"+e.idFinanceiroTitulo+"',"},""),o=o.slice(0,o.length-1),e="select\n        fTitulo.id,\n        fTitulo.codigoFinanceiroTitulo,\n        fBoleto.codigoFinanceiroBoleto,\n        fBoleto.dataEmissao,\n        b.descricao,\n        fBanco.agencia,\n        fBanco.conta,\n        b.arquivoBoleto\n      from financeiroTitulo fTitulo\n      left join financeiroBoleto fBoleto on fBoleto.codigoFinanceiroBoleto = fTitulo.codigoFinanceiroBoleto\n      left join financeiroBanco fBanco on fBanco.CodigoFinanceiroBanco = fBoleto.codigoFinanceiroBanco\n      left join _banco b on b.codigoBanco = fBanco.codigoBanco\n      where fTitulo.id in (".concat(o,")"),this.cancelarAtualizarBoletos=!1,n=0;case 6:return a.prev=6,a.next=9,Object(g["executarSql"])(e);case 9:t=a.sent,n=0,a.next=17;break;case 13:a.prev=13,a.t0=a["catch"](6),t=[],++n%3===0&&this.$q.notifyError(a.t0.message);case 17:for(r=!0,s=!1,c=void 0,a.prev=20,l=function(){var a=d.value,e=i.find(function(e){return e.idFinanceiroTitulo===a.id});e&&(a.codigoFinanceiroBoleto&&(e.codigoFinanceiroBoleto=a.codigoFinanceiroBoleto,e.banco={descricao:a.descricao,dataEmissao:a.dataEmissao,agencia:a.agencia,conta:a.conta,arquivoBoleto:a.arquivoBoleto}),a.codigoFinanceiroTitulo&&(e.codigoFinanceiroTitulo=a.codigoFinanceiroTitulo,e.disable=!1))},u=t[Symbol.iterator]();!(r=(d=u.next()).done);r=!0)l();a.next=29;break;case 25:a.prev=25,a.t1=a["catch"](20),s=!0,c=a.t1;case 29:a.prev=29,a.prev=30,r||null==u.return||u.return();case 32:if(a.prev=32,!s){a.next=35;break}throw c;case 35:return a.finish(32);case 36:return a.finish(29);case 37:if(t.length!==i.length&&!this.cancelarAtualizarBoletos){a.next=39;break}return a.abrupt("break",42);case 39:return a.next=41,Object(g["dormir"])(5e3);case 41:a.next=6;break;case 42:case"end":return a.stop()}},a,this,[[6,13],[20,25,29,37],[30,,32,36]])}));return function(){return a.apply(this,arguments)}}(),atualizarModalBoleto:function(){var a=u()(regeneratorRuntime.mark(function a(){var e,t,o,i,n,r,s,l,u;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return this.modalBoleto={ativo:!1,visivel:!1,loading:!1,codigoFinanceiroBanco:"",condicoesPagamento:[],bancos:[]},e=[],a.next=4,Object(x["a"])().formaPagamento.toArray();case 4:return t=a.sent,a.next=7,Object(x["a"])().documentoCondicaoPagamento.where({idDocumento:this.dados.fatura.id}).each(function(a){var o=t.find(function(e){return e.id===a.idFormaPagamento&&99===e.tipo&&"Título em aberto"===e.tipoFinanceiro});o&&e.push({dataVencimento:a.dataVencimento,descricao:o.descricao,idFinanceiroTitulo:a.idFinanceiroTitulo,codigoFinanceiroBoleto:"",checked:!1,disable:!0,valor:a.valor})});case 7:if(e.length){a.next=9;break}return a.abrupt("return");case 9:return o=[],a.next=12,Object(x["a"])().financeiroBanco.each(function(a){a.ativo&&o.push(a)});case 12:return i=c()(new Set(o.map(function(a){return a.codigoBanco}))),n=[],a.next=16,Object(x["a"])()._banco.each(function(a){i.find(function(e){return e===a.codigoBanco})&&n.push(a)});case 16:this.modalBoleto.condicoesPagamento=Object(C["orderBy"])(e,"dataVencimento","asc"),r=[],s=function(){var a=o[l],e=n.find(function(e){return e.codigoBanco===a.codigoBanco})||{};if(!e)return"continue";var t=(e.descricao||"").trim(),i=(a.agencia||"").trim(),s=(a.conta||"").trim();if(!e.arquivoBoleto||!t||!i||!s)return"continue";var c=t+" - Ag. "+i+" C/C "+s;r.push({arquivoBoleto:e.arquivoBoleto,label:c,value:a.codigoFinanceiroBanco})},l=0;case 20:if(!(l<o.length)){a.next=27;break}if(u=s(),"continue"!==u){a.next=24;break}return a.abrupt("continue",24);case 24:l++,a.next=20;break;case 27:r.length&&(this.modalBoleto.codigoFinanceiroBanco=r[0].value,this.modalBoleto.bancos=r);case 28:case"end":return a.stop()}},a,this)}));return function(){return a.apply(this,arguments)}}(),fecharModalBoleto:function(){var a=this;this.cancelarAtualizarBoletos=!0,this.cancelarEmitirBoletos=!0,this.modalBoleto.visivel=!1,this.$nextTick().then(function(){a.modalBoleto.avito=!1})},emitirImprimirBoleto:function(){var a=u()(regeneratorRuntime.mark(function a(){var e,t,o,i,n,r,s,c,l,u,d,m,v,p,f,h,b,x,C,q,k,_,F,y,D,w,E,O=this;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:this.modalBoleto.loading=!0,i={},n=[],o=this.modalBoleto.condicoesPagamento.filter(function(a){return a.checked}),r=!0,s=!1,c=void 0,a.prev=6,l=o[Symbol.iterator]();case 8:if(r=(u=l.next()).done){a.next=20;break}if(d=u.value,!d.codigoFinanceiroBoleto||!(d.banco||{}).arquivoBoleto){a.next=16;break}if(i[d.banco.arquivoBoleto]){a.next=14;break}return i[d.banco.arquivoBoleto]=[d.codigoFinanceiroBoleto],a.abrupt("continue",17);case 14:return i[d.banco.arquivoBoleto].push(d.codigoFinanceiroBoleto),a.abrupt("continue",17);case 16:n.push(d.codigoFinanceiroTitulo);case 17:r=!0,a.next=8;break;case 20:a.next=26;break;case 22:a.prev=22,a.t0=a["catch"](6),s=!0,c=a.t0;case 26:a.prev=26,a.prev=27,r||null==l.return||l.return();case 29:if(a.prev=29,!s){a.next=32;break}throw c;case 32:return a.finish(29);case 33:return a.finish(26);case 34:if(!n.length||!this.modalBoleto.codigoFinanceiroBanco){a.next=89;break}if(this.cancelarEmitirBoletos=!1,f=0,h=0,b=(this.modalBoleto.bancos.find(function(a){return a.value===O.modalBoleto.codigoFinanceiroBanco})||{}).arquivoBoleto,b){a.next=41;break}return this.$q.notifyError("Arquivo boleto não encontrado"),a.abrupt("return");case 41:e="sp_financeiro_boletoEmitir ".concat(this.modalBoleto.codigoFinanceiroBanco,", '").concat(n.join(","),"'");case 42:if(!this.cancelarEmitirBoletos){a.next=44;break}return a.abrupt("break",89);case 44:return a.prev=44,a.next=47,Object(g["executarSql"])(e);case 47:t=a.sent,f=0,a.next=55;break;case 51:a.prev=51,a.t1=a["catch"](44),t=[],++f%3===0&&this.$q.notifyError(a.t1.message);case 55:if(m=(t||[])[0],v=((m||{}).Msg||"").trim(),p=((m||{}).Retorno||"").trim(),"Boleto Gerado com sucesso!"!==v||!p){a.next=85;break}if(x=p.substring(0,p.length-1).split(","),i[b]){a.next=63;break}return i[b]=x,a.abrupt("break",89);case 63:for(C=!0,q=!1,k=void 0,a.prev=66,_=x[Symbol.iterator]();!(C=(F=_.next()).done);C=!0)y=F.value,i[b].push(y);a.next=74;break;case 70:a.prev=70,a.t2=a["catch"](66),q=!0,k=a.t2;case 74:a.prev=74,a.prev=75,C||null==_.return||_.return();case 77:if(a.prev=77,!q){a.next=80;break}throw k;case 80:return a.finish(77);case 81:return a.finish(74);case 82:return a.abrupt("break",89);case 85:++h%3===0&&this.$q.notifyError(v);case 86:return a.next=88,Object(g["dormir"])(5e3);case 88:a.next=42;break;case 89:for(w in D=JSON.parse(localStorage.getItem("clienteSistema"))||{},i)E=void 0,E="https://rel.storage.b15.com.br/Relatorios/"+w+".html?",E+="CodigoFinanceiroBoleto="+i[w].join(","),E+="&Banco="+D.bancoDeDados,E+="&URLServidor="+D.urlServidor,window.open(E);return a.next=93,this.atualizarBoletos();case 93:this.modalBoleto.loading=!1;case 94:case"end":return a.stop()}},a,this,[[6,22,26,34],[27,,29,33],[44,51],[66,70,74,82],[75,,77,81]])}));return function(){return a.apply(this,arguments)}}(),alternarDetalhes:function(){this.detalhesVisivel=!this.detalhesVisivel},atualizar:function(){var a=u()(regeneratorRuntime.mark(function a(){var e,t,o,i,n=this;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,b["a"].fatura.leCompleto(this.id);case 2:return e=a.sent,a.next=5,e.vendas.reduce(function(){var a=u()(regeneratorRuntime.mark(function a(e,t){return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:if(e[t.idContatoVendedor]){a.next=4;break}return a.next=3,b["a"].contato.le({id:t.idContatoVendedor});case 3:e[t.idContatoVendedor]=a.sent;case 4:return a.abrupt("return",e);case 5:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}(),{});case 5:if(t=a.sent,!e.fatura.idContato){a.next=12;break}if(o=e.fatura.idContato,t[o]){a.next=12;break}return a.next=11,b["a"].contato.le({id:o});case 11:t[o]=a.sent;case 12:return this.configuraImpressaoCarne(e.fatura.idEmpresa),this.configuraImpressaoConvenio(e.fatura.idEmpresa),this.configuraImpressaoEnvelope(e.fatura.idEmpresa),this.configuraImpressaoFatura(e.fatura.idEmpresa),this.contatos=t,this.dados=e,this.atualizarModalBoleto(),this.condicaoPagamento=e.condicaoPagamento,this.resumeCondicaoPagamento(),a.next=23,b["a"].contatoBusca.filtrar(null,{ativo:!0,empresas:!0},0);case 23:i=a.sent,this.podeEditar=!1,i.find(function(a){return a.id===e.fatura.idEmpresa})&&(this.podeEditar=!0),this.$nextTick(function(){e.fatura.id===localStorage.getItem("idFatura")&&(n.faturaVisivel=n.podeEditar,localStorage.removeItem("idFatura"))});case 27:case"end":return a.stop()}},a,this)}));return function(){return a.apply(this,arguments)}}(),copiarUid:function(){var a=this.$refs.uid;a.type="text";try{a.select(),document.execCommand("copy"),this.$q.notify({message:"UID copiado para a área de transferência.",type:"info"})}catch(a){this.$q.notify("Erro ao copiar.")}a.type="hidden",window.getSelection().removeAllRanges()},configuraImpressaoConvenio:function(){var a=u()(regeneratorRuntime.mark(function a(e){var t;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,b["a"].configuracoes.porNome("impressao.convenio",e);case 2:t=a.sent,this.configImpressaoConvenio=c()(t.length?t.map(function(a){return r()({texto:"Imprimir Convênio"},a)}):[{valor:"convenio",texto:"Imprimir Convênio"}]);case 4:case"end":return a.stop()}},a,this)}));return function(e){return a.apply(this,arguments)}}(),configuraImpressaoCarne:function(){var a=u()(regeneratorRuntime.mark(function a(e){var t;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,b["a"].configuracoes.porNome("impressao.carne",e);case 2:t=a.sent,this.configImpressaoCarne=c()(t.length?t.map(function(a){return r()({texto:"Imprimir Carnê"},a)}):[{valor:"carne-crediario",texto:"Reimprimir carnê e notas promissórias da fatura"}]);case 4:case"end":return a.stop()}},a,this)}));return function(e){return a.apply(this,arguments)}}(),configuraImpressaoEnvelope:function(){var a=u()(regeneratorRuntime.mark(function a(e){var t;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,b["a"].configuracoes.porNome("impressao.envelope",e);case 2:t=a.sent,this.configImpressaoEnvelope=c()(t.length?t.map(function(a){return r()({texto:"Imprimir Envelope"},a)}):[{valor:"envelope",texto:"Imprimir Envelope"},{valor:"envelopeMini",texto:"Imprimir Envelope Mini"}]);case 4:case"end":return a.stop()}},a,this)}));return function(e){return a.apply(this,arguments)}}(),configuraImpressaoFatura:function(){var a=u()(regeneratorRuntime.mark(function a(e){var t;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,b["a"].configuracoes.porNome("impressao.fatura",e);case 2:t=a.sent,this.configImpressaoFatura=c()(t.length?t.map(function(a){return r()({texto:"Imprimir Fatura"},a)}):[{valor:"invoice",texto:"Fatura (Invoice)"},{valor:"fatura-recibo",texto:"Recibo"}]);case 4:case"end":return a.stop()}},a,this)}));return function(e){return a.apply(this,arguments)}}(),editar:function(){this.faturaVisivel=!0},executar:function(){var a=u()(regeneratorRuntime.mark(function a(e){return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:a.t0=e,a.next="atualizar"===a.t0?3:"finalizar"===a.t0?3:"retornarOrcamento"===a.t0?3:"remover"===a.t0?3:5;break;case 3:return this.$emit("executar","atualizar"),a.abrupt("return");case 5:return a.next=7,this.atualizar();case 7:case"end":return a.stop()}},a,this)}));return function(e){return a.apply(this,arguments)}}()},mixins:[h["a"],p["a"]],props:{id:{required:!0,type:String}},mounted:function(){this.sistemaPai=Object(g["sistemaPai"])(),this.atualizar()}},k=q,_=(t("efd0"),t("2877")),F=Object(_["a"])(k,o,i,!1,null,"44160621",null);F.options.__file="FaturaCard.vue";e["a"]=F.exports},efd0:function(a,e,t){"use strict";var o=t("f4f9"),i=t.n(o);i.a},f377:function(a,e,t){"use strict";var o=function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("q-modal",{attrs:{value:a.visivel,maximized:""},on:{input:a.eventoInput}},[t("q-modal-layout",{staticClass:"bg-light"},[t("q-toolbar",{attrs:{slot:"header"},slot:"header"},[t("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"arrow_back",round:""}}),t("q-toolbar-title",[a._v("Fechar caixa")])],1),t("div",{staticClass:"gutter-md layout-padding row"},[t("div",{staticClass:"col-12 col-lg-7"},[t("div",{staticClass:"bg-white round-borders q-pa-md"},[t("div",{staticClass:"items-center row"},[t("div",{staticClass:"col q-title"},[a._v(a._s(a.campos.caixaDescricao))]),t("div",{staticClass:"col text-faded text-right"},[t("q-icon",{attrs:{name:"place"}}),a._v("\n              "+a._s(a.campos.caixaEmpresaNome)+"\n            ")],1)]),t("form",{staticClass:"q-mt-lg"},[t("div",{staticClass:"q-subheading text-weight-medium"},[a._v("Dinheiro")]),t("div",{staticClass:"row q-mt-sm"},[t("div",{staticClass:"col-12 col-lg-8 items-center gutter-sm q-body-1 row"},[t("div",{staticClass:"col-5"},[a._v("Abertura")]),t("div",{staticClass:"col-7"},[t("campo",{staticClass:"bg-grey-2",attrs:{tipo:"decimal",decimals:"2"},model:{value:a.campos.abertura,callback:function(e){a.$set(a.campos,"abertura",e)},expression:"campos.abertura"}})],1),t("div",{staticClass:"col-5"},[a._v("Recebimentos")]),t("div",{staticClass:"col-7 text-right"},[a._v("\n                  "+a._s(a._f("numero")(a.recebimentos,2))+"\n                  "),t("q-tooltip",[a._v("Fechamento - Abertura + Despesas - Suprimentos + Sangrias = "),t("strong",[a._v("Recebimentos")])])],1),t("div",{staticClass:"col-5"},[a._v("Sangrias")]),t("div",{staticClass:"col-7 text-right"},[a._v(a._s(a._f("numero")(a.campos.sangrias,2)))]),t("div",{staticClass:"col-5"},[a._v("Suprimentos")]),t("div",{staticClass:"col-7 text-right"},[a._v(a._s(a._f("numero")(a.campos.suprimentos,2)))]),t("div",{staticClass:"col-5"},[a._v("Despesas")]),t("div",{staticClass:"col-7 text-right"},[a._v(a._s(a._f("numero")(a.campos.despesas,2)))]),t("div",{staticClass:"col-5"},[a._v("Fechamento")]),t("div",{staticClass:"col-7"},[t("campo",{staticClass:"bg-grey-2",attrs:{tipo:"decimal",decimals:"2"},on:{blur:a.calculaSangriaFinal},model:{value:a.campos.fechamento,callback:function(e){a.$set(a.campos,"fechamento",e)},expression:"campos.fechamento"}})],1),t("div",{staticClass:"col-5"},[a._v("Fundo de caixa")]),t("div",{staticClass:"col-7"},[t("campo",{staticClass:"bg-grey-2",attrs:{tipo:"decimal",decimals:"2"},on:{blur:a.calculaSangriaFinal},model:{value:a.campos.fundoCaixa,callback:function(e){a.$set(a.campos,"fundoCaixa",e)},expression:"campos.fundoCaixa"}})],1),t("div",{staticClass:"col-5"},[a._v("Sangria Final")]),t("div",{staticClass:"col-7 text-right"},[a._v(a._s(a._f("numero")(a.campos.sangriaFinal,2)))])]),t("div",{staticClass:"Faturamento-historico col-12 col-lg-4 q-caption text-faded text-right"},[t("div",[a._v("\n                  "+a._s(a._f("dataHora")(a.campos.dataHoraAbertura))+" "),t("q-icon",{attrs:{name:"calendar_today"}}),t("br"),a._v("\n                  "+a._s(a.campos.nomeUsuarioAbertura)+" "),t("q-icon",{attrs:{name:"person"}})],1)])]),t("div",{staticClass:"q-subheading text-weight-medium q-mt-lg"},[a._v("Outras formas de pagamento")]),t("div",{staticClass:"q-mt-sm"},a._l(a.condicaoPagamento,function(e){return t("div",{key:e.id,staticClass:"gutter-x-sm items-center q-mt-sm row"},[t("div",{staticClass:"col-7"},[a._v(a._s(e.descricao))]),t("div",{staticClass:"col-5"},[[5,99].includes(e.tipo)?t("div",{staticClass:"text-right",staticStyle:{"padding-top":"6px","padding-right":"8px"}},[a._v(a._s(a._f("numero")(e.valor,2)))]):t("campo",{attrs:{classCampo:"bg-grey-2 q-px-sm",tipo:"decimal",decimals:"2"},model:{value:e.valor,callback:function(t){a.$set(e,"valor",t)},expression:"c.valor"}})],1)])})),t("campo",{staticClass:"bg-grey-2 q-mt-lg q-pa-xs",attrs:{rotulo:"Observação",rows:"2",tipo:"textoArea"},model:{value:a.campos.observacao,callback:function(e){a.$set(a.campos,"observacao",e)},expression:"campos.observacao"}})],1)])]),t("div",{staticClass:"col-12 col-lg-5"},[t("div",{staticClass:"q-title text-primary"},[a._v("Sangrias")]),t("table",{staticClass:"Tabela q-mt-md"},[t("thead",[t("tr",[t("th",[a._v("Data Emissão")]),t("th",[a._v("Observação")]),t("th",[a._v("Valor")])])]),t("tbody",a._l(a.sangrias,function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(a._f("data")(e.dataEmissao)))]),t("td",[a._v(a._s(e.observacao))]),t("td",[a._v(a._s(a._f("numero")(e.valorCredito,2)))])])}))]),t("div",{staticClass:"q-title q-mt-xl text-primary"},[a._v("Transferências")]),t("table",{staticClass:"Tabela q-mt-md"},[t("thead",[t("tr",[t("th",[a._v("Data Emissão")]),t("th",[a._v("Observação")]),t("th",[a._v("Valor")])])]),t("tbody",a._l(a.suprimentos,function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(a._f("data")(e.dataEmissao)))]),t("td",[a._v(a._s(e.observacao))]),t("td",[a._v(a._s(a._f("numero")(e.valorDebito,2)))])])}))]),t("div",{staticClass:"q-title q-mt-xl text-primary"},[a._v("Despesas simples")]),t("table",{staticClass:"Tabela q-mt-md"},[t("thead",[t("tr",[t("th",[a._v("Data emissão")]),t("th",[a._v("Pago à")]),t("th",[a._v("Conta despesa")]),t("th",[a._v("Valor")])])]),t("tbody",a._l(a.despesas,function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(a._f("data")(e.dataEmissao)))]),t("td",[a._v(a._s((e.contato||{}).nome))]),t("td",[a._v(a._s(((e.financeiroPlanoConta||{}).descricao||"").trim()))]),t("td",[a._v(a._s(a._f("numero")(e.valorTotal,2)))])])}))])])]),t("q-toolbar",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[t("q-toolbar-title",{staticClass:"text-right"},[t("q-btn",{staticClass:"q-ml-sm",attrs:{color:"primary",label:"Concluir"},on:{click:a.fecharCaixa}})],1)],1)],1)],1)},i=[];o._withStripped=!0;t("ac4d"),t("8a81"),t("ac6a"),t("6762"),t("2fdb"),t("96cf");var n=t("c973"),r=t.n(n),s=t("88db"),c=t("8149"),l=t("ed08"),u=t("2ef0"),d={components:{Campo:s["a"]},computed:{recebimentos:function(){var a=Object(l["arredondar"])((this.campos.fechamento||0)-(this.campos.abertura||0)+(this.campos.despesas||0)-(this.campos.suprimentos||0)+(this.campos.sangrias||0));return a}},data:function(){return{visivel:!1,campos:{sangrias:0,despesas:0,suprimentos:0,sangriaFinal:0,fundoCaixa:0,abertura:0,dataHoraAbertura:"",nomeUsuarioAbertura:"",caixaDescricao:"",caixaEmpresaNome:"",observacao:""},sangrias:[],despesas:[],suprimentos:[],condicaoPagamento:[],condicaoPagamentoDinheiro:[]}},methods:{calculaSangriaFinal:function(){var a=Object(l["arredondar"])(this.campos.fechamento-this.campos.fundoCaixa);a<0&&(this.$q.notify({message:"Sangria final não pode ser maior do que o recebimento",type:"warning"}),this.campos.fundoCaixa=0,a=Object(l["arredondar"])(this.campos.fechamento)),this.campos.sangriaFinal=a},atualizar:function(){var a=r()(regeneratorRuntime.mark(function a(){var e,t,o,i,n,r,s,d,m,v,p,f,h,b,x,C,g,q,k,_,F,y,D,w,E=this;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:if(a.prev=0,this.$q.loading.show({message:"Processando..."}),this.campos.sangrias=0,this.campos.despesas=0,this.campos.suprimentos=0,this.campos.sangriaFinal=0,this.campos.fundoCaixa=0,this.campos.abertura=0,this.campos.dataHoraAbertura="",this.campos.nomeUsuarioAbertura="",this.campos.caixaDescricao="",this.campos.caixaEmpresaNome="",this.campos.observacao="",this.documentoCaixa={},!this.idDocumentoCaixa){a.next=19;break}return a.next=17,c["a"].documento.le({id:this.idDocumentoCaixa});case 17:e=a.sent,"Caixa"===e.tipo&&["Aberto","Reaberto"].includes(e.status)&&(this.documentoCaixa=e);case 19:if(this.documentoCaixa&&this.documentoCaixa.id){a.next=23;break}return this.$q.notify({message:"Selecione um caixa aberto",type:"warning"}),this.$emit("input",!1),a.abrupt("return");case 23:return a.next=25,c["a"].documentoCondicaoPagamento.le({idDocumentoCaixa:this.idDocumentoCaixa});case 25:t=a.sent,o={},i=!0,n=!1,r=void 0,a.prev=30,s=t[Symbol.iterator]();case 32:if(i=(d=s.next()).done){a.next=45;break}if(m=d.value,!m.idDocumento||o[m.idDocumento]){a.next=42;break}return a.next=37,c["a"].documento.le({id:m.idDocumento});case 37:if(o[m.idDocumento]=a.sent,o[m.idDocumento].dataHoraFinalizado){a.next=42;break}return this.$q.notify({message:"Existem faturas abertas com condição de pagamento lançada. Não é possível finalizar o caixa sem finalizar ou excluir essas faturas!",type:"warning"}),this.$emit("input",!1),a.abrupt("return");case 42:i=!0,a.next=32;break;case 45:a.next=51;break;case 47:a.prev=47,a.t0=a["catch"](30),n=!0,r=a.t0;case 51:a.prev=51,a.prev=52,i||null==s.return||s.return();case 54:if(a.prev=54,!n){a.next=57;break}throw r;case 57:return a.finish(54);case 58:return a.finish(51);case 59:return a.next=61,c["a"].caixa.le({id:this.documentoCaixa.idCaixa});case 61:return this.caixa=a.sent,a.next=64,c["a"].financeiroTitulo.le({idDocumentoCaixa:this.documentoCaixa.id});case 64:return v=a.sent,a.next=67,c["a"].empresa.le({idContato:this.documentoCaixa.idEmpresa});case 67:return p=a.sent,p.length&&(this.empresa=p[0]),a.next=71,c["a"].financeiroMovimentacao.le({idDocumentoCaixa:this.documentoCaixa.id,documentoTipo:"Sangria"});case 71:f=a.sent,this.sangrias=f.filter(function(a){return a.valorCredito>0}),this.campos.sangrias=Object(l["arredondar"])(this.sangrias.reduce(function(a,e){return a+=e.valorCredito,a},0)),this.despesas=v.filter(function(a){return"DespesaSimples"===a.documentoTipo}),h=0,b=!0,x=!1,C=void 0,a.prev=79,g=this.despesas[Symbol.iterator]();case 81:if(b=(q=g.next()).done){a.next=93;break}return k=q.value,h+=k.valorTotal,a.next=86,c["a"].contato.le({id:k.idContato});case 86:return k.contato=a.sent,a.next=89,c["a"].financeiroPlanoConta.le({id:k.idFinanceiroPlanoConta});case 89:k.financeiroPlanoConta=a.sent;case 90:b=!0,a.next=81;break;case 93:a.next=99;break;case 95:a.prev=95,a.t1=a["catch"](79),x=!0,C=a.t1;case 99:a.prev=99,a.prev=100,b||null==g.return||g.return();case 102:if(a.prev=102,!x){a.next=105;break}throw C;case 105:return a.finish(102);case 106:return a.finish(99);case 107:return this.campos.despesas=Object(l["arredondar"])(h),a.next=110,c["a"].financeiroMovimentacao.le({idDocumentoCaixa:this.documentoCaixa.id,documentoTipo:"Suprimento"});case 110:return _=a.sent,this.suprimentos=_.filter(function(a){return a.valorDebito>0}),this.campos.suprimentos=Object(l["arredondar"])(this.suprimentos.reduce(function(a,e){return a+=e.valorDebito,a},0)),a.next=115,c["a"].formaPagamento.le();case 115:for(D in a.t2=function(a){return(!a.idContatoEmpresa||a.idContatoEmpresa===E.documentoCaixa.idEmpresa)&&!!a.ativo},a.t3=function(a){return{id:a.id,tipo:a.tipo,descricao:a.descricao,valor:0,idFinanceiroPlanoConta:a.idFinanceiroPlanoConta}},F=a.sent.filter(a.t2).map(a.t3),y=function(a){var e=t.filter(function(e){return e.idDocumento===a}),o=!0,i=!1,n=void 0;try{for(var r,s=e[Symbol.iterator]();!(o=(r=s.next()).done);o=!0){var c=r.value,u=!0,d=!1,m=void 0;try{for(var v,p=F[Symbol.iterator]();!(u=(v=p.next()).done);u=!0){var f=v.value;f.id===c.idFormaPagamento&&[5,97,99].includes(f.tipo)&&(f.valor=Object(l["arredondar"])(f.valor+c.valor))}}catch(a){d=!0,m=a}finally{try{u||null==p.return||p.return()}finally{if(d)throw m}}}}catch(a){i=!0,n=a}finally{try{o||null==s.return||s.return()}finally{if(i)throw n}}},o)y(D);return this.condicaoPagamento=Object(u["orderBy"])(F.filter(function(a){return a.idFinanceiroPlanoConta!==E.caixa.idPlanoConta}),"descricao","asc"),this.condicaoPagamentoDinheiro=F.filter(function(a){return a.idFinanceiroPlanoConta===E.caixa.idPlanoConta}),this.campos.abertura=this.documentoCaixa.valorAbertura,this.campos.dataHoraAbertura=this.documentoCaixa.dataHoraEmissao,a.next=126,c["a"].usuario.le({id:this.documentoCaixa.idContato});case 126:w=a.sent,this.campos.nomeUsuarioAbertura=w.nome||"",this.campos.caixaDescricao=this.caixa.descricao,this.campos.caixaEmpresaNome=this.empresa.nome,this.calculaSangriaFinal(),this.$q.loading.hide(),this.visivel=!0,this.$emit("input",this.visivel),a.next=139;break;case 136:a.prev=136,a.t4=a["catch"](0),this.$q.notifyError("Não foi possível realizar o Fechamento de Caixa.",a.t4);case 139:return a.prev=139,this.$q.loading.hide(),a.finish(139);case 142:case"end":return a.stop()}},a,this,[[0,136,139,142],[30,47,51,59],[52,,54,58],[79,95,99,107],[100,,102,106]])}));return function(){return a.apply(this,arguments)}}(),fecharCaixa:function(){var a=r()(regeneratorRuntime.mark(function a(){var e,t,o,i,n,r,s,d,m,v,p,f,h,b,x,C,g,q,k,_,F,y,D,w,E,O,P,j,T,S,R,z,$,M,B,I,V,N,A,L,H,J,U,W,Y,G,Q,K,X,Z,aa,ea;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:if(a.prev=0,this.$q.loading.show({message:"Processando..."}),!(this.campos.sangriaFinal<0)){a.next=5;break}return this.$q.notify({message:"Sangria final não pode ser negativa.",type:"warning"}),a.abrupt("return");case 5:return e=Object(l["dataAtual"])(),t=Object(l["clonar"])(this.documentoCaixa),t.status="Aguardando Conferência",t.dataHoraFinalizado=e,t.observacao=this.observacao,t.valorAbertura=this.campos.abertura,a.next=13,c["a"].caixa.le({id:t.idCaixa});case 13:return o=a.sent,Object(l["verificarErro"])(!o.id,"Caixa não existe"),a.next=17,c["a"].financeiroPlanoConta.le({id:o.idPlanoConta});case 17:return i=a.sent,a.next=20,c["a"].financeiroPlanoConta.le({id:o.idPlanoContaSangria});case 20:return n=a.sent,a.next=23,c["a"].documentoStatus.le({idDocumento:t.id});case 23:return r=a.sent,r=r.filter(function(a){return"Fechamento Caixa"===a.operacao&&"Aguardando Conferência"===a.statusFinalizado&&"Aberto"===a.statusOriginal}),this.campos.sangriaFinal>0&&(s=r.length?r[0].dataHoraEmissao:e,d=c["a"].usuario.logado.id,m=Object(l["uuid"])(),v={id:Object(l["uuid"])(),idFinanceiroMovimentacaoN:m,idEmpresa:t.idEmpresa,idContato:d,idFinanceiroPlanoConta:i.id,dataEmissao:e,dataCompetencia:s,dataVencimento:s,dataMovimento:s,valorDebito:0,valorCredito:this.campos.sangriaFinal,descricao:"Sangria final de ".concat(c["a"].usuario.logado.apelido," no Caixa #").concat(t.id),observacao:"Transferência entre contas",documentoTipo:"Sangria Final",documentoId:t.id,idDocumentoCaixa:t.id},p={id:Object(l["uuid"])(),idFinanceiroMovimentacaoN:m,idEmpresa:t.idEmpresa,idContato:d,idFinanceiroPlanoConta:n.id,dataEmissao:e,dataCompetencia:s,dataVencimento:s,dataMovimento:s,valorDebito:this.campos.sangriaFinal,valorCredito:0,descricao:"Sangria final de ".concat(c["a"].usuario.logado.apelido," no Caixa #").concat(t.id),observacao:"Transferência entre contas",documentoTipo:"Sangria Final",documentoId:t.id,idDocumentoCaixa:t.id},c["a"].financeiroMovimentacaoN.grava({atual:{id:m}}),c["a"].financeiroMovimentacao.grava({atual:v}),c["a"].financeiroMovimentacao.grava({atual:p})),a.next=28,c["a"].documentoStatus.le({idDocumento:t.id});case 28:for(f=a.sent,h="",f.length&&(f=Object(u["orderBy"])(f,"dataHoraEmissao","desc"),h=f[0].statusFinalizado),b=Object(l["uuid"])(),x={id:b,idDocumento:t.id,operacao:"Fechamento Caixa",statusOriginal:h,statusFinalizado:"Aguardando Conferência",dataHoraEmissao:e,idUsuarioAlterou:c["a"].usuario.logado.id,idDocumentoCaixa:t.id},C=[],g=!0,q=!1,k=void 0,a.prev=37,_=this.condicaoPagamento[Symbol.iterator]();!(g=(F=_.next()).done);g=!0)y=F.value,C.push({id:Object(l["uuid"])(),idDocumento:t.id,idFormaPagamento:y.id,dataVencimento:e,valor:y.valor,ordem:b});a.next=45;break;case 41:a.prev=41,a.t0=a["catch"](37),q=!0,k=a.t0;case 45:a.prev=45,a.prev=46,g||null==_.return||_.return();case 48:if(a.prev=48,!q){a.next=51;break}throw k;case 51:return a.finish(48);case 52:return a.finish(45);case 53:for(D=!0,w=!1,E=void 0,a.prev=56,O=this.condicaoPagamentoDinheiro[Symbol.iterator]();!(D=(P=O.next()).done);D=!0)j=P.value,C.push({id:Object(l["uuid"])(),idDocumento:t.id,idFormaPagamento:j.id,dataVencimento:e,valor:this.campos.fechamento,ordem:b});a.next=64;break;case 60:a.prev=60,a.t1=a["catch"](56),w=!0,E=a.t1;case 64:a.prev=64,a.prev=65,D||null==O.return||O.return();case 67:if(a.prev=67,!w){a.next=70;break}throw E;case 70:return a.finish(67);case 71:return a.finish(64);case 72:return a.next=74,c["a"].documentoCondicaoPagamento.le({idDocumentoCaixa:t.id});case 74:return T=a.sent,a.next=77,c["a"].financeiroTitulo.le({idDocumentoCaixa:t.id,idDocumentoCaixaLiquidacao:t.id});case 77:return S=a.sent,a.next=80,c["a"].financeiroMovimentacao.le({idDocumentoCaixa:t.id});case 80:for(R=a.sent,z=[],$=!0,M=!1,B=void 0,a.prev=85,I=T[Symbol.iterator]();!($=(V=I.next()).done);$=!0)N=V.value,z.push({id:Object(l["uuid"])(),idDocumentoCaixa:t.id,idDocumentoStatus:b,tabela:"documentoCondicaoPagamento",idTabela:N.id,json:JSON.stringify(N),dataHoraEmissao:e});a.next=93;break;case 89:a.prev=89,a.t2=a["catch"](85),M=!0,B=a.t2;case 93:a.prev=93,a.prev=94,$||null==I.return||I.return();case 96:if(a.prev=96,!M){a.next=99;break}throw B;case 99:return a.finish(96);case 100:return a.finish(93);case 101:for(A=0;A<C.length;A++)L=C[A],z.push({id:Object(l["uuid"])(),idDocumentoCaixa:t.id,idDocumentoStatus:b,tabela:"documentoCondicaoPagamento",idTabela:L.id,json:JSON.stringify(L),dataHoraEmissao:e});for(H=!0,J=!1,U=void 0,a.prev=105,W=S[Symbol.iterator]();!(H=(Y=W.next()).done);H=!0)G=Y.value,z.push({id:Object(l["uuid"])(),idDocumentoCaixa:t.id,idDocumentoStatus:b,tabela:"financeiroTitulo",idTabela:G.id,json:JSON.stringify(G),dataHoraEmissao:e});a.next=113;break;case 109:a.prev=109,a.t3=a["catch"](105),J=!0,U=a.t3;case 113:a.prev=113,a.prev=114,H||null==W.return||W.return();case 116:if(a.prev=116,!J){a.next=119;break}throw U;case 119:return a.finish(116);case 120:return a.finish(113);case 121:for(Q=!0,K=!1,X=void 0,a.prev=124,Z=R[Symbol.iterator]();!(Q=(aa=Z.next()).done);Q=!0)ea=aa.value,z.push({id:Object(l["uuid"])(),idDocumentoCaixa:t.id,idDocumentoStatus:b,tabela:"financeiroMovimentacao",idTabela:ea.id,json:JSON.stringify(ea),dataHoraEmissao:e});a.next=132;break;case 128:a.prev=128,a.t4=a["catch"](124),K=!0,X=a.t4;case 132:a.prev=132,a.prev=133,Q||null==Z.return||Z.return();case 135:if(a.prev=135,!K){a.next=138;break}throw X;case 138:return a.finish(135);case 139:return a.finish(132);case 140:return a.next=142,c["a"].caixa.fecha({documentoCaixa:t,documentoCaixaOriginal:this.documentoCaixa,documentoStatus:[x],caixaConsolidacao2:z});case 142:this.$q.loading.hide(),this.visivel=!1,this.$emit("input",!1),this.$emit("fechado"),this.imprimir("fechamento-de-caixa",this.documentoCaixa.id),this.$q.notifyPositive("Caixa fechado com sucesso"),a.next=153;break;case 150:a.prev=150,a.t5=a["catch"](0),this.$q.notifyError("Não foi possível realizar o Fechamento de Caixa.",a.t5);case 153:return a.prev=153,this.$q.loading.hide(),a.finish(153);case 156:case"end":return a.stop()}},a,this,[[0,150,153,156],[37,41,45,53],[46,,48,52],[56,60,64,72],[65,,67,71],[85,89,93,101],[94,,96,100],[105,109,113,121],[114,,116,120],[124,128,132,140],[133,,135,139]])}));return function(){return a.apply(this,arguments)}}(),eventoInput:function(a){this.visivel=a,this.$emit("input",a)}},props:{idDocumentoCaixa:{default:"",required:!0,type:String},value:{default:!1,required:!0,type:Boolean}},watch:{value:function(a){a&&this.atualizar()}}},m=d,v=(t("c980"),t("2877")),p=Object(v["a"])(m,o,i,!1,null,"6077c736",null);p.options.__file="CaixaFechar.vue";e["a"]=p.exports},f4f9:function(a,e,t){}}]);