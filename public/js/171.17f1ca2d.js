"use strict";(globalThis.webpackChunkb15=globalThis.webpackChunkb15||[]).push([[171],{35171:(e,o,t)=>{t.r(o),t.d(o,{default:()=>Te});var a=t(34182);const i=(0,a.createElementVNode)("span",{class:"col-12 text-body1 text-dark"},"Período de Emissão",-1),r=(0,a.createElementVNode)("span",{class:"col-12 text-body1 text-dark"},"Período de Finalização",-1),l=(0,a.createElementVNode)("p",null,null,-1),n=["onClick"];var d=t(32758);const s={class:"col-auto q-pl-none items-center"},c={class:"col"},u={class:"col-auto"},m={class:"col"},p={class:"col"},f=(0,a.createTextVNode)(" Finalizado "),h=(0,a.createTextVNode)(" Emissão "),g={class:"col"},v=(0,a.createTextVNode)(" Vendedor(a) "),V=(0,a.createTextVNode)(" Finalizado "),C=(0,a.createTextVNode)(" Emissão "),N=(0,a.createTextVNode)(" Total "),w=(0,a.createTextVNode)(" Subtotal "),b=(0,a.createTextVNode)("Emitir Boleto"),x=(0,a.createTextVNode)("Emitir cupom"),B=(0,a.createTextVNode)("NFe de Saída/Venda"),k=(0,a.createTextVNode)("NFe de Entrada/Devolução"),y=(0,a.createTextVNode)("NFe de Remessa"),E=(0,a.createTextVNode)("Remover Fatura"),_=(0,a.createTextVNode)("Histórico do Status"),$=(0,a.createTextVNode)("Enviar Avaliação"),S={class:"col-12 col-md-6"},D={class:"text-subtitle1 text-weight-bold q-ma-none items-center"},F={class:"col-12 col-md-4"},T=(0,a.createElementVNode)("p",{class:"text-subtitle1 text-weight-bold q-ma-none"}," Faturamento ",-1),q={class:"q-ma-none"},I={class:"col-12 col-md-2 text-right"},z=(0,a.createElementVNode)("p",{class:"text-subtitle1 text-weight-bold q-ma-none"}," Desconto ",-1),A={class:"q-ma-none"},P=(0,a.createElementVNode)("span",{class:"text-weight-bold"},"Emissão de Boleto",-1),R=(0,a.createTextVNode)("Recuperando informações do servidor "),O=(0,a.createTextVNode)("Boletos emitidos"),M=(0,a.createTextVNode)("Boletos a emitir"),Z={class:"q-mt-lg text-center"};var U=t(33337),Q=t(77810),j=t(97093),L=t(94230),H=t(98396),J=t(19306),X=t(48409),Y=t(88603),G=t(80126);const W={components:{Avatar:U.Z,DocumentosFiscais:Q.Z,FaturaModal:L.Z,ModalHistoricoStatus:J.Z},computed:{config:()=>$db.configuracoes.valores,mostrarOpcaoEmitirBoleto(){return(this.modalBoleto.condicoesPagamento||[]).length&&(this.modalBoleto.bancos||[]).length},mostrarOpcaoRemoverFatura(){return"Aberta"===this.dados.fatura.status&&!this.dados.carnes.length&&!this.dados.condicaoPagamento.length&&!this.dados.vendas.length},ativarBotaoEmissaoBoleto(){const e=Number(this.modalBoleto.financeiroBanco.value);return Number.isInteger(e)&&e&&this.modalBoleto.condicoesPagamento.find((e=>e.checked))}},data:()=>({dbUsuario:$db.usuario,dados:{fatura:{}},contatos:{},detalhesVisivel:!1,sistemaPai:"",configImpressaoCarne:[],configImpressaoConvenio:[],configImpressaoFatura:[],configImpressaoEnvelope:[],modalBoleto:{},podeEditar:!1,mostrarBotaoEnviarAvaliacao:!1}),emits:["executar"],methods:{async removerFatura(){try{await new Promise(((e,o)=>{this.$q.dialog({message:"Esta ação irá remover esta fatura.",noRefocus:!0,preventClose:!0,title:"Tem certeza?",cancel:{label:"CANCELAR",push:!0,color:"tertiary",flat:!0},ok:{label:"CONTINUAR",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk((()=>{e()})).onCancel((()=>{o()}))}))}catch(e){return}this.dados.fatura.id?(await $db.fatura.remover(this.dados.fatura.id),this.$emit("executar","atualizar")):this.$q.notify("Não foi possível realizar a operação")},abrirModalBoleto(){for(const e of this.modalBoleto.condicoesPagamento)e.checked=!1,e.disable=!0,e.codigoFinanceiroBoleto="",e.codigoFinanceiroTitulo="",e.banco={};this.modalBoleto.checked=!1,this.modalBoleto.financeiroBanco=this.modalBoleto.bancos[0],this.modalBoleto.ativo=!0,this.$nextTick().then((()=>{this.modalBoleto.visivel=!0,this.atualizarBoletos()}))},alternarCheckboxModalBoleto(e){"todos"!==e?this.modalBoleto.checked=!this.modalBoleto.condicoesPagamento.find((e=>!e.checked)):this.modalBoleto.condicoesPagamento.forEach((e=>{e.checked=this.modalBoleto.checked}))},async atualizarBoletos(){let e,o,t,a;a=this.modalBoleto.condicoesPagamento,t=a.reduce(((e,o)=>e+"'"+o.idFinanceiroTitulo+"',"),""),t=t.slice(0,t.length-1),e=`select\n          fTitulo.id,\n          fTitulo.codigoFinanceiroTitulo,\n          fBoleto.codigoFinanceiroBoleto,\n          fBoleto.dataEmissao,\n          b.descricao,\n          fBanco.agencia,\n          fBanco.conta,\n          b.arquivoBoleto\n        from financeiroTitulo fTitulo\n        left join financeiroBoleto fBoleto on fBoleto.codigoFinanceiroBoleto = fTitulo.codigoFinanceiroBoleto\n        left join financeiroBanco fBanco on fBanco.CodigoFinanceiroBanco = fBoleto.codigoFinanceiroBanco\n        left join _banco b on b.codigoBanco = fBanco.codigoBanco\n        where fTitulo.id in (${t})`,this.cancelarAtualizarBoletos=!1;let i=0;for(;;){try{o=await(0,G.executarSql)(e),i=0}catch(e){o=[],++i%3==0&&this.$q.notifyError(e.message)}for(const e of o){const o=a.find((o=>o.idFinanceiroTitulo===e.id));o&&(e.codigoFinanceiroBoleto&&(o.codigoFinanceiroBoleto=e.codigoFinanceiroBoleto,o.banco={descricao:e.descricao,dataEmissao:e.dataEmissao,agencia:e.agencia,conta:e.conta,arquivoBoleto:e.arquivoBoleto}),e.codigoFinanceiroTitulo&&(o.codigoFinanceiroTitulo=e.codigoFinanceiroTitulo,o.disable=!1))}if(o.length===a.length||this.cancelarAtualizarBoletos)break;await(0,G.dormir)(5e3)}},async atualizarModalBoleto(){this.modalBoleto={ativo:!1,visivel:!1,loading:!1,codigoFinanceiroBanco:"",condicoesPagamento:[],bancos:[]};const e=[],o=await(0,X.X)().formaPagamento.toArray(),t=await(0,X.X)().empresa.where({idContato:this.dados.fatura.idEmpresa}).toArray();if(await(0,X.X)().documentoCondicaoPagamento.where({idDocumento:this.dados.fatura.id}).each((t=>{const a=o.find((e=>e.id===t.idFormaPagamento&&99===e.tipo&&"Título em aberto"===e.tipoFinanceiro));a&&e.push({dataVencimento:t.dataVencimento,descricao:a.descricao,idFinanceiroTitulo:t.idFinanceiroTitulo,codigoFinanceiroBoleto:"",checked:!1,disable:!0,valor:t.valor})})),!e.length)return;const a=[];await(0,X.X)().financeiroBanco.each((e=>{e.ativo&&("7D07229E-B35E-42AA-A312-78313BE61B2F"!==e.id?e.idEmpresa&&t.find((o=>o.id===e.idEmpresa))&&a.push(e):a.push(e))}));const i=[...new Set(a.map((e=>e.codigoBanco)))],r=[];await(0,X.X)()._banco.each((e=>{i.find((o=>o===e.codigoBanco))&&r.push(e)})),this.modalBoleto.condicoesPagamento=(0,Y.orderBy)(e,"dataVencimento","asc");const l=[];for(const e of a){const o=r.find((o=>o.codigoBanco===e.codigoBanco))||{};if(!o)continue;const t=(o.descricao||"").trim(),a=(e.agencia||"").trim(),i=(e.conta||"").trim();if(!(o.arquivoBoleto&&t&&a&&i))continue;let n=t+" - Ag. "+a+" C/C "+i;l.push({arquivoBoleto:o.arquivoBoleto,label:n,value:e.codigoFinanceiroBanco})}l.length&&(this.modalBoleto.financeiroBanco=l[0],this.modalBoleto.bancos=l)},fecharModalBoleto(){this.cancelarAtualizarBoletos=!0,this.cancelarEmitirBoletos=!0,this.modalBoleto.visivel=!1,this.$nextTick().then((()=>{this.modalBoleto.avito=!1}))},async emitirImprimirBoleto(){this.modalBoleto.loading=!0;let e,o,t,a={},i=[];t=this.modalBoleto.condicoesPagamento.filter((e=>e.checked));for(const e of t)if(e.codigoFinanceiroBoleto&&(e.banco||{}).arquivoBoleto){if(!a[e.banco.arquivoBoleto]){a[e.banco.arquivoBoleto]=[e.codigoFinanceiroBoleto];continue}a[e.banco.arquivoBoleto].push(e.codigoFinanceiroBoleto)}else i.push(e.codigoFinanceiroTitulo);if(i.length&&this.modalBoleto.financeiroBanco?.value){this.cancelarEmitirBoletos=!1;let t,r,l,n,d=0,s=0;if(n=(this.modalBoleto.bancos.find((e=>e.value===this.modalBoleto.financeiroBanco.value))||{}).arquivoBoleto,!n)return void this.$q.notifyError("Arquivo boleto não encontrado");for(e=`sp_financeiro_boletoEmitir ${this.modalBoleto.financeiroBanco.value}, '${i.join(",")}'`;!this.cancelarEmitirBoletos;){try{o=await(0,G.executarSql)(e),d=0}catch(e){o=[],++d%3==0&&this.$q.notifyError(e.message)}if(t=(o||[])[0],r=((t||{}).Msg||"").trim(),l=((t||{}).Retorno||"").trim(),"Boleto Gerado com sucesso!"===r&&l){const e=l.substring(0,l.length-1).split(",");if(!a[n]){a[n]=e;break}for(const o of e)a[n].push(o);break}++s%3==0&&this.$q.notifyError(r),await(0,G.dormir)(5e3)}}let r=JSON.parse(localStorage.getItem("clienteSistema"))||{};for(const e in a){let o;o="https://rel.storage.b15.com.br/Relatorios/"+e+".html?",o+="CodigoFinanceiroBoleto="+a[e].join(","),o+="&Banco="+r.bancoDeDados,o+="&URLServidor="+r.urlServidor,window.open(o)}await this.atualizarBoletos(),this.modalBoleto.loading=!1},alternarDetalhes(){this.detalhesVisivel=!this.detalhesVisivel},async atualizar(){const e=await $db.fatura.leCompleto(this.id);e.vendas.sort(((e,o)=>new Date(e.dataHoraFinalizado)<new Date(o.dataHoraFinalizado)?-1:1)),e.carnes.sort(((e,o)=>new Date(e.dataVencimento)<new Date(o.dataVencimento)?-1:1));const o=await e.vendas.reduce((async(e,o)=>(e[o.idContatoVendedor]||(e[o.idContatoVendedor]=await $db.contato.le({id:o.idContatoVendedor})),e)),{});if(e.fatura.idContato){const t=e.fatura.idContato;o[t]||(o[t]=await $db.contato.le({id:t}))}this.configuraImpressaoCarne(e.fatura.idEmpresa),this.configuraImpressaoConvenio(e.fatura.idEmpresa),this.configuraImpressaoEnvelope(e.fatura.idEmpresa),this.configuraImpressaoFatura(e.fatura.idEmpresa),this.contatos=o,this.dados=e,this.atualizarModalBoleto(),this.condicaoPagamento=e.condicaoPagamento,this.resumeCondicaoPagamento();const t=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;this.podeEditar=!1,t.find((o=>o.id===e.fatura.idEmpresa))&&(this.podeEditar=!0),this.$nextTick((()=>{e.fatura.id===localStorage.getItem("idFatura")&&(this.podeEditar&&this.$refs.faturaModal.mostrar({id:this.dados.fatura.id}),localStorage.removeItem("idFatura"))}))},copiarUid(){const e=this.$refs.uid;e.type="text";try{e.select(),document.execCommand("copy"),this.$q.notify({message:"UID copiado para a área de transferência.",type:"info"})}catch(e){this.$q.notify("Erro ao copiar.")}e.type="hidden",window.getSelection().removeAllRanges()},async configuraImpressaoConvenio(e){const o=await $db.configuracoes.porNome("impressao.convenio",e);this.configImpressaoConvenio=[...o.length?o.map((e=>({texto:"Imprimir Convênio",...e}))):[{valor:"convenio",texto:"Imprimir Convênio"}]]},async configuraImpressaoCarne(e){const o=await $db.configuracoes.porNome("impressao.carne",e);this.configImpressaoCarne=[...o.length?o.map((e=>({texto:"Imprimir Carnê",...e}))):[{valor:"carne-crediario",texto:"Reimprimir carnê e notas promissórias da fatura"}]]},async configuraImpressaoEnvelope(e){const o=await $db.configuracoes.porNome("impressao.envelope",e);this.configImpressaoEnvelope=[...o.length?o.map((e=>({texto:"Imprimir Envelope",...e}))):[{valor:"envelope",texto:"Imprimir Envelope"},{valor:"envelopeMini",texto:"Imprimir Envelope Mini"}]]},async configuraImpressaoFatura(e){const o=await $db.configuracoes.porNome("impressao.fatura",e);this.configImpressaoFatura=[...o.length?o.map((e=>({texto:"Imprimir Fatura",...e}))):[{valor:"invoice",texto:"Fatura (Invoice)"},{valor:"fatura-recibo",texto:"Recibo"}]]},editar(){this.$refs.faturaModal.mostrar({id:this.dados.fatura.id})},async executar(e){switch(e){case"atualizar":case"finalizar":case"retornarOrcamento":case"remover":return void this.$emit("executar","atualizar")}await this.atualizar()},async sendReview(e){try{this.$q.loading.show();const o=[],t=this.contatos[e.idContato],a=await $api.bten.send(t,e);for(let e=0;e<a.length;e++){const t=a[e];t.status?o.push(t.telefone):this.$q.notifyError(`Falha ao enviar NPS para ${t.telefone}!`)}this.$q.loading.hide(),o.length&&this.$q.notifyPositive(`NPS enviado para ${o.join(",")}!`)}catch(e){if("GeeksException"===e.name)return void this.$q.notifyAlert(e.message);this.$q.notifyError("Não foi possivel enviar NPS para o contato.",e)}finally{this.$q.loading.hide()}}},mixins:[H.Z,j.Z],props:{id:{required:!0,type:String}},async mounted(){let e,o,t;e=await $db.configuracoes.porNome("integracao.bten.business"),o=e[0]?.valor??!1,e=await $db.configuracoes.porNome("integracao.bten.authorization"),t=e[0]?.valor??!1,this.mostrarBotaoEnviarAvaliacao=o&&t,this.sistemaPai=(0,G.sistemaPai)(),this.atualizar()}};var K=t(74260),ee=t(77953),oe=t(60880),te=t(31106),ae=t(76106),ie=t(4957),re=t(37617),le=t(54707),ne=t(25901),de=t(68900),se=t(83831),ce=t(39341),ue=t(83054),me=t(47266),pe=t(48761),fe=t(782),he=t(47803),ge=t(835),ve=t(46924),Ve=t(40320),Ce=t(52788),Ne=t(41837),we=t(98586),be=t(7518),xe=t.n(be);const Be=(0,K.Z)(W,[["render",function(e,o,t,i,r,l){const n=(0,a.resolveComponent)("badge"),d=(0,a.resolveComponent)("q-item-section"),U=(0,a.resolveComponent)("avatar"),Q=(0,a.resolveComponent)("q-item-label"),j=(0,a.resolveComponent)("q-badge"),L=(0,a.resolveComponent)("row"),H=(0,a.resolveComponent)("q-tooltip"),J=(0,a.resolveComponent)("q-btn"),X=(0,a.resolveComponent)("q-icon"),Y=(0,a.resolveComponent)("q-item"),G=(0,a.resolveComponent)("q-list"),W=(0,a.resolveComponent)("q-menu"),K=(0,a.resolveComponent)("documentos-fiscais"),ee=(0,a.resolveComponent)("q-separator"),oe=(0,a.resolveComponent)("fatura-modal"),te=(0,a.resolveComponent)("q-toolbar-title"),ae=(0,a.resolveComponent)("q-toolbar"),ie=(0,a.resolveComponent)("q-spinner-hourglass"),re=(0,a.resolveComponent)("q-spinner-dots"),le=(0,a.resolveComponent)("q-checkbox"),ne=(0,a.resolveComponent)("q-select"),de=(0,a.resolveComponent)("q-spinner"),se=(0,a.resolveComponent)("q-inner-loading"),ce=(0,a.resolveComponent)("q-card-section"),ue=(0,a.resolveComponent)("q-card"),me=(0,a.resolveComponent)("q-dialog"),pe=(0,a.resolveComponent)("modal-historico-status"),fe=(0,a.resolveDirective)("close-popup");return(0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,null,[r.dados.fatura.id?((0,a.openBlock)(),(0,a.createBlock)(Y,{key:0,id:"FaturaCard","manual-focus":"",clickable:"",class:"items-center d-flex q-pa-xs"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(d,{avatar:"",center:"",class:"mw100 hideonmobile",onClick:l.editar},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(n,{class:"q-mr-sm",escuro:"",cor:"positive",onClick:l.copiarUid},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)(" #"+(0,a.toDisplayString)(parseInt(r.dados.fatura.numero)||(r.dados.fatura.id||"").slice(-6))+" ",1),(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"hidden","onUpdate:modelValue":o[0]||(o[0]=e=>r.dados.fatura.id=e),ref:"uid"},null,512),[[a.vModelText,r.dados.fatura.id]])])),_:1},8,["onClick"])])),_:1},8,["onClick"]),(0,a.createVNode)(d,{onClick:l.editar},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(L,{class:"items-center"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",s,[(0,a.createVNode)(U,{imagem:(r.contatos[r.dados.fatura.idContato]||{}).imagem,rotulo:r.dados.fatura.descricaoContato,tamanho:"40",style:{float:"left"}},null,8,["imagem","rotulo"])]),(0,a.createElementVNode)("div",c,[(0,a.createVNode)(Q,{class:"text-tertiary text-weight-bold"},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)((r.contatos[r.dados.fatura.idContato]||{}).apelido),1)])),_:1}),(0,a.createVNode)(L,{class:"hideondesktop items-center q-my-sm"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",u,[(0,a.createVNode)(n,{class:"q-mr-sm",escuro:"",cor:"positive",onClick:l.copiarUid},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)(" #"+(0,a.toDisplayString)(parseInt(r.dados.fatura.numero)||(r.dados.fatura.id||"").slice(-6))+" ",1),(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"hidden","onUpdate:modelValue":o[1]||(o[1]=e=>r.dados.fatura.id=e),ref:"uid"},null,512),[[a.vModelText,r.dados.fatura.id]])])),_:1},8,["onClick"])]),(0,a.createElementVNode)("div",m,[(0,a.createVNode)(j,{color:"tertiary"},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(r.dados.fatura.status),1)])),_:1})])])),_:1}),(0,a.createVNode)(L,{class:"hideondesktop items-center q-my-sm"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",p,[r.dados.fatura.dataHoraFinalizado?((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:0},[(0,a.createTextVNode)((0,a.toDisplayString)(e.$filters.data(r.dados.fatura.dataHoraFinalizado))+" ",1),(0,a.createVNode)(H,null,{default:(0,a.withCtx)((()=>[f])),_:1})],64)):((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:1},[(0,a.createTextVNode)((0,a.toDisplayString)(e.$filters.data(r.dados.fatura.dataHoraEmissao))+" ",1),(0,a.createVNode)(H,null,{default:(0,a.withCtx)((()=>[h])),_:1})],64))]),(0,a.createElementVNode)("div",g,[(0,a.createTextVNode)((0,a.toDisplayString)((r.contatos[r.dados.fatura.idContatoVendedor]||{}).apelido)+" ",1),(0,a.createVNode)(H,null,{default:(0,a.withCtx)((()=>[v])),_:1})])])),_:1})])])),_:1})])),_:1},8,["onClick"]),(0,a.createVNode)(d,{onClick:l.editar,class:"hideonmobile"},{default:(0,a.withCtx)((()=>[r.dados.fatura.dataHoraFinalizado?((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:0},[(0,a.createTextVNode)((0,a.toDisplayString)(e.$filters.data(r.dados.fatura.dataHoraFinalizado))+" ",1),(0,a.createVNode)(H,null,{default:(0,a.withCtx)((()=>[V])),_:1})],64)):((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:1},[(0,a.createTextVNode)((0,a.toDisplayString)(e.$filters.data(r.dados.fatura.dataHoraEmissao))+" ",1),(0,a.createVNode)(H,null,{default:(0,a.withCtx)((()=>[C])),_:1})],64))])),_:1},8,["onClick"]),(0,a.createVNode)(d,{avatar:"",class:"mw240 hideonmobile"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(j,{color:"tertiary"},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(r.dados.fatura.status),1)])),_:1}),r.dados.fatura.rotaStatus?((0,a.openBlock)(),(0,a.createBlock)(j,{key:0,color:"secondary",style:{"margin-top":"5px"}},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("span",null,(0,a.toDisplayString)(r.dados.fatura.rotaStatus),1)])),_:1})):(0,a.createCommentVNode)("",!0)])),_:1}),(0,a.createVNode)(d,{onClick:l.editar,class:"hideonmobile text-right"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("b",null,[(0,a.createTextVNode)((0,a.toDisplayString)(e.$filters.numero(r.dados.fatura.totalDocumento,2))+" ",1),(0,a.createVNode)(H,null,{default:(0,a.withCtx)((()=>[N])),_:1})]),(0,a.createElementVNode)("span",null,[(0,a.createTextVNode)((0,a.toDisplayString)(e.$filters.numero(r.dados.fatura.subTotal,2))+" ",1),(0,a.createVNode)(H,null,{default:(0,a.withCtx)((()=>[w])),_:1})])])),_:1},8,["onClick"]),(0,a.createVNode)(d,{side:"",top:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(L,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(J,{rounded:"",dense:"",flat:"",icon:r.detalhesVisivel?"keyboard_arrow_up":"keyboard_arrow_down",size:"md",class:"no-shadow q-ma-xs",color:"tertiary",style:{float:"right"},onClick:l.alternarDetalhes},null,8,["icon","onClick"]),r.podeEditar?((0,a.openBlock)(),(0,a.createBlock)(J,{key:0,rounded:"",dense:"",flat:"",icon:"edit",color:"primary",class:"no-shadow q-ma-xs",size:"md",onClick:l.editar,style:{float:"right"}},null,8,["onClick"])):(0,a.createCommentVNode)("",!0),(0,a.createVNode)(J,{rounded:"",dense:"",flat:"",icon:"print",color:"tertiary",class:"no-shadow q-ma-xs",size:"md",style:{float:"right"}},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(W,null,{default:(0,a.withCtx)((()=>[(0,a.withDirectives)(((0,a.openBlock)(),(0,a.createBlock)(G,{link:"",separator:""},{default:(0,a.withCtx)((()=>[l.mostrarOpcaoEmitirBoleto?((0,a.openBlock)(),(0,a.createBlock)(Y,{key:0,clickable:"",onClick:o[2]||(o[2]=e=>l.abrirModalBoleto())},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(d,{avatar:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(X,{name:"mdi-printer"})])),_:1}),(0,a.createVNode)(d,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Q,null,{default:(0,a.withCtx)((()=>[b])),_:1})])),_:1})])),_:1})):(0,a.createCommentVNode)("",!0),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(r.configImpressaoFatura,(o=>((0,a.openBlock)(),(0,a.createBlock)(Y,{clickable:"",key:o.valor,onClick:t=>e.$imprimir(o.valor,(r.dados.fatura||{}).id||"0")},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(d,{avatar:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(X,{name:"print"})])),_:1}),(0,a.createVNode)(d,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Q,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(o.texto),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128)),"optisoul"===r.sistemaPai?((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,{key:1},(0,a.renderList)(r.configImpressaoEnvelope,(o=>((0,a.openBlock)(),(0,a.createBlock)(Y,{clickable:"",key:o.valor,onClick:t=>e.$imprimir(o.valor,(r.dados.fatura||{}).id||"0")},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(d,{avatar:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(X,{name:"print"})])),_:1}),(0,a.createVNode)(d,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Q,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(o.texto),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128)):(0,a.createCommentVNode)("",!0),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(r.configImpressaoCarne,(o=>((0,a.openBlock)(),(0,a.createBlock)(Y,{clickable:"",key:o.valor,onClick:t=>e.$imprimir(o.valor,(r.dados.fatura||{}).id||"0")},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(d,{avatar:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(X,{name:"print"})])),_:1}),(0,a.createVNode)(d,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Q,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(o.texto),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128)),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(r.configImpressaoConvenio,(o=>((0,a.openBlock)(),(0,a.createBlock)(Y,{clickable:"",key:o.valor,onClick:t=>e.$imprimir(o.valor,(r.dados.fatura||{}).id||"0")},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(d,{avatar:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(X,{name:"print"})])),_:1}),(0,a.createVNode)(d,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Q,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(o.texto),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})),[[fe]])])),_:1})])),_:1}),(0,a.createVNode)(J,{rounded:"",dense:"",flat:"",icon:"more_vert",color:"tertiary",class:"no-shadow q-ma-xs",size:"md",style:{float:"right"}},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(W,null,{default:(0,a.withCtx)((()=>[(0,a.withDirectives)(((0,a.openBlock)(),(0,a.createBlock)(G,{link:"",separator:""},{default:(0,a.withCtx)((()=>[r.dados.fatura.id?((0,a.openBlock)(),(0,a.createBlock)(Y,{key:0,clickable:"",onClick:o[3]||(o[3]=o=>e.$refs.documentosFiscais.emitirCupom(r.dados.fatura.id))},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(d,{avatar:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(X,{name:"account_balance"})])),_:1}),(0,a.createVNode)(d,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Q,null,{default:(0,a.withCtx)((()=>[x])),_:1})])),_:1})])),_:1})):(0,a.createCommentVNode)("",!0),e.$utils.mapearStatus(r.dados.fatura).permiteNota?((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:1},[(0,a.createVNode)(Y,{clickable:"",onClick:o[4]||(o[4]=o=>e.emitirNFeV2({idFatura:r.dados.fatura.id},1,"Venda"))},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(d,{avatar:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(X,{name:"account_balance"})])),_:1}),(0,a.createVNode)(d,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Q,null,{default:(0,a.withCtx)((()=>[B])),_:1})])),_:1})])),_:1}),(0,a.createVNode)(Y,{clickable:"",onClick:o[5]||(o[5]=o=>e.emitirNFeV2({idFatura:r.dados.fatura.id},0,"Devolução"))},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(d,{avatar:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(X,{name:"account_balance"})])),_:1}),(0,a.createVNode)(d,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Q,null,{default:(0,a.withCtx)((()=>[k])),_:1})])),_:1})])),_:1}),(0,a.createVNode)(Y,{clickable:"",onClick:o[6]||(o[6]=o=>e.emitirNFeV2({idFatura:r.dados.fatura.id},1,"Remessa"))},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(d,{avatar:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(X,{name:"account_balance"})])),_:1}),(0,a.createVNode)(d,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Q,null,{default:(0,a.withCtx)((()=>[y])),_:1})])),_:1})])),_:1})],64)):(0,a.createCommentVNode)("",!0),l.mostrarOpcaoRemoverFatura?((0,a.openBlock)(),(0,a.createBlock)(Y,{key:2,clickable:"",onClick:o[7]||(o[7]=e=>l.removerFatura())},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(d,{avatar:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(X,{name:"mdi-trash-can"})])),_:1}),(0,a.createVNode)(d,null,{default:(0,a.withCtx)((()=>[E])),_:1})])),_:1})):(0,a.createCommentVNode)("",!0),(0,a.createVNode)(Y,{clickable:"",onClick:o[8]||(o[8]=o=>e.$refs.modalHistoricoStatus.mostrar({idDocumento:r.dados.fatura.id}))},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(d,{avatar:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(X,{name:"history"})])),_:1}),(0,a.createVNode)(d,null,{default:(0,a.withCtx)((()=>[_])),_:1})])),_:1}),r.mostrarBotaoEnviarAvaliacao&&"Finalizada"===r.dados.fatura.status?((0,a.openBlock)(),(0,a.createBlock)(Y,{key:3,clickable:"",onClick:o[9]||(o[9]=e=>l.sendReview(r.dados.fatura))},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(d,{avatar:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(X,{name:"mdi-file-replace-outline"})])),_:1}),(0,a.createVNode)(d,null,{default:(0,a.withCtx)((()=>[$])),_:1})])),_:1})):(0,a.createCommentVNode)("",!0)])),_:1})),[[fe]])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):(0,a.createCommentVNode)("",!0),(0,a.withDirectives)((0,a.createVNode)(L,{class:"items-start q-mx-none q-px-none q-mt-md"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",S,[(0,a.createElementVNode)("p",D,[(0,a.createVNode)(X,{name:"business"}),(0,a.createTextVNode)(" "+(0,a.toDisplayString)(r.dados.fatura.descricaoEmpresa),1)]),(0,a.createVNode)(K,{ref:"documentosFiscais",idFatura:r.dados.fatura.id},null,8,["idFatura"])]),(0,a.createElementVNode)("div",F,[T,(0,a.createElementVNode)("p",q,(0,a.toDisplayString)(r.dados.fatura.observacaoFaturamento),1),(0,a.createVNode)(G,{class:"no-border"},{default:(0,a.withCtx)((()=>[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.condicaoPagamentoResumo,(o=>((0,a.openBlock)(),(0,a.createBlock)(Y,{key:o.id,class:"q-pa-none row",style:{"min-height":"auto"}},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(d,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Q,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(o.formaPagamento),1)])),_:2},1024)])),_:2},1024),(0,a.createVNode)(d,{class:"text-right"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Q,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(e.$filters.numero(o.valor,2))+(0,a.toDisplayString)(o.parcelas>1?` (em ${o.parcelas}x)`:""),1)])),_:2},1024)])),_:2},1024),(0,a.createVNode)(d,{right:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Q,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(e.$filters.data(o.dataVencimento)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})]),(0,a.createElementVNode)("div",I,[z,(0,a.createElementVNode)("p",A,(0,a.toDisplayString)(e.$filters.numero(r.dados.fatura.totalDesconto,2)),1)])])),_:1},512),[[a.vShow,r.detalhesVisivel]]),(0,a.createVNode)(ee),(0,a.createVNode)(oe,{ref:"faturaModal",onExecutar:l.executar},null,8,["onExecutar"]),r.modalBoleto.ativo?((0,a.openBlock)(),(0,a.createBlock)(me,{key:1,modelValue:r.modalBoleto.visivel,"onUpdate:modelValue":o[12]||(o[12]=e=>r.modalBoleto.visivel=e),onHide:l.fecharModalBoleto,minimized:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(ue,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(ae,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(te,null,{default:(0,a.withCtx)((()=>[P])),_:1}),(0,a.withDirectives)((0,a.createVNode)(J,{flat:"",round:"",dense:"",icon:"close"},null,512),[[fe]])])),_:1}),(0,a.createVNode)(ce,null,{default:(0,a.withCtx)((()=>[r.modalBoleto.condicoesPagamento.filter((e=>e.disable)).length?((0,a.openBlock)(),(0,a.createBlock)(G,{key:0,dense:"",highlight:"",class:"q-mb-sm"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Q,{header:""},{default:(0,a.withCtx)((()=>[R,(0,a.createVNode)(ie)])),_:1}),(0,a.createVNode)(ee),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(r.modalBoleto.condicoesPagamento.filter((e=>e.disable)),((o,t)=>((0,a.openBlock)(),(0,a.createBlock)(Y,{key:t,tag:"label"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(d,null,{default:(0,a.withCtx)((()=>[o.disable?((0,a.openBlock)(),(0,a.createBlock)(re,{key:0})):(0,a.createCommentVNode)("",!0)])),_:2},1024),(0,a.createVNode)(Q,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Q,{header:""},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(o.descricao)+" - "+(0,a.toDisplayString)(e.$filters.numero(o.valor,2))+" - Venc. "+(0,a.toDisplayString)(e.$filters.data(o.dataVencimento)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):(0,a.createCommentVNode)("",!0),(0,a.createElementVNode)("form",{class:"q-pa-sm",onSubmit:o[11]||(o[11]=(0,a.withModifiers)((e=>l.emitirImprimirBoleto()),["prevent"]))},[r.modalBoleto.condicoesPagamento.filter((e=>!e.disable&&e.codigoFinanceiroBoleto)).length?((0,a.openBlock)(),(0,a.createBlock)(G,{key:0,dense:"",highlight:"",class:"q-mb-sm"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Q,{header:""},{default:(0,a.withCtx)((()=>[O])),_:1}),(0,a.createVNode)(ee),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(r.modalBoleto.condicoesPagamento.filter((e=>!e.disable&&e.codigoFinanceiroBoleto)),((o,t)=>((0,a.openBlock)(),(0,a.createBlock)(Y,{key:t,tag:"label"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(d,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(le,{modelValue:o.checked,"onUpdate:modelValue":e=>o.checked=e},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024),(0,a.createVNode)(Q,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Q,{header:""},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(o.descricao)+" - "+(0,a.toDisplayString)(e.$filters.numero(o.valor,2))+" - Venc. "+(0,a.toDisplayString)(e.$filters.data(o.dataVencimento)),1)])),_:2},1024),(0,a.createVNode)(Q,{caption:""},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(o.banco.descricao)+" - Ag. "+(0,a.toDisplayString)(o.banco.agencia)+" C/C "+(0,a.toDisplayString)(o.banco.conta)+" - Emitido em "+(0,a.toDisplayString)(e.$filters.dataHora(o.banco.dataEmissao)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):(0,a.createCommentVNode)("",!0),r.modalBoleto.condicoesPagamento.filter((e=>!e.disable&&!e.codigoFinanceiroBoleto)).length?((0,a.openBlock)(),(0,a.createBlock)(G,{key:1,dense:"",highlight:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Q,{header:""},{default:(0,a.withCtx)((()=>[M])),_:1}),(0,a.createVNode)(ee),(0,a.createVNode)(Y,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Q,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(ne,{modelValue:r.modalBoleto.financeiroBanco,"onUpdate:modelValue":o[10]||(o[10]=e=>r.modalBoleto.financeiroBanco=e),options:r.modalBoleto.bancos},null,8,["modelValue","options"])])),_:1})])),_:1}),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(r.modalBoleto.condicoesPagamento.filter((e=>!e.disable&&!e.codigoFinanceiroBoleto)),((o,t)=>((0,a.openBlock)(),(0,a.createBlock)(Y,{key:t,tag:"label"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(d,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(le,{modelValue:o.checked,"onUpdate:modelValue":e=>o.checked=e},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024),(0,a.createVNode)(Q,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Q,{header:""},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(o.descricao)+" - "+(0,a.toDisplayString)(e.$filters.numero(o.valor,2))+" - Venc. "+(0,a.toDisplayString)(e.$filters.data(o.dataVencimento)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):(0,a.createCommentVNode)("",!0),(0,a.createElementVNode)("div",Z,[(0,a.withDirectives)((0,a.createVNode)(J,{color:"tertiary",flat:"",label:"Cancelar"},null,512),[[fe]]),(0,a.createVNode)(J,{color:"primary",class:"q-ml-sm",label:"Imprimir",type:"submit",unelevated:"",disable:!l.ativarBotaoEmissaoBoleto},null,8,["disable"])])],32),(0,a.createVNode)(se,{showing:r.modalBoleto.loading},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(de,{size:"50px",color:"primary"})])),_:1},8,["showing"])])),_:1})])),_:1})])),_:1},8,["modelValue","onHide"])):(0,a.createCommentVNode)("",!0),(0,a.createVNode)(pe,{ref:"modalHistoricoStatus"},null,512)],64)}]]);xe()(W,"components",{QItem:ee.Z,QItemSection:oe.Z,QItemLabel:te.Z,QBadge:ae.Z,QTooltip:ie.Z,QBtn:re.Z,QMenu:le.Z,QList:ne.Z,QIcon:de.Z,QSeparator:se.Z,QDialog:ce.Z,QCard:ue.Z,QToolbar:me.Z,QToolbarTitle:pe.Z,QCardSection:fe.Z,QSpinnerHourglass:he.Z,QSpinnerDots:ge.Z,QCheckbox:ve.Z,QSelect:Ve.Z,QInnerLoading:Ce.Z,QSpinner:Ne.Z}),xe()(W,"directives",{ClosePopup:we.Z});var ke=t(30052),ye=t.n(ke),Ee=t(54726),_e=t(84830),$e=t.n(_e);const Se={alterados:0,arquivo:null,cor:"text-negative",corFinal:"",erro:"",erros:0,incluidos:0,listaErros:[],mensagem:"",mensagemFinal:"",modalResultado:!1},De={components:{lista:d.Z,FaturaCardLista:Be,FaturaModal:L.Z},data:()=>(new Date(new Date($utils.dataAtual()).toDateString()),{tokenRoutEasy:null,tabSelecionada:{valor:"Aberta"},importar:$utils.clonarV2(Se),opcoesStatusEnvio:[{rotulo:"Todos"},{rotulo:"Enviados"},{rotulo:"Não Enviados"}],page:{Aberta:{current:1,min:0,max:0},Finalizada:{current:1,min:0,max:0},ativa:"Aberta"},entregueInicio:new Date(new Date($utils.dataAtual()).toDateString()),entregueFim:new Date(new Date($utils.dataAtual()).toDateString()),status:[],operacoes:[],pageSize:10,grupos:[],buscaCampo:"",empresas:[],empresa:{},empresaOpcoes:[],contatosModal:!1,vendedorModal:!1,digitadorModal:!1,buscaCliente:"",filtro:{opcaoDataSelected:"Data Emissão",statusEnvio:"Todos",valorTotal:0,status:"Aberta",operacao:"",grupos:[],empresa:{id:null},cliente:{id:"",nome:""},vendedor:{id:""},digitador:{id:""},periodo:{emissao:{ini:"",fim:""},finalizado:{ini:"",fim:""}}},paginacao:{atual:1,maximo:1,total:1,limite:25},dbContato:$db.contato,documentos:[],showFilters:!1,vendedorDigitadorSelecionado:null,vendedoresDigitadoresOpcoes:[],diretivaContatosAcessaTodosContatos:!1,showAllPreviewDetail:!1,lista:[],usuario:JSON.parse(localStorage.getItem("usuario")),prazoSelecionado:null,prazoOpcoes:[{label:"Em dia",value:"bordaVerdeCRM"},{label:"Entrega para esta semana",value:"bordaAmarelaCRM"},{label:"Entrega atrasada",value:"bordaVermelhaCRM"}],opcoesData:[{label:"Data Emissão"},{label:"Data Finalização"}]}),methods:{async atualizar(){try{$q.loading.show(),null!==this.vendedorDigitadorSelecionado&&(this.filtro.vendedor.id=this.vendedorDigitadorSelecionado.value);let e="";"Todas"!==this.tabSelecionada.valor&&(e=this.tabSelecionada.valor);let o=this.filtro.vendedor.id;this.diretivaContatosAcessaTodosContatos||(o=this.usuario.codigoContato,this.filtro.vendedor.id=o);let t={status:e,valorTotal:this.filtro.valorTotal,cliente:this.filtro.cliente.nome,operacao:this.filtro.operacao,idEmpresa:this.empresaSelecionada?.id??"",idContato:this.filtro.cliente.id,idContatoVendedor:o,idContatoDigitador:this.filtro.digitador.id,statusEnvio:this.filtro.statusEnvio,termoBusca:this.buscaCampo};"Data Emissão"===this.filtro.opcaoDataSelected&&(t.periodoEmissao={ini:this.filtro.periodo.emissao.ini,fim:this.filtro.periodo.emissao.fim}),"Data Finalização"===this.filtro.opcaoDataSelected&&(t.periodoFinalizado={ini:this.filtro.periodo.finalizado.ini,fim:this.filtro.periodo.finalizado.fim});let a=[];const i=await $db.fatura.leRefatorado({filtros:t,termoBusca:this.buscaCampo,limit:this.paginacao.limite,page:this.paginacao.atual,sort:["dataFinalizacao","dataHoraEmissao"],dir:["desc","desc"]});a=i.data,this.documentos=a,this.paginacao.total=i.total,this.paginacao.maximo=i.totalPages}catch(e){console.log(e),this.$q.notifyError("Erro ao filtrar")}finally{$q.loading.hide()}},limparFiltros_click(){this.empresaSelecionada="",this.filtro={opcaoDataSelected:"Data Emissão",statusEnvio:"Todos",valorTotal:0,status:"Aberta",operacao:"",grupos:[],empresa:{id:null},cliente:{id:"",nome:""},vendedor:{id:""},digitador:{id:""},periodo:{emissao:{ini:"",fim:""},finalizado:{ini:"",fim:""}}},this.atualizar()},async resetarEnvio(e){$q.dialog({message:"Deseja resetar o envio desta fatura?",title:"Atenção!",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Resetar",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk((async()=>{const o=e.id;e.rotaJson="",e.rotaStatus="",e.rotaNome="";const t=(await $erp().documento.where({id:o}).toArray())[0],a=$utils.clonarV2(t);a.rotaJson="",a.rotaStatus="",a.rotaNome="",await $db.documento.grava({atual:a,original:t})}))},async sendRouteEasyAll(){$q.loading.show();try{let e="";"Todas"!==this.tabSelecionada.valor&&(e=this.tabSelecionada.valor),this.tabSelecionada.values&&this.tabSelecionada.values.length&&(e=this.tabSelecionada.values);let o=await $db.venda.leRefatorado({filtros:{faturado:{ini:this.filtro.periodo.faturado.ini,fim:this.filtro.periodo.faturado.fim},periodoEmissao:{ini:this.filtro.periodo.emissao.ini,fim:this.filtro.periodo.emissao.fim},periodoFinalizado:{ini:this.filtro.periodo.finalizado.ini,fim:this.filtro.periodo.finalizado.fim},status:e,valorTotal:this.filtro.valorTotal,cliente:this.filtro.cliente.nome,operacao:this.filtro.operacao,idEmpresa:this.empresaSelecionada?.id??null,idContato:this.filtro.cliente.id,idContatoVendedor:this.filtro.vendedor.id,idContatoDigitador:this.filtro.digitador.id},termoBusca:this.buscaCampo,limit:this.paginacao.total,page:this.paginacao.atual,sort:["dataHoraEmissao","dataFinalizacao"],dir:["desc","desc"]});await this.sendRouteEasy(o),$q.notify({message:"Sincronismo efetuado com sucesso!",type:"positive"})}catch(e){console.log(e)}finally{$q.loading.hide()}},async sendRouteEasy(e){$q.loading.show();let o=e.data,t={deliveries:[]};try{for(let e=0;e<o.length;e++){const a=o[e],i=await $db.contatoEndereco.le({idContato:a.idContato});if(0===i.length){let e=`Não foi possivel envia fatura #ID[${a.id}], pois não foi vinculado um endereço.`;$q.notify(e),console.log(e)}if(a&&a.idContato&&i.length>0){let e=await $db.contato.le({id:a.idContato}),o=await $db.contatoTelefone.le({idContato:e.id}),r=await $db.documentoFiscalEletronico.le({idDocumento:a.idFatura});$utils.dataAtual();const l=i[0],n=await this.calcularPesoECubicoTotal(a.id);let d=n.pesoTotal||0,s=n.metroCubicoTotal||0,c=r.length>0?r[0].nNF:"",u=($filters.numero(a.totalDocumento,2),parseInt(a.totalDocumento)),m={code:a.idContato,name:a.descricaoContato,site:a.numeroDocumentoEmpresa,additional_info_2:a.numeroDocumentoEmpresa,order_number:a.numero+" "+a.numeroDocumentoEmpresa,invoice_number:c,loads:[d,s,u],email:e.email||"",customer_profile:e.id,phone:o.length>0?o[0].telefone:"",address:{route:l.logradouro,street_number:l.numero?l.numero:"",neighborhood:l.bairro,city:l.municipio,state:l.uf,postal_code:l.cep,country:l.pais}};t.deliveries.push(m)}}if(t.deliveries.length>0){const e=await ye()({method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},baseURL:"https://company.routeasy.com.br",url:"/group?api_key=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYxNDIwYWQ2YzRiNTYzMWEyMmQwYTZhZSIsInRpbWVzdGFtcCI6MTYzMjQ5NTY1ODE1OH0.Nodh7i5OjMak8PQaavO8yComhN6BJa7bPs37SKfe4rE",validateStatus:e=>e>=200&&e<=500,timeout:3e4,data:t});for(const t of e.data.deliveries){const e=o.find((e=>e.numeroDocumentoEmpresa===t.order_number.split(" ")[1]&&e.numero===parseInt(t.order_number.split(" ")[0])));if(!e){$q.notify(`Venda Nº ${t.order_number} / ${t.site} não encontrada!`);continue}const a=(await $erp().documento.where({id:e.id}).toArray())[0],i=$utils.clonarV2(a);i.rotaJson=JSON.stringify({envio:t}),i.rotaStatus="Enviado";let r=$utils.dataAtual().split("T")[0].split("-");i.rotaNome=`Rota do dia ${r[2]}/${r[1]}/${r[0]}`,await $db.documento.grava({atual:i,original:a}),this.$refs[i.id]&&this.$refs[i.id].atualizar()}}else $q.notify("Rota(s) já enviadas ou nao tem informações suficientes.")}catch(e){$q.notify(e.message),console.log("[ERROR][SINCRONSMO][ROUTEASY] => ",e)}finally{if(t.deliveries.length>0){let e=t.deliveries.length>1?"s":"";$q.notify({message:`(${t.deliveries.length}) Rota${e} enviada${e} com sucesso!`,type:"positive"})}$q.loading.hide()}},async executar(e){if(this.$refs.faturaModal.venda.status){for(const e of this.tabs)if(-1!==e.value.indexOf(this.$refs.faturaModal.venda.status)){this.tabSelecionada.valor=e.value;break}"Orçamento"===this.$refs.faturaModal.venda.status&&(this.filtro.opcaoDataSelected="Data Emissão")}await this.atualizar()},async calcularPesoECubicoTotal(e){if(!e)return!1;const o={};let t=0,a=0,i=0,r=0,l=0;const n=await $erp().documentoItem.where({idDocumento:e}).toArray();for(const e of n)if(-1===e.operacaoFator){if(e.idItem&&!o[e.idItem]){const t=await $erp().item.get(e.idItem);t&&(o[e.idItem]=t)}t+=(o[e.idItem].peso||0)*(e.quantidade||0),a+=(o[e.idItem].pesoBruto||0)*(e.quantidade||0),r=(o[e.idItem].altura||0)*(o[e.idItem].largura||0)*o[e.idItem].comprimento||0,l=e.quantidade||0,i+=r>0?r*l:0}return t=$utils.arredondar(t,4),a=$utils.arredondar(a,4),i=$utils.arredondar(i,4),{pesoTotal:t,pesoBrutoTotal:a,metroCubicoTotal:i}},async importarPlanilhaRetorno(e){try{const o=e=>new Promise(((o,t)=>{const a=new FileReader;a.readAsBinaryString(e),a.onload=()=>o(a.result),a.onerror=e=>t(e)})),t=await o(e[0]);let a=$e().read(t,{type:"binary"}),i=$e().utils.sheet_to_json(a.Sheets[Object.keys(a.Sheets)[0]],{header:1});for(let e=1;e<i.length;e++){const o=i[e],t=i[0];t[0]="Nome Rota";const a=$utils.convertArrToObj(t,o);if(o[29]&&o[29].length>1){console.log("numero pedido => ",o[29].replace("Pedido ",""));try{const e=o[29].replace("Pedido ","").split(" "),t=parseInt(e[0]),i=e[1];if(t>1){const e=(await $erp().documento.where({tipo:"Venda"}).filter((e=>e.numero===t&&e.numeroDocumentoEmpresa===i)).toArray())[0],r={...e},l=$utils.clonarV2(e);l.rotaJson=JSON.stringify({...JSON.parse(l.rotaJson),recebido:JSON.stringify(a)}),l.rotaNome=o[0],l.rotaSequencia=o[4],l.rotaData=$utils.dataAtual(),await $db.documento.grava({original:r,atual:l})}}catch(e){console.log(`[ERROR][IMPORTACAO] => ${e.message}`,e)}}}await this.atualizar(),this.$q.notify({type:"positive",message:"Importação realizada com sucesso"})}catch(e){e.name&&"ErroValidacao"===e.name?this.$q.notifyError(e.message,e):this.$q.notifyError("Ocorreu erro ao importar roterização xlsx",e)}},acessarPainel(){window.open("https://company.routeasy.com.br/#!/routings/create","_blank").focus()},montarObjImportacaoRE(e,o){let t={};for(let a=1;a<e.length;a++){const i=$utils.removerCaracteresEspeciais(e[a]).split(" ");for(let e=0;e<i.length;e++)i[e]=i[e].charAt(0).toUpperCase()+i[e].slice(1);t[i.join("")]=o[a]}return t},aoSelecionarEmpresa(){this.filtro.empresa=this.empresas.filter((e=>e.id===this.filtro.empresa.id))[0]},aoSelecionarStatusEnvio(){},aoSelecionarCliente(e,o){e&&(this.filtro.cliente=$utils.clonarV2(o),this.contatosModal=!1)},adicionarVenda(){this.$refs.faturaModal.mostrar()},abrirTodosPreview(){this.showAllPreviewDetail=!this.showAllPreviewDetail;for(let e of this.documentos)this.$refs[e.id].detalhesVisivel=this.showAllPreviewDetail},debug(e){console.log(e,this.tabSelecionada)},downloadJsonDeliveries(e){let o="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e)),t=document.createElement("a"),a=Ee.ZP.formatDate(new Date(this.filtro.periodo.finalizado.ini)).split("T")[0].split("-"),i=`Rotas_do_dia_${a[2]}/${a[1]}/${a[0]}.json`;t.setAttribute("href",o),t.setAttribute("download",i),document.body.appendChild(t),t.click(),t.remove()},delay:(e,o)=>new Promise((function(t){setTimeout((function(){t(o)}),e)})),async empresaOpcoesCarregar(){this.contatosEmpresa=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data,this.empresaOpcoes=this.contatosEmpresa.map((e=>({label:e.nome,value:e.codigoContato,id:e.id})))},filtraDebounce(){$lodash.debounce(this.atualizar,10)()}},async created(){$db.permissao.objeto("Diretiva_RelatorioVenda_VerTodos").then((async e=>{this.$route.params.id&&this.$route.params.id.length&&this.$refs.faturaModal.mostrar({id:this.$route.params.id}),this.diretivaContatosAcessaTodosContatos=e,this.diretivaContatosAcessaTodosContatos&&(this.vendedoresDigitadoresOpcoes=[],$db.crm.leOnlineVendedoresDigitadores({entregueInicio:this.entregueInicio,entregueFim:this.entregueFim}).then((e=>{e.forEach((e=>{e.codigo&&this.vendedoresDigitadoresOpcoes.push({label:e.nome,value:e.codigo})}))})));let o=await $db.configuracoes.le({nome:"integracao.routeasy"});this.tokenRoutEasy=o.length?o[0].valor:null,await this.empresaOpcoesCarregar(),this.atualizar()})),this.empresaOpcoesCarregar()},async mounted(){let e=await $db.configuracoes.le({nome:"vendas.usaExpedicao"});e=e.length?e[0].valor:null,this.tabs=[{rotulo:"Abertas",value:"Aberta"},{rotulo:"Finalizado",value:"Finalizada"},{rotulo:"Todas",value:""}]}};var Fe=t(67280);const Te=(0,K.Z)(De,[["render",function(e,o,t,d,s,c){const u=(0,a.resolveComponent)("campo"),m=(0,a.resolveComponent)("q-select"),p=(0,a.resolveComponent)("row"),f=(0,a.resolveComponent)("fatura-card-lista"),h=(0,a.resolveComponent)("q-list"),g=(0,a.resolveComponent)("lista"),v=(0,a.resolveComponent)("fatura-modal");return(0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,null,[(0,a.createElementVNode)("div",null,[(0,a.createVNode)(g,{titulo:"Faturas",onCriar_click:c.adicionarVenda,icone:"how_to_vote",onFiltro_change:c.atualizar,onLimparFiltros_click:c.limparFiltros_click,onAbrirTodosPreview:c.abrirTodosPreview,tabSelecionada:s.tabSelecionada,tabs:e.tabs,lista:s.documentos,paginacao:s.paginacao,permissaoExtrasV2:s.tokenRoutEasy,showToolbar:!1,permissaoExtras:!1,disableRemove:!0,permissaoNovo:!1,filtros:s.filtro,exportarXLSXVisible:!1,permissaoFicha:!1,buscaCampo:s.buscaCampo,"onUpdate:buscaCampo":o[9]||(o[9]=e=>s.buscaCampo=e),showAdd:!1,checkboxVisible:!1},{menuExtras:(0,a.withCtx)((()=>[])),filtroCampos:(0,a.withCtx)((()=>[(0,a.createVNode)(p,{class:"q-col-gutter-md q-mt-md",style:{"margin-top":"-10px"}},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(u,{modelValue:s.filtro.cliente.nome,"onUpdate:modelValue":[o[0]||(o[0]=e=>s.filtro.cliente.nome=e),c.filtraDebounce],class:"col-md-12",style:{"padding-top":"0px"},debounce:500,before:[{icon:"search"}],rotulo:"Por cliente ou responsável",dense:""},null,8,["modelValue","onUpdate:modelValue"]),(0,a.createVNode)(m,{modelValue:e.empresaSelecionada,"onUpdate:modelValue":[o[1]||(o[1]=o=>e.empresaSelecionada=o),e.refazFiltro],options:s.empresaOpcoes,clearable:"",label:"Por empresa"},null,8,["modelValue","options","onUpdate:modelValue"])])),_:1}),s.tokenRoutEasy&&s.tokenRoutEasy.length>3?((0,a.openBlock)(),(0,a.createBlock)(p,{key:0,class:"q-col-gutter-md q-mt-md"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(u,{tipo:"seletor",dense:"",modelValue:s.filtro.statusEnvio,"onUpdate:modelValue":[o[2]||(o[2]=e=>s.filtro.statusEnvio=e),c.aoSelecionarStatusEnvio],options:s.opcoesStatusEnvio.map((e=>({label:e.rotulo,value:e.rotulo}))),clearable:"",rotulo:"Status Envio"},null,8,["modelValue","options","onUpdate:modelValue"])])),_:1})):(0,a.createCommentVNode)("",!0),(0,a.createVNode)(p,{class:"q-col-gutter-md q-mt-md"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(u,{tipo:"seletor",dense:"",modelValue:s.filtro.opcaoDataSelected,"onUpdate:modelValue":o[3]||(o[3]=e=>s.filtro.opcaoDataSelected=e),options:s.opcoesData.map((e=>({label:e.label,value:e.label}))),rotulo:"Selecione data para filtro"},null,8,["modelValue","options"])])),_:1}),"Data Emissão"===s.filtro.opcaoDataSelected?((0,a.openBlock)(),(0,a.createBlock)(p,{key:1,class:"q-col-gutter-md q-mt-md"},{default:(0,a.withCtx)((()=>[i,(0,a.createVNode)(u,{modelValue:s.filtro.periodo.emissao.ini,"onUpdate:modelValue":o[4]||(o[4]=e=>s.filtro.periodo.emissao.ini=e),tipo:"data",class:"no-shadow full-width",rotulo:"De",col:"12",after:[{icon:"mdi-close-circle",handler(){s.filtro.periodo.emissao.ini=""}}],dense:""},null,8,["modelValue","after"]),(0,a.createVNode)(u,{modelValue:s.filtro.periodo.emissao.fim,"onUpdate:modelValue":o[5]||(o[5]=e=>s.filtro.periodo.emissao.fim=e),tipo:"data",class:"no-shadow full-width",rotulo:"até",col:"12",after:[{icon:"mdi-close-circle",handler(){s.filtro.periodo.emissao.fim=""}}],dense:""},null,8,["modelValue","after"])])),_:1})):(0,a.createCommentVNode)("",!0),"Data Finalização"===s.filtro.opcaoDataSelected?((0,a.openBlock)(),(0,a.createBlock)(p,{key:2,class:"q-col-gutter-md q-mt-md"},{default:(0,a.withCtx)((()=>[r,(0,a.createVNode)(u,{modelValue:s.filtro.periodo.finalizado.ini,"onUpdate:modelValue":o[6]||(o[6]=e=>s.filtro.periodo.finalizado.ini=e),tipo:"data",class:"no-shadow full-width",rotulo:"De",col:"12",after:[{icon:"mdi-close-circle",handler(){s.filtro.periodo.finalizado.ini=""}}],dense:""},null,8,["modelValue","after"]),(0,a.createVNode)(u,{modelValue:s.filtro.periodo.finalizado.fim,"onUpdate:modelValue":o[7]||(o[7]=e=>s.filtro.periodo.finalizado.fim=e),tipo:"data",class:"no-shadow full-width",rotulo:"até",col:"12",after:[{icon:"mdi-close-circle",handler(){s.filtro.periodo.finalizado.fim=""}}],dense:""},null,8,["modelValue","after"])])),_:1})):(0,a.createCommentVNode)("",!0),l,(0,a.createVNode)(u,{modelValue:s.paginacao.limite,"onUpdate:modelValue":o[8]||(o[8]=e=>s.paginacao.limite=e),min:"1",rotulo:"Quantidade por página",tipo:"quantidade",dense:""},null,8,["modelValue"])])),itemLista:(0,a.withCtx)((()=>[(0,a.createVNode)(h,{class:"rounded-borders"},{default:(0,a.withCtx)((()=>[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(s.documentos,(e=>((0,a.openBlock)(),(0,a.createElementBlock)("div",{key:e.id,class:"itemHover fullWidth q-px-sm",onClick:o=>c.debug(e)},[(0,a.createVNode)(f,{sendRouteEasy:c.sendRouteEasy,resetarEnvio:c.resetarEnvio,fatura:e.fatura,id:e.id,ref_for:!0,ref:e.id,class:"q-mb-md"},null,8,["sendRouteEasy","resetarEnvio","fatura","id"])],8,n)))),128))])),_:1})])),_:1},8,["onCriar_click","onFiltro_change","onLimparFiltros_click","onAbrirTodosPreview","tabSelecionada","tabs","lista","paginacao","permissaoExtrasV2","filtros","buscaCampo"])]),(0,a.createVNode)(v,{ref:"faturaModal",onExecutar:c.executar,onAtualizarAtendimentoVenda:c.executar,continueMesmaTela:!1},null,8,["onExecutar","onAtualizarAtendimentoVenda"])],64)}]]);xe()(De,"components",{QChip:Fe.Z,QSelect:Ve.Z,QList:ne.Z})}}]);