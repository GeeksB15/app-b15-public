(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["831f7768"],{"895f":function(o,e,t){"use strict";var a=t("0b3d");e["a"]={name:"QSpinnerGears",mixins:[a["a"]],render:function(o){return o("svg",{staticClass:"q-spinner",class:this.classes,attrs:{width:this.size,height:this.size,viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid",xmlns:"http://www.w3.org/2000/svg"}},[o("g",{attrs:{transform:"translate(-20,-20)"}},[o("path",{attrs:{d:"M79.9,52.6C80,51.8,80,50.9,80,50s0-1.8-0.1-2.6l-5.1-0.4c-0.3-2.4-0.9-4.6-1.8-6.7l4.2-2.9c-0.7-1.6-1.6-3.1-2.6-4.5 L70,35c-1.4-1.9-3.1-3.5-4.9-4.9l2.2-4.6c-1.4-1-2.9-1.9-4.5-2.6L59.8,27c-2.1-0.9-4.4-1.5-6.7-1.8l-0.4-5.1C51.8,20,50.9,20,50,20 s-1.8,0-2.6,0.1l-0.4,5.1c-2.4,0.3-4.6,0.9-6.7,1.8l-2.9-4.1c-1.6,0.7-3.1,1.6-4.5,2.6l2.1,4.6c-1.9,1.4-3.5,3.1-5,4.9l-4.5-2.1 c-1,1.4-1.9,2.9-2.6,4.5l4.1,2.9c-0.9,2.1-1.5,4.4-1.8,6.8l-5,0.4C20,48.2,20,49.1,20,50s0,1.8,0.1,2.6l5,0.4 c0.3,2.4,0.9,4.7,1.8,6.8l-4.1,2.9c0.7,1.6,1.6,3.1,2.6,4.5l4.5-2.1c1.4,1.9,3.1,3.5,5,4.9l-2.1,4.6c1.4,1,2.9,1.9,4.5,2.6l2.9-4.1 c2.1,0.9,4.4,1.5,6.7,1.8l0.4,5.1C48.2,80,49.1,80,50,80s1.8,0,2.6-0.1l0.4-5.1c2.3-0.3,4.6-0.9,6.7-1.8l2.9,4.2 c1.6-0.7,3.1-1.6,4.5-2.6L65,69.9c1.9-1.4,3.5-3,4.9-4.9l4.6,2.2c1-1.4,1.9-2.9,2.6-4.5L73,59.8c0.9-2.1,1.5-4.4,1.8-6.7L79.9,52.6 z M50,65c-8.3,0-15-6.7-15-15c0-8.3,6.7-15,15-15s15,6.7,15,15C65,58.3,58.3,65,50,65z",fill:"currentColor"}},[o("animateTransform",{attrs:{attributeName:"transform",type:"rotate",from:"90 50 50",to:"0 50 50",dur:"1s",repeatCount:"indefinite"}})])]),o("g",{attrs:{transform:"translate(20,20) rotate(15 50 50)"}},[o("path",{attrs:{d:"M79.9,52.6C80,51.8,80,50.9,80,50s0-1.8-0.1-2.6l-5.1-0.4c-0.3-2.4-0.9-4.6-1.8-6.7l4.2-2.9c-0.7-1.6-1.6-3.1-2.6-4.5 L70,35c-1.4-1.9-3.1-3.5-4.9-4.9l2.2-4.6c-1.4-1-2.9-1.9-4.5-2.6L59.8,27c-2.1-0.9-4.4-1.5-6.7-1.8l-0.4-5.1C51.8,20,50.9,20,50,20 s-1.8,0-2.6,0.1l-0.4,5.1c-2.4,0.3-4.6,0.9-6.7,1.8l-2.9-4.1c-1.6,0.7-3.1,1.6-4.5,2.6l2.1,4.6c-1.9,1.4-3.5,3.1-5,4.9l-4.5-2.1 c-1,1.4-1.9,2.9-2.6,4.5l4.1,2.9c-0.9,2.1-1.5,4.4-1.8,6.8l-5,0.4C20,48.2,20,49.1,20,50s0,1.8,0.1,2.6l5,0.4 c0.3,2.4,0.9,4.7,1.8,6.8l-4.1,2.9c0.7,1.6,1.6,3.1,2.6,4.5l4.5-2.1c1.4,1.9,3.1,3.5,5,4.9l-2.1,4.6c1.4,1,2.9,1.9,4.5,2.6l2.9-4.1 c2.1,0.9,4.4,1.5,6.7,1.8l0.4,5.1C48.2,80,49.1,80,50,80s1.8,0,2.6-0.1l0.4-5.1c2.3-0.3,4.6-0.9,6.7-1.8l2.9,4.2 c1.6-0.7,3.1-1.6,4.5-2.6L65,69.9c1.9-1.4,3.5-3,4.9-4.9l4.6,2.2c1-1.4,1.9-2.9,2.6-4.5L73,59.8c0.9-2.1,1.5-4.4,1.8-6.7L79.9,52.6 z M50,65c-8.3,0-15-6.7-15-15c0-8.3,6.7-15,15-15s15,6.7,15,15C65,58.3,58.3,65,50,65z",fill:"currentColor"}},[o("animateTransform",{attrs:{attributeName:"transform",type:"rotate",from:"0 50 50",to:"90 50 50",dur:"1s",repeatCount:"indefinite"}})])])])}}},"8cac":function(o,e,t){},b878:function(o,e,t){"use strict";t.r(e);var a=function(){var o=this,e=o.$createElement,t=o._self._c||e;return t("q-layout",{staticClass:"AdmEnvelope"},[t("barra-topo"),t("q-page-container",[t("q-page",[t("q-toolbar",{staticClass:"q-py-sm q-my-sm",attrs:{color:"none"}},[t("q-toolbar-title",[o._v("Adm. Envelope")]),"optisoul"===o.sistemaPai?t("q-btn",{attrs:{icon:"help_outline",flat:"",dense:"",round:"",size:"lg"}},[t("q-popover",[t("q-list",{attrs:{link:"","no-border":"",separator:""}},[t("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}]},[t("q-item-side",{attrs:{icon:"mdi-youtube"}}),t("q-item-main",{attrs:{label:"Videoaula Adm. de Envelope"},nativeOn:{click:function(e){o.showHelp("admEnvelope")}}})],1)],1)],1)],1):o._e(),t("q-btn",{staticClass:"no-shadow",attrs:{icon:"mdi-filter",size:"lg",flat:"",round:"",dense:""},on:{click:function(e){o.showfilters=!o.showfilters}}})],1),t("q-layout-drawer",{attrs:{overlay:"",side:"right"},model:{value:o.showfilters,callback:function(e){o.showfilters=e},expression:"showfilters"}},[t("q-toolbar",{attrs:{color:"white","text-color":"faded"}},[t("q-icon",{attrs:{name:"mdi-filter",color:"faded"}}),t("q-toolbar-title",[o._v(" Filtrar")]),t("q-btn",{attrs:{dense:"",flat:"",icon:"close",round:""},on:{click:function(e){o.showfilters=!o.showfilters}}})],1),t("div",{staticClass:"col-12 q-px-md q-mt-md"},[t("q-input",{staticClass:"no-shadow",attrs:{color:"white",placeholder:"Por cliente ou responsável"},on:{input:o.filtraDebounce},model:{value:o.fraseFiltro,callback:function(e){o.fraseFiltro=e},expression:"fraseFiltro"}})],1),t("div",{staticClass:"col-12 q-px-sm q-my-md"},[t("q-select",{staticClass:"q-mx-sm",attrs:{options:o.prazoOpcoes,clearable:"",placeholder:"Por prazo"},model:{value:o.prazoSelecionado,callback:function(e){o.prazoSelecionado=e},expression:"prazoSelecionado"}})],1),t("div",{staticClass:"col-12 q-px-sm"},[t("q-select",{staticClass:"q-mx-sm",attrs:{options:o.empresaOpcoes,clearable:"",placeholder:"Por empresa"},on:{input:o.refazFiltro},nativeOn:{click:function(e){return o.empresaOpcoesCarregar(e)}},model:{value:o.empresaSelecionada,callback:function(e){o.empresaSelecionada=e},expression:"empresaSelecionada"}})],1)],1),t("div",{staticClass:"row overflowXEnvelope filterfalse"},o._l(o.listasFiltradas,function(e,a){return t("div",{key:a,staticClass:"no-shadow q-py-sm col q-px-none coluna"},[t("div",{staticClass:"q-pa-none"},[t("q-toolbar",{staticClass:"no-shadow q-py-none q-px-sm",attrs:{color:"secondary","text-color":"white"}},[t("q-toolbar-title",{staticClass:"q-py-none"},[o._v("\n                "+o._s(a)+"\n              ")])],1),"Entregue"===a?t("div",{staticClass:"row"},[t("div",{staticClass:"col-12 q-px-none"},[t("campo",{staticClass:"q-mx-sm",attrs:{rotulo:"Início",tipo:"data"},model:{value:o.entregueInicio,callback:function(e){o.entregueInicio=e},expression:"entregueInicio"}}),t("campo",{staticClass:"q-mx-sm",attrs:{rotulo:"Fim",tipo:"data"},model:{value:o.entregueFim,callback:function(e){o.entregueFim=e},expression:"entregueFim"}})],1)]):o._e(),t("draggable",{staticClass:"dragAreaEnvelope",attrs:{delay:"400",list:e,group:"envelopeGroup",draggable:".extratoEnvelope"},on:{end:o.eventoEnd},nativeOn:{scroll:function(e){o.scrollHandler(e,a)}}},o._l(e,function(e){return null===o.prazoSelecionado||o.prazoSelecionado===e.corBorda?t("q-card",{key:e.codigoDocumento,staticClass:"q-pa-sm q-pb-md q-my-sm q-mb-md shadow-1 extratoEnvelope bg-white",class:e.corBorda},[t("div",{staticClass:"row q-mt-xs"},[t("div",{staticClass:"col-6"},[e.corLabel?t("badge",{staticClass:"q-mx-xs",attrs:{cor:e.corLabel,escuro:"",rotulo:e.txtLabel}}):t("badge",{staticClass:"q-mx-xs",attrs:{rotulo:e.txtLabel}})],1),t("div",{staticClass:"col-6 justify-end q-pr-xs",staticStyle:{display:"flex"}},[t("badge",{attrs:{cor:"white",icone:"shopping_cart"}},[o._v("\n                      "+o._s(e.numeroVenda)+"\n                    ")]),"-"!==e.codigoCompra?t("badge",{attrs:{cor:"light",icone:"mdi-factory"}},[o._v("\n                      "+o._s(e.codigoCompra)+"\n                    ")]):o._e(),t("badge",{staticClass:"q-mx-sm",attrs:{cor:"faded",escuro:"",icone:"mdi-email"}},[o._v("\n                      "+o._s(e.numeroEnvelope)+"\n                    ")])],1)]),t("q-card-title",{staticClass:"q-pa-xs"},[t("div",{staticClass:"q-subheading"},[o._v(o._s(e.nomeCliente))]),e.nomeLaboratorio?t("div",{staticStyle:{background:"rgb(236, 239, 241)","border-radius":"50px","text-align":"center",display:"inline-block",width:"22px",height:"22px","line-height":"22px","margin-right":"3px"}},[t("q-icon",{attrs:{name:"mdi-sunglasses",color:"grey-7",size:"14px"}})],1):o._e(),e.nomeLaboratorio?t("div",{staticClass:"q-caption",staticStyle:{display:"inline-block","margin-right":"6px"}},[o._v("\n                    Laboratório: "+o._s(e.nomeLaboratorio)+"\n                    "),t("q-tooltip",[o._v("\n                      Laboratório\n                    ")])],1):o._e()]),t("q-card-main",{staticClass:"row q-pa-xs q-pb-none q-mt-md"},[t("div",{staticClass:"col-11"},[e.descricaoEmpresa?t("div",{staticStyle:{background:"rgb(236, 239, 241)","border-radius":"50px","text-align":"center",display:"inline-block",width:"22px",height:"22px","line-height":"22px","margin-right":"3px"}},[t("q-icon",{attrs:{name:"business",color:"grey-7",size:"14px"}}),t("q-tooltip",[o._v("\n                        "+o._s(e.descricaoEmpresa)+"\n                      ")])],1):o._e(),t("div",{staticStyle:{background:"rgb(236, 239, 241)","border-radius":"50px","text-align":"center",display:"inline-block",width:"22px",height:"22px","line-height":"22px","margin-right":"3px"}},[t("q-icon",{attrs:{name:"person",color:"grey-7",size:"14px"}})],1),t("div",{staticClass:"q-caption",staticStyle:{display:"inline-block","margin-right":"6px"}},[o._v("\n                      "+o._s(e.nomeResponsavel)+"\n                      "),t("q-tooltip",[o._v("\n                        Responsável\n                      ")])],1),t("div",{staticStyle:{background:"rgb(236, 239, 241)","border-radius":"50px","text-align":"center",display:"inline-block",width:"22px",height:"22px","line-height":"22px","margin-right":"3px"}},[t("q-icon",{attrs:{name:"calendar_today",color:"grey-7",size:"14px"}})],1),t("div",{staticClass:"q-caption",staticStyle:{display:"inline-block"}},[o._v("\n                      "+o._s(o._f("data")(e.dataHoraFinalizado>new Date("1970-01-01T00:00:00.000Z")?e.dataHoraFinalizado:e.dataHoraPrevisto))+"\n                      "),t("q-tooltip",[o._v("\n                        "+o._s(e.dataHoraFinalizado>new Date("1970-01-01T00:00:00.000Z")?"Finalizado em":"Previsto para")+"\n                      ")])],1)]),t("div",{staticClass:"col-1 self-end"},[t("q-icon",{staticStyle:{color:"grey",float:"right","text-align":"right","font-size":"1.2rem",cursor:"pointer"},attrs:{name:"more_vert",onMouseOver:"this.style.color='black'",onMouseOut:"this.style.color='grey'"}},[t("q-popover",[t("q-list",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{link:"",separator:""}},[o.laboratoriosEssilor.includes(e.codigoLaboratorio)?[t("q-item",{nativeOn:{click:function(t){o.abrirEssilorPedidoLaboratorio(e)}}},[t("q-item-side",{attrs:{icon:"trending_up"}}),t("q-item-main",{attrs:{label:"Pedido ao laboratório Essilor"}})],1),t("q-item",{nativeOn:{click:function(t){o.abrirEssilorConsultarPedido(e)}}},[t("q-item-side",{attrs:{icon:"trending_up"}}),t("q-item-main",{attrs:{label:"Consultar pedido Essilor"}})],1),t("q-item",{nativeOn:{click:function(t){o.abrirEssilorConsultarStatusPedido(e)}}},[t("q-item-side",{attrs:{icon:"trending_up"}}),t("q-item-main",{attrs:{label:"Status pedido Essilor"}})],1)]:o._e(),t("q-item",{nativeOn:{click:function(t){o.exibirHistorico(e.codigoDocumento)}}},[t("q-item-side",{attrs:{icon:"history"}}),t("q-item-main",{attrs:{label:"Histórico do Status"}})],1),t("q-item",{nativeOn:{click:function(t){o.irParaAtendimento(e.codigoContato)}}},[t("q-item-side",{attrs:{icon:"launch"}}),t("q-item-main",{attrs:{label:"Ir para o Atendimento"}})],1)],2)],1)],1)],1)])],1):o._e()}))],1)])})),t("envelope-trocar-status",{attrs:{dados:o.trocarStatusDados},on:{confirmar:o.eventoConfirmarTroca,cancelar:o.eventoCancelarTroca},model:{value:o.trocarStatusModal,callback:function(e){o.trocarStatusModal=e},expression:"trocarStatusModal"}}),t("EssilorPedidoLaboratorio",{attrs:{dados:o.pedidoLaboratorioEssilor},model:{value:o.modalEssilorPedidoLaboratorio,callback:function(e){o.modalEssilorPedidoLaboratorio=e},expression:"modalEssilorPedidoLaboratorio"}}),t("EssilorConsultarPedidos",{model:{value:o.modalEssilorConsultarPedidos,callback:function(e){o.modalEssilorConsultarPedidos=e},expression:"modalEssilorConsultarPedidos"}}),t("EssilorConsultarPedido",{attrs:{envelope:o.essilorPedido},model:{value:o.modalEssilorConsultarPedido,callback:function(e){o.modalEssilorConsultarPedido=e},expression:"modalEssilorConsultarPedido"}}),t("EssilorConsultarStatusPedido",{attrs:{envelope:o.essilorPedido},model:{value:o.modalEssilorConsultarStatusPedido,callback:function(e){o.modalEssilorConsultarStatusPedido=e},expression:"modalEssilorConsultarStatusPedido"}}),o.modalHistoricoStatus.activated?t("modal-historico-status",{attrs:{dados:o.modalHistoricoStatus}}):o._e()],1)],1),t("q-modal",{attrs:{"content-css":{minWidth:"100vw",minHeight:"100vh"}},model:{value:o.help.show,callback:function(e){o.$set(o.help,"show",e)},expression:"help.show"}},[t("q-modal-layout",{staticStyle:{height:"100vh",width:"100vw"}},[t("iframe",{staticStyle:{height:"100%",width:"100%"},attrs:{src:o.help.src,frameborder:"0",allow:"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""}}),t("q-toolbar",{attrs:{slot:"header"},slot:"header"},[t("q-toolbar-title",[o._v(o._s(o.help.title))]),t("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"close",round:""}})],1)],1)],1)],1)},r=[];a._withStripped=!0;var i=t("448a"),s=t.n(i),n=(t("c5f6"),t("28a5"),t("3156")),l=t.n(n),c=(t("cadf"),t("6762"),t("2fdb"),t("ac4d"),t("8a81"),t("ac6a"),t("96cf"),t("c973")),d=t.n(c),u=t("01f0"),p=t("88db"),m=function(){var o=this,e=o.$createElement,t=o._self._c||e;return t("q-modal",{attrs:{value:o.value},on:{input:o.eventoInput}},[t("q-modal-layout",[t("q-toolbar",{attrs:{slot:"header"},slot:"header"},[t("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"arrow_back",round:""}}),t("q-toolbar-title",[o._v("Trocar status do envelope")])],1),t("form",{on:{submit:function(e){return e.preventDefault(),o.eventoConfirmar(e)}}},[t("div",{staticClass:"layout-padding"},[t("div",{staticClass:"row gutter-x-sm"},[t("campo",{staticClass:"col-12",attrs:{somenteLeitura:"",rotulo:"Cliente"},model:{value:o.dados.nomeCliente,callback:function(e){o.$set(o.dados,"nomeCliente",e)},expression:"dados.nomeCliente"}})],1),t("div",{staticClass:"row gutter-x-sm"},[t("campo",{staticClass:"col-12",attrs:{somenteLeitura:"",rotulo:"De"},model:{value:o.dados.statusAtual,callback:function(e){o.$set(o.dados,"statusAtual",e)},expression:"dados.statusAtual"}})],1),t("div",{staticClass:"row gutter-x-sm"},[t("campo",{staticClass:"col-12",attrs:{somenteLeitura:"",rotulo:"Para"},model:{value:o.dados.statusNovo,callback:function(e){o.$set(o.dados,"statusNovo",e)},expression:"dados.statusNovo"}})],1),t("div",{staticClass:"row gutter-x-sm"},[t("campo",{staticClass:"col-12",attrs:{maxlength:"50",rotulo:"Observação"},model:{value:o.dados.observacao,callback:function(e){o.$set(o.dados,"observacao","string"===typeof e?e.trim():e)},expression:"dados.observacao"}})],1),o.dados.mostraGerarPedido?t("div",{staticClass:"row gutter-x-sm"},[t("campo",{staticClass:"col-12",attrs:{rotulo:"Gerar pedido de compra",tipo:"logico"},model:{value:o.dados.gerarPedido,callback:function(e){o.$set(o.dados,"gerarPedido",e)},expression:"dados.gerarPedido"}})],1):o._e(),o.dados.mostraLaboratorio?t("div",{staticClass:"row gutter-x-sm"},[t("campo",{staticClass:"col-12",attrs:{value:o.dados.nomeLaboratorio,somenteLeitura:"",before:[{icon:"search",handler:function(){return o.modalLaboratorio=!0}}],rotulo:"Laboratório",erro:o.laboratorioErro,erroRotulo:"Seleção de laboratório obrigatória"},on:{click:function(e){o.modalLaboratorio=!0}}})],1):o._e(),o.dados.mostraGerarPedidoEssilor?t("div",{staticClass:"row gutter-x-sm"},[t("campo",{staticClass:"col-12",attrs:{rotulo:"Gerar pedido ao laboratório Essilor",tipo:"logico"},model:{value:o.dados.gerarPedidoEssilor,callback:function(e){o.$set(o.dados,"gerarPedidoEssilor",e)},expression:"dados.gerarPedidoEssilor"}})],1):o._e()]),t("q-toolbar",{attrs:{slot:"footer",color:"light"},slot:"footer"},[t("q-toolbar-title",[t("div",{staticClass:"row justify-end"},[t("q-btn",{attrs:{flat:"",color:"primary",label:"Cancelar"},on:{click:o.eventoCancelar}}),t("q-btn",{attrs:{flat:"",color:"primary",type:"submit",label:"Trocar"}})],1)])],1)],1)],1),t("prompt-contato-novo",{attrs:{online:"",filtro:{ativo:!0,segmento:"Laboratório"}},on:{selecionar:o.selecionarLaboratorio},model:{value:o.modalLaboratorio,callback:function(e){o.modalLaboratorio=e},expression:"modalLaboratorio"}})],1)},v=[];m._withStripped=!0;var h=t("41ff"),f=t("ed08"),g={components:{Campo:p["a"],PromptContatoNovo:h["a"]},data:function(){return{confirmado:!1,descricaoLaboratorio:"",laboratorioErro:!1,modalLaboratorio:!1}},methods:{eventoConfirmar:function(){f["gconsole"].log("EnvelopeTrocarStatus","eventoConfirmar",this.dados),!this.dados.mostraLaboratorio||this.dados.codigoLaboratorio?(this.confirmado=!0,this.eventoInput(!1),this.$emit("confirmar",this.dados)):this.laboratorioErro=!0},eventoCancelar:function(){f["gconsole"].log("EnvelopeTrocarStatus","eventoCancelar",this.dados),this.confirmado=!1,this.eventoInput(!1)},eventoInput:function(o){this.$emit("input",o)},selecionarLaboratorio:function(){var o=d()(regeneratorRuntime.mark(function o(e,t){return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:f["gconsole"].log("EnvelopeTrocarStatus","selecionarLaboratorio",e,t),this.dados.codigoLaboratorio=t.codigoContato,this.dados.nomeLaboratorio=t.nome,this.dados.mostraGerarPedidoEssilor=this.dados.laboratoriosEssilor.includes(this.dados.codigoLaboratorio),this.laboratorioErro=!1;case 5:case"end":return o.stop()}},o,this)}));return function(e,t){return o.apply(this,arguments)}}()},props:{value:{required:!0,type:Boolean},dados:{required:!0,type:Object}},watch:{value:function(o){o?(this.confirmado=!1,this.laboratorioErro=!1):this.confirmado||this.$emit("cancelar",this.dados)}}},b=g,C=t("2877"),E=Object(C["a"])(b,m,v,!1,null,null,null);E.options.__file="EnvelopeTrocarStatus.vue";var q=E.exports,x=function(){var o=this,e=o.$createElement,t=o._self._c||e;return t("div",[t("q-modal",{attrs:{value:o.value,maximized:""},on:{input:o.eventoInput}},[t("q-modal-layout",{staticClass:"bg-grey-4"},[t("q-toolbar",{attrs:{slot:"header"},slot:"header"},[t("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"arrow_back",round:""}}),t("q-toolbar-title",[o._v("Consulta Pedido Essilor")])],1),t("form",{on:{submit:function(e){return e.preventDefault(),o.eventoConfirmar(e)}}},[t("div",{staticClass:"layout-padding q-pa-none q-pb-xl"},[t("div",{staticClass:"u-container"},[t("q-card",{staticClass:"row bg-white q-px-lg q-py-sm q-mt-md no-shadow"},[t("campo",{staticClass:"col-12 col-md-6 q-pa-sm",attrs:{opcoes:o.opcoesAmbiente,"rotulo-fixo":"Ambiente",tipo:"seletor"},model:{value:o.ambiente,callback:function(e){o.ambiente=e},expression:"ambiente"}}),t("q-toggle",{staticClass:"col-12 col-md-4 q-pa-md",attrs:{label:"Mostrar Json"},model:{value:o.mostrarJson,callback:function(e){o.mostrarJson=e},expression:"mostrarJson"}})],1),t("q-card",{staticClass:"row bg-white q-px-lg q-py-sm q-mt-md no-shadow"},[t("p",{staticClass:"col-12 q-title"},[o._v("Filtros")]),t("campo",{staticClass:"col-12 col-md-6 q-pa-sm",attrs:{rotulo:"Identificação do pedido no laboratório"},model:{value:o.json.id,callback:function(e){o.$set(o.json,"id",e)},expression:"json.id"}})],1)],1)]),t("q-toolbar",{attrs:{slot:"footer",color:"light"},slot:"footer"},[t("q-toolbar-title",{staticClass:"text-right"},[t("q-btn",{attrs:{flat:"",color:"primary",label:"Cancelar"},on:{click:o.eventoCancelar}}),t("q-btn",{attrs:{flat:"",color:"primary",type:"submit",label:"Enviar"}})],1)],1)],1)],1)],1),t("EssilorModalConfirmacao",{attrs:{modal:o.modalConfirma}}),t("EssilorModalResultado",{attrs:{modal:o.modalResultado}})],1)},w=[];x._withStripped=!0;var P=function(){var o=this,e=o.$createElement,t=o._self._c||e;return t("q-modal",{attrs:{"content-css":{minWidth:"80vw"}},model:{value:o.modal.visivel,callback:function(e){o.$set(o.modal,"visivel",e)},expression:"modal.visivel"}},[t("q-modal-layout",[t("form",{on:{submit:function(e){return e.preventDefault(),o.modal.eventoConfirmar(e)}}},[t("q-toolbar",{attrs:{slot:"header",color:o.modal.cor},slot:"header"},[t("q-toolbar-title",[o._v(o._s(o.modal.titulo))]),t("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"close",round:""}})],1),t("div",{staticClass:"layout-padding"},[t("Campo",{staticClass:"bg-light",attrs:{tipo:"textoArea",rows:"10"},model:{value:o.modal.json,callback:function(e){o.$set(o.modal,"json",e)},expression:"modal.json"}})],1),t("q-toolbar",{attrs:{slot:"footer",color:"light"},slot:"footer"},[t("q-toolbar-title",{staticClass:"text-right"},[t("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{flat:"",color:"primary",label:"Cancelar"}}),t("q-btn",{attrs:{flat:"",color:"primary",type:"submit",label:"Confirmar"}})],1)],1)],1)])],1)},L=[];P._withStripped=!0;var y={components:{Campo:p["a"]},data:function(){return{}},methods:{},props:{modal:{required:!0,type:Object}}},_=y,k=Object(C["a"])(_,P,L,!1,null,null,null);k.options.__file="EssilorModalConfirmacao.vue";var j=k.exports,S=function(){var o=this,e=o.$createElement,t=o._self._c||e;return t("q-modal",{attrs:{"content-css":{minWidth:"80vw"}},model:{value:o.modal.visivel,callback:function(e){o.$set(o.modal,"visivel",e)},expression:"modal.visivel"}},[t("q-modal-layout",[t("q-toolbar",{attrs:{slot:"header",color:o.modal.cor},slot:"header"},[t("q-toolbar-title",[o._v(o._s(o.modal.titulo))]),t("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"close",round:""}})],1),t("div",{staticClass:"layout-padding"},[t("Campo",{staticClass:"bg-light",attrs:{tipo:"textoArea",rows:"10","somente-leitura":""},model:{value:o.modal.resultado,callback:function(e){o.$set(o.modal,"resultado",e)},expression:"modal.resultado"}})],1)],1)],1)},O=[];S._withStripped=!0;var R={components:{Campo:p["a"]},data:function(){return{}},methods:{},props:{modal:{required:!0,type:Object}}},D=R,A=Object(C["a"])(D,S,O,!1,null,null,null);A.options.__file="EssilorModalResultado.vue";var M=A.exports,$=t("bc3a"),I=t.n($),N=(t("6b54"),t("7f7f"),{baseURL:"https://api.essilor.com.br",client_id:"a40ea66e-c567-39aa-9a63-a29d2df6f973",client_secret:"ff72364c-40e2-3a21-af1e-d7f3e4cd5982"}),F={usuario:"",senha:"",access_token:"",expires_in:0,expires_datetime:0,ambiente:""},T={obterJwtToken:function(){var o=d()(regeneratorRuntime.mark(function o(e,t,a){return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:if(F.access_token&&!(F.expires_datetime<new Date)&&F.usuario===e&&F.senha===t&&F.ambiente===a){o.next=3;break}return o.next=3,this.obterToken(e,t,a);case 3:return o.abrupt("return",{client_id:N.client_id,access_token:F.access_token});case 4:case"end":return o.stop()}},o,this)}));return function(e,t,a){return o.apply(this,arguments)}}(),obterToken:function(){var o=d()(regeneratorRuntime.mark(function o(e,t,a){var r,i,s;return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,r={usuario:e,senha:t},o.next=4,I()({method:"post",baseURL:N.baseURL,url:a+"autenticacao-jwt/v1/token",auth:{username:N.client_id,password:N.client_secret},validateStatus:function(o){return o>=200&&o<=500},timeout:1e4,headers:{client_id:N.client_id},data:r});case 4:i=o.sent,s=[201].includes(i.status),s||console.error("Falha na autenticação\n",i),Object(f["verificarErro"])(!s,((i.data||[])[0]||{}).mensagem||"Falha na autenticação"),F.usuario=e,F.senha=t,F.access_token=i.data.access_token,F.expires_in=i.data.expires_in,F.expires_datetime=new Date(Number(new Date)+1e3*F.expires_in),F.ambiente=a,f["gconsole"].log("essilor","autenticacao-jwt token",F),o.next=23;break;case 17:if(o.prev=17,o.t0=o["catch"](0),"ErroValidacao"!==o.t0.name){o.next=21;break}throw o.t0;case 21:Object(f["verificarErro"])("Error"===o.t0.name&&"Network Error"===o.t0.message,"Sem internet ou erro de comunicação!"),Object(f["verificarErro"])(!0,"Falha no acesso ao servidor de autenticação da Essilor! "+o.t0.toString());case 23:case"end":return o.stop()}},o,null,[[0,17]])}));return function(e,t,a){return o.apply(this,arguments)}}()},z={baseURL:"https://api.essilor.com.br"},J={adicionar:function(){var o=d()(regeneratorRuntime.mark(function o(e,t,a,r,i){var s,n;return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,T.obterJwtToken(t,a,r);case 3:return s=o.sent,s.laboratorio=e,o.next=7,I()({method:"post",baseURL:z.baseURL,url:r+"gestao-pedidos-laboratorio/v1/pedidos",validateStatus:function(o){return o>=200&&o<=500},timeout:1e4,headers:s,data:i});case 7:return n=o.sent,f["gconsole"].log("essilor","Pedidos.adicionar",{headers:s,dados:i,resposta:n}),o.abrupt("return",n);case 12:throw o.prev=12,o.t0=o["catch"](0),f["gconsole"].error("essilor","Pedidos.adicionar erro\n",o.t0.stack),o.t0;case 16:case"end":return o.stop()}},o,null,[[0,12]])}));return function(e,t,a,r,i){return o.apply(this,arguments)}}(),consultarPedido:function(){var o=d()(regeneratorRuntime.mark(function o(e,t,a,r,i){var s,n;return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,T.obterJwtToken(t,a,r);case 3:return s=o.sent,s.laboratorio=e,o.next=7,I()({method:"get",baseURL:z.baseURL,url:r+"gestao-pedidos-laboratorio/v1/pedidos/".concat(i),validateStatus:function(o){return o>=200&&o<=500},timeout:1e4,headers:s});case 7:return n=o.sent,f["gconsole"].log("essilor","Pedidos.consultarPedido",{headers:s,id:i,resposta:n}),o.abrupt("return",n);case 12:throw o.prev=12,o.t0=o["catch"](0),f["gconsole"].error("essilor","Pedidos.consultarPedido erro\n",o.t0.stack),o.t0;case 16:case"end":return o.stop()}},o,null,[[0,12]])}));return function(e,t,a,r,i){return o.apply(this,arguments)}}(),consultarPedidos:function(){var o=d()(regeneratorRuntime.mark(function o(e,t,a,r,i){var s,n;return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,T.obterJwtToken(t,a,r);case 3:return s=o.sent,s.laboratorio=e,o.next=7,I()({method:"get",baseURL:z.baseURL,url:r+"gestao-pedidos-laboratorio/v1/pedidos",validateStatus:function(o){return o>=200&&o<=500},timeout:1e4,headers:s,params:i});case 7:return n=o.sent,f["gconsole"].log("essilor","Pedidos.consultarPedidos",{headers:s,params:i,resposta:n}),o.abrupt("return",n);case 12:throw o.prev=12,o.t0=o["catch"](0),f["gconsole"].error("essilor","Pedidos.consultarPedidos erro\n",o.t0.stack),o.t0;case 16:case"end":return o.stop()}},o,null,[[0,12]])}));return function(e,t,a,r,i){return o.apply(this,arguments)}}(),consultarStatusPedido:function(){var o=d()(regeneratorRuntime.mark(function o(e,t,a,r,i){var s,n;return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,T.obterJwtToken(t,a,r);case 3:return s=o.sent,s.laboratorio=e,o.next=7,I()({method:"get",baseURL:z.baseURL,url:r+"gestao-pedidos-laboratorio/v1/pedidos/".concat(i,"/status"),validateStatus:function(o){return o>=200&&o<=500},timeout:1e4,headers:s});case 7:return n=o.sent,f["gconsole"].log("essilor","Pedidos.consultarStatusPedido",{headers:s,id:i,resposta:n}),o.abrupt("return",n);case 12:throw o.prev=12,o.t0=o["catch"](0),f["gconsole"].error("essilor","Pedidos.consultarStatusPedido erro\n",o.t0.stack),o.t0;case 16:case"end":return o.stop()}},o,null,[[0,12]])}));return function(e,t,a,r,i){return o.apply(this,arguments)}}()},H=t("a9a0"),V=t("895f"),U=t("8149"),B={components:{Campo:p["a"],EssilorModalConfirmacao:j,EssilorModalResultado:M},computed:{opcoesAmbiente:function(){return[{valor:"",rotulo:"Produção"},{valor:"dev/",rotulo:"Desenvolvimento"},{valor:"sandbox/",rotulo:"Sandbox"}]}},data:function(){return{ambiente:"dev/",codigoLaboratorio:null,contatosLaboratorio:[],idEmpresa:null,json:{},modalConfirma:{visivel:!1},modalResultado:{visivel:!1},mostrarJson:!1}},methods:{eventoConfirmar:function(){var o=d()(regeneratorRuntime.mark(function o(){var e;return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,f["gconsole"].log("EssilorConsultarPedido","consultar",JSON.stringify(this.json,0,2)),Object(f["verificarErro"])(!this.json.id,"Pedido nao informado"),Object(f["verificarErro"])(!this.envelope.idEmpresa,"Empresa não selecionada"),Object(f["verificarErro"])(!this.envelope.codigoLaboratorio,"Laboratório não selecionado"),e=this.envelope.cnpjLaboratorio,Object(f["verificarErro"])(!e,"Laboratório sem CNPJ"),o.next=9,U["a"].configuracoes.leLaboratorioEssilor(this.envelope.codigoLaboratorio,this.envelope.idEmpresa);case 9:this.modalConfirma={visivel:this.mostrarJson,eventoConfirmar:this.eventoConfirmar2,cnpjLaboratorio:e,titulo:"Consultar pedido "+e,cor:"primary",json:this.json.id},this.mostrarJson||this.modalConfirma.eventoConfirmar(),o.next=16;break;case 13:o.prev=13,o.t0=o["catch"](0),this.$q.notifyError("Falha na consulta",o.t0);case 16:case"end":return o.stop()}},o,this,[[0,13]])}));return function(){return o.apply(this,arguments)}}(),eventoConfirmar2:function(){var o=d()(regeneratorRuntime.mark(function o(){var e,t,a,r,i,s,n;return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,this.modalConfirma.visivel=!1,o.next=4,U["a"].configuracoes.leLaboratorioEssilor(this.envelope.codigoLaboratorio,this.envelope.idEmpresa);case 4:return e=o.sent,t=e.usuario,a=e.senha,H["a"].show({spinner:V["a"],spinnerColor:"amber",message:"Consultando pedido"}),o.next=10,J.consultarPedido(this.modalConfirma.cnpjLaboratorio,t,a,this.ambiente,this.modalConfirma.json);case 10:if(r=o.sent,i=[200,201,206].includes(r.status),this.modalResultado={visivel:this.mostrarJson,titulo:"Pedido - status "+r.status,cor:i?"primary":"negative",resultado:JSON.stringify({data:r.data},0,2)},i){o.next=19;break}return s=((r.data||[])[0]||{}).mensagem,Object(f["verificarErro"])(!s,"Falha na consulta"),n=r.data.map(function(o){return o.mensagem+" (código: "+(o.codigo||"")+")"}),this.$utils.eventos.$emit("mostrarModalAlerta",{titulo:"Erro",erros:n}),o.abrupt("return");case 19:this.$utils.eventos.$emit("mostrarModalSucesso",{titulo:"Pedido",mensagens:["Status atual: "+r.data.statusAtual,"Entrada: "+this.$filters.dataHora(r.data.dataEntrada),"Entrega prevista: "+this.$filters.dataHora(r.data.dataEntregaPrevista),"Produto olho direito: "+this._.get(r,"data.produto.olhoDireito",""),"Produto olho esquerdo: "+this._.get(r,"data.produto.olhoEsquerdo",""),"Id: "+this._.get(r,"data.id",""),"Id pedido otica: "+this._.get(r,"data.idPedidoOtica",""),"CNPJ otica: "+this._.get(r,"data.cnpjOtica",""),"Consumidor: "+this._.get(r,"data.consumidor.nome","")]}),o.next=25;break;case 22:o.prev=22,o.t0=o["catch"](0),this.$q.notifyError("Falha na consulta",o.t0);case 25:return o.prev=25,H["a"].hide(),o.finish(25);case 28:case"end":return o.stop()}},o,this,[[0,22,25,28]])}));return function(){return o.apply(this,arguments)}}(),eventoCancelar:function(){this.eventoInput(!1)},eventoInput:function(o){this.$emit("input",o)}},props:{value:{required:!0,type:Boolean},envelope:{required:!1,type:Object}},watch:{value:function(o){o&&(this.json={id:this.envelope.numeroOrdemCompra})}},created:function(){}},G=B,W=Object(C["a"])(G,x,w,!1,null,null,null);W.options.__file="EssilorConsultarPedido.vue";var Z=W.exports,Q=function(){var o=this,e=o.$createElement,t=o._self._c||e;return t("div",[t("q-modal",{attrs:{value:o.value,maximized:""},on:{input:o.eventoInput}},[t("q-modal-layout",{staticClass:"bg-grey-4"},[t("q-toolbar",{attrs:{slot:"header"},slot:"header"},[t("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"arrow_back",round:""}}),t("q-toolbar-title",[o._v("Consulta Pedidos Essilor")])],1),t("form",{on:{submit:function(e){return e.preventDefault(),o.eventoConfirmar(e)}}},[t("div",{staticClass:"layout-padding q-pa-none q-pb-xl"},[t("div",{staticClass:"u-container"},[t("q-card",{staticClass:"row bg-white q-px-lg q-py-sm q-mt-md no-shadow"},[t("campo",{staticClass:"col-12 q-pa-sm",attrs:{value:o.nomeEmpresa,rotulo:"Empresa",before:[{icon:"search",handler:o.abrirPromptEmitente}],"somente-leitura":""},on:{click:o.abrirPromptEmitente}}),t("PromptContatoNovo",{attrs:{filtro:{ativo:!0,empresas:!0}},on:{selecionar:o.selecionarEmitente},model:{value:o.promptEmitente,callback:function(e){o.promptEmitente=e},expression:"promptEmitente"}}),t("campo",{staticClass:"col-12 col-md-6 q-pa-sm",attrs:{opcoes:o.opcoesLaboratorio,"rotulo-fixo":"Laboratório",tipo:"seletor"},model:{value:o.codigoLaboratorio,callback:function(e){o.codigoLaboratorio=e},expression:"codigoLaboratorio"}}),t("campo",{staticClass:"col-12 col-md-6 q-pa-sm",attrs:{opcoes:o.opcoesAmbiente,"rotulo-fixo":"Ambiente",tipo:"seletor"},model:{value:o.ambiente,callback:function(e){o.ambiente=e},expression:"ambiente"}})],1),t("q-card",{staticClass:"row bg-white q-px-lg q-py-sm q-mt-md no-shadow"},[t("p",{staticClass:"col-12 q-title"},[o._v("Filtros")]),t("campo",{staticClass:"col-12 col-md-6 q-pa-sm",attrs:{rotulo:"Identificação do pedido no laboratório"},model:{value:o.json.id,callback:function(e){o.$set(o.json,"id",e)},expression:"json.id"}}),t("campo",{staticClass:"col-12 col-md-6 q-pa-sm",attrs:{rotulo:"Identificação do pedido na ótica"},model:{value:o.json.idPedidoOtica,callback:function(e){o.$set(o.json,"idPedidoOtica",e)},expression:"json.idPedidoOtica"}}),t("campo",{staticClass:"col-12 col-md-6 q-pa-sm",attrs:{rotulo:"Data início",tipo:"data"},model:{value:o.json.dataInicio,callback:function(e){o.$set(o.json,"dataInicio",e)},expression:"json.dataInicio"}}),t("campo",{staticClass:"col-12 col-md-6 q-pa-sm",attrs:{rotulo:"Data fim",tipo:"data"},model:{value:o.json.dataFim,callback:function(e){o.$set(o.json,"dataFim",e)},expression:"json.dataFim"}})],1)],1)]),t("q-toolbar",{attrs:{slot:"footer",color:"light"},slot:"footer"},[t("q-toolbar-title",{staticClass:"text-right"},[t("q-btn",{attrs:{flat:"",color:"primary",label:"Cancelar"},on:{click:o.eventoCancelar}}),t("q-btn",{attrs:{flat:"",color:"primary",type:"submit",label:"Enviar"}})],1)],1)],1)],1)],1),t("EssilorModalConfirmacao",{attrs:{modal:o.modalConfirma}}),t("EssilorModalResultado",{attrs:{modal:o.modalResultado}})],1)},X=[];Q._withStripped=!0;t("7514");var Y=t("3e8a"),K={components:{Campo:p["a"],EssilorModalConfirmacao:j,EssilorModalResultado:M,PromptContatoNovo:h["a"]},computed:{opcoesAmbiente:function(){return[{valor:"",rotulo:"Produção"},{valor:"dev/",rotulo:"Desenvolvimento"},{valor:"sandbox/",rotulo:"Sandbox"}]}},data:function(){return{ambiente:"dev/",codigoLaboratorio:null,contatosLaboratorio:[],idEmpresa:null,json:{},modalConfirma:{visivel:!1},modalResultado:{visivel:!1},nomeEmpresa:"",opcoesLaboratorio:[],promptEmitente:!1}},methods:{abrirPromptEmitente:function(){this.promptEmitente=!0},atualizar:function(){var o=d()(regeneratorRuntime.mark(function o(){var e,t,a;return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,U["a"].empresa.le();case 3:return e=o.sent,this.idEmpresa=e[0].idContato,this.nomeEmpresa=e[0].apelido,o.next=8,U["a"].configuracoes.leLista("compra.essilor.webservice");case 8:return t=o.sent,a=Object(f["unicos"])(t,"valor").map(function(o){return Number(o)}),o.next=12,Object(Y["a"])().contato.where("codigoContato").anyOf(a).toArray();case 12:this.contatosLaboratorio=o.sent,this.opcoesLaboratorio=this.contatosLaboratorio.map(function(o){return{valor:o.codigoContato,rotulo:o.apelido,sublabel:o.numeroDocumentoNacional}}),this.codigoLaboratorio=(this.contatosLaboratorio[0]||{}).codigoContato,o.next=20;break;case 17:o.prev=17,o.t0=o["catch"](0),this.$q.notifyError("Falha na consulta",o.t0);case 20:case"end":return o.stop()}},o,this,[[0,17]])}));return function(){return o.apply(this,arguments)}}(),selecionarEmitente:function(){var o=d()(regeneratorRuntime.mark(function o(e,t){return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:f["gconsole"].log("Essilor","selecionarEmitente()",e,t.apelido);try{e&&(this.idEmpresa=e,this.nomeEmpresa=t.apelido)}catch(o){this.$q.notifyError("Não foi possível carregar a empresa emitente",o)}case 2:case"end":return o.stop()}},o,this)}));return function(e,t){return o.apply(this,arguments)}}(),eventoConfirmar:function(){var o=d()(regeneratorRuntime.mark(function o(){var e,t,a=this;return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,f["gconsole"].log("EssilorConsultarPedidos","consultar",JSON.stringify(this.json,0,2)),Object(f["verificarErro"])(!this.idEmpresa,"Empresa não selecionada"),Object(f["verificarErro"])(!this.codigoLaboratorio,"Laboratório não selecionado"),e=this.contatosLaboratorio.find(function(o){return o.codigoContato===a.codigoLaboratorio}),Object(f["verificarErro"])(!e,"Laboratório não encontrado"),t=Object(f["filtrarDigitos"])(e.numeroDocumentoNacional),Object(f["verificarErro"])(!t,"Laboratório sem CNPJ"),o.next=10,U["a"].configuracoes.leLaboratorioEssilor(this.codigoLaboratorio,this.idEmpresa);case 10:this.modalConfirma={visivel:!0,eventoConfirmar:this.eventoConfirmar2,cnpjLaboratorio:t,titulo:"Consultar pedidos "+t,cor:"primary",json:JSON.stringify(this.json,0,2)},o.next=16;break;case 13:o.prev=13,o.t0=o["catch"](0),this.$q.notifyError("Falha na consulta",o.t0);case 16:case"end":return o.stop()}},o,this,[[0,13]])}));return function(){return o.apply(this,arguments)}}(),eventoConfirmar2:function(){var o=d()(regeneratorRuntime.mark(function o(){var e,t,a,r,i;return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,this.modalConfirma.visivel=!1,o.next=4,U["a"].configuracoes.leLaboratorioEssilor(this.codigoLaboratorio,this.idEmpresa);case 4:return e=o.sent,t=e.usuario,a=e.senha,H["a"].show({spinner:V["a"],spinnerColor:"amber",message:"Consultando pedidos"}),o.next=10,J.consultarPedidos(this.modalConfirma.cnpjLaboratorio,t,a,this.ambiente,JSON.parse(this.modalConfirma.json));case 10:r=o.sent,i=[200,201,206].includes(r.status),this.modalResultado={visivel:!0,titulo:"Lista de pedidos - status "+r.status,cor:i?"primary":"negative",resultado:JSON.stringify({data:r.data},0,2)},o.next=18;break;case 15:o.prev=15,o.t0=o["catch"](0),this.$q.notifyError("Falha na consulta",o.t0);case 18:return o.prev=18,H["a"].hide(),o.finish(18);case 21:case"end":return o.stop()}},o,this,[[0,15,18,21]])}));return function(){return o.apply(this,arguments)}}(),eventoCancelar:function(){f["gconsole"].log("EssilorConsultarPedidos","eventoCancelar"),this.eventoInput(!1)},eventoInput:function(o){this.$emit("input",o)}},props:{value:{required:!0,type:Boolean}},created:function(){this.atualizar()}},oo=K,eo=Object(C["a"])(oo,Q,X,!1,null,null,null);eo.options.__file="EssilorConsultarPedidos.vue";var to=eo.exports,ao=function(){var o=this,e=o.$createElement,t=o._self._c||e;return t("div",[t("q-modal",{attrs:{value:o.value,maximized:""},on:{input:o.eventoInput}},[t("q-modal-layout",{staticClass:"bg-grey-4"},[t("q-toolbar",{attrs:{slot:"header"},slot:"header"},[t("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"arrow_back",round:""}}),t("q-toolbar-title",[o._v("Consulta Status Pedido Essilor")])],1),t("form",{on:{submit:function(e){return e.preventDefault(),o.eventoConfirmar(e)}}},[t("div",{staticClass:"layout-padding q-pa-none q-pb-xl"},[t("div",{staticClass:"u-container"},[t("q-card",{staticClass:"row bg-white q-px-lg q-py-sm q-mt-md no-shadow"},[t("campo",{staticClass:"col-12 col-md-6 q-pa-sm",attrs:{opcoes:o.opcoesAmbiente,"rotulo-fixo":"Ambiente",tipo:"seletor"},model:{value:o.ambiente,callback:function(e){o.ambiente=e},expression:"ambiente"}})],1),t("q-card",{staticClass:"row bg-white q-px-lg q-py-sm q-mt-md no-shadow"},[t("p",{staticClass:"col-12 q-title"},[o._v("Filtros")]),t("campo",{staticClass:"col-12 col-md-6 q-pa-sm",attrs:{rotulo:"Identificação do pedido no laboratório"},model:{value:o.json.id,callback:function(e){o.$set(o.json,"id",e)},expression:"json.id"}})],1)],1)]),t("q-toolbar",{attrs:{slot:"footer",color:"light"},slot:"footer"},[t("q-toolbar-title",{staticClass:"text-right"},[t("q-btn",{attrs:{flat:"",color:"primary",label:"Cancelar"},on:{click:o.eventoCancelar}}),t("q-btn",{attrs:{flat:"",color:"primary",type:"submit",label:"Enviar"}})],1)],1)],1)],1)],1),t("EssilorModalConfirmacao",{attrs:{modal:o.modalConfirma}}),t("EssilorModalResultado",{attrs:{modal:o.modalResultado}})],1)},ro=[];ao._withStripped=!0;var io={components:{Campo:p["a"],EssilorModalConfirmacao:j,EssilorModalResultado:M},computed:{opcoesAmbiente:function(){return[{valor:"",rotulo:"Produção"},{valor:"dev/",rotulo:"Desenvolvimento"},{valor:"sandbox/",rotulo:"Sandbox"}]}},data:function(){return{ambiente:"dev/",codigoLaboratorio:null,contatosLaboratorio:[],idEmpresa:null,json:{},modalConfirma:{visivel:!1},modalResultado:{visivel:!1}}},methods:{eventoConfirmar:function(){var o=d()(regeneratorRuntime.mark(function o(){var e;return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,f["gconsole"].log("EssilorConsultarPedido","consultar",JSON.stringify(this.json,0,2)),Object(f["verificarErro"])(!this.json.id,"Pedido nao informado"),Object(f["verificarErro"])(!this.envelope.idEmpresa,"Empresa não selecionada"),Object(f["verificarErro"])(!this.envelope.codigoLaboratorio,"Laboratório não selecionado"),e=this.envelope.cnpjLaboratorio,Object(f["verificarErro"])(!e,"Laboratório sem CNPJ"),o.next=9,U["a"].configuracoes.leLaboratorioEssilor(this.envelope.codigoLaboratorio,this.envelope.idEmpresa);case 9:this.modalConfirma={visivel:!0,eventoConfirmar:this.eventoConfirmar2,cnpjLaboratorio:e,titulo:"Consultar status do pedido "+e,cor:"primary",json:this.json.id},o.next=15;break;case 12:o.prev=12,o.t0=o["catch"](0),this.$q.notifyError("Falha na consulta",o.t0);case 15:case"end":return o.stop()}},o,this,[[0,12]])}));return function(){return o.apply(this,arguments)}}(),eventoConfirmar2:function(){var o=d()(regeneratorRuntime.mark(function o(){var e,t,a,r,i;return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,this.modalConfirma.visivel=!1,o.next=4,U["a"].configuracoes.leLaboratorioEssilor(this.envelope.codigoLaboratorio,this.envelope.idEmpresa);case 4:return e=o.sent,t=e.usuario,a=e.senha,H["a"].show({spinner:V["a"],spinnerColor:"amber",message:"Consultando status pedido"}),o.next=10,J.consultarStatusPedido(this.modalConfirma.cnpjLaboratorio,t,a,this.ambiente,this.modalConfirma.json);case 10:r=o.sent,i=[200,201,206].includes(r.status),this.modalResultado={visivel:!0,titulo:"Resultado Status do Pedido - status "+r.status,cor:i?"primary":"negative",resultado:JSON.stringify({data:r.data},0,2)},o.next=18;break;case 15:o.prev=15,o.t0=o["catch"](0),this.$q.notifyError("Falha na consulta",o.t0);case 18:return o.prev=18,H["a"].hide(),o.finish(18);case 21:case"end":return o.stop()}},o,this,[[0,15,18,21]])}));return function(){return o.apply(this,arguments)}}(),eventoCancelar:function(){this.eventoInput(!1)},eventoInput:function(o){this.$emit("input",o)}},props:{value:{required:!0,type:Boolean},envelope:{required:!1,type:Object}},watch:{value:function(o){o&&(this.json={id:this.envelope.id})}},created:function(){}},so=io,no=Object(C["a"])(so,ao,ro,!1,null,null,null);no.options.__file="EssilorConsultarStatusPedido.vue";var lo=no.exports,co=function(){var o=this,e=o.$createElement,t=o._self._c||e;return t("div",[t("q-modal",{attrs:{value:o.value,maximized:""},on:{input:o.eventoInput}},[t("q-modal-layout",{staticClass:"bg-grey-4"},[t("q-toolbar",{attrs:{slot:"header"},slot:"header"},[t("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"arrow_back",round:""}}),t("q-toolbar-title",[o._v("Pedido ao Laboratorio Essilor")])],1),o.dados.envelope?t("form",{on:{submit:function(e){return e.preventDefault(),o.eventoConfirmar(e)}}},[t("div",{staticClass:"layout-padding q-pa-none q-pb-xl"},[t("div",{staticClass:"u-container"},[t("div",{staticClass:"row bg-white round-borders q-mt-none q-pa-md"},[t("div",{staticClass:"col-12 q-pa-sm q-my-md"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-auto q-mr-md"},[t("span",{staticClass:"q-caption text-weight-bold q-mr-sm"},[o._v("Paciente")]),t("span",{staticClass:"q-caption"},[o._v(o._s(o._.get(o.dados,"envelope.nomeCliente")))])]),t("div",{staticClass:"col-auto q-mr-md"},[t("span",{staticClass:"q-caption text-weight-bold q-mr-sm"},[o._v("Laboratório")]),t("span",{staticClass:"q-caption"},[o._v(o._s(o._.get(o.dados,"envelope.nomeLaboratorio")))])])])]),t("campo",{staticClass:"col-12 col-md-4 q-pr-md",attrs:{maxlength:"100","rotulo-fixo":"Código do pedido da ótica"},model:{value:o.dados.json.idPedidoOtica,callback:function(e){o.$set(o.dados.json,"idPedidoOtica","string"===typeof e?e.trim():e)},expression:"dados.json.idPedidoOtica"}}),t("campo",{staticClass:"col-12 col-md-4",attrs:{opcoes:o.opcoesAmbiente,"rotulo-fixo":"Ambiente",tipo:"seletor"},model:{value:o.ambiente,callback:function(e){o.ambiente=e},expression:"ambiente"}}),t("q-toggle",{staticClass:"col-12 col-md-4 q-pa-md",attrs:{label:"Mostrar Json"},model:{value:o.mostrarJson,callback:function(e){o.mostrarJson=e},expression:"mostrarJson"}}),t("campo",{staticClass:"col-12",attrs:{maxlength:"50","rotulo-fixo":"Observação"},model:{value:o.dados.json.observacao,callback:function(e){o.$set(o.dados.json,"observacao","string"===typeof e?e.trim():e)},expression:"dados.json.observacao"}})],1),o._l(["olhoDireito","olhoEsquerdo"],function(e){return t("div",{key:e,staticClass:"row bg-white round-borders q-mt-md q-pa-md"},[t("p",{staticClass:"col-12 q-title"},[o._v("\n                "+o._s("olhoDireito"===e?"Olho direito":"Olho esquerdo"))]),t("q-table",{staticClass:"col-12 no-shadow",attrs:{data:o.listaReceita[e],columns:o.colunasReceita,"row-key":"name",separator:"cell",dense:"","hide-bottom":""},scopedSlots:o._u([{key:"header",fn:function(e){return t("q-tr",{},[t("q-th",{key:"distancia",staticStyle:{"min-width":"110px","max-width":"110px"},attrs:{props:e}}),t("q-th",{key:"adicao",attrs:{props:e}},[o._v("Adição")]),t("q-th",{key:"esferico",attrs:{props:e}},[o._v("Esférico")]),t("q-th",{key:"cilindrico",attrs:{props:e}},[o._v("Cilíndrico")]),t("q-th",{key:"eixo",attrs:{props:e}},[o._v("Eixo")]),t("q-th",{key:"prisma",attrs:{props:e}},[o._v("Prisma")]),t("q-th",{key:"base",attrs:{props:e}},[o._v("Base")]),t("q-th",{key:"dnp",attrs:{props:e}},[o._v("DNP")])],1)}},{key:"body",fn:function(e){return[t("q-tr",{attrs:{props:e}},[t("q-td",{key:"distancia",attrs:{props:e}},[o._v(o._s(e.row.distancia))]),t("q-td",{key:"adicao",attrs:{props:e}},[o._v(o._s(o._f("numeroSinal")(e.row.adicao,2,"-")))]),t("q-td",{key:"esferico",attrs:{props:e}},[o._v(o._s(o._f("numeroSinal")(e.row.grauEsferico,2,"-")))]),t("q-td",{key:"cilindrico",attrs:{props:e}},[o._v(o._s(o._f("numeroSinal")(e.row.grauCilindro,2,"-")))]),t("q-td",{key:"eixo",attrs:{props:e}},[o._v(o._s(e.row.eixo))]),t("q-td",{key:"prisma",attrs:{props:e}},[o._v(o._s(e.row.valorPrismaHorizontal))]),t("q-td",{key:"base",attrs:{props:e}},[o._v(o._s(e.row.eixoPrismaHorizontal))]),t("q-td",{key:"dnp",attrs:{props:e}},[o._v(o._s(o._f("numero")(e.row.dnp,2,"-")))])],1)]}}])}),t("div",{staticClass:"col-12 q-pa-sm q-my-md"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-auto q-mr-md"},[t("span",{staticClass:"q-caption text-weight-bold q-mr-sm"},[o._v("Lente")]),t("span",{staticClass:"q-caption"},[o._v(o._s(o._.get(o.dados,"envelope."+e+".descricaoConcatenada")))])]),t("div",{staticClass:"col-auto q-mr-md"},[t("span",{staticClass:"q-caption text-weight-bold q-mr-sm"},[o._v("Código")]),t("span",{staticClass:"q-caption"},[o._v(o._s(o._.get(o.dados,"envelope."+e+".codigoItem")))])]),t("div",{staticClass:"col-auto q-mr-md"},[t("span",{staticClass:"q-caption text-weight-bold q-mr-sm"},[o._v("Referência")]),t("span",{staticClass:"q-caption"},[o._v(o._s(o._.get(o.dados,"envelope."+e+".referencia")))])]),t("div",{staticClass:"col-auto q-mr-md"},[t("span",{staticClass:"q-caption text-weight-bold q-mr-sm"},[o._v("Tipo")]),t("span",{staticClass:"q-caption"},[o._v(o._s(o._.get(o.dados,"envelope."+e+".lenteTipo")))])]),t("div",{staticClass:"col-auto q-mr-md"},[t("span",{staticClass:"q-caption text-weight-bold q-mr-sm"},[o._v("Custo")]),t("span",{staticClass:"q-caption"},[o._v(o._s(o._f("numero")(o._.get(o.dados,"envelope."+e+".valorCusto"),2)))])]),t("div",{staticClass:"col-auto q-mr-md"},[t("span",{staticClass:"q-caption text-weight-bold q-mr-sm"},[o._v("Venda")]),t("span",{staticClass:"q-caption"},[o._v(o._s(o._f("numero")(o._.get(o.dados,"envelope."+e+".total"),2)))])])])]),t("p",{staticClass:"col-12 q-title"},[o._v("Vínculo Lente Essilor")]),"olhoEsquerdo"===e?t("div",{staticClass:"col-12"},[t("q-btn",{staticClass:"no-shadow",attrs:{color:"primary",icon:"redo",label:"Copiar OD > OE"},on:{click:o.copiarOdParaOe}})],1):o._e(),t("campo",{staticClass:"col-12 col-md-3 q-pa-sm",attrs:{opcoes:o.opcoesProdutoEssilor[e],"rotulo-fixo":"Tipo produto",tipo:"seletor"},on:{input:function(t){o.selecionarLenteEssilor(e)}},model:{value:o.dados[e].tipoProdutoEssilor,callback:function(t){o.$set(o.dados[e],"tipoProdutoEssilor",t)},expression:"dados[olho].tipoProdutoEssilor"}}),t("campo",{staticClass:"col-12 col-md-3 q-pa-sm",attrs:{opcoes:o.opcoesProducaoEssilor,"rotulo-fixo":"Tipo produção",tipo:"seletor"},on:{input:function(t){o.selecionarLenteEssilor(e)}},model:{value:o.dados[e].tipoProducaoEssilor,callback:function(t){o.$set(o.dados[e],"tipoProducaoEssilor",t)},expression:"dados[olho].tipoProducaoEssilor"}}),(o.dados[e].opcoesProdutos||[]).length?t("campo",{staticClass:"col-12 col-md-6 q-pa-sm",attrs:{opcoes:o.dados[e].opcoesProdutos,"rotulo-fixo":"Produto",tipo:"seletor",filter:""},on:{input:function(t){o.selecionarProdutoEssilor(e)}},model:{value:o.dados[e].produtoEssilor,callback:function(t){o.$set(o.dados[e],"produtoEssilor",t)},expression:"dados[olho].produtoEssilor"}}):o._e(),o.dados[e].detalheProduto.detalheProduto?t("ArvoreJson",{staticClass:"col-12 q-pa-sm",attrs:{json:o.dados[e].detalheProduto}}):o._e(),"olhoDireito"===e?o._l(o._.get(o.dados,"envelope."+e+".tratamentos"),function(a,r){return t("div",{key:r,staticClass:"col-12 q-pa-sm q-my-md"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-auto q-mr-md"},[t("span",{staticClass:"q-caption text-weight-bold q-mr-sm"},[o._v("Tratamento")]),t("span",{staticClass:"q-caption"},[o._v(o._s(o._.get(a,"descricaoConcatenada")))])]),t("div",{staticClass:"col-auto q-mr-md"},[t("span",{staticClass:"q-caption text-weight-bold q-mr-sm"},[o._v("Código")]),t("span",{staticClass:"q-caption"},[o._v(o._s(o._.get(a,"codigoItem")))])]),t("div",{staticClass:"col-auto q-mr-md"},[t("span",{staticClass:"q-caption text-weight-bold q-mr-sm"},[o._v("Referência")]),t("span",{staticClass:"q-caption"},[o._v(o._s(o._.get(a,"referencia")))])]),t("div",{staticClass:"col-auto q-mr-md"},[t("span",{staticClass:"q-caption text-weight-bold q-mr-sm"},[o._v("Custo")]),t("span",{staticClass:"q-caption"},[o._v(o._s(o._f("numero")(o._.get(a,"valorCusto"),2)))])]),t("div",{staticClass:"col-auto q-mr-md"},[t("span",{staticClass:"q-caption text-weight-bold q-mr-sm"},[o._v("Venda")]),t("span",{staticClass:"q-caption"},[o._v(o._s(o._f("numero")(o._.get(a,"total"),2)))])])]),t("div",{staticClass:"row"},[(o.dados[e].opcoesTratamentos||[]).length?t("campo",{staticClass:"col-12 col-md-6 q-pa-sm",attrs:{opcoes:o.dados[e].opcoesTratamentos,"rotulo-fixo":"Vínculo Essilor",tipo:"seletor"},model:{value:a.produtoEssilor,callback:function(e){o.$set(a,"produtoEssilor",e)},expression:"tratamento.produtoEssilor"}}):o._e()],1)])}):o._e()],2)}),t("div",{staticClass:"row bg-white round-borders q-mt-md q-pa-md"},[t("p",{staticClass:"col-12 q-title"},[o._v("Armação")]),t("campo",{staticClass:"col-12 col-md-2 q-pr-md",attrs:{tipo:"decimal",decimals:"2",rotulo:"Altura (vertical)"},model:{value:o.dados.json.armacao.vertical,callback:function(e){o.$set(o.dados.json.armacao,"vertical",e)},expression:"dados.json.armacao.vertical"}}),t("campo",{staticClass:"col-12 col-md-2 q-pr-md",attrs:{tipo:"decimal",decimals:"2",rotulo:"Diagonal (horizontal)"},model:{value:o.dados.json.armacao.horizontal,callback:function(e){o.$set(o.dados.json.armacao,"horizontal",e)},expression:"dados.json.armacao.horizontal"}}),t("campo",{staticClass:"col-12 col-md-2 q-pr-md",attrs:{tipo:"decimal",decimals:"2",rotulo:"Ponte"},model:{value:o.dados.json.armacao.ponte,callback:function(e){o.$set(o.dados.json.armacao,"ponte",e)},expression:"dados.json.armacao.ponte"}}),t("campo",{staticClass:"col-12 col-md-2 q-pr-md",attrs:{tipo:"decimal",decimals:"2",rotulo:"Diagonal (diâmetro maior)"},model:{value:o.dados.json.armacao.diametroMaior,callback:function(e){o.$set(o.dados.json.armacao,"diametroMaior",e)},expression:"dados.json.armacao.diametroMaior"}}),t("campo",{staticClass:"ccol-12 col-md-2 q-pr-md",attrs:{opcoes:o.opcoesTipoMontagem,"rotulo-fixo":"Tipo montagem",tipo:"seletor"},model:{value:o.dados.json.armacao.tipo,callback:function(e){o.$set(o.dados.json.armacao,"tipo",e)},expression:"dados.json.armacao.tipo"}})],1)],2)]),t("q-toolbar",{attrs:{slot:"footer",color:"light"},slot:"footer"},[t("q-toolbar-title",{staticClass:"text-right"},[t("q-btn",{attrs:{flat:"",color:"primary",label:"Cancelar"},on:{click:o.eventoCancelar}}),t("q-btn",{attrs:{flat:"",color:"primary",type:"submit",label:"Enviar"}})],1)],1)],1):o._e()],1)],1),t("EssilorModalConfirmacao",{attrs:{modal:o.modalConfirma}}),t("EssilorModalResultado",{attrs:{modal:o.modalResultado}})],1)},uo=[];co._withStripped=!0;var po=function(){var o=this,e=o.$createElement,t=o._self._c||e;return t("q-tree",{attrs:{nodes:o.arvore,"node-key":"label"}})},mo=[];po._withStripped=!0;var vo={components:{},data:function(){return{arvore:{}}},methods:{montarArvore:function(o){var e=[];for(var t in o){var a={label:t};if(o[t].constructor===Object)a.children=this.montarArvore(o[t]);else if(o[t].constructor===Array)for(var r in a.children=[],o[t])a.children.push({label:o[t][r].descricao||String(r),children:this.montarArvore(o[t][r])});else a={label:t+": "+String(o[t])};e.push(a)}return e}},props:{json:{required:!0,type:Object}},watch:{},created:function(){this.arvore=this.montarArvore(this.json),f["gconsole"].log("ArvoreJson",this.json,this.arvore)}},ho=vo,fo=Object(C["a"])(ho,po,mo,!1,null,null,null);fo.options.__file="ArvoreJson.vue";var go=fo.exports,bo={baseURL:"https://api.essilor.com.br"},Co={consultarProdutos:function(){var o=d()(regeneratorRuntime.mark(function o(e,t,a,r,i){var s,n;return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,T.obterJwtToken(t,a,r);case 3:return s=o.sent,s.laboratorio=e,o.next=7,I()({method:"get",baseURL:bo.baseURL,url:r+"gestao-produtos-laboratorio/v1/produtos",validateStatus:function(o){return o>=200&&o<=500},timeout:1e4,headers:s,params:i});case 7:return n=o.sent,f["gconsole"].log("essilor","consultarProdutos",{params:i,resposta:n}),o.abrupt("return",n);case 12:throw o.prev=12,o.t0=o["catch"](0),f["gconsole"].error("essilor","consultarProdutos erro\n",o.t0.stack),o.t0;case 16:case"end":return o.stop()}},o,null,[[0,12]])}));return function(e,t,a,r,i){return o.apply(this,arguments)}}(),consultarProduto:function(){var o=d()(regeneratorRuntime.mark(function o(e,t,a,r,i){var s,n;return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,T.obterJwtToken(t,a,r);case 3:return s=o.sent,s.laboratorio=e,o.next=7,I()({method:"get",baseURL:bo.baseURL,url:r+"gestao-produtos-laboratorio/v1/produtos/".concat(i,"/parametros"),validateStatus:function(o){return o>=200&&o<=500},timeout:1e4,headers:s});case 7:return n=o.sent,f["gconsole"].log("essilor","consultarProduto",{id:i,resposta:n}),o.abrupt("return",n);case 12:throw o.prev=12,o.t0=o["catch"](0),f["gconsole"].error("essilor","consultarProduto erro\n",o.t0.stack),o.t0;case 16:case"end":return o.stop()}},o,null,[[0,12]])}));return function(e,t,a,r,i){return o.apply(this,arguments)}}()},Eo={components:{ArvoreJson:go,Campo:p["a"],EssilorModalConfirmacao:j,EssilorModalResultado:M},computed:{colunasReceita:function(){return[{name:"distancia",align:"left",field:"distancia",style:"font-weight:bold;min-width:110px"},{name:"adicao",align:"center",field:"adicao"},{name:"esferico",align:"center",field:"grauEsferico"},{name:"cilindrico",align:"center",field:"grauCilindro"},{name:"eixo",align:"center",field:"eixo"},{name:"prisma",align:"center",field:"prisma"},{name:"base",align:"center",field:"base"},{name:"dnp",align:"center",field:"dnp"}]},opcoesAmbiente:function(){return[{valor:"",rotulo:"Produção"},{valor:"dev/",rotulo:"Desenvolvimento"},{valor:"sandbox/",rotulo:"Sandbox"}]},opcoesProducaoEssilor:function(){return[{valor:"",rotulo:""},{valor:"SURFACAGEM_DIGITAL",rotulo:"Surfacagem digital"},{valor:"SURFACAGEM_TRADICIONAL",rotulo:"Surfacagem tradicional"},{valor:"LENTES_PRONTA",rotulo:"Lentes pronta"}]}},data:function(){return{ambiente:"dev/",listaReceita:{},modalConfirma:{visivel:!1},modalResultado:{visivel:!1},mostrarJson:!1,opcoesProdutoEssilor:{olhoDireito:[],olhoEsquerdo:[]},opcoesTipoMontagem:[]}},methods:{atualizar:function(){var o=d()(regeneratorRuntime.mark(function o(){var e,t,a;return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,Object(f["verificarErro"])(!this.dados.envelope.cnpjLaboratorio,"Laboratório sem CNPJ"),o.next=4,U["a"].configuracoes.leLaboratorioEssilor(this.dados.envelope.codigoLaboratorio,this.dados.envelope.idEmpresa);case 4:e=this.dados.json.receita,t=this.dados.json.parametros,a={"Multifocal (Longe e Perto)":{longe:"Longe",perto:"Perto"},"Monofocal (Longe)":{longe:"Longe",perto:""},"Monofocal (Médio)":{longe:"Médio",perto:""},"Monofocal (Perto)":{longe:"Perto",perto:""},"Intermediário (Médio e Perto)":{longe:"Médio",perto:"Perto"},"Intermediário (Longe e Médio)":{longe:"Longe",perto:"Médio"},"Bifocal (Longe e Perto)":{longe:"Longe",perto:"Perto"}},this.listaReceita={olhoDireito:[l()({},e.olhoDireito,{adicao:void 0,distancia:a[this.dados.envelope.armacao.oculos].longe}),{adicao:e.olhoDireito.adicao,dnp:t.olhoDireito.dnpPerto,distancia:a[this.dados.envelope.armacao.oculos].perto}],olhoEsquerdo:[l()({},e.olhoEsquerdo,{adicao:void 0,distancia:a[this.dados.envelope.armacao.oculos].longe}),{adicao:e.olhoEsquerdo.adicao,dnp:t.olhoEsquerdo.dnpPerto,distancia:a[this.dados.envelope.armacao.oculos].perto}]},this.opcoesProdutoEssilor={olhoDireito:this.mapearTipoLente(this.dados.envelope.armacao.oculos),olhoEsquerdo:this.mapearTipoLente(this.dados.envelope.armacao.oculos)},this.dados.olhoDireito.tipoProdutoEssilor=this.opcoesProdutoEssilor.olhoDireito[0].valor,this.dados.olhoEsquerdo.tipoProdutoEssilor=this.opcoesProdutoEssilor.olhoEsquerdo[0].valor,o.next=17;break;case 13:o.prev=13,o.t0=o["catch"](0),this.$q.notifyError("Falha na consulta",o.t0),this.eventoInput(!1);case 17:case"end":return o.stop()}},o,this,[[0,13]])}));return function(){return o.apply(this,arguments)}}(),mapearTipoLente:function(o){return{"Multifocal (Longe e Perto)":[{valor:"MULTIFOCAL",rotulo:"Multifocal"}],"Monofocal (Longe)":[{valor:"VISAO_SIMPLES",rotulo:"Visao simples"}],"Monofocal (Médio)":[{valor:"VISAO_SIMPLES",rotulo:"Visao simples"}],"Monofocal (Perto)":[{valor:"VISAO_SIMPLES",rotulo:"Visao simples"}],"Intermediário (Médio e Perto)":[{valor:"VISAO_INTERMEDIARIA",rotulo:"Visão intermediária"}],"Intermediário (Longe e Médio)":[{valor:"VISAO_INTERMEDIARIA",rotulo:"Visão intermediária"}],"Bifocal (Longe e Perto)":[{valor:"BIFOCAL",rotulo:"Bifocal"}]}[o]||[{valor:"MULTIFOCAL",rotulo:"Multifocal"},{valor:"VISAO_SIMPLES",rotulo:"Visao simples"},{valor:"VISAO_INTERMEDIARIA",rotulo:"Visão intermediária"},{valor:"BIFOCAL",rotulo:"Bifocal"}]},copiarOdParaOe:function(){this.dados.olhoEsquerdo.detalheProduto=this.dados.olhoDireito.detalheProduto,this.dados.olhoEsquerdo.opcoesProdutos=this.dados.olhoDireito.opcoesProdutos,this.dados.olhoEsquerdo.tipoProdutoEssilor=this.dados.olhoDireito.tipoProdutoEssilor,this.dados.olhoEsquerdo.tipoProducaoEssilor=this.dados.olhoDireito.tipoProducaoEssilor,this.dados.olhoEsquerdo.produtoEssilor=this.dados.olhoDireito.produtoEssilor,this.dados.json.receita.olhoEsquerdo.codigoLinhaProduto=this.dados.json.receita.olhoDireito.codigoLinhaProduto,this.dados.json.receita.olhoEsquerdo.tipoProducao=this.dados.json.receita.olhoDireito.tipoProducao,this.dados.json.receita.olhoEsquerdo.tipoProduto=this.dados.json.receita.olhoDireito.tipoProduto},eventoConfirmar:function(){var o=d()(regeneratorRuntime.mark(function o(){var e,t,a,r,i,s,n,l=this;return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:for(o.prev=0,Object(f["verificarErro"])(!this.dados.json.receita.olhoDireito.codigoLinhaProduto,"Lente direira sem produto selecionado"),this.dados.json.receita.olhoEsquerdo.codigoLinhaProduto||(this.dados.json.receita.olhoEsquerdo.codigoLinhaProduto=this.dados.json.receita.olhoDireito.codigoLinhaProduto,this.dados.json.receita.olhoEsquerdo.tipoProducao=this.dados.json.receita.olhoDireito.tipoProducao,this.dados.json.receita.olhoEsquerdo.tipoProduto=this.dados.json.receita.olhoDireito.tipoProduto),e=!0,t=!1,a=void 0,o.prev=6,r=function(){var o=s.value;Object(f["verificarErro"])(!o.produtoEssilor,"Tratamento lente direira nao selecionado");var e=l.dados.olhoDireito.detalheProduto.detalheProduto.servicos.find(function(e){return e.codigo===o.produtoEssilor});l.dados.json.servicos.push(e)},i=this.dados.envelope.olhoDireito.tratamentos[Symbol.iterator]();!(e=(s=i.next()).done);e=!0)r();o.next=15;break;case 11:o.prev=11,o.t0=o["catch"](6),t=!0,a=o.t0;case 15:o.prev=15,o.prev=16,e||null==i.return||i.return();case 18:if(o.prev=18,!t){o.next=21;break}throw a;case 21:return o.finish(18);case 22:return o.finish(15);case 23:n=this.dados.json.armacao,delete n.__index,n.vertical=String(n.vertical),n.horizontal=String(n.horizontal),n.ponte=String(n.ponte),n.diametroMaior=String(n.diametroMaior),n.tipo=String(n.tipo),this.modalConfirma={visivel:this.mostrarJson,eventoConfirmar:this.eventoConfirmar2,titulo:"Envio pedido laboratorio "+this.dados.envelope.cnpjLaboratorio,cor:"primary",json:JSON.stringify(this.dados.json,0,2)},this.mostrarJson||this.modalConfirma.eventoConfirmar(),o.next=37;break;case 34:o.prev=34,o.t1=o["catch"](0),this.$q.notifyError("Falha no envio",o.t1);case 37:case"end":return o.stop()}},o,this,[[0,34],[6,11,15,23],[16,,18,22]])}));return function(){return o.apply(this,arguments)}}(),eventoConfirmar2:function(){var o=d()(regeneratorRuntime.mark(function o(){var e,t,a,r,i,s,n,l,c,d,u,p;return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,this.modalConfirma.visivel=!1,o.next=4,U["a"].configuracoes.leLaboratorioEssilor(this.dados.envelope.codigoLaboratorio,this.dados.envelope.idEmpresa);case 4:return e=o.sent,t=e.usuario,a=e.senha,H["a"].show({spinner:V["a"],spinnerColor:"amber",message:"Enviando pedido"}),o.next=10,J.adicionar(this.dados.envelope.cnpjLaboratorio,t,a,this.ambiente,JSON.parse(this.modalConfirma.json));case 10:if(r=o.sent,i=[200,201,206].includes(r.status),this.modalResultado={visivel:this.mostrarJson,titulo:"Resposta status "+r.status,cor:i?"primary":"negative",resultado:JSON.stringify({data:r.data},0,2)},i){o.next=19;break}return s=((r.data||[])[0]||{}).mensagem,Object(f["verificarErro"])(!s,"Erro no envio do pedido"),n=r.data.map(function(o){return o.mensagem+" (código: "+(o.codigo||"")+")"}),this.$utils.eventos.$emit("mostrarModalAlerta",{titulo:"Erro",erros:n}),o.abrupt("return");case 19:return l=r.data.orcamento,c=l.dataEntregaPrevista||l.prazo,d=Number(l.valorBruto)||0,u=Number(l.desconto)||0,p=Number(l.valorLiquido)||d-u,this.$utils.eventos.$emit("mostrarModalSucesso",{titulo:"Pedido enviado com sucesso",mensagens:["id: "+r.data.id,"Entrega prevista: "+this.$filters.data(c),"Valor bruto: "+this.$filters.numero(d,2),"Desconto: "+this.$filters.numero(u,2),"Valor líquido: "+this.$filters.numero(p,2)]}),Object(f["verificarErro"])(!r.data.id,"Sem retorno do identificador do pedido"),o.next=28,this.$utils.executarSql("update documento set numeroOrdemCompra=".concat(this.$utils.sqlStr(r.data.id)," where codigoDocumento=").concat(this.$utils.sqlNum(this.dados.envelope.codigoDocumento)));case 28:o.next=33;break;case 30:o.prev=30,o.t0=o["catch"](0),this.$q.notifyError("Falha no envio",o.t0);case 33:return o.prev=33,H["a"].hide(),o.finish(33);case 36:case"end":return o.stop()}},o,this,[[0,30,33,36]])}));return function(){return o.apply(this,arguments)}}(),eventoCancelar:function(){f["gconsole"].log("EssilorPedidoLaboratorio","eventoCancelar",this.dados),this.eventoInput(!1)},eventoInput:function(o){this.$emit("input",o)},selecionarLenteEssilor:function(){var o=d()(regeneratorRuntime.mark(function o(e){return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:if(o.prev=0,this.dados[e].tipoProducaoEssilor&&this.dados[e].tipoProdutoEssilor){o.next=5;break}return this.dados[e].detalheProduto={},this.dados[e].opcoesProdutos=[],o.abrupt("return");case 5:this.modalConfirma={visivel:this.mostrarJson,eventoConfirmar:this.selecionarLenteEssilor2,olho:e,titulo:"Consultar produtos "+this.dados.envelope.cnpjLaboratorio,cor:"primary",json:JSON.stringify({tipoProducao:this.dados[e].tipoProducaoEssilor,tipoProduto:this.dados[e].tipoProdutoEssilor},0,2)},this.mostrarJson||this.modalConfirma.eventoConfirmar(),o.next=12;break;case 9:o.prev=9,o.t0=o["catch"](0),this.$q.notifyError("Falha na consulta",o.t0);case 12:case"end":return o.stop()}},o,this,[[0,9]])}));return function(e){return o.apply(this,arguments)}}(),selecionarLenteEssilor2:function(){var o=d()(regeneratorRuntime.mark(function o(){var e,t,a,r,i,s;return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,this.modalConfirma.visivel=!1,e=this.modalConfirma.olho,o.next=5,U["a"].configuracoes.leLaboratorioEssilor(this.dados.envelope.codigoLaboratorio,this.dados.envelope.idEmpresa);case 5:return t=o.sent,a=t.usuario,r=t.senha,H["a"].show({spinner:V["a"],spinnerColor:"amber",message:"Consultando produtos"}),o.next=11,Co.consultarProdutos(this.dados.envelope.cnpjLaboratorio,a,r,this.ambiente,JSON.parse(this.modalConfirma.json));case 11:if(i=o.sent,s=[200,201,206].includes(i.status),this.modalResultado={visivel:this.mostrarJson,titulo:"Resposta status "+i.status,cor:s?"primary":"negative",resultado:JSON.stringify({data:i.data},0,2)},s){o.next=18;break}return this.dados[e].detalheProduto={},this.dados[e].opcoesProdutos=[],o.abrupt("return");case 18:this.dados[e].opcoesProdutos=i.data.map(function(o){return{rotulo:o.descricao+" - "+o.codigo,valor:o.codigo}}),Object(f["verificarErro"])(!this.dados[e].opcoesProdutos.length,"Não encontrado produtos para os critérios selecionados"),o.next=25;break;case 22:o.prev=22,o.t0=o["catch"](0),this.$q.notifyError("Falha na consulta",o.t0);case 25:return o.prev=25,H["a"].hide(),o.finish(25);case 28:case"end":return o.stop()}},o,this,[[0,22,25,28]])}));return function(){return o.apply(this,arguments)}}(),selecionarProdutoEssilor:function(){var o=d()(regeneratorRuntime.mark(function o(e){return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:if(o.prev=0,this.dados[e].produtoEssilor){o.next=5;break}return this.dados[e].detalheProduto={},this.dados[e].opcoesTratamentos=[],o.abrupt("return");case 5:this.dados.json.receita[e].codigoLinhaProduto=this.dados[e].produtoEssilor,this.dados.json.receita[e].tipoProducao=this.dados[e].tipoProducaoEssilor,this.dados.json.receita[e].tipoProduto=this.dados[e].tipoProdutoEssilor,this.modalConfirma={visivel:this.mostrarJson,eventoConfirmar:this.selecionarProdutoEssilor2,olho:e,titulo:"Consultar produto "+this.dados.envelope.cnpjLaboratorio,cor:"primary",json:this.dados[e].produtoEssilor},this.mostrarJson||this.modalConfirma.eventoConfirmar(),o.next=15;break;case 12:o.prev=12,o.t0=o["catch"](0),this.$q.notifyError("Falha na consulta",o.t0);case 15:return o.prev=15,H["a"].hide(),o.finish(15);case 18:case"end":return o.stop()}},o,this,[[0,12,15,18]])}));return function(e){return o.apply(this,arguments)}}(),selecionarProdutoEssilor2:function(){var o=d()(regeneratorRuntime.mark(function o(){var e,t,a,r,i,s;return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,this.modalConfirma.visivel=!1,e=this.modalConfirma.olho,o.next=5,U["a"].configuracoes.leLaboratorioEssilor(this.dados.envelope.codigoLaboratorio,this.dados.envelope.idEmpresa);case 5:return t=o.sent,a=t.usuario,r=t.senha,H["a"].show({spinner:V["a"],spinnerColor:"amber",message:"Consultando produto"}),o.next=11,Co.consultarProduto(this.dados.envelope.cnpjLaboratorio,a,r,this.ambiente,this.modalConfirma.json);case 11:if(i=o.sent,s=[200,201,206].includes(i.status),this.modalResultado={visivel:this.mostrarJson,titulo:"Resposta status "+i.status,cor:s?"primary":"negative",resultado:JSON.stringify({data:i.data},0,2)},s){o.next=18;break}return this.dados[e].detalheProduto={},this.dados[e].opcoesTratamentos=[],o.abrupt("return");case 18:this.dados[e].detalheProduto={detalheProduto:i.data},this.dados[e].opcoesTratamentos=i.data.servicos.map(function(o){return{rotulo:o.tipo+" - "+o.descricao+" - "+o.codigo,valor:o.codigo}}),this.opcoesTipoMontagem=i.data.armacao.tipo.dominio.map(function(o){return{rotulo:o.codigo+" - "+o.descricao,valor:o.codigo}}),o.next=26;break;case 23:o.prev=23,o.t0=o["catch"](0),this.$q.notifyError("Falha na consulta",o.t0);case 26:return o.prev=26,H["a"].hide(),o.finish(26);case 29:case"end":return o.stop()}},o,this,[[0,23,26,29]])}));return function(){return o.apply(this,arguments)}}()},props:{value:{required:!0,type:Boolean},dados:{required:!0,type:Object}},watch:{value:function(o){o&&this.atualizar()}}},qo=Eo,xo=Object(C["a"])(qo,co,uo,!1,null,null,null);xo.options.__file="EssilorPedidoLaboratorio.vue";var wo=xo.exports,Po=t("e970"),Lo=t("310e"),yo=t.n(Lo);function _o(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,t=Number(o)>0?"+":"";return t+(Number(o)||0).toFixed(e||0)}var ko={gerar:function(){var o=d()(regeneratorRuntime.mark(function o(e){var t,a,r,i,s,n,c,d,u,p;return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:return Object(f["verificarErro"])(!e.codigoDocumento,"Código do envelope inválido"),o.t0=l.a,o.t1={},o.t2=e,o.next=6,Object(f["executarSql"])("select documentoCodigo, codigoDocumentoAdicional, tipo, observacao from documento where codigoDocumento=".concat(Object(f["sqlNum"])(e.codigoDocumento)));case 6:return o.t3=o.sent[0],t=(0,o.t0)(o.t1,o.t2,o.t3),Object(f["verificarErro"])(!t,"Envelope não encontrado"),Object(f["verificarErro"])(!t.documentoCodigo,"Envelope sem venda"),Object(f["verificarErro"])(!t.codigoDocumentoAdicional,"Envelope sem receita"),o.next=13,Object(f["executarSql"])("select numeroDocumentoEmpresa, numero, tipo, observacao from documento where codigoDocumento=".concat(Object(f["sqlNum"])(t.documentoCodigo)));case 13:return a=o.sent[0],Object(f["verificarErro"])(!a,"Venda não encontrada"),o.next=17,Object(f["executarSql"])("select codigoDocumento, tipo, observacao from documento where codigoDocumento=".concat(Object(f["sqlNum"])(t.codigoDocumentoAdicional)));case 17:return r=o.sent[0],Object(f["verificarErro"])(!r,"Receita não encontrada"),o.next=21,Object(f["executarSql"])("select operacao, status, di, eixo, cilindrico, adicao, esferico, prisma, base\n       from documentoItem\n       where codigoDocumento=".concat(Object(f["sqlNum"])(r.codigoDocumento),"\n         and tipoItem = 'Prescrição'"));case 21:return r.itens=o.sent,Object(f["verificarErro"])(!r.itens||!r.itens.length,"Receita sem itens"),r.odLonge=r.itens.find(function(o){return"Olho Direito"===o.operacao&&"Longe"===o.status}),r.oeLonge=r.itens.find(function(o){return"Olho Esquerdo"===o.operacao&&"Longe"===o.status}),Object(f["verificarErro"])(!r.odLonge,"Receita sem informações do Olho Direito de distância Longe"),Object(f["verificarErro"])(!r.oeLonge,"Receita sem informações do Olho Esquerdo de distância Longe"),r.odMedio=r.itens.find(function(o){return"Olho Direito"===o.operacao&&"Medio"===o.status})||{},r.oeMedio=r.itens.find(function(o){return"Olho Esquerdo"===o.operacao&&"Medio"===o.status})||{},r.odPerto=r.itens.find(function(o){return"Olho Direito"===o.operacao&&"Perto"===o.status})||{},r.oePerto=r.itens.find(function(o){return"Olho Esquerdo"===o.operacao&&"Perto"===o.status})||{},o.next=33,Object(f["executarSql"])("select di.tipoItem, di.codigoItem, di.total, di.oculos,\n         di.alturaMontagemOD, di.alturaMontagemOE,\n         i.descricaoConcatenada, i.referencia, i.valorCusto, i.lenteTipo,\n         di.ponte, di.altura, di.diagonal, di.haste, di.tamanho, di.tipoMontagem\n       from documentoItem di\n       left join item i on i.codigoItem = di.codigoItem\n       where codigoDocumentoAdicional=".concat(Object(f["sqlNum"])(e.codigoDocumento)));case 33:t.itens=o.sent,Object(f["verificarErro"])(!t.itens||!t.itens.length,"Envelope sem itens"),t.olhoDireito=t.itens.find(function(o){return"LOD"===o.tipoItem})||{},t.olhoDireito.tratamentos=t.itens.filter(function(o){return"TLOD"===o.tipoItem}),t.olhoEsquerdo=t.itens.find(function(o){return"LOE"===o.tipoItem})||{},t.olhoEsquerdo.tratamentos=t.itens.filter(function(o){return"TLOE"===o.tipoItem}),t.armacao=t.itens.find(function(o){return"Armação"===o.tipoItem})||{},o.t4=t.armacao.oculos,o.next="Multifocal (Longe e Perto)"===o.t4?43:"Monofocal (Longe)"===o.t4?46:"Monofocal (Médio)"===o.t4?49:"Monofocal (Perto)"===o.t4?52:"Bifocal (Longe e Perto)"===o.t4?55:"Intermediário (Médio e Perto)"===o.t4?58:"Intermediário (Longe e Médio)"===o.t4?61:64;break;case 43:return i={grauEsferico:r.odLonge.esferico,grauCilindro:r.odLonge.cilindrico,eixo:r.odLonge.eixo,adicao:r.odPerto.adicao,dnp:r.odLonge.di},s={grauEsferico:r.oeLonge.esferico,grauCilindro:r.oeLonge.cilindrico,eixo:r.oeLonge.eixo,adicao:r.oePerto.adicao,dnp:r.oeLonge.di},o.abrupt("break",65);case 46:return i={grauEsferico:r.odLonge.esferico,grauCilindro:r.odLonge.cilindrico,eixo:r.odLonge.eixo,dnp:r.odLonge.di},s={grauEsferico:r.oeLonge.esferico,grauCilindro:r.oeLonge.cilindrico,eixo:r.oeLonge.eixo,dnp:r.oeLonge.di},o.abrupt("break",65);case 49:return i={grauEsferico:r.odMedio.esferico,grauCilindro:r.odMedio.cilindrico,eixo:r.odMedio.eixo,dnp:r.odMedio.di},s={grauEsferico:r.oeMedio.esferico,grauCilindro:r.oeMedio.cilindrico,eixo:r.oeMedio.eixo,dnp:r.oeMedio.di},o.abrupt("break",65);case 52:return i={grauEsferico:r.odPerto.esferico,grauCilindro:r.odPerto.cilindrico,eixo:r.odPerto.eixo,dnp:r.odPerto.di},s={grauEsferico:r.oePerto.esferico,grauCilindro:r.oePerto.cilindrico,eixo:r.oePerto.eixo,dnp:r.oePerto.di},o.abrupt("break",65);case 55:return i={grauEsferico:r.odLonge.esferico,grauCilindro:r.odLonge.cilindrico,eixo:r.odLonge.eixo,adicao:r.odPerto.adicao,dnp:r.odLonge.di},s={grauEsferico:r.oeLonge.esferico,grauCilindro:r.oeLonge.cilindrico,eixo:r.oeLonge.eixo,adicao:r.oePerto.adicao,dnp:r.oeLonge.di},o.abrupt("break",65);case 58:return i={grauEsferico:r.odMedio.esferico,grauCilindro:r.odMedio.cilindrico,eixo:r.odMedio.eixo,adicao:r.odPerto.adicao,dnp:r.odMedio.di},s={grauEsferico:r.oeMedio.esferico,grauCilindro:r.oeMedio.cilindrico,eixo:r.oeMedio.eixo,adicao:r.oePerto.adicao,dnp:r.oeMedio.di},o.abrupt("break",65);case 61:return i={grauEsferico:r.odLonge.esferico,grauCilindro:r.odLonge.cilindrico,eixo:r.odLonge.eixo,adicao:r.odMedio.adicao,dnp:r.odLonge.di},s={grauEsferico:r.oeLonge.esferico,grauCilindro:r.oeLonge.cilindrico,eixo:r.oeLonge.eixo,adicao:r.oeMedio.adicao,dnp:r.oeLonge.di},o.abrupt("break",65);case 64:Object(f["verificarErro"])(!0,"Tipo do envelope inválido");case 65:return r.odLonge.base=r.odLonge.base.toUpperCase()||"NASAL",n=["NASAL","TEMPORAL"].includes(r.odLonge.base)&&!!r.odLonge.prisma,c=["SUPERIOR","INFERIOR"].includes(r.odLonge.base)&&!!r.odLonge.prisma,r.oeLonge.base=r.oeLonge.base.toUpperCase()||"NASAL",d=["NASAL","TEMPORAL"].includes(r.oeLonge.base)&&!!r.oeLonge.prisma,u=["SUPERIOR","INFERIOR"].includes(r.oeLonge.base)&&!!r.oeLonge.prisma,p={idPedidoOtica:String(t.codigoDocumento||""),observacao:t.observacao||r.observacao||a.observacao||"",servicos:[],receita:{olhoDireito:{grauEsferico:_o(i.grauEsferico||0),grauCilindro:_o(i.grauCilindro||0),eixo:String(i.eixo||0),adicao:_o(i.adicao||0),dnp:String(i.dnp||0),altura:String(t.armacao.alturaMontagemOD||0),codigoLinhaProduto:"",tipoProducao:"",tipoProduto:"",eixoPrismaHorizontal:n?r.odLonge.base:void 0,valorPrismaHorizontal:n?String(r.odLonge.prisma):void 0,eixoPrismaVertical:c?r.odLonge.base:void 0,valorPrismaVertical:c?String(r.odLonge.prisma):void 0},olhoEsquerdo:{grauEsferico:_o(s.grauEsferico||0),grauCilindro:_o(s.grauCilindro||0),eixo:String(s.eixo||0),adicao:_o(s.adicao||0),dnp:String(s.dnp||0),altura:String(t.armacao.alturaMontagemOE||0),codigoLinhaProduto:"",tipoProducao:"",tipoProduto:"",eixoPrismaHorizontal:d?r.oeLonge.base:void 0,valorPrismaHorizontal:d?String(r.oeLonge.prisma):void 0,eixoPrismaVertical:u?r.oeLonge.base:void 0,valorPrismaVertical:u?String(r.oeLonge.prisma):void 0}},armacao:{vertical:String(t.armacao.altura||""),horizontal:String(t.armacao.diagonal||""),ponte:String(t.armacao.ponte||""),diametroMaior:String(t.armacao.diagonal||""),tipo:"1",modelo:"",cor:"",marca:"",referencia:""},parametros:{olhoDireito:{dnpPerto:String(r.odPerto.di||0),distanciaVertice:"",cro:"",anguloPantoscopico:"",anguloCurvatura:"",distanciaLeitura:"",coeficienteHE:"",coeficienteST:"",distanciaProgressao:"",cvp:"",vmap:""},olhoEsquerdo:{dnpPerto:String(r.oePerto.di||0),distanciaVertice:"",cro:"",anguloPantoscopico:"",anguloCurvatura:"",distanciaLeitura:"",coeficienteHE:"",coeficienteST:"",distanciaProgressao:"",cvp:"",vmap:""},olhoDominante:""},paciente:{nome:"",cpf:"",iniciaisPaciente:""},medico:{nome:"",crm:""},vendedor:{nome:"",cpf:""}},f["gconsole"].log("gerarJsonPedido",{json:p,envelope:t,venda:a,receita:r}),o.abrupt("return",{json:p,envelope:t,venda:a,receita:r,olhoDireito:{detalheProduto:{},opcoesProdutos:[],opcoesTratamentos:[]},olhoEsquerdo:{detalheProduto:{},opcoesProdutos:[],opcoesTratamentos:[]}});case 74:case"end":return o.stop()}},o)}));return function(e){return o.apply(this,arguments)}}()},jo=t("2ef0"),So=t("a0fd"),Oo={Processando:[],"Translado Loja para Pedido":[],"Translado Pedido para Loja":[],"Aguardando Retorno":[],"Processando Montagem":[],"Pronto para Entrega":[],"Cliente Informado":[],Entregue:[]},Ro={components:{BarraTopo:u["a"],Badge:So["a"],Campo:p["a"],EnvelopeTrocarStatus:q,EssilorConsultarPedido:Z,EssilorConsultarPedidos:to,EssilorConsultarStatusPedido:lo,EssilorPedidoLaboratorio:wo,ModalHistoricoStatus:Po["a"],draggable:yo.a},data:function(){return{sistemaPai:"",showfilters:!0,empresaOpcoes:[],empresaSelecionada:null,entregueFim:new Date((new Date).toDateString()),entregueInicio:new Date((new Date).toDateString()),essilorPedido:null,fraseFiltro:"",laboratoriosEssilor:null,listas:Object(f["clonarV2"])(Oo),modalEssilorConsultarPedido:!1,modalEssilorConsultarPedidos:!1,modalEssilorConsultarStatusPedido:!1,modalEssilorPedidoLaboratorio:!1,pedidoLaboratorioEssilor:{},trocarStatusDados:{},trocarStatusModal:!1,periodoOpcoes:[{label:"Hoje",value:0},{label:"Uma semana",value:7},{label:"Um mês",value:30}],prazoSelecionado:null,prazoOpcoes:[{label:"Em dia",value:"bordaVerdeEnvelope"},{label:"Entrega para esta semana",value:"bordaAmarelaEnvelope"},{label:"Entrega atrasada",value:"bordaVermelhaEnvelope"}],modalHistoricoStatus:{},tamanhoLista:{},listasFiltradas:Object(f["clonarV2"])(Oo),help:{show:!1,src:"",title:"",map:{admEnvelope:{src:"https://www.youtube.com/embed/Tmtsr4o7nuo",title:"Videoaula OptiSoul: Adm. de Envelope"}}}}},methods:{scrollHandler:function(o,e){var t=o.target.scrollHeight-o.target.scrollTop-o.target.offsetHeight;t<100&&(this.tamanhoLista[e]+=10,this.listasFiltradas[e]=this.listas[e].filter(function(o){return o.mostra}).slice(0,this.tamanhoLista[e]))},abrirEssilorConsultarPedidos:function(){var o=d()(regeneratorRuntime.mark(function o(){return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:this.modalEssilorConsultarPedidos=!0;case 1:case"end":return o.stop()}},o,this)}));return function(){return o.apply(this,arguments)}}(),eventoEnd:function(){var o=d()(regeneratorRuntime.mark(function o(){var e,t,a,r,i,s,n,l,c,d,u;return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:o.t0=regeneratorRuntime.keys(this.listasFiltradas);case 1:if((o.t1=o.t0()).done){o.next=40;break}e=o.t1.value,t=!0,a=!1,r=void 0,o.prev=6,i=this.listasFiltradas[e][Symbol.iterator]();case 8:if(t=(s=i.next()).done){o.next=24;break}if(n=s.value,n.status===e){o.next=21;break}return f["gconsole"].log("AdmEnvelope","eventoEnd De:",n.status,"Para:",e,"codigo:",n.codigoDocumento),l=["Aguardando Retorno","Processando Montagem","Pronto para Entrega","Cliente Informado","Entregue"].includes(e),o.next=15,U["a"].configuracoes.leOnline({nome:"compras.lentes.pedidoautomatico"});case 15:return c=o.sent,d="1"===c[0].valor&&["Aguardando Retorno","Processando Montagem","Pronto para Entrega","Cliente Informado","Entregue"].includes(e),u=this.laboratoriosEssilor.includes(n.codigoLaboratorio),this.trocarStatusDados={envelope:n,codigoContatoResponsavel:n.codigoContatoResponsavel,codigoDocumento:n.codigoDocumento,codigoLaboratorio:n.codigoLaboratorio,codigoLaboratorioOriginal:n.codigoLaboratorio,codigoUsuario:null,gerarPedido:!1,mostraGerarPedido:d,mostraLaboratorio:l,gerarPedidoEssilor:!1,mostraGerarPedidoEssilor:u,laboratoriosEssilor:this.laboratoriosEssilor,nomeCliente:n.nomeCliente,nomeLaboratorio:n.nomeLaboratorio,observacao:"",statusAtual:n.status,statusNovo:e},this.trocarStatusModal=!0,o.abrupt("return");case 21:t=!0,o.next=8;break;case 24:o.next=30;break;case 26:o.prev=26,o.t2=o["catch"](6),a=!0,r=o.t2;case 30:o.prev=30,o.prev=31,t||null==i.return||i.return();case 33:if(o.prev=33,!a){o.next=36;break}throw r;case 36:return o.finish(33);case 37:return o.finish(30);case 38:o.next=1;break;case 40:case"end":return o.stop()}},o,this,[[6,26,30,38],[31,,33,37]])}));return function(){return o.apply(this,arguments)}}(),eventoConfirmarTroca:function(){var o=d()(regeneratorRuntime.mark(function o(e){var t,a;return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:return f["gconsole"].log("AdmEnvelope","eventoConfirmaTroca",l()({},e)),this.$q.loading.show(),o.prev=2,o.next=5,U["a"].usuario.leOnline(U["a"].usuario.logado.id);case 5:if(o.t1=o.sent,o.t1){o.next=8;break}o.t1=[];case 8:if(o.t0=o.t1[0],o.t0){o.next=11;break}o.t0={};case 11:return t=o.t0,e.codigoUsuario=t.codigoUsuario,o.next=15,U["a"].envelope.trocaStatusOnline(e);case 15:if(this.$q.notifyPositive("Status trocado com sucesso"),e.codigoLaboratorio===e.codigoLaboratorioOriginal){o.next=21;break}return o.next=19,U["a"].envelope.gravaLaboratorioOnline(e);case 19:a=o.sent,a&&a.length&&a[0].cnpjLaboratorio&&(e.envelope.cnpjLaboratorio=Object(f["filtrarDigitos"])(a[0].cnpjLaboratorio||""),e.envelope.codigoLaboratorio=e.codigoLaboratorio);case 21:if(!e.gerarPedido){o.next=25;break}return o.next=24,U["a"].envelope.comprasPedidoViaEnvelopeOnline(e);case 24:this.$q.notifyPositive("Pedido de compra gerado");case 25:e.gerarPedidoEssilor&&this.abrirEssilorPedidoLaboratorio(e.envelope),this.atualiza(),o.next=32;break;case 29:o.prev=29,o.t2=o["catch"](2),this.$q.notifyError("Erro na troca de status",o.t2);case 32:return o.prev=32,this.$q.loading.hide(),o.finish(32);case 35:case"end":return o.stop()}},o,this,[[2,29,32,35]])}));return function(e){return o.apply(this,arguments)}}(),eventoCancelarTroca:function(o){f["gconsole"].log("AdmEnvelope","eventoCancelarTroca",o),this.atualiza()},empresaOpcoesCarregar:function(){var o=d()(regeneratorRuntime.mark(function o(){return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:return f["gconsole"].log("AdmEnvelope","empresaOpcoesCarregar()"),o.next=3,U["a"].empresa.leOnline();case 3:o.t0=function(o){return{label:o.nome,value:o.codigoContato}},this.empresaOpcoes=o.sent.map(o.t0);case 5:case"end":return o.stop()}},o,this)}));return function(){return o.apply(this,arguments)}}(),filtraDebounce:function(){Object(jo["debounce"])(this.refazFiltro,700)()},irParaAtendimento:function(){var o=d()(regeneratorRuntime.mark(function o(e){var t;return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,Object(Y["a"])().contato.where({codigoContato:e}).first();case 2:if(o.t0=o.sent,o.t0){o.next=5;break}o.t0={};case 5:t=o.t0,t.id&&this.$router.push({name:"Atendimento",params:{id:t.id}});case 7:case"end":return o.stop()}},o,this)}));return function(e){return o.apply(this,arguments)}}(),refazFiltro:function(){f["gconsole"].log("AdmEnvelopes","refazFiltro()",this.fraseFiltro,this.empresaSelecionada);var o=Object(f["removerAcentos"])(this.fraseFiltro.toUpperCase()).split(" ").filter(function(o){return""!==o});for(var e in this.listas){var t=!0,a=!1,r=void 0;try{for(var i,s=this.listas[e][Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var n=i.value,l=Object(f["removerAcentos"])(n.id.toUpperCase()+n.nomeCliente.toUpperCase()+n.nomeResponsavel.toUpperCase()+n.nomeLaboratorio.toUpperCase()+" "+String(n.numeroVenda)+"  "+String(n.numeroEnvelope)+" "),c=!0,d=!0,u=!1,p=void 0;try{for(var m,v=o[Symbol.iterator]();!(d=(m=v.next()).done);d=!0){var h=m.value;c=isNaN(Number(h))?c&&l.includes(h):c&&l.includes(" "+h+" ")}}catch(o){u=!0,p=o}finally{try{d||null==v.return||v.return()}finally{if(u)throw p}}this.empresaSelecionada&&(c=c&&this.empresaSelecionada===n.codigoEmpresa),n.mostra=c}}catch(o){a=!0,r=o}finally{try{t||null==s.return||s.return()}finally{if(a)throw r}}}for(var g in this.listas)this.listasFiltradas[g]=this.listas[g].filter(function(o){return o.mostra}).slice(0,this.tamanhoLista[g])},exibirHistorico:function(){var o=d()(regeneratorRuntime.mark(function o(e){var t;return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,this.$q.loading.show({message:"Processando"}),o.next=4,U["a"].documentoStatus.leHistoricoOnline(e);case 4:if(t=o.sent,t.status.length){o.next=8;break}return this.$q.notify({type:"warning",message:"Não há histórico disponível."}),o.abrupt("return");case 8:return this.modalHistoricoStatus.activated||(this.modalHistoricoStatus={activated:!0}),o.next=11,this.$nextTick();case 11:this.modalHistoricoStatus=l()({},this.modalHistoricoStatus,{show:!0},t),o.next=17;break;case 14:o.prev=14,o.t0=o["catch"](0),this.$q.notify({type:"negative",message:o.t0.message});case 17:return o.prev=17,this.$q.loading.hide(),o.finish(17);case 20:case"end":return o.stop()}},o,this,[[0,14,17,20]])}));return function(e){return o.apply(this,arguments)}}(),abrirEssilorConsultarPedido:function(){var o=d()(regeneratorRuntime.mark(function o(e){return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:try{f["gconsole"].log("AdmEnvelopes","abrirEssilorConsultarPedido",e),this.essilorPedido=e,this.modalEssilorConsultarPedido=!0}catch(o){this.$q.notifyError("Erro na consulta",o)}case 1:case"end":return o.stop()}},o,this)}));return function(e){return o.apply(this,arguments)}}(),abrirEssilorConsultarStatusPedido:function(){var o=d()(regeneratorRuntime.mark(function o(e){return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:try{f["gconsole"].log("AdmEnvelopes","abrirEssilorConsultarStatusPedido",e),this.essilorPedido=e,this.modalEssilorConsultarStatusPedido=!0}catch(o){this.$q.notifyError("Erro na consulta",o)}case 1:case"end":return o.stop()}},o,this)}));return function(e){return o.apply(this,arguments)}}(),abrirEssilorPedidoLaboratorio:function(){var o=d()(regeneratorRuntime.mark(function o(e){return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,f["gconsole"].log("AdmEnvelopes","abrirEssilorPedidoLaboratorio",e),this.$q.loading.show({message:"Consultando"}),o.next=5,ko.gerar(e);case 5:this.pedidoLaboratorioEssilor=o.sent,this.modalEssilorPedidoLaboratorio=!0,o.next=12;break;case 9:o.prev=9,o.t0=o["catch"](0),this.$q.notifyError("Erro na consulta",o.t0);case 12:return o.prev=12,this.$q.loading.hide(),o.finish(12);case 15:case"end":return o.stop()}},o,this,[[0,9,12,15]])}));return function(e){return o.apply(this,arguments)}}(),atualiza:function(){var o=d()(regeneratorRuntime.mark(function o(){var e,t,a,r,i,n,l,c,d,u,p,m,v,h,g,b,C,E,q,x,w;return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:for(e in Oo)this.tamanhoLista[e]||this.$set(this.tamanhoLista,e,10);return o.prev=1,o.next=4,this.$utils.geeksApi({envelopes:{funcao:"978EC61B-EA4C-4479-B064-560C3ED3A7AB",entregueInicio:this.entregueInicio,entregueFim:this.entregueFim}});case 4:if(a=o.sent,t=this._.get(a,"data.envelopes"),this.$utils.verificarExcecao(!t||t.error,this._.get(t,"message")),f["gconsole"].log("AdmEnvelopes","geeksApi()",t.length),Object(f["verificarAlerta"])(!t||!t.length,"Não há envelopes"),this.laboratoriosEssilor){o.next=15;break}return o.next=12,U["a"].configuracoes.leLista("compra.essilor.webservice");case 12:r=o.sent,this.laboratoriosEssilor=Object(f["unicos"])(r,"valor").map(function(o){return Number(o)}),f["gconsole"].log("AdmEnvelopes","laboratoriosEssilor",s()(this.laboratoriosEssilor));case 15:for(i=Object(f["clonarV2"])(Oo),n=!0,l=!1,c=void 0,o.prev=19,d=t[Symbol.iterator]();!(n=(u=d.next()).done);n=!0)p=u.value,m="bordaVerdeEnvelope",v="",h="Normal","Entregue"===p.status?p.dataHoraPrevisto&&p.dataHoraFinalizado&&(g=new Date(new Date(p.dataHoraPrevisto).toDateString()),b=new Date(new Date(p.dataHoraFinalizado).toDateString()),C=(b-g)/864e5,m=C>=0?"bordaVermelhaEnvelope":C>-7?"bordaAmarelaEnvelope":"bordaVerdeEnvelope",v=C>=0?"negative":C>-7?"warning":"",h=C>=0?"Atrasado":C>-7?"Atenção":"Normal"):p.dataHoraPrevisto&&(E=new Date(new Date(p.dataHoraPrevisto).toDateString()),q=new Date((new Date).toDateString()),x=(q-E)/864e5,m=x>=0?"bordaVermelhaEnvelope":x>-7?"bordaAmarelaEnvelope":"bordaVerdeEnvelope",v=x>=0?"negative":x>-7?"warning":"",h=x>=0?"Atrasado":x>-7?"Atenção":"Normal"),w={id:p.id,codigoCompra:p.codigoCompra||"-",codigoContatoResponsavel:p.codigoContatoResponsavel,codigoDocumento:p.codigoDocumento,codigoEmpresa:p.codigoEmpresa,idEmpresa:p.idEmpresa,descricaoEmpresa:p.descricaoEmpresa,codigoContato:p.codigoContato,codigoLaboratorio:p.codigoLaboratorio,numeroOrdemCompra:p.numeroOrdemCompra,corBorda:m,corLabel:v,txtLabel:h,dataHoraEmissao:new Date(p.dataHoraEmissao),dataHoraFinalizado:new Date(p.dataHoraFinalizado),dataHoraRetorno:new Date(p.dataHoraRetorno),dataHoraPrevisto:new Date(p.dataHoraPrevisto),mostra:!0,nomeCliente:p.nomeCliente||"-",nomeLaboratorio:p.nomeLaboratorio||"",cnpjLaboratorio:Object(f["filtrarDigitos"])(p.cnpjLaboratorio||""),nomeResponsavel:p.nomeResponsavel||"-",numeroVenda:p.numeroVenda||"-",numeroEnvelope:p.numeroEnvelope||"-",status:p.status},i[p.status]&&i[p.status].push(w);o.next=27;break;case 23:o.prev=23,o.t0=o["catch"](19),l=!0,c=o.t0;case 27:o.prev=27,o.prev=28,n||null==d.return||d.return();case 30:if(o.prev=30,!l){o.next=33;break}throw c;case 33:return o.finish(30);case 34:return o.finish(27);case 35:this.listas=i,this.refazFiltro(),o.next=42;break;case 39:o.prev=39,o.t1=o["catch"](1),this.$q.notifyError("Erro na consulta online de envelopes",o.t1);case 42:case"end":return o.stop()}},o,this,[[1,39],[19,23,27,35],[28,,30,34]])}));return function(){return o.apply(this,arguments)}}(),showHelp:function(o){this.help.src=this.help.map[o].src,this.help.title=this.help.map[o].title,this.help.show=!0}},watch:{entregueInicio:function(){f["gconsole"].log("AdmEnvelopes","entregueInicio"),this.atualiza()},entregueFim:function(){f["gconsole"].log("AdmEnvelopes","entregueFim"),this.atualiza()}},created:function(){f["gconsole"].log("AdmEnvelopes","created()"),this.sistemaPai=Object(f["sistemaPai"])(),this.atualiza()}},Do=Ro,Ao=(t("c30b"),Object(C["a"])(Do,a,r,!1,null,null,null));Ao.options.__file="AdmEnvelopes.vue";e["default"]=Ao.exports},c30b:function(o,e,t){"use strict";var a=t("8cac"),r=t.n(a);r.a},e970:function(o,e,t){"use strict";var a=function(){var o=this,e=o.$createElement,t=o._self._c||e;return t("q-modal",{model:{value:o.dados.show,callback:function(e){o.$set(o.dados,"show",e)},expression:"dados.show"}},[t("q-modal-layout",[t("q-toolbar",{attrs:{slot:"header"},slot:"header"},[t("q-toolbar-title",[o._v("Histórico do Status")]),t("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"close",round:""}})],1),t("q-list",{staticClass:"q-pl-sm q-pr-sm q-pt-lg q-pb-lg",attrs:{"no-border":"",dense:""}},[o._l(o.dados.status,function(e,a){return[a?t("q-item-separator",{key:a}):o._e(),t("q-item",{key:e.codigoDocumentoStatus,attrs:{multiline:""}},[t("q-item-side",[t("avatar",{attrs:{imagem:(o.dados.contatos[e.codigoUsuarioAlterou]||{}).imagem,rotulo:(o.dados.contatos[e.codigoUsuarioAlterou]||{}).nome}})],1),t("q-item-main",[t("q-item-tile",{attrs:{label:""}},[t("span",{staticClass:"q-body-1"},[o._v("De:")]),o._v(" "),t("span",{staticClass:"q-body-2"},[o._v(o._s(e.statusOriginal))])]),t("q-item-tile",{attrs:{label:""}},[t("span",{staticClass:"q-body-1"},[o._v("Para:")]),o._v(" "),t("span",{staticClass:"q-body-2"},[o._v(o._s(e.statusFinalizado))])]),t("q-item-tile",{staticClass:"q-mt-sm",attrs:{sublabel:""}},[t("strong",{staticClass:"q-body-1"},[o._v(o._s((o.dados.contatos[e.codigoUsuarioAlterou]||{}).nome))])]),e.observacao?t("q-item-tile",{staticClass:"q-mt-sm",attrs:{sublabel:""}},[o._v("\n              "+o._s(e.observacao)+"\n            ")]):o._e()],1),t("q-item-side",{attrs:{right:""}},[t("q-item-tile",{attrs:{stamp:""}},[o._v(o._s(o._f("dataHora")(e.dataHoraEmissao)))])],1)],1)]})],2)],1)],1)},r=[];a._withStripped=!0;var i=t("df3a"),s={components:{Avatar:i["a"]},props:{dados:{type:Object,required:!0}}},n=s,l=t("2877"),c=Object(l["a"])(n,a,r,!1,null,null,null);c.options.__file="ModalHistoricoStatus.vue";e["a"]=c.exports}}]);