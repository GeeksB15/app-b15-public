(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["71187aae"],{"13e6":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-layout",{staticClass:"Imprimir bg-white"},[a("q-layout-header",{staticClass:"Imprimir-barraTopo"},[a("q-toolbar",{attrs:{color:"primary"}},[a("q-btn",{attrs:{dense:"",flat:"",icon:"chevron_left",round:""},on:{click:t.voltar}}),a("q-toolbar-title",[t._v("\n        "+t._s(t.objeto.descricao||"Relatório")+"\n        "),t.objeto.descricao?a("span",{attrs:{slot:"subtitle"},slot:"subtitle"},[t._v("Relatório")]):t._e()]),"nfe-danfe"===t.nome?a("q-btn",{attrs:{color:"white",flat:"",label:"Email",icon:"email"},on:{click:t.abrirNFeEmail}}):t._e(),a("q-btn",{attrs:{color:"white",flat:"",label:"Compartilhar",icon:"share"},on:{click:function(e){t.tryLoading(t.compartilhar)}}}),a("q-btn",{attrs:{color:"white",flat:"",label:"Imprimir",icon:"print"},on:{click:t.imprimirVisalizador}}),a("input",{ref:"urlCompartilhamento",attrs:{type:"hidden"},domProps:{value:t.urlCompartilhamento}})],1)],1),a("q-page-container",{staticClass:"Imprimir-pagina"},[a("div",{staticClass:"Imprimir-visualizador"},[t.temComponente?a("visualizador",t._b({ref:"visualizador"},"visualizador",t.componente,!1)):t._e()],1)]),a("NFeEmail")],1)},o=[];r._withStripped=!0;a("96cf");var i=a("c973"),n=a.n(i),s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-modal",{attrs:{"content-css":{width:"100vw",maxWidth:"768px"}},model:{value:t.modalNFeEmail,callback:function(e){t.modalNFeEmail=e},expression:"modalNFeEmail"}},[a("q-modal-layout",[a("q-toolbar",{attrs:{slot:"header"},slot:"header"},[a("q-toolbar-title",[t._v("Email")])],1),a("form",{on:{submit:function(e){return e.preventDefault(),t.enviarNFeEmail(e)}}},[a("div",{staticClass:"layout-padding"},[a("div",{staticClass:"row gutter-x-sm"},[a("campo",{staticClass:"col-12",attrs:{rotulo:"De",tipo:"texto","apenas-leitura":""},model:{value:t.email.de,callback:function(e){t.$set(t.email,"de",e)},expression:"email.de"}}),a("campo",{staticClass:"col-12",attrs:{rotulo:"Para",tipo:"texto"},model:{value:t.email.para,callback:function(e){t.$set(t.email,"para",e)},expression:"email.para"}}),a("campo",{staticClass:"col-12",attrs:{rotulo:"Assunto",tipo:"texto"},model:{value:t.email.assunto,callback:function(e){t.$set(t.email,"assunto",e)},expression:"email.assunto"}}),a("campo",{staticClass:"col-12",attrs:{rotulo:"Mensagem",tipo:"textoArea",rows:"4"},model:{value:t.email.mensagem,callback:function(e){t.$set(t.email,"mensagem",e)},expression:"email.mensagem"}})],1)]),a("q-toolbar",{attrs:{slot:"footer",color:"light"},slot:"footer"},[a("q-toolbar-title",[a("div",{staticClass:"row justify-end"},[a("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{flat:"",color:"primary",label:"Cancelar"}}),a("q-btn",{attrs:{flat:"",color:"primary",type:"submit",label:"Enviar"}})],1)])],1)],1)],1)],1)},l=[];s._withStripped=!0;a("ac4d"),a("8a81"),a("ac6a");var c=a("3156"),m=a.n(c),u=a("88db"),p=a("bc3a"),d=a.n(p),h=a("8149"),f=a("ed08"),v={components:{Campo:u["a"]},data:function(){return{modalNFeEmail:!1,email:{de:"",para:"",assunto:"",mensagem:""}}},methods:{enviarNFeEmail:function(){var t=n()(regeneratorRuntime.mark(function t(){var e,a,r,o,i,n,s,l,c;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:for(f["gconsole"].log("NFeEmail","enviarNFeEmail()",m()({},this.email)),t.prev=1,this.$q.loading.show(),e=[{name:"danfe_".concat(this.nota.nNF,".pdf"),content:this.html,method:"html2pdf"}],a=!0,r=!1,o=void 0,t.prev=7,i=this.xmls[Symbol.iterator]();!(a=(n=i.next()).done);a=!0)s=n.value,e.push({name:"".concat(s.tipo,"_").concat(s.nNF,"_").concat(s.operacao).concat(s.nSeqEvento>1?"_"+s.nSeqEvento:"",".xml"),content:s.xmlProt});t.next=15;break;case 11:t.prev=11,t.t0=t["catch"](7),r=!0,o=t.t0;case 15:t.prev=15,t.prev=16,a||null==i.return||i.return();case 18:if(t.prev=18,!r){t.next=21;break}throw o;case 21:return t.finish(18);case 22:return t.finish(15);case 23:return l={host:"smtp.gmail.com",port:587,ssl:!0,auth:{user:"auto@geekssolucoes.com.br",pass:"xpto@9@9"},from:this.email.de,to:this.email.para,subject:this.email.assunto,text:this.email.mensagem,attachments:e},t.next=26,d()({baseURL:"https://api.b15.com.br",method:"post",url:"/email/v2",data:l});case 26:c=t.sent,this.modalNFeEmail=!1,this.$q.notifyPositive(c.data.message),t.next=34;break;case 31:t.prev=31,t.t1=t["catch"](1),this.$q.notifyError("Erro ao enviar email",t.t1);case 34:return t.prev=34,this.$q.loading.hide(),t.finish(34);case 37:case"end":return t.stop()}},t,this,[[1,31,34,37],[7,11,15,23],[16,,18,22]])}));return function(){return t.apply(this,arguments)}}(),abrirNFeEmail:function(){var t=n()(regeneratorRuntime.mark(function t(e,a){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,f["gconsole"].log("NFeEmail","abrirNFeEmail()",e),this.html=a,t.next=5,h["a"].documentoFiscalEletronico.le({id:e});case 5:return this.nota=t.sent,t.next=8,h["a"].documentoFiscalEletronicoXml.le({idDocumentoFiscalEletronico:e});case 8:this.xmls=t.sent,this.json=JSON.parse(this.nota.json),this.email={de:"Geeks Soluções <auto@geekssolucoes.com.br>",para:this._.get(this.json,"infNFe.dest.email",""),assunto:"Nota Fiscal Eletrônica Nº ".concat(this.nota.nNF),mensagem:"Você está recebendo os arquivos digitais NFe (Nota Fiscal Eletrônica) da empresa ".concat(this.nota.xFantEmitente)},this.modalNFeEmail=!0,t.next=17;break;case 14:t.prev=14,t.t0=t["catch"](0),this.$q.notifyError("Erro ao abrir a nota",t.t0);case 17:case"end":return t.stop()}},t,this,[[0,14]])}));return function(e,a){return t.apply(this,arguments)}}()},mounted:function(){f["eventos"].$off("abrirNFeEmail"),f["eventos"].$on("abrirNFeEmail",this.abrirNFeEmail)},beforeDestroy:function(){f["eventos"].$off("abrirNFeEmail")}},b=v,g=(a("64a8"),a("2877")),w=Object(g["a"])(b,s,l,!1,null,"3406569a",null);w.options.__file="NFeEmail.vue";var y=w.exports,E=a("7cef"),x=a("77d5"),C=a("96a1"),$={components:{NFeEmail:y,Visualizador:E["a"]},computed:{nome:function(){return this.$route.params.nome},parametro:function(){var t=this.$route.params.parametro;return t?f["base64"].decodeFromUrl(t):""}},data:function(){return{botaoImprimir:!0,componente:{contexto:{},estilo:"",script:"",template:""},objeto:{},temComponente:!1,urlCompartilhamento:""}},methods:{abrirNFeEmail:function(){f["gconsole"].log("Imprimir","abrirNFeEmail()",this.parametro),f["eventos"].$emit("abrirNFeEmail",this.parametro,this.$refs.visualizador.$el.contentWindow.document.body.innerHTML)},carregarObjeto:function(){var t=n()(regeneratorRuntime.mark(function t(e){var a,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,f["gconsole"].log("Imprimir",e),t.next=4,x["a"].objeto.le({filtros:{nomeObjeto:e,tipo:"vue"}});case 4:if(a=t.sent,a&&a[0]&&a[0].codigoPersonalizado){t.next=7;break}return t.abrupt("return",this.$q.notify("Relatório indisponível ou sem permissão"));case 7:this.objeto=a[0],r=JSON.parse(f["base64"].decode(a[0].codigoPersonalizado)),this.componente.contexto={parametro:this.parametro},this.componente.estilo=r.estilo,this.componente.script=r.script,this.componente.template=r.template,this.temComponente=!0,t.next=20;break;case 16:throw t.prev=16,t.t0=t["catch"](0),this.$q.notify("Não foi possível carregar o relatório"),t.t0;case 20:case"end":return t.stop()}},t,this,[[0,16]])}));return function(e){return t.apply(this,arguments)}}(),compartilhar:function(){var t=n()(regeneratorRuntime.mark(function t(){var e,a,r,o,i,n=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e="",t.prev=1,this.$q.loading.show(),this.$utils.gconsole.log("Imprimir","compartilhar"),a=this.$refs.visualizador.$el.contentWindow.document.body.innerHTML,this.$utils.gconsole.log("Imprimir","tamanho html",a.length),t.next=8,d()({baseURL:"https://api.b15.com.br",method:"post",url:"/html2pdf",data:{html:a}});case 8:r=t.sent,e=r.data.url,this.urlCompartilhamento=e,t.next=16;break;case 13:return t.prev=13,t.t0=t["catch"](1),t.abrupt("return",this.$q.notifyError("Erro ao gerar o link de compartilhamento.",t.t0));case 16:return t.prev=16,this.$q.loading.hide(),t.finish(16);case 19:this.$utils.gconsole.log("Imprimir","compartilhar url",e),o=this.objeto.descricao||"Relatório",i=[{label:"Copiar link",icon:"link",handler:function(){var t=n.$refs.urlCompartilhamento;t.type="text";try{t.select(),document.execCommand("copy"),n.$q.notify({message:"Copiado para a área de transferência.",type:"info"})}catch(t){n.$q.notify("Erro ao copiar.")}t.type="hidden",window.getSelection().removeAllRanges()}},{color:"green",label:"WhatsApp",icon:"message",handler:function(){var t=encodeURIComponent("Acesse o *".concat(o,"* através do link: ").concat(e,"."));Object(C["a"])("https://wa.me/?text=".concat(t))}}],navigator.share&&i.push({label:"Outros",icon:"more_horiz",handler:function(){navigator.share({title:o,url:e})}}),this.$q.actionSheet({grid:!0,title:"Compartilhar",actions:i}).catch(function(){});case 24:case"end":return t.stop()}},t,this,[[1,13,16,19]])}));return function(){return t.apply(this,arguments)}}(),imprimirVisalizador:function(){if(window.cordova&&window.cordova.plugins&&window.cordova.plugins.printer){var t=this.$refs.visualizador.$el.contentWindow.document.body.innerHTML;return cordova.plugins.printer.print(t)}this.$refs.visualizador.$el.contentWindow.print()},voltar:function(){window&&window.history.back()}},created:function(){if(this.nome&&"0"!==this.nome)return this.carregarObjeto(this.nome);this.$q.notify("Relatório inválido")},beforeDestroy:function(){},watch:{nome:function(t){if(t&&"0"!==t)return this.carregarObjeto(t);this.voltar()}}},q=$,F=(a("6c6e"),Object(g["a"])(q,r,o,!1,null,null,null));F.options.__file="Imprimir.vue";e["default"]=F.exports},"64a8":function(t,e,a){"use strict";var r=a("c0d3"),o=a.n(r);o.a},"6c6e":function(t,e,a){"use strict";var r=a("f30f"),o=a.n(r);o.a},"7cef":function(t,e,a){"use strict";a("6b54"),a("8615"),a("ac6a"),a("cadf"),a("456d");var r=a("b17c"),o=a.n(r),i=a("448a"),n=a.n(i),s=a("3156"),l=a.n(s),c=a("62c5"),m=a.n(c),u=a("a026"),p=a("e588"),d=a("3e8a"),h=a("ed08"),f={BrowserQRCodeSvgWriter:p["BrowserQRCodeSvgWriter"],JsBarcode:m.a,agrupar:h["agrupar"],arredondar:h["arredondar"],dataAtual:h["dataAtual"],dormir:h["dormir"],erp:d["a"],fbarcode:h["fbarcode"],gconsole:h["gconsole"],mostrarErro:h["mostrarErro"],somar:h["somar"],sql:h["executarSqlProtegido"],unicos:h["unicos"],uuid:h["uuid"],verificarErro:h["verificarErro"]};e["a"]={props:{contexto:{default:function(){return{}},type:Object},estilo:{default:"",type:String},template:{default:"",type:String},script:{default:"{}",type:String}},render:function(t){return""===this.template?t("div"):t("iframe",{on:{load:this.carregarComponente},style:{border:"0",display:"block",height:"100%",width:"100%"}})},watch:{contexto:function(){this.carregarComponente()},estilo:function(){this.carregarComponente()},script:function(){this.carregarComponente()},template:function(){this.carregarComponente()}},methods:{carregarComponente:function(t){var e=this.$el||t.target;if(e){var a=null;try{f=l()({},f,this.contexto);var r=this.template.trim(),i=o()(Function,n()(Object.keys(f)).concat(["return ".concat(this.script.trim())])).apply(void 0,n()(Object.values(f)));a=u["default"].component("Espectador",l()({template:r},i))}catch(t){a=u["default"].component("Erro",{template:'<pre :style="style">'.concat(t.toString(),"</pre>"),computed:{style:function(){return{backgroundColor:"MistyRose",color:"DarkRed",height:"100%",margin:"0",padding:"20px"}}}})}var s=e.contentDocument.body;while(s.firstChild)s.removeChild(s.firstChild);var c=document.createElement("div");s.appendChild(c);var m=document.createElement("style");m.innerHTML=this.estilo.trim(),s.appendChild(m);var p=new u["default"]({name:"quadroVue",render:function(t){return t(a)}});p.$mount(c)}}}}},"96a1":function(t,e,a){"use strict";var r=a("a60d");e["a"]=function(t,e){if(r["a"].is.cordova&&navigator&&navigator.app)return navigator.app.loadUrl(t,{openExternal:!0});var a=window.open(t,"_blank");if(a)return a.focus(),a;e&&e()}},c0d3:function(t,e,a){},f30f:function(t,e,a){}}]);