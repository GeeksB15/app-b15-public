"use strict";(globalThis.webpackChunkb15=globalThis.webpackChunkb15||[]).push([[82],{48308:(e,t,o)=>{o.r(t),o.d(t,{default:()=>It});var a=o(34182);const i={class:"row"},l={class:"col-12 row q-px-md q-mt-lg"},r=(0,a.createElementVNode)("strong",{class:"col-12 text-body1 text-dark"},"Período de Emissão",-1),n={class:"col-6"},s={class:"col-6"},d={class:"col-12 row q-px-md q-mt-lg"},c=(0,a.createElementVNode)("strong",{class:"col-12 text-body1 text-dark"},"Período de Finalização",-1),m={class:"col-6"},u={class:"col-6"},p={class:"col-12 row q-px-md q-mt-lg"},h={class:"row items-center"},f={key:0},V={class:"absolute-full flex flex-center"},g={class:"text-tertiary q-gutter-xs"};var v=o(77365),C=(o(87561),o(72407));o(69145);const N={key:0},x={ref:"form"},w={class:"col-12 col-md"},E={class:"col-auto"},y={class:"col"},k={class:"col-12 col-md"},b={class:"col-auto"},q={class:"col"},I={key:0,class:"col-4"},_={class:"col-6 bg-transparent"},B={class:"col-6 bg-transparent"},D={class:"col-12"},z={class:"col-12 col-md-6"},A={class:"q-item-label q-mb-none",style:{color:"#0c0c0c"}},$=(0,a.createElementVNode)("div",{class:"col-2 col-md"},"Ref/Cód.",-1),P=(0,a.createElementVNode)("div",{class:"col-10 col-md-4"},"Descrição",-1),S=(0,a.createElementVNode)("div",{class:"col-6 col-md text-right"},"Quantidade",-1),F=(0,a.createElementVNode)("div",{class:"col-6 col-md text-right"},"Valor",-1),T=(0,a.createElementVNode)("div",{class:"col-6 col-md text-right"},"Total",-1),L=(0,a.createElementVNode)("div",{class:"col-6 col-md-1 text-right"},"Ações",-1),M={class:"col-2 col-md"},O={key:0},Z={key:1},U={class:"col-10 col-md-4"},H={class:"col-6 col-md text-right"},Q={class:"col-6 col-md text-right"},R={class:"col-6 col-md text-right"},j={key:0,class:"col-6 col-md-1 text-right"},G=(0,a.createElementVNode)("div",{class:"col-2 col-md"},null,-1),X=(0,a.createElementVNode)("div",{class:"col-10 col-md-4"},null,-1),J=(0,a.createElementVNode)("div",{class:"col-6 col-md text-right"},null,-1),K=(0,a.createElementVNode)("div",{class:"col-6 col-md text-right"},null,-1),W={class:"col-6 col-md text-right"},Y=(0,a.createElementVNode)("div",{class:"col-6 col-md-1 text-right"}," ",-1),ee={class:"col-12 col-md-6"},te={class:"q-item-label q-mb-none",style:{color:"#0c0c0c"}},oe=(0,a.createElementVNode)("div",{class:"col-2 col-md"},"Ref/Cód.",-1),ae=(0,a.createElementVNode)("div",{class:"col-10 col-md-4"},"Descrição",-1),ie=(0,a.createElementVNode)("div",{class:"col-6 col-md text-right"},"Quantidade",-1),le=(0,a.createElementVNode)("div",{class:"col-6 col-md text-right"},"Unidade",-1),re=(0,a.createElementVNode)("div",{class:"col-6 col-md text-right"},"Valor",-1),ne=(0,a.createElementVNode)("div",{class:"col-6 col-md text-right"},"Total",-1),se=(0,a.createElementVNode)("div",{class:"col-6 col-md-1 text-right"},"Ações",-1),de={class:"col-2 col-md"},ce={key:0},me={key:1},ue={class:"col-10 col-md-4"},pe={class:"col-6 col-md text-right"},he={class:"col-6 col-md text-right"},fe={class:"col-6 col-md text-right"},Ve={class:"col-6 col-md text-right"},ge={key:0,class:"col-6 col-md-1 text-right"},ve=(0,a.createElementVNode)("div",{class:"col-2 col-md"},null,-1),Ce=(0,a.createElementVNode)("div",{class:"col-10 col-md-4"},null,-1),Ne=(0,a.createElementVNode)("div",{class:"col-6 col-md text-right"},null,-1),xe=(0,a.createElementVNode)("div",{class:"col-6 col-md text-right"},null,-1),we={class:"col-6 col-md text-right"},Ee=(0,a.createElementVNode)("div",{class:"col-6 col-md-1 text-right"}," ",-1),ye={class:"col-12 col-md-12"},ke={class:"q-item-label q-mb-none",style:{color:"#0c0c0c"}},be=(0,a.createElementVNode)("div",{class:"col-6 col-md"},"Data hora inicio",-1),qe=(0,a.createElementVNode)("div",{class:"col-6 col-md"},"Data hora fim",-1),Ie=(0,a.createElementVNode)("div",{class:"col-6 col-md text-right"},"Tempo total",-1),_e=(0,a.createElementVNode)("div",{class:"col-6 col-md text-right"},"Equipamentos",-1),Be=(0,a.createElementVNode)("div",{class:"col-6 col-md text-right"},"Operador",-1),De=(0,a.createElementVNode)("div",{class:"col-6 col-md text-right"},"Quantidade",-1),ze=(0,a.createElementVNode)("div",{class:"col-6 col-md text-right"},"Peso",-1),Ae=(0,a.createElementVNode)("div",{class:"col-6 col-md-1 text-right"},"Ações",-1),$e={class:"col-6 col-md"},Pe={class:"col-6 col-md"},Se={class:"col-6 col-md text-right"},Fe={class:"col-6 col-md text-right"},Te={class:"col-6 col-md text-right"},Le={class:"col-6 col-md text-right"},Me={class:"col-6 col-md text-right"},Oe={class:"col-6 col-md-1 text-right"},Ze={class:"u-container relative-position"};var Ue=o(35451),He=o(33337),Qe=o(48409),Re=o(51746),je=o(62983),Ge=o(54144),Xe=o(13376),Je=o(54726);const Ke={components:{Avatar:He.Z,Badge:C.Z,BadgeCopiarUid:Re.Z,PromptItemV2:je.Z,PromptApontamento:Ge.Z,SeletorCampoTabela:Xe.Z},data:()=>({itens:{},documentoAnterior:{},documentoItensAnterior:[],documento:{id:"",codigoDocumento:"",idEmpresa:"",codigoEmpresa:"",descricaoEmpresa:"",numeroDocumentoEmpresa:"",inscricaoMunicipalEmpresa:"",operacao:"Manipulacao",tipo:"Produção",status:"",dataEmissao:(0,Ue.dataAtual)(),dataFinalizacao:"",observacao:""},documentoItens:[],adicionar:{modal:{name:"",value:!1}},listaApontamentos:[],apontamento:{modal:{name:"",value:!1}},totalOrigem:0,totalDestino:0,visivel:!1,promptApontamento:{},equipamentos:[],composicoes:[],quantidadeOriginal:0,contatos:[],dataPrevistaEntrega:"",horaPrevistaEntrega:"",lote:{show:!1,readonly:!1,value:""}}),emits:["atualizar"],methods:{onHide(){this.$router.replace({params:{id:""}})},zerarCampos(){this.documentoAnterior={},this.documentoItensAnterior=[],this.documento={id:(0,Ue.uuid)(),idEmpresa:"",descricaoEmpresa:"",operacao:"Manipulação",tipo:"Produção",status:"Digitação",dataHoraEmissao:(0,Ue.dataAtual)(),dataHoraFinalizado:"",observacao:""},this.documentoItens=[],this.totalOrigem=0,this.totalDestino=0,this.dataPrevistaEntrega="",this.horaPrevistaEntrega="",this.lote={show:!1,readonly:!1,value:""}},async atualizar(e){if(this.zerarCampos(),e){if(this.documentoAnterior=await $db.itemManipulacao.le({id:e}),this.documento=$utils.clonarV2(this.documentoAnterior),this.documentoItensAnterior=await $db.itemManipulacao.leItens({idDocumento:e}),this.documentoItens=(0,Ue.clonarV2)(this.documentoItensAnterior),this.documento?.idContato){const e=this.documento.idContato;this.contatos[e]||(this.contatos[e]=await $db.contato.le({id:e}))}if(this.documento?.idEmpresa){const e=this.documento.idEmpresa;this.contatos[e]||(this.contatos[e]=await $db.contato.le({id:e}))}this.documento.dataHoraPrevisto&&(this.dataPrevistaEntrega=this.documento.dataHoraPrevisto.slice(0,10),this.horaPrevistaEntrega=this.documento.dataHoraPrevisto.slice(11,16));for(const e of this.documentoItens){if(!this.lote.value&&1===e.operacaoFator&&e.lote&&(this.lote.value=e.lote),!e.idItem)continue;const t=await $erp().item.get(e.idItem);t&&(t.id in this.itens||(this.itens[t.id]={codigoItem:t.codigoItem,referencia:t.referencia}))}}else{let e,t,o;if(t=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data,!(t.length>0))return void this.$q.notify({message:"Não há empresa configurada",timeout:0,type:"negative",closeBtn:!0});if(e=t[0],t.length>1){const t={ativo:!0,empresas:!0};if(e=await $g.promptContato.show({filtro:t,placeholder:"Selecione"}),!e)return this.visivel=!1,void this.$q.notifyError("Empresa não selecionada")}if(o=(await $erp().empresa.where({idContato:e.id}).toArray())[0],!o)return this.visivel=!1,void this.$q.notifyError("Erro ao selecionar empresa");this.documento.descricaoEmpresa=o.nome,this.documento.idEmpresa=o.idContato,this.documento.numeroDocumentoEmpresa=o.numeroDocumentoNacional,this.documento.inscricaoMunicipalEmpresa=o.numeroDocumentoMunicipal}this.somarValorTotal(),this.buscarApontamentos(),await this.configLote()},async configLote(){let e;this.usaLote=!1,this.pcpLote="",e=await $erp().configuracoes.where({nome:"usa.lote"}).toArray(),e=e.find((e=>e.idEmpresa===this.documento.idEmpresa))??e.find((e=>!e.idEmpresa)),this.usaLote="1"===e?.valor,e=await $erp().configuracoes.where({nome:"pcp.lote"}).toArray(),e=e.find((e=>e.idEmpresa===this.documento.idEmpresa))??e.find((e=>!e.idEmpresa)),this.pcpLote=e?.valor,this.lote.show=this.usaLote,this.lote.readonly=!!this.pcpLote,!this.lote.value&&this.pcpLote&&(this.lote.value=this.pcpLote)},async salvar(e,t){try{if(this.dataPrevistaEntrega){const e=`${this.dataPrevistaEntrega} ${this.horaPrevistaEntrega||"00:00:00"}`;this.documento.dataHoraPrevisto=Je.ZP.formatDate(e)}if(null===this.dataPrevistaEntrega&&(this.documento.dataHoraPrevisto=""),this.lote.value!==this.pcpLote)for(const e of this.documentoItens)1===e.operacaoFator&&e.idItem&&(e.lote=this.lote.value);await $db.itemManipulacao.grava({documentoAnterior:this.documentoAnterior,documento:this.documento,documentoItensAnterior:this.documentoItensAnterior,documentoItens:this.documentoItens})}catch(e){this.$q.notifyError("Erro ao salvar",e)}await this.atualizar(this.documento.id),t&&this.$q.notify(t),e||this.$emit("atualizar"),this.visivel=e},async aguardarGeracaoNroPCP(){let e=!0,t=0;$q.loading.show({message:"Aguardando geração do número do PCP para composição do número do lote."}),this.numeroPCP=null;do{await new Promise(((e,t)=>setTimeout(e,1e3)));try{const o=await this.$utils.geeksApi({consultaNumero:{funcao:"185D6D10-9A2A-4965-8C86-90FA2F7F73A2",id:this.documento.id}});o?.data?.consultaNumero?.numero&&(this.numeroPCP=o?.data.consultaNumero.numero,e=!1),10==++t&&(e=!1)}catch(e){console.error(e)}}while(e);if($q.loading.hide(),!this.numeroPCP){const e="Não foi possível obter o número do lote. Por favor, tente novamente.";throw $q.notify({type:"negative",message:e}),new Error(e)}},async gerarNroLote(){const e=new Date;if(this.pcpLote){let t=this.pcpLote;t=t.replace("AAAA",e.toISOString().slice(0,4)),t=t.replace("AA",e.toISOString().slice(2,4)),t=t.replace("MM",e.toISOString().slice(5,7)),t=t.replace("DD",e.toISOString().slice(8,10)),t=t.replace("PCP",String(this.numeroPCP)),this.lote.value=t}},async finalizar(){let e;if(e=this.verificarTotal(),e){if(this.usaLote&&this.pcpLote){let e=!0;for(let t of this.documentoItens)if(1===t.operacaoFator&&t.lote){e=!1;break}e&&(await this.salvar(!0),await this.aguardarGeracaoNroPCP(),await this.gerarNroLote())}this.documento.status="Finalizado",this.documento.dataHoraFinalizado=(0,Ue.dataAtual)();for(let e of this.documentoItens)e.status="Finalizado",e.dataHoraFinalizado=(0,Ue.dataAtual)();this.salvar(!1,"Produção Finalizada")}},reabrir(){try{this.documento.status="Digitação",this.documento.dataHoraFinalizado="";for(let e of this.documentoItens)e.status="Digitação",e.dataHoraFinalizado="";this.salvar(!0,"Produção reaberta")}catch(e){this.$q.notifyError("Erro ao reabrir",e)}},async excluirItem(e){this.documentoItens=this.documentoItens.filter((t=>t.id!==e)),this.somarValorTotal()},async removerTodosItens(e){$q.dialog({title:"Remover todos os itens",message:`Deseja remover todos os itens de ${e}`,cancel:!0,persistent:!0}).onOk((()=>{let t=[];const o="Destino"===e?1:-1;t=this.documentoItens.filter((e=>e.operacaoFator===o));for(const e of t)this.excluirItem(e.id)}))},async recalcularTotal(e,t=!1){if(e.subTotal=(0,Ue.arredondar)(e.quantidade*e.valorItem),e.total=(0,Ue.arredondar)(e.quantidade*e.valorItem),t){let t={titulo:"Composição",msg:"Deseja recalcular a origem?"};1===e.operacaoFator&&await this.verificarComposicao(e.idItem,e.quantidade,t)}this.somarValorTotal()},async recalcularQuantidade(e){e.quantidade=(0,Ue.arredondar)(e.subTotal/e.valorItem),e.total=e.subTotal,this.somarValorTotal()},async recalcularValorItem(e){e.valorItem=(0,Ue.arredondar)(e.subTotal/e.quantidade),e.total=e.subTotal,this.somarValorTotal()},somarValorTotal(){const e=this.documentoItens.filter((e=>-1===e.operacaoFator)).reduce(((e,t)=>e+t.total),0),t=this.documentoItens.filter((e=>1===e.operacaoFator)).reduce(((e,t)=>e+t.total),0);this.totalOrigem=$utils.arredondar(e,2),this.totalDestino=$utils.arredondar(t,2)},verificarTotal(){return 0===this.documentoItens.length&&0===this.totalDestino&&0===this.totalOrigem?(this.$q.notifyError("Selecione alguns itens na lista"),!1):this.totalOrigem===this.totalDestino||(this.$q.notifyError("Valores Totais de Origem e Destino devem ser iguais!"),!1)},async abrirModal(e,t=""){let o={},a=[];const i="Destino"===e?1:-1;a=t?this.documentoItens.filter((e=>e.idItem===t)):this.documentoItens.filter((e=>e.operacaoFator===i));for(const e of a)o[e.idItem]={item:await(0,Qe.X)().item.get(e.idItem)||{},quantidade:e.quantidade};this.$refs.promptItem.itensSelecionados=o,this.$refs.promptItem.termo=t,this.$refs.promptItem.atualizar(),this.adicionar.modal.value=!0,this.adicionar.modal.name=e},async selecionarItens(e){let t=!0,o={};const a="Destino"===this.adicionar.modal.name?1:-1;for(const i in e){let l=await $db.estoqueSaldoProdutoEmpresa.le({idEmpresa:this.documento.idEmpresa,tipoEstoque:"Disponível",idItem:i});l=l[0];const r=await $db.configuracoes.porNome("vendas.checaestoque",this.documento.idEmpresa),n=!!Number(r.find((e=>e.id))?.valor),s=e[i].item||{},d=e[i].quantidade||0,c=(l?.valorCustoMedio||s?.valorCustoReposicao)??0;if(s.id in this.itens||(this.itens[s.id]={codigoItem:s.codigoItem,referencia:s.referencia}),n&&-1===a&&(!l?.saldo||d>l?.saldo)){this.$q.notifyError(`${s.descricao} não disponível no estoque`);continue}let m=this.documentoItens.find((e=>e.idItem===i));m?(m.quantidade=d,m.quantidadeRealizado=d,m.subTotal=(0,Ue.arredondar)(d*c),m.total=(0,Ue.arredondar)(d*c)):this.documentoItens.push({dataHoraEmissao:(0,Ue.dataAtual)(),dataHoraFinalizado:"",descricaoItem:s.descricao,id:(0,Ue.uuid)(),idDocumento:this.documento.id,idItem:s.id,operacao:"Manipulação",operacaoFator:a,quantidade:d,quantidadeRealizado:d,status:"Digitação",tipoItem:s.tipo,subTotal:(0,Ue.arredondar)(d*c),total:(0,Ue.arredondar)(d*c),unidade:s.unidade,valorCustoMedio:l?.valorCustoMedio??0,valorItem:c,valorOriginal:c});let u=await $db.item.leCompleto({id:s.id});this.composicoes.includes(u.atual.composicao[0].idItemUtilizado)||""===u.atual.composicao[0].idItemUtilizado?o={}:(o={titulo:"Composição",msg:"O item selecionado possui itens de composição, deseja preencher?"},1===a&&await this.verificarComposicao(s.id,d,o),t=!1)}this.somarValorTotal()},async verificarComposicao(e,t,o){let a=!1,i=[],l=await $db.item.leCompleto({id:e});l?.atual?.composicao?.sort(((e,t)=>e.ordem<t.ordem?-1:1));for(let e of l.atual.composicao)e.idItemUtilizado&&(e.quantidade=e.quantidade*t,i.push(e),a=!0,this.composicoes.push(e.idItemUtilizado));const r=i.reduce(((e,t)=>(e[t.idItemUtilizado]||(e[t.idItemUtilizado]=t),e)),{});o.titulo?$q.dialog({title:o.titulo,message:o.msg,cancel:!0,persistent:!0}).onOk((()=>{this.adicionar.modal.name="Origem",this.selecionarItens(r),o.titulo=""})):(this.adicionar.modal.name="Origem",this.selecionarItens(r))},async abrirModalApontamento(){this.$refs.promptApontamento.show()},async incluirApontamento(e){let t={id:(0,Ue.uuid)(),documentoItemIdContato:e.operador,idItem:e.equipamento,tipoItem:"ApontamentoPCP",quantidade:e.quantidade,dataHoraEmissao:e.dataIni,dataHoraFinalizado:e.dataFim,peso:e.peso,idDocumento:this.documento.id};try{await $db.documentoItem.grava({atual:t})}catch(e){this.$q.notifyError("Erro ao salvar",e)}this.buscarApontamentos()},async buscarApontamentos(){try{this.listaApontamentos=[],(await $db.documentoItem.leApontamento({tipoItem:"ApontamentoPCP",idDocumento:this.documento.id})).forEach(((e,t)=>{this.listaApontamentos[t]={id:e.id,operador:e.documentoItemIdContato,equipamento:e.idItem,quantidade:e.quantidade,dataIni:e.dataHoraEmissao,dataFim:e.dataHoraFinalizado,peso:e.peso,idDocumento:e.idDocumento}}))}catch(e){this.$q.notifyError("Erro ao consultar apontamentos",e)}},async carregarEquipamentos(){let e=await $db.item.leRefatorado({filtros:{tipo:"Serviço"}});this.equipamentos=e.data.map((e=>({descricao:e.descricao,id:e.id})))},buscaEquipamentoApontado(e){let t=this.equipamentos.find((t=>t.id===e));return t?t.descricao:""},async carregarOperadores(){let e=await $db.contato.leRefatorado({filtros:{}});this.operadores=e.data.map((e=>({nome:e.nome,id:e.id})))},async carregarOperacoes(){let e=await $db.documento.ler({tipo:"Produção"});this.documento.operacoes=e.map((e=>({rotulo:e.operacao,valor:e.operacao})))},buscaOperadorApontado(e){let t=this.operadores.find((t=>t.id===e));return t?t.nome:""},calculoHorasProducao(e,t){let o=new Date(e)-new Date(t);return Math.floor(o%864e5/36e5)+"h "+Math.round(o%864e5%36e5/6e4)+"m"},async removerTodosApontamentos(){$q.dialog({title:"Remover todos os apontamentos",message:"Deseja remover todos os apontamentos de produção",cancel:!0,persistent:!0}).onOk((()=>{for(const e of this.listaApontamentos)this.excluirApontamento(e.id)}))},async excluirApontamento(e){try{await $db.documentoItem.removeApontamento(e),this.listaApontamentos=this.listaApontamentos.filter((t=>t.id!==e)),this.$q.notify("Apontamento removido!")}catch(e){this.$q.notifyError("Não foi possivel remover o apontamento!")}},qtdOriginal(e=0){this.quantidadeOriginal=e},async abrirModalContato(){const e=await this.selecionarContato({placeholder:"Selecione o cliente",filtro:{ativo:!0}});e.id&&(this.documento.idContato=e.id),e.nome&&(this.documento.descricaoContato=e.nome),this.contatos[e.id]||(this.contatos[e.id]=await $db.contato.le({id:e.id}))},async selecionarContato(e){const{placeholder:t,filtro:o}={placeholder:"Selecione o contato",filtro:{ativo:!0},...e},a=await $g.promptContato.show({filtro:o,placeholder:t});if(!a)throw new Error("Contato não selecionado");return a}},async beforeMount(){await this.carregarEquipamentos(),await this.carregarOperadores()}};var We=o(74260),Ye=o(39341),et=o(63626),tt=o(7112),ot=o(54553),at=o(47266),it=o(37617),lt=o(48761),rt=o(24515),nt=o(83054),st=o(74630),dt=o(31106),ct=o(68900),mt=o(4957),ut=o(25901),pt=o(77953),ht=o(60880),ft=o(83831),Vt=o(83671),gt=o(98586),vt=o(7518),Ct=o.n(vt);const Nt=(0,We.Z)(Ke,[["render",function(e,t,o,i,l,r){const n=(0,a.resolveComponent)("q-btn"),s=(0,a.resolveComponent)("q-toolbar-title"),d=(0,a.resolveComponent)("q-toolbar"),c=(0,a.resolveComponent)("q-header"),m=(0,a.resolveComponent)("badge"),u=(0,a.resolveComponent)("BadgeCopiarUid"),p=(0,a.resolveComponent)("avatar"),h=(0,a.resolveComponent)("campo"),f=(0,a.resolveComponent)("row"),V=(0,a.resolveComponent)("SeletorCampoTabela"),g=(0,a.resolveComponent)("q-input"),v=(0,a.resolveComponent)("q-card"),C=(0,a.resolveComponent)("q-icon"),Ue=(0,a.resolveComponent)("q-tooltip"),He=(0,a.resolveComponent)("q-item-label"),Qe=(0,a.resolveComponent)("q-separator"),Re=(0,a.resolveComponent)("q-item-section"),je=(0,a.resolveComponent)("q-item"),Ge=(0,a.resolveComponent)("q-list"),Xe=(0,a.resolveComponent)("q-page"),Je=(0,a.resolveComponent)("q-footer"),Ke=(0,a.resolveComponent)("q-page-container"),We=(0,a.resolveComponent)("q-layout"),Ye=(0,a.resolveComponent)("q-dialog"),et=(0,a.resolveComponent)("PromptItemV2"),tt=(0,a.resolveComponent)("PromptApontamento"),ot=(0,a.resolveDirective)("close-popup");return(0,a.openBlock)(),(0,a.createElementBlock)("div",null,[(0,a.createVNode)(Ye,{modelValue:l.visivel,"onUpdate:modelValue":t[18]||(t[18]=e=>l.visivel=e),maximized:"",onHide:r.onHide},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(We,{class:"bg-light",container:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Ke,{class:"u-container"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(c,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(d,null,{default:(0,a.withCtx)((()=>[(0,a.withDirectives)((0,a.createVNode)(n,{dense:"",flat:"",icon:"arrow_back",round:""},null,512),[[ot]]),(0,a.createVNode)(s,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("Produção (PCP)")])),_:1}),(0,a.createVNode)(n,{class:"q-ml-sm no-shadow",color:"white",unelevated:"","text-color":"primary",label:"Salvar",onClick:t[0]||(t[0]=e=>r.salvar(!1,"Produção salva!"))})])),_:1})])),_:1}),(0,a.createVNode)(Xe,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(d,{class:"q-pa-none q-ma-none q-my-md",color:"none","text-color":"black",style:{"min-height":"auto"}},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(s,{class:"text-black q-px-none text-body2"},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("Emissão: "+(0,a.toDisplayString)(e.$filters.data(l.documento.dataHoraEmissao))+" ",1),l.documento.dataHoraFinalizado?((0,a.openBlock)(),(0,a.createElementBlock)("span",N,"Cancelamento: "+(0,a.toDisplayString)(e.$filters.data(l.documento.dataHoraFinalizado)),1)):(0,a.createCommentVNode)("",!0)])),_:1}),l.documento.status?((0,a.openBlock)(),(0,a.createBlock)(m,{key:0,cor:"positive",class:"q-mx-sm",icone:"flag",escuro:""},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(l.documento.status),1)])),_:1})):(0,a.createCommentVNode)("",!0),l.documento.numero?((0,a.openBlock)(),(0,a.createBlock)(m,{key:1,class:"q-mr-sm",cor:"tertiary",escuro:""},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)(" #"+(0,a.toDisplayString)(l.documento.numero.toString().padStart(6,"0")),1)])),_:1})):((0,a.openBlock)(),(0,a.createBlock)(u,{key:2,id:l.documento.id,numero:l.documento.id.slice(-8),cor:"tertiary"},null,8,["id","numero"]))])),_:1}),(0,a.createVNode)(v,{class:"bg-white q-pa-md q-mt-md no-shadow"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("form",x,[(0,a.createVNode)(f,{class:"q-col-gutter-sm"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",w,[(0,a.createVNode)(f,null,{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",E,[(0,a.createVNode)(p,{imagem:l.contatos[l.documento.idEmpresa]?.imagem??"",rotulo:l.contatos[l.documento.idEmpresa]?.nome??"",tamanho:"30",style:{float:"left"},class:"q-mr-sm"},null,8,["imagem","rotulo"])]),(0,a.createElementVNode)("div",y,[(0,a.createVNode)(h,{somenteLeitura:"",rotulo:"Empresa",tipo:"texto",class:"col-10",modelValue:l.documento.descricaoEmpresa,"onUpdate:modelValue":t[1]||(t[1]=e=>l.documento.descricaoEmpresa=e)},null,8,["modelValue"])])])),_:1})]),(0,a.createElementVNode)("div",k,[(0,a.createVNode)(f,null,{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",b,[(0,a.createVNode)(p,{imagem:l.contatos[l.documento.idContato]?.imagem??"",rotulo:l.contatos[l.documento.idEmpresa]?.nome??"",tamanho:"30",style:{float:"left"},class:"q-mr-sm"},null,8,["imagem","rotulo"])]),(0,a.createElementVNode)("div",q,[(0,a.createVNode)(h,{somenteLeitura:"",placeholder:"Cliente",rotulo:"Cliente",tipo:"texto",after:[{icon:"search",handler(){r.abrirModalContato()}}],modelValue:l.documento.descricaoContato,"onUpdate:modelValue":t[2]||(t[2]=e=>l.documento.descricaoContato=e)},null,8,["after","modelValue"])])])),_:1})])])),_:1}),(0,a.createVNode)(f,null,{default:(0,a.withCtx)((()=>[l.lote.show?((0,a.openBlock)(),(0,a.createElementBlock)("div",I,[(0,a.createVNode)(h,{modelValue:l.lote.value,"onUpdate:modelValue":t[3]||(t[3]=e=>l.lote.value=e),"somente-leitura":l.lote.readonly,rotulo:"Lote",tipo:"texto"},null,8,["modelValue","somente-leitura"])])):(0,a.createCommentVNode)("",!0),(0,a.createElementVNode)("div",{class:(0,a.normalizeClass)(l.lote.show?"col-4":"col-6"),onClick:t[5]||(t[5]=(...e)=>r.carregarOperacoes&&r.carregarOperacoes(...e))},[(0,a.createVNode)(V,{modelValue:l.documento.operacao,"onUpdate:modelValue":t[4]||(t[4]=e=>l.documento.operacao=e),filtro:{tipo:"Produção"},tabela:"documento",campo:"operacao",label:"Operação",buscarSemCaractere:!0,enableAdd:""},null,8,["modelValue"])],2),(0,a.createElementVNode)("div",{class:(0,a.normalizeClass)(l.lote.show?"col-4":"col-6")},[(0,a.createVNode)(f,null,{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",_,[(0,a.createVNode)(g,{modelValue:l.dataPrevistaEntrega,"onUpdate:modelValue":t[6]||(t[6]=e=>l.dataPrevistaEntrega=e),type:"date",clearable:"",dense:"","stack-label":"",label:"Data Prevista de Entrega"},null,8,["modelValue"])]),(0,a.createElementVNode)("div",B,[(0,a.createVNode)(g,{modelValue:l.horaPrevistaEntrega,"onUpdate:modelValue":t[7]||(t[7]=e=>l.horaPrevistaEntrega=e),type:"time",clearable:"",dense:"","stack-label":"",label:"Hora Prevista de Entrega"},null,8,["modelValue"])])])),_:1})],2),(0,a.createElementVNode)("div",D,[(0,a.createVNode)(h,{modelValue:l.documento.observacao,"onUpdate:modelValue":t[8]||(t[8]=e=>l.documento.observacao=e),rotulo:"Observação",rows:"1",tipo:"textoArea"},null,8,["modelValue"])])])),_:1})],512)])),_:1}),(0,a.createVNode)(f,{class:"q-col-gutter-x-sm q-mt-md"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",z,[(0,a.createVNode)(v,{class:"no-shadow bg-white full-width fit q-pa-md"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(d,{class:"q-pa-none q-ma-none q-mb-md",color:"none","text-color":"black",style:{"min-height":"auto"}},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("p",A,[(0,a.createVNode)(C,{class:"q-mr-md",name:"shopping_cart",size:"24px",style:{color:"#737373"}}),(0,a.createTextVNode)(" Origem ")]),(0,a.createVNode)(s,{class:"q-pa-none q-ma-none",style:{height:"0 !important","min-height":"auto"}}),"Digitação"===l.documento.status?((0,a.openBlock)(),(0,a.createBlock)(n,{key:0,color:"tertiary",dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:t[9]||(t[9]=e=>r.removerTodosItens("Origem"))},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Ue,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("Remover todos")])),_:1})])),_:1})):(0,a.createCommentVNode)("",!0),"Digitação"===l.documento.status?((0,a.openBlock)(),(0,a.createBlock)(n,{key:1,color:"positive",dense:"",flat:"",icon:"add",round:"",size:"md",onClick:t[10]||(t[10]=e=>r.abrirModal("Origem"))},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Ue,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("Adicionar Item")])),_:1})])),_:1})):(0,a.createCommentVNode)("",!0)])),_:1}),(0,a.createVNode)(Ge,{class:"col-12 no-border q-mx-none q-pa-none"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(je,{class:"q-pa-none"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Re,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(He,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(f,{class:"q-col-gutter-md text-weight-bold text-left justify-around"},{default:(0,a.withCtx)((()=>[$,P,S,F,T,L])),_:1})])),_:1}),(0,a.createVNode)(Qe,{class:"q-my-xs"}),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(l.documentoItens,((e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)("div",{key:t},[-1===e.operacaoFator?((0,a.openBlock)(),(0,a.createBlock)(He,{key:0,caption:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(f,{class:"text-left justify-around"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",M,[l.itens[e.idItem]?.referencia?((0,a.openBlock)(),(0,a.createElementBlock)("span",O,(0,a.toDisplayString)(l.itens[e.idItem]?.referencia),1)):l.itens[e.idItem]?.codigoItem?((0,a.openBlock)(),(0,a.createElementBlock)("span",Z," #"+(0,a.toDisplayString)(l.itens[e.idItem]?.codigoItem),1)):(0,a.createCommentVNode)("",!0)]),(0,a.createElementVNode)("div",U,(0,a.toDisplayString)(e.descricaoItem||"-"),1),(0,a.createElementVNode)("div",H,[(0,a.createVNode)(h,{modelValue:e.quantidade,"onUpdate:modelValue":t=>e.quantidade=t,somenteLeitura:"Finalizado"===l.documento.status,decimals:"4",tipo:"decimal",onBlur:t=>r.recalcularTotal(e,!0)},null,8,["modelValue","onUpdate:modelValue","somenteLeitura","onBlur"])]),(0,a.createElementVNode)("div",Q,[(0,a.createVNode)(h,{modelValue:e.valorItem,"onUpdate:modelValue":t=>e.valorItem=t,decimals:"4",disable:"",tipo:"decimal",somenteLeitura:"Finalizado"===l.documento.status,onBlur:t=>r.recalcularTotal(e)},null,8,["modelValue","onUpdate:modelValue","somenteLeitura","onBlur"])]),(0,a.createElementVNode)("div",R,[(0,a.createVNode)(h,{modelValue:e.subTotal,"onUpdate:modelValue":t=>e.subTotal=t,somenteLeitura:"Finalizado"===l.documento.status,decimals:"4",tipo:"decimal",onBlur:t=>r.recalcularQuantidade(e)},null,8,["modelValue","onUpdate:modelValue","somenteLeitura","onBlur"])]),"Digitação"===l.documento.status?((0,a.openBlock)(),(0,a.createElementBlock)("div",j,[(0,a.createVNode)(n,{dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:t=>r.excluirItem(e.id)},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Ue,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("Excluir")])),_:1})])),_:2},1032,["onClick"])])):(0,a.createCommentVNode)("",!0)])),_:2},1024)])),_:2},1024)):(0,a.createCommentVNode)("",!0),-1===e.operacaoFator?((0,a.openBlock)(),(0,a.createBlock)(Qe,{key:1,class:"q-my-xs"})):(0,a.createCommentVNode)("",!0),-1===e.operacaoFator?((0,a.openBlock)(),(0,a.createBlock)(He,{key:2,caption:""})):(0,a.createCommentVNode)("",!0)])))),128))])),_:1})])),_:1}),(0,a.createVNode)(je,{class:"q-pa-none"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Re,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(He,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(f,{class:"text-weight-bold text-left justify-around"},{default:(0,a.withCtx)((()=>[G,X,J,K,(0,a.createElementVNode)("div",W,(0,a.toDisplayString)(e.$filters.numero(l.totalOrigem,2)),1),Y])),_:1})])),_:1})])),_:1})])),_:1}),(0,a.createVNode)(je,{class:"q-px-none"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Re,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(He,{class:"text-center"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(n,{class:"q-mx-auto",color:"positive",icon:"add",label:"Adicionar item",outline:"",size:"xs",onClick:t[11]||(t[11]=e=>r.abrirModal("Origem"))})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})]),(0,a.createElementVNode)("div",ee,[(0,a.createVNode)(v,{class:"no-shadow bg-white full-width fit q-pa-md"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(d,{class:"q-pa-none q-ma-none q-mb-md",color:"none","text-color":"black",style:{"min-height":"auto"}},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("p",te,[(0,a.createVNode)(C,{class:"q-mr-md",name:"shopping_cart",size:"24px",style:{color:"#737373"}}),(0,a.createTextVNode)(" Destino ")]),(0,a.createVNode)(s,{class:"q-pa-none q-ma-none",style:{height:"0 !important","min-height":"auto"}}),"Digitação"===l.documento.status?((0,a.openBlock)(),(0,a.createBlock)(n,{key:0,color:"tertiary",dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:t[12]||(t[12]=e=>r.removerTodosItens("Destino"))},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Ue,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("Remover todos")])),_:1})])),_:1})):(0,a.createCommentVNode)("",!0),"Digitação"===l.documento.status?((0,a.openBlock)(),(0,a.createBlock)(n,{key:1,color:"positive",dense:"",flat:"",icon:"add",round:"",size:"md",onClick:t[13]||(t[13]=e=>r.abrirModal("Destino"))},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Ue,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("Adicionar Item")])),_:1})])),_:1})):(0,a.createCommentVNode)("",!0)])),_:1}),(0,a.createVNode)(Ge,{class:"col-12 no-border q-mx-none q-pa-none"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(je,{class:"q-pa-none"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Re,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(He,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(f,{class:"q-col-gutter-md text-weight-bold text-left justify-around"},{default:(0,a.withCtx)((()=>[oe,ae,ie,le,re,ne,se])),_:1})])),_:1}),(0,a.createVNode)(Qe,{class:"q-my-xs"}),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(l.documentoItens,((e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)("div",{key:t},[1===e.operacaoFator?((0,a.openBlock)(),(0,a.createBlock)(He,{key:0,caption:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(f,{class:"text-left justify-around"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",de,[l.itens[e.idItem]?.referencia?((0,a.openBlock)(),(0,a.createElementBlock)("span",ce,(0,a.toDisplayString)(l.itens[e.idItem]?.referencia),1)):l.itens[e.idItem]?.codigoItem?((0,a.openBlock)(),(0,a.createElementBlock)("span",me," #"+(0,a.toDisplayString)(l.itens[e.idItem]?.codigoItem),1)):(0,a.createCommentVNode)("",!0)]),(0,a.createElementVNode)("div",ue,(0,a.toDisplayString)(e.descricaoItem||"-"),1),(0,a.createElementVNode)("div",pe,[(0,a.createVNode)(h,{modelValue:e.quantidade,"onUpdate:modelValue":t=>e.quantidade=t,somenteLeitura:"Finalizado"===l.documento.status,decimals:"4",tipo:"decimal",onMouseover:t=>r.qtdOriginal(e.quantidade),onBlur:t=>r.recalcularTotal(e,e.quantidade!==l.quantidadeOriginal)},null,8,["modelValue","onUpdate:modelValue","somenteLeitura","onMouseover","onBlur"])]),(0,a.createElementVNode)("div",he,(0,a.toDisplayString)(e.unidade),1),(0,a.createElementVNode)("div",fe,[(0,a.createVNode)(h,{modelValue:e.valorItem,"onUpdate:modelValue":t=>e.valorItem=t,somenteLeitura:"Finalizado"===l.documento.status,class:"col",decimals:"4",tipo:"decimal",onBlur:t=>r.recalcularTotal(e)},null,8,["modelValue","onUpdate:modelValue","somenteLeitura","onBlur"])]),(0,a.createElementVNode)("div",Ve,[(0,a.createVNode)(h,{modelValue:e.subTotal,"onUpdate:modelValue":t=>e.subTotal=t,somenteLeitura:"Finalizado"===l.documento.status,decimals:"4",tipo:"decimal",onBlur:t=>r.recalcularValorItem(e)},null,8,["modelValue","onUpdate:modelValue","somenteLeitura","onBlur"])]),"Digitação"===l.documento.status?((0,a.openBlock)(),(0,a.createElementBlock)("div",ge,[(0,a.createVNode)(n,{dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:t=>r.excluirItem(e.id)},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Ue,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("Excluir")])),_:1})])),_:2},1032,["onClick"])])):(0,a.createCommentVNode)("",!0)])),_:2},1024)])),_:2},1024)):(0,a.createCommentVNode)("",!0),1===e.operacaoFator?((0,a.openBlock)(),(0,a.createBlock)(Qe,{key:1,class:"q-my-xs"})):(0,a.createCommentVNode)("",!0),1===e.operacaoFator?((0,a.openBlock)(),(0,a.createBlock)(He,{key:2,caption:""})):(0,a.createCommentVNode)("",!0)])))),128))])),_:1})])),_:1}),(0,a.createVNode)(je,{class:"q-pa-none"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Re,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(He,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(f,{class:"text-weight-bold text-left justify-around"},{default:(0,a.withCtx)((()=>[ve,Ce,Ne,xe,(0,a.createElementVNode)("div",we,(0,a.toDisplayString)(e.$filters.numero(l.totalDestino,2)),1),Ee])),_:1})])),_:1})])),_:1})])),_:1}),(0,a.createVNode)(je,{class:"q-px-none"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Re,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(He,{class:"text-center"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(n,{class:"q-mx-auto",color:"positive",icon:"add",label:"Adicionar item",outline:"",size:"xs",onClick:t[14]||(t[14]=e=>r.abrirModal("Destino"))})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])])),_:1}),(0,a.createVNode)(f,{class:"q-col-gutter-x-sm q-mt-md"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",ye,[(0,a.createVNode)(v,{class:"no-shadow bg-white full-width fit q-pa-md"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(d,{class:"q-pa-none q-ma-none q-mb-md",color:"none","text-color":"black",style:{"min-height":"auto"}},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("p",ke,[(0,a.createVNode)(C,{class:"q-mr-md",name:"content_paste",size:"24px",style:{color:"#737373"}}),(0,a.createTextVNode)(" Apontamentos ")]),(0,a.createVNode)(s,{class:"q-pa-none q-ma-none",style:{height:"0 !important","min-height":"auto"}}),"Digitação"===l.documento.status?((0,a.openBlock)(),(0,a.createBlock)(n,{key:0,color:"tertiary",dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:t[15]||(t[15]=e=>r.removerTodosApontamentos())},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Ue,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("Remover todos")])),_:1})])),_:1})):(0,a.createCommentVNode)("",!0),"Digitação"===l.documento.status?((0,a.openBlock)(),(0,a.createBlock)(n,{key:1,color:"positive",dense:"",flat:"",icon:"add",round:"",size:"md",onClick:t[16]||(t[16]=e=>r.abrirModalApontamento())},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Ue,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("Adicionar Apontamento")])),_:1})])),_:1})):(0,a.createCommentVNode)("",!0)])),_:1}),(0,a.createVNode)(Ge,{class:"col-12 no-border q-mx-none q-pa-none"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(je,{class:"q-pa-none"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Re,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(He,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(f,{class:"q-col-gutter-md text-weight-bold text-left justify-around"},{default:(0,a.withCtx)((()=>[be,qe,Ie,_e,Be,De,ze,Ae])),_:1})])),_:1}),(0,a.createVNode)(Qe,{class:"q-my-xs"}),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(l.listaApontamentos,((t,o)=>((0,a.openBlock)(),(0,a.createElementBlock)("div",{key:o},[(0,a.createVNode)(He,{caption:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(f,{class:"text-left justify-around"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",$e,(0,a.toDisplayString)(e.$filters.dataHora(t.dataIni)),1),(0,a.createElementVNode)("div",Pe,(0,a.toDisplayString)(e.$filters.dataHora(t.dataFim)),1),(0,a.createElementVNode)("div",Se,(0,a.toDisplayString)(r.calculoHorasProducao(t.dataFim,t.dataIni)),1),(0,a.createElementVNode)("div",Fe,(0,a.toDisplayString)(r.buscaEquipamentoApontado(t.equipamento)),1),(0,a.createElementVNode)("div",Te,(0,a.toDisplayString)(r.buscaOperadorApontado(t.operador)),1),(0,a.createElementVNode)("div",Le,(0,a.toDisplayString)(e.$filters.numeroZerosDireita(t.quantidade,4,0)),1),(0,a.createElementVNode)("div",Me,(0,a.toDisplayString)(e.$filters.numeroZerosDireita(t.peso,4,0)),1),(0,a.createElementVNode)("div",Oe,[(0,a.createVNode)(n,{dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:e=>r.excluirApontamento(t.id)},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Ue,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("Excluir")])),_:1})])),_:2},1032,["onClick"])])])),_:2},1024)])),_:2},1024)])))),128))])),_:1})])),_:1}),(0,a.createVNode)(je,{class:"q-px-none"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Re,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(He,{class:"text-center"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(n,{class:"q-mx-auto",color:"positive",icon:"add",label:"Adicionar apontamento",outline:"",size:"xs",onClick:t[17]||(t[17]=e=>r.abrirModalApontamento())})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])])),_:1})])),_:1}),(0,a.createVNode)(Je,{class:"bg-light no-shadow q-pa-sm text-right",bordered:""},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",Ze,[(0,a.createVNode)(s,{class:"text-right"},{default:(0,a.withCtx)((()=>["Finalizado"===l.documento.status?((0,a.openBlock)(),(0,a.createBlock)(n,{key:0,color:"primary",label:"Reabrir",onClick:r.reabrir},null,8,["onClick"])):(0,a.createCommentVNode)("",!0),"Digitação"===l.documento.status?((0,a.openBlock)(),(0,a.createBlock)(n,{key:1,color:"primary",label:"Finalizar",onClick:r.finalizar},null,8,["onClick"])):(0,a.createCommentVNode)("",!0)])),_:1})])])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue","onHide"]),(0,a.createVNode)(et,{modelValue:l.adicionar.modal.value,"onUpdate:modelValue":t[19]||(t[19]=e=>l.adicionar.modal.value=e),habilitarQuantidade:!0,filtro:{ativo:!0,idEmpresa:l.documento.idEmpresa},exibirValorVenda:!1,onSelecionarItens:r.selecionarItens,ref:"promptItem"},null,8,["modelValue","filtro","onSelecionarItens"]),(0,a.createVNode)(tt,{onIncluirApontamento:r.incluirApontamento,habilitarQuantidade:!0,ref:"promptApontamento"},null,8,["onIncluirApontamento"])])}]]);Ct()(Ke,"components",{QDialog:Ye.Z,QLayout:et.Z,QPageContainer:tt.Z,QHeader:ot.Z,QToolbar:at.Z,QBtn:it.Z,QToolbarTitle:lt.Z,QPage:rt.Z,QCard:nt.Z,QInput:st.Z,QItemLabel:dt.Z,QIcon:ct.Z,QTooltip:mt.Z,QList:ut.Z,QItem:pt.Z,QItemSection:ht.Z,QSeparator:ft.Z,QFooter:Vt.Z}),Ct()(Ke,"directives",{ClosePopup:gt.Z});var xt=o(12019),wt=o(88603);const Et={components:{lista:v.Z,Badge:C.Z,ItensManipulacao:Nt,BadgeCopiarUid:Re.Z},data:()=>({paginacao:{atual:1,minimo:1,maximo:1,total:1,limite:25},filtros:{tab:"digitacao",empresa:{selecionada:"",opcoes:[]},periodoEmissao:{ini:"",fim:""},periodoFinalizado:{ini:"",fim:""}},documentos:[],tabs:[{rotulo:"Digitação",value:"digitacao"},{rotulo:"Finalizados",value:"finalizado"},{rotulo:"Todos",value:"Todos"}],tabSelecionada:{valor:"digitacao"},listaLayout:{},documentoItens:null,buscaCampo:"",checkboxModel:[],configImpressao:[]}),watch:{showFilters:function(e){!0===e?this.showList=!1:!0!==this.section&&!0!==this.kanban&&!0!==this.gantt||(this.showList=!0)}},methods:{async atualizar(){this.filtros.tab=this.tabSelecionada.valor;try{this.$q.loading.show();const e=this.paginacao.limite,t=this.paginacao.atual,o="descricao";let a="";"digitacao"===this.filtros.tab?a="Digitação":"finalizado"===this.filtros.tab&&(a="Finalizado");let i=this.filtros.empresa.selecionada.value||"";this.filtros.idEmpresa=i;let l={};if(this.buscaCampo){let i=this.$utils.eliminarVazios(this.filtros);i.termoBusca=this.buscaCampo,i.status=a,l=await this.filtrarCampos(i,e,t,o)}else{let i=this.$utils.eliminarVazios(this.filtros);i.status=a,l=await this.filtrarCampos(i,e,t,o)}this.listaLayout={};for(let e of l.data)this.listaLayout[e.id]={detalhes:!1};this.documentos=l.data,this.calcularPorcentagem(this.documentos),this.paginacao.total=l.total,this.paginacao.maximo=l.totalPages,this.configuraImpressao(this.filtros.idEmpresa)}catch(e){this.$q.notifyError("Erro iniciar",e)}finally{this.$q.loading.hide()}},filtrarCampos:async(e,t,o,a)=>(console.log({filtros:e}),xt.db.itemManipulacao.leRefatorado({filtros:e,limit:t,page:o,sort:a})),limparFiltros_click(){this.filtros={tab:this.tabAtiva,empresa:{selecionada:"",opcoes:[]},periodoEmissao:{ini:"",fim:""},periodoFinalizado:{ini:"",fim:""}},this.atualizar()},async showDetails(e){let t=await xt.db.itemManipulacao.leItens({idDocumento:e.id});e.documentoItens=t,e.showPreviewDetail=!e.showPreviewDetail},async editarManipulacao(e){this.$router.replace({params:{id:e}}),await this.$refs.itensManipulacao.atualizar(e),this.$refs.itensManipulacao.visivel=!0},async adicionarManipulacaoItens(){await this.$refs.itensManipulacao.atualizar(),this.$refs.itensManipulacao.visivel=!0},async filtrar(e=1){this.buscaCampo="";const t=(e-1)*this.pageSize;this.documentos.status="digitacao";let o=await xt.db.itemManipulacao.le({periodoEmissao:{ini:this.filtro.periodoEmissao.ini,fim:this.filtro.periodoEmissao.fim},periodoFinalizado:{ini:this.filtro.periodoFinalizado.ini,fim:this.filtro.periodoFinalizado.fim},status:this.page.ativa,idEmpresa:this.filtro.empresas.selected,offset:t,limit:this.pageSize});this.documentos=o[0].map((e=>({...e,showPreviewDetail:!1,documentoItens:[]}))),this.documentos=(0,wt.orderBy)(this.documentos,["dataHoraFinalizado","dataHoraEmissao"],["desc","desc"]);let a=o[1];this.page.digitacao.max=Math.ceil(a/this.pageSize),this.page.finalizado.max=Math.ceil(a/this.pageSize)},excluir(e){$q.dialog({cancel:{label:"Não",push:!0,color:"tertiary",flat:!0},title:"Remover",message:"Ao continuar você irá remover este item.",ok:{label:"Sim",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk((async()=>{try{$q.loading.show(),await xt.db.itemManipulacao.remove(e),this.atualizar(),$q.notifyPositive("O item foi excluído com sucesso.")}catch(e){$q.notifyError("Ocorreu um erro ao remover item",e)}finally{$q.loading.hide()}}))},async empresaOpcoesCarregar(){console.log("carregar empresas"),this.filtros.empresa.opcoes=(await xt.db.empresa.le()).map((e=>({rotulo:e.nome,valor:e.idContato})))},async configuraImpressao(e){const t=await $db.configuracoes.porNome("impressao.producao",e);this.configImpressao=[...t.length?t.map((e=>({texto:"Imprimir Composição",...e}))):[{valor:"Impressao-ordem-producao",texto:"Ordem de Produção"},{valor:"impressao-etiqueta-pcp1",texto:"Etiq. 2 - Semi Acabado"},{valor:"impressao-etiqueta-pcp2",texto:"Etiq. 1 - Acabado"}]]},async calcularPorcentagem(e){for(let t=0;t<e.length;t++){let o=0,a=0,i=await xt.db.itemManipulacao.leItens({idDocumento:e[t].id}),l=await xt.db.documentoItem.leApontamento({tipoItem:"ApontamentoPCP",idDocumento:e[t].id});i.forEach(((e,t)=>{e?1===e.operacaoFator&&(o+=e.quantidade):o+=0})),l.forEach(((e,t)=>{e?"ApontamentoPCP"===e.tipoItem&&(a+=e.quantidade):a+=0})),0===o?(e[t].porcentagemApontamento=0,e[t].porcentagemApontamentoLabel="0 %"):(e[t].porcentagemApontamento=a/o,e[t].porcentagemApontamentoLabel=`${Math.round(a/o*100)} %`)}}},created(){this.atualizar()},mounted(){this.$route.params.id&&this.$route.params.id.length&&(this.$refs.itensManipulacao.atualizar(this.$route.params.id),this.$refs.itensManipulacao.visivel=!0)}};var yt=o(40320),kt=o(98482),bt=o(76106),qt=o(54707);const It=(0,We.Z)(Et,[["render",function(e,t,o,v,C,N){const x=(0,a.resolveComponent)("campo"),w=(0,a.resolveComponent)("q-select"),E=(0,a.resolveComponent)("badge"),y=(0,a.resolveComponent)("BadgeCopiarUid"),k=(0,a.resolveComponent)("q-item-section"),b=(0,a.resolveComponent)("q-item-label"),q=(0,a.resolveComponent)("q-icon"),I=(0,a.resolveComponent)("q-tooltip"),_=(0,a.resolveComponent)("q-badge"),B=(0,a.resolveComponent)("q-linear-progress"),D=(0,a.resolveComponent)("q-btn"),z=(0,a.resolveComponent)("q-item"),A=(0,a.resolveComponent)("q-list"),$=(0,a.resolveComponent)("q-menu"),P=(0,a.resolveComponent)("q-separator"),S=(0,a.resolveComponent)("lista"),F=(0,a.resolveComponent)("ItensManipulacao");return(0,a.openBlock)(),(0,a.createElementBlock)("div",null,[(0,a.createVNode)(S,{titulo:"Produção (PCP)",onCriar_click:N.adicionarManipulacaoItens,showAdd:!1,showToolbar:!1,icone:"mdi-set-center-right",onFiltro_change:N.atualizar,onLimparFiltros_click:N.limparFiltros_click,tabSelecionada:C.tabSelecionada,tabs:C.tabs,listaLayout:C.listaLayout,paginacao:C.paginacao,filtros:C.filtros,buscaCampo:C.buscaCampo,"onUpdate:buscaCampo":t[7]||(t[7]=e=>C.buscaCampo=e),checkboxModel:C.checkboxModel,"onUpdate:checkboxModel":t[8]||(t[8]=e=>C.checkboxModel=e)},{filtroCampos:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",i,[(0,a.createElementVNode)("div",{class:"col-12 q-px-sm",onClick:t[1]||(t[1]=(...e)=>N.empresaOpcoesCarregar&&N.empresaOpcoesCarregar(...e))},[(0,a.createVNode)(x,{modelValue:C.filtros.empresa.selecionada,"onUpdate:modelValue":t[0]||(t[0]=e=>C.filtros.empresa.selecionada=e),opcoes:C.filtros.empresa.opcoes,rotulo:"Por Empresa",tipo:"seletor"},null,8,["modelValue","opcoes"])]),(0,a.createElementVNode)("div",l,[r,(0,a.createElementVNode)("div",n,[(0,a.createVNode)(x,{modelValue:C.filtros.periodoEmissao.ini,"onUpdate:modelValue":t[2]||(t[2]=e=>C.filtros.periodoEmissao.ini=e),after:[{icon:"mdi-close-circle",handler(){C.filtros.periodoEmissao.ini=""}}],class:"no-shadow full-width",rotulo:"De",tipo:"data"},null,8,["modelValue","after"])]),(0,a.createElementVNode)("div",s,[(0,a.createVNode)(x,{modelValue:C.filtros.periodoEmissao.fim,"onUpdate:modelValue":t[3]||(t[3]=e=>C.filtros.periodoEmissao.fim=e),after:[{icon:"mdi-close-circle",handler(){C.filtros.periodoEmissao.fim=""}}],class:"no-shadow full-width",rotulo:"até",tipo:"data"},null,8,["modelValue","after"])])]),(0,a.createElementVNode)("div",d,[c,(0,a.createElementVNode)("div",m,[(0,a.createVNode)(x,{modelValue:C.filtros.periodoFinalizado.ini,"onUpdate:modelValue":t[4]||(t[4]=e=>C.filtros.periodoFinalizado.ini=e),after:[{icon:"mdi-close-circle",handler(){C.filtros.periodoFinalizado.ini=""}}],class:"no-shadow full-width",rotulo:"De",tipo:"data"},null,8,["modelValue","after"])]),(0,a.createElementVNode)("div",u,[(0,a.createVNode)(x,{modelValue:C.filtros.periodoFinalizado.fim,"onUpdate:modelValue":t[5]||(t[5]=e=>C.filtros.periodoFinalizado.fim=e),after:[{icon:"mdi-close-circle",handler(){C.filtros.periodoFinalizado.fim=""}}],class:"no-shadow full-width",rotulo:"até",tipo:"data"},null,8,["modelValue","after"])])]),(0,a.createElementVNode)("div",p,[(0,a.createVNode)(w,{modelValue:C.paginacao.limite,"onUpdate:modelValue":t[6]||(t[6]=e=>C.paginacao.limite=e),options:[10,25,50,100],placeholder:"Quantidade por página"},null,8,["modelValue"])])])])),itemLista:(0,a.withCtx)((()=>[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(C.documentos,(t=>((0,a.openBlock)(),(0,a.createBlock)(A,{key:t.id,class:"q-py-none qListaItems",style:{border:"none !important"}},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(z,{class:"items-center d-flex"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(k,{avatar:"",center:""},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",h,[t.numero?((0,a.openBlock)(),(0,a.createBlock)(E,{key:0,class:"q-mr-sm",cor:"tertiary",escuro:""},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)(" #"+(0,a.toDisplayString)(t.numero.toString().padStart(6,"0")),1)])),_:2},1024)):((0,a.openBlock)(),(0,a.createBlock)(y,{key:1,id:t.id,numero:t.id.slice(-8),cor:"tertiary"},null,8,["id","numero"]))])])),_:2},1024),(0,a.createVNode)(k,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(b,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(t.descricaoEmpresa),1)])),_:2},1024)])),_:2},1024),(0,a.createVNode)(k,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(b,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(t.descricaoContato),1)])),_:2},1024)])),_:2},1024),(0,a.createVNode)(k,{caption:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(b,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(q,{class:"text-tertiary",name:"event"}),(0,a.createTextVNode)(" "+(0,a.toDisplayString)(e.$filters.data(t.dataHoraEmissao)),1)])),_:2},1024),(0,a.createVNode)(I,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("Data Emissão "+(0,a.toDisplayString)(e.$filters.dataHora(t.dataHoraEmissao)),1)])),_:2},1024)])),_:2},1024),"digitacao"!==C.tabSelecionada.valor?((0,a.openBlock)(),(0,a.createBlock)(k,{key:0,caption:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(b,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(q,{class:"text-tertiary",name:"event"}),(0,a.createTextVNode)(" "+(0,a.toDisplayString)(e.$filters.data(t.dataHoraFinalizado)),1)])),_:2},1024),(0,a.createVNode)(I,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("Data Finalizado "+(0,a.toDisplayString)(e.$filters.dataHora(t.dataHoraFinalizado)),1)])),_:2},1024)])),_:2},1024)):(0,a.createCommentVNode)("",!0),(0,a.createVNode)(k,{caption:""},{default:(0,a.withCtx)((()=>[t.porcentagemApontamento>0?((0,a.openBlock)(),(0,a.createElementBlock)("div",f,[(0,a.createVNode)(b,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(B,{stripe:"",rounded:"",size:"20px",value:t.porcentagemApontamento,color:"secondary",class:"q-mt-sm"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",V,[(0,a.createVNode)(_,{color:"white","text-color":"secondary",label:t.porcentagemApontamentoLabel},null,8,["label"])])])),_:2},1032,["value"])])),_:2},1024),(0,a.createVNode)(I,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(t.porcentagemApontamentoLabel)+" Concluída ",1)])),_:2},1024)])):(0,a.createCommentVNode)("",!0)])),_:2},1024),(0,a.createVNode)(k,{avatar:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(E,{class:"q-mr-sm",cor:"warning",escuro:""},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(t.status),1)])),_:2},1024)])),_:2},1024),(0,a.createVNode)(k,{avatar:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(E,{class:"q-mr-sm",cor:"primary",escuro:""},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(t.operacao),1)])),_:2},1024)])),_:2},1024),(0,a.createVNode)(k,{side:"",top:""},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",g,[(0,a.createVNode)(D,{icon:t.showPreviewDetail?"keyboard_arrow_up":"keyboard_arrow_down",class:"buttons",color:"tertiary",dense:"",flat:"",round:"",size:"md",onClick:e=>N.showDetails(t)},null,8,["icon","onClick"]),(0,a.createVNode)(D,{rounded:"",dense:"",flat:"",icon:"print",color:"primary",class:"no-shadow q-mx-xs",size:"md",style:{float:"right"}},{default:(0,a.withCtx)((()=>[(0,a.createVNode)($,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(A,{link:"",separator:""},{default:(0,a.withCtx)((()=>[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(C.configImpressao.filter((e=>e.valor)),(o=>((0,a.openBlock)(),(0,a.createBlock)(z,{clickable:"",key:o.valor,onClick:a=>e.$imprimir(o.valor,(t||{}).id||"0")},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(k,{avatar:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(q,{name:"print"})])),_:1}),(0,a.createVNode)(k,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(b,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(o.texto),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:2},1024)])),_:2},1024)])),_:2},1024),(0,a.createVNode)(D,{class:"buttons",color:"primary",dense:"",flat:"",icon:"edit",round:"",size:"md",onClick:e=>N.editarManipulacao(t.id)},null,8,["onClick"]),"digitacao"===C.tabSelecionada.valor?((0,a.openBlock)(),(0,a.createBlock)(D,{key:0,class:"buttons",color:"tertiary",dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:e=>N.excluir(t.id)},null,8,["onClick"])):(0,a.createCommentVNode)("",!0)])])),_:2},1024)])),_:2},1024),t.showPreviewDetail?((0,a.openBlock)(),(0,a.createBlock)(z,{key:0,class:"q-pa-md"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(k,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)(" Origem "),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(t.documentoItens,(e=>((0,a.openBlock)(),(0,a.createElementBlock)("div",{key:e.id},[-1===e.operacaoFator?((0,a.openBlock)(),(0,a.createBlock)(k,{key:0,stamp:""},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(e.quantidade)+" "+(0,a.toDisplayString)(e.unidade)+" - "+(0,a.toDisplayString)(e.descricaoItem),1)])),_:2},1024)):(0,a.createCommentVNode)("",!0)])))),128))])),_:2},1024),(0,a.createVNode)(b,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)(" Destino "),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(t.documentoItens,(e=>((0,a.openBlock)(),(0,a.createElementBlock)("div",{key:e.id},[1===e.operacaoFator?((0,a.openBlock)(),(0,a.createBlock)(k,{key:0,stamp:""},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(e.quantidade)+" "+(0,a.toDisplayString)(e.unidade)+" - "+(0,a.toDisplayString)(e.descricaoItem),1)])),_:2},1024)):(0,a.createCommentVNode)("",!0)])))),128))])),_:2},1024)])),_:2},1024)):(0,a.createCommentVNode)("",!0),(0,a.createVNode)(P)])),_:2},1024)))),128))])),_:1},8,["onCriar_click","onFiltro_change","onLimparFiltros_click","tabSelecionada","tabs","listaLayout","paginacao","filtros","buscaCampo","checkboxModel"]),(0,a.createVNode)(F,{ref:"itensManipulacao",onAtualizar:N.atualizar},null,8,["onAtualizar"])])}]]);Ct()(Et,"components",{QSelect:yt.Z,QList:ut.Z,QItem:pt.Z,QItemSection:ht.Z,QItemLabel:dt.Z,QIcon:ct.Z,QTooltip:mt.Z,QLinearProgress:kt.Z,QBadge:bt.Z,QBtn:it.Z,QMenu:qt.Z,QSeparator:ft.Z})}}]);