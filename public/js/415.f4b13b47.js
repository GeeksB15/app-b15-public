"use strict";(globalThis.webpackChunkb15=globalThis.webpackChunkb15||[]).push([[415],{80415:(e,t,a)=>{a.r(t),a.d(t,{default:()=>me});var o=a(34182);const i={class:"row no-wrap q-pa-md"},r={class:"column"},d=(0,o.createElementVNode)("div",{class:"text-h6 q-mb-md"},"Sincronismo RoutEasy",-1),l={class:"column items-center",style:{"margin-bottom":"0px"}},n=(0,o.createElementVNode)("div",{class:"text-h6 q-mb-md"},"Importar Roterização",-1),s={class:"q-mt-sm"},c=(0,o.createElementVNode)("br",null,null,-1),u={class:"col-12 text-body1 text-dark"};var m=a(30052),p=a.n(m),h=a(84830),v=a.n(h),f=a(77365);const V={class:"col-auto q-pl-none items-center"},g={class:"col"},C={class:"col-auto"},x={class:"col"},N={class:"col"},w={class:"col"},y={class:"col-12 col-md-4"},k={class:"col-12 col-md-4"},b={class:"q-px-sm"},E={key:0,class:"q-mt-sm"},_={style:{display:"block"}},D=(0,o.createElementVNode)("br",null,null,-1),$={class:"round-borders"},B={class:"col-12 col-md-4"},q={key:0,class:"q-px-sm"},F={class:"q-mt-sm"},S={style:{display:"block"}},T={key:1,class:"q-px-sm text-right"},I={class:"q-mt-none text-right"},A=(0,o.createElementVNode)("small",{class:"q-mr-xs"},"Desconto",-1),O={class:"text-subtitle1"};var z=a(83130),R=a(72407),P=a(5554),Z=a(19306),M=a(10662);const H={alterados:0,arquivo:null,cor:"text-negative",corFinal:"",erro:"",erros:0,incluidos:0,listaErros:[],mensagem:"",mensagemFinal:"",modalResultado:!1},L={components:{Avatar:z.Z,Badge:R.Z,DocumentosFiscais:P.Z,ModalHistoricoStatus:Z.Z,VendaModal:M.Z},computed:{config:()=>$db.configuracoes.valores,podeMigrarFatura(){return!["Aguardando Estoque","Aguardando Financeiro","Aguardando Aprovação","Aguardando Pagamento","Cancelado","Não Aprovado","Orçamento","Faturado"].includes(this.dados.venda.status)}},data:()=>({importar:$utils.clonarV2(H),dbUsuario:$db.usuario,dados:{venda:{}},contatos:{},faturasAbertas:[],detalhesVisivel:!1,visibilidade:{botao:{editar:!1,remover:!1}},modalDevolucaoGarantia:{visivel:!1,item:{},orcamento:{}},sistemaPai:"",configImpressaoOrcamento:[],configImpressaoEnvelope:[],documentoItemKit:{}}),emits:["executar"],methods:{irParaAtendimentoFatura(e){this.$router.push({name:"AtendimentoFatura",params:{id:e}})},async migrarFatura(e){try{await this.$q.dialog({message:"Esta ação irá migrar esta venda para outra fatura.",noRefocus:!0,preventClose:!0,title:"Tem certeza?",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Continuar",push:!0,class:"bg-primary",textColor:"white",flat:!0}})}catch(e){return}e||(e=$db.fatura.criar(this.dados.venda),await $db.fatura.grava({fatura:e})),e.id?(await $db.venda.grava({venda:{id:this.dados.venda.id,idFatura:e.id},vendaOriginal:this.dados.venda}),localStorage.setItem("idFatura",e.id),this.dados.venda.idContato&&(this.$emit("executar","atualizar"),this.irParaAtendimentoFatura(this.dados.venda.idContato))):this.$q.notify("Não foi possível realizar a operação")},alternarDetalhes(){this.detalhesVisivel=!this.detalhesVisivel},async atualizar(){const e=await $db.venda.leCompleto(this.id);e.venda.rotaJson&&e.venda.rotaJson.length>3&&(e.rotaJson=JSON.parse(e.venda.rotaJson)),this.fatura&&(e.fatura=this.fatura),e.carrinho.sort(((e,t)=>new Date(e.dataHoraEmissao)<new Date(t.dataHoraEmissao)?-1:1)),e.oss.sort(((e,t)=>new Date(e.documento.dataHoraEmissao)<new Date(t.documento.dataHoraEmissao)?-1:1)),e.customs.sort(((e,t)=>new Date(e.documento.dataHoraEmissao)<new Date(t.documento.dataHoraEmissao)?-1:1)),e.kits.sort(((e,t)=>new Date(e.documento.dataHoraEmissao)<new Date(t.documento.dataHoraEmissao)?-1:1));for(const t of e.kits){const e=t.documentosItem.find((e=>-1===e.operacaoFator));this.documentoItemKit[t.documento.id]=e}if((e.venda||{}).idContato&&(e.venda||{}).idEmpresa){let t=[];t=await $db.fatura.obterAbertas(e.venda.idContato,e.venda.idEmpresa),this.faturasAbertas=t.sort(((e,t)=>!e.numero||e.numero<t.numero?-1:1))}const t={};if(e.venda.idContato){const a=e.venda.idContato;t[a]||(t[a]=await $db.contato.le({id:a}))}if(e.venda.idContatoVendedor){const a=e.venda.idContatoVendedor;t[a]||(t[a]=await $db.contato.le({id:a}))}this.configuraImpressaoEnvelope(e.venda.idEmpresa),this.configuraImpressaoOrcamento(e.venda.idEmpresa),this.contatos=t,this.dados=e,await this.$nextTick(),e.venda.id===localStorage.getItem("idVenda")&&(this.$refs.vendaModal.mostrar({id:e.venda.id}),localStorage.removeItem("idVenda"))},async configuraImpressaoEnvelope(e){const t=await $db.configuracoes.porNome("impressao.envelope",e);this.configImpressaoEnvelope=[...t.length?t.map((e=>({texto:"Imprimir Envelope",...e}))):[{valor:"envelope",texto:"Imprimir Envelope"},{valor:"envelopeMini",texto:"Imprimir Envelope Mini"}]]},async configuraImpressaoOrcamento(e){const t=await $db.configuracoes.porNome("impressao.venda",e);this.configImpressaoOrcamento=[...t.length?t.map((e=>({texto:"Imprimir Orçamento",...e}))):[{valor:"invoice",texto:"Orçamento/Venda (Invoice)"},"optisoul"===this.sistemaPai?{valor:"orcamento",texto:"Orçamento (Antigo)"}:{},"optisoul"===this.sistemaPai?{valor:"termoGarantia",texto:"Termo de Garantia"}:{}]]},copiarUid(){const e=this.$refs.uid;e.type="text";try{e.select(),document.execCommand("copy"),this.$q.notify({message:"UID copiado para a área de transferência.",type:"info"})}catch(e){this.$q.notify("Erro ao copiar.")}e.type="hidden",window.getSelection().removeAllRanges()},descricaoEnvelope(e){let t="";for(const a of this.dados.itensEnvelopes)a.idDocumentoAdicional===e&&a.descricaoItem.trim()&&(t+=a.descricaoItem.trim()+" | ");return t.slice(0,-3)},async devolucaoGarantia(e){let t=await $db.documento.ler({idContato:$db.contato.selecionado.id,tipo:"Venda",status:"Orçamento"});t=$lodash.orderBy(t,"dataHoraEmissao","desc"),t.length?this.modalDevolucaoGarantia={visivel:!0,item:e,orcamento:t[0]}:this.$q.notify({message:"Crie um orçamento para inclusão de devolução/garantia.",type:"info"})},editar(){this.$router.replace({params:{id:this.dados.venda.id}}).finally((()=>{this.$refs.vendaModal.mostrar({id:this.dados.venda.id})}))},executar(e){switch(e){case"atualizar":this.atualizar();break;case"cancelar":case"finalizar":case"reprovar":this.$emit("executar","atualizar");break;case"retornarOrcamento":this.$emit("executar",e)}},async finalizaDevolucaoGarantia(e,t,a){const o=$utils.clonarV2(e);"devolucao"===t&&(o.operacao="Devolução de Venda"),"garantia"===t&&(o.operacao="Garantia de Venda",o.motivo=a),o.idDocumentoItemVenda=o.id,o.idDocumentoVenda=o.idDocumento,o.id=$utils.uuid(),o.idDocumento=this.modalDevolucaoGarantia.orcamento.id,o.status="Orçamento",o.operacaoFator=1,o.codigoCfop=20,o.idCfop=(await $db.cfop.le({codigoCfop:20}))[0].id,o.dataHoraEmissao=$utils.dataAtual(),o.dataHoraFinalizado="",o.subTotal=-1*o.subTotal,o.total=-1*o.total,o.valorItem=-1*o.valorItem,o.descontoSubTotal=0,delete o.codigoCfop,delete o.codigoDocumento,delete o.codigoDocumentoItem,delete o.codigoItem,delete o.codigoPlanoContaDestino,delete o.codigoPlanoContaEstoque,await $db.documentoItem.grava({atual:o}),this.$q.notify({message:"Item adicionado ao orçamento.",type:"positive"}),localStorage.setItem("idVenda",this.modalDevolucaoGarantia.orcamento.id),this.$emit("executar","atualizar")},async remover(){this.$q.dialog({message:"Esta ação irá remover esta venda da fatura",title:"Tem certeza?",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Continuar",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk((async()=>{let e=$utils.clonarV2(this.dados.venda);this.dados.venda.idFatura="",await $db.venda.grava({venda:this.dados.venda,vendaOriginal:e}),this.$emit("executar","remover")}))}},props:{id:{required:!0,type:String},sendRouteEasy:{required:!1,type:Function},sendRouteEasyAll:{required:!1,type:Function},fatura:{required:!1,type:Object},resetarEnvio:{required:!1,type:Function}},watch:{async dados(e){this.visibilidade.botao.editar=!1,this.visibilidade.botao.remover=!1,(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data.find((t=>t.id===e.venda.idEmpresa))&&(e.venda.idFatura&&this.faturasAbertas.find((t=>t.id===e.venda.idFatura))&&(this.visibilidade.botao.remover=await $db.permissao.objeto("Diretiva_Vendas_RemoverVendaFatura")),e.venda.idFatura&&this.faturasAbertas.find((t=>t.id===e.venda.idFatura))&&(this.visibilidade.botao.remover=!0),["Cancelado","Não Aprovado"].includes(e.venda.status)||e.venda.idFatura||(this.visibilidade.botao.editar=!0))}},mounted(){this.sistemaPai=$utils.sistemaPai(),this.atualizar()}};var Q=a(74260),U=a(77953),J=a(60880),j=a(31106),G=a(76106),W=a(4957),Y=a(37617),K=a(54707),X=a(25901),ee=a(68900),te=a(48761),ae=a(83831),oe=a(98586),ie=a(7518),re=a.n(ie);const de=(0,Q.Z)(L,[["render",function(e,t,a,i,r,d){const l=(0,o.resolveComponent)("badge"),n=(0,o.resolveComponent)("q-item-section"),s=(0,o.resolveComponent)("avatar"),c=(0,o.resolveComponent)("q-item-label"),u=(0,o.resolveComponent)("q-badge"),m=(0,o.resolveComponent)("row"),p=(0,o.resolveComponent)("q-tooltip"),h=(0,o.resolveComponent)("q-btn"),v=(0,o.resolveComponent)("q-icon"),f=(0,o.resolveComponent)("q-item"),z=(0,o.resolveComponent)("q-list"),R=(0,o.resolveComponent)("q-menu"),P=(0,o.resolveComponent)("q-toolbar-title"),Z=(0,o.resolveComponent)("DocumentosFiscais"),M=(0,o.resolveComponent)("q-separator"),H=(0,o.resolveComponent)("VendaModal"),L=(0,o.resolveComponent)("ModalHistoricoStatus"),Q=(0,o.resolveDirective)("close-popup");return(0,o.openBlock)(),(0,o.createElementBlock)("div",null,[r.dados.venda.id?((0,o.openBlock)(),(0,o.createBlock)(f,{key:0,id:"VendaCard","manual-focus":"",clickable:"",class:"items-center d-flex q-pa-xs"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(n,{avatar:"",center:"",class:"mw100 hideonmobile",onClick:d.editar},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(l,{class:"q-mr-sm",escuro:"",cor:"positive",onClick:d.copiarUid},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)(" #"+(0,o.toDisplayString)(parseInt(r.dados.venda.numero)||(r.dados.venda.id||"").slice(-6))+" ",1),(0,o.withDirectives)((0,o.createElementVNode)("input",{type:"hidden","onUpdate:modelValue":t[0]||(t[0]=e=>r.dados.venda.id=e),ref:"uid"},null,512),[[o.vModelText,r.dados.venda.id]])])),_:1},8,["onClick"])])),_:1},8,["onClick"]),(0,o.createVNode)(n,{onClick:d.editar},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(m,{class:"items-center"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",V,[(0,o.createVNode)(s,{imagem:(r.contatos[r.dados.venda.idContato]||{}).imagem,rotulo:r.dados.venda.descricaoContato,tamanho:"40",style:{float:"left"}},null,8,["imagem","rotulo"])]),(0,o.createElementVNode)("div",g,[(0,o.createVNode)(c,{class:"text-tertiary text-weight-bold"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(r.dados.venda.descricaoContato),1)])),_:1}),(0,o.createVNode)(m,{class:"hideondesktop items-center q-my-sm"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",C,[(0,o.createVNode)(l,{class:"q-mr-sm",escuro:"",cor:"positive",onClick:d.copiarUid},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)(" #"+(0,o.toDisplayString)(parseInt(r.dados.venda.numero)||(r.dados.venda.id||"").slice(-6))+" ",1),(0,o.withDirectives)((0,o.createElementVNode)("input",{type:"hidden","onUpdate:modelValue":t[1]||(t[1]=e=>r.dados.venda.id=e),ref:"uid"},null,512),[[o.vModelText,r.dados.venda.id]])])),_:1},8,["onClick"])]),(0,o.createElementVNode)("div",x,[(0,o.createVNode)(u,{color:"tertiary"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(r.dados.venda.status),1)])),_:1})])])),_:1}),(0,o.createVNode)(m,{class:"hideondesktop items-center q-my-sm"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",N,[r.dados.venda.dataHoraFinalizado?((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:0},[(0,o.createTextVNode)((0,o.toDisplayString)(e.$filters.data(r.dados.venda.dataHoraFinalizado))+" ",1),(0,o.createVNode)(p,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)(" Finalizado ")])),_:1})],64)):((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:1},[(0,o.createTextVNode)((0,o.toDisplayString)(e.$filters.data(r.dados.venda.dataHoraEmissao))+" ",1),(0,o.createVNode)(p,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)(" Emissão ")])),_:1})],64))]),(0,o.createElementVNode)("div",w,[(0,o.createTextVNode)((0,o.toDisplayString)((r.contatos[r.dados.venda.idContatoVendedor]||{}).apelido)+" ",1),(0,o.createVNode)(p,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)(" Vendedor(a) ")])),_:1})])])),_:1})])])),_:1})])),_:1},8,["onClick"]),(0,o.createVNode)(n,{onClick:d.editar,class:"hideonmobile"},{default:(0,o.withCtx)((()=>[r.dados.venda.dataHoraFinalizado?((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:0},[(0,o.createTextVNode)((0,o.toDisplayString)(e.$filters.data(r.dados.venda.dataHoraFinalizado))+" ",1),(0,o.createVNode)(p,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)(" Finalizado ")])),_:1})],64)):((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:1},[(0,o.createTextVNode)((0,o.toDisplayString)(e.$filters.data(r.dados.venda.dataHoraEmissao))+" ",1),(0,o.createVNode)(p,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)(" Emissão ")])),_:1})],64))])),_:1},8,["onClick"]),(0,o.createVNode)(n,{onClick:d.editar,class:"hideonmobile"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)((r.contatos[r.dados.venda.idContatoVendedor]||{}).apelido)+" ",1),(0,o.createVNode)(p,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)(" Vendedor(a) ")])),_:1})])),_:1},8,["onClick"]),(0,o.createVNode)(n,{avatar:"",class:"mw240 hideonmobile"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(u,{color:"tertiary"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(r.dados.venda.status),1)])),_:1}),r.dados.venda.rotaStatus?((0,o.openBlock)(),(0,o.createBlock)(u,{key:0,color:"secondary",style:{"margin-top":"5px"}},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("span",null,(0,o.toDisplayString)(r.dados.venda.rotaStatus),1)])),_:1})):(0,o.createCommentVNode)("",!0)])),_:1}),(0,o.createVNode)(n,{onClick:d.editar,avatar:"",class:"mw100"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,{caption:"",class:"text-right text-tertiary text-weight-bold"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(e.$filters.numero(r.dados.venda.totalDocumento,2))+" ",1),(0,o.createVNode)(p,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("Valor total")])),_:1})])),_:1})])),_:1},8,["onClick"]),(0,o.createVNode)(n,{side:"",top:""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(m,null,{default:(0,o.withCtx)((()=>[(0,o.createVNode)(h,{rounded:"",dense:"",flat:"",icon:r.detalhesVisivel?"keyboard_arrow_up":"keyboard_arrow_down",size:"md",unelevated:"",class:"hideonmobile q-mx-xs",color:"tertiary",style:{float:"right"},onClick:d.alternarDetalhes},null,8,["icon","onClick"]),r.visibilidade.botao.remover?((0,o.openBlock)(),(0,o.createBlock)(h,{key:0,rounded:"",dense:"",flat:"",icon:"clear",color:"tertiary",unelevated:"",class:"hideonmobile q-mx-xs",size:"md",onClick:d.remover,style:{float:"right"}},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(p,{anchor:"top left",self:"bottom start"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)(" Remover da fatura #"+(0,o.toDisplayString)(parseInt(r.dados.venda.numero)||(r.dados.venda.id||"").slice(-6)),1)])),_:1})])),_:1},8,["onClick"])):(0,o.createCommentVNode)("",!0),(0,o.createVNode)(h,{rounded:"",dense:"",flat:"",icon:"edit",color:"primary",unelevated:"",class:"hideonmobile q-mx-xs",size:"md",onClick:d.editar,style:{float:"right"}},null,8,["onClick"]),(0,o.createVNode)(h,{rounded:"",dense:"",flat:"",icon:"print",color:"primary",unelevated:"",class:"hideonmobile q-mx-xs",size:"md",style:{float:"right"}},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(R,null,{default:(0,o.withCtx)((()=>[(0,o.createVNode)(z,{link:"",separator:""},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(r.configImpressaoOrcamento.filter((e=>e.valor)),(t=>((0,o.openBlock)(),(0,o.createBlock)(f,{clickable:"",key:t.valor,onClick:a=>e.$imprimir(t.valor,{id:(r.dados.venda||{}).id||"0",Oculto:"0"})},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(n,{avatar:""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(v,{name:"print"})])),_:1}),(0,o.createVNode)(n,null,{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(t.texto),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128)),"optisoul"===r.sistemaPai?((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,{key:0},(0,o.renderList)(r.configImpressaoEnvelope,(t=>((0,o.openBlock)(),(0,o.createBlock)(f,{clickable:"",key:t.valor,onClick:a=>e.$imprimir(t.valor,(r.dados.venda||{}).id||"0")},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(n,{avatar:""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(v,{name:"print"})])),_:1}),(0,o.createVNode)(n,null,{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(t.texto),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128)):(0,o.createCommentVNode)("",!0)])),_:1})])),_:1})])),_:1}),(0,o.createVNode)(h,{rounded:"",dense:"",flat:"",icon:"more_vert",color:"tertiary",unelevated:"",class:"q-mx-xs",size:"md",style:{float:"right"}},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(R,null,{default:(0,o.withCtx)((()=>[(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createBlock)(z,{link:"",separator:""},{default:(0,o.withCtx)((()=>[e.$utils.mapearStatus(r.dados.venda).permiteNota?((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:0},[(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createBlock)(f,{clickable:"",onClick:t[2]||(t[2]=t=>e.emitirNFeV2({idVenda:r.dados.venda.id},1,"Venda"))},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(n,{avatar:""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(v,{name:"account_balance"})])),_:1}),(0,o.createVNode)(n,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("NFe de Saída/Venda")])),_:1})])),_:1})),[[Q]]),(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createBlock)(f,{clickable:"",onClick:t[3]||(t[3]=t=>e.emitirNFeV2({idVenda:r.dados.venda.id},0,"Devolução"))},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(n,{avatar:""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(v,{name:"account_balance"})])),_:1}),(0,o.createVNode)(n,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("NFe de Entrada/Devolução")])),_:1})])),_:1})),[[Q]]),(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createBlock)(f,{clickable:"",onClick:t[4]||(t[4]=t=>e.emitirNFeV2({idVenda:r.dados.venda.id},1,"Remessa"))},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(n,{avatar:""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(v,{name:"account_balance"})])),_:1}),(0,o.createVNode)(n,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("NFe de Remessa")])),_:1})])),_:1})),[[Q]])],64)):(0,o.createCommentVNode)("",!0),d.podeMigrarFatura?((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:1},[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(r.faturasAbertas.filter((e=>e.id!==r.dados.venda.idFatura)),(e=>(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createBlock)(f,{key:e.id,onClick:t=>d.migrarFatura(e)},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(n,{avatar:""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(v,{name:"mdi-folder-move"})])),_:1}),(0,o.createVNode)(n,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)("Migrar para fatura #"+(e.numero||e.id.slice(-6))),1)])),_:2},1024)])),_:2},1032,["onClick"])),[[Q]]))),128)),(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createBlock)(f,{onClick:t[5]||(t[5]=e=>d.migrarFatura())},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(n,{avatar:""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(v,{name:"mdi-folder-move"})])),_:1}),(0,o.createVNode)(n,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("Migrar para nova fatura")])),_:1})])),_:1})),[[Q]])],64)):(0,o.createCommentVNode)("",!0),(0,o.createVNode)(f,{clickable:"",onClick:t[6]||(t[6]=t=>e.$refs.modalHistoricoStatus.mostrar({idDocumento:r.dados.venda.id}))},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(n,{avatar:""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(v,{name:"history"})])),_:1}),(0,o.createVNode)(n,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("Histórico do Status")])),_:1})])),_:1}),a.resetarEnvio&&r.dados.venda.rotaJson&&r.dados.venda.rotaJson.length>0?((0,o.openBlock)(),(0,o.createBlock)(f,{key:2,clickable:"",onClick:t[7]||(t[7]=e=>a.resetarEnvio(r.dados.venda))},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(n,{avatar:""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(v,{name:"restart_alt"})])),_:1}),(0,o.createVNode)(n,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("Resetar Envio")])),_:1})])),_:1})):(0,o.createCommentVNode)("",!0)])),_:1})),[[Q]])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):(0,o.createCommentVNode)("",!0),r.detalhesVisivel?((0,o.openBlock)(),(0,o.createBlock)(m,{key:1,class:"q-col-gutter-md q-py-md"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",y,[r.detalhesVisivel?((0,o.openBlock)(),(0,o.createBlock)(z,{key:0},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(r.dados.carrinho,(t=>((0,o.openBlock)(),(0,o.createBlock)(f,{class:"fullWidth",key:t.id},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(n,{avatar:"",class:"w120"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(t.quantidade)+"x",1)])),_:2},1024)])),_:2},1024),(0,o.createVNode)(n,null,{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(t.descricaoItem),1)])),_:2},1024)])),_:2},1024),(0,o.createVNode)(n,{side:"",top:""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(e.$filters.numero(t.total,2)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(r.dados.customs,(t=>((0,o.openBlock)(),(0,o.createBlock)(f,{class:"fullWidth",key:t.documento.id},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(n,{avatar:"",class:"w120"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(t.documento.numero)+"x ",1)])),_:2},1024)])),_:2},1024),(0,o.createVNode)(n,null,{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(t.documento.descricao),1)])),_:2},1024)])),_:2},1024),(0,o.createVNode)(n,{side:"",top:""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(e.$filters.numero(t.documento.totalDocumento,2)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(r.dados.oss,(t=>((0,o.openBlock)(),(0,o.createBlock)(f,{class:"fullWidth",key:t.documento.id},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(n,{avatar:"",class:"w120"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,null,{default:(0,o.withCtx)((()=>["Orçamento"!==t.documento.status?((0,o.openBlock)(),(0,o.createBlock)(l,{key:0,class:"q-mx-sm",escuro:"",cor:"grey-5",denso:"",round:""},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(t.documento.status)+" ",1),(0,o.createVNode)(p,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)(" OS ")])),_:1})])),_:2},1024)):((0,o.openBlock)(),(0,o.createBlock)(l,{key:1},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("OS ")])),_:1}))])),_:2},1024)])),_:2},1024),(0,o.createVNode)(n,null,{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(t.documento.descricao),1)])),_:2},1024)])),_:2},1024),(0,o.createVNode)(n,{right:"",top:""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(e.$filters.numero(t.documento.totalDocumento,2)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(r.dados.kits,(t=>((0,o.openBlock)(),(0,o.createBlock)(f,{class:"fullWidth",key:t.documento.id},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(n,{avatar:"",class:"w120"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(r.documentoItemKit[t.documento.id].quantidade)+"x",1)])),_:2},1024)])),_:2},1024),(0,o.createVNode)(n,null,{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(r.documentoItemKit[t.documento.id].descricaoItem),1)])),_:2},1024)])),_:2},1024),(0,o.createVNode)(n,{side:"",top:""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(e.$filters.numero(r.documentoItemKit[t.documento.id].total,2)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(r.dados.envelopes,(t=>((0,o.openBlock)(),(0,o.createBlock)(f,{class:"fullWidth",key:t.id},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(n,{avatar:"",class:"w120"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(l,{class:"q-mx-sm",escuro:"",cor:"grey-5",denso:"",round:""},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)(" #"+(0,o.toDisplayString)(parseInt(t.numero)||(t.id||"").slice(-6))+" ",1),(0,o.createVNode)(p,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(t.tipo)+" - "+(0,o.toDisplayString)(t.descricaoContato),1)])),_:2},1024)])),_:2},1024),"Orçamento"!==t.status?((0,o.openBlock)(),(0,o.createBlock)(l,{key:0,class:"q-mx-sm",escuro:"",cor:"grey-5",denso:"",round:""},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(t.status),1)])),_:2},1024)):(0,o.createCommentVNode)("",!0)])),_:2},1024),(0,o.createVNode)(n,null,{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(d.descricaoEnvelope(t.id)),1)])),_:2},1024)])),_:2},1024),(0,o.createVNode)(n,{right:"",top:""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(e.$filters.numero(t.totalDocumento,2)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):(0,o.createCommentVNode)("",!0)]),(0,o.createElementVNode)("div",k,[(0,o.createElementVNode)("div",b,[(0,o.createVNode)(P,{class:"q-mx-none q-mt-sm q-px-none"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(v,{name:"business"}),(0,o.createTextVNode)(" "+(0,o.toDisplayString)(r.dados.venda.descricaoEmpresa),1)])),_:1}),r.dados.venda.observacao?((0,o.openBlock)(),(0,o.createElementBlock)("p",E,[(0,o.createElementVNode)("small",_,[(0,o.createTextVNode)((0,o.toDisplayString)(r.dados.venda.observacao)+" ",1),D,(0,o.createTextVNode)(" "+(0,o.toDisplayString)(r.dados.venda.observacaoInterna),1)])])):(0,o.createCommentVNode)("",!0),(0,o.createElementVNode)("div",$,[(0,o.createVNode)(Z,{idVenda:r.dados.venda.id},null,8,["idVenda"])])])]),(0,o.createElementVNode)("div",B,[r.dados.venda.observacaoFaturamento?((0,o.openBlock)(),(0,o.createElementBlock)("div",q,[(0,o.createVNode)(P,{class:"q-mx-none q-mt-sm q-px-none"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)(" Faturamento ")])),_:1}),(0,o.createElementVNode)("p",F,[(0,o.createElementVNode)("small",S,(0,o.toDisplayString)(r.dados.venda.observacaoFaturamento),1)])])):(0,o.createCommentVNode)("",!0),r.dados.venda.totalDesconto?((0,o.openBlock)(),(0,o.createElementBlock)("div",T,[(0,o.createElementVNode)("dl",I,[(0,o.createElementVNode)("dd",null,[A,(0,o.createElementVNode)("span",O,[(0,o.createElementVNode)("strong",null,(0,o.toDisplayString)(e.$filters.numero(r.dados.venda.totalDesconto,2)),1)])])])])):(0,o.createCommentVNode)("",!0)])])),_:1})):(0,o.createCommentVNode)("",!0),(0,o.createVNode)(M),(0,o.createVNode)(H,{ref:"vendaModal",onExecutar:d.executar},null,8,["onExecutar"]),(0,o.createVNode)(L,{ref:"modalHistoricoStatus"},null,512)])}]]);re()(L,"components",{QItem:U.Z,QItemSection:J.Z,QItemLabel:j.Z,QBadge:G.Z,QTooltip:W.Z,QBtn:Y.Z,QMenu:K.Z,QList:X.Z,QIcon:ee.Z,QToolbarTitle:te.Z,QSeparator:ae.Z}),re()(L,"directives",{ClosePopup:oe.Z});const le=new Date((new Date).toDateString()),ne={config:{usaExpedicao:!1,tokenRoutEasy:""},permissao:{acessarTodosVendedoresDigitadores:!1,acessarOutrasEmpresas:!1},filtro:{idEmpresa:null,idsEmpresa:[],idContatoVendedorDigitador:null,termoBusca:"",status:"",statusEnvio:"",descricaoContato:"",totalDocumento:0,tipoData:"dataFaturado",periodoIni:le,periodoFim:le},paginacao:{atual:1,maximo:1,total:1,limite:25}},se={components:{Lista:f.Z,VendaCardLista:de,VendaModal:M.Z},computed:{tituloPeriodo(){return"dataFaturado"===this.filtro.tipoData?"Faturado em":"dataEmissao"===this.filtro.tipoData?"Emitido em":"dataFinalizacao"===this.filtro.tipoData?"Finalizado em":""}},data:()=>({documentos:[],filtro:$utils.clonar(ne.filtro),config:$utils.clonar(ne.config),permissao:$utils.clonar(ne.permissao),paginacao:$utils.clonar(ne.paginacao),empresas:[],vendedoresDigitadores:[],tiposData:[{label:"Data Faturado",value:"dataFaturado"},{label:"Data Emissão",value:"dataEmissao"},{label:"Data Finalização",value:"dataFinalizacao"}],opcoesStatusEnvio:[{rotulo:"Enviados"},{rotulo:"Não Enviados"}],tabs:[],tabSelecionada:{},mostrarDetalhes:!1}),methods:{async sendRouteEasyAll(){try{let e;$q.loading.show(),e=await this.filtrar(),await this.sendRouteEasy(e),$q.notify({message:"Sincronismo efetuado com sucesso!",type:"positive"})}catch(e){console.log(e)}finally{$q.loading.hide()}},async sendRouteEasy(e){$q.loading.show();let t=e.data,a={deliveries:[]};try{for(let e=0;e<t.length;e++){const o=t[e],i=await $db.contatoEndereco.le({idContato:o.idContato});if(0===i.length){let e=`Não foi possivel envia venda #ID[${o.id}], pois não foi vinculado um endereço.`;$q.notify(e),console.log(e)}if(o&&o.idContato&&i.length>0){let e=await $db.contato.le({id:o.idContato}),t=await $db.contatoTelefone.le({idContato:e.id}),r=await $db.documentoFiscalEletronico.ler({idDocumento:o.idFatura});$utils.dataAtual();const d=i[0],l=await this.calcularPesoECubicoTotal(o.id);let n=l.pesoTotal||0,s=l.metroCubicoTotal||0,c=r.length>0?r[0].nNF:"",u=($filters.numero(o.totalDocumento,2),parseInt(o.totalDocumento)),m={code:o.idContato,name:o.descricaoContato,site:o.numeroDocumentoEmpresa,additional_info_2:o.numeroDocumentoEmpresa,order_number:o.numero+" "+o.numeroDocumentoEmpresa,invoice_number:c,loads:[n,s,u],email:e.email||"",customer_profile:e.id,phone:t.length>0?t[0].telefone:"",address:{route:d.logradouro,street_number:d.numero?d.numero:"",neighborhood:d.bairro,city:d.municipio,state:d.uf,postal_code:d.cep,country:d.pais}};a.deliveries.push(m)}}if(a.deliveries.length>0){const e=await p()({method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},baseURL:"https://company.routeasy.com.br",url:"/group?api_key=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYxNDIwYWQ2YzRiNTYzMWEyMmQwYTZhZSIsInRpbWVzdGFtcCI6MTYzMjQ5NTY1ODE1OH0.Nodh7i5OjMak8PQaavO8yComhN6BJa7bPs37SKfe4rE",validateStatus:e=>e>=200&&e<=500,timeout:3e4,data:a});for(const a of e.data.deliveries){const e=t.find((e=>e.numeroDocumentoEmpresa===a.order_number.split(" ")[1]&&e.numero===parseInt(a.order_number.split(" ")[0])));if(!e){$q.notify(`Venda Nº ${a.order_number} / ${a.site} não encontrada!`);continue}const o=(await $erp().documento.where({id:e.id}).toArray())[0],i=$utils.clonarV2(o);i.rotaJson=JSON.stringify({envio:a}),i.rotaStatus="Enviado";let r=$utils.dataAtual().split("T")[0].split("-");i.rotaNome=`Rota do dia ${r[2]}/${r[1]}/${r[0]}`,await $db.documento.grava({atual:i,original:o});try{this.$refs[i.id]?.atualizar()}catch(e){console.log(e.message)}}}else $q.notify("Rota(s) já enviadas ou nao tem informações suficientes.")}catch(e){$q.notify(e.message),console.log("[ERROR][SINCRONSMO][ROUTEASY] => ",e)}finally{if(a.deliveries.length>0){let e=a.deliveries.length>1?"s":"";$q.notify({message:`(${a.deliveries.length}) Rota${e} enviada${e} com sucesso!`,type:"positive"})}$q.loading.hide()}},async getGeoCordenadas(e){const t=await fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${e.municipio}+${e.uf}+${e.logradouro}+${e.cep}&key=AIzaSyDXlwwrHCnEP50L1rFQvrYq9XAzpU_hZvA`,{method:"GET"});return(await t.json()).results[0].geometry},async calcularPesoECubicoTotal(e){if(!e)return!1;const t={};let a=0,o=0,i=0,r=0,d=0;const l=await $erp().documentoItem.where({idDocumento:e}).toArray();for(const e of l)if(-1===e.operacaoFator){if(e.idItem&&!t[e.idItem]){const a=await $erp().item.get(e.idItem);a&&(t[e.idItem]=a)}a+=(t[e.idItem].peso||0)*(e.quantidade||0),o+=(t[e.idItem].pesoBruto||0)*(e.quantidade||0),r=(t[e.idItem].altura||0)*(t[e.idItem].largura||0)*t[e.idItem].comprimento||0,d=e.quantidade||0,i+=r>0?r*d:0}return a=$utils.arredondar(a,4),o=$utils.arredondar(o,4),i=$utils.arredondar(i,4),{pesoTotal:a,pesoBrutoTotal:o,metroCubicoTotal:i}},async importarPlanilhaRetorno(e){try{const t=e=>new Promise(((t,a)=>{const o=new FileReader;o.readAsBinaryString(e),o.onload=()=>t(o.result),o.onerror=e=>a(e)})),a=await t(e[0]);let o=v().read(a,{type:"binary"}),i=v().utils.sheet_to_json(o.Sheets[Object.keys(o.Sheets)[0]],{header:1});const r=i[0];for(let e=1;e<i.length;e++){const t=i[e];let a,o,d,l,n,s,c;a=$utils.convertArrToObj(r,t),o=a?.codigoDoCliente,d=a?.numeroPedido.split(" ")[0],o&&d&&(c=await $erp().documento.where({tipo:"Venda",idContato:o}).toArray(),l=c.find((e=>Number(e.numero)===Number(d))),l&&(n=$utils.clonarV2(l),s=JSON.parse(n.rotaJson??null)??{},s.recebido=a,n.rotaJson=JSON.stringify(s),n.rotaStatus="Enviado",n.rotaNome=t[0],n.rotaSequencia=t[4],n.rotaData=$utils.dataAtual(),await $db.documento.grava({original:l,atual:n})))}await this.atualizar(),this.$q.notify({type:"positive",message:"Importação realizada com sucesso"})}catch(e){e.name&&"ErroValidacao"===e.name?this.$q.notifyError(e.message,e):this.$q.notifyError("Ocorreu erro ao importar roterização xlsx",e)}},acessarPainel(){window.open("https://company.routeasy.com.br/#!/routings/create","_blank").focus()},montarObjImportacaoRE(e,t){let a={};for(let o=1;o<e.length;o++){const i=$utils.removerCaracteresEspeciais(e[o]).split(" ");for(let e=0;e<i.length;e++)i[e]=i[e].charAt(0).toUpperCase()+i[e].slice(1);a[i.join("")]=t[o]}return a},adicionarVenda(){this.$refs.modalVenda.mostrar()},alternarMostrarDetalhes(){this.mostrarDetalhes=!this.mostrarDetalhes;for(const e of this.documentos)"detalhesVisivel"in this.$refs[e.id]?.[0]&&(this.$refs[e.id][0].detalhesVisivel=this.mostrarDetalhes)},async abrirModalContatos(){let e;e=await $g.promptContato.show({filtro:{ativo:!0}}),e?.id&&(this.filtro.descricaoContato=e.nome)},async filtrar(){return this.setStatus(),await $db.venda.lerV2({filtro:$utils.clonar(this.filtro),limit:this.paginacao.limite,page:this.paginacao.atual,sort:["dataHoraFinalizado","dataHoraEmissao"],dir:["desc","desc"]})},async atualizar(){try{let e;$q.loading.show(),this.mostrarDetalhes&&this.alternarMostrarDetalhes(),console.time("teste"),e=await this.filtrar(),console.timeEnd("teste"),console.log("resultado: ",e),this.paginacao.total=e.total,this.paginacao.maximo=e.totalPages,this.documentos=e.data,this.setTab()}catch(e){console.error(e)}finally{$q.loading.hide()}},limparFiltro(){this.filtro=$utils.clonar(ne.filtro)},async setStatus(){let e="";"Todas"!==this.tabSelecionada.valor&&(e=this.tabSelecionada.valor,~e.indexOf(",")&&(e=e.split(","))),this.filtro.status=e},async setConfig(){const e=await $db.configuracoes.le({nome:"vendas.usaExpedicao"}),t=await $db.configuracoes.le({nome:"integracao.routeasy"});this.config={usaExpedicao:"1"===e?.[0]?.valor,tokenRoutEasy:t?.[0]?.valor}},async setPermissao(){this.permissao={acessarTodosVendedoresDigitadores:await $db.permissao.objeto("Diretiva_RelatorioVenda_VerTodos"),acessarOutrasEmpresas:await $db.permissao.objeto("Diretiva_Venda/Fatura_OutrasLojas_VerTodos")}},setTab(){const e={value:"Finalizado,Faturado,Entregue",valor:"Finalizado,Faturado,Entregue"},t=this.documentos[0];if(t?.status){const a=this.tabs.find((e=>~e.value.indexOf(t.status)));e.value=a.value,e.valor=a.value}this.tabSelecionada=e},setTabs(){const e=[{rotulo:"Orçamento",value:"Orçamento"},{rotulo:"Ag. Estoque",value:"Aguardando Estoque"},{rotulo:"Ag. Financeiro",value:"Aguardando Financeiro"},{rotulo:"Ag. Liberação",value:"Aguardando Liberação"},{rotulo:"Ag. Pagamento",value:"Aguardando Pagamento,Aguardando Faturamento"},{rotulo:"Finalizado",value:"Finalizado,Faturado,Entregue"},{rotulo:"Não Aprovado",value:"Não Aprovado"},{rotulo:"Todas",value:""}];this.config.usaExpedicao&&e.splice(4,0,{rotulo:"Ag. Logística",value:"Aguardando Conferência,Aguardando Correção,Aguardando Embalagem,Aguardando Entrega,Aguardando Separação,Em Conferência,Em Embalagem,Em Separação"}),this.tabs=e,this.setTab()},async setVendedoresDigitadores(){let e,t=[];if(!this.permissao.acessarTodosVendedoresDigitadores){const a=JSON.parse(localStorage.getItem("usuario"));let o="";return a?.numeroDocumentoNacional&&(e=await $erp().contato.where({numeroDocumentoNacional:a.numeroDocumentoNacional}).toArray(),e[0]?.id&&(t.push({label:e[0].nome,value:e[0].id}),o=e[0]?.id)),this.vendedoresDigitadores=t,void(this.filtro.idContatoVendedorDigitador=o)}e=await $db.crm.leOnlineVendedoresDigitadores({entregueInicio:le,entregueFim:le});for(const a of e)a.codigo&&t.push({label:a.nome,value:a.id});this.vendedoresDigitadores=t},async setEmpresas(){const e=[];let t;if(!this.permissao.acessarOutrasEmpresas){t=await $db.contato.ler({filtros:{ativo:!0,empresas:!0}}),t=t.data;for(const a of t)e.push({label:a.nome,value:a.id})}if(this.permissao.acessarOutrasEmpresas){t=await $db.empresa.ler({filtro:{ativo:!0}});for(const a of t)e.push({label:a.nome,value:a.idContato})}this.empresas=e,this.filtro.idsEmpresa=e.map((e=>e.value))},mostrarVendaRota(){const e=this.$route.params?.id;/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/.test(e)&&(this.filtro.termoBusca=e)}},async created(){await this.setConfig(),this.setTabs(),await this.setPermissao(),await this.setVendedoresDigitadores(),await this.setEmpresas(),await this.mostrarVendaRota(),await this.atualizar()}};var ce=a(90069),ue=a(40320);const me=(0,Q.Z)(se,[["render",function(e,t,a,m,p,h){const v=(0,o.resolveComponent)("q-icon"),f=(0,o.resolveComponent)("q-item-section"),V=(0,o.resolveComponent)("q-item"),g=(0,o.resolveComponent)("q-list"),C=(0,o.resolveComponent)("q-separator"),x=(0,o.resolveComponent)("q-uploader"),N=(0,o.resolveComponent)("q-menu"),w=(0,o.resolveComponent)("campo"),y=(0,o.resolveComponent)("q-select"),k=(0,o.resolveComponent)("row"),b=(0,o.resolveComponent)("VendaCardLista"),E=(0,o.resolveComponent)("Lista"),_=(0,o.resolveComponent)("VendaModal"),D=(0,o.resolveDirective)("close-popup");return(0,o.openBlock)(),(0,o.createElementBlock)("div",null,[(0,o.createVNode)(E,{titulo:"Vendas",icone:"mdi-cart-arrow-up",lista:p.documentos,onFiltro_change:h.atualizar,onLimparFiltros_click:h.limparFiltro,onCriar_click:h.adicionarVenda,onAbrirTodosPreview:h.alternarMostrarDetalhes,paginacao:p.paginacao,tabs:p.tabs,tabSelecionada:p.tabSelecionada,buscaCampo:p.filtro.termoBusca,"onUpdate:buscaCampo":t[11]||(t[11]=e=>p.filtro.termoBusca=e),exportarXLSXVisible:!1,permissaoExtras:!1,checkboxVisible:!1,disableRemove:!0,showAdd:!1,permissaoExtrasV2:!!p.config.tokenRoutEasy},{menuExtras:(0,o.withCtx)((()=>[(0,o.createVNode)(N,null,{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",i,[(0,o.createElementVNode)("div",r,[d,(0,o.createVNode)(g,{link:"","no-border":"",separator:""},{default:(0,o.withCtx)((()=>["function"==typeof h.sendRouteEasyAll?(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createBlock)(V,{key:0,clickable:"",onClick:t[0]||(t[0]=e=>h.sendRouteEasyAll())},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(f,{avatar:""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(v,{name:"upgrade"})])),_:1}),(0,o.createVNode)(f,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("Enviar")])),_:1})])),_:1})),[[D]]):(0,o.createCommentVNode)("",!0),"function"==typeof h.acessarPainel?(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createBlock)(V,{key:1,clickable:"",onClick:t[1]||(t[1]=e=>h.acessarPainel())},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(f,{avatar:""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(v,{name:"insights"})])),_:1}),(0,o.createVNode)(f,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("Acessar Painel")])),_:1})])),_:1})),[[D]]):(0,o.createCommentVNode)("",!0)])),_:1})]),(0,o.createVNode)(C,{vertical:"",inset:"",class:"q-mx-lg"}),(0,o.createElementVNode)("div",l,[n,(0,o.createElementVNode)("div",s,[(0,o.createVNode)(x,{style:{width:"100%"},label:"Selecione o arquivo (.xlsx)","hide-upload-btn":"","auto-upload":"",factory:h.importarPlanilhaRetorno},null,8,["factory"])])])])])),_:1})])),filtroCampos:(0,o.withCtx)((()=>[(0,o.createVNode)(k,{class:"q-col-gutter-md q-mt-md",style:{"margin-top":"-10px"}},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(w,{modelValue:p.filtro.descricaoContato,"onUpdate:modelValue":t[2]||(t[2]=e=>p.filtro.descricaoContato=e),class:"col-md-12",style:{"padding-top":"0px"},debounce:500,before:[{icon:"search",handler:h.abrirModalContatos}],rotulo:"Por cliente ou responsável",dense:""},null,8,["modelValue","before"]),p.vendedoresDigitadores.length?((0,o.openBlock)(),(0,o.createBlock)(y,{key:0,modelValue:p.filtro.idContatoVendedorDigitador,"onUpdate:modelValue":t[3]||(t[3]=e=>p.filtro.idContatoVendedorDigitador=e),options:p.vendedoresDigitadores,clearable:"","emit-value":"","map-options":"",label:"Vendedor / Digitador"},null,8,["modelValue","options"])):(0,o.createCommentVNode)("",!0),c,(0,o.createVNode)(w,{rotulo:"Valor total maior que",modelValue:p.filtro.totalDocumento,"onUpdate:modelValue":t[4]||(t[4]=e=>p.filtro.totalDocumento=e),before:[{icon:"money"}],tipo:"decimal",decimals:"4",zerosDireita:"2",dense:""},null,8,["modelValue"])])),_:1}),p.empresas.length?((0,o.openBlock)(),(0,o.createBlock)(y,{key:0,modelValue:p.filtro.idEmpresa,"onUpdate:modelValue":t[5]||(t[5]=e=>p.filtro.idEmpresa=e),options:p.empresas,clearable:"","emit-value":"","map-options":"",label:"Por empresa"},null,8,["modelValue","options"])):(0,o.createCommentVNode)("",!0),p.config.tokenRoutEasy&&p.config.tokenRoutEasy.length>3?((0,o.openBlock)(),(0,o.createBlock)(k,{key:1,class:"q-col-gutter-md q-mt-md"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(w,{tipo:"seletor",dense:"",modelValue:p.filtro.statusEnvio,"onUpdate:modelValue":t[6]||(t[6]=e=>p.filtro.statusEnvio=e),options:p.opcoesStatusEnvio.map((e=>({label:e.rotulo,value:e.rotulo}))),clearable:"",rotulo:"Status Envio"},null,8,["modelValue","options"])])),_:1})):(0,o.createCommentVNode)("",!0),(0,o.createVNode)(k,{class:"q-col-gutter-md q-mt-md q-mb-xl"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(y,{modelValue:p.filtro.tipoData,"onUpdate:modelValue":t[7]||(t[7]=e=>p.filtro.tipoData=e),options:p.tiposData,"emit-value":"","map-options":"",label:"Selecione o tipo de data"},null,8,["modelValue","options"]),(0,o.createElementVNode)("span",u,(0,o.toDisplayString)(h.tituloPeriodo),1),(0,o.createVNode)(w,{modelValue:p.filtro.periodoIni,"onUpdate:modelValue":t[8]||(t[8]=e=>p.filtro.periodoIni=e),tipo:"data",class:"no-shadow full-width",rotulo:"De",col:"12",after:[{icon:"mdi-close-circle",handler(){p.filtro.periodoIni=""}}],dense:""},null,8,["modelValue","after"]),(0,o.createVNode)(w,{modelValue:p.filtro.periodoFim,"onUpdate:modelValue":t[9]||(t[9]=e=>p.filtro.periodoFim=e),tipo:"data",class:"no-shadow full-width",rotulo:"até",col:"12",after:[{icon:"mdi-close-circle",handler(){p.filtro.periodoFim=""}}],dense:""},null,8,["modelValue","after"])])),_:1}),(0,o.createVNode)(w,{modelValue:p.paginacao.limite,"onUpdate:modelValue":t[10]||(t[10]=e=>p.paginacao.limite=e),min:"1",rotulo:"Quantidade por página",tipo:"quantidade",dense:""},null,8,["modelValue"])])),itemLista:(0,o.withCtx)((()=>[(0,o.createVNode)(g,{class:"rounded-borders"},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(p.documentos,(e=>((0,o.openBlock)(),(0,o.createElementBlock)("div",{key:e.id,class:"itemHover fullWidth q-px-sm"},[(0,o.createVNode)(b,{fatura:e.fatura,id:e.id,ref_for:!0,ref:e.id,class:"q-mb-md"},null,8,["fatura","id"])])))),128))])),_:1})])),_:1},8,["lista","onFiltro_change","onLimparFiltros_click","onCriar_click","onAbrirTodosPreview","paginacao","tabs","tabSelecionada","buscaCampo","permissaoExtrasV2"]),(0,o.createVNode)(_,{ref:"modalVenda",continueMesmaTela:!1},null,512)])}]]);re()(se,"components",{QMenu:K.Z,QList:X.Z,QItem:U.Z,QItemSection:J.Z,QIcon:ee.Z,QSeparator:ae.Z,QUploader:ce.Z,QSelect:ue.Z}),re()(se,"directives",{ClosePopup:oe.Z})}}]);