"use strict";(globalThis.webpackChunkb15=globalThis.webpackChunkb15||[]).push([[903],{36903:(e,o,t)=>{t.r(o),t.d(o,{default:()=>pe});var a=t(34182);const i=(0,a.createElementVNode)("span",{class:"col-12 text-body1 text-dark"},"Período de Emissão",-1),r=(0,a.createElementVNode)("span",{class:"col-12 text-body1 text-dark"},"Período de Finalização",-1),l=(0,a.createElementVNode)("p",null,null,-1);var n=t(77365);const s={class:"col-auto q-pl-none items-center"},d={class:"col"},c={class:"col-auto"},u={class:"col"},m={class:"col"},p={class:"col"},f={class:"col-12 col-md-6"},h={class:"text-subtitle1 text-weight-bold q-ma-none items-center"},g={class:"col-12 col-md-4"},v=(0,a.createElementVNode)("p",{class:"text-subtitle1 text-weight-bold q-ma-none"}," Faturamento ",-1),V={class:"q-ma-none"},C={class:"col-12 col-md-2 text-right"},N=(0,a.createElementVNode)("p",{class:"text-subtitle1 text-weight-bold q-ma-none"}," Desconto ",-1),w={class:"q-ma-none"},b=(0,a.createElementVNode)("span",{class:"text-weight-bold"},"Emissão de Boleto",-1),x={class:"q-mt-lg text-center"};var B=t(33337),k=t(72837),y=t(97093),E=t(21517),_=t(98396),$=t(19306),S=t(48409),D=t(88603),F=t(32326);const T={components:{Avatar:B.Z,DocumentosFiscais:k.Z,FaturaModal:E.Z,ModalHistoricoStatus:$.Z},computed:{config:()=>$db.configuracoes.valores,mostrarOpcaoEmitirBoleto(){return(this.modalBoleto.condicoesPagamento||[]).length&&(this.modalBoleto.bancos||[]).length},mostrarOpcaoRemoverFatura(){return"Aberta"===this.dados.fatura.status&&!this.dados.carnes.length&&!this.dados.condicaoPagamento.length&&!this.dados.vendas.length},ativarBotaoEmissaoBoleto(){const e=Number(this.modalBoleto.financeiroBanco.value);return Number.isInteger(e)&&e&&this.modalBoleto.condicoesPagamento.find((e=>e.checked))}},data:()=>({dbUsuario:$db.usuario,dados:{fatura:{}},contatos:{},detalhesVisivel:!1,sistemaPai:"",configImpressaoCarne:[],configImpressaoConvenio:[],configImpressaoFatura:[],configImpressaoEnvelope:[],modalBoleto:{},podeEditar:!1,mostrarBotaoEnviarAvaliacao:!1}),emits:["executar"],methods:{async removerFatura(){try{await new Promise(((e,o)=>{this.$q.dialog({message:"Esta ação irá remover esta fatura.",noRefocus:!0,preventClose:!0,title:"Tem certeza?",cancel:{label:"CANCELAR",push:!0,color:"tertiary",flat:!0},ok:{label:"CONTINUAR",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk((()=>{e()})).onCancel((()=>{o()}))}))}catch(e){return}this.dados.fatura.id?(await $db.fatura.remover(this.dados.fatura.id),this.$emit("executar","atualizar")):this.$q.notify("Não foi possível realizar a operação")},abrirModalBoleto(){for(const e of this.modalBoleto.condicoesPagamento)e.checked=!1,e.disable=!0,e.codigoFinanceiroBoleto="",e.codigoFinanceiroTitulo="",e.banco={};this.modalBoleto.checked=!1,this.modalBoleto.financeiroBanco=this.modalBoleto.bancos[0],this.modalBoleto.ativo=!0,this.$nextTick().then((()=>{this.modalBoleto.visivel=!0,this.atualizarBoletos()}))},alternarCheckboxModalBoleto(e){"todos"!==e?this.modalBoleto.checked=!this.modalBoleto.condicoesPagamento.find((e=>!e.checked)):this.modalBoleto.condicoesPagamento.forEach((e=>{e.checked=this.modalBoleto.checked}))},async atualizarBoletos(){let e,o,t,a;a=this.modalBoleto.condicoesPagamento,t=a.reduce(((e,o)=>e+"'"+o.idFinanceiroTitulo+"',"),""),t=t.slice(0,t.length-1),e=`select\n          fTitulo.id,\n          fTitulo.codigoFinanceiroTitulo,\n          fBoleto.codigoFinanceiroBoleto,\n          fBoleto.dataEmissao,\n          b.descricao,\n          fBanco.agencia,\n          fBanco.conta,\n          b.arquivoBoleto\n        from financeiroTitulo fTitulo\n        left join financeiroBoleto fBoleto on fBoleto.codigoFinanceiroBoleto = fTitulo.codigoFinanceiroBoleto\n        left join financeiroBanco fBanco on fBanco.CodigoFinanceiroBanco = fBoleto.codigoFinanceiroBanco\n        left join _banco b on b.codigoBanco = fBanco.codigoBanco\n        where fTitulo.id in (${t})`,this.cancelarAtualizarBoletos=!1;let i=0;for(;;){try{o=await(0,F.executarSql)(e),i=0}catch(e){o=[],++i%3==0&&this.$q.notifyError(e.message)}for(const e of o){const o=a.find((o=>o.idFinanceiroTitulo===e.id));o&&(e.codigoFinanceiroBoleto&&(o.codigoFinanceiroBoleto=e.codigoFinanceiroBoleto,o.banco={descricao:e.descricao,dataEmissao:e.dataEmissao,agencia:e.agencia,conta:e.conta,arquivoBoleto:e.arquivoBoleto}),e.codigoFinanceiroTitulo&&(o.codigoFinanceiroTitulo=e.codigoFinanceiroTitulo,o.disable=!1))}if(o.length===a.length||this.cancelarAtualizarBoletos)break;await(0,F.dormir)(5e3)}},async atualizarModalBoleto(){this.modalBoleto={ativo:!1,visivel:!1,loading:!1,codigoFinanceiroBanco:"",condicoesPagamento:[],bancos:[]};const e=[],o=await(0,S.X)().formaPagamento.toArray(),t=await(0,S.X)().empresa.where({idContato:this.dados.fatura.idEmpresa}).toArray();if(await(0,S.X)().documentoCondicaoPagamento.where({idDocumento:this.dados.fatura.id}).each((t=>{const a=o.find((e=>e.id===t.idFormaPagamento&&99===e.tipo&&"Título em aberto"===e.tipoFinanceiro));a&&e.push({dataVencimento:t.dataVencimento,descricao:a.descricao,idFinanceiroTitulo:t.idFinanceiroTitulo,codigoFinanceiroBoleto:"",checked:!1,disable:!0,valor:t.valor})})),!e.length)return;const a=[];await(0,S.X)().financeiroBanco.each((e=>{e.ativo&&("7D07229E-B35E-42AA-A312-78313BE61B2F"!==e.id?e.idEmpresa&&t.find((o=>o.id===e.idEmpresa))&&a.push(e):a.push(e))}));const i=[...new Set(a.map((e=>e.codigoBanco)))],r=[];await(0,S.X)()._banco.each((e=>{i.find((o=>o===e.codigoBanco))&&r.push(e)})),this.modalBoleto.condicoesPagamento=(0,D.orderBy)(e,"dataVencimento","asc");const l=[];for(const e of a){const o=r.find((o=>o.codigoBanco===e.codigoBanco))||{};if(!o)continue;const t=(o.descricao||"").trim(),a=(e.agencia||"").trim(),i=(e.conta||"").trim();if(!(o.arquivoBoleto&&t&&a&&i))continue;let n=t+" - Ag. "+a+" C/C "+i;l.push({arquivoBoleto:o.arquivoBoleto,label:n,value:e.codigoFinanceiroBanco})}l.length&&(this.modalBoleto.financeiroBanco=l[0],this.modalBoleto.bancos=l)},fecharModalBoleto(){this.cancelarAtualizarBoletos=!0,this.cancelarEmitirBoletos=!0,this.modalBoleto.visivel=!1,this.$nextTick().then((()=>{this.modalBoleto.avito=!1}))},async emitirImprimirBoleto(){this.modalBoleto.loading=!0;let e,o,t,a={},i=[];t=this.modalBoleto.condicoesPagamento.filter((e=>e.checked));for(const e of t)if(e.codigoFinanceiroBoleto&&(e.banco||{}).arquivoBoleto){if(!a[e.banco.arquivoBoleto]){a[e.banco.arquivoBoleto]=[e.codigoFinanceiroBoleto];continue}a[e.banco.arquivoBoleto].push(e.codigoFinanceiroBoleto)}else i.push(e.codigoFinanceiroTitulo);if(i.length&&this.modalBoleto.financeiroBanco?.value){this.cancelarEmitirBoletos=!1;let t,r,l,n,s=0,d=0;if(n=(this.modalBoleto.bancos.find((e=>e.value===this.modalBoleto.financeiroBanco.value))||{}).arquivoBoleto,!n)return void this.$q.notifyError("Arquivo boleto não encontrado");for(e=`sp_financeiro_boletoEmitir ${this.modalBoleto.financeiroBanco.value}, '${i.join(",")}'`;!this.cancelarEmitirBoletos;){try{o=await(0,F.executarSql)(e),s=0}catch(e){o=[],++s%3==0&&this.$q.notifyError(e.message)}if(t=(o||[])[0],r=((t||{}).Msg||"").trim(),l=((t||{}).Retorno||"").trim(),"Boleto Gerado com sucesso!"===r&&l){const e=l.substring(0,l.length-1).split(",");if(!a[n]){a[n]=e;break}for(const o of e)a[n].push(o);break}++d%3==0&&this.$q.notifyError(r),await(0,F.dormir)(5e3)}}let r=JSON.parse(localStorage.getItem("clienteSistema"))||{};for(const e in a){let o;o="https://rel.storage.b15.com.br/Relatorios/"+e+".html?",o+="CodigoFinanceiroBoleto="+a[e].join(","),o+="&Banco="+r.bancoDeDados,o+="&URLServidor="+r.urlServidor,window.open(o)}await this.atualizarBoletos(),this.modalBoleto.loading=!1},alternarDetalhes(){this.detalhesVisivel=!this.detalhesVisivel},async atualizar(){const e=await $db.fatura.leCompleto(this.id);e.vendas.sort(((e,o)=>new Date(e.dataHoraFinalizado)<new Date(o.dataHoraFinalizado)?-1:1)),e.carnes.sort(((e,o)=>new Date(e.dataVencimento)<new Date(o.dataVencimento)?-1:1));const o=await e.vendas.reduce((async(e,o)=>(e[o.idContatoVendedor]||(e[o.idContatoVendedor]=await $db.contato.le({id:o.idContatoVendedor})),e)),{});if(e.fatura.idContato){const t=e.fatura.idContato;o[t]||(o[t]=await $db.contato.le({id:t}))}this.configuraImpressaoCarne(e.fatura.idEmpresa),this.configuraImpressaoConvenio(e.fatura.idEmpresa),this.configuraImpressaoEnvelope(e.fatura.idEmpresa),this.configuraImpressaoFatura(e.fatura.idEmpresa),this.contatos=o,this.dados=e,this.atualizarModalBoleto(),this.condicaoPagamento=e.condicaoPagamento,this.resumeCondicaoPagamento();const t=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;this.podeEditar=!1,t.find((o=>o.id===e.fatura.idEmpresa))&&(this.podeEditar=!0),this.$nextTick((()=>{e.fatura.id===localStorage.getItem("idFatura")&&(this.podeEditar&&this.$refs.faturaModal.mostrar({id:this.dados.fatura.id}),localStorage.removeItem("idFatura"))}))},copiarUid(){const e=this.$refs.uid;e.type="text";try{e.select(),document.execCommand("copy"),this.$q.notify({message:"UID copiado para a área de transferência.",type:"info"})}catch(e){this.$q.notify("Erro ao copiar.")}e.type="hidden",window.getSelection().removeAllRanges()},async configuraImpressaoConvenio(e){const o=await $db.configuracoes.porNome("impressao.convenio",e);this.configImpressaoConvenio=[...o.length?o.map((e=>({texto:"Imprimir Convênio",...e}))):[{valor:"convenio",texto:"Imprimir Convênio"}]]},async configuraImpressaoCarne(e){const o=await $db.configuracoes.porNome("impressao.carne",e);this.configImpressaoCarne=[...o.length?o.map((e=>({texto:"Imprimir Carnê",...e}))):[{valor:"carne-crediario",texto:"Reimprimir carnê e notas promissórias da fatura"}]]},async configuraImpressaoEnvelope(e){const o=await $db.configuracoes.porNome("impressao.envelope",e);this.configImpressaoEnvelope=[...o.length?o.map((e=>({texto:"Imprimir Envelope",...e}))):[{valor:"envelope",texto:"Imprimir Envelope"},{valor:"envelopeMini",texto:"Imprimir Envelope Mini"}]]},async configuraImpressaoFatura(e){const o=await $db.configuracoes.porNome("impressao.fatura",e);this.configImpressaoFatura=[...o.length?o.map((e=>({texto:"Imprimir Fatura",...e}))):[{valor:"invoice",texto:"Fatura (Invoice)"},{valor:"fatura-recibo",texto:"Recibo"}]]},editar(){this.$refs.faturaModal.mostrar({id:this.dados.fatura.id})},async executar(e){switch(e){case"atualizar":case"finalizar":case"retornarOrcamento":case"remover":return void this.$emit("executar","atualizar")}await this.atualizar()},async sendReview(e){try{this.$q.loading.show();const o=[],t=this.contatos[e.idContato],a=await $api.bten.send(t,e);for(let e=0;e<a.length;e++){const t=a[e];t.status?o.push(t.telefone):this.$q.notifyError(`Falha ao enviar NPS para ${t.telefone}!`)}this.$q.loading.hide(),o.length&&this.$q.notifyPositive(`NPS enviado para ${o.join(",")}!`)}catch(e){if("GeeksException"===e.name)return void this.$q.notifyAlert(e.message);this.$q.notifyError("Não foi possivel enviar NPS para o contato.",e)}finally{this.$q.loading.hide()}}},mixins:[_.Z,y.Z],props:{id:{required:!0,type:String}},async mounted(){let e,o,t;e=await $db.configuracoes.porNome("integracao.bten.business"),o=e[0]?.valor??!1,e=await $db.configuracoes.porNome("integracao.bten.authorization"),t=e[0]?.valor??!1,this.mostrarBotaoEnviarAvaliacao=o&&t,this.sistemaPai=(0,F.sistemaPai)(),this.atualizar()}};var q=t(74260),I=t(77953),z=t(60880),A=t(31106),P=t(76106),R=t(4957),O=t(37617),M=t(54707),Z=t(25901),U=t(68900),Q=t(83831),L=t(39341),H=t(83054),j=t(47266),J=t(48761),X=t(782),Y=t(47803),G=t(835),W=t(46924),K=t(40320),ee=t(52788),oe=t(41837),te=t(98586),ae=t(7518),ie=t.n(ae);const re=(0,q.Z)(T,[["render",function(e,o,t,i,r,l){const n=(0,a.resolveComponent)("badge"),B=(0,a.resolveComponent)("q-item-section"),k=(0,a.resolveComponent)("avatar"),y=(0,a.resolveComponent)("q-item-label"),E=(0,a.resolveComponent)("q-badge"),_=(0,a.resolveComponent)("row"),$=(0,a.resolveComponent)("q-tooltip"),S=(0,a.resolveComponent)("q-btn"),D=(0,a.resolveComponent)("q-icon"),F=(0,a.resolveComponent)("q-item"),T=(0,a.resolveComponent)("q-list"),q=(0,a.resolveComponent)("q-menu"),I=(0,a.resolveComponent)("documentos-fiscais"),z=(0,a.resolveComponent)("q-separator"),A=(0,a.resolveComponent)("fatura-modal"),P=(0,a.resolveComponent)("q-toolbar-title"),R=(0,a.resolveComponent)("q-toolbar"),O=(0,a.resolveComponent)("q-spinner-hourglass"),M=(0,a.resolveComponent)("q-spinner-dots"),Z=(0,a.resolveComponent)("q-checkbox"),U=(0,a.resolveComponent)("q-select"),Q=(0,a.resolveComponent)("q-spinner"),L=(0,a.resolveComponent)("q-inner-loading"),H=(0,a.resolveComponent)("q-card-section"),j=(0,a.resolveComponent)("q-card"),J=(0,a.resolveComponent)("q-dialog"),X=(0,a.resolveComponent)("modal-historico-status"),Y=(0,a.resolveDirective)("close-popup");return(0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,null,[r.dados.fatura.id?((0,a.openBlock)(),(0,a.createBlock)(F,{key:0,id:"FaturaCard","manual-focus":"",clickable:"",class:"items-center d-flex q-pa-xs"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(B,{avatar:"",center:"",class:"mw100 hideonmobile",onClick:l.editar},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(n,{class:"q-mr-sm",escuro:"",cor:"positive",onClick:l.copiarUid},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)(" #"+(0,a.toDisplayString)(parseInt(r.dados.fatura.numero)||(r.dados.fatura.id||"").slice(-6))+" ",1),(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"hidden","onUpdate:modelValue":o[0]||(o[0]=e=>r.dados.fatura.id=e),ref:"uid"},null,512),[[a.vModelText,r.dados.fatura.id]])])),_:1},8,["onClick"])])),_:1},8,["onClick"]),(0,a.createVNode)(B,{onClick:l.editar},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(_,{class:"items-center"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",s,[(0,a.createVNode)(k,{imagem:(r.contatos[r.dados.fatura.idContato]||{}).imagem,rotulo:r.dados.fatura.descricaoContato,tamanho:"40",style:{float:"left"}},null,8,["imagem","rotulo"])]),(0,a.createElementVNode)("div",d,[(0,a.createVNode)(y,{class:"text-tertiary text-weight-bold"},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)((r.contatos[r.dados.fatura.idContato]||{}).apelido),1)])),_:1}),(0,a.createVNode)(_,{class:"hideondesktop items-center q-my-sm"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",c,[(0,a.createVNode)(n,{class:"q-mr-sm",escuro:"",cor:"positive",onClick:l.copiarUid},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)(" #"+(0,a.toDisplayString)(parseInt(r.dados.fatura.numero)||(r.dados.fatura.id||"").slice(-6))+" ",1),(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"hidden","onUpdate:modelValue":o[1]||(o[1]=e=>r.dados.fatura.id=e),ref:"uid"},null,512),[[a.vModelText,r.dados.fatura.id]])])),_:1},8,["onClick"])]),(0,a.createElementVNode)("div",u,[(0,a.createVNode)(E,{color:"tertiary"},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(r.dados.fatura.status),1)])),_:1})])])),_:1}),(0,a.createVNode)(_,{class:"hideondesktop items-center q-my-sm"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",m,[r.dados.fatura.dataHoraFinalizado?((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:0},[(0,a.createTextVNode)((0,a.toDisplayString)(e.$filters.data(r.dados.fatura.dataHoraFinalizado))+" ",1),(0,a.createVNode)($,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)(" Finalizado ")])),_:1})],64)):((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:1},[(0,a.createTextVNode)((0,a.toDisplayString)(e.$filters.data(r.dados.fatura.dataHoraEmissao))+" ",1),(0,a.createVNode)($,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)(" Emissão ")])),_:1})],64))]),(0,a.createElementVNode)("div",p,[(0,a.createTextVNode)((0,a.toDisplayString)((r.contatos[r.dados.fatura.idContatoVendedor]||{}).apelido)+" ",1),(0,a.createVNode)($,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)(" Vendedor(a) ")])),_:1})])])),_:1})])])),_:1})])),_:1},8,["onClick"]),(0,a.createVNode)(B,{onClick:l.editar,class:"hideonmobile"},{default:(0,a.withCtx)((()=>[r.dados.fatura.dataHoraFinalizado?((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:0},[(0,a.createTextVNode)((0,a.toDisplayString)(e.$filters.data(r.dados.fatura.dataHoraFinalizado))+" ",1),(0,a.createVNode)($,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)(" Finalizado ")])),_:1})],64)):((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:1},[(0,a.createTextVNode)((0,a.toDisplayString)(e.$filters.data(r.dados.fatura.dataHoraEmissao))+" ",1),(0,a.createVNode)($,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)(" Emissão ")])),_:1})],64))])),_:1},8,["onClick"]),(0,a.createVNode)(B,{avatar:"",class:"mw240 hideonmobile"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(E,{color:"tertiary"},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(r.dados.fatura.status),1)])),_:1}),r.dados.fatura.rotaStatus?((0,a.openBlock)(),(0,a.createBlock)(E,{key:0,color:"secondary",style:{"margin-top":"5px"}},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("span",null,(0,a.toDisplayString)(r.dados.fatura.rotaStatus),1)])),_:1})):(0,a.createCommentVNode)("",!0)])),_:1}),(0,a.createVNode)(B,{onClick:l.editar,class:"hideonmobile text-right"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("b",null,[(0,a.createTextVNode)((0,a.toDisplayString)(e.$filters.numero(r.dados.fatura.totalDocumento,2))+" ",1),(0,a.createVNode)($,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)(" Total ")])),_:1})]),(0,a.createElementVNode)("span",null,[(0,a.createTextVNode)((0,a.toDisplayString)(e.$filters.numero(r.dados.fatura.subTotal,2))+" ",1),(0,a.createVNode)($,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)(" Subtotal ")])),_:1})])])),_:1},8,["onClick"]),(0,a.createVNode)(B,{side:"",top:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(_,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(S,{rounded:"",dense:"",flat:"",icon:r.detalhesVisivel?"keyboard_arrow_up":"keyboard_arrow_down",size:"md",class:"no-shadow q-ma-xs",color:"tertiary",style:{float:"right"},onClick:l.alternarDetalhes},null,8,["icon","onClick"]),r.podeEditar?((0,a.openBlock)(),(0,a.createBlock)(S,{key:0,rounded:"",dense:"",flat:"",icon:"edit",color:"primary",class:"no-shadow q-ma-xs",size:"md",onClick:l.editar,style:{float:"right"}},null,8,["onClick"])):(0,a.createCommentVNode)("",!0),(0,a.createVNode)(S,{rounded:"",dense:"",flat:"",icon:"print",color:"tertiary",class:"no-shadow q-ma-xs",size:"md",style:{float:"right"}},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(q,null,{default:(0,a.withCtx)((()=>[(0,a.withDirectives)(((0,a.openBlock)(),(0,a.createBlock)(T,{link:"",separator:""},{default:(0,a.withCtx)((()=>[l.mostrarOpcaoEmitirBoleto?((0,a.openBlock)(),(0,a.createBlock)(F,{key:0,clickable:"",onClick:o[2]||(o[2]=e=>l.abrirModalBoleto())},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(B,{avatar:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(D,{name:"mdi-printer"})])),_:1}),(0,a.createVNode)(B,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(y,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("Emitir Boleto")])),_:1})])),_:1})])),_:1})):(0,a.createCommentVNode)("",!0),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(r.configImpressaoFatura,(o=>((0,a.openBlock)(),(0,a.createBlock)(F,{clickable:"",key:o.valor,onClick:t=>e.$imprimir(o.valor,(r.dados.fatura||{}).id||"0")},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(B,{avatar:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(D,{name:"print"})])),_:1}),(0,a.createVNode)(B,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(y,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(o.texto),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128)),"optisoul"===r.sistemaPai?((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,{key:1},(0,a.renderList)(r.configImpressaoEnvelope,(o=>((0,a.openBlock)(),(0,a.createBlock)(F,{clickable:"",key:o.valor,onClick:t=>e.$imprimir(o.valor,(r.dados.fatura||{}).id||"0")},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(B,{avatar:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(D,{name:"print"})])),_:1}),(0,a.createVNode)(B,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(y,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(o.texto),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128)):(0,a.createCommentVNode)("",!0),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(r.configImpressaoCarne,(o=>((0,a.openBlock)(),(0,a.createBlock)(F,{clickable:"",key:o.valor,onClick:t=>e.$imprimir(o.valor,(r.dados.fatura||{}).id||"0")},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(B,{avatar:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(D,{name:"print"})])),_:1}),(0,a.createVNode)(B,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(y,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(o.texto),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128)),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(r.configImpressaoConvenio,(o=>((0,a.openBlock)(),(0,a.createBlock)(F,{clickable:"",key:o.valor,onClick:t=>e.$imprimir(o.valor,(r.dados.fatura||{}).id||"0")},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(B,{avatar:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(D,{name:"print"})])),_:1}),(0,a.createVNode)(B,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(y,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(o.texto),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})),[[Y]])])),_:1})])),_:1}),(0,a.createVNode)(S,{rounded:"",dense:"",flat:"",icon:"more_vert",color:"tertiary",class:"no-shadow q-ma-xs",size:"md",style:{float:"right"}},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(q,null,{default:(0,a.withCtx)((()=>[(0,a.withDirectives)(((0,a.openBlock)(),(0,a.createBlock)(T,{link:"",separator:""},{default:(0,a.withCtx)((()=>[r.dados.fatura.id?((0,a.openBlock)(),(0,a.createBlock)(F,{key:0,clickable:"",onClick:o[3]||(o[3]=o=>e.$refs.documentosFiscais.emitirCupom(r.dados.fatura.id))},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(B,{avatar:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(D,{name:"account_balance"})])),_:1}),(0,a.createVNode)(B,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(y,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("Emitir cupom")])),_:1})])),_:1})])),_:1})):(0,a.createCommentVNode)("",!0),e.$utils.mapearStatus(r.dados.fatura).permiteNota?((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:1},[(0,a.createVNode)(F,{clickable:"",onClick:o[4]||(o[4]=o=>e.emitirNFeV2({idFatura:r.dados.fatura.id},1,"Venda"))},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(B,{avatar:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(D,{name:"account_balance"})])),_:1}),(0,a.createVNode)(B,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(y,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("NFe de Saída/Venda")])),_:1})])),_:1})])),_:1}),(0,a.createVNode)(F,{clickable:"",onClick:o[5]||(o[5]=o=>e.emitirNFeV2({idFatura:r.dados.fatura.id},0,"Devolução"))},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(B,{avatar:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(D,{name:"account_balance"})])),_:1}),(0,a.createVNode)(B,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(y,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("NFe de Entrada/Devolução")])),_:1})])),_:1})])),_:1}),(0,a.createVNode)(F,{clickable:"",onClick:o[6]||(o[6]=o=>e.emitirNFeV2({idFatura:r.dados.fatura.id},1,"Remessa"))},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(B,{avatar:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(D,{name:"account_balance"})])),_:1}),(0,a.createVNode)(B,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(y,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("NFe de Remessa")])),_:1})])),_:1})])),_:1})],64)):(0,a.createCommentVNode)("",!0),l.mostrarOpcaoRemoverFatura?((0,a.openBlock)(),(0,a.createBlock)(F,{key:2,clickable:"",onClick:o[7]||(o[7]=e=>l.removerFatura())},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(B,{avatar:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(D,{name:"mdi-trash-can"})])),_:1}),(0,a.createVNode)(B,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("Remover Fatura")])),_:1})])),_:1})):(0,a.createCommentVNode)("",!0),(0,a.createVNode)(F,{clickable:"",onClick:o[8]||(o[8]=o=>e.$refs.modalHistoricoStatus.mostrar({idDocumento:r.dados.fatura.id}))},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(B,{avatar:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(D,{name:"history"})])),_:1}),(0,a.createVNode)(B,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("Histórico do Status")])),_:1})])),_:1}),r.mostrarBotaoEnviarAvaliacao&&"Finalizada"===r.dados.fatura.status?((0,a.openBlock)(),(0,a.createBlock)(F,{key:3,clickable:"",onClick:o[9]||(o[9]=e=>l.sendReview(r.dados.fatura))},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(B,{avatar:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(D,{name:"mdi-file-replace-outline"})])),_:1}),(0,a.createVNode)(B,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("Enviar Avaliação")])),_:1})])),_:1})):(0,a.createCommentVNode)("",!0)])),_:1})),[[Y]])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):(0,a.createCommentVNode)("",!0),(0,a.withDirectives)((0,a.createVNode)(_,{class:"items-start q-mx-none q-px-none q-mt-md"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",f,[(0,a.createElementVNode)("p",h,[(0,a.createVNode)(D,{name:"business"}),(0,a.createTextVNode)(" "+(0,a.toDisplayString)(r.dados.fatura.descricaoEmpresa),1)]),(0,a.createVNode)(I,{ref:"documentosFiscais",idFatura:r.dados.fatura.id},null,8,["idFatura"])]),(0,a.createElementVNode)("div",g,[v,(0,a.createElementVNode)("p",V,(0,a.toDisplayString)(r.dados.fatura.observacaoFaturamento),1),(0,a.createVNode)(T,{class:"no-border"},{default:(0,a.withCtx)((()=>[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.condicaoPagamentoResumo,(o=>((0,a.openBlock)(),(0,a.createBlock)(F,{key:o.id,class:"q-pa-none row",style:{"min-height":"auto"}},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(B,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(y,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(o.formaPagamento),1)])),_:2},1024)])),_:2},1024),(0,a.createVNode)(B,{class:"text-right"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(y,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(e.$filters.numero(o.valor,2))+(0,a.toDisplayString)(o.parcelas>1?` (em ${o.parcelas}x)`:""),1)])),_:2},1024)])),_:2},1024),(0,a.createVNode)(B,{right:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(y,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(e.$filters.data(o.dataVencimento)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})]),(0,a.createElementVNode)("div",C,[N,(0,a.createElementVNode)("p",w,(0,a.toDisplayString)(e.$filters.numero(r.dados.fatura.totalDesconto,2)),1)])])),_:1},512),[[a.vShow,r.detalhesVisivel]]),(0,a.createVNode)(z),(0,a.createVNode)(A,{ref:"faturaModal",onExecutar:l.executar},null,8,["onExecutar"]),r.modalBoleto.ativo?((0,a.openBlock)(),(0,a.createBlock)(J,{key:1,modelValue:r.modalBoleto.visivel,"onUpdate:modelValue":o[12]||(o[12]=e=>r.modalBoleto.visivel=e),onHide:l.fecharModalBoleto,minimized:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(j,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(R,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(P,null,{default:(0,a.withCtx)((()=>[b])),_:1}),(0,a.withDirectives)((0,a.createVNode)(S,{flat:"",round:"",dense:"",icon:"close"},null,512),[[Y]])])),_:1}),(0,a.createVNode)(H,null,{default:(0,a.withCtx)((()=>[r.modalBoleto.condicoesPagamento.filter((e=>e.disable)).length?((0,a.openBlock)(),(0,a.createBlock)(T,{key:0,dense:"",highlight:"",class:"q-mb-sm"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(y,{header:""},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("Recuperando informações do servidor "),(0,a.createVNode)(O)])),_:1}),(0,a.createVNode)(z),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(r.modalBoleto.condicoesPagamento.filter((e=>e.disable)),((o,t)=>((0,a.openBlock)(),(0,a.createBlock)(F,{key:t,tag:"label"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(B,null,{default:(0,a.withCtx)((()=>[o.disable?((0,a.openBlock)(),(0,a.createBlock)(M,{key:0})):(0,a.createCommentVNode)("",!0)])),_:2},1024),(0,a.createVNode)(y,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(y,{header:""},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(o.descricao)+" - "+(0,a.toDisplayString)(e.$filters.numero(o.valor,2))+" - Venc. "+(0,a.toDisplayString)(e.$filters.data(o.dataVencimento)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):(0,a.createCommentVNode)("",!0),(0,a.createElementVNode)("form",{class:"q-pa-sm",onSubmit:o[11]||(o[11]=(0,a.withModifiers)((e=>l.emitirImprimirBoleto()),["prevent"]))},[r.modalBoleto.condicoesPagamento.filter((e=>!e.disable&&e.codigoFinanceiroBoleto)).length?((0,a.openBlock)(),(0,a.createBlock)(T,{key:0,dense:"",highlight:"",class:"q-mb-sm"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(y,{header:""},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("Boletos emitidos")])),_:1}),(0,a.createVNode)(z),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(r.modalBoleto.condicoesPagamento.filter((e=>!e.disable&&e.codigoFinanceiroBoleto)),((o,t)=>((0,a.openBlock)(),(0,a.createBlock)(F,{key:t,tag:"label"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(B,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Z,{modelValue:o.checked,"onUpdate:modelValue":e=>o.checked=e},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024),(0,a.createVNode)(y,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(y,{header:""},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(o.descricao)+" - "+(0,a.toDisplayString)(e.$filters.numero(o.valor,2))+" - Venc. "+(0,a.toDisplayString)(e.$filters.data(o.dataVencimento)),1)])),_:2},1024),(0,a.createVNode)(y,{caption:""},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(o.banco.descricao)+" - Ag. "+(0,a.toDisplayString)(o.banco.agencia)+" C/C "+(0,a.toDisplayString)(o.banco.conta)+" - Emitido em "+(0,a.toDisplayString)(e.$filters.dataHora(o.banco.dataEmissao)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):(0,a.createCommentVNode)("",!0),r.modalBoleto.condicoesPagamento.filter((e=>!e.disable&&!e.codigoFinanceiroBoleto)).length?((0,a.openBlock)(),(0,a.createBlock)(T,{key:1,dense:"",highlight:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(y,{header:""},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("Boletos a emitir")])),_:1}),(0,a.createVNode)(z),(0,a.createVNode)(F,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(y,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(U,{modelValue:r.modalBoleto.financeiroBanco,"onUpdate:modelValue":o[10]||(o[10]=e=>r.modalBoleto.financeiroBanco=e),options:r.modalBoleto.bancos},null,8,["modelValue","options"])])),_:1})])),_:1}),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(r.modalBoleto.condicoesPagamento.filter((e=>!e.disable&&!e.codigoFinanceiroBoleto)),((o,t)=>((0,a.openBlock)(),(0,a.createBlock)(F,{key:t,tag:"label"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(B,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Z,{modelValue:o.checked,"onUpdate:modelValue":e=>o.checked=e},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024),(0,a.createVNode)(y,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(y,{header:""},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(o.descricao)+" - "+(0,a.toDisplayString)(e.$filters.numero(o.valor,2))+" - Venc. "+(0,a.toDisplayString)(e.$filters.data(o.dataVencimento)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):(0,a.createCommentVNode)("",!0),(0,a.createElementVNode)("div",x,[(0,a.withDirectives)((0,a.createVNode)(S,{color:"tertiary",flat:"",label:"Cancelar"},null,512),[[Y]]),(0,a.createVNode)(S,{color:"primary",class:"q-ml-sm",label:"Imprimir",type:"submit",unelevated:"",disable:!l.ativarBotaoEmissaoBoleto},null,8,["disable"])])],32),(0,a.createVNode)(L,{showing:r.modalBoleto.loading},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(Q,{size:"50px",color:"primary"})])),_:1},8,["showing"])])),_:1})])),_:1})])),_:1},8,["modelValue","onHide"])):(0,a.createCommentVNode)("",!0),(0,a.createVNode)(X,{ref:"modalHistoricoStatus"},null,512)],64)}]]);ie()(T,"components",{QItem:I.Z,QItemSection:z.Z,QItemLabel:A.Z,QBadge:P.Z,QTooltip:R.Z,QBtn:O.Z,QMenu:M.Z,QList:Z.Z,QIcon:U.Z,QSeparator:Q.Z,QDialog:L.Z,QCard:H.Z,QToolbar:j.Z,QToolbarTitle:J.Z,QCardSection:X.Z,QSpinnerHourglass:Y.Z,QSpinnerDots:G.Z,QCheckbox:W.Z,QSelect:K.Z,QInnerLoading:ee.Z,QSpinner:oe.Z}),ie()(T,"directives",{ClosePopup:te.Z});var le=t(30052),ne=t.n(le),se=(t(54726),t(84830)),de=t.n(se);const ce={alterados:0,arquivo:null,cor:"text-negative",corFinal:"",erro:"",erros:0,incluidos:0,listaErros:[],mensagem:"",mensagemFinal:"",modalResultado:!1},ue={components:{lista:n.Z,FaturaCardLista:re,FaturaModal:E.Z},data:()=>(new Date(new Date($utils.dataAtual()).toDateString()),{tokenRoutEasy:null,tabSelecionada:{valor:"Aberta"},importar:$utils.clonarV2(ce),opcoesStatusEnvio:[{rotulo:"Todos"},{rotulo:"Enviados"},{rotulo:"Não Enviados"}],page:{Aberta:{current:1,min:0,max:0},Finalizada:{current:1,min:0,max:0},ativa:"Aberta"},entregueInicio:new Date(new Date($utils.dataAtual()).toDateString()),entregueFim:new Date(new Date($utils.dataAtual()).toDateString()),status:[],operacoes:[],pageSize:10,grupos:[],buscaCampo:"",empresas:[],empresa:{},empresaOpcoes:[],contatosModal:!1,vendedorModal:!1,digitadorModal:!1,buscaCliente:"",filtro:{opcaoDataSelected:"Data Emissão",statusEnvio:"Todos",valorTotal:0,status:"Aberta",operacao:"",grupos:[],empresa:{id:null},cliente:{id:"",nome:""},vendedor:{id:""},digitador:{id:""},periodo:{emissao:{ini:"",fim:""},finalizado:{ini:"",fim:""}}},paginacao:{atual:1,maximo:1,total:1,limite:25},dbContato:$db.contato,documentos:[],showFilters:!1,vendedorDigitadorSelecionado:null,vendedoresDigitadoresOpcoes:[],diretivaContatosAcessaTodosContatos:!1,showAllPreviewDetail:!1,lista:[],usuario:JSON.parse(localStorage.getItem("usuario")),prazoSelecionado:null,prazoOpcoes:[{label:"Em dia",value:"bordaVerdeCRM"},{label:"Entrega para esta semana",value:"bordaAmarelaCRM"},{label:"Entrega atrasada",value:"bordaVermelhaCRM"}],opcoesData:[{label:"Data Emissão"},{label:"Data Finalização"}]}),methods:{async atualizar(){try{$q.loading.show(),null!==this.vendedorDigitadorSelecionado&&(this.filtro.vendedor.id=this.vendedorDigitadorSelecionado.value);let e="";"Todas"!==this.tabSelecionada.valor&&(e=this.tabSelecionada.valor);let o=this.filtro.vendedor.id;this.diretivaContatosAcessaTodosContatos||(o=this.usuario.codigoContato,this.filtro.vendedor.id=o);let t={status:e,valorTotal:this.filtro.valorTotal,cliente:this.filtro.cliente.nome,operacao:this.filtro.operacao,idEmpresa:this.empresaSelecionada?.id??"",idContato:this.filtro.cliente.id,idContatoVendedor:o,idContatoDigitador:this.filtro.digitador.id,statusEnvio:this.filtro.statusEnvio,termoBusca:this.buscaCampo};"Data Emissão"===this.filtro.opcaoDataSelected&&(t.periodoEmissao={ini:this.filtro.periodo.emissao.ini,fim:this.filtro.periodo.emissao.fim}),"Data Finalização"===this.filtro.opcaoDataSelected&&(t.periodoFinalizado={ini:this.filtro.periodo.finalizado.ini,fim:this.filtro.periodo.finalizado.fim});let a=[];const i=await $db.fatura.leRefatorado({filtros:t,termoBusca:this.buscaCampo,limit:this.paginacao.limite,page:this.paginacao.atual,sort:["dataFinalizacao","dataHoraEmissao"],dir:["desc","desc"]});a=i.data,this.documentos=a,this.paginacao.total=i.total,this.paginacao.maximo=i.totalPages}catch(e){console.log(e),this.$q.notifyError("Erro ao filtrar")}finally{$q.loading.hide()}},limparFiltros_click(){this.empresaSelecionada="",this.filtro={opcaoDataSelected:"Data Emissão",statusEnvio:"Todos",valorTotal:0,status:"Aberta",operacao:"",grupos:[],empresa:{id:null},cliente:{id:"",nome:""},vendedor:{id:""},digitador:{id:""},periodo:{emissao:{ini:"",fim:""},finalizado:{ini:"",fim:""}}},this.atualizar()},async resetarEnvio(e){$q.dialog({message:"Deseja resetar o envio desta fatura?",title:"Atenção!",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Resetar",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk((async()=>{const o=e.id;e.rotaJson="",e.rotaStatus="",e.rotaNome="";const t=(await $erp().documento.where({id:o}).toArray())[0],a=$utils.clonarV2(t);a.rotaJson="",a.rotaStatus="",a.rotaNome="",await $db.documento.grava({atual:a,original:t})}))},async sendRouteEasyAll(){$q.loading.show();try{let e="";"Todas"!==this.tabSelecionada.valor&&(e=this.tabSelecionada.valor),this.tabSelecionada.values&&this.tabSelecionada.values.length&&(e=this.tabSelecionada.values);let o=await $db.venda.leRefatorado({filtros:{faturado:{ini:this.filtro.periodo.faturado.ini,fim:this.filtro.periodo.faturado.fim},periodoEmissao:{ini:this.filtro.periodo.emissao.ini,fim:this.filtro.periodo.emissao.fim},periodoFinalizado:{ini:this.filtro.periodo.finalizado.ini,fim:this.filtro.periodo.finalizado.fim},status:e,valorTotal:this.filtro.valorTotal,cliente:this.filtro.cliente.nome,operacao:this.filtro.operacao,idEmpresa:this.empresaSelecionada?.id??null,idContato:this.filtro.cliente.id,idContatoVendedor:this.filtro.vendedor.id,idContatoDigitador:this.filtro.digitador.id},termoBusca:this.buscaCampo,limit:this.paginacao.total,page:this.paginacao.atual,sort:["dataHoraEmissao","dataFinalizacao"],dir:["desc","desc"]});await this.sendRouteEasy(o),$q.notify({message:"Sincronismo efetuado com sucesso!",type:"positive"})}catch(e){console.log(e)}finally{$q.loading.hide()}},async sendRouteEasy(e){$q.loading.show();let o=e.data,t={deliveries:[]};try{for(let e=0;e<o.length;e++){const a=o[e],i=await $db.contatoEndereco.le({idContato:a.idContato});if(0===i.length){let e=`Não foi possivel envia fatura #ID[${a.id}], pois não foi vinculado um endereço.`;$q.notify(e),console.log(e)}if(a&&a.idContato&&i.length>0){let e=await $db.contato.le({id:a.idContato}),o=await $db.contatoTelefone.le({idContato:e.id}),r=await $db.documentoFiscalEletronico.ler({idDocumento:a.idFatura});$utils.dataAtual();const l=i[0],n=await this.calcularPesoECubicoTotal(a.id);let s=n.pesoTotal||0,d=n.metroCubicoTotal||0,c=r.length>0?r[0].nNF:"",u=($filters.numero(a.totalDocumento,2),parseInt(a.totalDocumento)),m={code:a.idContato,name:a.descricaoContato,site:a.numeroDocumentoEmpresa,additional_info_2:a.numeroDocumentoEmpresa,order_number:a.numero+" "+a.numeroDocumentoEmpresa,invoice_number:c,loads:[s,d,u],email:e.email||"",customer_profile:e.id,phone:o.length>0?o[0].telefone:"",address:{route:l.logradouro,street_number:l.numero?l.numero:"",neighborhood:l.bairro,city:l.municipio,state:l.uf,postal_code:l.cep,country:l.pais}};t.deliveries.push(m)}}if(t.deliveries.length>0){const e=await ne()({method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},baseURL:"https://company.routeasy.com.br",url:"/group?api_key=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYxNDIwYWQ2YzRiNTYzMWEyMmQwYTZhZSIsInRpbWVzdGFtcCI6MTYzMjQ5NTY1ODE1OH0.Nodh7i5OjMak8PQaavO8yComhN6BJa7bPs37SKfe4rE",validateStatus:e=>e>=200&&e<=500,timeout:3e4,data:t});for(const t of e.data.deliveries){const e=o.find((e=>e.numeroDocumentoEmpresa===t.order_number.split(" ")[1]&&e.numero===parseInt(t.order_number.split(" ")[0])));if(!e){$q.notify(`Venda Nº ${t.order_number} / ${t.site} não encontrada!`);continue}const a=(await $erp().documento.where({id:e.id}).toArray())[0],i=$utils.clonarV2(a);i.rotaJson=JSON.stringify({envio:t}),i.rotaStatus="Enviado";let r=$utils.dataAtual().split("T")[0].split("-");i.rotaNome=`Rota do dia ${r[2]}/${r[1]}/${r[0]}`,await $db.documento.grava({atual:i,original:a}),this.$refs[i.id]&&this.$refs[i.id].atualizar()}}else $q.notify("Rota(s) já enviadas ou nao tem informações suficientes.")}catch(e){$q.notify(e.message),console.log("[ERROR][SINCRONSMO][ROUTEASY] => ",e)}finally{if(t.deliveries.length>0){let e=t.deliveries.length>1?"s":"";$q.notify({message:`(${t.deliveries.length}) Rota${e} enviada${e} com sucesso!`,type:"positive"})}$q.loading.hide()}},async executar(e){if(this.$refs.faturaModal.venda.status){for(const e of this.tabs)if(-1!==e.value.indexOf(this.$refs.faturaModal.venda.status)){this.tabSelecionada.valor=e.value;break}"Orçamento"===this.$refs.faturaModal.venda.status&&(this.filtro.opcaoDataSelected="Data Emissão")}await this.atualizar()},async calcularPesoECubicoTotal(e){if(!e)return!1;const o={};let t=0,a=0,i=0,r=0,l=0;const n=await $erp().documentoItem.where({idDocumento:e}).toArray();for(const e of n)if(-1===e.operacaoFator){if(e.idItem&&!o[e.idItem]){const t=await $erp().item.get(e.idItem);t&&(o[e.idItem]=t)}t+=(o[e.idItem].peso||0)*(e.quantidade||0),a+=(o[e.idItem].pesoBruto||0)*(e.quantidade||0),r=(o[e.idItem].altura||0)*(o[e.idItem].largura||0)*o[e.idItem].comprimento||0,l=e.quantidade||0,i+=r>0?r*l:0}return t=$utils.arredondar(t,4),a=$utils.arredondar(a,4),i=$utils.arredondar(i,4),{pesoTotal:t,pesoBrutoTotal:a,metroCubicoTotal:i}},async importarPlanilhaRetorno(e){try{const o=e=>new Promise(((o,t)=>{const a=new FileReader;a.readAsBinaryString(e),a.onload=()=>o(a.result),a.onerror=e=>t(e)})),t=await o(e[0]);let a=de().read(t,{type:"binary"}),i=de().utils.sheet_to_json(a.Sheets[Object.keys(a.Sheets)[0]],{header:1});for(let e=1;e<i.length;e++){const o=i[e],t=i[0];t[0]="Nome Rota";const a=$utils.convertArrToObj(t,o);if(o[29]&&o[29].length>1){console.log("numero pedido => ",o[29].replace("Pedido ",""));try{const e=o[29].replace("Pedido ","").split(" "),t=parseInt(e[0]),i=e[1];if(t>1){const e=(await $erp().documento.where({tipo:"Venda"}).filter((e=>e.numero===t&&e.numeroDocumentoEmpresa===i)).toArray())[0],r={...e},l=$utils.clonarV2(e);l.rotaJson=JSON.stringify({...JSON.parse(l.rotaJson),recebido:JSON.stringify(a)}),l.rotaNome=o[0],l.rotaSequencia=o[4],l.rotaData=$utils.dataAtual(),await $db.documento.grava({original:r,atual:l})}}catch(e){console.log(`[ERROR][IMPORTACAO] => ${e.message}`,e)}}}await this.atualizar(),this.$q.notify({type:"positive",message:"Importação realizada com sucesso"})}catch(e){e.name&&"ErroValidacao"===e.name?this.$q.notifyError(e.message,e):this.$q.notifyError("Ocorreu erro ao importar roterização xlsx",e)}},acessarPainel(){window.open("https://company.routeasy.com.br/#!/routings/create","_blank").focus()},montarObjImportacaoRE(e,o){let t={};for(let a=1;a<e.length;a++){const i=$utils.removerCaracteresEspeciais(e[a]).split(" ");for(let e=0;e<i.length;e++)i[e]=i[e].charAt(0).toUpperCase()+i[e].slice(1);t[i.join("")]=o[a]}return t},aoSelecionarEmpresa(){this.filtro.empresa=this.empresas.filter((e=>e.id===this.filtro.empresa.id))[0]},aoSelecionarStatusEnvio(){},aoSelecionarCliente(e,o){e&&(this.filtro.cliente=$utils.clonarV2(o),this.contatosModal=!1)},adicionarVenda(){this.$refs.faturaModal.mostrar()},abrirTodosPreview(){this.showAllPreviewDetail=!this.showAllPreviewDetail;for(let e of this.documentos)this.$refs[e.id].detalhesVisivel=this.showAllPreviewDetail},async empresaOpcoesCarregar(){this.contatosEmpresa=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data,this.empresaOpcoes=this.contatosEmpresa.map((e=>({label:e.nome,value:e.codigoContato,id:e.id})))},filtraDebounce(){$lodash.debounce(this.atualizar,10)()}},async created(){$db.permissao.objeto("Diretiva_RelatorioVenda_VerTodos").then((async e=>{this.$route.params.id&&this.$route.params.id.length&&this.$refs.faturaModal.mostrar({id:this.$route.params.id}),this.diretivaContatosAcessaTodosContatos=e,this.diretivaContatosAcessaTodosContatos&&(this.vendedoresDigitadoresOpcoes=[],$db.crm.leOnlineVendedoresDigitadores({entregueInicio:this.entregueInicio,entregueFim:this.entregueFim}).then((e=>{e.forEach((e=>{e.codigo&&this.vendedoresDigitadoresOpcoes.push({label:e.nome,value:e.codigo})}))})));let o=await $db.configuracoes.le({nome:"integracao.routeasy"});this.tokenRoutEasy=o.length?o[0].valor:null,await this.empresaOpcoesCarregar(),this.atualizar()})),this.empresaOpcoesCarregar()},async mounted(){let e=await $db.configuracoes.le({nome:"vendas.usaExpedicao"});e=e.length?e[0].valor:null,this.tabs=[{rotulo:"Abertas",value:"Aberta"},{rotulo:"Finalizado",value:"Finalizada"},{rotulo:"Todas",value:""}]}};var me=t(67280);const pe=(0,q.Z)(ue,[["render",function(e,o,t,n,s,d){const c=(0,a.resolveComponent)("campo"),u=(0,a.resolveComponent)("q-select"),m=(0,a.resolveComponent)("row"),p=(0,a.resolveComponent)("fatura-card-lista"),f=(0,a.resolveComponent)("q-list"),h=(0,a.resolveComponent)("lista"),g=(0,a.resolveComponent)("fatura-modal");return(0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,null,[(0,a.createElementVNode)("div",null,[(0,a.createVNode)(h,{titulo:"Faturas",onCriar_click:d.adicionarVenda,icone:"how_to_vote",onFiltro_change:d.atualizar,onLimparFiltros_click:d.limparFiltros_click,onAbrirTodosPreview:d.abrirTodosPreview,tabSelecionada:s.tabSelecionada,tabs:e.tabs,lista:s.documentos,paginacao:s.paginacao,permissaoExtrasV2:s.tokenRoutEasy,showToolbar:!1,permissaoExtras:!1,disableRemove:!0,permissaoNovo:!1,filtros:s.filtro,exportarXLSXVisible:!1,permissaoFicha:!1,buscaCampo:s.buscaCampo,"onUpdate:buscaCampo":o[9]||(o[9]=e=>s.buscaCampo=e),showAdd:!1,checkboxVisible:!1},{menuExtras:(0,a.withCtx)((()=>[])),filtroCampos:(0,a.withCtx)((()=>[(0,a.createVNode)(m,{class:"q-col-gutter-md q-mt-md",style:{"margin-top":"-10px"}},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(c,{modelValue:s.filtro.cliente.nome,"onUpdate:modelValue":[o[0]||(o[0]=e=>s.filtro.cliente.nome=e),d.filtraDebounce],class:"col-md-12",style:{"padding-top":"0px"},debounce:500,before:[{icon:"search"}],rotulo:"Por cliente ou responsável",dense:""},null,8,["modelValue","onUpdate:modelValue"]),(0,a.createVNode)(u,{modelValue:e.empresaSelecionada,"onUpdate:modelValue":[o[1]||(o[1]=o=>e.empresaSelecionada=o),e.refazFiltro],options:s.empresaOpcoes,clearable:"",label:"Por empresa"},null,8,["modelValue","options","onUpdate:modelValue"])])),_:1}),s.tokenRoutEasy&&s.tokenRoutEasy.length>3?((0,a.openBlock)(),(0,a.createBlock)(m,{key:0,class:"q-col-gutter-md q-mt-md"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(c,{tipo:"seletor",dense:"",modelValue:s.filtro.statusEnvio,"onUpdate:modelValue":[o[2]||(o[2]=e=>s.filtro.statusEnvio=e),d.aoSelecionarStatusEnvio],options:s.opcoesStatusEnvio.map((e=>({label:e.rotulo,value:e.rotulo}))),clearable:"",rotulo:"Status Envio"},null,8,["modelValue","options","onUpdate:modelValue"])])),_:1})):(0,a.createCommentVNode)("",!0),(0,a.createVNode)(m,{class:"q-col-gutter-md q-mt-md"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(c,{tipo:"seletor",dense:"",modelValue:s.filtro.opcaoDataSelected,"onUpdate:modelValue":o[3]||(o[3]=e=>s.filtro.opcaoDataSelected=e),options:s.opcoesData.map((e=>({label:e.label,value:e.label}))),rotulo:"Selecione data para filtro"},null,8,["modelValue","options"])])),_:1}),"Data Emissão"===s.filtro.opcaoDataSelected?((0,a.openBlock)(),(0,a.createBlock)(m,{key:1,class:"q-col-gutter-md q-mt-md"},{default:(0,a.withCtx)((()=>[i,(0,a.createVNode)(c,{modelValue:s.filtro.periodo.emissao.ini,"onUpdate:modelValue":o[4]||(o[4]=e=>s.filtro.periodo.emissao.ini=e),tipo:"data",class:"no-shadow full-width",rotulo:"De",col:"12",after:[{icon:"mdi-close-circle",handler(){s.filtro.periodo.emissao.ini=""}}],dense:""},null,8,["modelValue","after"]),(0,a.createVNode)(c,{modelValue:s.filtro.periodo.emissao.fim,"onUpdate:modelValue":o[5]||(o[5]=e=>s.filtro.periodo.emissao.fim=e),tipo:"data",class:"no-shadow full-width",rotulo:"até",col:"12",after:[{icon:"mdi-close-circle",handler(){s.filtro.periodo.emissao.fim=""}}],dense:""},null,8,["modelValue","after"])])),_:1})):(0,a.createCommentVNode)("",!0),"Data Finalização"===s.filtro.opcaoDataSelected?((0,a.openBlock)(),(0,a.createBlock)(m,{key:2,class:"q-col-gutter-md q-mt-md"},{default:(0,a.withCtx)((()=>[r,(0,a.createVNode)(c,{modelValue:s.filtro.periodo.finalizado.ini,"onUpdate:modelValue":o[6]||(o[6]=e=>s.filtro.periodo.finalizado.ini=e),tipo:"data",class:"no-shadow full-width",rotulo:"De",col:"12",after:[{icon:"mdi-close-circle",handler(){s.filtro.periodo.finalizado.ini=""}}],dense:""},null,8,["modelValue","after"]),(0,a.createVNode)(c,{modelValue:s.filtro.periodo.finalizado.fim,"onUpdate:modelValue":o[7]||(o[7]=e=>s.filtro.periodo.finalizado.fim=e),tipo:"data",class:"no-shadow full-width",rotulo:"até",col:"12",after:[{icon:"mdi-close-circle",handler(){s.filtro.periodo.finalizado.fim=""}}],dense:""},null,8,["modelValue","after"])])),_:1})):(0,a.createCommentVNode)("",!0),l,(0,a.createVNode)(c,{modelValue:s.paginacao.limite,"onUpdate:modelValue":o[8]||(o[8]=e=>s.paginacao.limite=e),min:"1",rotulo:"Quantidade por página",tipo:"quantidade",dense:""},null,8,["modelValue"])])),itemLista:(0,a.withCtx)((()=>[(0,a.createVNode)(f,{class:"rounded-borders"},{default:(0,a.withCtx)((()=>[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(s.documentos,(e=>((0,a.openBlock)(),(0,a.createElementBlock)("div",{key:e.id,class:"itemHover fullWidth q-px-sm"},[(0,a.createVNode)(p,{sendRouteEasy:d.sendRouteEasy,resetarEnvio:d.resetarEnvio,fatura:e.fatura,id:e.id,ref_for:!0,ref:e.id,class:"q-mb-md"},null,8,["sendRouteEasy","resetarEnvio","fatura","id"])])))),128))])),_:1})])),_:1},8,["onCriar_click","onFiltro_change","onLimparFiltros_click","onAbrirTodosPreview","tabSelecionada","tabs","lista","paginacao","permissaoExtrasV2","filtros","buscaCampo"])]),(0,a.createVNode)(g,{ref:"faturaModal",onExecutar:d.executar,onAtualizarAtendimentoVenda:d.executar,continueMesmaTela:!1},null,8,["onExecutar","onAtualizarAtendimentoVenda"])],64)}]]);ie()(ue,"components",{QChip:me.Z,QSelect:K.Z,QList:Z.Z})}}]);