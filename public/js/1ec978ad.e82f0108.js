(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["1ec978ad"],{b569:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"AutenticacaoBancos"},["semConexao"===e.operacao?a("q-alert",{attrs:{actions:e.erroAcoes,detail:"Tente novamente em instantes.",type:"negative"}},[e._v("\n    Erro ao estabelecer conexão.\n  ")]):"selecionar"===e.operacao?a("form",{staticClass:"text-white",on:{submit:function(t){return t.preventDefault(),e.adicionarBancos(t)}}},[a("p",[e._v("Selecione os bancos de dados que deseja disponibilizar nesta máquina:")]),a("div",{staticClass:"AutenticacaoBancos-bancos"},[a("campo",{attrs:{rotulo:"Filtro",inverted:"",classCampo:"transparent"},model:{value:e.filtro,callback:function(t){e.filtro=t},expression:"filtro"}}),e._l(e.clienteSistemasFiltrado,function(t,n){return a("q-field",{key:n},[a("q-checkbox",{attrs:{label:t.sistema+" - "+t.bancoDeDados,val:t.idClienteSistema},model:{value:e.idsClienteSistemaSelecionados,callback:function(t){e.idsClienteSistemaSelecionados=t},expression:"idsClienteSistemaSelecionados"}})],1)})],2),a("div",{staticClass:"actions q-mt-lg"},[a("q-btn",{attrs:{color:"transparent",label:"Desconectar",size:"md","text-color":"primary"},on:{click:e.desconectar}}),a("q-btn",{staticClass:"q-ml-md",attrs:{autofocus:"",color:"white",label:"Continuar","text-color":"primary",type:"submit",disable:!e.idsClienteSistemaSelecionados.length}})],1)]):"sincronizando"===e.operacao?a("div",{staticClass:"q-mt-md text-white"},[a("q-spinner",{attrs:{color:"white",size:35}}),a("div",{staticClass:"q-body-1 q-mt-sm"},[e._v("Aguarde, sincronizando...")]),a("div",{staticClass:"q-caption q-mt-sm text-light"},[e._v("\n      plataforma: "+e._s(e.sincronismoStatus.bancos.plataforma)+"\n    ")])],1):"redirecionando"===e.operacao?a("div",{staticClass:"q-mt-md text-white"},[a("div",{staticClass:"q-body-1 q-mt-sm"},[e._v("Redirecionando...")])]):"adicionandoBancoDeDados"===e.operacao?a("div",{staticClass:"q-mt-md text-white"},[a("q-spinner",{attrs:{color:"white",size:35}}),a("div",{staticClass:"q-body-1 q-mt-sm"},[e._v("Adicionado bancos de dados...")])],1):a("div",{staticClass:"q-mt-md text-white"},[a("div",{staticClass:"q-body-1 q-mt-sm"},[e._v("Carregando...")])])],1)},i=[];n._withStripped=!0;a("55dd"),a("c5f6"),a("7514"),a("ac4d"),a("8a81"),a("ac6a"),a("6762"),a("2fdb"),a("7f7f"),a("96cf");var s=a("c973"),r=a.n(s),o=a("88db"),c=a("74ce"),l=a("ed08"),u=a("8149"),d=a("3e8a"),m=a("9408"),p={components:{Campo:o["a"]},data:function(){return{filtro:"",idsClienteSistemaSelecionados:[],operacao:"",sincronismoStatus:m["a"].status,clienteSistemasFiltrado:[],erroAcoes:[{label:"Retomar",handler:this.atualizar}]}},methods:{abrirSistema:function(){var e=r()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.operacao="redirecionando",e.next=3,this.routerRetry({name:"Home"});case 3:if(e.sent){e.next=8;break}return l["gconsole"].log("AutenticacaoBancos","Erro no abrirSistema, fazendo reload",this.$route.name),e.next=7,Object(l["dormir"])(1e3);case 7:window.location.reload();case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),obterDispositivo:function(){var e=localStorage.getItem("dispositivoCliente");e||(e=Object(l["uuid"])(),localStorage.setItem("dispositivoCliente",e));var t={id:e,detalhe:JSON.stringify({navigator:navigator?{platform:navigator.platform,vendor:navigator.vendor,appVersion:navigator.appVersion,userAgent:navigator.userAgent,deviceMemory:navigator.deviceMemory,connection_downlink:(navigator.connection||{}).downlink}:{},screen:screen?{width:screen.width,height:screen.height}:{},usuario:{id:u["a"].usuario.logado.id,nome:u["a"].usuario.logado.nome},dataHora:Object(l["dataAtual"])()})};return t},adicionarBancos:function(){var e=r()(regeneratorRuntime.mark(function e(){var t,a,n,i,s,r,o,p,h,f,b,v,g,S,x,C,w,k,A,q,D=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(l["gconsole"].log("AutenticacaoBancos","adicionarBancos()"),this.idsClienteSistemaSelecionados.length){e.next=4;break}return this.operacao="selecionar",e.abrupt("return",this.$q.notifyError("Banco de dados não selecionado"));case 4:return this.operacao="adicionandoBancoDeDados",t=JSON.parse(localStorage.getItem("clienteSistema")||"null"),a=this.sistemas.filter(function(e){return D.idsClienteSistemaSelecionados.includes(e.idClienteSistema)}),n=t&&this.idsClienteSistemaSelecionados.includes(t.id)?t:a[0],i=this.obterDispositivo(),s=a.filter(function(e){return"19A"===e.versao}),r=Object(l["unicos"])(s,"bancoDeDados"),e.next=13,d["b"].sincronismo.toArray();case 13:o=e.sent,u["a"].cache.setJson("clienteSistemaBaixados",a),u["a"].cache.setJson("clienteSistema",n),u["a"].cache.set("bancoDeDados",n.bancoDeDados),localStorage.setItem("sincronismoPlat","sincronizando"),localStorage.setItem("versaoPlataforma",""),p=!0,h=!1,f=void 0,e.prev=22,b=d["b"].tables[Symbol.iterator]();case 24:if(p=(v=b.next()).done){e.next=32;break}if(g=v.value,"login"===g.name){e.next=29;break}return e.next=29,g.clear();case 29:p=!0,e.next=24;break;case 32:e.next=38;break;case 34:e.prev=34,e.t0=e["catch"](22),h=!0,f=e.t0;case 38:e.prev=38,e.prev=39,p||null==b.return||b.return();case 41:if(e.prev=41,!h){e.next=44;break}throw f;case 44:return e.finish(41);case 45:return e.finish(38);case 46:return e.next=48,c["a"].getDatabaseNames();case 48:e.t1=function(e){return"plataforma"!==e&&!r.includes(e)},S=e.sent.filter(e.t1),S.forEach(function(e){Object(d["a"])(e,"delete")}),x=!0,C=!1,w=void 0,e.prev=54,k=regeneratorRuntime.mark(function e(){var t,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=q.value,a=o.find(function(e){return e.bancoDeDados===t})||{bancoDeDados:t},e.next=4,d["b"].sincronismo.put(a);case 4:return e.next=6,u["a"].dispositivoCliente.grava(i,t);case 6:case"end":return e.stop()}},e)}),A=r[Symbol.iterator]();case 57:if(x=(q=A.next()).done){e.next=62;break}return e.delegateYield(k(),"t2",59);case 59:x=!0,e.next=57;break;case 62:e.next=68;break;case 64:e.prev=64,e.t3=e["catch"](54),C=!0,w=e.t3;case 68:e.prev=68,e.prev=69,x||null==A.return||A.return();case 71:if(e.prev=71,!C){e.next=74;break}throw w;case 74:return e.finish(71);case 75:return e.finish(68);case 76:return e.next=78,m["a"].atualizarStatus();case 78:return this.sincronismoStatus.bancos.plataforma="0 %",this.sincronismoStatus.concluidoPlat=!1,e.abrupt("return",this.sincronismoInicial());case 81:case"end":return e.stop()}},e,this,[[22,34,38,46],[39,,41,45],[54,64,68,76],[69,,71,75]])}));return function(){return e.apply(this,arguments)}}(),desconectar:function(){l["gconsole"].log("AutenticacaoBancos","desconectar()"),u["a"].usuario.desconecta(),this.$router.push({name:"Autenticacao"})},sincronismoInicial:function(){var e=r()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:l["gconsole"].log("AutenticacaoBancos","sincronismoInicial()"),m["a"].descarregarPlataforma(),m["a"].descarregarErp(),this.operacao="sincronizando";case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),atualizar:function(){var e=r()(regeneratorRuntime.mark(function e(){var t,a,n,i,s,r,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(l["gconsole"].log("AutenticacaoBancos","atualizar()"),e.prev=1,this.$q.loading.show(),navigator.onLine){e.next=6;break}return this.operacao="semConexao",e.abrupt("return");case 6:return t=JSON.parse(localStorage.getItem("clienteSistemaBaixados")||"[]"),a=t.map(function(e){return e.idClienteSistema}),n=function(e){return""+(99-Number(e.padrao))+Number(!a.includes(e.idClienteSistema))+e.sistema+e.bancoDeDados},e.next=11,u["a"].usuario.inicializaLogado();case 11:if(!navigator.onLine){e.next=18;break}return e.next=14,this.$utils.geeksApi({clienteSistemas:{funcao:"50BD6521-7654-4455-A161-BDFFCC1AA3A9"}},"GeeksPlat15A");case 14:i=e.sent,this.sistemas=i.data.clienteSistemas.sort(function(e,t){return n(e).localeCompare(n(t))}),e.next=19;break;case 18:this.sistemas=u["a"].usuario.logado.sistemas.sort(function(e,t){return n(e).localeCompare(n(t))});case 19:return e.next=21,c["a"].getDatabaseNames();case 21:if(s=e.sent,s.includes("plataforma")){e.next=25;break}return this.$q.notifyError("O banco principal não foi encontrado."),e.abrupt("return",this.desconectar());case 25:if(Array.isArray(this.sistemas)){e.next=28;break}return this.$q.notifyError("Não foi possível obter os bancos de dados."),e.abrupt("return",this.desconectar());case 28:if(!(this.sistemas.length<=0)){e.next=31;break}return this.$q.notifyError("Este usuário não possui direito de acesso a nenhum sistema."),e.abrupt("return",this.desconectar());case 31:if(r=this.sistemas.filter(function(e){return"19A"===e.versao}),"selecionar"!==this.operacao){e.next=37;break}return l["gconsole"].log("AutenticacaoBancos","aguardando selecionar sistemas/bancos"),this.idsClienteSistemaSelecionados=a,this.clienteSistemasFiltrado=this.sistemas,e.abrupt("return");case 37:if(o=localStorage.getItem("clienteSistema"),o){e.next=41;break}return r.length<=1&&this.sistemas.length<=10?(l["gconsole"].log("AutenticacaoBancos","menos de 10 sistemas online e 1 banco offline"),this.idsClienteSistemaSelecionados=this.sistemas.map(function(e){return e.idClienteSistema}),this.adicionarBancos()):(l["gconsole"].log("AutenticacaoBancos","aguardando selecionar sistemas/bancos"),this.idsClienteSistemaSelecionados=a,this.clienteSistemasFiltrado=this.sistemas,this.operacao="selecionar"),e.abrupt("return");case 41:if(this.sincronismoStatus.concluidoPlat){e.next=43;break}return e.abrupt("return",this.sincronismoInicial());case 43:return l["gconsole"].log("abrirSistema","via atualizar"),e.abrupt("return",this.abrirSistema());case 47:e.prev=47,e.t0=e["catch"](1),this.$q.notifyError("Erro na operação",e.t0);case 50:return e.prev=50,this.$q.loading.hide(),e.finish(50);case 53:case"end":return e.stop()}},e,this,[[1,47,50,53]])}));return function(){return e.apply(this,arguments)}}(),mostraTelaSelecao:function(e){l["gconsole"].log("AutenticacaoBancos","aguardando selecionar sistemas/bancos"),this.idsClienteSistemaSelecionados=e;var t=function(t){return""+(99-Number(t.padrao))+Number(!e.includes(t.idClienteSistema))+t.sistema+t.bancoDeDados};this.clienteSistemasFiltrado=this.sistemas=this.sistemas.sort(function(e,a){return t(e).localeCompare(t(a))}),this.operacao="selecionar"}},watch:{filtro:function(e){l["gconsole"].log("AutenticacaoBancos","filtro",e),this.clienteSistemasFiltrado=e?this.sistemas.filter(function(t){return t.bancoDeDados.toUpperCase().includes(e.toUpperCase())}):this.sistemas},"sincronismoStatus.concluidoPlat":function(e){l["gconsole"].log("AutenticacaoBancos","sincronismoStatus.concluidoPlat",e),e&&"selecionar"!==this.operacao&&this.abrirSistema()}},created:function(){var e=r()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.operacao=this.$route.params.operacao;case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),mounted:function(){var e=r()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.atualizar();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},h=p,f=(a("f9f8"),a("2877")),b=Object(f["a"])(h,n,i,!1,null,null,null);b.options.__file="AutenticacaoBancos.vue";t["default"]=b.exports},f9f8:function(e,t,a){"use strict";var n=a("fed2"),i=a.n(n);i.a},fed2:function(e,t,a){}}]);