(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["0b6a54dd"],{"0ebd":function(e,t,a){"use strict";a("6762"),a("2fdb"),a("ac4d"),a("8a81"),a("ac6a"),a("20d6"),a("7514"),a("96cf");var o=a("c973"),r=a.n(o),n=a("8149"),i=a("3e8a"),s=a("2ef0"),c=a("ed08");t["a"]={data:function(){return{condicaoPagamento:[],condicaoPagamentoOriginal:[],condicaoPagamentoResumo:[]}},methods:{resumeCondicaoPagamento:function(){var e=r()(regeneratorRuntime.mark(function e(){var t,a,o,r,l,d,u,m,p,v,h,f,b,g,C,x=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,n["a"].formaPagamento.le();case 2:for(t=e.sent,a=this.condicaoPagamento.filter(function(e){return x.condicaoPagamentoOriginal.find(function(t){return t.id===e.id&&(t.valor!==e.valor||t.dataVencimento!==e.dataVencimento)})}).map(function(e){return e.id}),o=!0,r=!1,l=void 0,e.prev=7,d=this.condicaoPagamento[Symbol.iterator]();!(o=(u=d.next()).done);o=!0)m=u.value,a.includes(m.id)&&(m.id=Object(c["uuid"])());e.next=15;break;case 11:e.prev=11,e.t0=e["catch"](7),r=!0,l=e.t0;case 15:e.prev=15,e.prev=16,o||null==d.return||d.return();case 18:if(e.prev=18,!r){e.next=21;break}throw l;case 21:return e.finish(18);case 22:return e.finish(15);case 23:p=this.condicaoPagamento.reduce(function(e,a){var o=-1,r=t.find(function(e){return e.id===a.idFormaPagamento})||{};return a.parcelas=1,a.formaPagamento=r.descricao,a.autorizacao&&(o=e.findIndex(function(e){return a.autorizacao===e.autorizacao&&a.idFormaPagamento===e.idFormaPagamento&&a.idDocumentoCaixa===e.idDocumentoCaixa})),-1!==o?(e[o].parcelas++,5!==r.tipo&&(e[o].valor+=a.valor)):e.push(Object(c["clonar"])(a)),e},[]),v=!0,h=!1,f=void 0,e.prev=27,b=regeneratorRuntime.mark(function e(){var a,o,r,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(a=C.value,o=t.find(function(e){return e.id===a.idFormaPagamento}),!a.idFinanceiroTitulo||!o||"Título em aberto"!==o.tipoFinanceiro){e.next=16;break}return e.next=5,Object(i["a"])().financeiroTitulo.get(a.idFinanceiroTitulo);case 5:if(r=e.sent,!r||!r.idFinanceiroMovimentacaoAgrupamento){e.next=15;break}return e.next=9,Object(i["a"])().financeiroMovimentacao.where({idFinanceiroMovimentacaoN:r.idFinanceiroMovimentacaoAgrupamento}).toArray();case 9:if(n=e.sent,n=n.find(function(e){return e.idFinanceiroCheque}),!n){e.next=15;break}return e.next=14,Object(i["a"])().financeiroTitulo.get(n.idFinanceiroCheque);case 14:r=e.sent;case 15:r&&r.dataPagamento&&(a.liquidado=!0);case 16:case"end":return e.stop()}},e)}),g=p[Symbol.iterator]();case 30:if(v=(C=g.next()).done){e.next=35;break}return e.delegateYield(b(),"t1",32);case 32:v=!0,e.next=30;break;case 35:e.next=41;break;case 37:e.prev=37,e.t2=e["catch"](27),h=!0,f=e.t2;case 41:e.prev=41,e.prev=42,v||null==g.return||g.return();case 44:if(e.prev=44,!h){e.next=47;break}throw f;case 47:return e.finish(44);case 48:return e.finish(41);case 49:this.condicaoPagamentoResumo=Object(s["orderBy"])(p,["idFormaPagamento","dataVencimento"],["","asc"]);case 50:case"end":return e.stop()}},e,this,[[7,11,15,23],[16,,18,22],[27,37,41,49],[42,,44,48]])}));return function(){return e.apply(this,arguments)}}()}}},1148:function(e,t,a){"use strict";var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"Faturamento"},[a("div",{staticClass:"border-1 q-my-sm"},[a("p",{staticClass:"q-item-label ",staticStyle:{color:"#0c0c0c"}},[a("q-icon",{staticClass:"q-mr-md",staticStyle:{color:"#737373"},attrs:{name:"credit_card",size:"24px"}}),e._v(" Faturamento\n    ")],1),e.visivel?a("div",{staticClass:"gutter-x-sm"},[a("campo",{staticClass:"q-mb-md",attrs:{tipo:"textoArea",rotulo:"Observação faturamento","somente-leitura":e.somenteLeitura.observacaoFaturamento},model:{value:e.observacaoFaturamento,callback:function(t){e.observacaoFaturamento=t},expression:"observacaoFaturamento"}}),e.temCaixaEmpresa&&!e.somenteLeitura.caixas&&e.habilitaFaturamento?a("campo",{staticClass:"col-12",attrs:{opcoes:e.caixas,tipo:"seletor"},model:{value:e.idDocumentoCaixa,callback:function(t){e.idDocumentoCaixa=t},expression:"idDocumentoCaixa"}}):e._e()],1):a("div",{staticClass:"col-3 col-md"},[a("q-btn",{staticClass:"botaoAcesso full-width",attrs:{color:"primary",outline:"",icon:"lock_open",label:"Abrir caixa",size:"lg"},nativeOn:{click:function(t){e.modalCaixaAbrir=!0}}})],1)]),e.visivel&&!e.somenteLeitura.formasPagamento&&e.habilitaFaturamento?a("div",{staticClass:"gutter-x-sm items-end row q-mb-sm"},[a("campo",{staticClass:"col-12 col-md-4",attrs:{opcoes:e.formasPagamento.filter(function(e){return e.visivel}),rotulo:"Forma de pagamento",tipo:"seletor"},on:{input:e.aoSelecionarFormaPagamento},model:{value:e.campos.idFormaPagamento,callback:function(t){e.$set(e.campos,"idFormaPagamento",t)},expression:"campos.idFormaPagamento"}}),a("campo",{staticClass:"col-12 col-md",attrs:{rotulo:"Valor",tipo:"decimal",decimals:"2",erro:!!e.erroValor,"erro-rotulo":e.erroValor},model:{value:e.campos.valor,callback:function(t){e.$set(e.campos,"valor",e._n(t))},expression:"campos.valor"}}),e.temParcelamento?a("campo",{staticClass:"col-12 col-md",attrs:{"rotulo-fixo":"Parcelas",tipo:"decimal",erro:!!e.erroParcelamento,"erro-rotulo":e.erroParcelamento},model:{value:e.parcelas,callback:function(t){e.parcelas=e._n(t)},expression:"parcelas"}}):e._e(),e.desabilitadoDataVencimento?e._e():a("campo",{staticClass:"col-12 col-md",attrs:{rotulo:"Data",tipo:"data",erro:!!e.erroDataVencimento,"erro-rotulo":e.erroDataVencimento},model:{value:e.campos.dataVencimento,callback:function(t){e.$set(e.campos,"dataVencimento",t)},expression:"campos.dataVencimento"}}),a("div",{staticClass:"col-12 col-md-auto text-center q-my-md"},[a("q-btn",{attrs:{color:"positive",icon:"add",label:"Forma de pagamento",outline:"",size:"sm",disabled:!e.campos.idFormaPagamento},on:{click:e.aoAdicionarPagamento}})],1)],1):e._e(),e.condicaoPagamentoResumo.length?a("q-list",{staticClass:"q-pa-none",attrs:{highlight:""}},e._l(e.condicaoPagamentoResumo,function(t){return a("q-item",{key:t.id,staticClass:"row u-separador q-my-none q-pa-xs"},[a("div",{staticClass:"col-9 col-lg-10 q-pl-sm"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-12 col-sm-5 "},[e._v("\n            "+e._s(t.formaPagamento)+"\n          ")]),a("div",{staticClass:"col-12 col-sm-4"},[e._v("\n            "+e._s(e._f("numero")(t.valor,2))+e._s(t.parcelas>1?" (em "+t.parcelas+"x)":"")+"\n            "),t.sinal?a("badge",{attrs:{cor:"positive",escuro:""}},[e._v("Sinal")]):e._e()],1),a("div",{staticClass:"col-12 col-sm-3"},[e._v("\n            "+e._s(e._f("data")(t.dataVencimento))+"\n          ")])])]),t.liquidado||e.somenteLeitura.condicaoPagamento[t.id]?e._e():a("div",{staticClass:"col-3 col-lg-2 text-right"},[a("q-btn",{attrs:{color:"faded",dense:"",flat:"",icon:"edit",round:""},on:{click:function(a){e.alterarPagamento(t)}}}),a("q-btn",{attrs:{color:"faded",dense:"",flat:"",icon:"delete",round:""},on:{click:function(a){e.removerPagamento(t)}}})],1)])})):e._e(),e.habilitaFaturamento?[e.valorRestante>0?a("div",{staticClass:"q-caption q-mt-md text-center text-faded uppercase"},[a("strong",{staticClass:"q-mr-md"},[e._v("Valor restante")]),e._v(" "+e._s(e._f("numero")(e.valorRestante,2))+"\n    ")]):e._e(),e.troco>0?a("div",{staticClass:"q-caption q-mt-md text-center text-faded uppercase"},[a("strong",{staticClass:"q-mr-md"},[e._v("Troco")]),e._v(" "+e._s(e._f("numero")(e.troco,2))+"\n    ")]):e._e()]:e._e(),e.creditoDevolucao?a("div",{staticClass:"q-caption q-mt-md text-center text-faded uppercase"},[a("strong",{staticClass:"q-mr-md"},[e._v("Crédito de devolução")]),e._v(" "+e._s(e._f("numero")(e.creditoDevolucao,2))+"\n  ")]):e._e(),e.checaLimite?a("div",{staticClass:"q-caption q-mt-md text-center text-faded uppercase"},[a("strong",{staticClass:"q-mr-md"},[e._v("Limite de crédito")]),e._v(" "+e._s(e._f("numero")(e.creditoDisponivel,2))+"\n  ")]):e._e(),e.formaPagamento?a("q-modal",{attrs:{"content-css":{minWidth:"40vw"}},model:{value:e.modalPagamento,callback:function(t){e.modalPagamento=t},expression:"modalPagamento"}},[a("q-modal-layout",[a("q-toolbar",{attrs:{slot:"header"},slot:"header"},[a("q-toolbar-title",[e._v(e._s(e.formaPagamento.rotulo))]),a("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"close",round:""}})],1),a("form",{staticClass:"layout-padding",on:{submit:function(t){return t.preventDefault(),e.aoSalvarModalPagamento(t)}}},[2===e.formaPagamento.tipo?[a("campo",{attrs:{rotulo:"Titular",maxlength:"255"},model:{value:e.campos.nomeTitular,callback:function(t){e.$set(e.campos,"nomeTitular",t)},expression:"campos.nomeTitular"}}),a("q-select",{attrs:{"float-label":"Banco",options:e.opcoesBanco,filter:""},nativeOn:{click:function(t){return e.leOpcoesBanco(t)}},model:{value:e.campos.idBanco,callback:function(t){e.$set(e.campos,"idBanco",t)},expression:"campos.idBanco"}}),a("campo",{attrs:{rotulo:"Agência"},model:{value:e.campos.agencia,callback:function(t){e.$set(e.campos,"agencia",t)},expression:"campos.agencia"}}),a("campo",{attrs:{rotulo:"Conta"},model:{value:e.campos.conta,callback:function(t){e.$set(e.campos,"conta",t)},expression:"campos.conta"}}),a("campo",{attrs:{tipo:"decimal",decimals:"0",rotulo:"Número do cheque"},model:{value:e.campos.numeroCheque,callback:function(t){e.$set(e.campos,"numeroCheque",e._n(t))},expression:"campos.numeroCheque"}})]:e._e(),~[3,4].indexOf(e.formaPagamento.tipo)?[a("campo",{attrs:{rotulo:"Autorização Cartão",erro:!!e.erroPreenchimentoAutorizacaoCartao,"erro-rotulo":e.erroPreenchimentoAutorizacaoCartao},model:{value:e.campos.autorizacao,callback:function(t){e.$set(e.campos,"autorizacao","string"===typeof t?t.trim():t)},expression:"campos.autorizacao"}}),a("campo",{attrs:{rotulo:"Número Documento",erro:!!e.erroPreenchimentoDocumentoCartao,"erro-rotulo":e.erroPreenchimentoDocumentoCartao},model:{value:e.campos.documento,callback:function(t){e.$set(e.campos,"documento","string"===typeof t?t.trim():t)},expression:"campos.documento"}})]:e._e(),~[2,5,97].indexOf(e.formaPagamento.tipo)||99===e.formaPagamento.tipo&&!e.formaPagamento.contaCredito?[a("campo",{attrs:{rotulo:"Data",tipo:"data",erro:!!e.erroDataVencimento,"erro-rotulo":e.erroDataVencimento},model:{value:e.campos.dataVencimento,callback:function(t){e.$set(e.campos,"dataVencimento",t)},expression:"campos.dataVencimento"}})]:e._e(),a("campo",{attrs:{rotulo:"Valor",tipo:"decimal",decimals:"2",erro:!!e.erroValor,"erro-rotulo":e.erroValor},model:{value:e.campos.valor,callback:function(t){e.$set(e.campos,"valor",t)},expression:"campos.valor"}}),a("campo",{attrs:{rotulo:"Observação",tipo:"textoArea"},model:{value:e.campos.observacao,callback:function(t){e.$set(e.campos,"observacao",t)},expression:"campos.observacao"}}),a("div",{staticClass:"q-mt-lg text-center"},[a("q-btn",{attrs:{color:"faded",flat:"",label:"Cancelar"},on:{click:e.aoCancelarModalPagamento}}),a("q-btn",{staticClass:"q-ml-sm no-shadow",attrs:{color:"primary",label:"Salvar",type:"submit"}})],1)],2)],1)],1):e._e(),a("caixa-abrir",{on:{aberto:e.atualizar},model:{value:e.modalCaixaAbrir,callback:function(t){e.modalCaixaAbrir=t},expression:"modalCaixaAbrir"}})],2)},r=[];o._withStripped=!0;a("6762"),a("2fdb"),a("ac4d"),a("8a81"),a("ac6a"),a("20d6"),a("96cf");var n=a("c973"),i=a.n(n),s=a("3156"),c=a.n(s),l=(a("7514"),a("a0fd")),d=a("ebdd"),u=a("88db"),m=a("0ebd"),p=a("f490"),v=a("ed08"),h=a("2ef0"),f=a("8149"),b=a("3e8a"),g={components:{Badge:l["a"],CaixaAbrir:d["a"],Campo:u["a"]},computed:{desabilitadoDataVencimento:function(){if(99===this.formaPagamento.tipo&&!this.formaPagamento.contaCredito)return!1;var e=!!this.formaPagamento&&this.formaPagamento.tipo,t=this.perfisFormasPagamento.dataVencimento;return!e||!~t.indexOf(e)},perfisFormasPagamento:function(){return{parcelas:[2,3,4,5,97],dataVencimento:[2,5,97]}},temParcelamento:function(){if(99===this.formaPagamento.tipo&&!this.formaPagamento.contaCredito)return!0;var e=!!this.formaPagamento&&this.formaPagamento.tipo,t=this.perfisFormasPagamento.parcelas;return!!e&&~t.indexOf(e)},erroParcelamento:function(){if(this.verificarErroParcelamento&&this.temParcelamento){if(!this.parcelas)return"Preenchimento obrigatório";var e=1,t=this.formaPagamento.parcelamentoMaximo||1;if(this.parcelas<e)return"Mínimo permitido: "+e;if(this.parcelas>t)return"Máximo permitido: "+t}return""},erroPreenchimentoAutorizacaoCartao:function(){return this.verificarDadosCartao&&!this.campos.autorizacao?"Campo Obrigatório":""},erroPreenchimentoDocumentoCartao:function(){return this.verificarDadosCartao&&!this.campos.documento?"Campo Obrigatório":""},erroValor:function(){var e=this;if(this.verificarValor){if(this.campos.valor<=0)return"Valor não permitido";if(99===this.formaPagamento.tipo&&this.formaPagamento.contaCredito&&this.documento.totalDocumento>0){var t=Object(v["arredondar"])(this.condicaoPagamentoResumo.reduce(function(t,a){return e.campos.id!==a.id&&a.idFormaPagamento===e.formaPagamento.id&&(t+=a.valor),t},this.campos.valor));if(t>this.creditoDevolucao)return"Crédito de devolução disponível: "+this.$filters.numero(this.creditoDevolucao,2)}if(this.checaLimite&&this.documento.totalDocumento>0){var a=Object(v["arredondar"])(this.condicaoPagamentoResumo.reduce(function(t,a){return e.campos.id!==a.id&&(t+=a.valor),t},this.campos.valor));if(a>this.creditoDisponivel)return"Limite de crédito disponível: "+this.$filters.numero(this.creditoDisponivel,2)}}return""},erroDataVencimento:function(){if(!this.verificarDataVencimento)return"";var e=new Date,t="Data vencimento não pode ser menor que a data de hoje.",a=this.caixas.reduce(function(e,t){return e[t.id]||(e[t.id]=t),e},{});if(a[this.idDocumentoCaixa]&&(e=new Date(a[this.idDocumentoCaixa].dataHoraEmissao),t="Data vencimento não pode ser menor que a data do caixa."),this.campos.dataVencimento){var o=new Date(this.campos.dataVencimento);if(o.setHours(0,0,0,0)<e.setHours(0,0,0,0))return t}return""}},data:function(){return{habilitaFaturamento:!1,faturamento:"",campos:{agencia:"",autorizacao:"",nomeTitular:"",idBanco:"",idDocumento:"",idDocumentoCondicaoPagamento:"",conta:"",dataVencimento:"",documento:"",idFormaPagamento:"",numeroCheque:"",observacao:"",valor:0},modalPagamento:!1,observacaoFaturamento:"",parcelas:1,formaPagamento:{},formasPagamento:[],idDocumentoCaixa:"",caixas:[],temCaixaEmpresa:!1,valorRestante:0,checaLimite:!1,creditoDevolucao:0,creditoDisponivel:0,somenteLeitura:{observacaoFaturamento:!1,caixas:!1,formasPagamento:!1,condicaoPagamento:{}},opcoesBanco:[],verificarValor:!1,verificarErroParcelamento:!1,verificarDataVencimento:!1,verificarDadosCartao:!1,visivel:!1,modalCaixaAbrir:!1,troco:0}},methods:{ajustarValorCarnes:function(){var e,t=this;e=this.condicaoPagamento.filter(function(e){return e.idFormaPagamento===t.campos.idFormaPagamento&&!t.condicaoPagamentoResumo.find(function(t){return t.id===e.id&&t.liquidado})}),e=Object(h["orderBy"])(e,["dataVencimento"],["asc"]);var a=Object(v["arredondar"])(e.reduce(function(e,a){return a.id===t.campos.id?e+=t.campos.edicao.valor:e+=a.valor,e},0)),o=!1,r=Object(v["arredondar"])(e.reduce(function(e,a){return a.id===t.campos.id&&(o=!0),o||(e+=a.valor),e},this.campos.valor));o=!1,e=e.map(function(e){if(o){var n=t.campos.valor;return Object(v["arredondar"])(r+n)>a&&(n=Object(v["arredondar"])(a-r)),r+=n,c()({},e,{valor:n})}return e.id===t.campos.id&&(o=!0),e});var n=e[e.length-1].valor;n=Object(v["arredondar"])(n+(a-r)),e[e.length-1].valor=n,this.condicaoPagamento=this.condicaoPagamento.map(function(t){var a=e.find(function(e){return e.id===t.id});return a&&(t.valor=a.valor),t})},ajustarDatasCarnes:function(){var e=this,t=new Date(this.campos.dataVencimento).getMonth(),a=!1;this.condicaoPagamento=Object(h["orderBy"])(this.condicaoPagamento,["dataVencimento"],["asc"]).map(function(o){if(a&&o.idFormaPagamento===e.campos.idFormaPagamento&&!e.condicaoPagamentoResumo.find(function(e){return e.id===o.id&&e.liquidado})){var r=new Date(e.campos.dataVencimento).setMonth(++t);return c()({},o,{dataVencimento:p["d"].formatDate(r)})}return o.id===e.campos.id&&(a=!0),o})},adicionarPagamento:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a,o,r,n,i,s,c,l,d,u,m,f,b,g,C,x,q,O,k,I,w=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.limparErro(),!this.idDocumentoCaixa){e.next=11;break}if(t=this.caixas.filter(function(e){return e.valor===w.idDocumentoCaixa}),t.length&&t[0].dataHoraEmissao){e.next=6;break}return this.$q.notify("Não é possível verificar a data de abertura do caixa."),e.abrupt("return");case 6:if(a=(new Date).setHours(0,0,0,0),o=new Date(t[0].dataHoraEmissao).setHours(0,0,0,0),!("Reaberto"!==t[0].status&&o<a)){e.next=11;break}return this.$q.notify("Não é possível incluir forma de pagamento de caixa com data diferente de hoje."),e.abrupt("return");case 11:if(r=this.campos.edicao&&5===(this.formasPagamento.find(function(e){return e.id===w.campos.edicao.idFormaPagamento})||{}).tipo,n=this.campos.edicao&&99===(this.formasPagamento.find(function(e){return e.id===w.campos.edicao.idFormaPagamento})||{}).tipo&&!(this.formasPagamento.find(function(e){return e.id===w.campos.edicao.idFormaPagamento})||{}).contaCredito,!this.campos.edicao||!r&&!n){e.next=25;break}return this.campos.dataVencimento!==this.campos.edicao.dataVencimento&&this.ajustarDatasCarnes(),this.campos.valor!==this.campos.edicao.valor&&this.ajustarValorCarnes(),i=this.condicaoPagamento.findIndex(function(e){return e.id===w.campos.id}),-1!==i&&(this.condicaoPagamento[i].dataVencimento=this.campos.dataVencimento,this.condicaoPagamento[i].valor=this.campos.valor,this.condicaoPagamento[i].observacao=this.campos.observacao),e.next=20,this.resumeCondicaoPagamento();case 20:return e.next=22,this.atualizaValorRestante();case 22:return e.next=24,this.redefinirCampos();case 24:return e.abrupt("return");case 25:for(this.campos.edicao&&(this.campos.edicao.autorizacao?this.condicaoPagamento=this.condicaoPagamento.filter(function(e){return!(e.autorizacao===w.campos.edicao.autorizacao&&e.idFormaPagamento===w.campos.edicao.idFormaPagamento&&e.idDocumentoCaixa===w.campos.edicao.idDocumentoCaixa)}):this.condicaoPagamento=this.condicaoPagamento.filter(function(e){return e.id!==w.campos.edicao.id})),delete this.campos.edicao,s=function(e){return 24*e*60*60*1e3},c=Object(v["clonar"])(this.campos),l=Object(v["arredondar"])(this.condicaoPagamento.reduce(function(e,t){return e+t.valor},0)),d=Object(v["arredondar"])(this.documento.totalDocumento-l),this.documento.totalDocumento<0&&(c.valor=Object(v["arredondar"])(-1*c.valor)),this.troco=0,c.valor>d&&(1===this.formaPagamento.tipo&&(this.troco=Object(v["arredondar"])(c.valor-d),this.$q.notifyPositive("Troco: "+this.$filters.numero(this.troco,2))),c.valor=Object(v["arredondar"])(d)),u=Object(v["clonar"])(this.condicaoPagamento),m=this.formaPagamento,f=m.diasPrimeira,b=m.diasDemais,c.dataVencimento||(g=new Date,C=this.caixas.reduce(function(e,t){return e[t.id]||(e[t.id]=t),e},{}),C[this.idDocumentoCaixa]&&(g=new Date(C[this.idDocumentoCaixa].dataHoraEmissao)),c.dataVencimento=g.getTime()+(f?s(f):0)),x=(c.valor/this.parcelas*100|0)/100,q=Object(v["arredondar"])(x+(c.valor-x*this.parcelas)),O=1;O<=this.parcelas;O++)k=Object(v["clonar"])(c),k.valor=1===O?q:x,I=new Date(k.dataVencimento),5!==this.formaPagamento.tipo||30!==b&&31!==b?k.dataVencimento=p["d"].formatDate(I.getTime()+(b?s(b)*(O-1):0)):k.dataVencimento=p["d"].formatDate(I.setMonth(I.getMonth()+O-1)),k.id=Object(v["uuid"])(),k.idDocumento=this.documento.id,k.idDocumentoCondicaoPagamento=k.id,k.idDocumentoCaixa=this.idDocumentoCaixa,u.push(k);return u=Object(h["orderBy"])(u,["idFormaPagamento","dataVencimento"],["","asc"]),this.condicaoPagamento=u,e.next=44,this.resumeCondicaoPagamento();case 44:return e.next=46,this.atualizaValorRestante();case 46:return e.next=48,this.redefinirCampos();case 48:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),aoSelecionarFormaPagamento:function(){var e=this;this.formaPagamento=this.formasPagamento.filter(function(t){return t.id===e.campos.idFormaPagamento})[0],this.campos.dataVencimento="",this.parcelas=1},alterarPagamento:function(e){this.campos=Object(v["clonar"])(e),this.documento.totalDocumento<0&&(this.campos.valor=Object(v["arredondar"])(-1*this.campos.valor)),this.campos.edicao=Object(v["clonar"])(e),this.parcelas=this.campos.parcelas,this.formaPagamento=this.formasPagamento.filter(function(t){return t.id===e.idFormaPagamento})[0],this.modalPagamento=!0},atualizar:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a,o,r,n,i,s,l,d,u,m,p,g,C=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,f["a"].contato.le({id:this.documento.idContato});case 2:return t=e.sent,this.creditoDevolucao=Object(v["arredondar"])(t.creditoDevolucao),e.next=6,f["a"].configuracoes.le({nome:"vendas.checalimite"});case 6:return a=e.sent,o=a.find(function(e){return e.idEmpresa===C.documento.idEmpresa}),o||(o=a.find(function(e){return!e.idEmpresa})),this.checaLimite=!!o&&!!parseInt(o.valor),this.checaLimite&&(this.creditoDisponivel=Object(v["arredondar"])(t.creditoDisponivel)),e.next=13,f["a"].formaPagamento.le();case 13:return r=e.sent,r=r.map(function(e){var t=!!e.ativo;return(C.documento.totalDocumento<0&&(99!==e.tipo||!e.contaCredito)||C.documento.totalDocumento>=0&&C.saldoCreditoCliente<=0&&99===e.tipo&&e.contaCredito||C.documento.totalDocumento<e.valorMinimoVenda)&&(t=!1),e.idContatoEmpresa&&e.idContatoEmpresa!==C.documento.idEmpresa&&(t=!1),c()({rotulo:e.descricao,valor:e.id,visivel:t},e)}),this.formasPagamento=Object(h["orderBy"])(r,"rotulo","asc"),e.next=18,Object(b["a"])().caixa.where({idEmpresa:this.documento.idEmpresa}).toArray();case 18:if(e.t0=function(e){return e.ativo},this.temCaixaEmpresa=!!e.sent.filter(e.t0).length,this.idDocumentoCaixa="",!this.temCaixaEmpresa){e.next=80;break}return n=f["a"].usuario.logado.codigoContato,e.prev=23,e.next=26,f["a"].permissao.objeto("Diretiva_Caixa_LivreUtilizacao");case 26:i=e.sent,i&&(n=""),e.next=33;break;case 30:e.prev=30,e.t1=e["catch"](23),this.$q.notify("Não foi possível recuperar informações de permissão.");case 33:return e.next=35,f["a"].caixa.le({aberto:!0});case 35:if(e.t2=function(e){return e.idEmpresa===C.documento.idEmpresa},s=e.sent.filter(e.t2),"Venda"!==this.documento.tipo&&(s=s.filter(function(e){return!n||e.codigoContato===n})),!s.length){e.next=79;break}l=!0,d=!1,u=void 0,e.prev=42,m=s[Symbol.iterator]();case 44:if(l=(p=m.next()).done){e.next=64;break}return g=p.value,e.next=48,f["a"].caixa.le({id:g.idCaixa});case 48:if(e.t4=e.sent,e.t4){e.next=51;break}e.t4={};case 51:if(e.t3=e.t4.descricao,e.t3){e.next=54;break}e.t3="";case 54:e.t5=e.t3,e.t6=e.t5+" - Aberto em ",e.t7=this.$filters.dataHora(g.dataHoraEmissao),e.t8=e.t6+e.t7,e.t9="Reaberto"===g.status?" - Reaberto":"",g.rotulo=e.t8+e.t9,g.valor=g.id;case 61:l=!0,e.next=44;break;case 64:e.next=70;break;case 66:e.prev=66,e.t10=e["catch"](42),d=!0,u=e.t10;case 70:e.prev=70,e.prev=71,l||null==m.return||m.return();case 73:if(e.prev=73,!d){e.next=76;break}throw u;case 76:return e.finish(73);case 77:return e.finish(70);case 78:this.caixas=Object(h["orderBy"])(s,"dataHoraEmissao","desc");case 79:this.idDocumentoCaixa=(this.caixas[0]||{}).valor||"";case 80:return this.observacaoFaturamento=(this.documento||{}).observacaoFaturamento||"",e.next=83,this.resumeCondicaoPagamento();case 83:return e.next=85,this.atualizaValorRestante();case 85:return this.preencherSomenteLeitura(),e.next=88,this.redefinirCampos();case 88:this.habilitarFaturamento(),this.visivel=this.temCaixaEmpresa&&this.idDocumentoCaixa||!this.temCaixaEmpresa;case 90:case"end":return e.stop()}},e,this,[[23,30],[42,66,70,78],[71,,73,77]])}));return function(){return e.apply(this,arguments)}}(),habilitarFaturamento:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a,o,r=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if("Fatura"===this.documento.tipo&&(this.habilitaFaturamento=!0),!this.documento.idEmpresa||"Venda"!==this.documento.tipo){e.next=9;break}return e.next=4,Object(b["a"])().configuracoes.where({nome:"vendas.gerafatura"}).toArray();case 4:t=e.sent,a=t.find(function(e){return e.idEmpresa===r.documento.idEmpresa}),a||(a=t.find(function(e){return!e.idEmpresa})),o=a?parseInt(a.valor):0,this.habilitaFaturamento=[0,2].includes(o);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),temErro:function(){var e=i()(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=!1,this.temParcelamento&&(this.verificarErroParcelamento=!0,this.erroParcelamento&&(t=!0)),this.verificarValor=!0,this.erroValor&&(t=!0),this.desabilitadoDataVencimento||(this.verificarDataVencimento=!0,this.erroDataVencimento&&(t=!0)),!t){e.next=7;break}return e.abrupt("return",!0);case 7:return e.abrupt("return",!1);case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),limparErro:function(){this.verificarErroParcelamento=!1,this.verificarDataVencimento=!1,this.verificarValor=!1,this.verificarDadosCartao=!1},aoAdicionarPagamento:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.campos.agencia="",this.campos.autorizacao="",this.campos.documento="",this.campos.nomeTitular=f["a"].contato.selecionado.nome,this.campos.idBanco="",this.campos.conta="",this.campos.numeroCheque="",this.campos.observacao="",e.next=10,this.temErro();case 10:if(!e.sent){e.next=12;break}return e.abrupt("return");case 12:t=~[2,3,4].indexOf(this.formasPagamento.filter(function(e){return e.id===a.campos.idFormaPagamento})[0].tipo),t?this.modalPagamento=!0:this.adicionarPagamento();case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),aoCancelarModalPagamento:function(e){e&&e.preventDefault(),this.campos.idDocumentoCondicaoPagamento&&this.redefinirCampos(),this.modalPagamento=!1},aoSalvarModalPagamento:function(){var e=i()(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(![3,4].includes(this.formaPagamento.tipo)){e.next=7;break}return e.next=3,f["a"].configuracoes.porNome("pagamento.cartao.dadosobrigatorios",this.documento.idEmpresa);case 3:if(t=e.sent,this.verificarDadosCartao=!(!t.length||!parseInt(t[0].valor)),!this.erroPreenchimentoAutorizacaoCartao&&!this.erroPreenchimentoDocumentoCartao){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this.temErro();case 9:if(!e.sent){e.next=11;break}return e.abrupt("return");case 11:this.adicionarPagamento(),this.modalPagamento=!1,this.verificarDataVencimento=!1,this.verificarValor=!1,this.verificarDadosCartao=!1;case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),atualizaValorRestante:function(){var e=i()(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t=this.condicaoPagamento.reduce(function(e,t){var a=t.valor;return e+a},0),this.valorRestante=Math.abs(Object(v["arredondar"])(this.documento.totalDocumento-t));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),leOpcoesBanco:function(){var e=i()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.opcoesBanco.length){e.next=5;break}return e.next=3,f["a"].banco.le();case 3:e.t0=function(e){return{label:"".concat(e.descricao," - ").concat(e.numero),value:e.id}},this.opcoesBanco=e.sent.map(e.t0);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),preencherSomenteLeitura:function(){var e={observacaoFaturamento:!1,caixas:!1,formasPagamento:!1,condicaoPagamento:{}},t=this.caixas.reduce(function(e,t){return"Reaberto"!==t.status||e[t.id]||(e[t.id]=t),e},{}),a=!0,o=!1,r=void 0;try{for(var n,i=this.condicaoPagamentoResumo[Symbol.iterator]();!(a=(n=i.next()).done);a=!0){var s=n.value;s.idDocumentoCaixa!==this.idDocumentoCaixa&&(e.condicaoPagamento[s.id]=!0),t[s.idDocumentoCaixa]&&(e.observacaoFaturamento=!1,e.caixas=!1,e.formasPagamento=!1)}}catch(e){o=!0,r=e}finally{try{a||null==i.return||i.return()}finally{if(o)throw r}}this.somenteLeitura=e},redefinirCampos:function(){this.parcelas=1,this.campos={agencia:"",autorizacao:"",nomeTitular:"",idBanco:"",idDocumentoCondicaoPagamento:"",conta:"",dataVencimento:"",documento:"",idFormaPagamento:"",numeroCheque:"",observacao:"",valor:this.valorRestante}},removerPagamento:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a,o,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(a=this.formasPagamento.find(function(e){return e.id===t.idFormaPagamento}),o=5===a.tipo,r=99===a.tipo&&!a.contaCredito,!((o||r)&&this.condicaoPagamento.filter(function(e){return e.idFormaPagamento===a.id}).length>1)||this.condicaoPagamentoResumo.find(function(e){return e.idFormaPagamento===t.idFormaPagamento&&e.liquidado})){e.next=19;break}return e.prev=4,e.next=7,this.$q.dialog({cancel:"Não",message:o?"Deseja remover todos os carnês?":"Deseja remover todos os boletos?",ok:"Sim",title:"Tem certeza?"});case 7:return this.condicaoPagamento=this.condicaoPagamento.filter(function(e){return e.idFormaPagamento!==a.id}),e.next=10,this.resumeCondicaoPagamento();case 10:return e.next=12,this.atualizaValorRestante();case 12:return e.next=14,this.redefinirCampos();case 14:return e.abrupt("return");case 17:e.prev=17,e.t0=e["catch"](4);case 19:return e.prev=19,e.next=22,this.$q.cancelDialog();case 22:return this.troco=0,t.autorizacao?this.condicaoPagamento=this.condicaoPagamento.filter(function(e){return!(e.autorizacao===t.autorizacao&&e.idFormaPagamento===t.idFormaPagamento&&e.idDocumentoCaixa===t.idDocumentoCaixa)}):((o||r)&&(this.campos.id=t.id,this.campos.idFormaPagamento=t.idFormaPagamento,this.campos.valor=0),this.condicaoPagamento=this.condicaoPagamento.filter(function(e){return e.id!==t.id})),e.next=26,this.resumeCondicaoPagamento();case 26:return e.next=28,this.atualizaValorRestante();case 28:return e.next=30,this.redefinirCampos();case 30:e.next=34;break;case 32:e.prev=32,e.t1=e["catch"](19);case 34:case"end":return e.stop()}},e,this,[[4,17],[19,32]])}));return function(t){return e.apply(this,arguments)}}(),calcularParcelas:function(){var e="",t=1,a=1,o={},r=Object(h["orderBy"])(this.condicaoPagamento,["idFormaPagamento","autorizacao","dataVencimento"]),n=!0,i=!1,s=void 0;try{for(var c,l=r[Symbol.iterator]();!(n=(c=l.next()).done);n=!0){var d=c.value,u=d.idFormaPagamento+(String(d.autorizacao)||"");e!==u?(e=u,t=1,a=r.reduce(function(t,a){return t+(a.idFormaPagamento+(String(a.autorizacao)||"")===e?1:0)},0),o[d.id]=String(t++)+"/"+String(a)):o[d.id]=String(t++)+"/"+String(a)}}catch(e){i=!0,s=e}finally{try{n||null==l.return||l.return()}finally{if(i)throw s}}return o},validar:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a,o,r,n,i,s,c,l,d,u,m,p,h,b,g,C,x,q,O,k,I,w,E,y,_,P,T,D,j,F=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f["a"].contato.le({id:this.documento.idContato});case 3:t=e.sent,Object(v["verificarExcecao"])(!t.id,"Não foi possível encontrar o contato do documento."),a=Object(v["arredondar"])(this.condicaoPagamento.reduce(function(e,t){return e+t.valor},0)),o=Object(v["arredondar"])(this.documento.totalDocumento),Object(v["verificarExcecao"])(!Object(v["isNumber"])(a),"Valor inválido na condição de pagamento."),Object(v["verificarExcecao"])(!Object(v["isNumber"])(o),"Valor inválido no total do documento."),r=this.condicaoPagamentoOriginal.map(function(e){return e.id}),n=this.condicaoPagamento.filter(function(e){return!r.includes(e.id)}),s=!0,c=!1,l=void 0,e.prev=14,d=n[Symbol.iterator]();case 16:if(s=(u=d.next()).done){e.next=35;break}if(m=u.value,p=void 0,!m.idDocumentoCaixa){e.next=26;break}return e.next=22,f["a"].documento.le({id:m.idDocumentoCaixa});case 22:p=e.sent,i=new Date(p.dataHoraEmissao).setHours(0,0,0,0),e.next=28;break;case 26:p={},i=(new Date).setHours(0,0,0,0);case 28:h=new Date(new Date(m.dataVencimento).setHours(0,0,0,0)),h<i&&(b="Existe condição de pagamento com data anterior à "+(p.dataHoraEmissao?"data de abertura do caixa":"data de hoje"),Object(v["verificarErro"])(!0,b)),g=p.id&&this.documento.idEmpresa!==p.idEmpresa,Object(v["verificarErro"])(g,"Condição de pagamento incorreta: caixa e documento pertencem a empresas diferentes.");case 32:s=!0,e.next=16;break;case 35:e.next=41;break;case 37:e.prev=37,e.t0=e["catch"](14),c=!0,l=e.t0;case 41:e.prev=41,e.prev=42,s||null==d.return||d.return();case 44:if(e.prev=44,!c){e.next=47;break}throw l;case 47:return e.finish(44);case 48:return e.finish(41);case 49:return C=o&&!a,Object(v["verificarErro"])(C,"Não há condição de pagamento."),C=o>=0&&a>o,Object(v["verificarErro"])(C,"O total das condições de pagamento é maior que o total do documento."),e.next=55,f["a"].caixa.leNew({idEmpresa:this.documento.idEmpresa});case 55:return x=e.sent,Object(v["verificarErro"])(x.filter(function(e){return e.ativo}).length&&!this.idDocumentoCaixa,"Selecione um caixa para continuar."),e.next=59,f["a"].configuracoes.le({nome:"vendas.checalimite"});case 59:if(q=e.sent,O=q.find(function(e){return e.idEmpresa===F.documento.idEmpresa}),O||(O=q.find(function(e){return!e.idEmpresa})),k=!!O&&!!parseInt(O.valor),k&&(I=Object(v["arredondar"])(t.creditoDisponivel),Object(v["verificarErro"])(Object(v["isNumber"])(I)&&I<o,"Limite de crédito insuficiente.")),w=this.formasPagamento.filter(function(e){return 99===e.tipo&&e.contaCredito}).map(function(e){return e.id}),E=this.condicaoPagamento.find(function(e){return w.includes(e.idFormaPagamento)}),o>0&&E&&(y=Object(v["arredondar"])(t.creditoDevolucao),_=Object(v["arredondar"])(this.condicaoPagamento.filter(function(e){return w.includes(e.idFormaPagamento)}).reduce(function(e,t){return e+t.valor},0)),Object(v["verificarErro"])(Object(v["isNumber"])(y)&&y<_,"Crédito de devolução insuficiente.")),!(a&&a<o)){e.next=80;break}return e.next=70,f["a"].configuracoes.le({nome:"vendas.aceitasinal"});case 70:return P=e.sent,T=P.find(function(e){return e.idEmpresa===F.documento.idEmpresa}),T||(T=P.find(function(e){return!e.idEmpresa})),D=!!T&&!!parseInt(T.valor),Object(v["verificarErro"])(!D,"Valor pago menor que o total do documento."),j=this.$q.loading.isActive,this.$q.loading.hide(),e.next=79,this.$q.dialog({cancel:"Não",message:"O total das condições de pagamento é menor que o total do documento. Deseja finalizar como sinal?",noRefocus:!0,ok:"Sim",preventClose:!0,title:"Confirma?"}).catch(function(){Object(v["verificarAlerta"])(!0,"Processo interrompido pelo usuário.")});case 79:j&&this.$q.loading.show({message:"Processando..."});case 80:e.next=86;break;case 82:throw e.prev=82,e.t1=e["catch"](0),this.$q.loading.hide(),e.t1;case 86:case"end":return e.stop()}},e,this,[[0,82],[14,37,41,49],[42,,44,48]])}));return function(){return e.apply(this,arguments)}}()},mixins:[m["a"]],props:{documento:{default:function(){return{}},required:!0,type:Object}},watch:{"documento.totalDocumento":function(){this.documento.id&&this.atualizar()},documento:function(){this.documento.id&&this.atualizar()},idDocumentoCaixa:function(){this.preencherSomenteLeitura()}},mounted:function(){this.visivel=!1}},C=g,x=(a("bdf0"),a("2877")),q=Object(x["a"])(C,o,r,!1,null,"436a623b",null);q.options.__file="Faturamento.vue";t["a"]=q.exports},"12f6":function(e,t,a){"use strict";var o=a("a864"),r=a.n(o);r.a},"1bdf":function(e,t,a){"use strict";var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("q-list",[a("q-item",[a("q-item-main"),a("q-item-side",{attrs:{right:""}},[e.somenteLeitura?e._e():a("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"add"},on:{click:function(t){e.modalAdicionar=!0}}})],1)],1),e._l(e.arquivo,function(t){return a("q-item",{key:t.id,attrs:{multiline:""}},[a("q-item-side",{attrs:{image:t.arquivo},nativeOn:{click:function(a){e.openImage(t)}}}),a("q-item-main"),a("q-item-side",{attrs:{right:""}},[e.somenteLeitura?e._e():a("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"delete"},on:{click:function(a){e.remover(t)}}})],1)],1)})],2),a("q-modal",{model:{value:e.modalAdicionar,callback:function(t){e.modalAdicionar=t},expression:"modalAdicionar"}},[a("q-modal-layout",[a("q-toolbar",{attrs:{slot:"header"},slot:"header"},[a("q-toolbar-title",[e._v("Adicionar")]),a("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"close",round:""}})],1),a("div",{staticClass:"q-ma-sm"},[a("q-field",{staticClass:"q-ma-md"},[a("q-uploader",{ref:"uploader",attrs:{color:"none","hide-upload-button":"","hide-upload-progress":"",multiple:"","inverted-light":"",url:""},on:{add:e.adicionar}})],1)],1)],1)],1),a("q-modal",{model:{value:e.modalArquivo.visivel,callback:function(t){e.$set(e.modalArquivo,"visivel",t)},expression:"modalArquivo.visivel"}},[a("q-modal-layout",[a("q-toolbar",{attrs:{slot:"header"},slot:"header"},[a("q-toolbar-title",[e._v(e._s(e.modalArquivo.nome))]),a("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"close",round:""}})],1),a("div",{staticClass:"q-pa-lg"},[a("avatar",{attrs:{imagem:e.modalArquivo.arquivo,redondo:!1,tamanho:"300"}})],1)],1)],1)],1)},r=[];o._withStripped=!0;a("96cf");var n=a("c973"),i=a.n(n),s=(a("7f7f"),a("ac4d"),a("8a81"),a("ac6a"),a("df3a")),c=a("ed08"),l={components:{Avatar:s["a"]},data:function(){return{modalAdicionar:!1,arquivo:[],somenteLeitura:!1,modalArquivo:{visivel:!1,nome:"",arquivo:""}}},methods:{adicionar:function(e){var t=!0,a=!1,o=void 0;try{for(var r,n=e[Symbol.iterator]();!(t=(r=n.next()).done);t=!0){var i=r.value;this.arquivo.push({id:Object(c["uuid"])(),dataCriacao:Object(c["dataAtual"])(),nome:i.name,arquivo:i.__img.src})}}catch(e){a=!0,o=e}finally{try{t||null==n.return||n.return()}finally{if(a)throw o}}this.$refs.uploader.reset(),this.modalAdicionar=!1},le:function(){return this.arquivo},openImage:function(e){this.modalArquivo={visivel:!0,nome:e.nome,arquivo:e.arquivo}},remover:function(){var e=i()(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$q.dialog({cancel:"Cancelar",message:"Deseja remover o arquivo "+t.nome+".",noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 3:this.arquivo=this.arquivo.filter(function(e){return e.id!==t.id}),e.next=8;break;case 6:e.prev=6,e.t0=e["catch"](0);case 8:case"end":return e.stop()}},e,this,[[0,6]])}));return function(t){return e.apply(this,arguments)}}()}},d=l,u=a("2877"),m=Object(u["a"])(d,o,r,!1,null,null,null);m.options.__file="Arquivo.vue";t["a"]=m.exports},"1c4d":function(e,t,a){"use strict";var o=a("9e1b"),r=a.n(o);r.a},"1fe0c":function(e,t,a){"use strict";var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.dados.venda.id?a("q-card",{staticClass:"extratoItem bg-white q-pa-md no-shadow"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-12 col-md-6"},[a("div",{staticClass:"q-px-sm"},[a("avatar",{staticStyle:{float:"left"},attrs:{imagem:(e.contatos[e.dados.venda.idContato]||{}).imagem,rotulo:e.dados.venda.descricaoContato,tamanho:"40"}}),a("q-toolbar-title",[e._v("\n          "+e._s(e.dados.venda.descricaoContato)+"\n        ")]),a("q-chip",{staticClass:"q-ma-sm q-my-sm",attrs:{rounded:"",color:"grey",small:""}},[e._v("\n          "+e._s(e.dados.venda.status)+"\n        ")]),a("q-list",{staticClass:"no-border "},[e._l(e.dados.carrinho,function(t){return a("q-item",{key:t.id,staticClass:"q-pa-none",staticStyle:{"min-height":"auto"}},[a("q-item-side",[a("small",[e._v(e._s(t.quantidade)+"x")])]),a("q-item-main",[a("small",[e._v("\n                "+e._s(t.descricaoItem)+"\n              ")])]),a("q-item-side",{attrs:{right:""}},[a("small",[e._v(e._s(e._f("numero")(t.total,2)))])])],1)}),e._l(e.dados.customs,function(t){return a("q-item",{key:t.documento.id,staticClass:"q-pa-none",staticStyle:{"min-height":"auto"}},[a("q-item-side",[a("small",[e._v("\n                "+e._s(t.documento.numero)+"x\n                "),a("q-tooltip",[e._v("\n                  "+e._s(t.documento.descricao)+"\n                ")])],1)]),a("q-item-main",[a("small",[e._v("\n                "+e._s(t.documento.descricao)+"\n              ")])]),a("q-item-side",{attrs:{right:""}},[a("small",[e._v(e._s(e._f("numero")(t.documento.totalDocumento,2)))])])],1)}),e._l(e.dados.oss,function(t){return a("q-item",{key:t.documento.id,staticClass:"q-pa-none",staticStyle:{"min-height":"auto"}},[a("q-item-side",[a("small",[e._v("\n                OS\n                "),a("q-tooltip",[e._v("\n                  "+e._s(t.documento.descricao)+"\n                ")])],1)]),a("q-item-main",[a("small",[e._v("\n                "+e._s(t.documento.descricao)+"\n                "),"Orçamento"!==t.documento.status?a("badge",{staticClass:"q-mx-sm",attrs:{escuro:"",cor:"grey-5",denso:"",round:""}},[e._v("\n                  "+e._s(t.documento.status)+"\n                ")]):e._e()],1)]),a("q-item-side",{attrs:{right:""}},[a("small",[e._v(e._s(e._f("numero")(t.documento.totalDocumento,2)))])])],1)}),e._l(e.dados.envelopes,function(t){return a("q-item",{key:t.id,staticClass:"q-pa-none",staticStyle:{"min-height":"auto"}},[a("q-item-side",[a("small",[e._v("\n                #"+e._s(parseInt(t.numero)||(t.id||"").slice(-6))+"\n                "),a("q-tooltip",[e._v("\n                  "+e._s(t.tipo)+" - "+e._s(t.descricaoContato)+"\n                ")])],1)]),a("q-item-main",[a("small",[e._v("\n                "+e._s(e.descricaoEnvelope(t.id))+"\n                "),"Orçamento"!==t.status?a("badge",{staticClass:"q-mx-sm",attrs:{escuro:"",cor:"grey-5",denso:"",round:""}},[e._v("\n                  "+e._s(t.status)+"\n                ")]):e._e()],1)]),a("q-item-side",{attrs:{right:""}},[a("small",[e._v(e._s(e._f("numero")(t.totalDocumento,2)))])])],1)})],2)],1)]),a("div",{staticClass:"col-12 col-md-2"},[a("div",{staticClass:"q-px-sm"},[a("badge",{staticClass:"q-mr-sm",attrs:{escuro:"",cor:"positive"},nativeOn:{click:function(t){return e.copiarUid(t)}}},[e._v("\n          #"+e._s(parseInt(e.dados.venda.numero)||(e.dados.venda.id||"").slice(-6))+"\n          "),a("input",{ref:"uid",attrs:{type:"hidden"},domProps:{value:e.dados.venda.id}})]),a("dl",{staticClass:"q-mt-sm"},[a("dd",[a("q-tooltip",[e._v("\n              Vendedor(a)\n            ")]),e._v("\n            "+e._s((e.contatos[e.dados.venda.idContatoVendedor]||{}).apelido)+"\n          ")],1)])],1)]),a("div",{staticClass:"col-3 col-md-1"},[a("q-tooltip",[e._v("\n        Emissão\n      ")]),a("p",{staticClass:"text-center q-my-none"},[a("small",[e._v(e._s(e._f("mesNome")(e.dados.venda.dataHoraEmissao)))])]),a("p",{staticClass:"text-center q-my-none q-headline text-weight-bold"},[a("strong",[e._v(e._s(e._f("dia")(e.dados.venda.dataHoraEmissao)))])]),a("p",{staticClass:"text-center q-my-none"},[a("small",[e._v(e._s(e._f("ano")(e.dados.venda.dataHoraEmissao)))])])],1),a("div",{staticClass:"col-3 col-md-1"},[e.dados.venda.dataHoraFinalizado?a("q-tooltip",[e._v("\n        Finalizado\n      ")]):e._e(),a("p",{staticClass:"text-center q-my-none"},[a("small",[e._v(e._s(e._f("mesNome")(e.dados.venda.dataHoraFinalizado)))])]),a("p",{staticClass:"text-center q-my-none q-headline text-weight-bold"},[a("strong",[e._v(e._s(e._f("dia")(e.dados.venda.dataHoraFinalizado)))])]),a("p",{staticClass:"text-center q-my-none"},[a("small",[e._v(e._s(e._f("ano")(e.dados.venda.dataHoraFinalizado)))])])],1),a("div",{staticClass:"col-6 col-md-2"},[a("dl",{staticClass:"float-right full-width q-mb-sm"},[a("dt",{staticClass:"text-right q-headline text-positive text-weight-bold"},[e._v("\n          "+e._s(e._f("numero")(e.dados.venda.totalDocumento,2))+"\n          "),a("p",{staticClass:"text-weight-normal text-tertiary q-body-1"},[e._v("\n            "+e._s(e._f("numero")(e.dados.venda.subTotal,2))+"\n          ")])])]),a("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{float:"right"},attrs:{rounded:"",dense:"",flat:"",icon:"more_vert",color:"grey",size:"md"}},[a("q-popover",[a("q-list",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{link:"",separator:""}},[e.$utils.mapearStatus(e.dados.venda).permiteNota?[a("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],nativeOn:{click:function(t){e.emitirNFeV2({idVenda:e.dados.venda.id},1,"Venda")}}},[a("q-item-side",{attrs:{icon:"account_balance"}}),a("q-item-main",{attrs:{label:"NFe de Saída/Venda"}})],1),a("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],nativeOn:{click:function(t){e.emitirNFeV2({idVenda:e.dados.venda.id},0,"Devolução")}}},[a("q-item-side",{attrs:{icon:"account_balance"}}),a("q-item-main",{attrs:{label:"NFe de Entrada/Devolução"}})],1),a("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],nativeOn:{click:function(t){e.emitirNFeV2({idVenda:e.dados.venda.id},1,"Remessa")}}},[a("q-item-side",{attrs:{icon:"account_balance"}}),a("q-item-main",{attrs:{label:"NFe de Remessa"}})],1)]:e._e(),e.podeMigrarFatura?[e._l(e.faturasAbertas.filter(function(t){return t.id!==e.dados.venda.idFatura}),function(t){return a("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],key:t.id,nativeOn:{click:function(a){e.migrarFatura(t)}}},[a("q-item-side",{attrs:{icon:"mdi-folder-move"}}),a("q-item-main",{attrs:{label:"Migrar para fatura #"+(t.numero||t.id.slice(-6))}})],1)}),a("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],nativeOn:{click:function(t){e.migrarFatura()}}},[a("q-item-side",{attrs:{icon:"mdi-folder-move"}}),a("q-item-main",{attrs:{label:"Migrar para nova fatura"}})],1)]:e._e()],2)],1)],1),e.visibilidade.botao.remover?a("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{float:"right"},attrs:{rounded:"",dense:"",flat:"",icon:"clear",color:"grey",size:"md"},on:{click:e.remover}}):e._e(),e.visibilidade.botao.editar?a("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{float:"right"},attrs:{rounded:"",dense:"",flat:"",icon:"edit",color:"primary",size:"md"},on:{click:e.editar}}):e._e(),a("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{float:"right"},attrs:{rounded:"",dense:"",flat:"",icon:"print",color:"primary",size:"md"}},[a("q-popover",[a("q-list",{attrs:{link:"",separator:""}},[e._l(e.configImpressaoOrcamento.filter(function(e){return e.valor}),function(t){return a("q-item",{key:t.valor,nativeOn:{click:function(a){e.imprimir(t.valor,{id:(e.dados.venda||{}).id||"0",Oculto:"0"})}}},[a("q-item-side",{attrs:{icon:"print"}}),a("q-item-main",{attrs:{label:t.texto}})],1)}),"optisoul"===e.sistemaPai?e._l(e.configImpressaoEnvelope,function(t){return a("q-item",{key:t.valor,nativeOn:{click:function(a){e.imprimir(t.valor,(e.dados.venda||{}).id||"0")}}},[a("q-item-side",{attrs:{icon:"print"}}),a("q-item-main",{attrs:{label:t.texto}})],1)}):e._e()],2)],1)],1),a("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{float:"right"},attrs:{rounded:"",dense:"",flat:"",icon:e.detalhesVisivel?"keyboard_arrow_up":"keyboard_arrow_down",size:"md",color:"grey"},on:{click:e.alternarDetalhes}})],1)]),e.detalhesVisivel?a("div",{staticClass:"row"},[a("div",{staticClass:"col-12 col-md-6"},[a("div",{staticClass:"q-px-sm"},[a("q-toolbar-title",{staticClass:"q-mx-none q-mt-sm q-px-none"},[a("q-icon",{attrs:{name:"business"}}),e._v("\n          "+e._s(e.dados.venda.descricaoEmpresa)+"\n        ")],1),a("p",{staticClass:"q-mt-sm"},[a("small",{staticStyle:{display:"block"}},[e._v("\n            "+e._s(e.dados.venda.observacao)+"\n            "),a("br"),e._v("\n            "+e._s(e.dados.venda.observacaoInterna)+"\n          ")])]),a("div",{staticClass:"round-borders"},[a("documentos-fiscais",{attrs:{idVenda:e.dados.venda.id}})],1)],1)]),a("div",{staticClass:"col-12 col-md-4"},[a("div",{staticClass:"q-px-sm"},[a("q-toolbar-title",{staticClass:"q-mx-none q-mt-sm q-px-none"},[e._v("\n          Faturamento\n        ")]),a("p",{staticClass:"q-mt-sm"},[a("small",{staticStyle:{display:"block"}},[e._v("\n            "+e._s(e.dados.venda.observacaoFaturamento)+"\n          ")])])],1)]),a("div",{staticClass:"col-12 col-md-2"},[a("div",{staticClass:"q-px-sm text-right"},[a("dl",{staticClass:"q-mt-none text-right"},[a("dd",[a("small",{staticClass:"q-mr-xs"},[e._v("Desconto")]),a("span",{staticClass:"q-subheading"},[a("strong",[e._v(e._s(e._f("numero")(e.dados.venda.totalDesconto,2)))])])])])])])]):e._e(),a("venda-modal",{ref:"vendaModal",attrs:{id:e.dados.venda.id},on:{executar:e.executar},model:{value:e.vendaModalVisivel,callback:function(t){e.vendaModalVisivel=t},expression:"vendaModalVisivel"}})],1):e._e()},r=[];o._withStripped=!0;a("7514"),a("ac4d"),a("8a81"),a("ac6a");var n=a("3156"),i=a.n(n),s=a("448a"),c=a.n(s),l=(a("55dd"),a("96cf"),a("c973")),d=a.n(l),u=(a("6762"),a("2fdb"),a("df3a")),m=a("a0fd"),p=a("e3f4"),v=a("dd9d"),h=a("2335"),f=a("8149"),b=a("ed08"),g=a("2ef0"),C={components:{Avatar:u["a"],Badge:m["a"],DocumentosFiscais:p["a"],VendaModal:h["a"]},computed:{config:function(){return f["a"].configuracoes.valores},podeMigrarFatura:function(){return!["Aguardando Estoque","Aguardando Financeiro","Aguardando Aprovação","Aguardando Pagamento","Cancelado","Não Aprovado","Orçamento","Faturado"].includes(this.dados.venda.status)}},data:function(){return{dbUsuario:f["a"].usuario,dados:{venda:{}},contatos:{},faturasAbertas:[],vendaModalVisivel:!1,detalhesVisivel:!1,visibilidade:{botao:{editar:!1,remover:!1}},modalDevolucaoGarantia:{visivel:!1,item:{},orcamento:{}},sistemaPai:"",configImpressaoOrcamento:[],configImpressaoEnvelope:[]}},methods:{irParaAtendimentoFatura:function(e){this.$router.push({name:"AtendimentoFatura",params:{id:e}})},migrarFatura:function(){var e=d()(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$q.dialog({cancel:"Cancelar",message:"Esta ação irá migrar esta venda para outra fatura.",noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e["catch"](0),e.abrupt("return");case 8:if(t){e.next=12;break}return t=f["a"].fatura.criar(this.dados.venda),e.next=12,f["a"].fatura.grava({fatura:t});case 12:if(!t.id){e.next=19;break}return e.next=15,f["a"].venda.grava({venda:{id:this.dados.venda.id,idFatura:t.id},vendaOriginal:this.dados.venda});case 15:localStorage.setItem("idFatura",t.id),this.dados.venda.idContato&&(this.$emit("executar","atualizar"),this.irParaAtendimentoFatura(this.dados.venda.idContato)),e.next=20;break;case 19:this.$q.notify("Não foi possível realizar a operação");case 20:case"end":return e.stop()}},e,this,[[0,5]])}));return function(t){return e.apply(this,arguments)}}(),alternarDetalhes:function(){this.detalhesVisivel=!this.detalhesVisivel},atualizar:function(){var e=d()(regeneratorRuntime.mark(function e(){var t,a,o,r,n,i=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,f["a"].venda.leCompleto(this.id);case 2:if(t=e.sent,t.carrinho.sort(function(e,t){return new Date(e.dataHoraEmissao)<new Date(t.dataHoraEmissao)?-1:1}),t.oss.sort(function(e,t){return new Date(e.documento.dataHoraEmissao)<new Date(t.documento.dataHoraEmissao)?-1:1}),t.customs.sort(function(e,t){return new Date(e.documento.dataHoraEmissao)<new Date(t.documento.dataHoraEmissao)?-1:1}),!(t.venda||{}).idContato||!(t.venda||{}).idEmpresa){e.next=12;break}return a=[],e.next=10,f["a"].fatura.obterAbertas(t.venda.idContato,t.venda.idEmpresa);case 10:a=e.sent,this.faturasAbertas=a.sort(function(e,t){return!e.numero||e.numero<t.numero?-1:1});case 12:if(o={},!t.venda.idContato){e.next=19;break}if(r=t.venda.idContato,o[r]){e.next=19;break}return e.next=18,f["a"].contato.le({id:r});case 18:o[r]=e.sent;case 19:if(!t.venda.idContatoVendedor){e.next=25;break}if(n=t.venda.idContatoVendedor,o[n]){e.next=25;break}return e.next=24,f["a"].contato.le({id:n});case 24:o[n]=e.sent;case 25:this.configuraImpressaoEnvelope(t.venda.idEmpresa),this.configuraImpressaoOrcamento(t.venda.idEmpresa),this.contatos=o,this.dados=t,this.$nextTick(function(){t.venda.id===localStorage.getItem("idVenda")&&(i.vendaModalVisivel=!0,localStorage.removeItem("idVenda"))});case 30:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),configuraImpressaoEnvelope:function(){var e=d()(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,f["a"].configuracoes.porNome("impressao.envelope",t);case 2:a=e.sent,this.configImpressaoEnvelope=c()(a.length?a.map(function(e){return i()({texto:"Imprimir Envelope"},e)}):[{valor:"envelope",texto:"Imprimir Envelope"},{valor:"envelopeMini",texto:"Imprimir Envelope Mini"}]);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),configuraImpressaoOrcamento:function(){var e=d()(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,f["a"].configuracoes.porNome("impressao.venda",t);case 2:a=e.sent,this.configImpressaoOrcamento=c()(a.length?a.map(function(e){return i()({texto:"Imprimir Orçamento"},e)}):[{valor:"invoice",texto:"Orçamento/Venda (Invoice)"}].concat(["optisoul"===this.sistemaPai?{valor:"orcamento",texto:"Orçamento (Antigo)"}:{}]));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),copiarUid:function(){var e=this.$refs.uid;e.type="text";try{e.select(),document.execCommand("copy"),this.$q.notify({message:"UID copiado para a área de transferência.",type:"info"})}catch(e){this.$q.notify("Erro ao copiar.")}e.type="hidden",window.getSelection().removeAllRanges()},descricaoEnvelope:function(e){var t="",a=!0,o=!1,r=void 0;try{for(var n,i=this.dados.itensEnvelopes[Symbol.iterator]();!(a=(n=i.next()).done);a=!0){var s=n.value;s.idDocumentoAdicional===e&&s.descricaoItem.trim()&&(t+=s.descricaoItem.trim()+" | ")}}catch(e){o=!0,r=e}finally{try{a||null==i.return||i.return()}finally{if(o)throw r}}return t.slice(0,-3)},devolucaoGarantia:function(){var e=d()(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,f["a"].documento.le({idContato:f["a"].contato.selecionado.id,tipo:"Venda",status:"Orçamento"});case 2:if(a=e.sent,a=Object(g["orderBy"])(a,"dataHoraEmissao","desc"),a.length){e.next=7;break}return this.$q.notify({message:"Crie um orçamento para inclusão de devolução/garantia.",type:"info"}),e.abrupt("return");case 7:this.modalDevolucaoGarantia={visivel:!0,item:t,orcamento:a[0]};case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),editar:function(){this.vendaModalVisivel=!0},executar:function(e){switch(e){case"atualizar":this.atualizar();break;case"cancelar":case"finalizar":case"reprovar":this.$emit("executar","atualizar");break;case"retornarOrcamento":this.$emit("executar",e);break}},finalizaDevolucaoGarantia:function(){var e=d()(regeneratorRuntime.mark(function e(t,a,o){var r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return r=Object(b["clonar"])(t),"devolucao"===a&&(r.operacao="Devolução de Venda"),"garantia"===a&&(r.operacao="Garantia de Venda",r.motivo=o),r.idDocumentoItemVenda=r.id,r.idDocumentoVenda=r.idDocumento,r.id=Object(b["uuid"])(),r.idDocumento=this.modalDevolucaoGarantia.orcamento.id,r.status="Orçamento",r.operacaoFator=1,r.codigoCfop=20,e.next=12,f["a"].cfop.le({codigoCfop:20});case 12:return r.idCfop=e.sent[0].id,r.dataHoraEmissao=Object(b["dataAtual"])(),r.dataHoraFinalizado="",r.subTotal=-1*r.subTotal,r.total=-1*r.total,r.valorItem=-1*r.valorItem,r.descontoSubTotal=0,delete r.codigoCfop,delete r.codigoDocumento,delete r.codigoDocumentoItem,delete r.codigoItem,delete r.codigoPlanoContaDestino,delete r.codigoPlanoContaEstoque,e.next=27,f["a"].documentoItem.grava({atual:r});case 27:this.$q.notify({message:"Item adicionado ao orçamento.",type:"positive"}),localStorage.setItem("idVenda",this.modalDevolucaoGarantia.orcamento.id),this.$emit("executar","atualizar");case 30:case"end":return e.stop()}},e,this)}));return function(t,a,o){return e.apply(this,arguments)}}(),remover:function(){var e=d()(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$q.dialog({cancel:"Cancelar",message:"Esta ação irá remover esta venda da fatura.",noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e["catch"](0),e.abrupt("return");case 8:return t=Object(b["clonar"])(this.dados.venda),this.dados.venda.idFatura="",e.next=12,f["a"].venda.grava({venda:this.dados.venda,vendaOriginal:t});case 12:this.$emit("executar","remover");case 13:case"end":return e.stop()}},e,this,[[0,5]])}));return function(){return e.apply(this,arguments)}}()},mixins:[v["a"]],props:{id:{required:!0,type:String}},watch:{dados:function(){var e=d()(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.visibilidade.botao.editar=!1,this.visibilidade.botao.remover=!1,e.next=4,f["a"].contatoBusca.filtrar(null,{ativo:!0,empresas:!0},0);case 4:if(a=e.sent,a.find(function(e){return e.id===t.venda.idEmpresa})){e.next=7;break}return e.abrupt("return");case 7:t.venda.idFatura&&this.faturasAbertas.find(function(e){return e.id===t.venda.idFatura})&&(this.visibilidade.botao.remover=!0),["Cancelado","Não Aprovado"].includes(t.venda.status)||t.venda.idFatura||(this.visibilidade.botao.editar=!0);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},mounted:function(){this.sistemaPai=Object(b["sistemaPai"])(),this.atualizar()}},x=C,q=(a("32f7"),a("2877")),O=Object(q["a"])(x,o,r,!1,null,null,null);O.options.__file="VendaCard.vue";t["a"]=O.exports},2335:function(e,t,a){"use strict";var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-modal",{attrs:{maximized:""},on:{show:e.mostrar,hide:e.fechar},model:{value:e.visibilidade.modal,callback:function(t){e.$set(e.visibilidade,"modal",t)},expression:"visibilidade.modal"}},[a("q-modal-layout",{staticClass:"bg-grey-4"},[a("q-toolbar",{attrs:{slot:"header"},slot:"header"},[a("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"arrow_back",round:""}}),a("q-toolbar-title",[e._v(e._s(e.titulo))]),!e.carregando&&e.visibilidade.botao.salvar?a("q-btn",{staticClass:"q-ml-sm no-shadow",attrs:{color:"white","text-color":"primary",label:"Salvar"},on:{click:e.salvar}}):e._e()],1),a("div",{staticClass:"layout-padding q-pa-none q-pb-xl"},[a("div",{staticClass:"u-container"},[e.carregando?e._e():a("div",[e.venda.id?a("venda",{ref:"venda",attrs:{id:e.venda.id},on:{fechar:e.fechar,executar:e.executar}}):e._e()],1),e.carregando?a("div",{staticClass:"q-mt-lg text-center"},[a("q-spinner",{attrs:{color:"faded",size:50}})],1):e._e()])]),a("q-toolbar",{staticClass:"footer",staticStyle:{background:"#eee !important"},attrs:{slot:"footer"},slot:"footer"},[a("q-toolbar-title",{staticClass:"text-right"},[e.visibilidade.botao.naoAprovado?a("q-btn",{staticClass:"q-mx-md",attrs:{color:"negative",flat:"",label:"Não aprovado"},on:{click:function(t){e.executar("reprovar")}}}):e._e(),e.visibilidade.botao.cancelar?a("q-btn",{staticClass:"q-mx-md",attrs:{color:"negative",flat:"",label:"Cancelar"},on:{click:function(t){e.executar("cancelar")}}}):e._e(),e.visibilidade.botao.finalizar?a("q-btn",{attrs:{color:"primary",label:"Finalizar"},on:{click:function(t){e.executar("finalizar")}}}):e._e()],1)],1)],1)],1)},r=[];o._withStripped=!0;a("96cf");var n=a("c973"),i=a.n(n),s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"Venda round-borders"},[a("div",{staticClass:"bg-white round-borders q-pt-md q-pb-sm"},[a("q-toolbar",{staticClass:"Venda-barra bg-transparent q-py-sm",attrs:{color:"black",inverted:""}},[a("q-toolbar-title",[a("avatar",{staticClass:"q-mr-sm",attrs:{imagem:(e.contatos[e.venda.idContato]||{}).imagem,rotulo:e.venda.descricaoContato,tamanho:"50"}}),e._v("\n        "+e._s(e.venda.descricaoContato)+"\n      ")],1),a("div",{staticClass:"text-right"},[e.margem[e.venda.id]&&e.permissaoMargem?a("documento-codigo",{attrs:{documento:e.venda,prioridade:{tooltip:"| Índice "+e.$filters.numero(e.margem[e.venda.id].valor,2)+"%",cor:e.margem[e.venda.id].limite?"negative":e.margem[e.venda.id].alerta?"warning":void 0}}}):a("documento-codigo",{attrs:{documento:e.venda}}),a("br"),a("q-btn",{attrs:{color:"primary",flat:"",icon:"print",round:""}},[a("q-popover",[a("q-list",{attrs:{link:"",separator:""}},[e._l(e.configImpressaoOrcamento.filter(function(e){return e.valor}),function(t){return a("q-item",{key:t.valor,nativeOn:{click:function(a){e.imprimir(t.valor,{id:(e.venda||{}).id||"0",Oculto:"0"})}}},[a("q-item-side",{attrs:{icon:"print"}}),a("q-item-main",{attrs:{label:t.texto}})],1)}),"optisoul"===e.sistemaPai?e._l(e.configImpressaoEnvelope,function(t){return a("q-item",{key:t.valor,nativeOn:{click:function(a){e.imprimir(t.valor,(e.venda||{}).id||"0")}}},[a("q-item-side",{attrs:{icon:"print"}}),a("q-item-main",{attrs:{label:t.texto}})],1)}):e._e()],2)],1)],1),a("q-btn",{attrs:{color:"faded",flat:"",icon:"more_vert",round:""}},[a("q-popover",{model:{value:e.menuVenda,callback:function(t){e.menuVenda=t},expression:"menuVenda"}},[a("q-list",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{link:"",separator:""}},[e.ehOrcamento?a("q-item",{nativeOn:{click:function(t){return e.abrirModalContato(t)}}},[a("q-item-side",{attrs:{icon:"how_to_reg"}}),a("q-item-main",{attrs:{label:"Alterar cliente"}})],1):e._e(),e.ehOrcamento?a("q-item",{nativeOn:{click:function(t){return e.alterarContatoVendedor(t)}}},[a("q-item-side",{attrs:{icon:"how_to_reg"}}),a("q-item-main",{attrs:{label:"Alterar vendedor"}})],1):e._e(),!e.ehOrcamento||Object.keys(e.envelopes).length||e.produtos.length?e._e():a("q-item",{nativeOn:{click:function(t){return e.alterarTabelaPreco(t)}}},[a("q-item-side",{attrs:{icon:"attach_money"}}),a("q-item-main",{attrs:{label:"Alterar tabela de preço"}})],1),!e.ehOrcamento||Object.keys(e.envelopes).length||e.produtos.length?e._e():a("q-item",{nativeOn:{click:function(t){return e.alterarOperacao(t)}}},[a("q-item-side",{attrs:{icon:"attach_money"}}),a("q-item-main",{attrs:{label:"Alterar Operação"}})],1),e.ehOrcamento?a("q-item",{nativeOn:{click:function(t){return e.selecionarContatoIndicacao(t)}}},[a("q-item-side",{attrs:{icon:"how_to_reg"}}),a("q-item-main",{attrs:{label:"Selecionar Indicação"}})],1):e._e(),e.ehOrcamento?[e.documentoContato.find(function(e){return"comprador"===(e.descricao||"").trim().toLowerCase()})?a("q-item",{nativeOn:{click:function(t){e.selecionarComprador("")}}},[a("q-item-side",{attrs:{icon:"assignment_ind"}}),a("q-item-main",{attrs:{label:"Remover comprador"}})],1):a("q-item",{nativeOn:{click:function(t){return e.abrirModalComprador(t)}}},[a("q-item-side",{attrs:{icon:"assignment_ind"}}),a("q-item-main",{attrs:{label:"Selecionar comprador"}})],1)]:e._e(),e.ehOrcamento?[e.documentoContato.find(function(e){return"representando"===(e.descricao||"").trim().toLowerCase()})?a("q-item",{nativeOn:{click:function(t){e.removerRepresentando()}}},[a("q-item-side",{attrs:{icon:"how_to_reg"}}),a("q-item-main",{attrs:{label:"Remover representando"}})],1):a("q-item",{nativeOn:{click:function(t){return e.selecionarRepresentando(t)}}},[a("q-item-side",{attrs:{icon:"how_to_reg"}}),a("q-item-main",{attrs:{label:"Informar representando"}})],1)]:e._e(),e.venda.idContatoResponsavel?a("q-item",{nativeOn:{click:function(t){e.selecionarConvenio("")}}},[a("q-item-side",{attrs:{icon:"input"}}),a("q-item-main",{attrs:{label:"Remover convênio"}})],1):a("q-item",{nativeOn:{click:function(t){return e.abrirModalConvenio(t)}}},[a("q-item-side",{attrs:{icon:"input"}}),a("q-item-main",{attrs:{label:"Alocar convênio"}})],1),a("q-item",[a("q-item-side",{attrs:{icon:"check"}}),a("q-item-main",{attrs:{label:"Finalizar como"}})],1),e.ehVenda?a("q-item",{nativeOn:{click:function(t){return e.retornarOrcamento(t)}}},[a("q-item-side",{attrs:{icon:"undo"}}),a("q-item-main",{attrs:{label:"Retornar para orçamento"}})],1):e._e(),a("q-item",[a("q-item-side",{attrs:{icon:"loop"}}),a("q-item-main",{attrs:{label:"Reprocessar remessa de garantia"}})],1)],2)],1)],1)],1)],1),a("documento-metas",{attrs:{slot:"subtitle",documento:e.venda,idContatoComprador:(e.documentoContato.find(function(e){return"comprador"===(e.descricao||"").trim().toLowerCase()})||{}).idContato,idContatoRepresentando:(e.documentoContato.find(function(e){return"representando"===(e.descricao||"").trim().toLowerCase()})||{}).idContato},slot:"subtitle"}),e.mostrarDetalhes?a("div",{staticClass:"q-mb-md q-mx-lg"},[a("div",{staticClass:"row gutter-x-sm"},[a("div",{staticClass:"col-12 col-sm-4"},[a("campo",{attrs:{tipo:"textoArea",rotulo:"Observação","somente-leitura":!e.estaAberto},model:{value:e.venda.observacao,callback:function(t){e.$set(e.venda,"observacao",t)},expression:"venda.observacao"}})],1),a("div",{staticClass:"col-12 col-sm-4"},[a("campo",{attrs:{tipo:"textoArea",rotulo:"Observação interna","somente-leitura":!e.estaAberto},model:{value:e.venda.observacaoInterna,callback:function(t){e.$set(e.venda,"observacaoInterna",t)},expression:"venda.observacaoInterna"}})],1),a("div",{staticClass:"col-12 col-sm-4"},[a("campo",{attrs:{tipo:"textoArea",rotulo:"Ordem de Compra","somente-leitura":!e.estaAberto,maxlength:"50"},model:{value:e.venda.numeroOrdemCompra,callback:function(t){e.$set(e.venda,"numeroOrdemCompra",t)},expression:"venda.numeroOrdemCompra"}})],1)])]):e._e(),a("q-btn",{directives:[{name:"show",rawName:"v-show",value:e.mostrarDetalhes,expression:"mostrarDetalhes"}],staticClass:"no-shadow q-ma-xs",staticStyle:{margin:"0 auto",display:"block",padding:"0 12px 0 4px"},attrs:{icon:"keyboard_arrow_up",size:"sm",outline:"",color:"grey",label:"Detalhes"},on:{click:function(t){e.mostrarDetalhes=!e.mostrarDetalhes}}}),a("q-btn",{directives:[{name:"show",rawName:"v-show",value:!e.mostrarDetalhes,expression:"!mostrarDetalhes"}],staticClass:"no-shadow q-ma-xs",staticStyle:{margin:"0 auto",display:"block",padding:"0 12px 0 4px"},attrs:{icon:"keyboard_arrow_down",size:"sm",outline:"",color:"grey",label:"Detalhes"},on:{click:function(t){e.mostrarDetalhes=!e.mostrarDetalhes}}})],1),a("div",{staticClass:"bg-white round-borders q-mt-md q-pa-md"},[e.ehOrcamento?a("div",[a("div",{staticClass:"Venda-barraRodape bg-white"},[a("div",{staticClass:"u-container"},[a("div",{staticClass:"row justify-between"},[a("div",{staticClass:"col-auto text-center"},[a("q-btn",{staticClass:"q-pa-xs",attrs:{color:"primary",size:"md",icon:"photo_camera",flat:""},on:{click:e.abrirModalCodigoBarras}})],1),a("q-field",{staticClass:"col hideonmobile",attrs:{"icon-color":"primary"}},[a("q-input",{ref:"codigoBarras",attrs:{color:"primary",placeholder:"Código de barras"},on:{keydown:e.leitorCodigoBarras},model:{value:e.codigoBarras,callback:function(t){e.codigoBarras=t},expression:"codigoBarras"}},[a("q-autocomplete",{attrs:{"min-characters":3},on:{search:e.buscarCodigoBarras,selected:e.selecionarItemCodigoBarras}})],1)],1),e.ehOrcamento?a("div",{staticClass:"col-auto text-center"},[a("q-btn",{staticClass:"q-pa-sm",attrs:{color:"primary",size:"md",icon:"add",label:"Produto",flat:""},on:{click:e.abrirModalItem}})],1):e._e(),"optisoul"===e.sistemaPai&&e.ehOrcamento&&0!=e.venda.idContato?a("div",{staticClass:"col-auto text-center"},[a("q-btn",{staticClass:"q-pa-sm",attrs:{color:"primary",size:"md",flat:"",icon:"add",label:"Envelope"},on:{click:function(t){e.abrirModalEnvelope()}}})],1):e._e(),e.ehOrcamento&&e.permissaoOSs?a("div",{staticClass:"col-auto text-center"},[a("q-btn",{staticClass:"q-pa-sm",attrs:{color:"primary",size:"md",flat:"",icon:"add",label:"OS"},on:{click:function(t){e.abrirModalOS()}}})],1):e._e(),e.ehOrcamento&&e.permissaoCustoms?a("div",{staticClass:"col-auto text-center"},[a("q-btn",{staticClass:"q-pa-sm",attrs:{color:"primary",size:"md",icon:"add",label:"Custom",flat:""},on:{click:function(t){e.abrirModalCustom()}}})],1):e._e()],1)])]),Object.keys(e.envelopes).length||e.produtos.length?e._e():a("div",{staticClass:"q-pa-lg text-center"},[a("p",[e._v("Ainda não há itens adicionados.")]),a("p",{staticClass:"q-caption"},[e._v("Para adicionar, utilize os botões acima ou insira o código de barras.")])]),Object.keys(e.envelopes).length||e.produtos.length?a("div",{staticClass:"border-1"},[a("p",{staticClass:"q-item-label ",staticStyle:{color:"#0c0c0c"}},[a("q-icon",{staticClass:"q-mr-md",staticStyle:{color:"#737373"},attrs:{name:"shopping_cart",size:"24px"}}),e._v(" Carrinho\n        ")],1)]):e._e(),e._l(e.produtos,function(t,o){return a("div",{key:o,staticClass:"items-carrinho items-center row q-py-sm"},[t.caption?a("div",{staticClass:"q-body-2 text-weight-medium q-mt-xl"},[e._v("\n          "+e._s(t.caption)+"\n        ")]):e._e(),t.documento?[a("div",{staticClass:"col-auto"},[a("avatar",{attrs:{imagem:t.arquivo.length?t.arquivo[0].arquivo:"",rotulo:t.documento.descricao,tamanho:"40"}})],1),a("q-toolbar",{staticClass:"Venda-itemBarra bg-transparent col q-pr-none q-py-none",attrs:{color:"black",inverted:""}},[a("q-toolbar-title",{staticClass:"q-px-none"},[a("span",{staticClass:"q-body-2"},[e._v(e._s(t.documento.descricao))]),a("span",{attrs:{slot:"subtitle"},slot:"subtitle"},[e._v(e._s(t.documento.observacao))])]),e.margem[t.documento.id]&&e.permissaoMargem?[e.margem[t.documento.id].limite?a("badge",{attrs:{cor:"negative",denso:"",escuro:""}},[e._v("\n                "+e._s(t.documento.tipo)+"\n                "),a("q-tooltip",[e._v("Índice "+e._s(e._f("numero")(e.margem[t.documento.id].valor,2))+"%")])],1):e.margem[t.documento.id].alerta?a("badge",{attrs:{cor:"warning",denso:""}},[e._v("\n                "+e._s(t.documento.tipo)+"\n                "),a("q-tooltip",[e._v("Índice "+e._s(e._f("numero")(e.margem[t.documento.id].valor,2))+"%")])],1):a("badge",{attrs:{denso:""}},[e._v("\n                "+e._s(t.documento.tipo)+"\n                "),a("q-tooltip",[e._v("Índice "+e._s(e._f("numero")(e.margem[t.documento.id].valor,2))+"%")])],1)]:[a("badge",{attrs:{denso:""}},[e._v("\n                "+e._s(t.documento.tipo)+"\n              ")])],"Custom"===t.documento.tipo?[e.ehOrcamento&&e.permissaoCustoms?a("q-btn",{attrs:{color:"primary",dense:"",flat:"",icon:"edit",round:""},on:{click:function(a){e.abrirModalCustom(t.documento.id)}}},[a("q-tooltip",[e._v("Editar Custom")])],1):e._e(),e.ehOrcamento&&e.permissaoCustoms?a("q-btn",{attrs:{color:"faded",dense:"",flat:"",icon:"delete",round:""},on:{click:function(a){e.removerCustom(t.documento.id)}}},[a("q-tooltip",[e._v("Remover Custom")])],1):e._e()]:e._e(),"Ordem de Serviço"===t.documento.tipo?[e.ehOrcamento&&e.permissaoOSs?a("q-btn",{attrs:{color:"primary",dense:"",flat:"",icon:"edit",round:""},on:{click:function(a){e.abrirModalOS(t.documento.id)}}},[a("q-tooltip",[e._v("Editar Ordem de Serviço")])],1):e._e(),e.ehOrcamento&&e.permissaoOSs?a("q-btn",{attrs:{color:"faded",dense:"",flat:"",icon:"delete",round:""},on:{click:function(a){e.removerOS(t.documento.id)}}},[a("q-tooltip",[e._v("Remover Ordem de Serviço")])],1):e._e()]:e._e()],2),a("div",{staticClass:"col-12",staticStyle:{"margin-top":"-20px"}},[a("div",{staticClass:"gutter-x-sm row justify-end"},["Custom"===t.documento.tipo?[a("q-field",{staticClass:"col-3 col-lg-2"},[a("campo",{attrs:{"class-campo":"u-campoCompacto text-weight-bold",align:e.$q.screen.lt.sm?"left":"right",suffix:e.$q.screen.lt.sm?"×":"",tipo:"decimal",decimals:"2","somente-leitura":!0,"hide-underline":""},model:{value:t.documento.subTotal,callback:function(a){e.$set(t.documento,"subTotal",a)},expression:"produto.documento.subTotal"}}),a("q-tooltip",[e._v("Subtotal")])],1),a("q-field",{staticClass:"col-5 col-sm-8 col-lg-2"},[e.ehOrcamento?a("campo",{attrs:{"class-campo":"u-campoCompacto",min:"1","somente-leitura":!e.ehOrcamento,tipo:"quantidade","hide-underline":""},on:{input:function(a){e.calcularQuantidadeCustom(t.documento.id)}},model:{value:t.documento.numero,callback:function(a){e.$set(t.documento,"numero",e._n(a))},expression:"produto.documento.numero"}}):e._e(),e.ehOrcamento?e._e():a("q-input",{staticClass:"u-campoCompacto",attrs:{"hide-underline":"",readonly:!e.ehOrcamento},model:{value:t.documento.numero,callback:function(a){e.$set(t.documento,"numero",a)},expression:"produto.documento.numero"}}),a("q-tooltip",[e._v("Quantidade")])],1),a("q-field",{staticClass:"col-4 col-lg-2"},[a("campo",{attrs:{"class-campo":"u-campoCompacto text-weight-bold","hide-underline":"","somente-leitura":"",prefix:"= ",tipo:"decimal",decimals:"2"},model:{value:t.documento.totalDocumento,callback:function(a){e.$set(t.documento,"totalDocumento",a)},expression:"produto.documento.totalDocumento"}})],1)]:e._e(),"Ordem de Serviço"===t.documento.tipo?[a("q-field",{staticClass:"col-4 col-lg-2"},[a("campo",{attrs:{"class-campo":"u-campoCompacto text-weight-bold","hide-underline":"","somente-leitura":"",tipo:"decimal",decimals:"2"},model:{value:t.documento.totalDocumento,callback:function(a){e.$set(t.documento,"totalDocumento",a)},expression:"produto.documento.totalDocumento"}})],1)]:e._e()],2)])]:e._e(),t.id?[a("div",{staticClass:"col-auto"},[a("avatar",{attrs:{imagem:(e.item[t.idItem]||{}).imagem,rotulo:t.descricaoItem,tamanho:"40"}})],1),a("q-toolbar",{staticClass:"Venda-itemBarra bg-transparent col q-pr-none q-py-none",attrs:{color:"black",inverted:""}},[a("q-toolbar-title",{staticClass:"q-px-none"},[a("span",{staticClass:"q-body-2"},[e._v(e._s(t.descricaoItem))]),a("span",{attrs:{slot:"subtitle"},slot:"subtitle"},[e._v(e._s((e.item[t.idItem]||{}).marca))])]),e.margem[t.id]&&e.permissaoMargem?[e.margem[t.id].limite?a("badge",{attrs:{cor:"negative",denso:"",escuro:""}},[e._v("\n                "+e._s(t.tipoItem)+" "+e._s((e.item[t.idItem]||{}).referencia)+"\n                "),a("q-tooltip",[e._v("Índice "+e._s(e._f("numero")(e.margem[t.id].valor,2))+"%")])],1):e.margem[t.id].alerta?a("badge",{attrs:{cor:"warning",denso:""}},[e._v("\n                "+e._s(t.tipoItem)+" "+e._s((e.item[t.idItem]||{}).referencia)+"\n                "),a("q-tooltip",[e._v("Índice "+e._s(e._f("numero")(e.margem[t.id].valor,2))+"%")])],1):a("badge",{attrs:{denso:""}},[e._v("\n                "+e._s(t.tipoItem)+" "+e._s((e.item[t.idItem]||{}).referencia)+"\n                "),a("q-tooltip",[e._v("Índice "+e._s(e._f("numero")(e.margem[t.id].valor,2))+"%")])],1)]:[a("badge",{attrs:{denso:""}},[e._v("\n                "+e._s(t.tipoItem)+" "+e._s((e.item[t.idItem]||{}).referencia)+"\n              ")])],a("q-btn",{attrs:{color:"primary",dense:"",flat:"",icon:"edit",round:""},on:{click:function(a){e.editarProduto(t)}}}),e.ehOrcamento?a("q-btn",{attrs:{color:"faded",dense:"",flat:"",icon:"delete",round:""},on:{click:function(a){e.removerItem(t.id)}}},[a("q-tooltip",[e._v("Remover Item")])],1):e._e()],2),a("div",{staticClass:"col-12",staticStyle:{"margin-top":"-10px"}},[a("div",{staticClass:"gutter-x-sm row"},["Envelope"!==t.tipoItem?a("q-field",{staticClass:"col-4 col-sm-3 col-lg-2",attrs:{warning:!!e.warningLabel[t.id],"warning-label":e.warningLabel[t.id]}},[a("campo",{attrs:{"class-campo":"u-campoCompacto",align:"left",tipo:"decimal",decimals:"2","somente-leitura":1===t.operacaoFator,"hide-underline":""},on:{blur:function(a){e.carrinhoCalcularTotais(t.id,"valorItem")}},model:{value:t.valorItem,callback:function(a){e.$set(t,"valorItem",a)},expression:"produto.valorItem"}}),a("q-tooltip",[e._v("Valor do produto")])],1):e._e(),"Envelope"!==t.tipoItem?[a("q-field",{staticClass:"col-4 col-sm-3 col-lg-2"},[a("campo",{attrs:{"class-campo":"u-campoCompacto ",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",prefix:"─",suffix:"%","somente-leitura":!e.ehOrcamento||1===t.operacaoFator,"hide-underline":""},on:{blur:function(a){e.carrinhoCalcularTotais(t.id,"descontoPercentualItem")}},model:{value:t.descontoPercentualItem,callback:function(a){e.$set(t,"descontoPercentualItem",a)},expression:"produto.descontoPercentualItem"}}),a("q-tooltip",[e._v("Desconto percentual")])],1),a("q-field",{staticClass:"col-4 col-sm-3 col-lg-2"},[a("campo",{attrs:{"class-campo":"u-campoCompacto",opcoes:{maximumValue:t.valorItem,minimumValue:0},tipo:"decimal",decimals:"2","hide-underline":"","somente-leitura":!e.ehOrcamento||1===t.operacaoFator},on:{blur:function(a){e.carrinhoCalcularTotais(t.id,"descontoItem")}},model:{value:t.descontoItem,callback:function(a){e.$set(t,"descontoItem",a)},expression:"produto.descontoItem"}}),a("q-tooltip",[e._v("Desconto em reais")])],1)]:e._e(),"Envelope"!==t.tipoItem?a("q-field",{staticClass:"col-3 col-lg-2"},[a("campo",{attrs:{"class-campo":"u-campoCompacto text-weight-bold",align:e.$q.screen.lt.sm?"left":"right",opcoes:{maximumValue:t.valorItem,minimumValue:0},prefix:e.$q.screen.lt.sm?"":"=",suffix:e.$q.screen.lt.sm?"×":"",tipo:"decimal",decimals:"2",value:e.subtotal2(t.id),"somente-leitura":!e.ehOrcamento||1===t.operacaoFator,"hide-underline":""},on:{blur:function(a){e.carrinhoCalcularTotais(t.id,"subTotal")},input:function(a){e.subTotal[t.id]=a}}}),a("q-tooltip",[e._v("Subtotal")])],1):e._e(),"Envelope"!==t.tipoItem?a("q-field",{staticClass:"col-5 col-sm-8 col-lg-2"},[e.ehOrcamento?a("campo",{attrs:{"class-campo":"u-campoCompacto",max:t.quantidadeDisponivel,min:"1","somente-leitura":!e.ehOrcamento,tipo:"quantidade","hide-underline":""},on:{input:function(a){e.carrinhoCalcularTotais(t.id,"quantidade")}},model:{value:t.quantidade,callback:function(a){e.$set(t,"quantidade",a)},expression:"produto.quantidade"}}):e._e(),e.ehOrcamento?e._e():a("q-input",{staticClass:"u-campoCompacto",attrs:{"hide-underline":"",readonly:!e.ehOrcamento},model:{value:t.quantidade,callback:function(a){e.$set(t,"quantidade",a)},expression:"produto.quantidade"}}),a("q-tooltip",[e._v("Quantidade")])],1):e._e(),a("q-field",{staticClass:"col-4 col-lg-2"},[a("campo",{attrs:{"class-campo":"u-campoCompacto text-weight-bold","hide-underline":"","somente-leitura":"",tipo:"decimal",prefix:"= ",decimals:"2"},model:{value:t.total,callback:function(a){e.$set(t,"total",a)},expression:"produto.total"}}),a("q-tooltip",[e._v("Total")])],1)],2)])]:e._e()],2)}),a("div",{staticClass:"border-1"},e._l(e.envelopes,function(t){return a("div",{key:t.id,staticClass:"items-carrinho items-center row q-py-sm"},[a("div",{staticClass:"col-auto "},[a("avatar",{attrs:{imagem:(e.contatos[t.idContato]||{}).imagem,rotulo:t.tipo,tamanho:"40"}})],1),a("q-toolbar",{staticClass:"Venda-itemBarra bg-transparent col",attrs:{color:"black",inverted:""}},[a("q-toolbar-title",{staticClass:"q-pl-none"},[a("span",{staticClass:"q-body-2"},[e._v("\n                "+e._s(e.descricaoEnvelope(t.id))+"\n              ")]),a("span",{attrs:{slot:"subtitle"},slot:"subtitle"},[e._v(e._s(t.descricaoContato))])])],1),a("div",{staticClass:" col-12 col-lg-auto text-right"},[e.margem[t.id]&&e.permissaoMargem?[e.margem[t.id].limite?a("badge",{attrs:{cor:"negative",denso:"",escuro:""}},[e._v("\n                "+e._s(t.tipo)+"\n                "),a("q-tooltip",[e._v("Índice "+e._s(e._f("numero")(e.margem[t.id].valor,2))+"%")])],1):e.margem[t.id].alerta?a("badge",{attrs:{cor:"warning",denso:""}},[e._v("\n                "+e._s(t.tipo)+"\n                "),a("q-tooltip",[e._v("Índice "+e._s(e._f("numero")(e.margem[t.id].valor,2))+"%")])],1):a("badge",{attrs:{denso:""}},[e._v("\n                "+e._s(t.tipo)+"\n                "),a("q-tooltip",[e._v("Índice "+e._s(e._f("numero")(e.margem[t.id].valor,2))+"%")])],1)]:[a("badge",{attrs:{denso:""}},[e._v("\n                "+e._s(t.tipo)+"\n              ")])],e.ehOrcamento?a("q-btn",{attrs:{color:"primary",dense:"",flat:"",icon:"edit",round:""},on:{click:function(a){e.abrirModalEnvelope(t.id)}}},[a("q-tooltip",[e._v("Editar Envelope")])],1):e._e(),e.ehOrcamento?e._e():a("q-btn",{attrs:{color:"primary",dense:"",flat:"",icon:"open_in_browser",round:""},on:{click:function(a){e.abrirModalEnvelope(t.id)}}}),e.ehOrcamento?a("q-btn",{attrs:{color:"faded",dense:"",flat:"",icon:"delete",round:""},on:{click:function(a){e.removerEnvelope(t.id)}}},[a("q-tooltip",[e._v("Remover Envelope")])],1):e._e(),a("div",{staticClass:"row"},[a("q-field",{staticClass:"col-12"},[a("campo",{attrs:{"class-campo":"u-campoCompacto text-left q-mr-sm text-weight-bold","hide-underline":"","somente-leitura":"",tipo:"decimal",decimals:"2"},model:{value:t.totalDocumento,callback:function(a){e.$set(t,"totalDocumento",a)},expression:"envelope.totalDocumento"}})],1)],1)],2)],1)}))],2):e._e(),e.produtos.length||Object.keys(e.envelopes).length?a("div",{staticClass:"row q-mt-xl"},[a("div",{staticClass:"col-12 col-lg-4 offset-lg-8"},[e.ehOrcamento?a("div",{staticClass:"items-center row gutter-x-sm",staticStyle:{"min-height":"49px"}},[a("div",{staticClass:"col-3"},[e._v("Subtotal")]),a("strong",{staticClass:"col text-right text-weight-bold"},[e._v(e._s(e._f("numero")(e.venda.subTotal,2)))])]):e._e(),e.ehOrcamento?a("div",{staticClass:"items-center row gutter-x-sm"},[a("div",{staticClass:"col-3"},[e._v("Desconto")]),a("q-field",{staticClass:"col"},[a("campo",{attrs:{"somente-leitura":!e.ehOrcamento,opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",suffix:"%",erro:e.erroCalculo},on:{input:function(t){e.calcularTotais("totalPercentualDesconto")}},model:{value:e.venda.totalPercentualDesconto,callback:function(t){e.$set(e.venda,"totalPercentualDesconto",t)},expression:"venda.totalPercentualDesconto"}})],1),a("q-field",{staticClass:"col"},[a("campo",{attrs:{"somente-leitura":!e.ehOrcamento,opcoes:{maximumValue:e.venda.subTotal,minimumValue:0},tipo:"decimal",decimals:"2",erro:e.erroCalculo},on:{input:function(t){e.calcularTotais("totalDesconto")}},model:{value:e.venda.totalDesconto,callback:function(t){e.$set(e.venda,"totalDesconto",t)},expression:"venda.totalDesconto"}})],1)],1):e._e(),e.ehOrcamento?a("div",{staticClass:"items-center row gutter-x-sm"},[a("div",{staticClass:"col-3"},[e._v("Frete")]),a("q-field",{staticClass:"col"},[a("q-radio",{staticClass:"q-mr-md",attrs:{label:"CIF",val:"CIF",readonly:!e.ehOrcamento},on:{input:e.calcularTotais},model:{value:e.venda.tipoFrete,callback:function(t){e.$set(e.venda,"tipoFrete",t)},expression:"venda.tipoFrete"}}),a("q-radio",{attrs:{label:"FOB",val:"FOB",readonly:!e.ehOrcamento},on:{input:e.calcularTotais},model:{value:e.venda.tipoFrete,callback:function(t){e.$set(e.venda,"tipoFrete",t)},expression:"venda.tipoFrete"}})],1),a("q-field",{staticClass:"col"},[a("campo",{attrs:{opcoes:{maximumValue:e.venda.subTotal,minimumValue:0},tipo:"decimal",decimals:"2","somente-leitura":!e.ehOrcamento},on:{input:e.calcularTotais},model:{value:e.venda.valorFrete,callback:function(t){e.$set(e.venda,"valorFrete",t)},expression:"venda.valorFrete"}})],1)],1):e._e(),a("div",{staticClass:"items-center row gutter-x-sm q-mt-md"},[a("div",{staticClass:"col-4 text-weight-bold"},[e._v("Total")]),a("strong",{staticClass:"col text-right text-weight-bold"},[e._v(e._s(e._f("numero")(e.venda.totalDocumento,2)))])]),e.imposto.valorIpi||e.imposto.valorIcmsSt?a("div",[e.ehOrcamento&&e.imposto.valorIpi?a("div",{staticClass:"items-center row gutter-x-sm",staticStyle:{"min-height":"49px"}},[a("div",{staticClass:"col-3"},[e._v("\n              IPI\n            ")]),a("div",{staticClass:"col text-right"},[e._v("\n              "+e._s(e._f("numero")(e.imposto.valorIpi,2))+"\n            ")])]):e._e(),e.ehOrcamento&&e.imposto.valorIcmsSt?a("div",{staticClass:"items-center row gutter-x-sm",staticStyle:{"min-height":"49px"}},[a("div",{staticClass:"col-3"},[e._v("\n              ICMS/ST\n            ")]),a("div",{staticClass:"col text-right"},[e._v("\n              "+e._s(e._f("numero")(e.imposto.valorIcmsSt,2))+"\n            ")])]):e._e(),e.ehOrcamento?a("div",{staticClass:"items-center row gutter-x-sm",staticStyle:{"min-height":"49px"}},[a("div",{staticClass:"col-6 text-weight-bold"},[e._v("\n              Total c/ Impostos\n            ")]),a("strong",{staticClass:"col text-right text-weight-bold"},[e._v("\n              "+e._s(e._f("numero")(e.venda.totalDocumento+e.imposto.valorIpi+e.imposto.valorIcmsSt,2))+"\n            ")])]):e._e()]):e._e()])]):e._e()]),a("div",{staticClass:"Venda-faturamento bg-white round-borders q-my-md q-pa-md"},[a("faturamento",{ref:"faturamento",attrs:{documento:e.venda},on:{mudou:e.faturamentoAtualizar}})],1),e.venda.idContato&&"optisoul"!==e.sistemaPai?a("div",{staticClass:"Venda-faturamento bg-white round-borders q-my-md q-pa-md"},[a("VendaTransporte",{ref:"transporte",attrs:{idContatoCliente:e.venda.idContato}})],1):e._e(),a("envelope",{attrs:{envelope:e.envelope},on:{salvarEnvelope:e.salvarEnvelope},model:{value:e.modalEnvelope,callback:function(t){e.modalEnvelope=t},expression:"modalEnvelope"}}),e.modalOS.activated?a("ordem-servico",{attrs:{data:e.modalOS.data},on:{"update:data":function(t){e.$set(e.modalOS,"data",t)},changed:e.salvarOS},model:{value:e.modalOS.visible,callback:function(t){e.$set(e.modalOS,"visible",t)},expression:"modalOS.visible"}}):e._e(),e.modalCustom.activated?a("custom",{attrs:{data:e.modalCustom.data},on:{"update:data":function(t){e.$set(e.modalCustom,"data",t)},changed:e.salvarCustom},model:{value:e.modalCustom.visible,callback:function(t){e.$set(e.modalCustom,"visible",t)},expression:"modalCustom.visible"}}):e._e(),a("prompt-contato-novo",{attrs:{filtro:{ativo:!0,somenteCarteira:!0},placeholder:"Selecione o contato"},on:{selecionar:e.selecionarContato},model:{value:e.modalContato,callback:function(t){e.modalContato=t},expression:"modalContato"}}),a("prompt",{attrs:{prop:{dados:e.convenios}},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.itens;return[o.length<1?a("div",{staticClass:"bg-light q-pa-lg round-borders text-black text-center"},[e._v("\n        Não encontramos contatos com os critérios selecionados.\n      ")]):e._e(),a("q-list",{attrs:{link:"","no-border":"",separator:""}},e._l(o,function(t){return a("contato-card",{key:t.id,attrs:{contato:t,modo:"lista"},on:{selecionar:e.selecionarConvenio}})}))]}}]),model:{value:e.modalConvenio,callback:function(t){e.modalConvenio=t},expression:"modalConvenio"}}),a("prompt",{attrs:{prop:{dados:e.compradores}},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.itens;return[o.length<1?a("div",{staticClass:"bg-light q-pa-lg round-borders text-black text-center"},[e._v("\n        Não encontramos contatos com os critérios selecionados.\n      ")]):e._e(),a("q-list",{attrs:{link:"","no-border":"",separator:""}},e._l(o,function(t){return a("contato-card",{key:t.id,attrs:{contato:t,modo:"lista"},on:{selecionar:e.selecionarComprador}})}))]}}]),model:{value:e.modalComprador,callback:function(t){e.modalComprador=t},expression:"modalComprador"}}),a("prompt-codigo-barras",{on:{escanear:e.escanearCodigoBarras},model:{value:e.modalCodigoBarras,callback:function(t){e.modalCodigoBarras=t},expression:"modalCodigoBarras"}}),a("prompt-item-novo",{ref:"promptItem",attrs:{filtro:{ativo:!0,idTabelaPreco:e.venda.idItemTabelaPreco,idEmpresa:e.venda.idEmpresa,idContato:e.venda.idContato},habilitarQuantidade:!0},on:{selecionarItens:e.selecionarItens},model:{value:e.modalItem,callback:function(t){e.modalItem=t},expression:"modalItem"}}),a("prompt-contato-novo",{attrs:{filtro:{ativo:!0,empresas:!0},placeholder:"Seleciona a empresa"},on:{selecionar:e.selecionarEmpresa},model:{value:e.modalContatoEmpresa.visivel,callback:function(t){e.$set(e.modalContatoEmpresa,"visivel",t)},expression:"modalContatoEmpresa.visivel"}}),a("q-modal",{attrs:{minimized:""},on:{hide:function(t){e.modalDescontoMaximo.reject()}},model:{value:e.modalDescontoMaximo.visivel,callback:function(t){e.$set(e.modalDescontoMaximo,"visivel",t)},expression:"modalDescontoMaximo.visivel"}},[a("q-modal-layout",[a("q-toolbar",{attrs:{slot:"header"},slot:"header"},[a("q-toolbar-title",[e._v("Limite de Desconto Excedido")])],1),a("form",{staticClass:"q-pa-sm",on:{submit:function(t){t.preventDefault(),e.modalDescontoMaximo.resolve()}}},[a("q-list",{attrs:{"no-border":"",dense:""}},[e._l(e.modalDescontoMaximo.itens,function(t,o){return[o?a("q-item-separator",{key:o}):e._e(),a("q-item",{key:o+t.descricao},[a("q-item-main",[a("q-item-tile",{attrs:{label:""}},[e._v("\n                  "+e._s(t.descricao)+"\n                  "),a("q-tooltip",[e._v("\n                    Máximo permitido: "+e._s(t.maximoDesconto)+"%\n                  ")])],1)],1)],1)]})],2),a("div",{staticClass:"q-mt-lg text-center"},[a("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{color:"faded",flat:"",label:"Cancelar"}}),e.modalDescontoMaximo.permiteDescontoMaximo?a("q-btn",{staticClass:"q-ml-sm no-shadow",attrs:{color:"primary",label:"Continuar",type:"submit"}}):e._e()],1)],1)],1)],1),a("q-modal",{attrs:{minimized:""},on:{hide:function(t){e.modalItemSemEstoque.reject()}},model:{value:e.modalItemSemEstoque.visivel,callback:function(t){e.$set(e.modalItemSemEstoque,"visivel",t)},expression:"modalItemSemEstoque.visivel"}},[a("q-modal-layout",[a("q-toolbar",{attrs:{slot:"header"},slot:"header"},[a("q-toolbar-title",[e._v(e._s((e.modalItemSemEstoque.itens||[]).length>1?"Itens":"Item")+" sem estoque\n        ")])],1),a("form",{staticClass:"q-pa-sm"},[a("q-list",{attrs:{"no-border":"",dense:""}},[e._l(e.modalItemSemEstoque.itens,function(t,o){return[o?a("q-item-separator",{key:o}):e._e(),a("q-item",{key:o+t.descricao},[a("q-item-main",[a("q-item-tile",{attrs:{label:""}},[e._v(e._s(t.descricao))]),a("q-item-tile",{attrs:{sublabel:""}},[e._v("Saldo: "+e._s(t.saldo))])],1)],1)]})],2),a("div",{staticClass:"q-mt-lg text-center"},[a("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{color:"faded",flat:"",label:"Fechar"}})],1)],1)],1)],1),a("q-modal",{model:{value:e.produtoEditandoVisivel,callback:function(t){e.produtoEditandoVisivel=t},expression:"produtoEditandoVisivel"}},[a("q-modal-layout",{staticStyle:{width:"990px","max-width":"100%"}},[a("div",{staticClass:"layout-padding q-pa-none"},[a("div",{staticClass:"u-container "},[a("div",{staticClass:"row q-py-md"},[a("div",{staticClass:"col-12 col-lg-5 q-pa-md text-center"},[(e.item[e.produtoEditando.idItem]||{}).imagem?a("img",{staticStyle:{"max-width":"100%"},attrs:{src:(e.item[e.produtoEditando.idItem]||{}).imagem,alt:""}}):e._e()]),a("div",{staticClass:"col-12 col-lg-7"},[a("h3",{staticClass:"q-display-1 q-my-none"},[e._v(e._s(e.produtoEditando.descricaoItem))]),a("p",{staticClass:"q-body-2"},[e._v(e._s((e.item[e.produtoEditando.idItem]||{}).marca))]),a("q-tabs",{staticClass:"row",attrs:{swipeable:"",color:"white","text-color":"blue",align:"justify"},model:{value:e.produtoEditandoTab,callback:function(t){e.produtoEditandoTab=t},expression:"produtoEditandoTab"}},[a("q-tab",{staticClass:"cinza",attrs:{slot:"title",default:"",name:"tab1",icon:"info",label:"Detalhes"},slot:"title"}),a("q-tab",{staticClass:"cinza",attrs:{slot:"title",name:"tab2",icon:"account_balance",label:"Impostos"},slot:"title"}),a("q-tab",{staticClass:"cinza",attrs:{slot:"title",name:"tab3",icon:"history",label:"Histórico"},slot:"title"}),a("q-tab",{staticClass:"cinza",attrs:{slot:"title",name:"tab4",icon:"compare_arrows",label:"Estoque"},slot:"title"}),a("q-tab-pane",{staticClass:"row",attrs:{name:"tab1"}},[a("p",{staticClass:"col-12"},[a("campo",{attrs:{tipo:"texto",rotulo:"Agrupamento"},model:{value:e.produtoEditando.descricaoAgrupamento,callback:function(t){e.$set(e.produtoEditando,"descricaoAgrupamento","string"===typeof t?t.trim():t)},expression:"produtoEditando.descricaoAgrupamento"}})],1),a("dl",{staticClass:"col-6"},[a("dt",[e._v("Observação")]),a("dd",{staticStyle:{"white-space":"pre-line"}},[e._v(e._s((e.item[e.produtoEditando.idItem]||{}).observacao))])]),a("dl",{staticClass:"col-6"},[a("dt",[e._v("Aplicação")]),a("dd",{staticStyle:{"white-space":"pre-line"}},[e._v(e._s((e.item[e.produtoEditando.idItem]||{}).aplicacao))])])]),a("q-tab-pane",{attrs:{name:"tab2"}},[a("div",{staticClass:"row"},[a("dl",{staticClass:"col-6 q-mt-sm"},[a("dt",[e._v("IPI")]),a("dd",[e._v(e._s(e._f("numero")(e.produtoEditandoImposto.aliqIpi,2))+"%")])]),a("dl",{staticClass:"col-6 q-mt-sm"},[a("dt",[e._v("ICMS/ST")]),a("dd",{staticStyle:{"white-space":"pre-line"}},[e._v(e._s(e._f("numero")(e.produtoEditandoImposto.percIva,2))+"%")])])]),a("div",{staticClass:"row gutter-x-sm"},[a("SeletorNcm",{staticClass:"col-6",model:{value:e.produtoEditando.ncm,callback:function(t){e.$set(e.produtoEditando,"ncm",t)},expression:"produtoEditando.ncm"}}),a("SeletorCest",{staticClass:"col-6",attrs:{ncm:e.produtoEditando.ncm},model:{value:e.produtoEditando.cest,callback:function(t){e.$set(e.produtoEditando,"cest",t)},expression:"produtoEditando.cest"}})],1)]),a("q-tab-pane",{attrs:{name:"tab3"}},[e.produtoEditandoHistorico.documentosItens&&e.produtoEditandoHistorico.documentosItens.length?a("q-table",{staticClass:"no-shadow text-left",attrs:{data:e.produtoEditandoHistorico.documentosItens,columns:e.produtoEditandoHistorico.colunas,pagination:e.produtoEditandoHistorico.paginacao},on:{"update:pagination":function(t){e.$set(e.produtoEditandoHistorico,"paginacao",t)}},scopedSlots:e._u([{key:"body",fn:function(t){return a("q-tr",{attrs:{props:t}},[a("q-td",{key:"documento",attrs:{props:t}},[e._v("\n                        "+e._s(e.produtoEditandoHistorico.documentos[t.row.idDocumento].tipo)+"\n                        #"+e._s(parseInt(e.produtoEditandoHistorico.documentos[t.row.idDocumento].numero)||(e.produtoEditandoHistorico.documentos[t.row.idDocumento].id||"").slice(-6))),a("br"),e._v("\n                        "+e._s(e.produtoEditandoHistorico.documentos[t.row.idDocumento].status)),a("br"),e._v("\n                        "+e._s(e._f("dataHora")(e.produtoEditandoHistorico.documentos[t.row.idDocumento].dataHoraFinalizado||e.produtoEditandoHistorico.documentos[t.row.idDocumento].dataHoraEmissao))+"\n                      ")]),a("q-td",{key:"valorUnitario",attrs:{props:t}},[t.row.valorReal!==t.row.valorItem?a("span",{staticStyle:{"text-decoration":"line-through"}},[e._v("\n                          "+e._s(e._f("numero")(t.row.valorItem,2))+"\n                        ")]):e._e(),e._v("\n                        "+e._s(e._f("numero")(t.row.valorReal,2))+"\n                      ")]),a("q-td",{key:"quantidade",attrs:{props:t}},[e._v(e._s(t.row.quantidade*t.row.operacaoFator*-1)+"\n                      ")]),a("q-td",{key:"valorTotal",attrs:{props:t}},[e._v(e._s(e._f("numero")(t.row.valorRealTotal,2)))])],1)}}])}):e._e()],1),a("q-tab-pane",{attrs:{name:"tab4"}},[e.produtoEditandoEstoque.estoque&&e.produtoEditandoEstoque.estoque.length?a("q-table",{staticClass:"no-shadow text-left",attrs:{data:e.produtoEditandoEstoque.estoque,columns:e.produtoEditandoEstoque.colunas,pagination:e.produtoEditandoEstoque.paginacao},on:{"update:pagination":function(t){e.$set(e.produtoEditandoEstoque,"paginacao",t)}},scopedSlots:e._u([{key:"body",fn:function(t){return a("q-tr",{attrs:{props:t}},[a("q-td",{key:"empresa",attrs:{props:t}},[e._v("\n                        "+e._s(t.row.apelidoEmpresa)+"\n                        "),a("br"),e._v("\n                        "+e._s(t.row.nomeEmpresa)+"\n                      ")]),a("q-td",{key:"tipoEstoque",attrs:{props:t}},[e._v("\n                        "+e._s(t.row.tipoEstoque)+"\n                      ")]),a("q-td",{key:"lote",attrs:{props:t}},[e._v("\n                        "+e._s(t.row.loteEmpresa)+"\n                      ")]),a("q-td",{key:"quantidade",attrs:{props:t}},[e._v("\n                        "+e._s(t.row.saldo)+"\n                      ")])],1)}}])}):e._e()],1)],1)],1)])]),a("div",{staticClass:"q-my-xl"})]),a("q-layout-footer",{staticClass:"no-shadow",staticStyle:{"background-color":"#eeeeee"},attrs:{fixed:""}},[a("div",{staticClass:"u-container"},[a("q-toolbar",{attrs:{color:"light-grey"}},[a("q-toolbar-title",{staticStyle:{color:"black"}},[a("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],staticStyle:{cursor:"default !important"},attrs:{flat:"",size:"md","no-ripple":"","text-color":"black",label:"Cancelar"}})],1),a("q-btn",{staticClass:"no-shadow",staticStyle:{float:"right","margin-left":"6px",cursor:"default !important"},attrs:{"no-ripple":"",label:"Salvar",color:"light-blue-9"},on:{click:function(t){e.salvarEdicaoProduto(e.produtoEditando)}}})],1)],1)])],1)],1),a("q-inner-loading",{attrs:{color:"primary",size:"50px",visible:e.exibirCarregando}}),e.promptItemTabelaPreco.ativo?a("prompt-item-tabela-preco-novo",{attrs:{filtro:e.promptItemTabelaPreco.filtro,placeholder:e.promptItemTabelaPreco.placeholder},on:{selecionar:e.obterItemTabelaPrecoViaPrompt},model:{value:e.promptItemTabelaPreco.visivel,callback:function(t){e.$set(e.promptItemTabelaPreco,"visivel",t)},expression:"promptItemTabelaPreco.visivel"}}):e._e(),e.promptDocumentoOperacao.ativo?a("prompt-documento-operacao-novo",{attrs:{filtro:e.promptDocumentoOperacao.filtro,placeholder:e.promptDocumentoOperacao.placeholder},on:{selecionar:e.obterDocumentoOperacaoViaPrompt},model:{value:e.promptDocumentoOperacao.visivel,callback:function(t){e.$set(e.promptDocumentoOperacao,"visivel",t)},expression:"promptDocumentoOperacao.visivel"}}):e._e(),e.promptContato.ativo?a("prompt-contato-novo",{attrs:{filtro:e.promptContato.filtro,placeholder:e.promptContato.placeholder},on:{selecionar:e.obterContatoViaPrompt},model:{value:e.promptContato.visivel,callback:function(t){e.$set(e.promptContato,"visivel",t)},expression:"promptContato.visivel"}}):e._e()],1)},c=[];s._withStripped=!0;a("456d"),a("cadf"),a("c5f6"),a("6762"),a("2fdb");var l=a("448a"),d=a.n(l),u=(a("a481"),a("551c"),a("7514"),a("ac4d"),a("8a81"),a("ac6a"),a("3156")),m=a.n(u),p=(a("20d6"),a("df3a")),v=a("a0fd"),h=a("88db"),f=a("ab5d"),b=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("q-modal",{attrs:{"no-esc-dismiss":"","no-backdrop-dismiss":"",maximized:""},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[a("div",{staticClass:"q-pt-xl",staticStyle:{background:"#eee","min-height":"100vh"}},[a("q-layout-header",{attrs:{reveal:""}},[a("q-toolbar",{staticClass:"BarraTopo"},[a("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"arrow_back"},on:{click:e.close}}),a("q-toolbar-title",[e._v("Custom")]),a("q-btn",{staticClass:"q-ml-sm no-shadow",attrs:{color:"white","text-color":"primary",label:"Salvar"},on:{click:e.save}})],1)],1),a("div",{staticClass:"layout-padding row justify-center"},[a("div",{staticStyle:{width:"1280px","max-width":"90vw"}},[a("q-card",{staticClass:"q-pa-md q-px-lg q-mb-md bg-white no-shadow"},[a("q-toolbar",{staticClass:"q-pb-md q-px-none",attrs:{color:"black",inverted:""}},[a("q-toolbar-title",{staticClass:"q-px-none"},[a("div",{staticClass:"row items-center"},[a("avatar",{staticStyle:{float:"left"},attrs:{imagem:e.contato.imagem,rotulo:e.contato.descricao,tamanho:"40"}}),a("div",{staticClass:"col q-ma-sm q-title"},[e._v(e._s(e.contato.descricao))])],1)]),a("badge",[e._v("#"+e._s(e.contato.codigo))])],1),a("div",{staticClass:"row gutter-x-sm q-mb-sm"},[a("div",{staticClass:"col-12"},[a("campo",{staticClass:"bg-light q-px-sm",attrs:{rotuloFixo:"Descrição",tipo:"textoArea",erro:!!e.erroDescricao,"erro-rotulo":e.erroDescricao,"somente-leitura":e.readonly},model:{value:e.dataTmp.documento.descricao,callback:function(t){e.$set(e.dataTmp.documento,"descricao","string"===typeof t?t.trim():t)},expression:"dataTmp.documento.descricao"}})],1)]),a("div",{staticClass:"row gutter-x-sm"},[a("div",{staticClass:"col-6"},[a("campo",{staticClass:"bg-light q-px-sm",attrs:{rotuloFixo:"Observação",tipo:"textoArea","somente-leitura":e.readonly},model:{value:e.dataTmp.documento.observacao,callback:function(t){e.$set(e.dataTmp.documento,"observacao","string"===typeof t?t.trim():t)},expression:"dataTmp.documento.observacao"}})],1),a("div",{staticClass:"col-6"},[a("campo",{staticClass:"bg-light q-px-sm",attrs:{rotuloFixo:"Descrição Agrupamento",tipo:"texto",somenteLeitura:e.readonly},model:{value:e.descricaoAgrupamento,callback:function(t){e.descricaoAgrupamento="string"===typeof t?t.trim():t},expression:"descricaoAgrupamento"}})],1)])],1),a("div",{staticClass:"bg-white q-mt-md q-py-sm"},[a("q-card",{staticClass:"q-pa-md q-pb-xl q-mb-md bg-white no-shadow "},[a("q-toolbar",{staticClass:"q-pt-md",attrs:{color:"black",inverted:""}},[a("q-toolbar-title",[e._v("Imagens")])],1),a("div",{staticClass:"row gutter-x-sm",staticStyle:{padding:"0 24px"}},[a("div",{staticClass:"col-12 "},[a("arquivo",{ref:"arquivo"})],1)])],1)],1),a("div",{staticClass:"bg-white q-mt-md q-py-sm"},[a("q-card",{staticClass:"q-pa-md q-pb-xl q-mb-md bg-white no-shadow "},[a("q-toolbar",{staticClass:"q-pt-md",attrs:{color:"black",inverted:""}},[a("q-toolbar-title",[e._v("Itens")]),e.readonly?e._e():a("q-btn",{attrs:{color:"primary",flat:"",icon:"add",label:"Produto"},on:{click:function(t){e.abrirModalItem("Produto")}}}),e.readonly?e._e():a("q-btn",{attrs:{color:"primary",flat:"",icon:"add",label:"Serviço"},on:{click:function(t){e.abrirModalItem("Serviço")}}})],1),e.readonly?e._e():a("q-field",{staticClass:"q-mx-lg"},[a("q-input",{ref:"codigoBarras",attrs:{after:[{icon:"photo_camera",handler:e.abrirModalCodigoBarras}],before:[{icon:"line_weight"}],color:"light","inverted-light":"","float-label":"Código de barras"},on:{keydown:e.leitorCodigoBarras},model:{value:e.codigoBarras,callback:function(t){e.codigoBarras=t},expression:"codigoBarras"}},[a("q-autocomplete",{attrs:{"min-characters":3},on:{search:e.buscarCodigoBarras,selected:e.selecionarItemCodigoBarras}})],1)],1),e.dataTmp.documentoItens.length?e._l(e.dataTmp.documentoItens,function(t,o){return a("div",{key:o,staticClass:"items-carrinho items-center row q-py-sm q-mx-lg"},[a("div",{staticClass:"col-auto"},[a("avatar",{attrs:{imagem:(e.item[t.idItem]||{}).imagem,rotulo:t.descricaoItem,tamanho:"40"}})],1),a("q-toolbar",{staticClass:"Venda-itemBarra bg-transparent col q-pr-none q-py-none",attrs:{color:"black",inverted:""}},[a("q-toolbar-title",{staticClass:"q-px-none"},[a("span",{staticClass:"q-body-2"},[e._v(e._s(t.descricaoItem))]),a("span",{attrs:{slot:"subtitle"},slot:"subtitle"},[e._v(e._s((e.item[t.idItem]||{}).marca))])]),a("badge",{attrs:{denso:""}},[e._v("\n                    "+e._s("Produto"!==t.tipoItem?t.tipoItem:"")+"\n                    "),a("span",[e._v("\n                      "+e._s((e.item[t.idItem]||{}).referencia)+"\n                      "),a("q-tooltip",[e._v("Referência")])],1)]),e.readonly?e._e():a("q-btn",{attrs:{color:"faded",dense:"",flat:"",icon:"delete",round:""},on:{click:function(t){e.removerItem(o)}}},[a("q-tooltip",[e._v("Remover Item")])],1)],1),a("div",{staticClass:"col-12",staticStyle:{"margin-top":"-10px"}},[a("div",{staticClass:"gutter-x-sm row"},[a("q-field",{staticClass:"col-4 col-sm-3 col-lg-2",attrs:{warning:!!e.warningLabel[t.id],"warning-label":e.warningLabel[t.id]}},[a("campo",{attrs:{"class-campo":"u-campoCompacto",align:"left",tipo:"decimal",decimals:"2","somente-leitura":e.readonly,"hide-underline":""},on:{blur:function(t){e.calculaTotalItem(o,"valorItem")}},model:{value:t.valorItem,callback:function(a){e.$set(t,"valorItem",a)},expression:"di.valorItem"}}),a("q-tooltip",[e._v("Valor do produto")])],1),a("q-field",{staticClass:"col-4 col-sm-3 col-lg-2"},[a("campo",{attrs:{"class-campo":"u-campoCompacto ",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",prefix:"─",suffix:"%","somente-leitura":e.readonly,"hide-underline":""},on:{blur:function(t){e.calculaTotalItem(o,"descontoPercentualItem")}},model:{value:t.descontoPercentualItem,callback:function(a){e.$set(t,"descontoPercentualItem",a)},expression:"di.descontoPercentualItem"}}),a("q-tooltip",[e._v("Desconto percentual")])],1),a("q-field",{staticClass:"col-4 col-sm-3 col-lg-2"},[a("campo",{attrs:{"class-campo":"u-campoCompacto",opcoes:{maximumValue:t.valorItem,minimumValue:0},tipo:"decimal",decimals:"2","hide-underline":"","somente-leitura":e.readonly},on:{blur:function(t){e.calculaTotalItem(o,"descontoItem")}},model:{value:t.descontoItem,callback:function(a){e.$set(t,"descontoItem",a)},expression:"di.descontoItem"}}),a("q-tooltip",[e._v("Desconto em reais")])],1),a("q-field",{staticClass:"col-3 col-lg-2"},[a("campo",{attrs:{"class-campo":"u-campoCompacto text-weight-bold",align:e.$q.screen.lt.sm?"left":"right",opcoes:{maximumValue:t.valorItem,minimumValue:0},prefix:e.$q.screen.lt.sm?"":"=",suffix:e.$q.screen.lt.sm?"×":"",tipo:"decimal",decimals:"2","somente-leitura":e.readonly,"hide-underline":""},on:{blur:function(t){e.calculaTotalItem(o,"subTotal")}},model:{value:e.subTotal[t.id],callback:function(a){e.$set(e.subTotal,t.id,a)},expression:"subTotal[di.id]"}}),a("q-tooltip",[e._v("Subtotal")])],1),a("q-field",{staticClass:"col-5 col-sm-8 col-lg-2"},[a("campo",{attrs:{"class-campo":"u-campoCompacto",min:"1","somente-leitura":e.readonly,tipo:"quantidade","hide-underline":""},on:{input:function(t){e.calculaTotalItem(o,"quantidade")}},model:{value:t.quantidade,callback:function(a){e.$set(t,"quantidade",a)},expression:"di.quantidade"}}),a("q-tooltip",[e._v("Quantidade")])],1),a("q-field",{staticClass:"col-4 col-lg-2"},[a("campo",{attrs:{"class-campo":"u-campoCompacto text-weight-bold","hide-underline":"","somente-leitura":"",tipo:"decimal",prefix:"= ",decimals:"2"},model:{value:t.total,callback:function(a){e.$set(t,"total",a)},expression:"di.total"}}),a("q-tooltip",[e._v("Total")])],1)],1)]),a("div",{staticClass:"col-12"},[a("campo",{attrs:{rotulo:"Observação"},model:{value:t.observacao,callback:function(a){e.$set(t,"observacao",a)},expression:"di.observacao"}})],1)],1)}):a("div",{staticClass:"q-pa-lg text-center"},[a("p",[e._v("Não há itens no carrinho")]),a("p",{staticClass:"q-caption"},[e._v("Para adicionar, utilize os botões acima ou insira o código de barras")])])],2)],1),a("div",{staticClass:"bg-white q-mt-md q-py-sm"},[a("q-card",{staticClass:"q-pa-lg q-mb-md bg-white no-shadow "},[a("div",{staticClass:"gutter-x-sm row"},[a("div",{staticClass:"col-12 col-lg-8"},[a("campo",{attrs:{maxlength:"10",rotulo:"Previsão de Entrega",tipo:"data",erro:!!e.erroDataHoraPrevisto,"erro-rotulo":e.erroDataHoraPrevisto,somenteLeitura:e.readonly},model:{value:e.dataTmp.documento.dataHoraPrevisto,callback:function(t){e.$set(e.dataTmp.documento,"dataHoraPrevisto",t)},expression:"dataTmp.documento.dataHoraPrevisto"}})],1),a("div",{staticClass:"col-12 col-lg-4 q-mt-md"},[a("div",{staticClass:"row gutter-x-sm"},[a("div",{staticClass:"col-4 q-mt-sm",staticStyle:{"padding-top":"8px"}},[e._v("Total")]),a("strong",{staticClass:"col-8 q-mt-sm text-right",staticStyle:{"padding-top":"8px"}},[e._v(e._s(e._f("numero")(e.dataTmp.documento.totalDocumento,2)))])])])])])],1)],1)])],1)]),a("prompt-codigo-barras",{on:{escanear:e.escanearCodigoBarras},model:{value:e.modalCodigoBarras,callback:function(t){e.modalCodigoBarras=t},expression:"modalCodigoBarras"}}),a("prompt-item-novo",{ref:"promptItem",attrs:{filtro:e.modalItem.filtros,habilitarQuantidade:!0},on:{selecionarItens:e.selecionarItens},model:{value:e.modalItem.visivel,callback:function(t){e.$set(e.modalItem,"visivel",t)},expression:"modalItem.visivel"}})],1)},g=[];b._withStripped=!0;var C=a("1bdf"),x=a("0e93"),q=a("3c82"),O=a("3e8a"),k=a("8149"),I=a("2ef0"),w=a("ed08"),E={documento:{},documentoItens:[],arquivo:[]},y={components:{Arquivo:C["a"],Avatar:p["a"],Badge:v["a"],Campo:h["a"],PromptCodigoBarras:x["a"],PromptItemNovo:q["a"]},computed:{erroDataHoraPrevisto:function(){if(this.checarErros&&this.dataTmp.documento.dataHoraPrevisto){var e=(new Date).setHours(0,0,0,0);if(new Date(this.dataTmp.documento.dataHoraPrevisto)<new Date(e))return"Previsão de entrega incorreta"}return""},erroDescricao:function(){return this.checarErros&&!this.dataTmp.documento.descricao?"Campo obrigatório":""},new:function(){var e=this,t=!0,a=!1,o=void 0;try{for(var r,n=this.dataTmp.documentoItens[Symbol.iterator]();!(t=(r=n.next()).done);t=!0){var i=r.value;i.descricaoAgrupamento=this.descricaoAgrupamento}}catch(e){a=!0,o=e}finally{try{t||null==n.return||n.return()}finally{if(a)throw o}}return m()({},this.data,this.dataTmp,{arquivo:this.$refs.arquivo.arquivo.map(function(t){return m()({},t,{idTabelaMaster:e.dataTmp.documento.id,tabelaMaster:"custom"})})})},readonly:function(){return"Orçamento"!==this.dataTmp.documento.status}},data:function(){return{contato:{},codigoBarras:"",checarErros:!1,dataTmp:{},descricaoAgrupamento:"",entrarCodigoBarras:!1,item:{},modalCodigoBarras:!1,modalItem:{},subTotal:{},visible:!1,valoresTabelaPreco:[],warningLabel:{}}},methods:{abrirModalCodigoBarras:function(){this.modalCodigoBarras=!0},abrirModalItem:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a,o,r,n,i,s,c,l;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a={},o=!0,r=!1,n=void 0,e.prev=4,i=this.dataTmp.documentoItens[Symbol.iterator]();case 6:if(o=(s=i.next()).done){e.next=21;break}if(c=s.value,c.idItem){e.next=10;break}return e.abrupt("continue",18);case 10:if(this.itemPrompt||(this.itemPrompt={}),this.itemPrompt[c.idItem]){e.next=15;break}return e.next=14,Object(O["a"])().item.get(c.idItem);case 14:this.itemPrompt[c.idItem]=e.sent;case 15:l=Object(w["clonarV2"])(this.itemPrompt[c.idItem]),l.novoValorVenda=c.valorReal,a[c.idItem]={item:l,quantidade:c.quantidade};case 18:o=!0,e.next=6;break;case 21:e.next=27;break;case 23:e.prev=23,e.t0=e["catch"](4),r=!0,n=e.t0;case 27:e.prev=27,e.prev=28,o||null==i.return||i.return();case 30:if(e.prev=30,!r){e.next=33;break}throw n;case 33:return e.finish(30);case 34:return e.finish(27);case 35:this.$refs.promptItem.itensSelecionados=a,this.modalItem.filtros={ativo:!0,tipo:t,idEmpresa:this.dataTmp.documento.idEmpresa,idTabelaPreco:this.dataTmp.documento.idItemTabelaPreco},this.modalItem.visivel=!0;case 38:case"end":return e.stop()}},e,this,[[4,23,27,35],[28,,30,34]])}));return function(t){return e.apply(this,arguments)}}(),buscarCodigoBarras:function(){var e=i()(regeneratorRuntime.mark(function e(t,a){var o,r,n,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=(t||"").trim().replace(/(\S+\s)|(\S+$)/g,"codigoBarras:$1$2"),t){e.next=3;break}return e.abrupt("return",a([]));case 3:return o=this.$filters,r=o.dinheiro,n=o.numero,e.next=6,k["a"].itemBusca.filtrar(t,{ativo:!0,tipo:["Produto","Serviço"]},10);case 6:if(i=e.sent,i=i.map(function(e){return{value:e.id,label:e.descricao,sublabel:"".concat(r(e.valorVenda)," | ").concat(n(e.quantidadeDisponivel)+e.unidade),stamp:e.codigoBarras,item:e}}),!this.entrarCodigoBarras||1!==i.length){e.next=10;break}return e.abrupt("return",this.selecionarItemCodigoBarras(i[0]));case 10:if("function"!==typeof a){e.next=12;break}return e.abrupt("return",a(i));case 12:this.$q.notifyError("Nenhum item foi encontrado.");case 13:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}(),prepararItem:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a,o=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(a=o.length>1&&void 0!==o[1]?o[1]:{},t){e.next=3;break}return e.abrupt("return");case 3:if(!this.item[t]){e.next=5;break}return e.abrupt("return");case 5:if(a.id){e.next=9;break}return e.next=8,k["a"].item.le({id:t});case 8:a=e.sent;case 9:a.id&&this.$set(this.item,a.id,{marca:a.marca||"",referencia:a.referencia||"",imagem:a.imagem||""});case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),calculaTotal:function(){var e=Object(w["clonarV2"])(this.dataTmp.documento),t=0,a=!0,o=!1,r=void 0;try{for(var n,i=this.dataTmp.documentoItens[Symbol.iterator]();!(a=(n=i.next()).done);a=!0){var s=n.value;t+=s.valorRealTotal}}catch(e){o=!0,r=e}finally{try{a||null==i.return||i.return()}finally{if(o)throw r}}e.subTotal=Object(w["arredondar"])(t),e.totalDocumento=e.subTotal,this.dataTmp.documento=e},calculaTotalItem:function(){var e=i()(regeneratorRuntime.mark(function e(t,a){var o,r,n,i,s,c=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(o=Object(w["clonarV2"])(this.dataTmp.documentoItens[t]),"quantidade"!==a||!this.dataTmp.documento.idItemTabelaPreco){e.next=10;break}return e.next=4,Object(O["a"])().itemTabelaPreco.get(this.dataTmp.documento.idItemTabelaPreco);case 4:if(r=e.sent,!r){e.next=10;break}return e.next=8,this.configurarValoresTabelaPreco(r,o);case 8:n=this.valoresTabelaPreco.find(function(e){return e.id===o.id}),n.quantidadeMaiorQue&&o.quantidade>=n.quantidadeMaiorQue?(o.valorOriginal!==n.valorVendaMaiorQue&&(o.valorOriginal=o.valorItem=n.valorVendaMaiorQue,o.descontoItem=o.descontoPercentualItem=0),this.warningLabel[o.id]="Valor Diferenciado"):(o.valorOriginal!==n.valorVenda&&(o.valorOriginal=o.valorItem=n.valorVenda,o.descontoItem=o.descontoPercentualItem=0),this.warningLabel[o.id]="");case 10:return o.valorItem<o.valorOriginal&&(o.valorItem=o.valorOriginal),"descontoPercentualItem"===a&&(o.descontoItem=Object(w["arredondar"])(o.descontoPercentualItem/100*o.valorItem)),["descontoItem","valorItem"].includes(a)&&(o.descontoPercentualItem=Object(w["arredondar"])(o.descontoItem/o.valorItem*100)),o.descontoItem>o.valorItem&&(o.descontoPercentualItem=o.descontoItem=0),["subTotal"].includes(a)&&(void 0!==this.subTotal[o.id]?o.descontoItem=Object(w["arredondar"])(o.valorItem-this.subTotal[o.id]):o.descontoItem=Object(w["arredondar"])(o.valorItem-o.subTotal),o.descontoPercentualItem=Object(w["arredondar"])(o.descontoItem/o.valorItem*100)),i=o.valorItem-o.descontoItem,Object(w["arredondar"])(i)>Object(w["arredondar"])(o.valorItem)&&(i=o.valorItem,o.descontoPercentualItem=o.descontoItem=0),void 0===this.subTotal[o.id]?this.$set(this.subTotal,o.id,i):this.subTotal[o.id]=i,o.subTotal=Object(w["arredondar"])(i*o.quantidade),o.total=o.subTotal,o.valorReal=Object(w["arredondar"])(i),o.valorRealTotal=o.total,e.next=24,Object(w["imposto"])(o.idItem,o.idCfop,this.dataTmp.documento.idEmpresa,this.dataTmp.documento.idContato);case 24:s=e.sent,o.valorIpi=Object(w["arredondar"])(Object(I["get"])(s,"aliqIpi",0)/100*o.valorRealTotal),o.valorIcmsSt=Object(w["arredondar"])(Object(I["get"])(s,"percIva",0)/100*o.valorRealTotal),"valorItem"===a?(this.$set(this.dataTmp.documentoItens,t,m()({},o,{valorItem:0})),this.$nextTick(function(){c.$set(c.dataTmp.documentoItens,t,o),c.calculaTotal()})):this.$set(this.dataTmp.documentoItens,t,o),this.calculaTotal();case 29:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}(),configurarValoresTabelaPreco:function(){var e=i()(regeneratorRuntime.mark(function e(t,a){var o,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(o=this.valoresTabelaPreco.find(function(e){return e.id===a.id}),!o){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,Object(O["a"])().item.get(a.idItem);case 5:return r=e.sent,e.next=8,k["a"].itemTabelaPreco.obterValores(t,r);case 8:o=e.sent,this.valoresTabelaPreco.push(m()({id:a.id},o));case 10:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}(),close:function(){var e=i()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.isEqual()){e.next=9;break}return e.prev=1,e.next=4,this.$q.dialog({cancel:"Cancelar",message:"Ao continuar você irá perder todas as modificações.",noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e["catch"](1),e.abrupt("return");case 9:this.visible=!1;case 10:case"end":return e.stop()}},e,this,[[1,6]])}));return function(){return e.apply(this,arguments)}}(),escanearCodigoBarras:function(e){this.fecharModalCodigoBarras(),this.$refs.codigoBarras.focus(),this.entrarCodigoBarras=!0,this.buscarCodigoBarras(e)},isEqual:function(){var e=m()({},E,Object(w["clonarV2"])(this.data)),t=Object(w["diferencaObjetos"])(e,this.new);return!Object.keys(t).length},leitorCodigoBarras:function(e){e.ctrlKey&&74===e.keyCode?e.preventDefault():13===e.keyCode&&(this.entrarCodigoBarras=!0)},refresh:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a,o,r,n,i,s=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:for(this.dataTmp=m()({},E,Object(w["clonarV2"])(this.data)),this.warningLabel={},this.valoresTabelaPreco=[],this.checarErros=!1,this.descricaoAgrupamento="",this.dataTmp.documentoItens.length&&(this.descricaoAgrupamento=this.dataTmp.documentoItens[0].descricaoAgrupamento),t=!0,a=!1,o=void 0,e.prev=9,r=this.dataTmp.documentoItens[Symbol.iterator]();!(t=(n=r.next()).done);t=!0)i=n.value,this.descricaoAgrupamento||(this.descricaoAgrupamento=i.descricaoAgrupamento),this.prepararItem(i.idItem),this.$set(this.subTotal,i.id,i.valorItem-i.descontoItem);e.next=17;break;case 13:e.prev=13,e.t0=e["catch"](9),a=!0,o=e.t0;case 17:e.prev=17,e.prev=18,t||null==r.return||r.return();case 20:if(e.prev=20,!a){e.next=23;break}throw o;case 23:return e.finish(20);case 24:return e.finish(17);case 25:return this.contato={codigo:"",descricao:"",imagem:""},e.next=28,k["a"].contato.le({id:this.dataTmp.documento.idContato}).then(function(e){s.contato.codigo=e.codigoContato||e.id.slice(-6)||"",s.contato.descricao=e.nome||e.apelido||"",s.contato.imagem=e.imagem||""});case 28:this.$refs.arquivo.somenteLeitura=this.readonly,this.$refs.arquivo.arquivo=this.data.arquivo,this.$nextTick(function(){s.visible=!0});case 31:case"end":return e.stop()}},e,this,[[9,13,17,25],[18,,20,24]])}));return function(){return e.apply(this,arguments)}}(),removerItem:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a=(this.dataTmp.documentoItens[t]||{}).id,this.dataTmp.documentoItens=this.dataTmp.documentoItens.filter(function(e){return e.id!==a}),this.calculaTotal();case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),save:function(){var e=this;if(this.checarErros=!0,this.erroDataHoraPrevisto||this.erroDescricao)this.$q.notifyError("Erro no preenchimento do formulário");else if(this.dataTmp.documentoItens.length){var t=!1,a=!0,o=!1,r=void 0;try{for(var n,i=function(){var a=n.value,o=e.new.documentoItens.find(function(e){return a.id===e.id});if(t=o&&o.quantidade!==a.quantidade,t)return"break"},s=this.data.documentoItens[Symbol.iterator]();!(a=(n=s.next()).done);a=!0){var c=i();if("break"===c)break}}catch(e){o=!0,r=e}finally{try{a||null==s.return||s.return()}finally{if(o)throw r}}this.isEqual()||(this.$emit("update:data",this.new),this.$emit("changed",t)),this.visible=!1}else this.$q.notifyError("Não há itens no carrinho")},selecionarItemCodigoBarras:function(e){var t=e.item;this.codigoBarras="",this.entrarCodigoBarras=!1,this.selecionarItem(t.id,t)},selecionarItens:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a,o,r=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a=regeneratorRuntime.mark(function e(a){var o,n,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return o=t[a].item||{},n=t[a].quantidade||0,i=r.dataTmp.documentoItens.findIndex(function(e){return e.idItem===a}),e.next=5,r.selecionarItem(a,o,n);case 5:-1===i&&(i=r.dataTmp.documentoItens.findIndex(function(e){return e.idItem===a}),-1!==i&&r.calculaTotalItem(i,"quantidade"));case 6:case"end":return e.stop()}},e)}),e.t0=regeneratorRuntime.keys(t);case 2:if((e.t1=e.t0()).done){e.next=7;break}return o=e.t1.value,e.delegateYield(a(o),"t2",5);case 5:e.next=2;break;case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),selecionarItem:function(){var e=i()(regeneratorRuntime.mark(function e(t,a,o){var r,n,i,s,c,l,d;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(r=this.dataTmp.documentoItens.findIndex(function(e){return e.idItem===t}),-1===r){e.next=5;break}return a.novoValorVenda!==this.dataTmp.documentoItens[r].valorOriginal&&(a.novoValorVenda<=this.dataTmp.documentoItens[r].valorOriginal?(this.dataTmp.documentoItens[r].valorItem=this.dataTmp.documentoItens[r].valorOriginal,this.dataTmp.documentoItens[r].descontoItem=Object(w["arredondar"])(this.dataTmp.documentoItens[r].valorOriginal-a.novoValorVenda)):(this.dataTmp.documentoItens[r].valorItem=a.novoValorVenda,this.dataTmp.documentoItens[r].descontoItem=0),this.calculaTotalItem(r,"descontoItem")),this.dataTmp.documentoItens[r].quantidade!==o&&(this.dataTmp.documentoItens[r].quantidade=o||1,this.calculaTotalItem(r,"quantidade")),e.abrupt("return");case 5:return e.next=7,k["a"].documentoOperacao.le({codigoDocumentoOperacao:this.dataTmp.documento.codigoDocumentoOperacao});case 7:if(n=e.sent,n||n.length){e.next=11;break}return this.$q.notify("Não foi possível localizar a Operação."),e.abrupt("return");case 11:return e.next=13,k["a"].cfop.le({id:n[0].idCfop});case 13:if(i=e.sent,i.id){e.next=17;break}return this.$q.notify("Não foi possível localizar o CFOP."),e.abrupt("return");case 17:return e.next=19,k["a"].estoqueSaldoProdutoEmpresa.le({idItem:a.id,idEmpresa:Object(I["get"])(this.dataTmp,"documento.idEmpresa",""),tipoEstoque:"Disponível"});case 19:return e.t0=function(e){return e.idItem},s=e.sent.find(e.t0),e.next=23,Object(w["imposto"])(a.id,i.id,this.dataTmp.documento.idEmpresa,this.dataTmp.documento.idContato);case 23:return c=e.sent,l=Object(w["uuid"])(),this.$set(this.subTotal,l,a.valorVenda),this.prepararItem(t,a),e.next=29,Object(w["trocarCfop"])(a.ncm,i.cfop);case 29:d=e.sent,d&&(i=d),this.dataTmp.documentoItens.push({id:l,idItem:a.id,idDocumento:this.dataTmp.documento.documentoId,idDocumentoAdicional:this.dataTmp.documento.id,codigoCfop:i.codigoCfop,codigoPlanoContaDestino:139,codigoPlanoContaEstoque:146,dataHoraEmissao:Object(w["dataAtual"])(),descontoItem:0,descontoPercentualItem:0,descontoSubTotal:0,descricaoItem:a.descricaoConcatenada,operacao:i.operacao,operacaoFator:i.fator,idCfop:i.id,quantidade:o||1,status:this.dataTmp.documento.status,subTotal:a.valorVenda,tipoItem:a.tipo,total:a.valorVenda,valorCusto:0,valorCustoMedio:Object(I["get"])(s,"valorCustoMedio",0),valorCustoReposicao:a.valorCustoReposicao||0,valorCustoUltimo:Object(I["get"])(s,"valorCusto",0),valorItem:a.valorVenda,valorItemUltimo:0,valorOriginal:a.valorVenda,valorReal:a.valorVenda,valorRealTotal:a.valorVenda,valorIpi:Object(w["arredondar"])(Object(I["get"])(c,"aliqIpi",0)/100*a.valorVenda),valorIcmsSt:Object(w["arredondar"])(Object(I["get"])(c,"percIva",0)/100*a.valorVenda)}),r=this.dataTmp.documentoItens.findIndex(function(e){return e.idItem===t}),-1!==r&&a.novoValorVenda!==this.dataTmp.documentoItens[r].valorOriginal&&(a.novoValorVenda<=this.dataTmp.documentoItens[r].valorOriginal?(this.dataTmp.documentoItens[r].valorItem=this.dataTmp.documentoItens[r].valorOriginal,this.dataTmp.documentoItens[r].descontoItem=Object(w["arredondar"])(this.dataTmp.documentoItens[r].valorOriginal-a.novoValorVenda)):(this.dataTmp.documentoItens[r].valorItem=a.novoValorVenda,this.dataTmp.documentoItens[r].descontoItem=0),this.calculaTotalItem(r,"descontoItem")),o||this.calculaTotal();case 35:case"end":return e.stop()}},e,this)}));return function(t,a,o){return e.apply(this,arguments)}}()},props:{data:{required:!0,type:Object},value:{required:!0,type:Boolean}},watch:{value:function(e){e&&this.refresh()},visible:function(e){e||this.$emit("input",e)}},created:function(){this.dataTmp=m()({},E),this.modalItem={filtros:{},visivel:!1}}},_=y,P=(a("8b34"),a("2877")),T=Object(P["a"])(_,b,g,!1,null,"b8ae9f14",null);T.options.__file="Custom.vue";var D=T.exports,j=a("5d5c"),F=a("a9d2"),S=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("q-modal",{attrs:{value:e.value,maximized:""},on:{input:e.eventoInput}},[a("q-modal-layout",{staticClass:"bg-grey-4"},[a("q-toolbar",{attrs:{slot:"header"},slot:"header"},[a("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"arrow_back"},on:{click:e.voltar}}),a("q-toolbar-title",[e._v("\n          Envelope\n        ")]),a("form",{on:{submit:function(t){return t.preventDefault(),e.salvarEnvelope(t)}}},[e.envelope.somenteLeitura?e._e():a("q-btn",{staticClass:"q-ml-sm no-shadow",attrs:{color:"white","text-color":"primary",label:"Salvar",type:"submit"}})],1)],1),a("div",{staticClass:"layout-padding row justify-center"},[a("div",{staticStyle:{width:"1280px","max-width":"90vw"}},[a("q-card",{staticClass:"q-pa-md q-px-lg q-mb-md bg-white no-shadow "},[a("q-toolbar",{staticClass:"q-pt-md",attrs:{color:"black",inverted:""}},[a("q-toolbar-title",[e._v("Dados Principais")])],1),a("div",{staticClass:"row gutter-x-sm",staticStyle:{"padding-left":"24px"}},[a("div",{staticClass:"col-lg-3 row"},[a("q-btn",{attrs:{disable:e.envelope.somenteLeitura,color:"faded",size:"lg",icon:"person_add",dense:"",flat:"",round:""},on:{click:e.abrirModalDependente}},[a("q-tooltip",[e._v("Incluir paciente")])],1),a("q-field",[a("campo",{attrs:{tipo:"texto","rotulo-fixo":"Paciente","somente-leitura":""},model:{value:e.campos.descricaoContato,callback:function(t){e.$set(e.campos,"descricaoContato",t)},expression:"campos.descricaoContato"}})],1),a("q-btn",{attrs:{disable:e.envelope.somenteLeitura,dense:"",flat:"",icon:"arrow_drop_down",color:"faded",size:"lg",round:""},on:{click:e.pacientesAtualizar}},[e.envelope.somenteLeitura?e._e():a("q-popover",[a("q-list",{attrs:{link:""}},e._l(e.pacientes,function(t){return a("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],key:t.value,nativeOn:{click:function(a){e.alterarPaciente(t.value)}}},[e._v("\n                        "+e._s(t.label)+"\n                      ")])}))],1),a("q-tooltip",[e._v("Selecionar paciente")])],1)],1),a("div",{staticClass:"col-lg-3",staticStyle:{"padding-top":"26px"}},[a("q-radio",{staticClass:"q-mr-sm",attrs:{readonly:e.envelope.somenteLeitura,label:"Óculos",val:"Oculos"},on:{input:e.alterarTipoEnvelope},model:{value:e.tipoEnvelope,callback:function(t){e.tipoEnvelope=t},expression:"tipoEnvelope"}}),a("q-radio",{attrs:{readonly:e.envelope.somenteLeitura,label:"LDC",val:"Lentes"},on:{input:e.alterarTipoEnvelope},model:{value:e.tipoEnvelope,callback:function(t){e.tipoEnvelope=t},expression:"tipoEnvelope"}},[a("q-tooltip",[e._v("Lentes de Contato")])],1)],1),a("div",{staticClass:"col-lg-3"},[a("campo",{staticClass:"col-12 col-lg-4",attrs:{maxlength:"60",rotulo:"Tipo",tipo:"seletor",opcoes:e.tipoLentes,somenteLeitura:e.envelope.somenteLeitura},model:{value:e.tipoLente,callback:function(t){e.tipoLente=t},expression:"tipoLente"}})],1),a("div",{staticClass:"col-lg-3",staticStyle:{"padding-top":"26px"}},[a("q-radio",{staticClass:"q-mr-sm",attrs:{disabled:"Oculos"!==e.tipoEnvelope,readonly:e.envelope.somenteLeitura||"Oculos"!==e.tipoEnvelope,label:"Vista",val:"Vista"},model:{value:e.tipoOculos,callback:function(t){e.tipoOculos=t},expression:"tipoOculos"}}),a("q-radio",{attrs:{disabled:"Oculos"!==e.tipoEnvelope,readonly:e.envelope.somenteLeitura||"Oculos"!==e.tipoEnvelope,label:"Solar",val:"Solar"},model:{value:e.tipoOculos,callback:function(t){e.tipoOculos=t},expression:"tipoOculos"}})],1)])],1),a("div",{staticClass:"bg-white q-mt-md q-py-sm"},[a("q-card",{staticClass:"q-pa-md q-pb-xl q-mb-md bg-white no-shadow"},[a("q-toolbar",{attrs:{color:"black",inverted:""}},[a("q-toolbar-title",[e._v("\n                  Receita\n                  ")]),e.envelope.somenteLeitura?e._e():a("q-btn",{attrs:{color:"primary",dense:"",flat:"",icon:"search",round:""},on:{click:e.filtrarReceitas}},[a("q-popover",[a("q-list",{attrs:{separator:"",link:""}},e._l(e.receitasDescricao,function(t){return a("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],key:t.value,nativeOn:{click:function(a){e.atualizarReceita(t.value)}}},[a("q-icon",{attrs:{name:t.icon,color:t.color}}),e._v("\n                        "+e._s(t.label)+"\n                        "),a("small",[e._v(e._s(t.stamp))])],1)}))],1),a("q-tooltip",[e._v("Selecionar receita")])],1),e.envelope.somenteLeitura?e._e():a("q-btn",{attrs:{color:"primary",dense:"",flat:"",icon:"add",round:""},on:{click:function(t){e.abrirModalReceita("",!1)}}},[a("q-tooltip",[e._v("Adicionar")])],1),e.envelope.somenteLeitura?e._e():a("q-btn",{attrs:{color:"primary",flat:"",icon:"camera_alt",label:"QR Code"},on:{click:e.abrirModalCodigoBarras}},[a("q-tooltip",[e._v("Incluir via QR Code")])],1),e.envelope.somenteLeitura?e._e():a("q-btn",{attrs:{color:"faded",dense:"",flat:"",icon:"more_vert",round:""}},[a("q-popover",[a("q-list",{attrs:{link:"",separator:""}},[e.receitasDescricao.length?a("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],nativeOn:{click:function(t){e.abrirModalReceita(e.receita.id,!1)}}},[a("q-item-side",{attrs:{icon:"edit"}}),a("q-item-main",{attrs:{label:"Editar"}})],1):e._e(),e.receitasDescricao.length?a("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],nativeOn:{click:function(t){e.abrirModalReceita(e.receita.id,!0)}}},[a("q-item-side",{attrs:{icon:"file_copy"}}),a("q-item-main",{attrs:{label:"Duplicar"}})],1):e._e()],1)],1)],1)],1),e.receitasDescricao.length?e._e():a("div",{staticClass:"q-pa-lg text-center"},[a("p",[e._v("Não há receitas para o paciente "+e._s(e.campos.descricaoContato)+".")]),a("p",{staticClass:"q-caption"},[e._v("Para incluir, utilize os botões acima ou insira via QR Code.")])]),e.receitasDescricao.length?a("div",{staticClass:"q-mt-lg q-px-lg row gutter-sm"},[a("div",{staticClass:"col-12 col-lg-4"},[a("span",{staticClass:"q-body-1"},[e._v("Paciente: ")]),a("strong",[e._v(e._s((e.receita.paciente||{}).nome))])]),a("div",{staticClass:"col-12 col-lg-4"},[a("span",{staticClass:"q-body-1"},[e._v("Médico: ")]),a("strong",[e._v(e._s((e.receita.medico||{}).nome))])]),a("div",{staticClass:"col-12 col-lg-2"},[a("span",{staticClass:"q-body-1"},[e._v("Data: ")]),a("strong",[e._v(e._s(e._f("data")(e.receita.data)))])]),a("div",{staticClass:"col-12 col-lg-2"},[a("span",{staticClass:"q-body-1"},[e._v("Validade: ")]),a("strong",[e._v(e._s(e._f("data")(e.receita.validade)))])]),e.receita.observacoes?a("div",{staticClass:"col-12"},[a("strong",{staticClass:"q-body-1"},[e._v("Observação:")]),a("p",[e._v(e._s(e.receita.observacoes))])]):e._e()]):e._e(),e.receitasDescricao.length?a("div",{staticClass:"row q-ma-lg"},[a("q-list",{staticClass:"col-12 col-lg-6 q-pa-none",attrs:{highlight:"","no-border":""}},[a("q-item",{staticClass:"q-px-none"},[a("q-item-side"),a("q-item-main",{staticClass:"q-title"},[e._v("Longe")])],1),a("q-item",{staticClass:"q-px-none"},[a("q-item-side"),a("q-item-main",{staticClass:"q-body-2 row"},[a("div",{staticClass:"col u-elipse"},[e._v("Esférico")]),a("div",{staticClass:"col u-elipse"},[e._v("Cilindrico")]),a("div",{staticClass:"col u-elipse"},[e._v("Eixo")]),a("div",{staticClass:"col u-elipse"},[e._v("DNP")])])],1),a("q-item",{staticClass:"q-px-none"},[a("q-item-side",[a("q-item-tile",[e._v("OD")])],1),a("q-item-main",{staticClass:"row"},[a("div",{staticClass:"col"},[e._v("\n                        "+e._s(e._f("numeroSinal")(((((e.receita.prescricao||{}).dioptria||{}).od||{}).longe||{}).esferico,2))+"\n                      ")]),a("div",{staticClass:"col"},[e._v("\n                        "+e._s(e._f("numeroSinal")(((((e.receita.prescricao||{}).dioptria||{}).od||{}).longe||{}).cilindrico,2))+"\n                      ")]),a("div",{staticClass:"col"},[e._v("\n                        "+e._s(e._f("numero")(((((e.receita.prescricao||{}).dioptria||{}).od||{}).longe||{}).eixo)))]),a("div",{staticClass:"col"},[e._v("\n                        "+e._s(e._f("numero")(((((e.receita.prescricao||{}).dioptria||{}).od||{}).longe||{}).dnp,2))+"\n                      ")])])],1),a("q-item",{staticClass:"q-px-none"},[a("q-item-side",[a("q-item-tile",[e._v("OE")])],1),a("q-item-main",{staticClass:"row"},[a("div",{staticClass:"col"},[e._v("\n                        "+e._s(e._f("numeroSinal")(((((e.receita.prescricao||{}).dioptria||{}).oe||{}).longe||{}).esferico,2))+"\n                      ")]),a("div",{staticClass:"col"},[e._v("\n                        "+e._s(e._f("numeroSinal")(((((e.receita.prescricao||{}).dioptria||{}).oe||{}).longe||{}).cilindrico,2))+"\n                      ")]),a("div",{staticClass:"col"},[e._v("\n                        "+e._s(e._f("numero")(((((e.receita.prescricao||{}).dioptria||{}).oe||{}).longe||{}).eixo)))]),a("div",{staticClass:"col"},[e._v("\n                        "+e._s(e._f("numero")(((((e.receita.prescricao||{}).dioptria||{}).oe||{}).longe||{}).dnp,2))+"\n                      ")])])],1)],1),a("q-list",{staticClass:"col-12 col-lg-6 q-pa-none",attrs:{highlight:"","no-border":""}},[a("q-item",{staticClass:"q-px-none"},[a("q-item-side"),a("q-item-main",{staticClass:"q-title row"},[a("div",{staticClass:"col"},[e._v("Médio")]),a("div",{staticClass:"col"},[e._v("Perto")])])],1),a("q-item",{staticClass:"q-px-none"},[a("q-item-side"),a("q-item-main",{staticClass:"q-body-2 row"},[a("div",{staticClass:"col u-elipse"},[e._v("Adição")]),a("div",{staticClass:"col u-elipse"},[e._v("DNP")]),a("div",{staticClass:"col u-elipse"},[e._v("Adição")]),a("div",{staticClass:"col u-elipse"},[e._v("DNP")])])],1),a("q-item",{staticClass:"q-px-none"},[a("q-item-side",[a("q-item-tile",[e._v("OD")])],1),a("q-item-main",{staticClass:"row"},[a("div",{staticClass:"col"},[e._v("\n                        "+e._s(e._f("numeroSinal")(((((e.receita.prescricao||{}).dioptria||{}).od||{}).medio||{}).esferico,2))+"\n                      ")]),a("div",{staticClass:"col"},[e._v("\n                        "+e._s(e._f("numero")(((((e.receita.prescricao||{}).dioptria||{}).od||{}).medio||{}).dnp,2))+"\n                      ")]),a("div",{staticClass:"col"},[e._v("\n                        "+e._s(e._f("numeroSinal")(((((e.receita.prescricao||{}).dioptria||{}).od||{}).perto||{}).esferico,2))+"\n                      ")]),a("div",{staticClass:"col"},[e._v("\n                        "+e._s(e._f("numero")(((((e.receita.prescricao||{}).dioptria||{}).od||{}).perto||{}).dnp,2))+"\n                      ")])])],1),a("q-item",{staticClass:"q-px-none"},[a("q-item-side",[a("q-item-tile",[e._v("OE")])],1),a("q-item-main",{staticClass:"row"},[a("div",{staticClass:"col"},[e._v("\n                        "+e._s(e._f("numeroSinal")(((((e.receita.prescricao||{}).dioptria||{}).oe||{}).medio||{}).esferico,2))+"\n                      ")]),a("div",{staticClass:"col"},[e._v("\n                        "+e._s(e._f("numero")(((((e.receita.prescricao||{}).dioptria||{}).oe||{}).medio||{}).dnp,2))+"\n                      ")]),a("div",{staticClass:"col"},[e._v("\n                        "+e._s(e._f("numeroSinal")(((((e.receita.prescricao||{}).dioptria||{}).oe||{}).perto||{}).esferico,2))+"\n                      ")]),a("div",{staticClass:"col"},[e._v("\n                        "+e._s(e._f("numero")(((((e.receita.prescricao||{}).dioptria||{}).oe||{}).perto||{}).dnp,2))+"\n                      ")])])],1)],1)],1):e._e()],1)],1),a("div",{staticClass:"bg-white q-mt-md q-py-sm"},[a("q-card",{staticClass:"q-pa-md q-pb-xl q-mb-md bg-white no-shadow "},[a("q-toolbar",{staticClass:"q-pt-md",attrs:{color:"black",inverted:""}},[a("q-toolbar-title",[e._v("Imagens")])],1),a("div",{staticClass:"row gutter-x-sm",staticStyle:{padding:"0 24px"}},[a("div",{staticClass:"col-12 "},[a("arquivo",{ref:"arquivo"})],1)])],1)],1),a("div",{staticClass:"bg-white q-mt-md q-py-sm"},[a("q-card",{staticClass:"q-pa-md q-pb-xl q-mb-md bg-white no-shadow "},[a("q-toolbar",{staticClass:"q-pt-md",attrs:{color:"black",inverted:""}},[a("q-toolbar-title",[e._v("Itens")]),e.envelope.somenteLeitura||"Lentes"!==e.tipoEnvelope?e._e():a("q-btn",{attrs:{color:"primary",flat:"",icon:"add",label:"Lentes de Contato"},on:{click:function(t){e.abrirModalItem("LentesContato")}}}),!e.envelope.somenteLeitura&&"Oculos"===e.tipoEnvelope&&["Vista","Solar"].includes(e.tipoOculos)?a("q-btn",{attrs:{color:"primary",flat:"",icon:"add",label:"Lentes"},on:{click:function(t){e.abrirModalItem("Lentes")}}}):e._e(),!e.envelope.somenteLeitura&&"Oculos"===e.tipoEnvelope&&["Vista","Solar"].includes(e.tipoOculos)?a("q-btn",{attrs:{color:"primary",flat:"",icon:"add",label:"Armação"},on:{click:function(t){e.abrirModalItem("Armacao")}}}):e._e()],1),!e.envelope.somenteLeitura&&("Lentes"===e.tipoEnvelope||"Oculos"===e.tipoEnvelope&&["Vista","Solar"].includes(e.tipoOculos))?a("q-field",{staticClass:"q-mx-lg"},[a("q-input",{ref:"codigoBarras",attrs:{after:[{icon:"photo_camera",handler:e.abrirModalCodigoBarras}],before:[{icon:"line_weight"}],color:"light","inverted-light":"","float-label":"Código de barras"},on:{keydown:e.leitorCodigoBarras},model:{value:e.codigoBarras,callback:function(t){e.codigoBarras=t},expression:"codigoBarras"}},[a("q-autocomplete",{attrs:{"min-characters":3},on:{search:e.buscarCodigoBarras,selected:e.selecionarItemCodigoBarras}})],1)],1):e._e(),e.carrinho.length?e._l(e.carrinhoSemArmacaoVazia,function(t,o){return a("div",{key:o,staticClass:"items-start gutter-x-sm q-pa-lg row"},[a("div",{staticClass:"col-12 col-sm-3"},[a("avatar",{attrs:{imagem:(e.itens[t.idItem]||{}).imagem||"",rotulo:t.descricaoItem,tamanho:"120"}})],1),a("div",{staticClass:"col-12 col-sm-9"},[a("q-toolbar",{staticClass:"Venda-itemBarra bg-transparent q-pa-none",attrs:{color:"black",inverted:""}},[a("q-toolbar-title",{staticClass:"q-pl-none"},[e._v("\n                      "+e._s(t.descricaoItem)+"\n                      "),a("span",{attrs:{slot:"subtitle"},slot:"subtitle"},[e._v(e._s((e.itens[t.idItem]||{}).marca||""))])]),a("badge",{staticClass:"q-mr-sm"},[e._v(e._s(t.tipoItem)+" "+e._s((e.itens[t.idItem]||{}).referencia||"")+"\n                    ")]),e.envelope.somenteLeitura?e._e():a("q-btn",{attrs:{color:"faded",dense:"",flat:"",icon:"delete",round:""},on:{click:function(t){e.removerItem(o)}}})],1),a("div",{staticClass:"gutter-sm row"},[a("campo",{staticClass:"col-6 col-sm-3",attrs:{somenteLeitura:e.envelope.somenteLeitura,"class-campo":"u-campoCompacto","rotulo-fixo":"Valor",tipo:"decimal",decimals:"2"},on:{blur:function(t){e.calculaTotalItem(o,"valorItem")}},model:{value:t.valorItem,callback:function(a){e.$set(t,"valorItem",a)},expression:"item.valorItem"}}),a("campo",{staticClass:"col-6 col-sm-3",attrs:{somenteLeitura:e.envelope.somenteLeitura,"class-campo":"u-campoCompacto",opcoes:{maximumValue:100},"rotulo-fixo":"Desconto",tipo:"decimal",decimals:"2",suffix:"%"},on:{blur:function(t){e.calculaTotalItem(o,"descontoPercentualItem")}},model:{value:t.descontoPercentualItem,callback:function(a){e.$set(t,"descontoPercentualItem",a)},expression:"item.descontoPercentualItem"}}),a("campo",{staticClass:"col-6 col-sm-3",attrs:{somenteLeitura:e.envelope.somenteLeitura,"class-campo":"u-campoCompacto",opcoes:{minimumValue:0},"rotulo-fixo":"Desconto",tipo:"decimal",decimals:"2"},on:{blur:function(t){e.calculaTotalItem(o,"descontoItem")}},model:{value:t.descontoItem,callback:function(a){e.$set(t,"descontoItem",a)},expression:"item.descontoItem"}}),a("campo",{staticClass:"col-6 col-sm-3",attrs:{somenteLeitura:e.envelope.somenteLeitura,"class-campo":"u-campoCompacto","hide-underline":"","somente-leitura":"","rotulo-fixo":"Total",tipo:"decimal",decimals:"2"},model:{value:t.total,callback:function(a){e.$set(t,"total",a)},expression:"item.total"}})],1),a("div",{staticClass:"gutter-sm row justify-end q-mt-sm"},[e.envelope.somenteLeitura||"LOE"!==t.tipoItem?e._e():a("q-btn",{attrs:{color:"primary",flat:"",icon:"add",label:"Tratamento LOE"},on:{click:function(a){e.abrirModalItem("Tratamento LOE",t.id)}}}),e.envelope.somenteLeitura||"LOD"!==t.tipoItem?e._e():a("q-btn",{attrs:{color:"primary",flat:"",icon:"add",label:"Tratamento LOD"},on:{click:function(a){e.abrirModalItem("Tratamento LOD",t.id)}}})],1)],1)])}):a("div",{staticClass:"q-pa-lg text-center"},[a("p",[e._v("Não há itens no carrinho")]),a("p",{staticClass:"q-caption"},[e._v("Para adicionar, utilize os botões acima ou insira o código de barras")])])],2)],1),a("div",{staticClass:"bg-white q-mt-md q-py-sm"},[a("q-card",{staticClass:"q-pa-lg q-mb-md bg-white no-shadow "},[a("div",{staticClass:"gutter-x-sm row"},[a("div",{staticClass:"col-12 col-lg-4"},[a("campo",{attrs:{"somente-leitura":e.envelope.somenteLeitura,tipo:"decimal",decimals:"2",rotulo:"Diagonal"},model:{value:e.armacao.diagonal,callback:function(t){e.$set(e.armacao,"diagonal",t)},expression:"armacao.diagonal"}}),a("campo",{attrs:{"somente-leitura":e.envelope.somenteLeitura,tipo:"decimal",decimals:"2",rotulo:"Ponte"},model:{value:e.armacao.ponte,callback:function(t){e.$set(e.armacao,"ponte",t)},expression:"armacao.ponte"}}),a("campo",{attrs:{"somente-leitura":e.envelope.somenteLeitura,tipo:"decimal",decimals:"2",rotulo:"Altura Vertical"},model:{value:e.armacao.altura,callback:function(t){e.$set(e.armacao,"altura",t)},expression:"armacao.altura"}}),a("campo",{attrs:{"somente-leitura":e.envelope.somenteLeitura,rotulo:"Largura",tipo:"decimal",decimals:"2"},model:{value:e.armacao.largura,callback:function(t){e.$set(e.armacao,"largura",t)},expression:"armacao.largura"}}),a("campo",{staticClass:"col-12 col-sm-4",attrs:{"somente-leitura":e.envelope.somenteLeitura,after:[{icon:"add_circle",handler:function(){e.abrirArmacaoMaterialModal()}}],opcoes:e.opcoesArmacaoMaterial,"rotulo-fixo":"Material",tipo:"seletor"},model:{value:e.armacao.armacaoMaterial,callback:function(t){e.$set(e.armacao,"armacaoMaterial",t)},expression:"armacao.armacaoMaterial"}}),a("campo",{staticClass:"col-12 col-sm-4",attrs:{"somente-leitura":e.envelope.somenteLeitura,after:[{icon:"add_circle",handler:function(){e.abrirTipoMontagemModal()}}],opcoes:e.opcoesTipoMontagem,"rotulo-fixo":"Tipo Montagem",tipo:"seletor"},model:{value:e.armacao.tipoMontagem,callback:function(t){e.$set(e.armacao,"tipoMontagem",t)},expression:"armacao.tipoMontagem"}})],1),a("div",{staticClass:"col-12 col-lg-4"},[e.permissaoPupilometro?a("q-btn",{attrs:{label:"Pupilômetro",icon:"mdi-eye-settings-outline",color:"primary"},on:{click:function(t){e.abrirModalPupilometro()}}}):e._e(),a("q-btn",{attrs:{icon:"help_outline",color:"primary",flat:"",dense:"",round:"",size:"lg"},on:{click:function(t){e.help.show=!e.help.show}}}),a("campo",{attrs:{"somente-leitura":e.envelope.somenteLeitura,rotulo:"Alt. Mont. OD",tipo:"decimal",decimals:"2"},model:{value:e.armacao.alturaMontagemOD,callback:function(t){e.$set(e.armacao,"alturaMontagemOD",t)},expression:"armacao.alturaMontagemOD"}}),a("campo",{attrs:{"somente-leitura":e.envelope.somenteLeitura,rotulo:"Alt. Mont. OE",tipo:"decimal",decimals:"2"},model:{value:e.armacao.alturaMontagemOE,callback:function(t){e.$set(e.armacao,"alturaMontagemOE",t)},expression:"armacao.alturaMontagemOE"}}),a("campo",{staticClass:"col-12 col-sm-4",attrs:{"somente-leitura":e.envelope.somenteLeitura,value:e.descricaoLaboratorio,before:[{icon:"search",handler:e.abrirModalLaboratorio}],readonly:"",rotulo:"Laboratório"},on:{click:e.abrirModalLaboratorio}}),a("campo",{staticClass:"col-12 col-sm-4",attrs:{"somente-leitura":e.envelope.somenteLeitura,value:e.descricaoResponsavel,before:[{icon:"search",handler:e.abrirModalResponsavel}],readonly:"",rotulo:"Responsável"},on:{click:e.abrirModalResponsavel}}),a("campo",{attrs:{maxlength:"10",rotulo:"Previsão de Entrega",tipo:"data",erro:!!e.erroDataHoraPrevisto,"erro-rotulo":e.erroDataHoraPrevisto},model:{value:e.campos.dataHoraPrevisto,callback:function(t){e.$set(e.campos,"dataHoraPrevisto",t)},expression:"campos.dataHoraPrevisto"}})],1),a("div",{staticClass:"col-12 col-lg-4 q-mt-md"},[a("div",{staticClass:"row gutter-x-sm"},[a("div",{staticClass:"col-4"},[e._v("Subtotal")]),a("strong",{staticClass:"col-8 text-right"},[e._v(e._s(e._f("numero")(e.campos.subTotal,2)))]),a("div",{staticClass:"col-4",staticStyle:{"padding-top":"16px"}},[e._v("Desconto")]),a("campo",{staticClass:"col-3",attrs:{"somente-leitura":e.envelope.somenteLeitura,"class-campo":"u-campoCompacto",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",suffix:"%"},on:{blur:function(t){e.calculaTotal("descontoPercentual")}},model:{value:e.campos.totalPercentualDesconto,callback:function(t){e.$set(e.campos,"totalPercentualDesconto",t)},expression:"campos.totalPercentualDesconto"}}),a("campo",{staticClass:"col-5",attrs:{"somente-leitura":e.envelope.somenteLeitura,"class-campo":"u-campoCompacto",opcoes:{minimumValue:0},tipo:"decimal",decimals:"2"},on:{blur:function(t){e.calculaTotal("desconto")}},model:{value:e.campos.totalDesconto,callback:function(t){e.$set(e.campos,"totalDesconto",t)},expression:"campos.totalDesconto"}}),a("div",{staticClass:"col-4 q-mt-sm",staticStyle:{"padding-top":"8px"}},[e._v("Total")]),a("strong",{staticClass:"col-8 q-mt-sm text-right",staticStyle:{"padding-top":"8px"}},[e._v(e._s(e._f("numero")(e.campos.totalDocumento,2)))])],1)])])])],1)],1)])],1)],1),a("q-modal",{attrs:{"content-css":{minWidth:"100vw",minHeight:"100vh"}},model:{value:e.help.show,callback:function(t){e.$set(e.help,"show",t)},expression:"help.show"}},[a("q-modal-layout",{staticStyle:{height:"100vh",width:"100vw"}},[a("iframe",{staticStyle:{height:"100%",width:"100%"},attrs:{src:e.help.src,frameborder:"0",allow:"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""}}),a("q-toolbar",{attrs:{slot:"header"},slot:"header"},[a("q-toolbar-title",[e._v(e._s(e.help.title))]),a("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"close",round:""}})],1)],1)],1),a("q-modal",{model:{value:e.armacaoMaterialModal,callback:function(t){e.armacaoMaterialModal=t},expression:"armacaoMaterialModal"}},[a("div",{staticClass:"q-ma-sm"},[a("form",{on:{submit:function(t){return t.preventDefault(),e.criarArmacaoMaterial(t)}}},[a("div",{staticClass:"q-ma-md"},[a("div",{staticClass:"row q-headline text-weight-bold"},[e._v("Cadastrar Material")]),a("campo",{staticClass:"row",attrs:{maxlength:"60",rotulo:"Material"},model:{value:e.armacaoMaterialDescricao,callback:function(t){e.armacaoMaterialDescricao="string"===typeof t?t.trim():t},expression:"armacaoMaterialDescricao"}})],1),a("div",{staticClass:"row justify-end"},[a("q-btn",{attrs:{flat:"",color:"primary",label:"Cancelar"},on:{click:function(t){e.armacaoMaterialModal=!1}}}),a("q-btn",{attrs:{flat:"",color:"primary",type:"submit",label:"Criar"}})],1)])])]),a("q-modal",{model:{value:e.tipoMontagemModal,callback:function(t){e.tipoMontagemModal=t},expression:"tipoMontagemModal"}},[a("div",{staticClass:"q-ma-sm"},[a("form",{on:{submit:function(t){return t.preventDefault(),e.criarTipoMontagem(t)}}},[a("div",{staticClass:"q-ma-md"},[a("div",{staticClass:"row q-headline text-weight-bold"},[e._v("Cadastrar Tipo Montagem")]),a("campo",{staticClass:"row",attrs:{maxlength:"60",rotulo:"Tipo Montagem"},model:{value:e.tipoMontagemDescricao,callback:function(t){e.tipoMontagemDescricao="string"===typeof t?t.trim():t},expression:"tipoMontagemDescricao"}})],1),a("div",{staticClass:"row justify-end"},[a("q-btn",{attrs:{flat:"",color:"primary",label:"Cancelar"},on:{click:function(t){e.tipoMontagemModal=!1}}}),a("q-btn",{attrs:{flat:"",color:"primary",type:"submit",label:"Criar"}})],1)])])]),e.modalPupilometro.ativo?a("q-modal",{attrs:{maximized:""},on:{hide:function(t){e.fecharModalPupilometro()}},model:{value:e.modalPupilometro.visivel,callback:function(t){e.$set(e.modalPupilometro,"visivel",t)},expression:"modalPupilometro.visivel"}},[a("q-modal-layout",[a("pupilometro",{attrs:{avancar:e.modalPupilometro.avancar,somenteLeitura:e.envelope.somenteLeitura},on:{fecharModal:function(t){e.fecharModalPupilometro()}}})],1)],1):e._e(),a("contato-criar",{attrs:{"cpf-cnpj":"","data-nascimento":"","msg-erro":"Ocorreu um erro ao incluir o paciente.","msg-sucesso":"Paciente incluído com sucesso.",titulo:"Incluir Paciente",observacao:""},on:{pronto:e.criarDependencia},model:{value:e.modalDependente,callback:function(t){e.modalDependente=t},expression:"modalDependente"}}),a("prompt-item-novo",{attrs:{filtro:e.modalItem.filtros},on:{selecionarItens:e.selecionarItens},model:{value:e.modalItem.visivel,callback:function(t){e.$set(e.modalItem,"visivel",t)},expression:"modalItem.visivel"}}),a("prompt-codigo-barras",{on:{escanear:e.escanearCodigoBarras},model:{value:e.modalCodigoBarras,callback:function(t){e.modalCodigoBarras=t},expression:"modalCodigoBarras"}}),a("receita",{attrs:{id:e.modalReceita.id,idEmpresa:e.modalReceita.idEmpresa,duplicarReceita:e.modalReceita.duplicar},on:{atualizar:function(t){e.atualizarReceita(e.modalReceita.id)}},model:{value:e.modalReceita.visivel,callback:function(t){e.$set(e.modalReceita,"visivel",t)},expression:"modalReceita.visivel"}}),a("prompt-contato-novo",{attrs:{filtro:{ativo:!0,segmento:"Laboratório"}},on:{selecionar:e.selecionarLaboratorio},model:{value:e.modalLaboratorio,callback:function(t){e.modalLaboratorio=t},expression:"modalLaboratorio"}}),a("prompt-contato-novo",{attrs:{filtro:{ativo:!0,vendedores:!0}},on:{selecionar:e.selecionarResponsavel},model:{value:e.modalResponsavel,callback:function(t){e.modalResponsavel=t},expression:"modalResponsavel"}})],1)},R=[];S._withStripped=!0;a("7cdf"),a("3b2b"),a("28a5"),a("55dd"),a("4f7f");var N=a("68db"),V=a("41ff"),$=a("e38f1"),M=a("4e44"),A=a("f490"),B={components:{Arquivo:C["a"],Avatar:p["a"],Badge:v["a"],Campo:h["a"],ContatoCriar:N["a"],PromptCodigoBarras:x["a"],PromptContatoNovo:V["a"],PromptItemNovo:q["a"],Pupilometro:M["default"],Receita:$["a"]},computed:{carrinhoSemArmacaoVazia:function(){return this.carrinho.filter(function(e){return!("Armação"===e.tipoItem&&!e.descricaoItem.trim()&&0===e.total&&0===e.valorItem)})},envelopeVazio:function(){return{id:"",idDocumentoAdicional:"",docId:"",docTipo:"",carrinho:[],totalDesconto:0,totalPercentualDesconto:0,subTotal:0,totalDocumento:0,paciente:{id:"",nome:""},tipo:"Envelope",tipoEnvelope:"Oculos",tipoLente:"Multifocal (Longe e Perto)",tipoOculos:"Vista"}},erroDataHoraPrevisto:function(){if(this.campos.dataHoraPrevisto){var e=(new Date).setHours(0,0,0,0);if(new Date(this.campos.dataHoraPrevisto)<new Date(e))return"Previsão de entrega não pode ser menor do que a data de hoje"}return""}},data:function(){return{armacao:{alturaMontagemOD:0,alturaMontagemOE:0,diagonal:0,ponte:0,altura:0,tamanho:"",armacaoMaterial:"",tipoMontagem:""},armacaoMaterialModal:!1,armacaoMaterialDescricao:"",opcoesArmacaoMaterial:[],tipoMontagemModal:!1,tipoMontagemDescricao:"",opcoesTipoMontagem:[],campos:{totalDesconto:0,totalPercentualDesconto:0,subTotal:0,totalDocumento:0,idContato:"",descricaoContato:"",idDocumentoAdicional:"",dataHoraPrevisto:""},tipo:"Envelope",tipoEnvelope:"Oculos",tipoLente:"Multifocal (Longe e Perto)",tipoOculos:"Vista",carrinho:[],documentoContato:[],codigoBarras:"",duplicarReceita:!1,entrarCodigoBarras:!1,idPacienteSelecionado:"",descricaoReceitaSelecionada:"",modalCodigoBarras:!1,modalDependente:!1,modalItem:{visivel:!1,filtros:{}},modalPupilometro:{},permissaoPupilometro:!1,modalLaboratorio:!1,descricaoLaboratorio:"",documentoContatoLaboratorio:{},modalResponsavel:!1,descricaoResponsavel:"",itensTipo:[],itens:{},tipoDescontoPercentagem:!0,tipoDescontoTotal:!0,pacientes:[{label:"",value:""}],tipoLentes:[],tipoLentesOculos:["Monofocal (Longe)","Monofocal (Médio)","Monofocal (Perto)","Bifocal (Longe e Perto)","Multifocal (Longe e Perto)","Intermediário (Médio e Perto)","Intermediário (Longe e Médio)"],tipoLentesContato:["Monofocal (Longe)","Bifocal (Longe e Perto)","Multifocal (Longe e Perto)"],receita:{},receitasDescricao:[],modalReceita:{visivel:!1,id:"",idEmpresa:"",duplicar:!1},arquivo:[],help:{show:!1,src:this.$q.platform.is.mobile?"https://www.youtube.com/embed/kYy9IE16bkA?start=2661":"https://www.youtube.com/embed/kYy9IE16bkA?start=1214",title:this.$q.platform.is.mobile?"Videoaula OptiSoul: Pupilômetro - Celular":"Videoaula OptiSoul: Pupilômetro - Desktop"}}},methods:{fecharModalPupilometro:function(){var e=this;if(this.modalPupilometro.visivel=!1,this.$nextTick(function(){e.modalPupilometro.ativo=!1}),"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAQAAAAkGDomAAAATklEQVR42u3OMQEAAAgDINc/9Czh4QEJSDuvRVBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUPDSAovln7Gzmi7KAAAAAElFTkSuQmCC"!==k["a"].pupilometro.fotoOriginal){var t={id:(this.modalPupilometro.pupilometroAtual||{}).id||Object(w["uuid"])(),descricao:"Pupilômetro",referencia:"idEnvelope:"+this.campos.id,json:JSON.stringify({foto:k["a"].pupilometro.foto,fotoOriginal:k["a"].pupilometro.fotoOriginal,medidas:k["a"].pupilometro.medidas})};this.modalPupilometro.pupilometroAtual=t,this.armacao.largura=k["a"].pupilometro.medidas.tamanhoArmacao,this.armacao.ponte=k["a"].pupilometro.medidas.ponte,this.armacao.altura=k["a"].pupilometro.medidas.alturaArmacao,this.armacao.diagonal=k["a"].pupilometro.medidas.diagonal.distancia,k["a"].pupilometro.medidas.bifocal?(this.armacao.alturaMontagemOD=k["a"].pupilometro.medidas.bifocalOlhoDireito,this.armacao.alturaMontagemOE=k["a"].pupilometro.medidas.bifocalOlhoEsquerdo):(this.armacao.alturaMontagemOD=k["a"].pupilometro.medidas.dip.od.altura,this.armacao.alturaMontagemOE=k["a"].pupilometro.medidas.dip.oe.altura),this.salvarDnp()}},abrirModalPupilometro:function(){var e=this;if(this.modalPupilometro=m()({},this.modalPupilometro,{ativo:!0,visivel:!1,avancar:this.envelope.somenteLeitura?"Medidas":""}),k["a"].pupilometro.limpar(),this.armacao.largura&&(k["a"].pupilometro.medidas.tamanhoArmacao=this.armacao.largura),this.armacao.ponte&&(k["a"].pupilometro.medidas.ponte=this.armacao.ponte),this.armacao.diagonal&&(k["a"].pupilometro.medidas.diagonal.distancia=this.armacao.diagonal),this.armacao.altura&&(k["a"].pupilometro.medidas.alturaArmacao=this.armacao.altura),(this.modalPupilometro.pupilometroAtual||{}).json){var t=JSON.parse(this.modalPupilometro.pupilometroAtual.json);k["a"].pupilometro.foto=t.foto,k["a"].pupilometro.fotoOriginal=t.fotoOriginal,k["a"].pupilometro.medidas=t.medidas,this.armacao.largura&&(k["a"].pupilometro.medidas.tamanhoArmacao=this.armacao.largura),this.armacao.ponte&&(k["a"].pupilometro.medidas.ponte=this.armacao.ponte),this.armacao.diagonal&&(k["a"].pupilometro.medidas.diagonal.distancia=this.armacao.diagonal),this.envelope.somenteLeitura||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAQAAAAkGDomAAAATklEQVR42u3OMQEAAAgDINc/9Czh4QEJSDuvRVBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUPDSAovln7Gzmi7KAAAAAElFTkSuQmCC"!==k["a"].pupilometro.foto?this.modalPupilometro.avancar="Medidas":this.modalPupilometro.avancar="TirarFoto"}this.$nextTick(function(){e.modalPupilometro.visivel=!0})},adicionaArquivo:function(e){var t=this,a=!0,o=!1,r=void 0;try{for(var n,i=e[Symbol.iterator]();!(a=(n=i.next()).done);a=!0){var s=n.value;this.$resizeImage(s,{outputFormat:"jpg"},function(e,a){t.arquivo.push({id:Object(w["uuid"])(),tabelaMaster:"envelope",idTabelaMaster:t.envelope.id,arquivo:a})})}}catch(e){o=!0,r=e}finally{try{a||null==i.return||i.return()}finally{if(o)throw r}}},removeArquivo:function(e){},abrirArmacaoMaterialModal:function(){this.envelope.somenteLeitura||(this.armacaoMaterialModal=!0)},abrirTipoMontagemModal:function(){this.envelope.somenteLeitura||(this.tipoMontagemModal=!0)},atualizarArmacaoMaterial:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a,o,r,n,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=[],a=[],e.next=3,k["a"].itemBusca.filtrar(null,{ativo:!0,tipo:["Óculos Sol","Armação"]},0);case 3:for(t=e.sent,a=t.filter(function(e){return(e.armacaoMaterial||"").trim()}).map(function(e){return e.armacaoMaterial}),o=[],r=d()(new Set(a)),n=0;n<r.length;n++)i=r[n],o.push({rotulo:i,valor:i,sort:i.toLowerCase()});this.opcoesArmacaoMaterial=Object(I["orderBy"])(o,"sort","asc");case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),atualizarTipoMontagem:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a,o,r,n,i,s,c,l;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=[],a=[],e.next=3,k["a"].itemBusca.filtrar(null,{ativo:!0,tipo:["Óculos Sol","Armação"]},0);case 3:for(t=e.sent,a=t.filter(function(e){return(e.tipoMontagem||"").trim()}).map(function(e){return e.tipoMontagem}),o=[],r=!0,n=!1,i=void 0,e.prev=9,s=new Set(a)[Symbol.iterator]();!(r=(c=s.next()).done);r=!0)l=c.value,o.push({rotulo:l,valor:l,sort:l.toLowerCase()});e.next=17;break;case 13:e.prev=13,e.t0=e["catch"](9),n=!0,i=e.t0;case 17:e.prev=17,e.prev=18,r||null==s.return||s.return();case 20:if(e.prev=20,!n){e.next=23;break}throw i;case 23:return e.finish(20);case 24:return e.finish(17);case 25:this.opcoesTipoMontagem=Object(I["orderBy"])(o,"sort","asc");case 26:case"end":return e.stop()}},e,this,[[9,13,17,25],[18,,20,24]])}));return function(){return e.apply(this,arguments)}}(),criarArmacaoMaterial:function(){var e=i()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.opcoesArmacaoMaterial=Object(I["orderBy"])(d()(this.opcoesArmacaoMaterial).concat([{rotulo:this.armacaoMaterialDescricao,valor:this.armacaoMaterialDescricao,sort:this.armacaoMaterialDescricao.toLowerCase()}]),"sort","asc"),this.armacao.armacaoMaterial=this.armacaoMaterialDescricao,this.armacaoMaterialModal=!1;case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),criarTipoMontagem:function(){var e=i()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.opcoesTipoMontagem=Object(I["orderBy"])(d()(this.opcoesTipoMontagem).concat([{rotulo:this.tipoMontagemDescricao,valor:this.tipoMontagemDescricao,sort:this.tipoMontagemDescricao.toLowerCase()}]),"sort","asc"),this.armacao.tipoMontagem=this.tipoMontagemDescricao,this.tipoMontagemModal=!1;case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),selecionarLaboratorio:function(){var e=i()(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.documentoContatoLaboratorio.idContato=t,e.next=3,k["a"].contato.le({id:t});case 3:if(e.t0=e.sent.apelido,e.t0){e.next=6;break}e.t0="";case 6:this.descricaoLaboratorio=e.t0;case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),abrirModalLaboratorio:function(){var e=i()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.envelope.somenteLeitura||(this.modalLaboratorio=!0);case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),selecionarResponsavel:function(){var e=i()(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.campos.idContatoResponsavel=t,e.next=3,k["a"].contato.le({id:t});case 3:if(e.t0=e.sent.apelido,e.t0){e.next=6;break}e.t0="";case 6:this.descricaoResponsavel=e.t0;case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),abrirModalResponsavel:function(){var e=i()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.envelope.somenteLeitura||(this.modalResponsavel=!0);case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),alterarPaciente:function(){var e=i()(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.campos.idContato=t,this.campos.descricaoContato=this.pacientes.filter(function(e){return e.value===t})[0].label,e.next=4,this.filtrarReceitas();case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),atualizarReceita:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.filtrarReceitas();case 2:if(t||this.receitasDescricao.length&&(t=this.receitasDescricao[0].value),!t){e.next=11;break}return e.next=6,k["a"].receita.le({id:t||this.receita.id});case 6:return this.receita=e.sent,e.next=9,this.pacientesAtualizar();case 9:this.campos.idContato=this.receita.paciente.id,this.campos.descricaoContato=this.pacientes.filter(function(e){return e.value===a.campos.idContato})[0].label;case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),calculaTotal:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a,o,r,n,i,s,c,l,d,u,m,p,v,h,f,b,g,C,x,q,O,k,E,y,_,P,T,D,j,F,S,R,N=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:for(a=Object(w["clonar"])(this.campos),o=0,r=!0,n=!1,i=void 0,e.prev=5,s=this.carrinho[Symbol.iterator]();!(r=(c=s.next()).done);r=!0)l=c.value,o+=l.valorItem;e.next=13;break;case 9:e.prev=9,e.t0=e["catch"](5),n=!0,i=e.t0;case 13:e.prev=13,e.prev=14,r||null==s.return||s.return();case 16:if(e.prev=16,!n){e.next=19;break}throw i;case 19:return e.finish(16);case 20:return e.finish(13);case 21:if(a.subTotal=Object(w["arredondar"])(o),void 0!==t){e.next=44;break}for(a.totalDesconto=0,d=!0,u=!1,m=void 0,e.prev=27,p=this.carrinho[Symbol.iterator]();!(d=(v=p.next()).done);d=!0)h=v.value,a.totalDesconto=Object(w["arredondar"])(a.totalDesconto+h.descontoItem);e.next=35;break;case 31:e.prev=31,e.t1=e["catch"](27),u=!0,m=e.t1;case 35:e.prev=35,e.prev=36,d||null==p.return||p.return();case 38:if(e.prev=38,!u){e.next=41;break}throw m;case 41:return e.finish(38);case 42:return e.finish(35);case 43:a.totalPercentualDesconto=Object(w["arredondar"])(a.totalDesconto/a.subTotal*100);case 44:if("desconto"===t&&(a.totalPercentualDesconto=Object(w["arredondar"])(a.totalDesconto/a.subTotal*100)),"descontoPercentual"===t&&(a.totalDesconto=Object(w["arredondar"])(a.totalPercentualDesconto/100*a.subTotal)),f=Object(w["arredondar"])(a.subTotal-a.totalDesconto),f>a.subTotal&&this.$nextTick(function(){var e=0,t=!0,o=!1,r=void 0;try{for(var n,i=N.carrinho[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var s=n.value;s.total=s.valorItem,s.descontoItem=s.descontoPercentualItem=0,e+=s.valorItem}}catch(e){o=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(o)throw r}}a.totalDocumento=a.subTotal=Object(w["arredondar"])(e),a.totalDesconto=a.totalPercentualDesconto=0}),a.totalDocumento=f,!t){e.next=101;break}if(!this.carrinho.length){e.next=101;break}for(b=[],g=!0,C=!1,x=void 0,e.prev=55,q=this.carrinho[Symbol.iterator]();!(g=(O=q.next()).done);g=!0)k=O.value,b.push({id:k.id,valorItem:k.valorItem});e.next=63;break;case 59:e.prev=59,e.t2=e["catch"](55),C=!0,x=e.t2;case 63:e.prev=63,e.prev=64,g||null==q.return||q.return();case 66:if(e.prev=66,!C){e.next=69;break}throw x;case 69:return e.finish(66);case 70:return e.finish(63);case 71:for(b.sort(function(e,t){return e.valorItem<t.valorItem?-1:1}),E=0,y=0;y<b.length;y++)_=b[y],_.descontoItem=(_.valorItem*a.totalPercentualDesconto|0)/100,E+=_.descontoItem;P=Object(w["arredondar"])(E)-a.totalDesconto,P&&(b[b.length-1].descontoItem-=P,b[b.length-1].descontoItem=Object(w["arredondar"])(b[b.length-1].descontoItem)),T=!0,D=!1,j=void 0,e.prev=79,F=regeneratorRuntime.mark(function e(){var t,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=R.value,t.descontoPercentualItem=a.totalPercentualDesconto,t.descontoItem=(b.find(function(e){return e.id===t.id})||{}).descontoItem,t.subTotal=Object(w["arredondar"])(t.valorItem-t.descontoItem),t.total=t.subTotal,t.valorReal=t.subTotal,t.valorRealTotal=t.subTotal,e.next=9,Object(w["imposto"])(t.idItem,t.idCfop,N.campos.idEmpresa,N.campos.idContato);case 9:o=e.sent,t.valorIpi=Object(w["arredondar"])(Object(I["get"])(o,"aliqIpi",0)/100*t.valorRealTotal),t.valorIcmsSt=Object(w["arredondar"])(Object(I["get"])(o,"percIva",0)/100*t.valorRealTotal);case 12:case"end":return e.stop()}},e)}),S=this.carrinho[Symbol.iterator]();case 82:if(T=(R=S.next()).done){e.next=87;break}return e.delegateYield(F(),"t3",84);case 84:T=!0,e.next=82;break;case 87:e.next=93;break;case 89:e.prev=89,e.t4=e["catch"](79),D=!0,j=e.t4;case 93:e.prev=93,e.prev=94,T||null==S.return||S.return();case 96:if(e.prev=96,!D){e.next=99;break}throw j;case 99:return e.finish(96);case 100:return e.finish(93);case 101:this.campos=a;case 102:case"end":return e.stop()}},e,this,[[5,9,13,21],[14,,16,20],[27,31,35,43],[36,,38,42],[55,59,63,71],[64,,66,70],[79,89,93,101],[94,,96,100]])}));return function(t){return e.apply(this,arguments)}}(),calculaTotalItem:function(){var e=i()(regeneratorRuntime.mark(function e(t,a){var o,r,n,i=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return o=Object(w["clonar"])(this.carrinho[t]),"descontoPercentualItem"===a&&(o.descontoItem=Object(w["arredondar"])(o.descontoPercentualItem/100*o.valorItem)),"descontoItem"===a&&(o.descontoPercentualItem=Object(w["arredondar"])(o.descontoItem/o.valorItem*100)),"valorItem"===a&&(o.valorItem<o.valorOriginal&&(o.valorItem=o.valorOriginal),o.descontoItem=0,o.descontoPercentualItem=0,o.subTotal=o.valorItem),r=o.valorItem-o.descontoItem,Object(w["arredondar"])(r)>Object(w["arredondar"])(o.valorItem)&&(r=o.valorItem,o.descontoPercentualItem=o.descontoItem=0),o.subTotal=Object(w["arredondar"])(r*o.quantidade),o.total=o.subTotal,o.valorReal=Object(w["arredondar"])(r),o.valorRealTotal=o.total,e.next=12,Object(w["imposto"])(o.idItem,o.idCfop,this.campos.idEmpresa,this.campos.idContato);case 12:n=e.sent,o.valorIpi=Object(w["arredondar"])(Object(I["get"])(n,"aliqIpi",0)/100*o.valorRealTotal),o.valorIcmsSt=Object(w["arredondar"])(Object(I["get"])(n,"percIva",0)/100*o.valorRealTotal),"valorItem"===a?(this.$set(this.carrinho,t,m()({},o,{valorItem:0})),this.$nextTick(function(){i.$set(i.carrinho,t,o),i.calculaTotal()})):this.$set(this.carrinho,t,o),this.calculaTotal();case 17:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}(),abrirModalCodigoBarras:function(){this.modalCodigoBarras=!0},abrirModalDependente:function(){this.modalDependente=!0},abrirModalReceita:function(){var e=i()(regeneratorRuntime.mark(function e(t,a){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:try{this.modalReceita={visivel:!0,id:t||Object(w["uuid"])(),idEmpresa:Object(I["get"])(this.envelope,"documento.idEmpresa",""),duplicar:a}}catch(e){this.modalReceita={visivel:!1,id:"",idEmpresa:"",duplicar:!1},this.$q.notifyError("Ocorreu um erro ao carregar a receita.",e)}case 1:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}(),abrirModalItem:function(e,t){switch(e){case"Lentes":this.modalItem.filtros={tipo:"Lente",ativo:!0};break;case"LentesContato":this.modalItem.filtros={tipo:"Lente Contato",ativo:!0};break;case"Armacao":this.modalItem.filtros={tipo:["Armação","Óculos Sol"],ativo:!0};break;case"Tratamento LOD":this.modalItem.filtros={tipo:"Tratamento",ativo:!0},this.tipoTratamento="TLOD",this.idDocumentoItemPai=t;break;case"Tratamento LOE":this.modalItem.filtros={tipo:"Tratamento",ativo:!0},this.tipoTratamento="TLOE",this.idDocumentoItemPai=t;break}this.modalItem.filtros.idEmpresa=this.campos.idEmpresa,this.modalItem.filtros.idTabelaPreco=this.campos.idItemTabelaPreco,this.modalItem.visivel=!0},alterarTipoEnvelope:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=function(){var e=i()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a.tipoOculos="Oculos"===a.tipoEnvelope?"Vista":"",a.carrinho=[],a.tipoLente="Multifocal (Longe e Perto)","Oculos"===a.tipoEnvelope?(a.tipoOculos="Vista",a.tipoLentes=a.tipoLentesOculos):(a.tipoOculos="",a.tipoLentes=a.tipoLentesContato);case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),this.carrinho.length){e.next=4;break}return t(),e.abrupt("return");case 4:return e.prev=4,e.next=7,this.$q.dialog({cancel:"Cancelar",message:"Esta ação irá remover os itens do carrinho.",noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 7:t(),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](4),this.tipoEnvelope="Oculos"===this.tipoEnvelope?"Lentes":"Oculos";case 13:case"end":return e.stop()}},e,this,[[4,10]])}));return function(){return e.apply(this,arguments)}}(),buscarCodigoBarras:function(){var e=i()(regeneratorRuntime.mark(function e(t,a){var o,r,n,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=(t||"").trim().replace(/(\S+\s)|(\S+$)/g,"codigoBarras:$1$2"),t){e.next=3;break}return e.abrupt("return",a([]));case 3:if(o=this.$filters,r=o.dinheiro,n=o.numero,i=[],"Oculos"!==this.tipoEnvelope){e.next=11;break}return e.next=8,k["a"].itemBusca.filtrar(t,{ativo:!0,tipo:["Lente","Armação","Óculos Sol"]},10);case 8:i=e.sent,e.next=14;break;case 11:return e.next=13,k["a"].itemBusca.filtrar(t,{ativo:!0,tipo:"Lente Contato"},10);case 13:i=e.sent;case 14:if(i=i.map(function(e){return{value:e.id,label:e.descricao,sublabel:"".concat(r(e.valorVenda)," | ").concat(n(e.quantidadeDisponivel)+e.unidade),stamp:e.codigoBarras,item:e}}),!this.entrarCodigoBarras||1!==i.length){e.next=17;break}return e.abrupt("return",this.selecionarItemCodigoBarras(i[0]));case 17:if("function"!==typeof a){e.next=19;break}return e.abrupt("return",a(i));case 19:this.$q.notifyError("Nenhum item foi encontrado.");case 20:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}(),criarDependencia:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k["a"].documento.le({id:this.campos.documentoId});case 3:return a=e.sent,e.next=6,this.$store.dispatch("criarDependenciaContatos",{contatoPai:{id:a.idContato},contatoFilho:t});case 6:this.campos.paciente||(this.campos.paciente={}),this.campos.idContato=this.campos.paciente.id=this.idPacienteSelecionado=t.id,this.campos.descricaoContato=this.campos.paciente.nome=t.nome,e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](0),this.$q.notifyError("Ocorreu um erro ao criar a dependência.",e.t0);case 14:case"end":return e.stop()}},e,this,[[0,11]])}));return function(t){return e.apply(this,arguments)}}(),escanearCodigoBarras:function(e){this.fecharModalCodigoBarras(),this.$refs.codigoBarras.focus(),this.entrarCodigoBarras=!0,this.buscarCodigoBarras(e)},filtrarReceitas:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a,o,r,n,i,s,c,l,d,u,p;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=[],e.next=3,k["a"].receita.leReceitas({idContato:this.campos.idContato});case 3:a=e.sent,a=Object(I["orderBy"])(a,"dataHoraEmissao","desc"),o=(new Date).setHours(0,0,0,0),r=!0,n=!1,i=void 0,e.prev=9,s=a[Symbol.iterator]();case 11:if(r=(c=s.next()).done){e.next=27;break}return l=c.value,e.next=15,k["a"].receita.le({id:l.id});case 15:l=e.sent,this.receita.id||(this.receita=l),d="De ".concat(l.medico.nome,", "),d+="".concat(this.$filters.data(l.data)," "),d+="válido até ".concat(this.$filters.data(l.validade)),u={},u=new Date(l.validade).setHours(0,0,0,0)<o?{icon:"alarm_off",color:"negative",stamp:"Vencida"}:{icon:"alarm",stamp:"À vencer"},p=m()({label:d,value:l.id},u),t.push(p);case 24:r=!0,e.next=11;break;case 27:e.next=33;break;case 29:e.prev=29,e.t0=e["catch"](9),n=!0,i=e.t0;case 33:e.prev=33,e.prev=34,r||null==s.return||s.return();case 36:if(e.prev=36,!n){e.next=39;break}throw i;case 39:return e.finish(36);case 40:return e.finish(33);case 41:this.receitasDescricao=t;case 42:case"end":return e.stop()}},e,this,[[9,29,33,41],[34,,36,40]])}));return function(){return e.apply(this,arguments)}}(),leitorCodigoBarras:function(e){e.ctrlKey&&74===e.keyCode?e.preventDefault():13===e.keyCode&&(this.entrarCodigoBarras=!0)},eventoInput:function(e){this.$emit("input",e)},voltar:function(){var e=i()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!this.envelope.somenteLeitura){e.next=3;break}return this.$emit("input",!1),e.abrupt("return");case 3:return e.prev=3,e.next=6,this.$q.dialog({cancel:"Cancelar",message:"As alterações não serão salvas.",noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 6:this.$emit("input",!1),e.next=11;break;case 9:e.prev=9,e.t0=e["catch"](3);case 11:case"end":return e.stop()}},e,this,[[3,9]])}));return function(){return e.apply(this,arguments)}}(),ordenarCarrinho:function(){var e={LOE:1,TLOE:2,LOD:3,TLOD:4,"Armação":5};this.carrinho=(this.carrinho||[]).sort(function(t,a){return e[t.tipoItem]-e[a.tipoItem]})},removerItem:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a=(this.carrinho[t]||{}).id,this.carrinho=this.carrinho.filter(function(e){return e.id!==a&&e.idDocumentoItemPai!==a}),this.calculaTotal();case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),salvarDnp:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a,o,r,n,i,s,c,l;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.receita.id){e.next=2;break}return e.abrupt("return");case 2:if(t=JSON.parse((this.modalPupilometro.pupilometroAtual||{}).json||null),t){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,Object(O["a"])().documentoItem.where({idDocumento:this.receita.id}).toArray();case 7:a=e.sent,o=!0,r=!1,n=void 0,e.prev=11,i=a[Symbol.iterator]();case 13:if(o=(s=i.next()).done){e.next=27;break}if(c=s.value,l=0,"Olho Esquerdo"===c.operacao&&(l=Object(w["arredondar"])(t.medidas.dnp.oe)),"Olho Direito"===c.operacao&&(l=Object(w["arredondar"])(t.medidas.dnp.od)),l!==c.di){e.next=20;break}return e.abrupt("continue",24);case 20:return e.next=22,Object(O["a"])().documentoItem.update(c.id,{di:l});case 22:return e.next=24,Object(w["sincronismoEnviar"])("atualizar","documentoItem",c.id,{di:l});case 24:o=!0,e.next=13;break;case 27:e.next=33;break;case 29:e.prev=29,e.t0=e["catch"](11),r=!0,n=e.t0;case 33:e.prev=33,e.prev=34,o||null==i.return||i.return();case 36:if(e.prev=36,!r){e.next=39;break}throw n;case 39:return e.finish(36);case 40:return e.finish(33);case 41:this.atualizarReceita(this.receita.id);case 42:case"end":return e.stop()}},e,this,[[11,29,33,41],[34,,36,40]])}));return function(){return e.apply(this,arguments)}}(),salvarEnvelope:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a,o,r,n=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.receita.id){e.next=3;break}return this.$q.notifyError("Selecione uma receita"),e.abrupt("return");case 3:if(this.carrinho.length){e.next=6;break}return this.$q.notifyError("Não há itens no carrinho"),e.abrupt("return");case 6:if(!this.erroDataHoraPrevisto){e.next=9;break}return this.$q.notifyError("Erro no preenchimento do formulário"),e.abrupt("return");case 9:if(t={},"Oculos"!==this.tipoEnvelope){e.next=30;break}a=!1,e.t0=regeneratorRuntime.keys(this.carrinho);case 13:if((e.t1=e.t0()).done){e.next=29;break}if(o=e.t1.value,"Armação"!==this.carrinho[o].tipoItem){e.next=27;break}return this.carrinho[o].alturaMontagemOD=this.armacao.alturaMontagemOD||0,this.carrinho[o].alturaMontagemOE=this.armacao.alturaMontagemOE||0,this.carrinho[o].diagonal=this.armacao.diagonal||0,this.carrinho[o].ponte=this.armacao.ponte||0,this.carrinho[o].altura=this.armacao.altura||0,this.carrinho[o].largura=this.armacao.largura||0,this.carrinho[o].armacaoMaterial=this.armacao.armacaoMaterial,this.carrinho[o].tipoMontagem=this.armacao.tipoMontagem,this.carrinho[o].idItem&&(t.id=this.carrinho[o].idItem,t.armacaoMaterial=this.armacao.armacaoMaterial,t.tipoMontagem=this.armacao.tipoMontagem,t.diagonal=this.armacao.diagonal||0,t.ponte=this.armacao.ponte||0,t.altura=this.armacao.altura||0,t.largura=this.armacao.largura||0),a=!0,e.abrupt("break",29);case 27:e.next=13;break;case 29:a||this.carrinho.push({id:Object(w["uuid"])(),idDocumento:this.campos.documentoId,idDocumentoAdicional:this.campos.id,dataHoraEmissao:Object(w["dataAtual"])(),descontoItem:0,descontoPercentualItem:0,descontoSubTotal:0,descricaoItem:"",operacaoFator:0,oculos:this.tipoLente,tipoOculos:this.tipoOculos,quantidade:0,status:this.campos.status,subTotal:0,tipoItem:"Armação",total:0,valorCusto:0,valorCustoMedio:0,valorCustoReposicao:0,valorCustoUltimo:0,valorItem:0,valorItemUltimo:0,valorOriginal:0,valorReal:0,alturaMontagemOD:this.armacao.alturaMontagemOD||0,alturaMontagemOE:this.armacao.alturaMontagemOE||0,diagonal:this.armacao.diagonal||0,ponte:this.armacao.ponte||0,altura:this.armacao.altura||0,largura:this.armacao.largura||0,armacaoMaterial:this.armacao.armacaoMaterial,tipoMontagem:this.armacao.tipoMontagem});case 30:this.campos.idDocumentoAdicional=this.receita.id,r={documento:Object(w["clonar"])(this.campos),documentoItens:Object(w["clonar"])(this.carrinho),armacao:t,arquivo:this.$refs.arquivo.arquivo.map(function(e){return m()({},e,{idTabelaMaster:n.campos.id,tabelaMaster:"envelope"})}),pupilometro:{original:Object(w["clonarV2"])(this.modalPupilometro.pupilometroOriginal),atual:Object(w["clonarV2"])(this.modalPupilometro.pupilometroAtual)}},this.documentoContatoLaboratorio.idContato&&(this.documentoContatoLaboratorio.id||(this.documentoContatoLaboratorio.id=Object(w["uuid"])(),this.documentoContatoLaboratorio.idDocumento=r.documento.id,this.documentoContatoLaboratorio.descricao="Laboratório"),this.documentoContato=this.documentoContato.filter(function(e){return"Laboratório"!==e.descricao}),r.documentoContato=d()(this.documentoContato).concat([this.documentoContatoLaboratorio])),this.salvarDnp(),this.$emit("salvarEnvelope",r),this.$emit("input",!1);case 36:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),selecionarItens:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:e.t0=regeneratorRuntime.keys(t);case 1:if((e.t1=e.t0()).done){e.next=8;break}return a=e.t1.value,o=t[a].item||{},e.next=6,this.selecionarItem(a,o);case 6:e.next=1;break;case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),selecionarItem:function(){var e=i()(regeneratorRuntime.mark(function e(t,a){var o,r,n,i,s,c,l,d,u,m,p,v,h,f,b,g;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(o=[],!["Armação","Óculos Sol"].includes(a.tipo)){e.next=5;break}o=["Armação"],e.next=21;break;case 5:if("Tratamento"!==a.tipo){e.next=9;break}o=[this.tipoTratamento],e.next=21;break;case 9:if(!["Lente","Lente Contato"].includes(a.tipo)){e.next=21;break}return e.prev=10,r=[{label:"LOD / LOE",value:"opt1"},{label:"LOD",value:"opt2"},{label:"LOE",value:"opt3"}],e.next=14,this.$q.dialog({noRefocus:!0,ok:"Continuar",cancel:"Cancelar",title:" ",options:{type:"radio",model:"opt1",items:r}});case 14:n=e.sent,o=r.filter(function(e){return e.value===n})[0].label.split(" / "),e.next=21;break;case 18:return e.prev=18,e.t0=e["catch"](10),e.abrupt("return");case 21:return this.modalItem.visivel=!1,e.next=24,k["a"].documentoOperacao.le({codigoDocumentoOperacao:this.campos.codigoDocumentoOperacao});case 24:if(i=e.sent,i||i.length){e.next=28;break}return this.$q.notify("Não foi possível localizar a Operação."),e.abrupt("return");case 28:return e.next=30,k["a"].cfop.le({id:i[0].idCfop});case 30:if(s=e.sent,s.id){e.next=34;break}return this.$q.notify("Não foi possível localizar o CFOP."),e.abrupt("return");case 34:c=!0,l=!1,d=void 0,e.prev=37,u=o[Symbol.iterator]();case 39:if(c=(m=u.next()).done){e.next=76;break}if(p=m.value,["TLOD","TLOE"].includes(p)){e.next=50;break}e.t1=regeneratorRuntime.keys(this.carrinho);case 43:if((e.t2=e.t1()).done){e.next=50;break}if(v=e.t2.value,this.carrinho[v].tipoItem!==p){e.next=48;break}return e.next=48,this.removerItem(v);case 48:e.next=43;break;case 50:return e.next=52,k["a"].estoqueSaldoProdutoEmpresa.le({idItem:a.id,idEmpresa:Object(I["get"])(this.envelope,"documento.idEmpresa",""),tipoEstoque:"Disponível"});case 52:return e.t3=function(e){return e.idItem},h=e.sent.find(e.t3),e.next=56,Object(w["imposto"])(a.id,s.id,this.campos.idEmpresa,this.campos.idContato);case 56:return f=e.sent,e.next=59,Object(w["trocarCfop"])(a.ncm,s.cfop);case 59:b=e.sent,b&&(s=b),g={id:Object(w["uuid"])(),idItem:a.id,idDocumento:this.campos.documentoId,idDocumentoAdicional:this.campos.id,codigoCfop:s.codigoCfop,codigoPlanoContaDestino:139,codigoPlanoContaEstoque:146,dataHoraEmissao:Object(w["dataAtual"])(),descontoItem:0,descontoPercentualItem:0,descontoSubTotal:0,descricaoItem:a.descricaoConcatenada,operacao:s.operacao,operacaoFator:s.fator,idCfop:s.id,oculos:this.tipoLente,tipoOculos:"Armação"===p?this.tipoOculos:"",lenteTipo:"Armação"!==p?this.tipoOculos:"",quantidade:1,status:this.campos.status,subTotal:a.valorVenda,tipoItem:p,total:a.valorVenda,valorCusto:0,valorCustoMedio:Object(I["get"])(h,"valorCustoMedio",0),valorCustoReposicao:a.valorCustoReposicao||0,valorCustoUltimo:Object(I["get"])(h,"valorCusto",0),valorItem:a.valorVenda,valorItemUltimo:0,valorOriginal:a.valorVenda,valorReal:a.valorVenda,valorRealTotal:a.valorVenda,alturaMontagemOD:0,alturaMontagemOE:0,diagonal:a.diagonal||0,ponte:a.ponte||0,altura:a.altura||0,largura:a.largura||0,armacaoMaterial:a.armacaoMaterial||"",tipoMontagem:a.tipoMontagem||"",valorIpi:Object(w["arredondar"])(Object(I["get"])(f,"aliqIpi",0)/100*a.valorVenda),valorIcmsSt:Object(w["arredondar"])(Object(I["get"])(f,"percIva",0)/100*a.valorVenda)},["TLOD","TLOE"].includes(p)&&this.idDocumentoItemPai&&(g.idDocumentoItemPai=this.idDocumentoItemPai),this.armacao.diagonal=g.diagonal||0,this.armacao.ponte=g.ponte||0,this.armacao.altura=g.altura||0,this.armacao.largura=g.largura||0,this.armacao.armacaoMaterial=g.armacaoMaterial,this.armacao.tipoMontagem=g.tipoMontagem,this.carrinho.push(g),this.ordenarCarrinho(),this.carregarItens(),this.calculaTotal();case 73:c=!0,e.next=39;break;case 76:e.next=82;break;case 78:e.prev=78,e.t4=e["catch"](37),l=!0,d=e.t4;case 82:e.prev=82,e.prev=83,c||null==u.return||u.return();case 85:if(e.prev=85,!l){e.next=88;break}throw d;case 88:return e.finish(85);case 89:return e.finish(82);case 90:case"end":return e.stop()}},e,this,[[10,18],[37,78,82,90],[83,,85,89]])}));return function(t,a){return e.apply(this,arguments)}}(),selecionarItemCodigoBarras:function(e){var t=e.item;this.codigoBarras="",this.entrarCodigoBarras=!1,this.selecionarItem(t.id,t)},pacientesAtualizar:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a,o,r,n,i,s,c;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,k["a"].contato.leFilhos(k["a"].contato.selecionado.id);case 2:for(t=e.sent,t.push({nome:k["a"].contato.selecionado.nome,id:k["a"].contato.selecionado.id}),a=[],o=!0,r=!1,n=void 0,e.prev=8,i=t[Symbol.iterator]();!(o=(s=i.next()).done);o=!0)c=s.value,a.push({label:c.nome,value:c.id});e.next=16;break;case 12:e.prev=12,e.t0=e["catch"](8),r=!0,n=e.t0;case 16:e.prev=16,e.prev=17,o||null==i.return||i.return();case 19:if(e.prev=19,!r){e.next=22;break}throw n;case 22:return e.finish(19);case 23:return e.finish(16);case 24:this.pacientes=Object(I["orderBy"])(a,"label");case 25:case"end":return e.stop()}},e,this,[[8,12,16,24],[17,,19,23]])}));return function(){return e.apply(this,arguments)}}(),atualizar:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a,o,r,n,i,s,c,l,d;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.campos=Object(w["clonar"])(m()({},k["a"].envelope.vazio,this.envelope.documento)),this.tipoLentes=this.tipoLentesOculos,this.carrinho=Object(w["clonar"])(this.envelope.documentoItens||[]),this.armacao.alturaMontagemOD=0,this.armacao.alturaMontagemOE=0,this.armacao.diagonal=0,this.armacao.ponte=0,this.armacao.altura=0,this.armacao.largura=0,this.armacao.armacaoMaterial="",this.armacao.tipoMontagem="",t=[],e.t0=regeneratorRuntime.keys(this.carrinho);case 13:if((e.t1=e.t0()).done){e.next=32;break}if(a=e.t1.value,!this.carrinho[a].idItem){e.next=20;break}return e.next=18,Object(O["a"])().item.get(this.carrinho[a].idItem);case 18:o=e.sent,t.push(o.tipo||"");case 20:if("Armação"!==this.carrinho[a].tipoItem){e.next=30;break}return this.armacao.alturaMontagemOD=this.carrinho[a].alturaMontagemOD||0,this.armacao.alturaMontagemOE=this.carrinho[a].alturaMontagemOE||0,this.armacao.diagonal=this.carrinho[a].diagonal||0,this.armacao.ponte=this.carrinho[a].ponte||0,this.armacao.altura=this.carrinho[a].altura||0,this.armacao.largura=this.carrinho[a].largura||0,this.armacao.armacaoMaterial=this.carrinho[a].armacaoMaterial,this.armacao.tipoMontagem=this.carrinho[a].tipoMontagem,e.abrupt("break",32);case 30:e.next=13;break;case 32:this.tipoEnvelope="Oculos",r=new RegExp(/contato/i),n=0;case 35:if(!(n<t.length)){e.next=43;break}if(i=t[n],!r.test(i)){e.next=40;break}return this.tipoEnvelope="Lentes",e.abrupt("break",43);case 40:n++,e.next=35;break;case 43:if(this.documentoContato=Object(w["clonar"])(this.envelope.documentoContato||[]),this.documentoContatoLaboratorio=this.documentoContato.find(function(e){return"Laboratório"===e.descricao})||{},this.descricaoLaboratorio="",!this.documentoContatoLaboratorio.id){e.next=53;break}return e.next=49,k["a"].contato.le({id:this.documentoContatoLaboratorio.idContato});case 49:if(e.t2=e.sent.apelido,e.t2){e.next=52;break}e.t2="";case 52:this.descricaoLaboratorio=e.t2;case 53:return e.next=55,k["a"].contato.le({id:this.campos.idContatoResponsavel});case 55:if(e.t3=e.sent.apelido,e.t3){e.next=58;break}e.t3="";case 58:if(this.descricaoResponsavel=e.t3,this.campos.dataHoraPrevisto){e.next=71;break}return s="",e.next=63,k["a"].configuracoes.le({nome:"venda.envelope.previsaoentrega"});case 63:c=e.sent,c.length&&(c=parseInt(c[0].valor)),Number.isInteger(c)||(c=15),l=new Date,d=l.getDate(),l.setDate(d+c),s=new Date(l.setHours(0,0,0,0)),this.campos.dataHoraPrevisto=A["d"].formatDate(s);case 71:this.$refs.arquivo.arquivo=this.envelope.arquivo,this.$refs.arquivo.somenteLeitura=this.envelope.somenteLeitura,this.pacientesAtualizar(),this.atualizarArmacaoMaterial(),this.atualizarTipoMontagem(),this.atualizarReceita(this.campos.idDocumentoAdicional),this.ordenarCarrinho(),this.carregarItens(),this.carregarPupilometro();case 80:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),carregarItens:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a,o,r,n,i,s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t=!0,a=!1,o=void 0,e.prev=3,r=this.carrinho[Symbol.iterator]();case 5:if(t=(n=r.next()).done){e.next=16;break}if(i=n.value,!i.idItem||i.idItem in this.itens){e.next=13;break}return e.next=10,Object(O["a"])().item.get(i.idItem);case 10:s=e.sent,s=m()({},s,{marca:s.marca||"",referencia:s.referencia||"",observacao:s.observacao||"",aplicacao:s.aplicacao||"",imagem:s.imagem||""}),this.$set(this.itens,s.id,s);case 13:t=!0,e.next=5;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e["catch"](3),a=!0,o=e.t0;case 22:e.prev=22,e.prev=23,t||null==r.return||r.return();case 25:if(e.prev=25,!a){e.next=28;break}throw o;case 28:return e.finish(25);case 29:return e.finish(22);case 30:case"end":return e.stop()}},e,this,[[3,18,22,30],[23,,25,29]])}));return function(){return e.apply(this,arguments)}}(),carregarPupilometro:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a,o=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return k["a"].permissao.objeto("pupilometro").then(function(e){o.permissaoPupilometro=e}),e.next=3,Object(O["a"])().json.where({descricao:"Pupilômetro",referencia:"idEnvelope:"+this.campos.id}).toArray();case 3:t=e.sent,a=t.find(function(e){return e.id}),this.modalPupilometro.pupilometroOriginal={},this.modalPupilometro.pupilometroAtual={},a&&(this.modalPupilometro.pupilometroOriginal=Object(w["clonarV2"])(a),this.modalPupilometro.pupilometroAtual=Object(w["clonarV2"])(a));case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},props:{envelope:{default:function(){},type:Object},value:{default:!1,required:!0,type:Boolean}},watch:{value:function(){var e=i()(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t&&this.atualizar();case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}},z=B,L=Object(P["a"])(z,S,R,!1,null,null,null);L.options.__file="Envelope.vue";var H=L.exports,U=a("1148"),Q=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("q-collapsible",{staticClass:"border-1 q-my-sm",attrs:{icon:"airplanemode_active",label:"Transporte",opened:""}},[a("div",{staticClass:"row gutter-x-sm"},[a("campo",{staticClass:"col-xs-12 col-sm-4",attrs:{clearable:"","clear-value":0,filter:"",opcoes:e.transporteOpts,rotulo:"Transporte",tipo:"seletor"},nativeOn:{click:function(t){return e.obterTransporteOpts(t)}},model:{value:e.transporte,callback:function(t){e.transporte=t},expression:"transporte"}}),a("campo",{staticClass:"col-xs-12 col-sm-4",attrs:{value:e.contatoTransportadora.nome,after:[{icon:"cancel",handler:function(){e.contatoTransportadora={}}}],readonly:"",rotulo:"Transportadora"},on:{click:function(t){e.abrirPromptContatoTransportadora()}}}),a("campo",{staticClass:"col-xs-12 col-sm-4",attrs:{clearable:"","clear-value":"",rotulo:"Data Prevista Entrega",min:Date.now(),format:"DD/MM/YYYY HH:mm",tipo:"dataHora"},model:{value:e.dataPrevistaEntrega,callback:function(t){e.dataPrevistaEntrega=t},expression:"dataPrevistaEntrega"}}),a("campo",{staticClass:"col-xs-12",attrs:{clearable:"","clear-value":0,filter:"",opcoes:e.enderecoClienteOpts,rotulo:"Endereço",tipo:"seletor"},nativeOn:{click:function(t){return e.obterEnderecoClienteOpts(t)}},model:{value:e.idContatoEnderecoCliente,callback:function(t){e.idContatoEnderecoCliente=t},expression:"idContatoEnderecoCliente"}}),a("campo",{staticClass:"col-xs-12",attrs:{tipo:"textoArea",rotulo:"Obs. de Entrega"},model:{value:e.obsEntrega,callback:function(t){e.obsEntrega=t},expression:"obsEntrega"}})],1)]),a("prompt-contato-novo",{attrs:{filtro:e.promptContato.filtro,placeholder:"Seleciona a transportadora"},on:{selecionar:e.selecionarContatoTransportadora},model:{value:e.promptContato.visivel,callback:function(t){e.$set(e.promptContato,"visivel",t)},expression:"promptContato.visivel"}})],1)},J=[];Q._withStripped=!0;var G={components:{Campo:h["a"],PromptContatoNovo:V["a"]},data:function(){return{contatoTransportadora:{},dataPrevistaEntrega:"",enderecoClienteOpts:[],idContatoEnderecoCliente:"",obsEntrega:"",promptContato:{visivel:!1,filtro:{}},transporte:"",transporteOpts:[]}},methods:{abrirPromptContatoTransportadora:function(){this.promptContato.filtro={ativo:!0,transportadoras:!0},this.promptContato.visivel=!0},obterEnderecoClienteOpts:function(){var e=i()(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(O["a"])().contatoEndereco.where({idContato:this.idContatoCliente}).toArray();case 2:t=e.sent,this.enderecoClienteOpts=t.map(function(e){var t="";return t+=e.logradouro||"",e.numero&&(t+=t?", ":"",t+=e.numero),e.complemento&&(t+=t?" ":"",t+=e.complemento),e.bairro&&(t+=t?" - ":"",t+=e.bairro),e.municipio&&(t+=t?" - ":"",t+=e.municipio),e.uf&&(t+=t?"/":"",t+=e.uf),{rotulo:t,valor:e.id}});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),obterTransporteOpts:function(){this.transporteOpts=[{rotulo:"Transportadora",valor:1},{rotulo:"Entrega Própria",valor:2},{rotulo:"Entrega na Viagem",valor:3},{rotulo:"Retirar",valor:4}]},limparTransporte:function(){this.transporte=0,this.transporteOpts=[{rotulo:"Selecionar",valor:0}]},limparEnderecoCliente:function(){this.enderecoClienteOpts=[{rotulo:"Selecionar",valor:0}],this.idContatoEnderecoCliente=0},selecionarContatoTransportadora:function(e){var t=this;e&&Object(O["a"])().contato.get(e).then(function(e){t.contatoTransportadora=e})},get:function(){var e=this,t="";if(this.idContatoEnderecoCliente){var a=this.enderecoClienteOpts.find(function(t){return t.valor===e.idContatoEnderecoCliente})||{};t=a.rotulo||""}return{tipoTransporte:this.transporte||"",dataHoraPrevisto:A["d"].formatDate(this.dataPrevistaEntrega)||"",descricaoContatoEnderecoEntrega:t,idContatoTransportadora:this.contatoTransportadora.id||"",observacaoEntrega:this.obsEntrega}},set:function(e){var t=this;this.dataPrevistaEntrega=e.dataHoraPrevisto?new Date(e.dataHoraPrevisto):"",this.selecionarContatoTransportadora(e.idContatoTransportadora),this.obsEntrega=e.observacaoEntrega||"",e.tipoTransporte&&(this.obterTransporteOpts(),this.transporteOpts.find(function(t){return t.valor===e.tipoTransporte})?this.transporte=e.tipoTransporte:this.limparTransporte()),e.descricaoContatoEnderecoEntrega&&this.obterEnderecoClienteOpts().then(function(){var a=t.enderecoClienteOpts.find(function(t){return t.rotulo===e.descricaoContatoEnderecoEntrega})||{};t.idContatoEnderecoCliente=a.valor||0,t.idContatoEnderecoCliente||(t.enderecoClienteOpts=[{rotulo:e.descricaoContatoEnderecoEntrega||"Selecionar",valor:0}])})}},props:{idContatoCliente:{required:!0,type:String}},watch:{transporte:function(e,t){t&&!e&&this.limparTransporte()},idContatoEnderecoCliente:function(e,t){t&&!e&&this.limparEnderecoCliente()}},created:function(){this.limparTransporte(),this.limparEnderecoCliente()}},X=G,Y=(a("95fe"),Object(P["a"])(X,Q,J,!1,null,"5d42e3af",null));Y.options.__file="VendaTransporte.vue";var K=Y.exports,W=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("q-modal",{attrs:{"no-esc-dismiss":"","no-backdrop-dismiss":"",maximized:""},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[a("div",{staticClass:"q-pt-xl",staticStyle:{background:"#eee","min-height":"100vh"}},[a("q-layout-header",{attrs:{reveal:""}},[a("q-toolbar",{staticClass:"BarraTopo"},[a("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"arrow_back"},on:{click:e.close}}),a("q-toolbar-title",[e._v("Ordem de Serviço")]),a("q-btn",{staticClass:"q-ml-sm no-shadow",attrs:{color:"white","text-color":"primary",label:"Salvar"},on:{click:e.save}})],1)],1),a("div",{staticClass:"layout-padding row justify-center"},[a("div",{staticStyle:{width:"1280px","max-width":"90vw"}},[a("q-card",{staticClass:"q-pa-md q-px-lg q-mb-md bg-white no-shadow"},[a("q-toolbar",{staticClass:"q-pb-md q-px-none",attrs:{color:"black",inverted:""}},[a("q-toolbar-title",{staticClass:"q-px-none"},[a("div",{staticClass:"row items-center"},[a("avatar",{staticStyle:{float:"left"},attrs:{imagem:e.contato.imagem,rotulo:e.contato.descricao,tamanho:"40"}}),a("div",{staticClass:"col q-ma-sm q-title"},[e._v(e._s(e.contato.descricao))])],1)]),a("badge",[e._v("#"+e._s(e.contato.codigo))])],1),a("div",{staticClass:"row gutter-x-sm q-mb-sm"},[a("div",{staticClass:"col-4"},[a("campo",{staticClass:"bg-light q-px-sm",attrs:{rotuloFixo:"Problema",tipo:"textoArea",erro:!!e.erroDescricao,"erro-rotulo":e.erroDescricao,"somente-leitura":e.readonly},model:{value:e.dataTmp.documento.descricao,callback:function(t){e.$set(e.dataTmp.documento,"descricao","string"===typeof t?t.trim():t)},expression:"dataTmp.documento.descricao"}})],1),a("div",{staticClass:"col-4"},[a("campo",{staticClass:"bg-light q-px-sm",attrs:{rotuloFixo:"Solução",tipo:"textoArea","somente-leitura":e.readonly},model:{value:e.dataTmp.documento.observacao,callback:function(t){e.$set(e.dataTmp.documento,"observacao","string"===typeof t?t.trim():t)},expression:"dataTmp.documento.observacao"}})],1),a("div",{staticClass:"col-4"},[a("campo",{staticClass:"bg-light q-px-sm",attrs:{rotuloFixo:"Descrição Agrupamento",tipo:"texto",somenteLeitura:e.readonly},model:{value:e.descricaoAgrupamento,callback:function(t){e.descricaoAgrupamento="string"===typeof t?t.trim():t},expression:"descricaoAgrupamento"}})],1)])],1),e.permissao.equipamento?a("div",{staticClass:"bg-white q-mt-md"},[a("q-card",{staticClass:"q-pa-md no-shadow"},[a("div",{staticClass:"row q-pa-sm"},[a("q-toolbar-title",[e._v(e._s(e.equipamento.tipo||"Equipamento"))]),e.readonly?e._e():a("q-btn",{attrs:{color:"primary",flat:"",icon:"add",label:"Equipamento"},on:{click:function(t){e.modalEquipamento={visivel:!0,campos:{}}}}}),a("EquipamentoModal",{attrs:{modal:e.modalEquipamento},on:{atualizar:function(t){e.equipamento=t,e.dataTmp.documento.idEquipamento=t.id}}}),a("SeletorEquipamento",{staticClass:"col-auto",attrs:{apenasIcone:"",filtro:{idContato:e.dataTmp.documento.idContato}},on:{selecionar:function(t){return e.equipamento=t}},model:{value:e.dataTmp.documento.idEquipamento,callback:function(t){e.$set(e.dataTmp.documento,"idEquipamento",t)},expression:"dataTmp.documento.idEquipamento"}})],1),a("div",{staticClass:"row q-px-md q-pb-md"},[a("EquipamentoCard",{attrs:{equipamento:e.equipamento}})],1)])],1):e._e(),a("div",{staticClass:"bg-white q-mt-md"},[a("q-card",{staticClass:"q-pa-md no-shadow"},[a("div",{staticClass:"row q-pa-sm"},[a("q-toolbar-title",[e._v("Imagens")])],1),a("div",{staticClass:"row q-px-md q-pb-md"},[a("div",{staticClass:"col"},[a("arquivo",{ref:"arquivo"})],1)])])],1),a("div",{staticClass:"bg-white q-mt-md q-py-sm"},[a("q-card",{staticClass:"q-pa-md q-pb-xl q-mb-md bg-white no-shadow "},[a("q-toolbar",{staticClass:"q-pt-md",attrs:{color:"black",inverted:""}},[a("q-toolbar-title",[e._v("Itens")]),e.readonly?e._e():a("q-btn",{attrs:{color:"primary",flat:"",icon:"add",label:"Produto"},on:{click:function(t){e.abrirModalItem("Produto")}}}),e.readonly?e._e():a("q-btn",{attrs:{color:"primary",flat:"",icon:"add",label:"Serviço"},on:{click:function(t){e.abrirModalItem("Serviço")}}})],1),e.readonly?e._e():a("q-field",{staticClass:"q-mx-lg"},[a("q-input",{ref:"codigoBarras",attrs:{after:[{icon:"photo_camera",handler:e.abrirModalCodigoBarras}],before:[{icon:"line_weight"}],color:"light","inverted-light":"","float-label":"Código de barras"},on:{keydown:e.leitorCodigoBarras},model:{value:e.codigoBarras,callback:function(t){e.codigoBarras=t},expression:"codigoBarras"}},[a("q-autocomplete",{attrs:{"min-characters":3},on:{search:e.buscarCodigoBarras,selected:e.selecionarItemCodigoBarras}})],1)],1),e.dataTmp.documentoItens.length?e._l(e.dataTmp.documentoItens,function(t,o){return a("div",{key:o,staticClass:"items-carrinho items-center row q-py-sm q-mx-lg"},[a("div",{staticClass:"col-auto"},[a("avatar",{attrs:{imagem:e.buscarItem(t.idItem).imagem,rotulo:t.descricaoItem,tamanho:"40"}})],1),a("q-toolbar",{staticClass:"Venda-itemBarra bg-transparent col q-pr-none q-py-none",attrs:{color:"black",inverted:""}},[a("q-toolbar-title",{staticClass:"q-px-none"},[a("span",{staticClass:"q-body-2"},[e._v(e._s(t.descricaoItem))]),a("span",{attrs:{slot:"subtitle"},slot:"subtitle"},[e._v(e._s(e.buscarItem(t.idItem).marca))])]),a("badge",{attrs:{denso:""}},[e._v(e._s(t.tipoItem)+" "+e._s(e.buscarItem(t.idItem).referencia))]),e.readonly?e._e():a("q-btn",{attrs:{color:"faded",dense:"",flat:"",icon:"delete",round:""},on:{click:function(t){e.removerItem(o)}}},[a("q-tooltip",[e._v("Remover Item")])],1)],1),a("div",{staticClass:"col-12",staticStyle:{"margin-top":"-10px"}},[a("div",{staticClass:"gutter-x-sm row"},[a("q-field",{staticClass:"col-4 col-sm-3 col-lg-2",attrs:{warning:!!e.warningLabel[t.id],"warning-label":e.warningLabel[t.id]}},[a("campo",{attrs:{"class-campo":"u-campoCompacto",align:"left",tipo:"decimal",decimals:"2","somente-leitura":e.readonly,"hide-underline":""},on:{blur:function(t){e.calculaTotalItem(o,"valorItem")}},model:{value:t.valorItem,callback:function(a){e.$set(t,"valorItem",a)},expression:"item.valorItem"}}),a("q-tooltip",[e._v("Valor do produto")])],1),a("q-field",{staticClass:"col-4 col-sm-3 col-lg-2"},[a("campo",{attrs:{"class-campo":"u-campoCompacto ",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",prefix:"─",suffix:"%","somente-leitura":e.readonly,"hide-underline":""},on:{blur:function(t){e.calculaTotalItem(o,"descontoPercentualItem")}},model:{value:t.descontoPercentualItem,callback:function(a){e.$set(t,"descontoPercentualItem",a)},expression:"item.descontoPercentualItem"}}),a("q-tooltip",[e._v("Desconto percentual")])],1),a("q-field",{staticClass:"col-4 col-sm-3 col-lg-2"},[a("campo",{attrs:{"class-campo":"u-campoCompacto",opcoes:{maximumValue:t.valorItem,minimumValue:0},tipo:"decimal",decimals:"2","hide-underline":"","somente-leitura":e.readonly},on:{blur:function(t){e.calculaTotalItem(o,"descontoItem")}},model:{value:t.descontoItem,callback:function(a){e.$set(t,"descontoItem",a)},expression:"item.descontoItem"}}),a("q-tooltip",[e._v("Desconto em reais")])],1),a("q-field",{staticClass:"col-3 col-lg-2"},[a("campo",{attrs:{"class-campo":"u-campoCompacto text-weight-bold",align:e.$q.screen.lt.sm?"left":"right",opcoes:{maximumValue:t.valorItem,minimumValue:0},prefix:e.$q.screen.lt.sm?"":"=",suffix:e.$q.screen.lt.sm?"×":"",tipo:"decimal",decimals:"2","somente-leitura":e.readonly,"hide-underline":""},on:{blur:function(t){e.calculaTotalItem(o,"subTotal")}},model:{value:e.subTotal[t.id],callback:function(a){e.$set(e.subTotal,t.id,a)},expression:"subTotal[item.id]"}}),a("q-tooltip",[e._v("Subtotal")])],1),a("q-field",{staticClass:"col-5 col-sm-8 col-lg-2"},[a("campo",{attrs:{"class-campo":"u-campoCompacto",min:"1","somente-leitura":e.readonly,tipo:"quantidade","hide-underline":""},on:{input:function(t){e.calculaTotalItem(o,"quantidade")}},model:{value:t.quantidade,callback:function(a){e.$set(t,"quantidade",a)},expression:"item.quantidade"}}),a("q-tooltip",[e._v("Quantidade")])],1),a("q-field",{staticClass:"col-4 col-lg-2"},[a("campo",{attrs:{"class-campo":"u-campoCompacto text-weight-bold","hide-underline":"","somente-leitura":"",tipo:"decimal",prefix:"= ",decimals:"2"},model:{value:t.total,callback:function(a){e.$set(t,"total",a)},expression:"item.total"}}),a("q-tooltip",[e._v("Total")])],1)],1)])],1)}):a("div",{staticClass:"q-pa-lg text-center"},[a("p",[e._v("Não há itens no carrinho")]),a("p",{staticClass:"q-caption"},[e._v("Para adicionar, utilize os botões acima ou insira o código de barras")])])],2)],1),a("div",{staticClass:"bg-white q-mt-md q-py-sm"},[a("q-card",{staticClass:"q-pa-lg q-mb-md bg-white no-shadow"},[a("div",{staticClass:"gutter-x-sm row"},[a("div",{staticClass:"col-12 col-lg-8"},[a("campo",{attrs:{maxlength:"10",rotulo:"Previsão de Entrega",tipo:"data",erro:!!e.erroDataHoraPrevisto,"erro-rotulo":e.erroDataHoraPrevisto,somenteLeitura:e.readonly},model:{value:e.dataTmp.documento.dataHoraPrevisto,callback:function(t){e.$set(e.dataTmp.documento,"dataHoraPrevisto",t)},expression:"dataTmp.documento.dataHoraPrevisto"}}),a("campo",{attrs:{maxlength:"10",rotulo:"Garantia do(s) Serviço(s)",tipo:"data",erro:!!e.erroDataGarantiaFim,"erro-rotulo":e.erroDataGarantiaFim,somenteLeitura:e.readonly},model:{value:e.dataGarantiaFim,callback:function(t){e.dataGarantiaFim=t},expression:"dataGarantiaFim"}}),a("campo",{staticClass:"col-12 col-sm-4",attrs:{value:e.descricaoResponsavel,before:[{icon:"search",handler:e.abrirModalResponsavel}],rotulo:"Técnico",somenteLeitura:e.readonly},on:{click:e.abrirModalResponsavel}})],1),a("div",{staticClass:"col-12 col-lg-4 q-mt-md"},[a("div",{staticClass:"row gutter-x-sm"},[a("div",{staticClass:"col-4 q-mt-sm",staticStyle:{"padding-top":"8px"}},[e._v("\n                      Total\n                    ")]),a("strong",{staticClass:"col-8 q-mt-sm text-right",staticStyle:{"padding-top":"8px"}},[e._v("\n                      "+e._s(e._f("numero")(e.dataTmp.documento.totalDocumento,2))+"\n                    ")])])])])])],1)],1)])],1)]),a("prompt-codigo-barras",{on:{escanear:e.escanearCodigoBarras},model:{value:e.modalCodigoBarras,callback:function(t){e.modalCodigoBarras=t},expression:"modalCodigoBarras"}}),a("prompt-item-novo",{ref:"promptItem",attrs:{filtro:e.modalItem.filtros,habilitarQuantidade:!0},on:{selecionarItens:e.selecionarItens},model:{value:e.modalItem.visivel,callback:function(t){e.$set(e.modalItem,"visivel",t)},expression:"modalItem.visivel"}}),a("prompt-contato-novo",{attrs:{filtro:{ativo:!0,tecnicos:!0}},on:{selecionar:e.selecionarResponsavel},model:{value:e.modalResponsavel,callback:function(t){e.modalResponsavel=t},expression:"modalResponsavel"}})],1)},Z=[];W._withStripped=!0;var ee=a("ff19"),te=a("c281"),ae=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.apenasIcone?a("q-btn",{attrs:{color:"primary",flat:"",icon:"search",label:"Equipamento"},on:{click:function(t){e.modal=!0}}}):a("campo",{attrs:{value:e.descricaoEquipamento,before:[{icon:"search",handler:function(){return e.modal=!0}}],rotulo:e.rotulo,"apenas-leitura":""},on:{click:function(t){e.modal=!0}}}),a("PromptEquipamento",{attrs:{filtro:e.filtro},on:{selecionar:e.selecionar},model:{value:e.modal,callback:function(t){e.modal=t},expression:"modal"}})],1)},oe=[];ae._withStripped=!0;var re=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("prompt",{attrs:{value:e.value,prop:{dados:e.dados,esquema:e.esquema,ordens:e.ordens}},on:{input:e.eventoInput,hide:e.aoFechar},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.itens;return[0===o.length?a("div",{staticClass:"bg-light q-pa-lg round-borders text-black text-center"},[e._v("\n      Não encontramos equipamento com os critérios selecionados.\n    ")]):e._e(),a("q-list",{attrs:{link:"","no-border":"",separator:""}},e._l(o,function(t){return a("q-item",{key:t.id,nativeOn:{click:function(a){e.selecionar(t)}}},[a("q-item-main",[a("div",{staticClass:"col-12 q-pb-md"},[a("strong",[e._v(e._s(t.tipo||"Equipamento"))])]),a("EquipamentoCard",{attrs:{equipamento:t}})],1)],1)}))]}}])})},ne=[];re._withStripped=!0;var ie=a("7979"),se={components:{EquipamentoCard:ee["a"],Prompt:ie["a"]},computed:{botoes:function(){return[]}},data:function(){return{dados:[],esquema:[{prioridade:.8,rotulo:"Descrição",tipo:"texto",valor:"descricao"},{prioridade:.8,rotulo:"Placa",tipo:"texto",valor:"placa"},{prioridade:.4,rotulo:"Marca",tipo:"texto",valor:"marca"},{prioridade:.8,rotulo:"Modelo",tipo:"texto",valor:"modelo"},{prioridade:.2,rotulo:"Cor",tipo:"texto",valor:"cor"},{prioridade:.2,rotulo:"Número de série",tipo:"texto",valor:"numeroSerie"},{prioridade:.2,rotulo:"Chassi",tipo:"texto",valor:"chassi"},{prioridade:.2,rotulo:"Tipo",tipo:"texto",valor:"tipo"},{prioridade:.2,rotulo:"BTU",tipo:"texto",valor:"btu"},{prioridade:.4,rotulo:"Observacao",tipo:"texto",valor:"observacao"}],ordens:[{icone:"arrow_downward",padrao:!0,rotulo:"Descrição",valor:"descricao"},{icone:"arrow_upward",ordem:"desc",rotulo:"Descrição invertida",valor:"descricao"}]}},methods:{aoFechar:function(){this.$emit("hide")},eventoInput:function(e){this.$emit("input",e)},selecionar:function(e){this.$emit("selecionar",e),this.$emit("input",!1)}},props:{filtro:{default:function(){return{}},type:Object},value:{required:!0,type:Boolean}},watch:{value:function(){var e=i()(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!t){e.next=7;break}return this.$utils.gconsole.log("PromptEquipamento",this.filtro),e.next=4,this.$db.equipamento.le(this.filtro);case 4:this.dados=e.sent,e.next=8;break;case 7:this.dados=[];case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}},ce=se,le=Object(P["a"])(ce,re,ne,!1,null,null,null);le.options.__file="PromptEquipamento.vue";var de=le.exports,ue={components:{PromptEquipamento:de},data:function(){return{descricaoEquipamento:"",campos:{},modal:!1}},methods:{atualizar:function(){var e=i()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$db.equipamento.le({id:this.value});case 3:this.campos=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e["catch"](0),this.$q.notifyError("Erro ao consultar equipamento",e.t0);case 9:case"end":return e.stop()}},e,this,[[0,6]])}));return function(){return e.apply(this,arguments)}}(),selecionar:function(e){try{this.mostraDescricao&&(this.descricaoEquipamento=e.placa||e.descricao||e.marca+" - "+e.modelo||e.tipo||e.id),this.campos=e,this.$emit("input",e.id),this.$emit("selecionar",e),this.modal=!1}catch(e){this.$q.notifyError("Erro ao selecionar",e)}}},props:{value:{default:"",type:String},rotulo:{default:"",type:String},filtro:{type:Object},mostraDescricao:{default:!1,type:Boolean},apenasIcone:{default:!1,type:Boolean}},watch:{value:function(){var e=i()(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t!==this.campos.id&&this.atualizar();case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},created:function(){this.atualizar()}},me=ue,pe=Object(P["a"])(me,ae,oe,!1,null,null,null);pe.options.__file="SeletorEquipamento.vue";var ve=pe.exports,he={documento:{},documentoItens:[],arquivo:[]},fe={components:{Arquivo:C["a"],Avatar:p["a"],Badge:v["a"],Campo:h["a"],EquipamentoCard:ee["a"],EquipamentoModal:te["a"],PromptCodigoBarras:x["a"],PromptContatoNovo:V["a"],PromptItemNovo:q["a"],SeletorEquipamento:ve},computed:{erroDataGarantiaFim:function(){if(this.checarErros&&this.dataGarantiaFim){var e=(new Date).setHours(0,0,0,0);if(new Date(this.dataGarantiaFim)<new Date(e))return"Data garantia incorreta"}return""},erroDataHoraPrevisto:function(){if(this.checarErros){if(!this.dataTmp.documento.dataHoraPrevisto)return"Campo obrigatório";var e=(new Date).setHours(0,0,0,0);if(new Date(this.dataTmp.documento.dataHoraPrevisto)<new Date(e))return"Previsão de entrega incorreta"}return""},erroDescricao:function(){return this.checarErros&&!this.dataTmp.documento.descricao?"Campo obrigatório":""},new:function(){var e=this,t=!0,a=!1,o=void 0;try{for(var r,n=this.dataTmp.documentoItens[Symbol.iterator]();!(t=(r=n.next()).done);t=!0){var i=r.value;i.descricaoAgrupamento=this.descricaoAgrupamento,"Serviço"===i.tipoItem&&(i.dataGarantiaFim=this.dataGarantiaFim)}}catch(e){a=!0,o=e}finally{try{t||null==n.return||n.return()}finally{if(a)throw o}}return m()({},this.data,this.dataTmp,{arquivo:this.$refs.arquivo.arquivo.map(function(t){return m()({},t,{idTabelaMaster:e.dataTmp.documento.id,tabelaMaster:"os"})})})},readonly:function(){return"Orçamento"!==this.dataTmp.documento.status}},data:function(){return{checarErros:!1,codigoBarras:"",contato:{},dataGarantiaFim:"",dataTmp:{},descricaoAgrupamento:"",descricaoResponsavel:"",entrarCodigoBarras:!1,equipamento:{},modalCodigoBarras:!1,modalEquipamento:{visivel:!1,campos:{}},modalItem:{},modalResponsavel:!1,subTotal:{},visible:!1,valoresTabelaPreco:[],warningLabel:{},permissao:{}}},methods:{abrirModalCodigoBarras:function(){this.modalCodigoBarras=!0},abrirModalItem:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a,o,r,n,i,s,c,l;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a={},o=!0,r=!1,n=void 0,e.prev=4,i=this.dataTmp.documentoItens[Symbol.iterator]();case 6:if(o=(s=i.next()).done){e.next=21;break}if(c=s.value,c.idItem){e.next=10;break}return e.abrupt("continue",18);case 10:if(this.item||(this.item={}),this.item[c.idItem]){e.next=15;break}return e.next=14,Object(O["a"])().item.get(c.idItem);case 14:this.item[c.idItem]=e.sent;case 15:l=Object(w["clonarV2"])(this.item[c.idItem]),l.novoValorVenda=c.valorReal,a[c.idItem]={item:l,quantidade:c.quantidade};case 18:o=!0,e.next=6;break;case 21:e.next=27;break;case 23:e.prev=23,e.t0=e["catch"](4),r=!0,n=e.t0;case 27:e.prev=27,e.prev=28,o||null==i.return||i.return();case 30:if(e.prev=30,!r){e.next=33;break}throw n;case 33:return e.finish(30);case 34:return e.finish(27);case 35:this.$refs.promptItem.itensSelecionados=a,this.modalItem.filtros={ativo:!0,tipo:t,idEmpresa:this.dataTmp.documento.idEmpresa,idTabelaPreco:this.dataTmp.documento.idItemTabelaPreco},this.modalItem.visivel=!0;case 38:case"end":return e.stop()}},e,this,[[4,23,27,35],[28,,30,34]])}));return function(t){return e.apply(this,arguments)}}(),abrirModalResponsavel:function(){this.readonly||(this.modalResponsavel=!0)},buscarCodigoBarras:function(){var e=i()(regeneratorRuntime.mark(function e(t,a){var o,r,n,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=(t||"").trim().replace(/(\S+\s)|(\S+$)/g,"codigoBarras:$1$2"),t){e.next=3;break}return e.abrupt("return",a([]));case 3:return o=this.$filters,r=o.dinheiro,n=o.numero,e.next=6,k["a"].itemBusca.filtrar(t,{ativo:!0,tipo:["Produto","Serviço"]},10);case 6:if(i=e.sent,i=i.map(function(e){return{value:e.id,label:e.descricao,sublabel:"".concat(r(e.valorVenda)," | ").concat(n(e.quantidadeDisponivel)+e.unidade),stamp:e.codigoBarras,item:e}}),!this.entrarCodigoBarras||1!==i.length){e.next=10;break}return e.abrupt("return",this.selecionarItemCodigoBarras(i[0]));case 10:if("function"!==typeof a){e.next=12;break}return e.abrupt("return",a(i));case 12:this.$q.notifyError("Nenhum item foi encontrado.");case 13:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}(),buscarItem:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return a={marca:"",referencia:"",imagem:""},e.next=3,k["a"].item.le({id:t});case 3:return o=e.sent,a.marca=(o||{}).marca||"",a.referencia=(o||{}).referencia||"",a.imagem=(o||{}).imagem||"",e.abrupt("return",a);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),calculaTotal:function(){var e=Object(w["clonarV2"])(this.dataTmp.documento),t=0,a=!0,o=!1,r=void 0;try{for(var n,i=this.dataTmp.documentoItens[Symbol.iterator]();!(a=(n=i.next()).done);a=!0){var s=n.value;t+=s.valorRealTotal}}catch(e){o=!0,r=e}finally{try{a||null==i.return||i.return()}finally{if(o)throw r}}e.subTotal=Object(w["arredondar"])(t),e.totalDocumento=e.subTotal,this.dataTmp.documento=e},calculaTotalItem:function(){var e=i()(regeneratorRuntime.mark(function e(t,a){var o,r,n,i,s,c=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(o=Object(w["clonarV2"])(this.dataTmp.documentoItens[t]),"quantidade"!==a||!this.dataTmp.documento.idItemTabelaPreco){e.next=10;break}return e.next=4,Object(O["a"])().itemTabelaPreco.get(this.dataTmp.documento.idItemTabelaPreco);case 4:if(r=e.sent,!r){e.next=10;break}return e.next=8,this.configurarValoresTabelaPreco(r,o);case 8:n=this.valoresTabelaPreco.find(function(e){return e.id===o.id}),n.quantidadeMaiorQue&&o.quantidade>=n.quantidadeMaiorQue?(o.valorOriginal!==n.valorVendaMaiorQue&&(o.valorOriginal=o.valorItem=n.valorVendaMaiorQue,o.descontoItem=o.descontoPercentualItem=0),this.warningLabel[o.id]="Valor Diferenciado"):(o.valorOriginal!==n.valorVenda&&(o.valorOriginal=o.valorItem=n.valorVenda,o.descontoItem=o.descontoPercentualItem=0),this.warningLabel[o.id]="");case 10:return o.valorItem<o.valorOriginal&&(o.valorItem=o.valorOriginal),"descontoPercentualItem"===a&&(o.descontoItem=Object(w["arredondar"])(o.descontoPercentualItem/100*o.valorItem)),["descontoItem","valorItem"].includes(a)&&(o.descontoPercentualItem=Object(w["arredondar"])(o.descontoItem/o.valorItem*100)),o.descontoItem>o.valorItem&&(o.descontoPercentualItem=o.descontoItem=0),["subTotal"].includes(a)&&(void 0!==this.subTotal[o.id]?o.descontoItem=Object(w["arredondar"])(o.valorItem-this.subTotal[o.id]):o.descontoItem=Object(w["arredondar"])(o.valorItem-o.subTotal),o.descontoPercentualItem=Object(w["arredondar"])(o.descontoItem/o.valorItem*100)),i=o.valorItem-o.descontoItem,Object(w["arredondar"])(i)>Object(w["arredondar"])(o.valorItem)&&(i=o.valorItem,o.descontoPercentualItem=o.descontoItem=0),void 0===this.subTotal[o.id]?this.$set(this.subTotal,o.id,i):this.subTotal[o.id]=i,o.subTotal=Object(w["arredondar"])(i*o.quantidade),o.total=o.subTotal,o.valorReal=Object(w["arredondar"])(i),o.valorRealTotal=o.total,e.next=24,Object(w["imposto"])(o.idItem,o.idCfop,this.dataTmp.documento.idEmpresa,this.dataTmp.documento.idContato);case 24:s=e.sent,o.valorIpi=Object(w["arredondar"])(Object(I["get"])(s,"aliqIpi",0)/100*o.valorRealTotal),o.valorIcmsSt=Object(w["arredondar"])(Object(I["get"])(s,"percIva",0)/100*o.valorRealTotal),"valorItem"===a?(this.$set(this.dataTmp.documentoItens,t,m()({},o,{valorItem:0})),this.$nextTick(function(){c.$set(c.dataTmp.documentoItens,t,o),c.calculaTotal()})):this.$set(this.dataTmp.documentoItens,t,o),this.calculaTotal();case 29:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}(),configurarValoresTabelaPreco:function(){var e=i()(regeneratorRuntime.mark(function e(t,a){var o,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(o=this.valoresTabelaPreco.find(function(e){return e.id===a.id}),!o){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,Object(O["a"])().item.get(a.idItem);case 5:return r=e.sent,e.next=8,k["a"].itemTabelaPreco.obterValores(t,r);case 8:o=e.sent,this.valoresTabelaPreco.push(m()({id:a.id},o));case 10:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}(),close:function(){var e=i()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.isEqual()){e.next=9;break}return e.prev=1,e.next=4,this.$q.dialog({cancel:"Cancelar",message:"Ao continuar você irá perder todas as modificações.",noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e["catch"](1),e.abrupt("return");case 9:this.visible=!1;case 10:case"end":return e.stop()}},e,this,[[1,6]])}));return function(){return e.apply(this,arguments)}}(),escanearCodigoBarras:function(e){this.fecharModalCodigoBarras(),this.$refs.codigoBarras.focus(),this.entrarCodigoBarras=!0,this.buscarCodigoBarras(e)},isEqual:function(){var e=m()({},he,Object(w["clonarV2"])(this.data)),t=Object(w["diferencaObjetos"])(e,this.new);return!Object.keys(t).length},leitorCodigoBarras:function(e){e.ctrlKey&&74===e.keyCode?e.preventDefault():13===e.keyCode&&(this.entrarCodigoBarras=!0)},refresh:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a,o,r,n,i,s=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:for(this.dataTmp=m()({},he,Object(w["clonarV2"])(this.data)),this.warningLabel={},this.valoresTabelaPreco=[],this.checarErros=!1,this.descricaoAgrupamento="",this.dataGarantiaFim="",this.descricaoAgrupamento=Object(I["get"])(this.dataTmp.documentoItens.find(function(e){return e.id}),"descricaoAgrupamento",""),this.dataGarantiaFim=Object(I["get"])(this.dataTmp.documentoItens.find(function(e){return"Serviço"===e.tipoItem}),"dataGarantiaFim",""),t=!0,a=!1,o=void 0,e.prev=11,r=this.dataTmp.documentoItens[Symbol.iterator]();!(t=(n=r.next()).done);t=!0)i=n.value,this.$set(this.subTotal,i.id,i.valorItem-i.descontoItem);e.next=19;break;case 15:e.prev=15,e.t0=e["catch"](11),a=!0,o=e.t0;case 19:e.prev=19,e.prev=20,t||null==r.return||r.return();case 22:if(e.prev=22,!a){e.next=25;break}throw o;case 25:return e.finish(22);case 26:return e.finish(19);case 27:return this.contato={codigo:"",descricao:"",imagem:""},e.next=30,k["a"].contato.le({id:this.dataTmp.documento.idContato}).then(function(e){s.contato.codigo=e.codigoContato||e.id.slice(-6)||"",s.contato.descricao=e.nome||e.apelido||"",s.contato.imagem=e.imagem||""});case 30:return this.$refs.arquivo.somenteLeitura=this.readonly,this.$refs.arquivo.arquivo=this.data.arquivo,this.descricaoResponsavel="",this.dataTmp.documento.idContatoResponsavel&&this.selecionarResponsavel(this.dataTmp.documento.idContatoResponsavel),e.next=36,k["a"].equipamento.le({id:this.dataTmp.documento.idEquipamento});case 36:this.equipamento=e.sent,this.$nextTick(function(){s.visible=!0});case 38:case"end":return e.stop()}},e,this,[[11,15,19,27],[20,,22,26]])}));return function(){return e.apply(this,arguments)}}(),removerItem:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a=(this.dataTmp.documentoItens[t]||{}).id,this.dataTmp.documentoItens=this.dataTmp.documentoItens.filter(function(e){return e.id!==a}),this.calculaTotal();case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),save:function(){this.checarErros=!0,this.erroDataHoraPrevisto||this.erroDataGarantiaFim||this.erroDescricao?this.$q.notifyError("Erro no preenchimento do formulário"):this.dataTmp.documentoItens.length?(this.isEqual()||(this.$emit("update:data",this.new),this.$emit("changed")),this.visible=!1):this.$q.notifyError("Não há itens no carrinho")},selecionarItemCodigoBarras:function(e){var t=e.item;this.codigoBarras="",this.entrarCodigoBarras=!1,this.selecionarItem(t.id,t)},selecionarItens:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a,o,r=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a=regeneratorRuntime.mark(function e(a){var o,n,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return o=t[a].item||{},n=t[a].quantidade||0,i=r.dataTmp.documentoItens.findIndex(function(e){return e.idItem===a}),e.next=5,r.selecionarItem(a,o,n);case 5:-1===i&&(i=r.dataTmp.documentoItens.findIndex(function(e){return e.idItem===a}),-1!==i&&r.calculaTotalItem(i,"quantidade"));case 6:case"end":return e.stop()}},e)}),e.t0=regeneratorRuntime.keys(t);case 2:if((e.t1=e.t0()).done){e.next=7;break}return o=e.t1.value,e.delegateYield(a(o),"t2",5);case 5:e.next=2;break;case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),selecionarItem:function(){var e=i()(regeneratorRuntime.mark(function e(t,a,o){var r,n,i,s,c,l,d;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(r=this.dataTmp.documentoItens.findIndex(function(e){return e.idItem===t}),-1===r){e.next=5;break}return a.novoValorVenda!==this.dataTmp.documentoItens[r].valorOriginal&&(a.novoValorVenda<=this.dataTmp.documentoItens[r].valorOriginal?(this.dataTmp.documentoItens[r].valorItem=this.dataTmp.documentoItens[r].valorOriginal,this.dataTmp.documentoItens[r].descontoItem=Object(w["arredondar"])(this.dataTmp.documentoItens[r].valorOriginal-a.novoValorVenda)):(this.dataTmp.documentoItens[r].valorItem=a.novoValorVenda,this.dataTmp.documentoItens[r].descontoItem=0),this.calculaTotalItem(r,"descontoItem")),this.dataTmp.documentoItens[r].quantidade!==o&&(this.dataTmp.documentoItens[r].quantidade=o||1,this.calculaTotalItem(r,"quantidade")),e.abrupt("return");case 5:return e.next=7,k["a"].documentoOperacao.le({codigoDocumentoOperacao:this.dataTmp.documento.codigoDocumentoOperacao});case 7:if(n=e.sent,n||n.length){e.next=11;break}return this.$q.notify("Não foi possível localizar a Operação."),e.abrupt("return");case 11:return e.next=13,k["a"].cfop.le({id:n[0].idCfop});case 13:if(i=e.sent,i.id){e.next=17;break}return this.$q.notify("Não foi possível localizar o CFOP."),e.abrupt("return");case 17:return e.next=19,k["a"].estoqueSaldoProdutoEmpresa.le({idItem:a.id,idEmpresa:Object(I["get"])(this.dataTmp,"documento.idEmpresa",""),tipoEstoque:"Disponível"});case 19:return e.t0=function(e){return e.idItem},s=e.sent.find(e.t0),e.next=23,Object(w["imposto"])(a.id,i.id,this.dataTmp.documento.idEmpresa,this.dataTmp.documento.idContato);case 23:return c=e.sent,l=Object(w["uuid"])(),this.$set(this.subTotal,l,a.valorVenda),e.next=28,Object(w["trocarCfop"])(a.ncm,i.cfop);case 28:d=e.sent,d&&(i=d),this.dataTmp.documentoItens.push({id:l,idItem:a.id,idDocumento:this.dataTmp.documento.documentoId,idDocumentoAdicional:this.dataTmp.documento.id,codigoCfop:"Serviço"===a.tipo?"":i.codigoCfop,codigoPlanoContaDestino:139,codigoPlanoContaEstoque:146,dataHoraEmissao:Object(w["dataAtual"])(),descontoItem:0,descontoPercentualItem:0,descontoSubTotal:0,descricaoItem:a.descricaoConcatenada,operacao:"Serviço"===a.tipo?"Ordem de Serviço":i.operacao,operacaoFator:"Serviço"===a.tipo?"":i.fator,idCfop:i.id,quantidade:o||1,status:this.dataTmp.documento.status,subTotal:a.valorVenda,tipoItem:a.tipo,total:a.valorVenda,valorCusto:0,valorCustoMedio:Object(I["get"])(s,"valorCustoMedio",0),valorCustoReposicao:a.valorCustoReposicao||0,valorCustoUltimo:Object(I["get"])(s,"valorCusto",0),valorItem:a.valorVenda,valorItemUltimo:0,valorOriginal:a.valorVenda,valorReal:a.valorVenda,valorRealTotal:a.valorVenda,valorIpi:Object(w["arredondar"])(Object(I["get"])(c,"aliqIpi",0)/100*a.valorVenda),valorIcmsSt:Object(w["arredondar"])(Object(I["get"])(c,"percIva",0)/100*a.valorVenda)}),r=this.dataTmp.documentoItens.findIndex(function(e){return e.idItem===t}),-1!==r&&a.novoValorVenda!==this.dataTmp.documentoItens[r].valorOriginal&&(a.novoValorVenda<=this.dataTmp.documentoItens[r].valorOriginal?(this.dataTmp.documentoItens[r].valorItem=this.dataTmp.documentoItens[r].valorOriginal,this.dataTmp.documentoItens[r].descontoItem=Object(w["arredondar"])(this.dataTmp.documentoItens[r].valorOriginal-a.novoValorVenda)):(this.dataTmp.documentoItens[r].valorItem=a.novoValorVenda,this.dataTmp.documentoItens[r].descontoItem=0),this.calculaTotalItem(r,"descontoItem")),o||this.calculaTotal();case 34:case"end":return e.stop()}},e,this)}));return function(t,a,o){return e.apply(this,arguments)}}(),selecionarResponsavel:function(){var e=i()(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.dataTmp.documento.idContatoResponsavel=t||"",e.next=3,k["a"].contato.le({id:t});case 3:if(e.t0=e.sent.apelido,e.t0){e.next=6;break}e.t0="";case 6:this.descricaoResponsavel=e.t0;case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},props:{data:{required:!0,type:Object},value:{required:!0,type:Boolean}},watch:{value:function(e){e&&this.refresh()},visible:function(e){e||this.$emit("input",e)}},created:function(){var e=this;this.permissao={equipamento:!1},k["a"].permissao.objeto("atendimento//equipamento").then(function(t){e.permissao.equipamento=t}),this.dataTmp=m()({},he),this.modalItem={filtros:{},visivel:!1}}},be=fe,ge=(a("febd"),Object(P["a"])(be,W,Z,!1,null,"2ad1d7b7",null));ge.options.__file="OrdemServico.vue";var Ce=ge.exports,xe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-modal",{attrs:{maximized:""},model:{value:e.visivel,callback:function(t){e.visivel=t},expression:"visivel"}},[a("q-modal-layout",[a("q-toolbar",{attrs:{slot:"header"},slot:"header"},[a("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"arrow_back",round:""}}),a("q-toolbar-title",[a("q-search",{ref:"search",attrs:{color:"none",inverted:"",placeholder:e.placeholder,debounce:600,after:[{icon:"close",content:!0,handler:function(){e.limpar(),e.atualizar()}}]},on:{input:e.atualizar},model:{value:e.termo,callback:function(t){e.termo=t},expression:"termo"}})],1)],1),a("div",{staticClass:"layout-padding"},[e.carregando?a("div",{staticClass:"q-mt-lg text-center"},[a("q-spinner",{attrs:{color:"faded",size:50}})],1):e._e(),!e.carregando&&e.registrosEncontrados?a("div",[a("q-list",{attrs:{link:"","no-border":"",separator:""}},e._l(e.documentos,function(t){return a("q-item",{key:t.id,nativeOn:{click:function(a){e.selecionar(t)}}},[a("q-item-main",[a("q-item-tile",{attrs:{label:""}},[e._v(e._s(t.descricao))]),a("q-item-tile",{attrs:{sublabel:""}},[a("strong",[e._v("CFOP: ")]),e._v(e._s((e.cfop[t.codigoCfop]||{}).cfop)+" - "+e._s(t.operacao))])],1)],1)}))],1):e._e(),e.carregando||e.registrosEncontrados?e._e():a("div",{staticClass:"bg-light q-pa-lg round-borders text-black text-center"},[e._v("\n        Não encontramos registros com os critérios selecionados.\n      ")])])],1)],1)},qe=[];xe._withStripped=!0;a("386d");var Oe=a("ffe7"),ke=a.n(Oe),Ie={computed:{registrosEncontrados:function(){return!!this.documentos.length}},data:function(){return{carregando:!0,cfop:{},documentos:[],termo:"",visivel:!1}},methods:{atualizar:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a,o,r,n,i,s,c,l,d,u;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.carregando=!0,e.next=3,Object(O["a"])().documentoOperacao.toArray();case 3:t=e.sent,a=!0,o=!1,r=void 0,e.prev=7,n=t[Symbol.iterator]();case 9:if(a=(i=n.next()).done){e.next=22;break}if(s=i.value,!s.codigoCfop||this.cfop[s.codigoCfop]){e.next=18;break}return c=void 0,l=void 0,e.next=15,Object(O["a"])().cfop.where({codigoCfop:s.codigoCfop}).toArray();case 15:c=e.sent,l=c.find(function(e){return e.codigoCfop})||{},l.codigoCfop&&(this.cfop[l.codigoCfop]={cfop:l.cfop,operacao:(l.operacao||"").trim()});case 18:s.operacao=(this.cfop[s.codigoCfop]||{}).operacao||"";case 19:a=!0,e.next=9;break;case 22:e.next=28;break;case 24:e.prev=24,e.t0=e["catch"](7),o=!0,r=e.t0;case 28:e.prev=28,e.prev=29,a||null==n.return||n.return();case 31:if(e.prev=31,!o){e.next=34;break}throw r;case 34:return e.finish(31);case 35:return e.finish(28);case 36:this.termo?(d=!!this.termo.replace(/[^\d]/g,""),u=new ke.a(t,{keys:[{name:"descricao"},{name:"operacao"},d?{name:"codigoCfop"}:{}]}),t=u.search(this.termo.trim())):t=Object(I["orderBy"])(t,["descricao"],["asc"]),this.documentos=t.slice(0,30),this.carregando=!1;case 39:case"end":return e.stop()}},e,this,[[7,24,28,36],[29,,31,35]])}));return function(){return e.apply(this,arguments)}}(),limpar:function(){this.documentos=[],this.termo=""},selecionar:function(e){this.documento=e,this.visivel=!1}},props:{filtro:{default:function(){return{}},type:Object},placeholder:{default:"Buscar",type:String},value:{required:!0,type:Boolean}},watch:{visivel:function(e){e?this.atualizar():(this.$emit("selecionar",this.documento?m()({},this.documento):{},!0),this.$emit("input",!1),this.limpar())},value:function(e){this.visivel=e}},updated:function(){this.$refs.search.focus()}},we=Ie,Ee=Object(P["a"])(we,xe,qe,!1,null,null,null);Ee.options.__file="PromptDocumentoOperacaoNovo.vue";var ye=Ee.exports,_e=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-modal",{attrs:{maximized:""},model:{value:e.visivel,callback:function(t){e.visivel=t},expression:"visivel"}},[a("q-modal-layout",[a("q-toolbar",{attrs:{slot:"header"},slot:"header"},[a("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"arrow_back",round:""}}),a("q-toolbar-title",[a("q-search",{ref:"search",attrs:{color:"none",inverted:"",placeholder:e.placeholder,debounce:600,after:[{icon:"close",content:!0,handler:function(){e.limpar(),e.atualizar()}}]},on:{input:e.atualizar},model:{value:e.termo,callback:function(t){e.termo=t},expression:"termo"}})],1)],1),a("div",{staticClass:"layout-padding"},[e.carregando?a("div",{staticClass:"q-mt-lg text-center"},[a("q-spinner",{attrs:{color:"faded",size:50}})],1):e._e(),!e.carregando&&e.registrosEncontrados?a("div",[a("q-list",{attrs:{link:"","no-border":"",separator:""}},e._l(e.itens,function(t){return a("q-item",{key:t.id,nativeOn:{click:function(a){e.selecionar(t)}}},[a("q-item-main",[a("q-item-tile",{attrs:{label:""}},[e._v(e._s(t.descricao))]),t.empresa?a("q-item-tile",{attrs:{sublabel:""}},[a("strong",[e._v("Empresa: ")]),e._v(e._s(t.empresa)+"\n              ")]):e._e()],1)],1)}))],1):e._e(),e.carregando||e.registrosEncontrados?e._e():a("div",{staticClass:"bg-light q-pa-lg round-borders text-black text-center"},[e._v("\n        Não encontramos registros com os critérios selecionados.\n      ")])])],1)],1)},Pe=[];_e._withStripped=!0;var Te={computed:{registrosEncontrados:function(){return!!this.itens.length}},data:function(){return{carregando:!0,itens:[],termo:"",visivel:!1}},methods:{atualizar:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a,o,r,n,i,s,c,l,d,u,m=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.carregando=!0,a={},e.next=4,Object(O["a"])().itemTabelaPreco.filter(function(e){return 1===e.tabelaMaster&&(!e.idEmpresa||e.idEmpresa===m.filtro.idEmpresa)}).toArray();case 4:t=e.sent,o=!0,r=!1,n=void 0,e.prev=8,i=t[Symbol.iterator]();case 10:if(o=(s=i.next()).done){e.next=27;break}if(c=s.value,c.idEmpresa){e.next=14;break}return e.abrupt("continue",24);case 14:if(!a[c.idEmpresa]){e.next=17;break}return c.empresa=a[c.idEmpresa].nome,e.abrupt("continue",24);case 17:return e.next=19,Object(O["a"])().contato.get(c.idEmpresa);case 19:if(e.t0=e.sent,e.t0){e.next=22;break}e.t0={};case 22:l=e.t0,l.id&&(d=l.nome||"",c.empresa=d,a[l.id]={nome:d});case 24:o=!0,e.next=10;break;case 27:e.next=33;break;case 29:e.prev=29,e.t1=e["catch"](8),r=!0,n=e.t1;case 33:e.prev=33,e.prev=34,o||null==i.return||i.return();case 36:if(e.prev=36,!r){e.next=39;break}throw n;case 39:return e.finish(36);case 40:return e.finish(33);case 41:this.termo?(u=new ke.a(t,{keys:[{name:"descricao"},{name:"empresa"}]}),t=u.search(this.termo.trim())):t=Object(I["orderBy"])(t,"descricao","asc"),this.itens=t.slice(0,30),this.carregando=!1;case 44:case"end":return e.stop()}},e,this,[[8,29,33,41],[34,,36,40]])}));return function(){return e.apply(this,arguments)}}(),limpar:function(){this.itens=[],this.termo=""},selecionar:function(e){this.item=e,this.visivel=!1}},props:{filtro:{default:function(){return{}},type:Object},placeholder:{default:"Buscar",type:String},value:{required:!0,type:Boolean}},watch:{visivel:function(e){e?this.atualizar():(this.$emit("selecionar",this.item?m()({},this.item):{},!0),this.$emit("input",!1),this.limpar())},value:function(e){this.visivel=e}},updated:function(){this.$refs.search.focus()}},De=Te,je=Object(P["a"])(De,_e,Pe,!1,null,null,null);je.options.__file="PromptItemTabelaPrecoNovo.vue";var Fe=je.exports,Se=a("51f0"),Re=a("de7a"),Ne={components:{Avatar:p["a"],Badge:v["a"],Campo:h["a"],ContatoCard:f["a"],Custom:D,DocumentoCodigo:j["a"],DocumentoMetas:F["a"],Envelope:H,Faturamento:U["a"],VendaTransporte:K,OrdemServico:Ce,Prompt:ie["a"],PromptCodigoBarras:x["a"],PromptContatoNovo:V["a"],PromptDocumentoOperacaoNovo:ye,PromptItemNovo:q["a"],PromptItemTabelaPrecoNovo:Fe,SeletorCest:Se["a"],SeletorNcm:Re["a"]},computed:{ehOrcamento:function(){return"ORÇAMENTO"===((this.venda||{}).status||"").toUpperCase()&&"VENDA"===((this.venda||{}).tipo||"").toUpperCase()},estaAberto:function(){var e=["ABERTA","AGUARDANDO FATURAMENTO","AGUARDANDO PAGAMENTO","ORÇAMENTO"];return!!~e.indexOf(((this.venda||{}).status||"").toUpperCase())},ehVenda:function(){return"ORÇAMENTO"!==((this.venda||{}).status||"").toUpperCase()&&"VENDA"===((this.venda||{}).tipo||"").toUpperCase()},temItens:function(){return this.carrinho.length>0},titulo:function(){return"VENDA DE MERCADORIA"===((this.venda||{}).operacao||"").toUpperCase()&&"ORÇAMENTO"===((this.venda||{}).status||"").toUpperCase()&&"VENDA"===((this.venda||{}).tipo||"").toUpperCase()?"Orçamento":"Venda"}},data:function(){return{warningLabel:{},produtoEditandoTab:"tab1",produtoEditandoVisivel:!1,produtoEditando:{},produtoEditandoEstoque:{colunas:[{name:"empresa",label:"Empresa",align:"left"},{name:"tipoEstoque",label:"Tipo estoque",align:"right"},{name:"lote",label:"Lote",align:"right"},{name:"quantidade",label:"Quantidade",align:"right"}],paginacao:{page:1,rowsPerPage:5}},produtoEditandoImposto:{},produtoEditandoHistorico:{colunas:[{name:"documento",label:"Documento",align:"left"},{name:"valorUnitario",label:"Valor Unitário",align:"right"},{name:"quantidade",label:"Quantidade",align:"right"},{name:"valorTotal",label:"Valor Total",align:"right"}],paginacao:{page:1,rowsPerPage:5}},imposto:{},dbUsuario:k["a"].usuario,contatos:{},vendaOriginal:{},venda:{},geraFatura:0,configImpressaoOrcamento:[],configImpressaoEnvelope:[],condicaoPagamento:[],condicaoPagamentoOriginal:[],documentoEndereco:[],documentoEnderecoOriginal:[],documentoContato:[],documentoContatoOriginal:[],documentoStatus:[],exibirCarregando:!1,carrinhoOriginal:[],carrinho:[],item:{},codigoBarras:"",entrarCodigoBarras:!1,modalCodigoBarras:!1,envelopes:{},envelopesOriginal:{},envelope:{},itensEnvelopes:[],itensEnvelopesOriginal:[],modalEnvelope:!1,permissaoMargem:!1,margem:{},oss:[],modalOS:{activated:!1,visible:!1},permissaoOSs:!1,customs:[],modalCustom:{activated:!1,visible:!1},permissaoCustoms:!1,produtos:[],menuVenda:!1,modalContato:!1,modalContatoEmpresa:{visivel:!1,retorno:{},aguardarRetorno:!0},modalConvenio:!1,modalDescontoMaximo:{},modalItemSemEstoque:{},modalItem:!1,mostrarDetalhes:!1,modalComprador:!1,compradores:[],convenios:[],arquivoOriginal:[],arquivo:[],erroCalculo:!1,sistemaPai:"",promptContato:{ativo:!1,visivel:!1,filtro:{},placeholder:""},promptDocumentoOperacao:{ativo:!1,visivel:!1,filtro:{},placeholder:"Selecione a operação"},promptItemTabelaPreco:{ativo:!1,visivel:!1,filtro:{},placeholder:"Selecione a tabela de preço"}}},methods:{subtotal2:function(e){return this.subTotal[e]},salvarEdicaoProduto:function(e){var t=this.carrinho.findIndex(function(t){return t.id===e.id});-1!==t&&this.$set(this.carrinho,t,e),this.unirProdutos(),this.produtoEditandoVisivel=!1},editarProduto:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a,o,r,n,i,s,c,l,d,u,p,v,h,f,b,g,C,x,q,E,y=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.produtoEditando=t,e.next=3,k["a"].estoqueSaldoProdutoEmpresa.le({idItem:t.idItem});case 3:a=e.sent,o={},r=!0,n=!1,i=void 0,e.prev=8,s=a[Symbol.iterator]();case 10:if(r=(c=s.next()).done){e.next=20;break}if(l=c.value,o[l.idEmpresa]){e.next=17;break}return e.next=15,k["a"].contato.le({id:l.idEmpresa});case 15:d=e.sent,d.id&&(o[l.idEmpresa]=d);case 17:r=!0,e.next=10;break;case 20:e.next=26;break;case 22:e.prev=22,e.t0=e["catch"](8),n=!0,i=e.t0;case 26:e.prev=26,e.prev=27,r||null==s.return||s.return();case 29:if(e.prev=29,!n){e.next=32;break}throw i;case 32:return e.finish(29);case 33:return e.finish(26);case 34:return this.produtoEditandoEstoque.estoque=a.map(function(e){return m()({},e,{nomeEmpresa:Object(I["get"])(o[e.idEmpresa],"nome",""),apelidoEmpresa:Object(I["get"])(o[e.idEmpresa],"apelido","")})}),e.next=37,Object(w["imposto"])(t.idItem,t.idCfop,this.venda.idEmpresa,this.venda.idContato);case 37:return u=e.sent,this.produtoEditandoImposto={aliqIpi:Object(w["arredondar"])(Object(I["get"])(u,"aliqIpi",0)),percIva:Object(w["arredondar"])(Object(I["get"])(u,"percIva",0))},e.next=41,Object(O["a"])().documento.where({idContato:this.venda.idContato}).toArray();case 41:p=e.sent,p=p.filter(function(e){return e.id!==y.venda.id}),v={},h=[],f=!0,b=!1,g=void 0,e.prev=48,C=p[Symbol.iterator]();case 50:if(f=(x=C.next()).done){e.next=60;break}return q=x.value,e.next=54,Object(O["a"])().documentoItem.where({idDocumento:q.id,idItem:t.idItem}).toArray();case 54:e.t1=function(e){return e.id},E=e.sent.find(e.t1),E&&(h.push({idDocumento:Object(I["get"])(E,"idDocumento",""),valorReal:Object(I["get"])(E,"valorReal",0),valorItem:Object(I["get"])(E,"valorItem",0),quantidade:Object(I["get"])(E,"quantidade",0),operacaoFator:Object(I["get"])(E,"operacaoFator",0),valorRealTotal:Object(I["get"])(E,"valorRealTotal",0),dataHoraEmissao:Object(I["get"])(E,"dataHoraEmissao",""),dataHoraFinalizado:Object(I["get"])(E,"dataHoraFinalizado",""),docDataHoraEmissao:Object(I["get"])(q,"dataHoraEmissao",""),docDataHoraFinalizado:Object(I["get"])(q,"dataHoraFinalizado","")}),v[q.id]||(v[q.id]={id:Object(I["get"])(q,"id",""),tipo:Object(I["get"])(q,"tipo",""),numero:Object(I["get"])(q,"numero",""),status:Object(I["get"])(q,"status",""),dataHoraFinalizado:Object(I["get"])(q,"dataHoraFinalizado",""),dataHoraEmissao:Object(I["get"])(q,"dataHoraEmissao","")}));case 57:f=!0,e.next=50;break;case 60:e.next=66;break;case 62:e.prev=62,e.t2=e["catch"](48),b=!0,g=e.t2;case 66:e.prev=66,e.prev=67,f||null==C.return||C.return();case 69:if(e.prev=69,!b){e.next=72;break}throw g;case 72:return e.finish(69);case 73:return e.finish(66);case 74:this.produtoEditandoHistorico.documentos=v,this.produtoEditandoHistorico.documentosItens=Object(I["orderBy"])(h,["docDataHoraFinalizado","docDataHoraEmissao","dataHoraFinalizado","dataHoraEmissao"],["desc","desc","desc","desc"]),this.produtoEditandoTab="tab1",this.produtoEditandoVisivel=!0;case 78:case"end":return e.stop()}},e,this,[[8,22,26,34],[27,,29,33],[48,62,66,74],[67,,69,73]])}));return function(t){return e.apply(this,arguments)}}(),calcularMargens:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a,o,r,n,i,s,c,l,d,u,m,p,v,h,f,b,g,C,x,q,O,I,E,y,_,P,T,D,j,F,S,R,N,V=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.t1=parseInt,e.next=3,k["a"].configuracoes.leValorComFiltroEmpresa("vendas.margem.alerta",this.venda.idEmpresa,0);case 3:if(e.t2=e.sent,e.t0=(0,e.t1)(e.t2),e.t0){e.next=7;break}e.t0=0;case 7:return t=e.t0,e.t4=parseInt,e.next=11,k["a"].configuracoes.leValorComFiltroEmpresa("vendas.margem.limite",this.venda.idEmpresa,0);case 11:if(e.t5=e.sent,e.t3=(0,e.t4)(e.t5),e.t3){e.next=15;break}e.t3=0;case 15:for(a=e.t3,o=0,r=0,n=!0,i=!1,s=void 0,e.prev=20,c=this.produtos.filter(function(e){return e.id})[Symbol.iterator]();!(n=(l=c.next()).done);n=!0)d=l.value,u=0,d.valorReal&&d.valorCustoReposicao&&d.quantidade&&(r+=d.valorCustoReposicao*d.quantidade,m=d.valorCustoReposicao,p=d.valorReal,v=p-m,u=Object(w["arredondar"])(v/p*100)),this.$set(this.margem,d.id,{valor:u,alerta:u<=t,limite:u<a});e.next=28;break;case 24:e.prev=24,e.t6=e["catch"](20),i=!0,s=e.t6;case 28:e.prev=28,e.prev=29,n||null==c.return||c.return();case 31:if(e.prev=31,!i){e.next=34;break}throw s;case 34:return e.finish(31);case 35:return e.finish(28);case 36:h=!0,f=!1,b=void 0,e.prev=39,g=this.produtos.filter(function(e){return e.documento})[Symbol.iterator]();case 41:if(h=(C=g.next()).done){e.next=71;break}for(x=C.value,q=0,O=0,I=!0,E=!1,y=void 0,e.prev=47,_=x.documentoItens[Symbol.iterator]();!(I=(P=_.next()).done);I=!0)T=P.value,T.valorCustoReposicao&&T.quantidade&&(O+=T.valorCustoReposicao*T.quantidade);e.next=55;break;case 51:e.prev=51,e.t7=e["catch"](47),E=!0,y=e.t7;case 55:e.prev=55,e.prev=56,I||null==_.return||_.return();case 58:if(e.prev=58,!E){e.next=61;break}throw y;case 61:return e.finish(58);case 62:return e.finish(55);case 63:r+=O,D=x.documento.totalDocumento,j=D-O,q=Object(w["arredondar"])(j/D*100),this.$set(this.margem,x.documento.id,{valor:q,alerta:q<=t,limite:q<a});case 68:h=!0,e.next=41;break;case 71:e.next=77;break;case 73:e.prev=73,e.t8=e["catch"](39),f=!0,b=e.t8;case 77:e.prev=77,e.prev=78,h||null==g.return||g.return();case 80:if(e.prev=80,!f){e.next=83;break}throw b;case 83:return e.finish(80);case 84:return e.finish(77);case 85:for(S in F=function(e){var o=0,n=0,i=!0,s=!1,c=void 0;try{for(var l,d=V.itensEnvelopes.filter(function(t){return t.idDocumentoAdicional===e})[Symbol.iterator]();!(i=(l=d.next()).done);i=!0){var u=l.value;u.valorCustoReposicao&&u.quantidade&&(n+=u.valorCustoReposicao*u.quantidade)}}catch(e){s=!0,c=e}finally{try{i||null==d.return||d.return()}finally{if(s)throw c}}r+=n;var m=V.envelopes[e].totalDocumento,p=m-n;o=Object(w["arredondar"])(p/m*100),V.$set(V.margem,e,{valor:o,alerta:o<=t,limite:o<a})},this.envelopes)F(S);R=this.venda.totalDocumento,N=R-r,o=Object(w["arredondar"])(N/R*100),this.$set(this.margem,this.venda.id,{valor:o,alerta:o<=t,limite:o<a});case 91:case"end":return e.stop()}},e,this,[[20,24,28,36],[29,,31,35],[39,73,77,85],[47,51,55,63],[56,,58,62],[78,,80,84]])}));return function(){return e.apply(this,arguments)}}(),calcularImposto:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a,o,r,n,i,s,c,l,d,u,m,p,v,h,f,b,g,C,x,q,O=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:for(t={valorIpi:0,valorIcmsSt:0},a=!0,o=!1,r=void 0,e.prev=4,n=this.produtos.filter(function(e){return e.id})[Symbol.iterator]();!(a=(i=n.next()).done);a=!0)s=i.value,t.valorIpi+=s.valorIpi,t.valorIcmsSt+=s.valorIcmsSt;e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](4),o=!0,r=e.t0;case 12:e.prev=12,e.prev=13,a||null==n.return||n.return();case 15:if(e.prev=15,!o){e.next=18;break}throw r;case 18:return e.finish(15);case 19:return e.finish(12);case 20:c=!0,l=!1,d=void 0,e.prev=23,u=this.produtos.filter(function(e){return e.documento})[Symbol.iterator]();case 25:if(c=(m=u.next()).done){e.next=49;break}for(p=m.value,v=!0,h=!1,f=void 0,e.prev=30,b=p.documentoItens[Symbol.iterator]();!(v=(g=b.next()).done);v=!0)C=g.value,t.valorIpi+=C.valorIpi,t.valorIcmsSt+=C.valorIcmsSt;e.next=38;break;case 34:e.prev=34,e.t1=e["catch"](30),h=!0,f=e.t1;case 38:e.prev=38,e.prev=39,v||null==b.return||b.return();case 41:if(e.prev=41,!h){e.next=44;break}throw f;case 44:return e.finish(41);case 45:return e.finish(38);case 46:c=!0,e.next=25;break;case 49:e.next=55;break;case 51:e.prev=51,e.t2=e["catch"](23),l=!0,d=e.t2;case 55:e.prev=55,e.prev=56,c||null==u.return||u.return();case 58:if(e.prev=58,!l){e.next=61;break}throw d;case 61:return e.finish(58);case 62:return e.finish(55);case 63:for(q in x=function(e){var a=!0,o=!1,r=void 0;try{for(var n,i=O.itensEnvelopes.filter(function(t){return t.idDocumentoAdicional===e})[Symbol.iterator]();!(a=(n=i.next()).done);a=!0){var s=n.value;t.valorIpi+=s.valorIpi,t.valorIcmsSt+=s.valorIcmsSt}}catch(e){o=!0,r=e}finally{try{a||null==i.return||i.return()}finally{if(o)throw r}}},this.envelopes)x(q);t.valorIpi=Object(w["arredondar"])(t.valorIpi),t.valorIcmsSt=Object(w["arredondar"])(t.valorIcmsSt),this.imposto=t;case 68:case"end":return e.stop()}},e,this,[[4,8,12,20],[13,,15,19],[23,51,55,63],[30,34,38,46],[39,,41,45],[56,,58,62]])}));return function(){return e.apply(this,arguments)}}(),faturamentoAtualizar:function(e){this.condicaoPagamento=e},abrirModalCodigoBarras:function(){this.modalCodigoBarras=!0},abrirModalContato:function(){var e=i()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.modalContato=!0;case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),abrirModalConvenio:function(){var e=i()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,k["a"].contato.leConvenios(this.venda.idContato);case 2:this.convenios=e.sent,this.modalConvenio=!0;case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),abrirModalComprador:function(){var e=i()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,k["a"].contato.leCompradores(this.venda.idContato);case 2:this.compradores=e.sent,this.modalComprador=!0;case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),selecionarComprador:function(){var e=i()(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.documentoContato=this.documentoContato.filter(function(e){return"comprador"!==(e.descricao||"").trim().toLowerCase()}),t&&this.documentoContato.push({id:Object(w["uuid"])(),idContato:t,descricao:"Comprador",idDocumento:this.venda.id}),this.venda=Object(w["clonarV2"])(this.venda),this.modalComprador=!1;case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),salvarCustom:function(e){var t=this,a=Object(w["clonarV2"])(this.customs),o=a.findIndex(function(e){return e.documento.id===t.modalCustom.data.documento.id});e&&(this.modalCustom.data.documento.numero=1),-1===o?a.push(this.modalCustom.data):a[o]=this.modalCustom.data,this.customs=a,this.unirProdutos(),this.calcularTotais()},salvarOS:function(){var e=this,t=Object(w["clonarV2"])(this.oss),a=t.findIndex(function(t){return t.documento.id===e.modalOS.data.documento.id});-1===a?t.push(this.modalOS.data):t[a]=this.modalOS.data,this.oss=t,this.unirProdutos(),this.calcularTotais()},abrirModalCustom:function(e){var t=this;if(e)this.custom=this.customs.find(function(t){return t.documento.id===e});else{var a={id:Object(w["uuid"])(),numero:1,tipo:"Custom",descricao:"",documentoId:this.venda.id,documentoTipo:"Venda",status:"Orçamento",dataHoraEmissao:Object(w["dataAtual"])(),idEmpresa:this.venda.idEmpresa,idItemTabelaPreco:this.venda.idItemTabelaPreco,descricaoEmpresa:this.venda.descricaoEmpresa,idContato:this.venda.idContato,descricaoContato:this.venda.descricaoContato,codigoDocumentoOperacao:this.venda.codigoDocumentoOperacao};this.custom={documento:a,documentoItens:[],arquivo:[]}}this.modalCustom.data=Object(w["clonarV2"])(this.custom),this.modalCustom.activated=!0,this.$nextTick(function(){t.modalCustom.visible=!0})},abrirModalOS:function(e){var t=this;if(e)this.os=this.oss.find(function(t){return t.documento.id===e});else{var a={id:Object(w["uuid"])(),tipo:"Ordem de Serviço",operacao:"Ordem de Serviço",descricao:"",documentoId:this.venda.id,documentoTipo:"Venda",status:"Orçamento",dataHoraEmissao:Object(w["dataAtual"])(),idEmpresa:this.venda.idEmpresa,idItemTabelaPreco:this.venda.idItemTabelaPreco,descricaoEmpresa:this.venda.descricaoEmpresa,idContato:this.venda.idContato,descricaoContato:this.venda.descricaoContato,codigoDocumentoOperacao:this.venda.codigoDocumentoOperacao};this.os={documento:a,documentoItens:[],arquivo:[]}}this.modalOS.data=Object(w["clonarV2"])(this.os),this.modalOS.activated=!0,this.$nextTick(function(){t.modalOS.visible=!0})},abrirModalEnvelope:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t?(o=this.itensEnvelopes.filter(function(e){return e.idDocumentoAdicional===t}),this.envelope={documento:this.envelopes[t],documentoContato:this.envelopes[t].documentoContato,documentoItens:o,somenteLeitura:this.ehVenda,arquivo:this.arquivo.filter(function(e){return e.idTabelaMaster===t})}):(a={id:Object(w["uuid"])(),tipo:"Envelope",documentoId:this.venda.id,documentoTipo:"Venda",status:"Orçamento",dataHoraEmissao:Object(w["dataAtual"])(),idEmpresa:this.venda.idEmpresa,idItemTabelaPreco:this.venda.idItemTabelaPreco,descricaoEmpresa:this.venda.descricaoEmpresa,idContato:this.venda.idContato,descricaoContato:this.venda.descricaoContato,codigoDocumentoOperacao:this.venda.codigoDocumentoOperacao},this.envelope={documento:a,documentoContato:[],documentoItens:[],somenteLeitura:this.ehVenda,arquivo:[]}),this.modalEnvelope=!0;case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),abrirModalItem:function(){var e={},t=!0,a=!1,o=void 0;try{for(var r,n=this.carrinho[Symbol.iterator]();!(t=(r=n.next()).done);t=!0){var i=r.value,s=Object(w["clonarV2"])(this.item[i.idItem]);s.novoValorVenda=i.valorReal,e[i.idItem]={item:s,quantidade:i.quantidade}}}catch(e){a=!0,o=e}finally{try{t||null==n.return||n.return()}finally{if(a)throw o}}this.$refs.promptItem.itensSelecionados=e,this.modalItem=!0},obterContatoUsuario:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=JSON.parse(localStorage.getItem("usuario"))||{},a={},!t.codigoUsuario){e.next=10;break}return e.next=5,Object(O["a"])().contato.where({codigoUsuario:t.codigoUsuario}).toArray();case 5:if(e.t1=function(e){return e.id},e.t0=e.sent.find(e.t1),e.t0){e.next=9;break}e.t0={};case 9:a=e.t0;case 10:return e.abrupt("return",a);case 11:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),alterarContatoVendedor:function(){var e=i()(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.obterContatoVendedorViaPrompt();case 2:t=e.sent,t.id&&(delete this.venda.idContatoVendedor,this.$set(this.venda,"idContatoVendedor",t.id));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),selecionarContatoIndicacao:function(){var e=i()(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.promptContato.filtro={ativo:!0},this.promptContato.placeholder="Selecione o contato",e.next=4,this.obterContatoViaPrompt();case 4:t=e.sent,t.id&&(delete this.venda.idContatoIndicacao,this.$set(this.venda,"idContatoIndicacao",t.id));case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),removerRepresentando:function(){this.documentoContato=this.documentoContato.filter(function(e){return"representando"!==(e.descricao||"").trim().toLowerCase()}),this.venda=Object(w["clonarV2"])(this.venda)},selecionarRepresentando:function(){var e=i()(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.promptContato.filtro={ativo:!0},this.promptContato.placeholder="Selecione o contato",e.next=4,this.obterContatoViaPrompt();case 4:t=e.sent,t.id&&(this.documentoContato=this.documentoContato.filter(function(e){return"representando"!==(e.descricao||"").trim().toLowerCase()}),this.documentoContato.push({id:Object(w["uuid"])(),idContato:t.id,descricao:"Representando",idDocumento:this.venda.id}),this.venda=Object(w["clonarV2"])(this.venda));case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),alterarTabelaPreco:function(){var e=i()(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.promptItemTabelaPreco.filtro={tabelaMaster:!0,idEmpresa:this.venda.idEmpresa},e.next=3,this.obterItemTabelaPrecoViaPrompt();case 3:t=e.sent,t.id&&(delete this.venda.idItemTabelaPreco,this.$set(this.venda,"idItemTabelaPreco",t.id));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),alterarOperacao:function(){var e=i()(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.obterDocumentoOperacaoViaPrompt();case 2:if(t=e.sent,!t.id){e.next=13;break}if(delete this.venda.idDocumentoOperacao,this.$set(this.venda,"idDocumentoOperacao",t.id),delete this.venda.operacao,this.$set(this.venda,"operacao",t.operacao),!t.idCfop){e.next=13;break}return e.next=11,k["a"].cfop.le({id:t.idCfop});case 11:this.cfop=e.sent,this.cfop.id||this.$q.notify("Não foi possível localizar o CFOP.");case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),obterItemTabelaPrecoViaPrompt:function(){var e=i()(regeneratorRuntime.mark(function e(t,a){var o,r=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(a){e.next=8;break}if(o=new Promise(function(e,t){r.resolve||(r.resolve={}),r.resolve["promptItemTabelaPreco"]=e}),this.promptItemTabelaPreco.ativo){e.next=6;break}return this.promptItemTabelaPreco.ativo=!0,e.next=6,this.$nextTick();case 6:return this.promptItemTabelaPreco.visivel=!0,e.abrupt("return",o);case 8:this.promptItemTabelaPreco.visivel=!1,this.resolve["promptItemTabelaPreco"](t);case 10:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}(),obterDocumentoOperacaoViaPrompt:function(){var e=i()(regeneratorRuntime.mark(function e(t,a){var o,r=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(a){e.next=8;break}if(o=new Promise(function(e,t){r.resolve||(r.resolve={}),r.resolve["promptDocumentoOperacao"]=e}),this.promptDocumentoOperacao.ativo){e.next=6;break}return this.promptDocumentoOperacao.ativo=!0,e.next=6,this.$nextTick();case 6:return this.promptDocumentoOperacao.visivel=!0,e.abrupt("return",o);case 8:this.promptDocumentoOperacao.visivel=!1,this.resolve["promptDocumentoOperacao"](t);case 10:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}(),obterContatoViaPrompt:function(){var e=i()(regeneratorRuntime.mark(function e(t,a,o){var r,n=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(o){e.next=8;break}if(r=new Promise(function(e,t){n.resolve||(n.resolve={}),n.resolve["promptContato"]=e}),this.promptContato.ativo){e.next=6;break}return this.promptContato.ativo=!0,e.next=6,this.$nextTick();case 6:return this.promptContato.visivel=!0,e.abrupt("return",r);case 8:this.promptContato.visivel=!1,this.resolve["promptContato"](a);case 10:case"end":return e.stop()}},e,this)}));return function(t,a,o){return e.apply(this,arguments)}}(),obterContatoVendedorViaPrompt:function(){var e=i()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.promptContato.filtro={ativo:!0,vendedores:!0},this.promptContato.placeholder="Selecione o vendedor",e.abrupt("return",this.obterContatoViaPrompt());case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),obterContatoVendedor:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a,o,r,n,i,s,c,l,d,u,m,p;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(a=(t||{}).idContatoVendedor,!a){e.next=10;break}return e.next=4,Object(O["a"])().contato.get(a);case 4:if(e.t0=e.sent,e.t0){e.next=7;break}e.t0={};case 7:if(o=e.t0,!o.id){e.next=10;break}return e.abrupt("return",o);case 10:return r=JSON.parse(localStorage.getItem("usuario"))||{},e.next=13,k["a"].contatoBusca.filtrar(null,{ativo:!0,vendedores:!0},0);case 13:n=e.sent,i=!0,s=!1,c=void 0,e.prev=17,l=n[Symbol.iterator]();case 19:if(i=(d=l.next()).done){e.next=30;break}if(u=d.value,(u||{}).numeroDocumentoNacional){e.next=23;break}return e.abrupt("continue",27);case 23:if(m=(u.numeroDocumentoNacional||"").replace(/\D/g,""),p=(r.numeroDocumentoNacional||"").replace(/\D/g,""),m!==p){e.next=27;break}return e.abrupt("return",u);case 27:i=!0,e.next=19;break;case 30:e.next=36;break;case 32:e.prev=32,e.t1=e["catch"](17),s=!0,c=e.t1;case 36:e.prev=36,e.prev=37,i||null==l.return||l.return();case 39:if(e.prev=39,!s){e.next=42;break}throw c;case 42:return e.finish(39);case 43:return e.finish(36);case 44:return e.abrupt("return",this.obterContatoVendedorViaPrompt());case 45:case"end":return e.stop()}},e,this,[[17,32,36,44],[37,,39,43]])}));return function(t){return e.apply(this,arguments)}}(),adicionar:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a,o,r,n,i,s,c,l,u,m,p,v,h,f,b,g,C,x,q,I,E,y,_,P,T,D=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,k["a"].contato.le({id:k["a"].contato.selecionado.id});case 2:if(t=e.sent,a="",!t.idFormaPagamento){e.next=12;break}return e.next=7,Object(O["a"])().formaPagamento.get(t.idFormaPagamento);case 7:if(e.t0=e.sent,e.t0){e.next=10;break}e.t0={};case 10:o=e.t0,a=(o.descricao||"").trim();case 12:return this.contatos={},this.contatos[t.id]=t,r=[],e.next=17,k["a"].contatoBusca.filtrar(null,{ativo:!0,empresas:!0},0);case 17:if(n=e.sent,!n.length){e.next=21;break}return e.next=21,Object(O["a"])().empresa.where("idContato").anyOf(n.map(function(e){return e.id})).each(function(e){r.push(e)});case 21:if(r.length){e.next=24;break}return this.$q.notify({message:"Não há empresa configurada",timeout:0,type:"negative",closeBtn:!0}),e.abrupt("return");case 24:if((t.condutaObservacao||"").trim()&&this.$q.notify({message:"Observação da conduta do Cliente: "+t.condutaObservacao,timeout:0,type:"warning",closeBtn:!0}),!(t.condutaRestricao||"").trim()){e.next=28;break}return this.$q.notify({message:t.condutaRestricao,timeout:0,type:"negative",closeBtn:!0}),e.abrupt("return");case 28:return e.next=30,k["a"].contatoTelefone.le({idContato:t.id});case 30:return i=e.sent,i=i.length?i[0].telefone:"",e.next=34,k["a"].contatoEndereco.le({idContato:t.id});case 34:if(s=e.sent,c=s.filter(function(e){return"Principal"===e.grupo}),l=[],u="",s.length&&(m=d()(c).concat(d()(s))[0],u="".concat(m.logradouro||"",", ",m.numero||""," ",m.complemento||""," - ",m.bairro||""," - ",m.municipio||"","/",m.uf||""),l=[{id:Object(w["uuid"])(),idContato:t.id,idContatoEndereco:m.id,idCidade:m.idCidade,descricao:u,logradouro:m.logradouro,numero:m.numero,complemento:m.complemento,condominio:m.condominio,bairro:m.bairro,cep:m.cep,ibgeCod:m.ibgeCod,municipio:m.municipio,uf:m.uf,ufCod:m.ufCod,pais:m.pais,grupo:m.grupo,cidadeCodChave:m.cidadeCodChave,observacao:m.observacao}]),p={},this.modalContatoEmpresa.visivel=!1,this.modalContatoEmpresa.retorno={},this.modalContatoEmpresa.aguardarRetorno=!0,!(r.length>1)){e.next=58;break}return this.modalContatoEmpresa.visivel=!0,e.next=47,new Promise(function(e,t){var a=setInterval(function(){D.modalContatoEmpresa.aguardarRetorno||(clearInterval(a),e())},100)});case 47:if(this.modalContatoEmpresa.retorno.id){e.next=51;break}return this.$emit("fechar"),this.$q.notifyError("Empresa não selecionada."),e.abrupt("return");case 51:return p=this.modalContatoEmpresa.retorno,e.next=54,this.configuraImpressaoEnvelope(p.idContato);case 54:return e.next=56,this.configuraImpressaoOrcamento(p.idContato);case 56:e.next=59;break;case 58:p=r[0];case 59:return e.next=61,k["a"].contatoEndereco.le({idContato:p.idContato});case 61:if(v=e.sent,v.length){e.next=66;break}return this.$emit("fechar"),this.$q.notifyError("Empresa sem endereço."),e.abrupt("return");case 66:if(h=v.find(function(e){return"principal"===(e.grupo||"").toLowerCase()}),h||(h=v[0]),f="",!t.idItemTabelaPreco){e.next=74;break}return e.next=72,k["a"].itemTabelaPreco.le({id:t.idItemTabelaPreco});case 72:b=e.sent,b.idEmpresa?b.idEmpresa===p.idContato&&(f=t.idItemTabelaPreco):f=t.idItemTabelaPreco;case 74:if(f){e.next=95;break}return e.next=77,k["a"].itemTabelaPreco.le({idEmpresa:p.idContato,tabelaMaster:!0});case 77:if(e.t1=e.sent,e.t1){e.next=80;break}e.t1=[];case 80:if(g=e.t1,1!==g.length){e.next=85;break}f=g[0].id,e.next=95;break;case 85:if(!(g.length>1)){e.next=95;break}return this.promptItemTabelaPreco.filtro={tabelaMaster:!0,idEmpresa:p.idContato},e.next=89,this.obterItemTabelaPrecoViaPrompt();case 89:if(C=e.sent,f=C.id,f){e.next=95;break}return this.$emit("fechar"),this.$q.notifyError("Tabela de Preço não selecionada."),e.abrupt("return");case 95:return e.next=97,k["a"].documentoOperacao.le();case 97:if(x=e.sent,x.length){e.next=101;break}return this.$q.notify("Não foi possível localizar a Operação."),e.abrupt("return");case 101:return e.next=103,k["a"].configuracoes.le({nome:"vendas.codigovenda"});case 103:if(q=e.sent,!h||!l[0]||h.uf===l[0].uf){e.next=108;break}return e.next=107,k["a"].configuracoes.le({nome:"vendas.codigovenda.foraestado"});case 107:q=e.sent;case 108:if(I={},q.length&&(E=parseInt(q[0].valor),I=x.filter(function(e){return e.codigoDocumentoOperacao===E})),I.length&&(I=I[0]),I.idCfop){e.next=118;break}return e.next=114,this.obterDocumentoOperacaoViaPrompt();case 114:if(I=e.sent,I.id){e.next=118;break}return this.$q.notify("Selecione a operação."),e.abrupt("return");case 118:return e.next=120,k["a"].cfop.le({id:I.idCfop});case 120:if(this.cfop=e.sent,this.cfop.id){e.next=124;break}return this.$q.notify("Não foi possível localizar o CFOP."),e.abrupt("return");case 124:return e.next=126,this.obterContatoUsuario();case 126:return y=e.sent,e.next=129,this.obterContatoVendedor(t);case 129:return _=e.sent,_.id||(this.$emit("fechar"),this.$q.notifyError("Vendedor não selecionado")),P={id:this.id,idContato:t.id,idContatoResponsavel:"",descricaoEmpresa:p.nome,idEmpresa:p.idContato,idEmpresaEndereco:h.id,numeroDocumentoEmpresa:p.numeroDocumentoNacional,calcularAutomatico:"Sim",dataHoraEmissao:Object(w["dataAtual"])(),descricaoContato:t.nome,numeroDocumentoContato:t.numeroDocumentoNacional,freteSeparado:!0,status:"Orçamento",tipo:"Venda",tipoFrete:"CIF",valorFrete:0,totalPercentualDesconto:0,totalDesconto:0,totalDocumento:0,subTotal:0,codigoDocumentoOperacao:I.codigoDocumentoOperacao,operacao:this.cfop.operacao,idContatoVendedor:_.id,idContatoDigitador:y.id,telefoneContato:i,descricaoContatoEndereco:u,idItemTabelaPreco:f,observacaoFaturamento:a},l.length&&(l[0].idDocumento=P.id),this.venda={},this.vendaOriginal={},this.envelopes={},this.envelopesOriginal={},this.carrinho=[],this.carrinhoOriginal=[],this.itensEnvelopes=[],this.itensEnvelopesOriginal=[],this.condicaoPagamento=[],this.condicaoPagamentoOriginal=[],this.documentoEndereco=[],this.documentoEnderecoOriginal=[],this.documentoStatus=[],this.documentoContato=[],e.next=149,k["a"].permissao.objeto("atendimento//venda/custom");case 149:return this.permissaoCustoms=e.sent,e.next=152,k["a"].permissao.objeto("atendimento//venda/os");case 152:return this.permissaoOSs=e.sent,e.next=155,this.atualizaUsaFatura(p);case 155:if(this.venda=P,this.documentoEndereco=l,localStorage.documentoItemDevolucao)try{T=JSON.parse(localStorage.getItem("documentoItemDevolucao")),localStorage.removeItem("documentoItemDevolucao"),T.idDocumento=this.venda.id,T.dataHoraEmissao=Object(w["dataAtual"])(),this.carrinho.push(T),this.carregarItens(),this.unirProdutos(),this.calcularTotais(),this.$q.notify({message:"Item adicionado ao orçamento.",type:"positive"})}catch(e){this.$q.notify("Não foi possível adicionar item ao orçamento.")}case 158:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),atualizaUsaFatura:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(O["a"])().configuracoes.where({nome:"vendas.gerafatura"}).toArray();case 2:a=e.sent,o=a.find(function(e){return e.idEmpresa===t.idContato}),o||(o=a.find(function(e){return!e.idEmpresa})),this.geraFatura=o?parseInt(o.valor):0;case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),buscarCodigoBarras:function(){var e=i()(regeneratorRuntime.mark(function e(t,a){var o,r,n,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=(t||"").trim().replace(/(\S+\s)|(\S+$)/g,"codigoBarras:$1$2"),t){e.next=3;break}return e.abrupt("return",a([]));case 3:return o=this.$filters,r=o.dinheiro,n=o.numero,e.next=6,k["a"].itemBusca.filtrar(t,{ativo:!0},10);case 6:if(i=e.sent,i=i.map(function(e){return{value:e.id,label:e.descricao,sublabel:"".concat(r(e.valorVenda)," | ").concat(n(e.quantidadeDisponivel)+e.unidade),stamp:e.codigoBarras,item:e}}),!this.entrarCodigoBarras||1!==i.length){e.next=10;break}return e.abrupt("return",this.selecionarItemCodigoBarras(i[0]));case 10:if("function"!==typeof a){e.next=12;break}return e.abrupt("return",a(i));case 12:this.$q.notifyError("Nenhum item foi encontrado.");case 13:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}(),calcularQuantidadeCustom:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a,o,r,n,i,s,c,l,d,u,m;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a=this.customs.find(function(e){return e.documento.id===t}),o=Object(w["arredondar"])(a.documento.numero,0),r=a.documento.totalDocumento>a.documento.subTotal?Object(w["arredondar"])(a.documento.totalDocumento/a.documento.subTotal,0):Object(w["arredondar"])(a.documento.subTotal/a.documento.totalDocumento,0),a.documento.totalDocumento=Object(w["arredondar"])(a.documento.subTotal*o,2),n=!0,i=!1,s=void 0,e.prev=7,c=a.documentoItens[Symbol.iterator]();case 9:if(n=(l=c.next()).done){e.next=25;break}return d=l.value,u=d.valorItem-d.descontoItem,d.quantidade=Object(w["arredondar"])(d.quantidade/r*o,0),d.subTotal=Object(w["arredondar"])(u*d.quantidade),d.total=d.subTotal,d.valorReal=Object(w["arredondar"])(u),d.valorRealTotal=d.total,e.next=19,Object(w["imposto"])(d.idItem,d.idCfop,a.documento.idEmpresa,a.documento.idContato);case 19:m=e.sent,d.valorIpi=Object(w["arredondar"])(Object(I["get"])(m,"aliqIpi",0)/100*d.valorRealTotal),d.valorIcmsSt=Object(w["arredondar"])(Object(I["get"])(m,"percIva",0)/100*d.valorRealTotal);case 22:n=!0,e.next=9;break;case 25:e.next=31;break;case 27:e.prev=27,e.t0=e["catch"](7),i=!0,s=e.t0;case 31:e.prev=31,e.prev=32,n||null==c.return||c.return();case 34:if(e.prev=34,!i){e.next=37;break}throw s;case 37:return e.finish(34);case 38:return e.finish(31);case 39:this.calcularTotais();case 40:case"end":return e.stop()}},e,this,[[7,27,31,39],[32,,34,38]])}));return function(t){return e.apply(this,arguments)}}(),cancelar:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a,o,r,n,i,s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!this.ehVenda){e.next=48;break}return e.prev=1,e.next=4,this.$q.dialog({cancel:"Cancelar",message:"Esta ação irá cancelar esta venda",noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e["catch"](1),e.abrupt("return");case 9:for(e.prev=9,this.$q.loading.show({message:"Processando..."}),t=Object(w["dataAtual"])(),this.venda.status="Cancelado",this.venda.idFatura="",this.venda.dataHoraFinalizado=t,a=!0,o=!1,r=void 0,e.prev=18,n=this.carrinho[Symbol.iterator]();!(a=(i=n.next()).done);a=!0)s=i.value,s.status=this.venda.status,s.dataHoraFinalizado=t;e.next=26;break;case 22:e.prev=22,e.t1=e["catch"](18),o=!0,r=e.t1;case 26:e.prev=26,e.prev=27,a||null==n.return||n.return();case 29:if(e.prev=29,!o){e.next=32;break}throw r;case 32:return e.finish(29);case 33:return e.finish(26);case 34:return this.$refs.faturamento.condicaoPagamento=[],e.next=37,this.salvarVenda();case 37:this.$emit("cancelada"),this.$q.notifyPositive("Venda cancelada"),e.next=45;break;case 41:e.prev=41,e.t2=e["catch"](9),this.$q.notify("Não foi possível cancelar a venda."),this.$q.loading.hide();case 45:return e.prev=45,this.$q.loading.hide(),e.finish(45);case 48:case"end":return e.stop()}},e,this,[[1,6],[9,41,45,48],[18,22,26,34],[27,,29,33]])}));return function(){return e.apply(this,arguments)}}(),salvarEnvelope:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.envelopes[t.documento.id]=t.documento,this.envelopes[t.documento.id].documentoContato=t.documentoContato,this.envelopes[t.documento.id].armacao=t.armacao,this.envelopes[t.documento.id].pupilometro=t.pupilometro,a=this.itensEnvelopes.filter(function(e){return e.idDocumentoAdicional!==t.documento.id}),a=d()(a).concat(d()(t.documentoItens)),this.itensEnvelopes=a,o=this.arquivo.filter(function(e){return e.idTabelaMaster!==t.documento.id}),o=d()(o).concat(d()(t.arquivo)),this.arquivo=o,this.calcularTotais();case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),descricaoEnvelope:function(e){var t="",a=!0,o=!1,r=void 0;try{for(var n,i=this.itensEnvelopes[Symbol.iterator]();!(a=(n=i.next()).done);a=!0){var s=n.value;s.idDocumentoAdicional===e&&s.descricaoItem.trim()&&(t+=s.descricaoItem.trim()+" | ")}}catch(e){o=!0,r=e}finally{try{a||null==i.return||i.return()}finally{if(o)throw r}}return t.slice(0,-3)},escanearCodigoBarras:function(e){this.fecharModalCodigoBarras(),this.$refs.codigoBarras.focus(),this.entrarCodigoBarras=!0,this.buscarCodigoBarras(e)},fecharModalCodigoBarras:function(){this.modalCodigoBarras=!1},fecharModalContato:function(){this.modalContato=!1},finalizar:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a,o,r,n,s,c,l,u,m,p,v,h,f,b,g,C,x,q,E,y,_,P,T,D,j,F,S,R,N,V,$,M,A,B,z,L,H,U,Q,J,G,X,Y,K,W,Z,ee,te,ae,oe,re,ne,ie,se,ce,le,de,ue,me,pe,ve,he,fe,be,ge,Ce,xe,qe,Oe,ke,Ie,we,Ee,ye,_e,Pe,Te,De,je,Fe,Se,Re,Ne,Ve,$e,Me,Ae,Be,ze,Le,He,Ue,Qe,Je,Ge,Xe,Ye,Ke,We,Ze,et,tt,at,ot,rt,nt,it,st,ct,lt,dt,ut,mt,pt,vt,ht,ft,bt,gt,Ct,xt,qt,Ot,kt,It,wt,Et,yt,_t,Pt,Tt,Dt,jt,Ft,St,Rt,Nt,Vt,$t,Mt,At,Bt,zt,Lt,Ht,Ut,Qt,Jt,Gt,Xt,Yt,Kt,Wt,Zt,ea,ta,aa,oa,ra,na,ia,sa,ca,la,da,ua,ma,pa,va,ha,fa,ba,ga,Ca,xa,qa,Oa,ka,Ia,wa,Ea,ya,_a,Pa,Ta,Da,ja,Fa,Sa,Ra,Na,Va,$a,Ma,Aa,Ba,za,La,Ha,Ua,Qa,Ja,Ga,Xa,Ya,Ka,Wa,Za,eo,to,ao,oo,ro,no=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!this.erroCalculo){e.next=3;break}return this.$q.notify("Não é possível finalizar a Venda. Erro de cálculo encontrado."),e.abrupt("return");case 3:return e.prev=3,t=Object(w["clonar"])(this.venda),a=Object(w["clonar"])(this.carrinho),o=Object(w["clonar"])(this.envelopes),r=Object(w["clonar"])(this.itensEnvelopes),n=Object(w["clonar"])(this.documentoEndereco),s=this.customs.reduce(function(e,t){return d()(e).concat(d()(t.documentoItens||[]))},[]),c=this.oss.reduce(function(e,t){return d()(e).concat(d()(t.documentoItens||[]))},[]),e.next=13,k["a"].contato.le({id:t.idContato});case 13:return l=e.sent,e.next=16,k["a"].empresa.le({idContato:t.idEmpresa});case 16:return u=e.sent,u=u.length?u[0]:{},e.next=20,k["a"].contato.le({id:u.idContato});case 20:return m=e.sent,e.next=23,k["a"].contatoEndereco.le({idContato:t.idContato});case 23:return p=e.sent,e.next=26,k["a"].contatoTelefone.le({idContato:t.idContato});case 26:v=e.sent,h=p.filter(function(e){return"Principal"===e.grupo}),e.next=34;break;case 30:return e.prev=30,e.t0=e["catch"](3),this.$q.notify("Erro ao tentar recuperar informações."),e.abrupt("return");case 34:return e.next=36,k["a"].configuracoes.porNome("vendas.checaestoque",u.idContato);case 36:if(e.t1=function(e){return 1===parseInt(e.valor)},f=e.sent.find(e.t1),!f){e.next=76;break}b=[],g=d()(a).concat(d()(r),d()(s),d()(c)),C=0;case 42:if(!(C<g.length)){e.next=68;break}if(x=g[C],x.idItem&&u.idContato&&1!==x.operacaoFator){e.next=46;break}return e.abrupt("continue",65);case 46:return e.next=48,Object(O["a"])().item.get(x.idItem);case 48:if(e.t2=e.sent,e.t2){e.next=51;break}e.t2={};case 51:if(q=e.t2,q.id){e.next=54;break}return e.abrupt("continue",65);case 54:if(!["servico","tratamento","lente"].includes((q.tipo||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""))){e.next=56;break}return e.abrupt("continue",65);case 56:return E=void 0,e.next=59,Object(O["a"])().estoqueSaldoProdutoEmpresa.where({idItem:x.idItem,idEmpresa:u.idContato,tipoEstoque:"Disponível"}).toArray();case 59:if(E=e.sent,E=E.find(function(e){return e.idItem&&e.idEmpresa}),y=Number((E||{}).saldo)?E.saldo:0,!(y>=(x.quantidade||1))){e.next=64;break}return e.abrupt("continue",65);case 64:b.map(function(e){return e.idItem}).includes(x.idItem)||b.push({idItem:x.idItem,descricao:x.descricaoItem||"",saldo:y});case 65:C++,e.next=42;break;case 68:if(!b.length){e.next=76;break}return this.modalItemSemEstoque.itens=b,this.$q.loading.hide(),_=!0,e.next=74,new Promise(function(){var e=i()(regeneratorRuntime.mark(function e(t,a){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:no.modalItemSemEstoque.reject=a,no.modalItemSemEstoque.visivel=!0;case 2:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}()).catch(function(){_=!0});case 74:if(!_){e.next=76;break}return e.abrupt("return",!1);case 76:return e.prev=76,e.next=79,this.$q.dialog({cancel:"Cancelar",message:"Esta ação irá finalizar este orçamento",noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 79:e.next=84;break;case 81:return e.prev=81,e.t3=e["catch"](76),e.abrupt("return",!1);case 84:return e.prev=84,this.$q.loading.show({message:"Processando..."}),e.t5=parseInt,e.next=89,k["a"].configuracoes.leValorComFiltroEmpresa("vendas.usaExpedicao",t.idEmpresa,0);case 89:if(e.t6=e.sent,e.t4=(0,e.t5)(e.t6),e.t4){e.next=93;break}e.t4=0;case 93:if(P=e.t4,T=P?"Aguardando Separação":"Aguardando Faturamento",!P||this.$refs.transporte.transporte){e.next=98;break}return this.$q.notify({message:"É necessário incluir transporte para finalizar!"}),e.abrupt("return",!1);case 98:return e.next=100,this.atualizaUsaFatura(u);case 100:if(D=!1,1===this.geraFatura&&(D=!0),j=Object(w["arredondar"])(this.$refs.faturamento.condicaoPagamento.reduce(function(e,t){return e+(t.valor||0)},0)),2!==this.geraFatura){e.next=115;break}if(j){e.next=115;break}return e.prev=105,this.$q.loading.hide(),e.next=109,this.$q.dialog({cancel:"Não",message:"Não há condição de pagamento. Deseja gerar fatura?",noRefocus:!0,ok:"Sim",preventClose:!0,title:"Confirma?"});case 109:this.$q.loading.show({message:"Processando..."}),D=!0,e.next=115;break;case 113:e.prev=113,e.t7=e["catch"](105);case 115:if(D||!this.venda.totalDocumento||j){e.next=118;break}return this.$q.notify({message:"É necessário incluir forma de pagamento para finalizar!"}),e.abrupt("return",!1);case 118:return F={},S=!0,R=!1,N=void 0,e.prev=122,e.next=125,k["a"].configuracoes.le();case 125:e.t8=Symbol.iterator,V=e.sent[e.t8]();case 127:if(S=($=V.next()).done){e.next=134;break}M=$.value,F[M.nome]||(F[M.nome]=[]),F[M.nome].push(M);case 131:S=!0,e.next=127;break;case 134:e.next=140;break;case 136:e.prev=136,e.t9=e["catch"](122),R=!0,N=e.t9;case 140:e.prev=140,e.prev=141,S||null==V.return||V.return();case 143:if(e.prev=143,!R){e.next=146;break}throw N;case 146:return e.finish(143);case 147:return e.finish(140);case 148:if(!F["vendas.validarestricao"]||1!==parseInt(F["vendas.validarestricao"][0].valor)){e.next=152;break}if(!(l.condutaRestricao||"").trim()){e.next=152;break}return this.$q.notify({message:l.condutaRestricao,timeout:0,type:"negative",closeBtn:!0}),e.abrupt("return",!1);case 152:if(A="",t.numeroDocumentoContato||(l.numeroDocumentoNacional?t.numeroDocumentoContato=l.numeroDocumentoNacional:A+="Número CPF/CNPJ, "),!p.length){e.next=179;break}if(B=d()(h).concat(d()(p))[0],t.descricaoContatoEndereco){e.next=177;break}for(t.descricaoContatoEndereco="".concat(B.logradouro||"",", ",B.numero||""," ",B.complemento||""," - ",B.bairro||""," - ",B.municipio||"","/",B.uf||""),z=!0,L=!1,H=void 0,e.prev=161,U=n[Symbol.iterator]();!(z=(Q=U.next()).done);z=!0)J=Q.value,J.idContatoEndereco=B.id,J.idCidade=B.idCidade,J.descricao=t.descricaoContatoEndereco,J.logradouro=B.logradouro,J.numero=B.numero,J.complemento=B.complemento,J.condominio=B.condominio,J.bairro=B.bairro,J.cep=B.cep,J.ibgeCod=B.ibgeCod,J.municipio=B.municipio,J.uf=B.uf,J.ufCod=B.ufCod,J.pais=B.pais,J.grupo=B.grupo,J.cidadeCodChave=B.cidadeCodChave,J.observacao=B.observacao;e.next=169;break;case 165:e.prev=165,e.t10=e["catch"](161),L=!0,H=e.t10;case 169:e.prev=169,e.prev=170,z||null==U.return||U.return();case 172:if(e.prev=172,!L){e.next=175;break}throw H;case 175:return e.finish(172);case 176:return e.finish(169);case 177:e.next=180;break;case 179:A+="Endereço, ";case 180:if(t.telefoneContato||(v.length?t.telefoneContato=v[0].telefone:A+="Telefone, "),t.numeroDocumentoContato||(t.numeroDocumentoContato=l.numeroDocumentoNacional),(t.numeroDocumentoContato||"").length>14&&(""===l.numeroDocumentoEstadual&&(A+="I.E., "),t.regimeContato||(l.regime?t.regimeContato=l.regime:A+="Regime fiscal, ")),m.email||m.emailNfe||(A+="E-mail do emitente, "),!F["vendas.validainformacoes"]||1!==parseInt(F["vendas.validainformacoes"][0].valor)||""===A){e.next=187;break}return this.$q.notify({message:"Faltando campos obrigatórios do cliente: "+A.slice(0,-2),timeout:0,type:"negative",closeBtn:!0}),e.abrupt("return",!1);case 187:t.pesoTotalTransporte=0,G=0,X=!0,Y=!1,K=void 0,e.prev=192,W=a[Symbol.iterator]();case 194:if(X=(Z=W.next()).done){e.next=242;break}if(ee=Z.value,0!==ee.descontoItem||0!==ee.total){e.next=199;break}return this.$q.notify({message:"Existe item no pedido com valor zerado.",timeout:0,type:"warning",closeBtn:!0}),e.abrupt("return",!1);case 199:if(1!==ee.operacaoFator){e.next=237;break}return e.next=202,k["a"].venda.leNew({idContato:t.idContato});case 202:te=e.sent,te=te.filter(function(e){return!["Orçamento","Não Aprovado","Cancelado"].includes(e.status)}),ae=[],oe=!0,re=!1,ne=void 0,e.prev=208,ie=te[Symbol.iterator]();case 210:if(oe=(se=ie.next()).done){e.next=219;break}return ce=se.value,e.next=214,k["a"].documentoItem.leNew({idDocumento:ce.id,idItem:ee.idItem});case 214:le=e.sent,ae=d()(ae).concat(d()(le));case 216:oe=!0,e.next=210;break;case 219:e.next=225;break;case 221:e.prev=221,e.t11=e["catch"](208),re=!0,ne=e.t11;case 225:e.prev=225,e.prev=226,oe||null==ie.return||ie.return();case 228:if(e.prev=228,!re){e.next=231;break}throw ne;case 231:return e.finish(228);case 232:return e.finish(225);case 233:if(de=ae.reduce(function(e,t){return-1===t.operacaoFator&&(e+=t.quantidade),1===t.operacaoFator&&(e-=t.quantidade),e},0),!(ee.quantidade>de)){e.next=237;break}return this.$q.notify(ee.descricaoItem.trim()+" - Saldo disponível para devoluções: "+de),e.abrupt("return");case 237:ee.total>0?(ue=Object(w["arredondar"])(100*(ee.total||0)/(t.subTotal||1)),me=Object(w["arredondar"])((t.totalDesconto||0)*(ue||0)/100),pe=(ee.valorItem||0)*(ee.quantidade||1)-(ee.descontoItem||0)*(ee.quantidade||1)-(me||0),ve=(pe||0)/(ee.quantidade||1),ee.descontoTotalRateado=Object(w["arredondar"])(me),ee.valorReal=Object(w["arredondar"])(ve),ee.valorRealTotal=Object(w["arredondar"])(pe),G+=me):(ee.valorReal=Object(w["arredondar"])(ee.total/(ee.quantidade||1)),ee.valorRealTotal=Object(w["arredondar"])(ee.total)),t.pesoTotalTransporte=Object(w["arredondar"])(t.pesoTotalTransporte+(ee.peso||0));case 239:X=!0,e.next=194;break;case 242:e.next=248;break;case 244:e.prev=244,e.t12=e["catch"](192),Y=!0,K=e.t12;case 248:e.prev=248,e.prev=249,X||null==W.return||W.return();case 251:if(e.prev=251,!Y){e.next=254;break}throw K;case 254:return e.finish(251);case 255:return e.finish(248);case 256:he=!0,fe=!1,be=void 0,e.prev=259,ge=r[Symbol.iterator]();case 261:if(he=(Ce=ge.next()).done){e.next=271;break}if(xe=Ce.value,0!==xe.descontoItem||0!==xe.total||!xe.idItem){e.next=266;break}return this.$q.notify({message:"Existe item no envelope com valor zerado.",timeout:0,type:"warning",closeBtn:!0}),e.abrupt("return",!1);case 266:xe.total>0&&(qe=Object(w["arredondar"])(100*(xe.total||0)/(t.subTotal||1)),Oe=Object(w["arredondar"])((t.totalDesconto||0)*(qe||0)/100),ke=(xe.valorItem||0)*(xe.quantidade||1)-(xe.descontoItem||0)*(xe.quantidade||1)-(Oe||0),Ie=(ke||0)/(xe.quantidade||1),xe.descontoTotalRateado=Object(w["arredondar"])(Oe),xe.valorReal=Object(w["arredondar"])(Ie),xe.valorRealTotal=Object(w["arredondar"])(ke),G+=Oe),t.pesoTotalTransporte=Object(w["arredondar"])(t.pesoTotalTransporte+(xe.peso||0));case 268:he=!0,e.next=261;break;case 271:e.next=277;break;case 273:e.prev=273,e.t13=e["catch"](259),fe=!0,be=e.t13;case 277:e.prev=277,e.prev=278,he||null==ge.return||ge.return();case 280:if(e.prev=280,!fe){e.next=283;break}throw be;case 283:return e.finish(280);case 284:return e.finish(277);case 285:we=!0,Ee=!1,ye=void 0,e.prev=288,_e=s[Symbol.iterator]();case 290:if(we=(Pe=_e.next()).done){e.next=300;break}if(Te=Pe.value,0!==Te.descontoItem||0!==Te.total||!Te.idItem){e.next=295;break}return this.$q.notify({message:"Item com valor zerado encontrado.",timeout:0,type:"warning",closeBtn:!0}),e.abrupt("return",!1);case 295:Te.total>0&&(De=Object(w["arredondar"])(100*(Te.total||0)/(t.subTotal||1)),je=Object(w["arredondar"])((t.totalDesconto||0)*(De||0)/100),Fe=(Te.valorItem||0)*(Te.quantidade||1)-(Te.descontoItem||0)*(Te.quantidade||1)-(je||0),Se=(Fe||0)/(Te.quantidade||1),Te.descontoTotalRateado=Object(w["arredondar"])(je),Te.valorReal=Object(w["arredondar"])(Se),Te.valorRealTotal=Object(w["arredondar"])(Fe),G+=je),t.pesoTotalTransporte=Object(w["arredondar"])(t.pesoTotalTransporte+(Te.peso||0));case 297:we=!0,e.next=290;break;case 300:e.next=306;break;case 302:e.prev=302,e.t14=e["catch"](288),Ee=!0,ye=e.t14;case 306:e.prev=306,e.prev=307,we||null==_e.return||_e.return();case 309:if(e.prev=309,!Ee){e.next=312;break}throw ye;case 312:return e.finish(309);case 313:return e.finish(306);case 314:Re=!0,Ne=!1,Ve=void 0,e.prev=317,$e=c[Symbol.iterator]();case 319:if(Re=(Me=$e.next()).done){e.next=329;break}if(Ae=Me.value,0!==Ae.descontoItem||0!==Ae.total||!Ae.idItem){e.next=324;break}return this.$q.notify({message:"Item com valor zerado encontrado.",timeout:0,type:"warning",closeBtn:!0}),e.abrupt("return",!1);case 324:Ae.total>0&&(Be=Object(w["arredondar"])(100*(Ae.total||0)/(t.subTotal||1)),ze=Object(w["arredondar"])((t.totalDesconto||0)*(Be||0)/100),Le=(Ae.valorItem||0)*(Ae.quantidade||1)-(Ae.descontoItem||0)*(Ae.quantidade||1)-(ze||0),He=(Le||0)/(Ae.quantidade||1),Ae.descontoTotalRateado=Object(w["arredondar"])(ze),Ae.valorReal=Object(w["arredondar"])(He),Ae.valorRealTotal=Object(w["arredondar"])(Le),G+=ze),t.pesoTotalTransporte=Object(w["arredondar"])(t.pesoTotalTransporte+(Ae.peso||0));case 326:Re=!0,e.next=319;break;case 329:e.next=335;break;case 331:e.prev=331,e.t15=e["catch"](317),Ne=!0,Ve=e.t15;case 335:e.prev=335,e.prev=336,Re||null==$e.return||$e.return();case 338:if(e.prev=338,!Ne){e.next=341;break}throw Ve;case 341:return e.finish(338);case 342:return e.finish(335);case 343:if(t.totalDesconto===Object(w["arredondar"])(G)){e.next=423;break}for(Ue=Object(w["arredondar"])((t.totalDesconto||0)-(G||0)),Je=0,Ge=!0,Xe=!1,Ye=void 0,e.prev=349,Ke=a[Symbol.iterator]();!(Ge=(We=Ke.next()).done);Ge=!0)Ze=We.value,Ze.total>Je&&(Je=Ze.total,Qe=Ze);e.next=357;break;case 353:e.prev=353,e.t16=e["catch"](349),Xe=!0,Ye=e.t16;case 357:e.prev=357,e.prev=358,Ge||null==Ke.return||Ke.return();case 360:if(e.prev=360,!Xe){e.next=363;break}throw Ye;case 363:return e.finish(360);case 364:return e.finish(357);case 365:for(et=!0,tt=!1,at=void 0,e.prev=368,ot=r[Symbol.iterator]();!(et=(rt=ot.next()).done);et=!0)nt=rt.value,nt.total>Je&&(Je=nt.total,Qe=nt);e.next=376;break;case 372:e.prev=372,e.t17=e["catch"](368),tt=!0,at=e.t17;case 376:e.prev=376,e.prev=377,et||null==ot.return||ot.return();case 379:if(e.prev=379,!tt){e.next=382;break}throw at;case 382:return e.finish(379);case 383:return e.finish(376);case 384:for(it=!0,st=!1,ct=void 0,e.prev=387,lt=s[Symbol.iterator]();!(it=(dt=lt.next()).done);it=!0)ut=dt.value,ut.total>Je&&(Je=ut.total,Qe=ut);e.next=395;break;case 391:e.prev=391,e.t18=e["catch"](387),st=!0,ct=e.t18;case 395:e.prev=395,e.prev=396,it||null==lt.return||lt.return();case 398:if(e.prev=398,!st){e.next=401;break}throw ct;case 401:return e.finish(398);case 402:return e.finish(395);case 403:for(mt=!0,pt=!1,vt=void 0,e.prev=406,ht=c[Symbol.iterator]();!(mt=(ft=ht.next()).done);mt=!0)bt=ft.value,bt.total>Je&&(Je=bt.total,Qe=bt);e.next=414;break;case 410:e.prev=410,e.t19=e["catch"](406),pt=!0,vt=e.t19;case 414:e.prev=414,e.prev=415,mt||null==ht.return||ht.return();case 417:if(e.prev=417,!pt){e.next=420;break}throw vt;case 420:return e.finish(417);case 421:return e.finish(414);case 422:Qe&&(gt=(Qe.descontoTotalRateado||0)+(Ue||0),Ct=(Qe.valorItem||0)*(Qe.quantidade||1)-(Qe.descontoItem||0)-(gt||0),xt=(Ct||0)/(Qe.quantidade||1),Qe.descontoTotalRateado=Object(w["arredondar"])(gt),Qe.valorReal=Object(w["arredondar"])(xt),Qe.valorRealTotal=Object(w["arredondar"])(Ct));case 423:return e.next=425,k["a"].contato.le({numeroDocumentoNacional:k["a"].usuario.logado.numeroDocumentoNacional});case 425:if(qt=e.sent,Ot=(qt[0]||{}).id||"",!T){e.next=597;break}return e.next=430,k["a"].permissao.objeto("Diretiva_Vendas_DescontoMaximo");case 430:return kt=e.sent,e.t21=parseInt,e.next=434,k["a"].configuracoes.leValorComFiltroEmpresa("vendas.margem.trava",t.idEmpresa,0);case 434:if(e.t22=e.sent,e.t20=(0,e.t21)(e.t22),e.t20){e.next=438;break}e.t20=0;case 438:if(It=e.t20,kt||!It||!Object(I["get"])(this.margem[t.id],"limite",!1)){e.next=442;break}return this.$q.notify({message:"Venda com índice inferior ao permitido"}),e.abrupt("return",!1);case 442:if(!t.idItemTabelaPreco){e.next=475;break}return e.next=445,Object(O["a"])().itemTabelaPreco.get(t.idItemTabelaPreco);case 445:if(wt=e.sent,wt){e.next=449;break}return this.$q.notify({message:"Não foi possível obter a tabela de preço"}),e.abrupt("return",!1);case 449:Et=[],yt=0,_t=t.totalDocumento,Pt=d()(a).concat(d()(s),d()(c),d()(r)),Tt=regeneratorRuntime.mark(function e(){var t,a,o,r,n,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=Pt[Dt],t.idItem&&1!==t.operacaoFator){e.next=4;break}return _t=Object(w["arredondar"])(_t-t.valorRealTotal),e.abrupt("return","continue");case 4:return a=void 0,o=void 0,r=void 0,n=void 0,i=void 0,e.next=7,no.configurarValoresTabelaPreco(wt,t);case 7:if(a=no.valoresTabelaPreco.find(function(e){return e.id===t.id}),a){e.next=10;break}return e.abrupt("return","continue");case 10:o=a.quantidadeMaiorQue&&t.quantidade>=a.quantidadeMaiorQue?a.maximoDescontoMaiorQue:a.maximoDesconto,n=Object(w["arredondar"])(t.valorOriginal-o/100*t.valorOriginal),i=Object(w["arredondar"])(t.valorItem-t.descontoItem),r=o,t.valorItem!==t.valorOriginal&&(r=Object(w["arredondar"])((t.valorItem-n)/t.valorItem*100)),yt=Object(w["arredondar"])(yt+n*t.quantidade),i<n&&Et.push({descricao:t.descricaoItem,maximoDesconto:r});case 17:case"end":return e.stop()}},e)}),Dt=0;case 455:if(!(Dt<Pt.length)){e.next=463;break}return e.delegateYield(Tt(),"t23",457);case 457:if(jt=e.t23,"continue"!==jt){e.next=460;break}return e.abrupt("continue",460);case 460:Dt++,e.next=455;break;case 463:if(!(Et.length||_t<yt)){e.next=475;break}return Ft="Existe(m) produto(s) com desconto superior ao máximo permitido",this.$q.notifyError(Ft),this.modalDescontoMaximo.permiteDescontoMaximo=kt,this.modalDescontoMaximo.itens=Et,this.$q.loading.hide(),St=!1,e.next=472,new Promise(function(){var e=i()(regeneratorRuntime.mark(function e(t,a){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:no.modalDescontoMaximo.resolve=t,no.modalDescontoMaximo.reject=a,no.modalDescontoMaximo.visivel=!0;case 3:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}()).catch(function(){St=!0});case 472:if(!St){e.next=474;break}return e.abrupt("return");case 474:this.$q.loading.show({message:"Processando..."});case 475:for(t.dataHoraFinalizado=Object(w["dataAtual"])(),t.idContatoFinalizado=Ot,t.status=T,Rt=!0,Nt=!1,Vt=void 0,e.prev=481,$t=a[Symbol.iterator]();!(Rt=(Mt=$t.next()).done);Rt=!0)At=Mt.value,At.dataHoraFinalizado=t.dataHoraFinalizado,At.valorReal=Object(w["arredondar"])(At.valorReal),At.valorRealTotal=Object(w["arredondar"])(At.valorRealTotal),At.operacaoFator<0&&(At.status=T),At.operacaoFator>0&&(At.status="Entregue");e.next=489;break;case 485:e.prev=485,e.t24=e["catch"](481),Nt=!0,Vt=e.t24;case 489:e.prev=489,e.prev=490,Rt||null==$t.return||$t.return();case 492:if(e.prev=492,!Nt){e.next=495;break}throw Vt;case 495:return e.finish(492);case 496:return e.finish(489);case 497:for(Bt in o)o[Bt].status="Processando";for(zt=!0,Lt=!1,Ht=void 0,e.prev=501,Ut=r[Symbol.iterator]();!(zt=(Qt=Ut.next()).done);zt=!0)Jt=Qt.value,Jt.dataHoraFinalizado=t.dataHoraFinalizado,Jt.descontoTotalRateado=Object(w["arredondar"])(Jt.descontoTotalRateado),Jt.valorReal=Object(w["arredondar"])(Jt.valorReal),Jt.valorRealTotal=Object(w["arredondar"])(Jt.valorRealTotal),Jt.operacaoFator<0&&(Jt.status=T),Jt.operacaoFator>0&&(Jt.status="Entregue");e.next=509;break;case 505:e.prev=505,e.t25=e["catch"](501),Lt=!0,Ht=e.t25;case 509:e.prev=509,e.prev=510,zt||null==Ut.return||Ut.return();case 512:if(e.prev=512,!Lt){e.next=515;break}throw Ht;case 515:return e.finish(512);case 516:return e.finish(509);case 517:for(Gt=!0,Xt=!1,Yt=void 0,e.prev=520,Kt=this.customs[Symbol.iterator]();!(Gt=(Wt=Kt.next()).done);Gt=!0)Zt=Wt.value,Zt.documento.status="Processando";e.next=528;break;case 524:e.prev=524,e.t26=e["catch"](520),Xt=!0,Yt=e.t26;case 528:e.prev=528,e.prev=529,Gt||null==Kt.return||Kt.return();case 531:if(e.prev=531,!Xt){e.next=534;break}throw Yt;case 534:return e.finish(531);case 535:return e.finish(528);case 536:for(ea=!0,ta=!1,aa=void 0,e.prev=539,oa=this.oss[Symbol.iterator]();!(ea=(ra=oa.next()).done);ea=!0)na=ra.value,na.documento.status="Processando";e.next=547;break;case 543:e.prev=543,e.t27=e["catch"](539),ta=!0,aa=e.t27;case 547:e.prev=547,e.prev=548,ea||null==oa.return||oa.return();case 550:if(e.prev=550,!ta){e.next=553;break}throw aa;case 553:return e.finish(550);case 554:return e.finish(547);case 555:for(ia=!0,sa=!1,ca=void 0,e.prev=558,la=s[Symbol.iterator]();!(ia=(da=la.next()).done);ia=!0)ua=da.value,ua.dataHoraFinalizado=t.dataHoraFinalizado,ua.descontoTotalRateado=Object(w["arredondar"])(ua.descontoTotalRateado),ua.valorReal=Object(w["arredondar"])(ua.valorReal),ua.valorRealTotal=Object(w["arredondar"])(ua.valorRealTotal),ua.operacaoFator<0&&(ua.status=T),ua.operacaoFator>0&&(ua.status="Entregue");e.next=566;break;case 562:e.prev=562,e.t28=e["catch"](558),sa=!0,ca=e.t28;case 566:e.prev=566,e.prev=567,ia||null==la.return||la.return();case 569:if(e.prev=569,!sa){e.next=572;break}throw ca;case 572:return e.finish(569);case 573:return e.finish(566);case 574:for(ma=!0,pa=!1,va=void 0,e.prev=577,ha=c[Symbol.iterator]();!(ma=(fa=ha.next()).done);ma=!0)ba=fa.value,ba.dataHoraFinalizado=t.dataHoraFinalizado,ba.descontoTotalRateado=Object(w["arredondar"])(ba.descontoTotalRateado),ba.valorReal=Object(w["arredondar"])(ba.valorReal),ba.valorRealTotal=Object(w["arredondar"])(ba.valorRealTotal),ba.operacaoFator<0&&(ba.status=T),ba.operacaoFator>0&&(ba.status="Entregue");e.next=585;break;case 581:e.prev=581,e.t29=e["catch"](577),pa=!0,va=e.t29;case 585:e.prev=585,e.prev=586,ma||null==ha.return||ha.return();case 588:if(e.prev=588,!pa){e.next=591;break}throw va;case 591:return e.finish(588);case 592:return e.finish(585);case 593:for(ga in this.documentoStatus.push({id:Object(w["uuid"])(),idDocumento:t.id,operacao:t.operacao,statusOriginal:"Orçamento",statusFinalizado:T,dataHoraEmissao:t.dataHoraFinalizado,idUsuarioAlterou:t.idContatoFinalizado}),o)this.documentoStatus.push({id:Object(w["uuid"])(),idDocumento:o[ga].id,operacao:"Mudança status envelope",statusOriginal:"Orçamento",statusFinalizado:"Processando",dataHoraEmissao:t.dataHoraFinalizado,idUsuarioAlterou:t.idContatoFinalizado});e.next=715;break;case 597:for(t.dataHoraFinalizado=Object(w["dataAtual"])(),t.idContatoFinalizado=Ot,t.status="Aguardando Entrega",Ca=!0,xa=!1,qa=void 0,e.prev=603,Oa=a[Symbol.iterator]();!(Ca=(ka=Oa.next()).done);Ca=!0)Ia=ka.value,Ia.dataHoraFinalizado=t.dataHoraFinalizado,Ia.operacaoFator<0&&(Ia.status="Finalizado"),Ia.operacaoFator>0&&(Ia.status="Entregue");e.next=611;break;case 607:e.prev=607,e.t30=e["catch"](603),xa=!0,qa=e.t30;case 611:e.prev=611,e.prev=612,Ca||null==Oa.return||Oa.return();case 614:if(e.prev=614,!xa){e.next=617;break}throw qa;case 617:return e.finish(614);case 618:return e.finish(611);case 619:for(wa in o)o[wa].status="Processando",o[wa].dataHoraFinalizado=t.dataHoraFinalizado;for(Ea=!0,ya=!1,_a=void 0,e.prev=623,Pa=r[Symbol.iterator]();!(Ea=(Ta=Pa.next()).done);Ea=!0)Da=Ta.value,Da.dataHoraFinalizado=t.dataHoraFinalizado,Da.operacaoFator<0&&(Da.status="Finalizado"),Da.operacaoFator>0&&(Da.status="Entregue");e.next=631;break;case 627:e.prev=627,e.t31=e["catch"](623),ya=!0,_a=e.t31;case 631:e.prev=631,e.prev=632,Ea||null==Pa.return||Pa.return();case 634:if(e.prev=634,!ya){e.next=637;break}throw _a;case 637:return e.finish(634);case 638:return e.finish(631);case 639:for(ja=!0,Fa=!1,Sa=void 0,e.prev=642,Ra=this.customs[Symbol.iterator]();!(ja=(Na=Ra.next()).done);ja=!0)Va=Na.value,Va.documento.status="Processando",Va.documento.dataHoraFinalizado=t.dataHoraFinalizado;e.next=650;break;case 646:e.prev=646,e.t32=e["catch"](642),Fa=!0,Sa=e.t32;case 650:e.prev=650,e.prev=651,ja||null==Ra.return||Ra.return();case 653:if(e.prev=653,!Fa){e.next=656;break}throw Sa;case 656:return e.finish(653);case 657:return e.finish(650);case 658:for($a=!0,Ma=!1,Aa=void 0,e.prev=661,Ba=this.oss[Symbol.iterator]();!($a=(za=Ba.next()).done);$a=!0)La=za.value,La.documento.status="Processando",La.documento.dataHoraFinalizado=t.dataHoraFinalizado;e.next=669;break;case 665:e.prev=665,e.t33=e["catch"](661),Ma=!0,Aa=e.t33;case 669:e.prev=669,e.prev=670,$a||null==Ba.return||Ba.return();case 672:if(e.prev=672,!Ma){e.next=675;break}throw Aa;case 675:return e.finish(672);case 676:return e.finish(669);case 677:for(Ha=!0,Ua=!1,Qa=void 0,e.prev=680,Ja=s[Symbol.iterator]();!(Ha=(Ga=Ja.next()).done);Ha=!0)Xa=Ga.value,Xa.dataHoraFinalizado=t.dataHoraFinalizado,Xa.operacaoFator<0&&(Xa.status="Finalizado"),Xa.operacaoFator>0&&(Xa.status="Entregue");e.next=688;break;case 684:e.prev=684,e.t34=e["catch"](680),Ua=!0,Qa=e.t34;case 688:e.prev=688,e.prev=689,Ha||null==Ja.return||Ja.return();case 691:if(e.prev=691,!Ua){e.next=694;break}throw Qa;case 694:return e.finish(691);case 695:return e.finish(688);case 696:for(Ya=!0,Ka=!1,Wa=void 0,e.prev=699,Za=c[Symbol.iterator]();!(Ya=(eo=Za.next()).done);Ya=!0)to=eo.value,to.dataHoraFinalizado=t.dataHoraFinalizado,to.operacaoFator<0&&(to.status="Finalizado"),to.operacaoFator>0&&(to.status="Entregue");e.next=707;break;case 703:e.prev=703,e.t35=e["catch"](699),Ka=!0,Wa=e.t35;case 707:e.prev=707,e.prev=708,Ya||null==Za.return||Za.return();case 710:if(e.prev=710,!Ka){e.next=713;break}throw Wa;case 713:return e.finish(710);case 714:return e.finish(707);case 715:if(ao=!1,!D){e.next=729;break}return oo={},e.next=720,k["a"].configuracoes.leValorNumerico("venda.codigoconsumidor");case 720:if(ro=e.sent,l.codigoContato===ro){e.next=725;break}return e.next=724,k["a"].documento.le({idContato:t.idContato,idEmpresa:t.idEmpresa,tipo:"Fatura",status:"Aberta"});case 724:oo=e.sent;case 725:return oo.length?(oo=Object(I["orderBy"])(oo,"dataHoraEmissao","desc"),t.idFatura=oo[0].id):(t.idFatura=Object(w["uuid"])(),k["a"].fatura.grava({fatura:{id:t.idFatura,dataHoraEmissao:t.dataHoraFinalizado,calcularAutomatico:"Sim",tipo:"Fatura",operacao:"Faturamento",status:"Aberta",tipoFrete:"CIF",freteSeparado:!1,totalDesconto:0,totalPercentualDesconto:0,subTotal:t.subTotal,totalDocumento:t.totalDocumento,idEmpresa:t.idEmpresa,idEmpresaEndereco:t.idEmpresaEndereco,descricaoEmpresa:t.descricaoEmpresa,numeroDocumentoEmpresa:t.numeroDocumentoEmpresa,inscricaoMunicipalEmpresa:t.inscricaoMunicipalEmpresa,codigoMunicipioEmpresa:t.codigoMunicipioEmpresa,optanteSimplesNacional:t.optanteSimplesNacional,idContato:t.idContato,idContatoEndereco:t.idContatoEndereco,numeroDocumentoContato:t.numeroDocumentoContato,descricaoContato:t.descricaoContato,descricaoContatoEndereco:t.descricaoContatoEndereco,telefoneContato:t.telefoneContato,emailContato:t.emailContato,regimeContato:t.regimeContato}})),e.next=728,k["a"].permissao.objeto("atendimento//fatura");case 728:ao=e.sent;case 729:return this.venda=t,this.carrinho=a,this.envelopes=o,this.itensEnvelopes=r,this.documentoEndereco=n,e.next=736,this.salvarVenda();case 736:return this.$q.notifyPositive("Orçamento finalizado"),ao&&this.$nextTick(this.$router.push({name:"AtendimentoFatura",params:{id:this.venda.idContato}})),e.abrupt("return",!0);case 741:return e.prev=741,e.t36=e["catch"](84),this.$q.notifyError("Erro ao finalizar.",e.t36),this.$q.loading.hide(),e.abrupt("return",!1);case 746:return e.prev=746,this.$q.loading.hide(),e.finish(746);case 749:case"end":return e.stop()}},e,this,[[3,30],[76,81],[84,741,746,749],[105,113],[122,136,140,148],[141,,143,147],[161,165,169,177],[170,,172,176],[192,244,248,256],[208,221,225,233],[226,,228,232],[249,,251,255],[259,273,277,285],[278,,280,284],[288,302,306,314],[307,,309,313],[317,331,335,343],[336,,338,342],[349,353,357,365],[358,,360,364],[368,372,376,384],[377,,379,383],[387,391,395,403],[396,,398,402],[406,410,414,422],[415,,417,421],[481,485,489,497],[490,,492,496],[501,505,509,517],[510,,512,516],[520,524,528,536],[529,,531,535],[539,543,547,555],[548,,550,554],[558,562,566,574],[567,,569,573],[577,581,585,593],[586,,588,592],[603,607,611,619],[612,,614,618],[623,627,631,639],[632,,634,638],[642,646,650,658],[651,,653,657],[661,665,669,677],[670,,672,676],[680,684,688,696],[689,,691,695],[699,703,707,715],[708,,710,714]])}));return function(){return e.apply(this,arguments)}}(),leitorCodigoBarras:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a,o,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!t.ctrlKey||74!==t.keyCode){e.next=4;break}t.preventDefault(),e.next=12;break;case 4:if(13!==t.keyCode){e.next=12;break}if(a=(this.codigoBarras||"").trim().replace(/(\S+\s)|(\S+$)/g,"codigoBarras:$1$2"),!a){e.next=12;break}return e.next=9,k["a"].itemBusca.filtrar(a,{ativo:!0},1);case 9:o=e.sent,r=o.find(function(e){return e.id}),r?this.selecionarItemCodigoBarras({item:r}):this.$q.notifyError("Item não encontrado");case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),removerEnvelope:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a,o,r,n,i,s,c,l;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:for(o in this.$delete(this.envelopes,t),a=[],this.itensEnvelopes)this.itensEnvelopes[o].idDocumentoAdicional===t&&a.push(o);for(r=!0,n=!1,i=void 0,e.prev=6,s=a.reverse()[Symbol.iterator]();!(r=(c=s.next()).done);r=!0)l=c.value,this.$delete(this.itensEnvelopes,l);e.next=14;break;case 10:e.prev=10,e.t0=e["catch"](6),n=!0,i=e.t0;case 14:e.prev=14,e.prev=15,r||null==s.return||s.return();case 17:if(e.prev=17,!n){e.next=20;break}throw i;case 20:return e.finish(17);case 21:return e.finish(14);case 22:this.calcularTotais();case 23:case"end":return e.stop()}},e,this,[[6,10,14,22],[15,,17,21]])}));return function(t){return e.apply(this,arguments)}}(),removerCustom:function(){var e=i()(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$q.dialog({cancel:"Cancelar",message:"Esta ação irá remover este item do carrinho",noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e["catch"](0),e.abrupt("return");case 8:this.customs=this.customs.filter(function(e){return e.documento.id!==t}),this.unirProdutos(),this.calcularTotais();case 11:case"end":return e.stop()}},e,this,[[0,5]])}));return function(t){return e.apply(this,arguments)}}(),removerItem:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$q.dialog({cancel:"Cancelar",message:"Esta ação irá remover este item do carrinho",noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e["catch"](0),e.abrupt("return");case 8:e.t1=regeneratorRuntime.keys(this.carrinho);case 9:if((e.t2=e.t1()).done){e.next=18;break}if(a=e.t2.value,this.carrinho[a].id!==t){e.next=16;break}return this.carrinho.splice(a,1),this.unirProdutos(),this.calcularTotais(),e.abrupt("return");case 16:e.next=9;break;case 18:case"end":return e.stop()}},e,this,[[0,5]])}));return function(t){return e.apply(this,arguments)}}(),removerOS:function(){var e=i()(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$q.dialog({cancel:"Cancelar",message:"Esta ação irá remover este item do carrinho",noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e["catch"](0),e.abrupt("return");case 8:this.oss=this.oss.filter(function(e){return e.documento.id!==t}),this.unirProdutos(),this.calcularTotais();case 11:case"end":return e.stop()}},e,this,[[0,5]])}));return function(t){return e.apply(this,arguments)}}(),reprovarOrcamento:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a,o,r,n,i,s,c,l;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$q.dialog({cancel:"Cancelar",message:"Especifique o motivo:",noRefocus:!0,ok:"Continuar",preventClose:!0,prompt:{model:"",type:"text"},title:"Reprovar orçamento?"});case 3:if(t=e.sent,!t.trim()){e.next=48;break}for(e.prev=5,this.$q.loading.show({message:"Processando..."}),a=Object(w["dataAtual"])(),o="Não Aprovado",this.venda.motivoCancelamento=t.trim(),this.venda.status=o,this.venda.dataHoraFinalizado=a,r=!0,n=!1,i=void 0,e.prev=15,s=this.carrinho[Symbol.iterator]();!(r=(c=s.next()).done);r=!0)l=c.value,l.status=o,l.dataHoraFinalizado=a;e.next=23;break;case 19:e.prev=19,e.t0=e["catch"](15),n=!0,i=e.t0;case 23:e.prev=23,e.prev=24,r||null==s.return||s.return();case 26:if(e.prev=26,!n){e.next=29;break}throw i;case 29:return e.finish(26);case 30:return e.finish(23);case 31:return this.$refs.faturamento.condicaoPagamento=[],e.next=34,this.salvarVenda();case 34:return this.$q.notifyPositive("Orçamento reprovado"),e.abrupt("return",!0);case 38:return e.prev=38,e.t1=e["catch"](5),this.$q.notifyError("Ocorreu um erro ao reprovar o orçamento.",e.t1),this.$q.loading.hide(),e.abrupt("return",!1);case 43:return e.prev=43,this.$q.loading.hide(),e.finish(43);case 46:e.next=50;break;case 48:return this.$q.notifyError("Especifique o motivo"),e.abrupt("return",!1);case 50:e.next=55;break;case 52:return e.prev=52,e.t2=e["catch"](0),e.abrupt("return",!1);case 55:case"end":return e.stop()}},e,this,[[0,52],[5,38,43,46],[15,19,23,31],[24,,26,30]])}));return function(){return e.apply(this,arguments)}}(),retornarOrcamento:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a,o,r,n,i,s,c,l,u,m,p,v,h,f,b,g,C,x,q,O,E,y,_,P,T,D,j,F,S,R,N,V,$,M,A,B,z,L,H,U,Q,J;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$q.dialog({cancel:"Cancelar",message:"Esta ação irá retornar esta venda para orçamento",noRefocus:!0,ok:"Continuar",preventClose:!0,title:"Tem certeza?"});case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e["catch"](0),e.abrupt("return",!1);case 8:return e.prev=8,this.$q.loading.show({message:"Processando..."}),e.next=12,k["a"].documentoStatus.le({idDocumento:this.venda.id});case 12:if(t=e.sent,t=Object(I["orderBy"])(t,"dataHoraEmissao","desc")[0],!["Faturado","Aguardando Pagamento"].includes(this.venda.status)){e.next=17;break}return this.$q.notifyError("Não é possível reabrir vendas de faturas já pagas! Por favor, reabra a fatura."),e.abrupt("return",!1);case 17:return e.next=19,k["a"].permissao.objeto("Diretiva_Vendas_Reabertura");case 19:if(e.sent){e.next=25;break}if(a=new Date,o=new Date(this.venda.dataHoraFinalizado),!(o.getFullYear()<a.getFullYear()||o.getMonth()<a.getMonth())){e.next=25;break}return this.$q.notifyError("Não é possível reabrir vendas de meses passados!"),e.abrupt("return",!1);case 25:return this.documentoStatus=[],this.venda.idFatura="",this.venda.idContatoFinalizado="",this.venda.status="Orçamento",this.venda.dataHoraFinalizado="",this.venda.dataHoraRealizado="",this.venda.motivoCancelamento="",r=Object(w["dataAtual"])(),e.next=35,k["a"].contato.le({numeroDocumentoNacional:k["a"].usuario.logado.numeroDocumentoNacional});case 35:for(n=e.sent,i=(n[0]||{}).id||"",s=!0,c=!1,l=void 0,e.prev=40,u=this.carrinho[Symbol.iterator]();!(s=(m=u.next()).done);s=!0)p=m.value,p.status="Orçamento","Local"!==p.tipoItem&&(p.dataHoraFinalizado="");e.next=48;break;case 44:e.prev=44,e.t1=e["catch"](40),c=!0,l=e.t1;case 48:e.prev=48,e.prev=49,s||null==u.return||u.return();case 51:if(e.prev=51,!c){e.next=54;break}throw l;case 54:return e.finish(51);case 55:return e.finish(48);case 56:for(v in this.envelopes)this.documentoStatus.push({id:Object(w["uuid"])(),idDocumento:this.envelopes[v].id,operacao:"Mudança status envelope",statusOriginal:this.envelopes[v].status,statusFinalizado:"Orçamento",dataHoraEmissao:r,idUsuarioAlterou:i}),this.envelopes[v].status="Orçamento",this.envelopes[v].dataHoraFinalizado="";for(h=!0,f=!1,b=void 0,e.prev=60,g=this.itensEnvelopes[Symbol.iterator]();!(h=(C=g.next()).done);h=!0)x=C.value,x.status="Orçamento",x.dataHoraFinalizado="";e.next=68;break;case 64:e.prev=64,e.t2=e["catch"](60),f=!0,b=e.t2;case 68:e.prev=68,e.prev=69,h||null==g.return||g.return();case 71:if(e.prev=71,!f){e.next=74;break}throw b;case 74:return e.finish(71);case 75:return e.finish(68);case 76:for(q=!0,O=!1,E=void 0,e.prev=79,y=this.customs[Symbol.iterator]();!(q=(_=y.next()).done);q=!0)P=_.value,P.documento.status="Orçamento",P.documento.dataHoraFinalizado="";e.next=87;break;case 83:e.prev=83,e.t3=e["catch"](79),O=!0,E=e.t3;case 87:e.prev=87,e.prev=88,q||null==y.return||y.return();case 90:if(e.prev=90,!O){e.next=93;break}throw E;case 93:return e.finish(90);case 94:return e.finish(87);case 95:for(T=!0,D=!1,j=void 0,e.prev=98,F=this.oss[Symbol.iterator]();!(T=(S=F.next()).done);T=!0)R=S.value,R.documento.status="Orçamento",R.documento.dataHoraFinalizado="";e.next=106;break;case 102:e.prev=102,e.t4=e["catch"](98),D=!0,j=e.t4;case 106:e.prev=106,e.prev=107,T||null==F.return||F.return();case 109:if(e.prev=109,!D){e.next=112;break}throw j;case 112:return e.finish(109);case 113:return e.finish(106);case 114:for(N=!0,V=!1,$=void 0,e.prev=117,M=this.customs.reduce(function(e,t){return d()(e).concat(d()(t.documentoItens||[]))},[])[Symbol.iterator]();!(N=(A=M.next()).done);N=!0)B=A.value,B.status="Orçamento",B.dataHoraFinalizado="";e.next=125;break;case 121:e.prev=121,e.t5=e["catch"](117),V=!0,$=e.t5;case 125:e.prev=125,e.prev=126,N||null==M.return||M.return();case 128:if(e.prev=128,!V){e.next=131;break}throw $;case 131:return e.finish(128);case 132:return e.finish(125);case 133:for(z=!0,L=!1,H=void 0,e.prev=136,U=this.oss.reduce(function(e,t){return d()(e).concat(d()(t.documentoItens||[]))},[])[Symbol.iterator]();!(z=(Q=U.next()).done);z=!0)J=Q.value,J.status="Orçamento",J.dataHoraFinalizado="";e.next=144;break;case 140:e.prev=140,e.t6=e["catch"](136),L=!0,H=e.t6;case 144:e.prev=144,e.prev=145,z||null==U.return||U.return();case 147:if(e.prev=147,!L){e.next=150;break}throw H;case 150:return e.finish(147);case 151:return e.finish(144);case 152:return this.documentoStatus.push({id:Object(w["uuid"])(),idDocumento:this.venda.id,dataHoraEmissao:r,operacao:this.venda.operacao,statusOriginal:(t||{}).statusFinalizado,statusFinalizado:"Orçamento",idUsuarioAlterou:i}),e.next=155,this.salvarVenda();case 155:return this.atualizar(),this.$emit("executar","retornarOrcamento"),this.$q.notifyPositive("Venda retornada para orçamento"),e.abrupt("return",!0);case 161:return e.prev=161,e.t7=e["catch"](8),this.$q.notifyError("Não foi possível retornar para orçamento.",e.t7),this.$q.loading.hide(),e.abrupt("return",!1);case 166:return e.prev=166,this.$q.loading.hide(),e.finish(166);case 169:case"end":return e.stop()}},e,this,[[0,5],[8,161,166,169],[40,44,48,56],[49,,51,55],[60,64,68,76],[69,,71,75],[79,83,87,95],[88,,90,94],[98,102,106,114],[107,,109,113],[117,121,125,133],[126,,128,132],[136,140,144,152],[145,,147,151]])}));return function(){return e.apply(this,arguments)}}(),selecionarEmpresa:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.modalContatoEmpresa.retorno={},t){e.next=4;break}return this.modalContatoEmpresa.aguardarRetorno=!1,e.abrupt("return");case 4:return e.next=6,k["a"].empresa.le({idContato:t});case 6:a=e.sent,a.length&&(this.modalContatoEmpresa.retorno=a[0]),this.modalContatoEmpresa.aguardarRetorno=!1;case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),selecionarContato:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a,o,r,n,i,s,c,l,d,u;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.exibirCarregando=!0,this.fecharModalContato(),e.prev=2,e.next=5,k["a"].contato.leCompleto(t);case 5:a=e.sent,o=function(e){return!!e.grupo&&"PRINCIPAL"===e.grupo.toUpperCase()},r=a.endereco.find(o)||a.endereco[0],n=a.telefone.find(o)||a.telefone[0],this.venda.idContato=t,this.venda.descricaoContato=a.nome,this.venda.telefoneContato=n?n.telefone:"",i=r||{},s=i.logradouro,c=i.numero,l=i.complemento,d=i.municipio,u=i.uf,s=s?s+", ":"",c=c?c+" ":"",l=l||"",d=d?" - "+d:"",u=u?" / "+u:"",this.venda.descricaoContatoEndereco=s+c+l+d+u,e.next=24;break;case 21:e.prev=21,e.t0=e["catch"](2),this.$q.notifyError("Erro ao alterar o contato do documento.",e.t0);case 24:this.exibirCarregando=!1;case 25:case"end":return e.stop()}},e,this,[[2,21]])}));return function(t){return e.apply(this,arguments)}}(),selecionarConvenio:function(){var e=i()(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:delete this.venda.idContatoResponsavel,this.$set(this.venda,"idContatoResponsavel",t),this.modalConvenio=!1;case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),configurarValoresTabelaPreco:function(){var e=i()(regeneratorRuntime.mark(function e(t,a){var o,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(o=this.valoresTabelaPreco.find(function(e){return e.id===a.id}),!o){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,Object(O["a"])().item.get(a.idItem);case 5:return r=e.sent,e.next=8,k["a"].itemTabelaPreco.obterValores(t,r);case 8:o=e.sent,this.valoresTabelaPreco.push(m()({id:a.id},o));case 10:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}(),selecionarItens:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a,o,r=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.exibirCarregando=!0,a=regeneratorRuntime.mark(function e(a){var o,n,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return o=t[a].item||{},n=t[a].quantidade||0,i=r.carrinho.findIndex(function(e){return e.idItem===a}),e.next=5,r.selecionarItem(a,o,n);case 5:-1===i&&(i=r.carrinho.findIndex(function(e){return e.idItem===a}),-1!==i&&-1===r.carrinho[i].operacaoFator&&r.carrinhoCalcularTotais(r.carrinho[i].id,"quantidade"));case 6:case"end":return e.stop()}},e)}),e.t0=regeneratorRuntime.keys(t);case 3:if((e.t1=e.t0()).done){e.next=8;break}return o=e.t1.value,e.delegateYield(a(o),"t2",6);case 6:e.next=3;break;case 8:this.carregarItens(),this.unirProdutos(),this.calcularTotais(),this.exibirCarregando=!1;case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),selecionarItem:function(){var e=i()(regeneratorRuntime.mark(function e(t,a,o){var r,n,i,s,c,l,d,u,m,p,v,h,f;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.modalItem=!1,r=this.carrinho.findIndex(function(e){return e.idItem===t}),-1===r||-1!==this.carrinho[r].operacaoFator){e.next=6;break}return a.novoValorVenda!==this.carrinho[r].valorOriginal&&(a.novoValorVenda<=this.carrinho[r].valorOriginal?(this.carrinho[r].valorItem=this.carrinho[r].valorOriginal,this.carrinho[r].descontoItem=Object(w["arredondar"])(this.carrinho[r].valorOriginal-a.novoValorVenda)):(this.carrinho[r].valorItem=a.novoValorVenda,this.carrinho[r].descontoItem=0),this.carrinhoCalcularTotais(this.carrinho[r].id,"descontoItem")),this.carrinho[r].quantidade!==o&&(this.carrinho[r].quantidade=o||1,this.carrinhoCalcularTotais(this.carrinho[r].id,"quantidade")),e.abrupt("return");case 6:if((this.cfop||{}).id){e.next=16;break}return e.next=9,k["a"].documentoOperacao.le({codigoDocumentoOperacao:this.venda.codigoDocumentoOperacao});case 9:if(n=e.sent,n.length){e.next=13;break}return this.$q.notify("Não foi possível localizar a Operação."),e.abrupt("return");case 13:return e.next=15,k["a"].cfop.le({id:n[0].idCfop});case 15:this.cfop=e.sent;case 16:if(this.cfop.id){e.next=19;break}return this.$q.notify("Não foi possível localizar o CFOP."),e.abrupt("return");case 19:return i="",s="",e.next=23,k["a"].perfilContabilItem.le({idPerfilContabil:a.idPerfilContabil,idCfop:this.cfop.id,and:{idPerfilContabil:a.idPerfilContabil,idCfop:this.cfop.id}});case 23:if(c=e.sent,c.length&&(i=c[0].idPlanoContaEstoque,s=c[0].idPlanoContaDestino),i&&s||(i=this.cfop.idPlanoContaEstoque,s=this.cfop.idPlanoContaDestino),i&&s){e.next=43;break}return e.next=29,k["a"].configuracoes.le({nome:"financeiro.planocontas.comprageral"});case 29:if(l=e.sent,!l.length){e.next=35;break}return d=parseInt(l[0].valor),e.next=34,k["a"].financeiroPlanoConta.le({codigoFinanceiroPlanoConta:d});case 34:i=e.sent.id;case 35:return e.next=37,k["a"].configuracoes.le({nome:"financeiro.planocontas.faturamentogeral"});case 37:if(u=e.sent,!u.length){e.next=43;break}return m=parseInt(u[0].valor),e.next=42,k["a"].financeiroPlanoConta.le({codigoFinanceiroPlanoConta:m});case 42:s=e.sent.id;case 43:if(i){e.next=46;break}return this.$q.notify("Não foi possível localizar Conta de Estoque."),e.abrupt("return");case 46:if(s){e.next=49;break}return this.$q.notify("Não foi possível localizar Conta de Destino."),e.abrupt("return");case 49:return e.next=51,k["a"].estoqueSaldoProdutoEmpresa.le({idItem:a.id,idEmpresa:Object(I["get"])(this.venda,"idEmpresa",""),tipoEstoque:"Disponível"});case 51:return e.t0=function(e){return e.idItem},p=e.sent.find(e.t0),e.next=55,Object(w["imposto"])(a.id,this.cfop.id,this.venda.idEmpresa,this.venda.idContato);case 55:return v=e.sent,e.next=58,Object(w["trocarCfop"])(a.ncm,this.cfop.cfop);case 58:h=e.sent,f={id:Object(w["uuid"])(),idItem:a.id,idDocumento:this.venda.id,dataHoraEmissao:Object(w["dataAtual"])(),descontoItem:0,descontoPercentualItem:0,descontoSubTotal:0,descontoTotalRateado:0,descontoFaturaRateado:0,descricaoItem:a.descricaoConcatenada,operacao:h?h.operacao:this.cfop.operacao,operacaoFator:h?h.fator:this.cfop.fator,idCfop:h?h.id:this.cfop.id,idPlanoContaEstoque:i,idPlanoContaDestino:s,quantidade:o||1,status:this.venda.status,tipoItem:a.tipo,subTotal:a.valorVenda,total:a.valorVenda,valorCusto:0,valorCustoMedio:Object(I["get"])(p,"valorCustoMedio",0),valorCustoReposicao:a.valorCustoReposicao||0,valorCustoUltimo:Object(I["get"])(p,"valorCusto",0),valorItem:a.valorVenda,valorItemUltimo:a.valorVenda,valorOriginal:a.valorVenda,valorReal:a.valorVenda,valorRealTotal:a.valorVenda,valorIpi:Object(w["arredondar"])(Object(I["get"])(v,"aliqIpi",0)/100*a.valorVenda),valorIcmsSt:Object(w["arredondar"])(Object(I["get"])(v,"percIva",0)/100*a.valorVenda),ncm:a.ncm,cest:a.cest},this.carrinho.push(f),r=this.carrinho.findIndex(function(e){return e.idItem===t}),-1!==r&&-1===this.carrinho[r].operacaoFator&&a.novoValorVenda!==this.carrinho[r].valorOriginal&&(a.novoValorVenda<=this.carrinho[r].valorOriginal?(this.carrinho[r].valorItem=this.carrinho[r].valorOriginal,this.carrinho[r].descontoItem=Object(w["arredondar"])(this.carrinho[r].valorOriginal-a.novoValorVenda)):(this.carrinho[r].valorItem=a.novoValorVenda,this.carrinho[r].descontoItem=0),this.carrinhoCalcularTotais(this.carrinho[r].id,"descontoItem")),o||(this.carregarItens(),this.unirProdutos(),this.calcularTotais());case 64:case"end":return e.stop()}},e,this)}));return function(t,a,o){return e.apply(this,arguments)}}(),selecionarItemCodigoBarras:function(e){var t=e.item;this.codigoBarras="",this.entrarCodigoBarras=!1,this.selecionarItem(t.id,t)},salvarVenda:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a,o,r,n,i,s,c;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:for(a in e.prev=0,this.$q.loading.show({message:"Processando..."}),this.$refs.transporte&&(this.venda=m()({},this.venda,this.$refs.transporte.get())),t=Object(w["clonar"])(this.$refs.faturamento.condicaoPagamento),t)delete t[a].idDocumentoCondicaoPagamento,delete t[a].parcelas,delete t[a].formaPagamento,delete t[a].edicao,delete t[a].codigoDocumento,delete t[a].codigoDocumentoCaixa;for(n in o=[],r=[],this.envelopes)o.push(this.envelopes[n]);for(i in this.envelopesOriginal)r.push(this.envelopesOriginal[i]);if(s={venda:this.vendaOriginal,envelopes:r,customs:this.customsOriginal,oss:this.ossOriginal,carrinho:d()(this.carrinhoOriginal).concat(d()(this.itensEnvelopesOriginal)),condicaoPagamento:this.condicaoPagamentoOriginal,documentoEndereco:this.documentoEnderecoOriginal,documentoContato:this.documentoContatoOriginal,arquivo:this.arquivoOriginal},this.venda.observacaoFaturamento=this.$refs.faturamento.observacaoFaturamento,c={venda:this.venda,envelopes:o,customs:this.customs,oss:this.oss,carrinho:d()(this.carrinho).concat(d()(this.itensEnvelopes)),condicaoPagamento:t,documentoEndereco:this.documentoEndereco,documentoContato:this.documentoContato,arquivo:this.arquivo},!Object.keys(Object(w["diferencaObjetos"])(s,c)).length){e.next=17;break}return e.next=15,k["a"].venda.grava({venda:this.venda,vendaOriginal:this.vendaOriginal,customs:this.customs,customsOriginal:this.customsOriginal,oss:this.oss,ossOriginal:this.ossOriginal,envelopes:o,envelopesOriginal:r,carrinho:d()(this.carrinho).concat(d()(this.itensEnvelopes)),carrinhoOriginal:d()(this.carrinhoOriginal).concat(d()(this.itensEnvelopesOriginal)),condicaoPagamento:t,condicaoPagamentoOriginal:this.condicaoPagamentoOriginal,documentoEndereco:this.documentoEndereco,documentoEnderecoOriginal:this.documentoEnderecoOriginal,documentoContato:this.documentoContato,documentoContatoOriginal:this.documentoContatoOriginal,documentoStatus:this.documentoStatus,arquivoOriginal:this.arquivoOriginal,arquivo:this.arquivo});case 15:this.atualizar(),this.$emit("atualizar");case 17:e.next=23;break;case 19:e.prev=19,e.t0=e["catch"](0),this.$q.notifyError("Erro ao salvar.",e.t0),this.$q.loading.hide();case 23:return e.prev=23,this.$q.loading.hide(),e.finish(23);case 26:case"end":return e.stop()}},e,this,[[0,19,23,26]])}));return function(){return e.apply(this,arguments)}}(),configuraImpressaoEnvelope:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,k["a"].configuracoes.porNome("impressao.envelope",t);case 2:a=e.sent,this.configImpressaoEnvelope=d()(a.length?a.map(function(e){return m()({texto:"Imprimir Envelope"},e)}):[{valor:"envelope",texto:"Imprimir Envelope"},{valor:"envelopeMini",texto:"Imprimir Envelope Mini"}]);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),configuraImpressaoOrcamento:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,k["a"].configuracoes.porNome("impressao.venda",t);case 2:a=e.sent,this.configImpressaoOrcamento=d()(a.length?a.map(function(e){return m()({texto:"Imprimir Orçamento"},e)}):[{valor:"invoice",texto:"Orçamento/Venda (Invoice)"}].concat(["optisoul"===this.sistemaPai?{valor:"orcamento",texto:"Orçamento (Antigo)"}:{}]));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),atualizar:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a,o,r,n,i,s,c,l,u,p,v,h,f,b,g,C,x,q,I,E,y,_,P,T,D,j,F,S;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.erroCalculo=!1,this.valoresTabelaPreco=[],this.maximoDesconto=[],this.warningLabel={},this.modalDescontoMaximo={permiteDescontoMaximo:!1,itens:[],resolve:void 0,reject:void 0,visivel:!1},this.modalItemSemEstoque={permiteDescontoMaximo:!1,itens:[],reject:void 0,visivel:!1},e.next=8,Object(O["a"])().documento.get(this.id);case 8:if(e.t0=e.sent,e.t0){e.next=11;break}e.t0={};case 11:return this.vendaOriginal=e.t0,e.next=14,k["a"].permissao.objeto("Diretiva_Vendas_VerMargem");case 14:if(this.permissaoMargem=e.sent,Object.keys(this.vendaOriginal).length){e.next=18;break}return this.adicionar(),e.abrupt("return");case 18:return this.venda=Object(w["clonar"])(this.vendaOriginal),e.next=21,this.atualizaUsaFatura({idContato:this.venda.idEmpresa});case 21:return e.next=23,this.configuraImpressaoEnvelope(this.venda.idEmpresa);case 23:return e.next=25,this.configuraImpressaoOrcamento(this.venda.idEmpresa);case 25:return e.next=27,Object(O["a"])().documentoItem.where({idDocumento:this.venda.id}).sortBy("dataHoraEmissao");case 27:return t=e.sent,this.carrinho=t.filter(function(e){return!e.idDocumentoAdicional}),this.carrinhoOriginal=Object(w["clonarV2"])(this.carrinho),e.next=32,k["a"].documentoCondicaoPagamento.le({idDocumento:this.venda.id});case 32:return this.condicaoPagamentoOriginal=e.sent,this.condicaoPagamento=Object(w["clonar"])(this.condicaoPagamentoOriginal),this.$refs.faturamento&&(this.$refs.faturamento.condicaoPagamento=Object(w["clonar"])(this.condicaoPagamentoOriginal)),e.next=37,Object(O["a"])().documentoEndereco.where({idDocumento:this.venda.id}).toArray();case 37:return this.documentoEnderecoOriginal=e.sent,this.documentoEndereco=Object(w["clonar"])(this.documentoEnderecoOriginal),e.next=41,Object(O["a"])().documentoContato.where({idDocumento:this.venda.id}).toArray();case 41:return this.documentoContatoOriginal=e.sent,this.documentoContato=Object(w["clonar"])(this.documentoContatoOriginal),e.next=45,k["a"].documento.le({tipo:"Envelope",documentoId:this.venda.id});case 45:a=e.sent,this.itensEnvelopesOriginal=[],this.envelopesOriginal={},o=!0,r=!1,n=void 0,e.prev=51,i=a[Symbol.iterator]();case 53:if(o=(s=i.next()).done){e.next=72;break}return c=s.value,c.documentoContato=[],e.next=58,k["a"].documentoContato.le({idDocumento:c.id});case 58:return l=e.sent,l=l.find(function(e){return"Laboratório"===e.descricao}),l&&c.documentoContato.push(l),this.envelopesOriginal[c.id]=c,e.t1=d()(this.itensEnvelopesOriginal),e.t2=d.a,e.next=66,k["a"].documentoItem.le({idDocumentoAdicional:c.id});case 66:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),this.itensEnvelopesOriginal=e.t1.concat.call(e.t1,e.t4);case 69:o=!0,e.next=53;break;case 72:e.next=78;break;case 74:e.prev=74,e.t5=e["catch"](51),r=!0,n=e.t5;case 78:e.prev=78,e.prev=79,o||null==i.return||i.return();case 81:if(e.prev=81,!r){e.next=84;break}throw n;case 84:return e.finish(81);case 85:return e.finish(78);case 86:this.envelopes=Object(w["clonar"])(this.envelopesOriginal),this.itensEnvelopes=Object(w["clonar"])(this.itensEnvelopesOriginal),this.contatos={},e.t6=regeneratorRuntime.keys(this.envelopes);case 90:if((e.t7=e.t6()).done){e.next=99;break}if(u=e.t7.value,p=this.envelopes[u].idContato,this.contatos[p]){e.next=97;break}return e.next=96,k["a"].contato.le({id:p});case 96:this.contatos[p]=e.sent;case 97:e.next=90;break;case 99:if(!this.venda.idContato){e.next=105;break}if(v=this.venda.idContato,this.contatos[v]){e.next=105;break}return e.next=104,k["a"].contato.le({id:v});case 104:this.contatos[v]=e.sent;case 105:return e.next=107,k["a"].documento.le({tipo:"Custom",documentoId:this.venda.id});case 107:e.t8=function(e){return{documento:m()({},e)}},h=e.sent.map(e.t8),f=!0,b=!1,g=void 0,e.prev=112,C=h[Symbol.iterator]();case 114:if(f=(x=C.next()).done){e.next=125;break}return q=x.value,e.next=118,k["a"].documentoItem.le({idDocumentoAdicional:q.documento.id});case 118:return q.documentoItens=e.sent,e.next=121,k["a"].arquivo.le({idTabelaMaster:q.documento.id});case 121:q.arquivo=e.sent;case 122:f=!0,e.next=114;break;case 125:e.next=131;break;case 127:e.prev=127,e.t9=e["catch"](112),b=!0,g=e.t9;case 131:e.prev=131,e.prev=132,f||null==C.return||C.return();case 134:if(e.prev=134,!b){e.next=137;break}throw g;case 137:return e.finish(134);case 138:return e.finish(131);case 139:return this.customs=h,this.customsOriginal=Object(w["clonarV2"])(h),e.next=143,k["a"].permissao.objeto("atendimento//venda/custom");case 143:return this.permissaoCustoms=e.sent,e.next=146,k["a"].documento.le({tipo:"Ordem de Serviço",documentoId:this.venda.id});case 146:e.t10=function(e){return{documento:m()({},e)}},I=e.sent.map(e.t10),E=!0,y=!1,_=void 0,e.prev=151,P=I[Symbol.iterator]();case 153:if(E=(T=P.next()).done){e.next=164;break}return D=T.value,e.next=157,k["a"].documentoItem.le({idDocumentoAdicional:D.documento.id});case 157:return D.documentoItens=e.sent,e.next=160,k["a"].arquivo.le({idTabelaMaster:D.documento.id});case 160:D.arquivo=e.sent;case 161:E=!0,e.next=153;break;case 164:e.next=170;break;case 166:e.prev=166,e.t11=e["catch"](151),y=!0,_=e.t11;case 170:e.prev=170,e.prev=171,E||null==P.return||P.return();case 173:if(e.prev=173,!y){e.next=176;break}throw _;case 176:return e.finish(173);case 177:return e.finish(170);case 178:return this.oss=I,this.ossOriginal=Object(w["clonarV2"])(I),e.next=182,k["a"].permissao.objeto("atendimento//venda/os");case 182:this.permissaoOSs=e.sent,this.carregarItens(),this.unirProdutos(),j=[],e.t12=regeneratorRuntime.keys(this.envelopes);case 187:if((e.t13=e.t12()).done){e.next=195;break}return F=e.t13.value,e.next=191,k["a"].arquivo.leNew({tabelaMaster:"envelope",idTabelaMaster:F});case 191:S=e.sent,j=d()(j).concat(d()(S)),e.next=187;break;case 195:this.arquivoOriginal=j,this.arquivo=Object(w["clonar"])(this.arquivoOriginal),this.calcularTotais(),this.$refs.transporte&&this.$refs.transporte.set(this.venda),localStorage.documentoItemDevolucao&&(localStorage.removeItem("documentoItemDevolucao"),this.salvarVenda());case 200:case"end":return e.stop()}},e,this,[[51,74,78,86],[79,,81,85],[112,127,131,139],[132,,134,138],[151,166,170,178],[171,,173,177]])}));return function(){return e.apply(this,arguments)}}(),unirProdutos:function(){var e=this,t=[],a=[],o=!0,r=!1,n=void 0;try{for(var i,s=this.carrinho[Symbol.iterator]();!(o=(i=s.next()).done);o=!0){var c=i.value;t.push({idDocumentoItem:c.id,dataHoraEmissao:new Date(c.dataHoraEmissao),descricao:(c.descricaoAgrupamento||"").toUpperCase()})}}catch(e){r=!0,n=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw n}}var l=!0,u=!1,m=void 0;try{for(var p,v=this.customs[Symbol.iterator]();!(l=(p=v.next()).done);l=!0){var h=p.value;t.push({idDocumento:h.documento.id,dataHoraEmissao:new Date(h.documento.dataHoraEmissao),descricao:(h.documentoItens.length&&h.documentoItens[0].descricaoAgrupamento||"").toUpperCase()})}}catch(e){u=!0,m=e}finally{try{l||null==v.return||v.return()}finally{if(u)throw m}}var f=!0,b=!1,g=void 0;try{for(var C,x=this.oss[Symbol.iterator]();!(f=(C=x.next()).done);f=!0){var q=C.value;t.push({idDocumento:q.documento.id,dataHoraEmissao:new Date(q.documento.dataHoraEmissao),descricao:(q.documentoItens.length&&q.documentoItens[0].descricaoAgrupamento||"").toUpperCase()})}}catch(e){b=!0,g=e}finally{try{f||null==x.return||x.return()}finally{if(b)throw g}}t=Object(I["orderBy"])(t,["descricao","dataHoraEmissao"],["asc","asc"]);var O="",k=!1,w=!0,E=!1,y=void 0;try{for(var _,P=function(){var t=_.value;O!==t.descricao?(O=t.descricao,k=!0):k=!1,a=d()(a).concat(d()(k?[{caption:O}]:[]),d()(e.carrinho.filter(function(e){return t.idDocumentoItem&&e.id===t.idDocumentoItem})),d()(e.customs.filter(function(e){return t.idDocumento&&e.documento.id===t.idDocumento})),d()(e.oss.filter(function(e){return t.idDocumento&&e.documento.id===t.idDocumento})))},T=t[Symbol.iterator]();!(w=(_=T.next()).done);w=!0)P()}catch(e){E=!0,y=e}finally{try{w||null==T.return||T.return()}finally{if(E)throw y}}this.produtos=a},carregarItens:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a,o,r,n,i,s,c,l;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t={},a=!0,o=!1,r=void 0,e.prev=4,n=this.carrinho[Symbol.iterator]();case 6:if(a=(i=n.next()).done){e.next=19;break}if(s=i.value,c=s.valorItem-s.descontoItem,void 0===this.subTotal[s.id]?this.$set(this.subTotal,s.id,c):this.subTotal[s.id]=c,s.idItem in t){e.next=16;break}return e.next=13,Object(O["a"])().item.get(s.idItem);case 13:l=e.sent,l=m()({},l,{marca:l.marca||"",referencia:l.referencia||"",observacao:l.observacao||"",aplicacao:l.aplicacao||"",imagem:l.imagem||""}),t[l.id]=l;case 16:a=!0,e.next=6;break;case 19:e.next=25;break;case 21:e.prev=21,e.t0=e["catch"](4),o=!0,r=e.t0;case 25:e.prev=25,e.prev=26,a||null==n.return||n.return();case 28:if(e.prev=28,!o){e.next=31;break}throw r;case 31:return e.finish(28);case 32:return e.finish(25);case 33:this.item=m()({},this.item,t);case 34:case"end":return e.stop()}},e,this,[[4,21,25,33],[26,,28,32]])}));return function(){return e.apply(this,arguments)}}(),calcularTotais:function(e){var t=m()({},this.venda);t.subTotal=0,t.totalProduto=0,t.totalServico=0;var a=!0,o=!1,r=void 0;try{for(var n,i=this.carrinho[Symbol.iterator]();!(a=(n=i.next()).done);a=!0){var s=n.value;t.subTotal=Object(w["arredondar"])(t.subTotal+s.total)}}catch(e){o=!0,r=e}finally{try{a||null==i.return||i.return()}finally{if(o)throw r}}for(var c in this.envelopes)t.subTotal=Object(w["arredondar"])(t.subTotal+this.envelopes[c].totalDocumento);var l=!0,d=!1,u=void 0;try{for(var p,v=this.customs[Symbol.iterator]();!(l=(p=v.next()).done);l=!0){var h=p.value;t.subTotal=Object(w["arredondar"])(t.subTotal+h.documento.totalDocumento)}}catch(e){d=!0,u=e}finally{try{l||null==v.return||v.return()}finally{if(d)throw u}}var f=!0,b=!1,g=void 0;try{for(var C,x=this.oss[Symbol.iterator]();!(f=(C=x.next()).done);f=!0){var q=C.value;t.subTotal=Object(w["arredondar"])(t.subTotal+q.documento.totalDocumento)}}catch(e){b=!0,g=e}finally{try{f||null==x.return||x.return()}finally{if(b)throw g}}"totalPercentualDesconto"===e&&(t.subTotal>0?t.totalDesconto=Object(w["arredondar"])(t.totalPercentualDesconto/100*t.subTotal):(t.totalDesconto=0,t.totalPercentualDesconto=0,t.totalDocumento=0)),"totalDesconto"===e&&(t.subTotal>0?t.totalPercentualDesconto=Object(w["arredondar"])(t.totalDesconto/t.subTotal*100):(t.totalDesconto=0,t.totalPercentualDesconto=0,t.totalDocumento=0)),t.totalProduto=t.subTotal,t.totalPercentualDesconto=Object(w["arredondar"])(t.totalDesconto/t.subTotal*100),t.totalDocumento=Object(w["arredondar"])(t.subTotal-t.totalDesconto+("FOB"===t.tipoFrete&&t.valorFrete||0)),this.erroCalculo=!1,(t.totalPercentualDesconto<0||t.totalPercentualDesconto>100)&&(this.erroCalculo=!0),this.venda=t,this.calcularMargens(),this.calcularImposto()},carrinhoCalcularTotais:function(){var e=i()(regeneratorRuntime.mark(function e(t,a){var o,r,n,i,s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(o=this.carrinho.find(function(e){return e.id===t}),"quantidade"!==a||-1!==o.operacaoFator||!this.venda.idItemTabelaPreco){e.next=10;break}return e.next=4,Object(O["a"])().itemTabelaPreco.get(this.venda.idItemTabelaPreco);case 4:if(r=e.sent,!r){e.next=10;break}return e.next=8,this.configurarValoresTabelaPreco(r,o);case 8:n=this.valoresTabelaPreco.find(function(e){return e.id===o.id}),n.quantidadeMaiorQue&&o.quantidade>=n.quantidadeMaiorQue?(o.valorOriginal!==n.valorVendaMaiorQue&&(o.valorOriginal=n.valorVendaMaiorQue,o.valorItem=n.valorVendaMaiorQue,o.descontoItem=o.descontoPercentualItem=0),this.warningLabel[o.id]="Valor Diferenciado"):(o.valorOriginal!==n.valorVenda&&(o.valorOriginal=n.valorVenda,o.valorItem=n.valorVenda,o.descontoItem=o.descontoPercentualItem=0),this.warningLabel[o.id]="");case 10:return o.valorItem<o.valorOriginal&&(o.valorItem=o.valorOriginal),"descontoPercentualItem"===a&&(o.descontoItem=Object(w["arredondar"])(o.descontoPercentualItem/100*o.valorItem)),["descontoItem","valorItem"].includes(a)&&(o.descontoPercentualItem=Object(w["arredondar"])(o.descontoItem/o.valorItem*100)),o.descontoItem>o.valorItem&&-1===o.operacaoFator&&(o.descontoPercentualItem=o.descontoItem=0),["subTotal"].includes(a)&&(void 0!==this.subTotal[o.id]?o.descontoItem=Object(w["arredondar"])(o.valorItem-this.subTotal[o.id]):o.descontoItem=Object(w["arredondar"])(o.valorItem-o.subTotal),o.descontoPercentualItem=Object(w["arredondar"])(o.descontoItem/o.valorItem*100)),i=o.valorItem-o.descontoItem,Object(w["arredondar"])(i)>Object(w["arredondar"])(o.valorItem)&&-1===o.operacaoFator&&(i=o.valorItem,o.descontoPercentualItem=o.descontoItem=0),void 0===this.subTotal[o.id]?this.$set(this.subTotal,o.id,i):this.subTotal[o.id]=i,o.subTotal=Object(w["arredondar"])(i*o.quantidade),o.total=o.subTotal,o.valorReal=i,o.valorRealTotal=o.total,e.next=24,Object(w["imposto"])(o.idItem,o.idCfop,this.venda.idEmpresa,this.venda.idContato);case 24:s=e.sent,o.valorIpi=Object(w["arredondar"])(Object(I["get"])(s,"aliqIpi",0)/100*o.valorRealTotal),o.valorIcmsSt=Object(w["arredondar"])(Object(I["get"])(s,"percIva",0)/100*o.valorRealTotal),this.unirProdutos(),this.calcularTotais();case 29:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},props:{id:{default:"",required:!0,type:String}},watch:{id:function(){this.atualizar()}},mounted:function(){var e=i()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.atualizar();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),created:function(){this.sistemaPai=Object(w["sistemaPai"])(),this.subTotal={}}},Ve=Ne,$e=(a("6e82"),Object(P["a"])(Ve,s,c,!1,null,null,null));$e.options.__file="Venda.vue";var Me=$e.exports,Ae={components:{Venda:Me},computed:{},data:function(){return{codigoBarras:"",titulo:"",venda:{},visibilidade:{modal:!1,botao:{cancelar:!1,finalizar:!1,naoAprovado:!1,salvar:!1}},carregando:!0}},methods:{atualizar:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t="Orçamento",a={id:Object(w["uuid"])(),tipo:"Venda",status:"Orçamento"},!this.id){e.next=6;break}return e.next=5,k["a"].venda.leNew({id:this.id});case 5:a=e.sent;case 6:"Orçamento"!==a.status&&(t="Venda"),this.venda=a,this.titulo=t,this.visibilidade.modal=!0;case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),executar:function(){var e=i()(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:e.t0=t,e.next="cancelar"===e.t0?3:"finalizar"===e.t0?6:"reprovar"===e.t0?17:22;break;case 3:return e.next=5,this.$refs.venda.cancelar();case 5:return e.abrupt("break",22);case 6:return e.next=8,this.$refs.venda.finalizar();case 8:if(e.sent){e.next=12;break}return e.abrupt("return");case 12:return e.next=14,k["a"].documento.le({id:this.venda.id});case 14:a=e.sent,a.idFatura&&localStorage.setItem("idFatura",a.idFatura);case 16:return e.abrupt("break",22);case 17:return e.next=19,this.$refs.venda.reprovarOrcamento();case 19:if(e.sent){e.next=21;break}return e.abrupt("return");case 21:return e.abrupt("break",22);case 22:this.$emit("executar",t),this.fechar();case 24:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),fechar:function(){this.titulo="",this.venda={},this.carregando=!0,this.visibilidade={modal:!1,botao:{cancelar:!1,finalizar:!1,naoAprovado:!1,salvar:!1}}},mostrar:function(){var e=i()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(w["dormir"])(500);case 2:this.carregando=!1;case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),salvar:function(){var e=i()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$refs.venda.salvarVenda();case 2:this.$emit("executar","atualizar"),this.fechar();case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},props:{id:{default:"",type:String},value:{default:!1,required:!0,type:Boolean}},watch:{value:function(e){e&&this.atualizar()},venda:function(e){this.visibilidade.botao.cancelar=!1,this.visibilidade.botao.finalizar=!1,this.visibilidade.botao.naoAprovado=!1,this.visibilidade.botao.salvar=!0,"Não Aprovado"===e.status&&(this.visibilidade.botao.salvar=!1),"Orçamento"!==e.status&&(this.visibilidade.botao.cancelar=!1),"Orçamento"===e.status&&(this.visibilidade.botao.finalizar=!0,this.visibilidade.botao.naoAprovado=!0)},"visibilidade.modal":function(e){this.$emit("input",e)}}},Be=Ae,ze=(a("4375"),Object(P["a"])(Be,o,r,!1,null,"bc07a472",null));ze.options.__file="VendaModal.vue";t["a"]=ze.exports},"306b":function(e,t,a){"use strict";var o=a("bb95"),r=a.n(o);r.a},"32f7":function(e,t,a){"use strict";var o=a("52ee"),r=a.n(o);r.a},4375:function(e,t,a){"use strict";var o=a("e9d9"),r=a.n(o);r.a},"52ee":function(e,t,a){},"5d5c":function(e,t,a){"use strict";var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("badge",{attrs:{cor:e.cor,escuro:"warning"!==e.cor}},[e._v("\n  "+e._s(e.codigo)+"\n\n  "),e.status?a("q-tooltip",[e._v("\n    "+e._s(e.status)+"\n    "),e.prioridade&&e.prioridade.tooltip?[e._v(e._s(e.prioridade.tooltip))]:e._e()],2):e._e()],1)},r=[];o._withStripped=!0;var n=a("a0fd"),i={components:{Badge:n["a"]},computed:{codigo:function(){return this.documento.numero?"#"+this.documento.numero:this.documento.id?"#"+this.documento.id.slice(-6):""},cor:function(){if(this.status){if(this.prioridade&&this.prioridade.cor)return this.prioridade.cor;var e=this.status.toUpperCase(),t={ABERTA:"positive","AGUARDANDO FATURAMENTO":"warning","AGUARDANDO PAGAMENTO":"warning",CANCELADO:"negative",FATURADO:"faded",FINALIZADO:"faded","NÃO APROVADO":"negative","ORÇAMENTO":"positive"};return t[e]||"positive"}},status:function(){return this.documento.status||null}},props:{documento:{default:function(){return{}},required:!0,type:Object},prioridade:Object}},s=i,c=a("2877"),l=Object(c["a"])(s,o,r,!1,null,null,null);l.options.__file="DocumentoCodigo.vue";t["a"]=l.exports},6461:function(e,t,a){},"65ac":function(e,t,a){},"6e82":function(e,t,a){"use strict";var o=a("b6db"),r=a.n(o);r.a},8238:function(e,t,a){},"8b34":function(e,t,a){"use strict";var o=a("65ac"),r=a.n(o);r.a},"95fe":function(e,t,a){"use strict";var o=a("fdcf"),r=a.n(o);r.a},"9e1b":function(e,t,a){},a864:function(e,t,a){},a9d2:function(e,t,a){"use strict";var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"q-pa-sm border-1 q-my-sm DocumentoMetas text-faded row"},e._l(e.metaDados,function(t,o){return a("div",{key:o,staticClass:"DocumentoMetas-item col-12 col-lg  "},[a("div",{staticClass:"row q-ml-md"},[a("div",{staticClass:"DocumentoMetas-itemRotulo2 q-caption text-weight-bold col-auto q-mr-sm "},[e._v(e._s(o))]),a("div",{staticClass:"DocumentoMetas-itemConteudo2 q-caption col"},e._l(t,function(t,o){return a("div",{key:o},[e._v(" "+e._s(t))])}))])])}))},r=[];o._withStripped=!0;a("96cf");var n=a("c973"),i=a.n(n),s=a("ed08"),c=a("8149"),l={data:function(){return{metaDados:{}}},props:{documento:{default:function(){return{}},required:!0,type:Object},idContatoComprador:{type:String},idContatoRepresentando:{type:String}},watch:{documento:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.documento,a={},a["ID"]=[t.id],t.idFatura||(a["Emitente"]=[t.descricaoEmpresa,t.numeroDocumentoEmpresa]),!t.idFatura&&t.idContato&&(a["End./Tel."]=[t.descricaoContatoEndereco,t.telefoneContato]),!t.idContatoVendedor){e.next=10;break}return e.next=8,c["a"].contato.le({id:t.idContatoVendedor});case 8:e.t0=e.sent.nome,a["Vendedor"]=[e.t0];case 10:if(!t.idContatoDigitador){e.next=15;break}return e.next=13,c["a"].contato.le({id:t.idContatoDigitador});case 13:e.t1=e.sent.nome,a["Digitador"]=[e.t1];case 15:if(!t.idContatoIndicacao){e.next=20;break}return e.next=18,c["a"].contato.le({id:t.idContatoIndicacao});case 18:e.t2=e.sent.nome,a["Indicação"]=[e.t2];case 20:if(!t.idContatoResponsavel){e.next=25;break}return e.next=23,c["a"].contato.le({id:t.idContatoResponsavel});case 23:e.t3=e.sent.nome,a["Convênio"]=[e.t3];case 25:if(!this.idContatoComprador){e.next=30;break}return e.next=28,c["a"].contato.le({id:this.idContatoComprador});case 28:e.t4=e.sent.nome,a["Comprador"]=[e.t4];case 30:if(!this.idContatoRepresentando){e.next=35;break}return e.next=33,c["a"].contato.le({id:this.idContatoRepresentando});case 33:e.t5=e.sent.nome,a["Representando"]=[e.t5];case 35:if(t.operacao&&(a["Operação"]=[t.operacao]),!t.idItemTabelaPreco){e.next=41;break}return e.next=39,c["a"].itemTabelaPreco.le({id:t.idItemTabelaPreco});case 39:e.t6=e.sent.descricao,a["Tabela de Preço"]=[e.t6];case 41:t.dataHoraEmissao&&(a["Emissão"]=[this.$filters.dataHora(t.dataHoraEmissao)]),t.dataHoraFinalizado&&(a["Finalização"]=[this.$filters.dataHora(t.dataHoraFinalizado)]),this.metaDados=Object(s["compactarObjeto"])(a);case 44:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}},d=l,u=(a("12f6"),a("2877")),m=Object(u["a"])(d,o,r,!1,null,null,null);m.options.__file="DocumentoMetas.vue";t["a"]=m.exports},b6db:function(e,t,a){},bb95:function(e,t,a){},bdf0:function(e,t,a){"use strict";var o=a("8238"),r=a.n(o);r.a},c281:function(e,t,a){"use strict";var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-modal",{attrs:{maximized:""},model:{value:e.modal.visivel,callback:function(t){e.$set(e.modal,"visivel",t)},expression:"modal.visivel"}},[a("q-modal-layout",{staticClass:"bg-light"},[a("q-toolbar",{attrs:{slot:"header"},slot:"header"},[a("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{flat:"",round:"",dense:"",icon:"arrow_back"}}),a("q-toolbar-title",[e._v("Equipamento")]),a("q-btn",{staticClass:"q-ml-sm no-shadow",attrs:{color:"white","text-color":"primary",label:"Salvar"},on:{click:function(t){e.tryLoading(e.salvarEquipamento,{erro:"Ocorreu erro ao salvar equipamento"})}}})],1),a("div",{staticClass:"bg-white q-mx-md q-pa-md"},[a("div",{staticClass:"gutter-x-sm items-center row"},[a("campo",{staticClass:"col-12 col-sm-6",attrs:{rotulo:"Tipo",tipo:"seletor",opcoes:e.opcoesTipoEquipamento},model:{value:e.campos.tipo,callback:function(t){e.$set(e.campos,"tipo",t)},expression:"campos.tipo"}}),a("SeletorItem",{staticClass:"col-12 col-sm-6",attrs:{rotulo:"Produto"},model:{value:e.campos.idItem,callback:function(t){e.$set(e.campos,"idItem",t)},expression:"campos.idItem"}}),a("campo",{staticClass:"col-12",attrs:{rotulo:"Descrição"},model:{value:e.campos.descricao,callback:function(t){e.$set(e.campos,"descricao",t)},expression:"campos.descricao"}})],1),a("div",{staticClass:"gutter-x-sm items-center row"},[a("campo",{staticClass:"col-6 col-sm-3",attrs:{rotulo:"Marca"},model:{value:e.campos.marca,callback:function(t){e.$set(e.campos,"marca",t)},expression:"campos.marca"}}),a("campo",{staticClass:"col-6 col-sm-3",attrs:{rotulo:"Modelo"},model:{value:e.campos.modelo,callback:function(t){e.$set(e.campos,"modelo",t)},expression:"campos.modelo"}}),a("campo",{staticClass:"col-6 col-sm-3",attrs:{rotulo:"Cor"},model:{value:e.campos.cor,callback:function(t){e.$set(e.campos,"cor",t)},expression:"campos.cor"}})],1),a("div",{staticClass:"gutter-x-sm items-center row"},["Veículo"===e.campos.tipo?[a("campo",{staticClass:"col-6 col-sm-3",attrs:{rotulo:"Placa"},on:{input:function(t){e.campos.placa=e.campos.placa.toUpperCase()}},model:{value:e.campos.placa,callback:function(t){e.$set(e.campos,"placa",t)},expression:"campos.placa"}}),a("campo",{staticClass:"col-6 col-sm-3",attrs:{rotulo:"Chassi"},model:{value:e.campos.chassi,callback:function(t){e.$set(e.campos,"chassi",t)},expression:"campos.chassi"}})]:[a("campo",{staticClass:"col-6 col-sm-3",attrs:{rotulo:"Número de série"},model:{value:e.campos.numeroSerie,callback:function(t){e.$set(e.campos,"numeroSerie",t)},expression:"campos.numeroSerie"}}),"Ar condicionado"===e.campos.tipo?a("campo",{staticClass:"col-6 col-sm-3",attrs:{rotulo:"BTU"},model:{value:e.campos.btu,callback:function(t){e.$set(e.campos,"btu",t)},expression:"campos.btu"}}):e._e(),a("campo",{staticClass:"col-6 col-sm-3",attrs:{rotulo:"Data de validade",tipo:"data"},model:{value:e.campos.dataValidade,callback:function(t){e.$set(e.campos,"dataValidade",t)},expression:"campos.dataValidade"}})],a("campo",{staticClass:"col-6 col-sm-3",attrs:{rotulo:"Data final garantia",tipo:"data"},model:{value:e.campos.dataFinalGarantia,callback:function(t){e.$set(e.campos,"dataFinalGarantia",t)},expression:"campos.dataFinalGarantia"}})],2),a("div",{staticClass:"gutter-x-sm items-center row"},[a("campo",{staticClass:"col-12",attrs:{rotulo:"Observação"},model:{value:e.campos.observacao,callback:function(t){e.$set(e.campos,"observacao",t)},expression:"campos.observacao"}})],1)]),a("div",{staticClass:"items-center justify-around q-my-lg row"},[e.campos.dataCadastro?a("small",[e._v("Data do cadastro: "+e._s(e._f("dataHora")(e.campos.dataCadastro)))]):e._e()])],1)],1)},r=[];o._withStripped=!0;a("a481"),a("28a5"),a("96cf");var n=a("c973"),i=a.n(n),s=a("7ab0"),c={components:{SeletorItem:s["a"]},computed:{campos:function(){return this.modal.campos}},data:function(){return{opcoesTipoEquipamento:[]}},methods:{atualizar:function(){var e=i()(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$db.configuracoes.leValor("equipamento.tipos","Equipamento");case 3:t=e.sent,this.opcoesTipoEquipamento=t.split(";").filter(function(e){return e}).map(function(e){return{rotulo:e.trim(),valor:e.trim()}}),this.modal.campos.tipo||this.$set(this.modal.campos,"tipo",this.opcoesTipoEquipamento[0].valor),e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),this.$q.notifyError("Erro ao carregar os dados",e.t0);case 11:case"end":return e.stop()}},e,this,[[0,8]])}));return function(){return e.apply(this,arguments)}}(),salvarEquipamento:function(){var e=i()(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=this.$utils.clonarV2(this.modal.campos),this.$utils.gconsole.log("Equipamentos","salvarEquipamento",t),this.$utils.verificarErro(!t.tipo,"Tipo de equipamento não selecionado"),t.id||(t.id=this.$utils.uuid()),t.dataCadastro||(t.dataCadastro=this.$utils.dataAtual()),t.idContato||(t.idContato=this.$db.contato.selecionado.id),"Veículo"===t.tipo?(t.placa=(t.placa||"").replace(/ /g,""),t.numeroSerie="",t.dataValidade=""):(t.chassi="",t.placa=""),"Ar condicionado"!==t.tipo&&(t.btu=""),e.next=10,this.$db.equipamento.grava({atual:t,original:this.modal.original});case 10:this.$q.notifyPositive("Equipamento salvo com sucesso"),this.modal.visivel=!1,this.$emit("atualizar",t);case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},props:{modal:{required:!0,type:Object}},watch:{"modal.visivel":function(e){e&&this.atualizar()}},mounted:function(){this.atualizar()}},l=c,d=(a("306b"),a("2877")),u=Object(d["a"])(l,o,r,!1,null,null,null);u.options.__file="EquipamentoModal.vue";t["a"]=u.exports},db8e:function(e,t,a){},dd9d:function(e,t,a){"use strict";a("ac4d"),a("8a81"),a("ac6a"),a("7514"),a("6762"),a("2fdb"),a("96cf");var o=a("c973"),r=a.n(o),n=a("8149"),i=a("ed08");t["a"]={methods:{emitirNFeV2:function(){var e=r()(regeneratorRuntime.mark(function e(t){var a,o,r,s,c,l,d,u,m,p,v,h,f,b,g,C,x=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return a=t.idVenda,o=t.idFatura,r=x.length>1&&void 0!==x[1]?x[1]:1,s=x.length>2&&void 0!==x[2]?x[2]:"",i["gconsole"].log("emitirNFe","emitirNFeV2()",s),e.prev=4,Object(i["verificarExcecao"])(![1,0].includes(r)||!(a||o),"Parâmetros inválidos."),c=o||a,e.next=9,n["a"].documento.le({id:c});case 9:if(l=e.sent,Object(i["verificarErro"])(!l||!l.status||!l.tipo,"Erro ao emitir nota. Falha na consulta da fatura/venda."),Object(i["verificarErro"])(!this.$utils.mapearStatus(l).permiteNota,"A ".concat(l.tipo," não foi finalizada.")),"Remessa"===s){e.next=59;break}return e.next=15,n["a"].documentoFiscalEletronico.le({idDocumento:c});case 15:if(d=e.sent,Object(i["verificarErro"])(!d,"Falha na consulta das notas"),Object(i["verificarErro"])(d.find(function(e){return"Cancelado"!==e.situacao&&e.operacao===s}),"".concat(l.tipo," já possui nota de ").concat(s)),!a){e.next=25;break}return Object(i["verificarErro"])("Venda"!==l.tipo,"Venda inválida"),e.next=22,n["a"].documentoFiscalEletronico.le({idDocumento:l.idFatura});case 22:u=e.sent,Object(i["verificarErro"])(!u,"Falha na consulta das notas"),Object(i["verificarErro"])(u.find(function(e){return"Cancelado"!==e.situacao&&e.operacao===s}),"Fatura da Venda já possui nota de ".concat(s));case 25:if(!o){e.next=59;break}return Object(i["verificarErro"])("Fatura"!==l.tipo,"Fatura inválida"),e.next=29,n["a"].documento.le({idFatura:o});case 29:m=e.sent,p=!0,v=!1,h=void 0,e.prev=33,f=m[Symbol.iterator]();case 35:if(p=(b=f.next()).done){e.next=45;break}return g=b.value,e.next=39,n["a"].documentoFiscalEletronico.le({idDocumento:g.id});case 39:C=e.sent,Object(i["verificarErro"])(!C,"Falha na consulta das notas"),Object(i["verificarErro"])(C.find(function(e){return"Cancelado"!==e.situacao&&e.operacao===s}),"Fatura/Venda já possui nota de ".concat(s,". Favor emitir a NFe a partir de cada venda da fatura."));case 42:p=!0,e.next=35;break;case 45:e.next=51;break;case 47:e.prev=47,e.t0=e["catch"](33),v=!0,h=e.t0;case 51:e.prev=51,e.prev=52,p||null==f.return||f.return();case 54:if(e.prev=54,!v){e.next=57;break}throw h;case 57:return e.finish(54);case 58:return e.finish(51);case 59:return e.next=61,Object(i["atualizarCfop"])(c);case 61:this.$q.loading.show({message:"Processando"}),i["eventos"].$emit("gerarNFe",c,r,s),e.next=68;break;case 65:e.prev=65,e.t1=e["catch"](4),this.$q.notifyError("Ocorreu um erro ao gerar NFe",e.t1);case 68:return e.prev=68,this.$q.loading.hide(),e.finish(68);case 71:case"end":return e.stop()}},e,this,[[4,65,68,71],[33,47,51,59],[52,,54,58]])}));return function(t){return e.apply(this,arguments)}}()}}},e3f4:function(e,t,a){"use strict";var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{},[e.documentosSat.length||e.documentosFiscais.length||e.documentosNFe.length?a("p",{staticClass:"q-item-label ",staticStyle:{color:"#0c0c0c"}},[a("q-icon",{staticClass:"q-mr-md",staticStyle:{color:"#737373"},attrs:{name:"account_balance",size:"24px"}}),e._v(" Documentos fiscais\n  ")],1):e._e(),e.documentosSat.length?a("q-list",{staticClass:"q-pa-none",attrs:{highlight:""}},e._l(e.documentosSat,function(t){return a("q-item",{key:t.id,staticClass:"row u-separador q-my-none q-pa-xs"},[a("div",{staticClass:"col-9 col-lg-10 q-pl-sm"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-4 col-sm-1"},[e._v("SAT")]),a("div",{staticClass:"col-4 col-sm-1"},[e._v(e._s(t.numeroCupom))]),a("div",{staticClass:"col-4 col-sm-3"},[e._v(e._s(t.cancelamento?"Cancelado":"Emitido"))]),a("div",{staticClass:"col-6 col-sm-4"},[e._v(e._s(e._f("numero")(t.valorTotal,2)))]),a("div",{staticClass:"col-6 col-sm-3"},[e._v(e._s(e._f("dataHora")(t.dataHoraEmissao)))])])]),a("div",{staticClass:"col-3 col-lg-2 text-right"},[a("q-btn",{attrs:{color:"primary",dense:"",flat:"",icon:"print",round:""},on:{click:function(a){e.reimprimirSat(t.id)}}},[a("q-tooltip",[e._v("Reimprimir SAT")])],1),t.cancelamento?e._e():[a("q-btn",{attrs:{color:"primary",dense:"",flat:"",icon:"cancel",round:""},on:{click:function(a){e.cancelarSat(t.id)}}},[a("q-tooltip",[e._v("Cancelar SAT")])],1)]],2)])})):e._e(),e.documentosFiscais.length?a("q-list",{staticClass:"q-pa-none",attrs:{highlight:""}},e._l(e.documentosFiscais,function(t){return a("q-item",{key:t.id,staticClass:"row q-px-xs"},[a("div",{staticClass:"col-10 q-pl-sm"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-3 col-sm-1"},[e._v(e._s(t.tipo))]),a("div",{staticClass:"col-3 col-sm-2"},[e._v(e._s(t.nNF))]),a("div",{staticClass:"col-6 col-sm-4"},[e._v(e._s(t.situacao)+"\n            "+e._s("2"===t.tpAmb?"em Homologação":"")+"\n            "+e._s(t.operacao?" - "+t.operacao:"")+"\n          ")]),a("div",{staticClass:"col-6 col-sm-2"},[e._v(e._s(e._f("numero")(t.vNF,2)))]),a("div",{staticClass:"col-6 col-sm-3"},[e._v(e._s(e._f("dataHora")(t.dataHoraEmissao)))])])]),a("div",{staticClass:"col-2 text-right"},["NFCe"===t.tipo?["Emitido"===t.situacao?[a("q-btn",{attrs:{color:"primary",dense:"",flat:"",icon:"print",round:""},on:{click:function(a){e.reimprimirNFCe(t.id)}}},[a("q-tooltip",[e._v("Reimprimir NFCe")])],1),a("q-btn",{attrs:{color:"primary",dense:"",flat:"",icon:"cancel",round:""},on:{click:function(a){e.cancelarNFCe(t.id)}}},[a("q-tooltip",[e._v("Cancelar NFCe")])],1)]:e._e(),a("q-btn",{attrs:{color:"primary",dense:"",flat:"",icon:"open_in_browser",round:""},on:{click:function(a){e.verNoSefaz(t.qrCode)}}},[a("q-tooltip",[e._v("Ver no Sefaz")])],1)]:"NFe"===t.tipo?["Em digitação"!==t.situacao?[a("q-btn",{staticClass:"no-shadow q-ma-xs",staticStyle:{float:"right"},attrs:{rounded:"",dense:"",flat:"",icon:"print",color:"primary",size:"md"}},[a("q-popover",[a("q-list",{attrs:{link:"",separator:""}},e._l(e.configImpressaoNFe,function(o){return a("q-item",{key:o.valor,nativeOn:{click:function(a){e.imprimir(o.valor,t.id)}}},[a("q-item-side",{attrs:{icon:"print"}}),a("q-item-main",{attrs:{label:o.texto}})],1)}))],1)],1)]:e._e(),a("q-btn",{attrs:{color:"primary",dense:"",flat:"",icon:"edit",round:""},on:{click:function(a){e.abrirNFe(t.id)}}},[a("q-tooltip",[e._v("Abrir")])],1)]:e._e()],2)])})):e._e(),e.documentosNFe.length?a("q-list",{staticClass:"q-pa-none",attrs:{highlight:""}},e._l(e.documentosNFe,function(t,o){return a("q-item",{key:o,staticClass:"row u-separador q-my-none q-pa-xs"},[a("div",{staticClass:"col-9 col-lg-10 q-pl-sm"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-4 col-sm-1"},[e._v("NFe")]),a("div",{staticClass:"col-4 col-sm-1"},[e._v(e._s(t.noNota))]),a("div",{staticClass:"col-4 col-sm-3"},[e._v(e._s(t.nfeCanceladaEvento?"Cancelado":"Emitido"))]),a("div",{staticClass:"col-6 col-sm-4"},[e._v(e._s(e._f("numero")(t.valTotNota,2)))]),a("div",{staticClass:"col-6 col-sm-3"},[e._v(e._s(e._f("dataHora")(t.horaSaidaEntrada)))])])])])})):e._e(),a("CpfCnpjNoCupom",{attrs:{dados:e.cpfCnpjNoCupom},on:{confirmar:e.emitirCupomConfirma},model:{value:e.cpfCnpjNoCupom.visivel,callback:function(t){e.$set(e.cpfCnpjNoCupom,"visivel",t)},expression:"cpfCnpjNoCupom.visivel"}}),a("ItemTrocarCest",{attrs:{modal:e.modalItemTrocarCest},on:{confirmar:function(t){e.emitirCupomConfirma(e.cpfCnpjNoCupom)}}})],1)},r=[];o._withStripped=!0;a("6b54"),a("ac4d"),a("8a81"),a("ac6a"),a("551c");var n=a("3156"),i=a.n(n),s=(a("28a5"),a("448a")),c=a.n(s),l=(a("7514"),a("6762"),a("2fdb"),a("c5f6"),a("55dd"),a("96cf"),a("c973")),d=a.n(l),u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-modal",{attrs:{value:e.value},on:{input:e.eventoInput}},[a("q-modal-layout",[a("q-toolbar",{attrs:{slot:"header"},slot:"header"},[a("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"arrow_back",round:""}}),a("q-toolbar-title",[e._v("CPF/CNPJ no Cupom")])],1),a("form",{on:{submit:function(t){return t.preventDefault(),e.eventoConfirmar(t)}}},[a("div",{staticClass:"layout-padding"},[a("div",{staticClass:"row gutter-x-sm"},[a("campo",{staticClass:"col-12",attrs:{rotulo:"Incluir CPF/CNPJ no cupom",tipo:"logico"},model:{value:e.dados.incluirCpfCnpjNoCupom,callback:function(t){e.$set(e.dados,"incluirCpfCnpjNoCupom",t)},expression:"dados.incluirCpfCnpjNoCupom"}})],1),e.dados.incluirCpfCnpjNoCupom?[a("div",{staticClass:"row gutter-x-sm"},[a("q-field",{staticClass:"col-12",attrs:{error:e.cpfCnpjErro,"error-label":"CPF/CNPJ inválido"}},[a("q-input",{directives:[{name:"mask",rawName:"v-mask",value:["###.###.###-##","##.###.###/####-##"],expression:"['###.###.###-##', '##.###.###/####-##']"}],attrs:{"float-label":"CPF / CNPJ"},on:{input:function(t){e.cpfCnpjErro=!1}},model:{value:e.dados.cpfCnpj,callback:function(t){e.$set(e.dados,"cpfCnpj",t)},expression:"dados.cpfCnpj"}})],1)],1),a("div",{staticClass:"row gutter-x-sm"},[a("campo",{staticClass:"col-12",attrs:{rotulo:"Nome"},model:{value:e.dados.nomeCliente,callback:function(t){e.$set(e.dados,"nomeCliente",t)},expression:"dados.nomeCliente"}})],1)]:e._e()],2),a("q-toolbar",{attrs:{slot:"footer",color:"light"},slot:"footer"},[a("q-toolbar-title",[a("div",{staticClass:"row justify-end"},[a("q-btn",{attrs:{flat:"",color:"primary",label:"Cancelar"},on:{click:function(t){e.eventoInput(!1)}}}),a("q-btn",{attrs:{flat:"",color:"primary",type:"submit",label:"Emitir "+e.dados.tipoCaixa}})],1)])],1)],1)],1)],1)},m=[];u._withStripped=!0;var p=a("88db"),v=a("ed08"),h={components:{Campo:p["a"]},data:function(){return{cpfCnpjErro:!1}},methods:{eventoConfirmar:function(){if(v["gconsole"].log("CpfCnpjNoCupom","eventoConfirmar",this.dados),this.dados.incluirCpfCnpjNoCupom){if(this.dados.cpfCnpj&&!Object(v["validarDocumentoNacional"])(this.dados.cpfCnpj))return void(this.cpfCnpjErro=!0)}else this.dados.cpfCnpj="",this.dados.nomeCliente="";this.eventoInput(!1),this.$emit("confirmar",this.dados)},eventoInput:function(e){this.$emit("input",e)}},watch:{value:function(){this.value&&(this.cpfCnpjErro=!1)}},props:{value:{required:!0,type:Boolean},dados:{required:!0,type:Object}}},f=h,b=a("2877"),g=Object(b["a"])(f,u,m,!1,null,null,null);g.options.__file="CpfCnpjNoCupom.vue";var C=g.exports,x=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-modal",{attrs:{maximized:""},model:{value:e.modal.visivel,callback:function(t){e.$set(e.modal,"visivel",t)},expression:"modal.visivel"}},[a("q-modal-layout",{staticClass:"bg-light"},[a("q-toolbar",{attrs:{slot:"header"},slot:"header"},[a("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{flat:"",round:"",dense:"",icon:"arrow_back"}}),a("q-toolbar-title",[e._v("Selecionar CEST para os itens")]),a("q-btn",{staticClass:"q-ml-sm no-shadow",attrs:{color:"white","text-color":"primary",label:"Salvar"},on:{click:function(t){e.tryLoading(e.confirmar,{erro:"Ocorreu erro ao salvar equipamento"})}}})],1),a("div",{staticClass:"bg-white q-mx-md q-pa-md"},e._l(e.itens,function(t){return a("div",{key:t.id,staticClass:"gutter-x-sm items-baseline row"},[a("campo",{staticClass:"col-12 col-md-6",attrs:{value:t.descricao,rotulo:"Descrição","apenas-leitura":""}}),a("campo",{staticClass:"col-12 col-md-3",attrs:{value:t.ncm,rotulo:"NCM","apenas-leitura":""}}),a("SeletorCest",{staticClass:"col-12 col-md-3",attrs:{ncm:t.ncm},model:{value:t.cest,callback:function(a){e.$set(t,"cest",a)},expression:"item.cest"}})],1)}))],1)],1)},q=[];x._withStripped=!0;var O=a("51f0"),k=a("3e8a"),I={components:{SeletorCest:O["a"]},computed:{campos:function(){return this.modal.campos}},data:function(){return{itens:[]}},methods:{atualizar:function(){var e=d()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,!this._.get(this.campos,"ids.length")){e.next=8;break}return e.next=4,Object(k["a"])().item.where("id").anyOf(this.campos.ids).toArray();case 4:this.itens=e.sent,this.itensOriginal=this.$utils.clonarV2(this.itens),e.next=9;break;case 8:this.itens=[];case 9:e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](0),this.$q.notifyError("Erro ao carregar os dados",e.t0);case 14:case"end":return e.stop()}},e,this,[[0,11]])}));return function(){return e.apply(this,arguments)}}(),confirmar:function(){var e=d()(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:for(t in this.$utils.gconsole.log("ItemTrocarCest","confirmar",this.itens),this.itens)this.itens[t].cest&&this.itens[t].cest!==this.itensOriginal[t].cest&&this.$db.item.gravaItem({atual:this.itens[t],original:this.itensOriginal[t]});this.modal.visivel=!1,this.$emit("confirmar");case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},props:{modal:{required:!0,type:Object}},watch:{"modal.visivel":function(e){e&&this.atualizar()}},mounted:function(){this.atualizar()}},w=I,E=(a("e9b3"),Object(b["a"])(w,x,q,!1,null,null,null));E.options.__file="ItemTrocarCest.vue";var y=E.exports,_=a("da3f"),P=a("f94a"),T=a("f487"),D=a("fa57"),j=a("39fb"),F=a("4c8e"),S=a("7330"),R=a("ee34"),N=a("d0d3"),V=a("1b38"),$=a("b40e"),M=a("e2f4"),A=a("74a5"),B=a("f47a"),z=a("8149"),L={tipo:"NFCe",serie:"nfce.padrao.serie",homologacao:"nfce.homologacao",usadesconto:"nfce.usadesconto",gerarAutorizacaoDownload:D["a"],gerarConfiguracaoImposto:j["a"],gerarNumeroNFe:F["a"],obterConfiguracaoImpostoV2:N["a"],obterFatura:V["a"],obterFormasPagamento:$["a"],obterFrete:M["a"],obterItens:A["a"],gerarJson:function(){var e=d()(regeneratorRuntime.mark(function e(t,a,o){var r,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return r=Object(v["logarIni"])("gerarJsonNFCe",t,a,o),e.prev=1,Object(v["verificarErro"])(!t,"Fatura não fornecida"),n=R["a"].iniciarCampos({idDocumento:t,cpfCnpjCliente:a,nomeCliente:o,totalDesconto:0,totalDevolucao:0,totalProdutos:0,totalServicos:0,alertas:[],erros:[],cache:{},outrosNFe:{},infNFe:T["a"].executa(S["a"].infNFe,{},"NFCe")},"gerarNFCeFatura"),v["gconsole"].log("gerarJsonNFCeD","iniciarCampos",n),e.next=7,this.acertoInicial(n);case 7:return e.next=9,this.obterFatura(n);case 9:return e.next=11,this.obterEmitente(n);case 11:return e.next=13,this.obterDestinatario(n,a,o);case 13:return e.next=15,this.obterItens(n);case 15:return e.next=17,this.obterFormasPagamento(n);case 17:return e.next=19,this.obterFrete(n);case 19:return e.next=21,this.gerarNumeroNFe(n.infNFe);case 21:return e.next=23,this.gerarAutorizacaoDownload(n.infNFe,n.outrosNFe.idContatoEmitente);case 23:return B["a"].calculaTotais(n.infNFe,n.outrosNFe,S["a"]),R["a"].acertarDadosNFe(n.infNFe,n.outrosNFe,"NFCe"),n.infNFe=P["a"].executa(S["a"].infNFe,n.infNFe),n.erros=P["a"].erros,v["gconsole"].log("gerarJsonNFCeD","infNFe",n.infNFe),v["gconsole"].log("gerarJsonNFCeD","compactarValidarNFe.erros",P["a"].erros),e.abrupt("return",n);case 30:return e.prev=30,Object(v["logarFim"])(r,1),e.finish(30);case 33:case"end":return e.stop()}},e,this,[[1,,30,33]])}));return function(t,a,o){return e.apply(this,arguments)}}(),acertoInicial:function(){var e=d()(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return v["gconsole"].log("gerarJsonNFeD","acertoInicial"),t.infNFe.ide.tpNF="1",t.infNFe.ide.finNFe="1",e.next=5,z["a"].configuracoes.leValorNumerico(this.homologacao);case 5:if(e.t0=e.sent,1!==e.t0){e.next=10;break}e.t1="2",e.next=11;break;case 10:e.t1="1";case 11:return t.infNFe.ide.tpAmb=e.t1,t.infNFe.ide.mod="65",t.infNFe.ide.tpImp="4",t.infNFe.ide.dhEmi=R["a"].formatarDataNFe(new Date),e.next=17,Object(k["a"])().documentoOperacao.filter(function(e){return"Venda"===e.descricao}).first();case 17:t.idCfopVenda=e.sent.idCfop,Object(v["verificarErro"])(!t.idCfopVenda,"Erro na configuração do sistema. Sem definição do CFOP de venda.");case 19:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),gerarJsonCancelamento:function(){var e=d()(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return a={infEvento:{cOrgao:t.infNFe.ide.cUF,tpAmb:t.infNFe.ide.tpAmb,escolhas:{valor_escolha:t.infNFe.emit.escolhas.valor_escolha,CNPJ:t.infNFe.emit.escolhas.CNPJ,CPF:t.infNFe.emit.escolhas.CPF},chNFe:t.outrosNFe.chNFe,dhEvento:R["a"].formatarDataNFe(new Date),nSeqEvento:"1",detEvento:{nProt:t.outrosNFe.nProt_emissao,xJust:"Nota cancelada devido divergencia de informacoes"}}},a.infEvento=T["a"].executa(S["a"].infEvento,a.infEvento,"NFCe"),a.infEvento=P["a"].executa(S["a"].infEvento,a.infEvento),t.erros=P["a"].erros,v["gconsole"].log("gerarJsonNFCeD","infNFe",t.infNFe),v["gconsole"].log("gerarJsonNFCeD","compactarValidarNFe.erros",P["a"].erros),e.abrupt("return",a.infEvento);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),obterConfiguracaoImposto:function(){var e=d()(regeneratorRuntime.mark(function e(t){var a,o,r,n,i,s,c,l;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return v["gconsole"].log("gerarJsonNFCeD","obterConfiguracaoImposto"),a="Produto '".concat(t.documentoItem.descricaoItem||"","'"),Object(v["verificarErro"])(!t.item.ncm,"".concat(a," sem cadastro de NCM")),e.next=5,Object(k["a"])()._ncm.where("ncm").equals(t.item.ncm).first();case 5:return o=e.sent,Object(v["verificarErro"])(!o,"".concat(a," com NCM '").concat(t.item.ncm||"","' inválido")),t.documentoItem.idCfop||(t.documentoItem.idCfop=t.idCfopVenda),e.next=10,Object(k["a"])().cfop.get(t.documentoItem.idCfop);case 10:return r=e.sent,Object(v["verificarErro"])(!r,"".concat(a," com CFOP inválido")),v["gconsole"].log("gerarJsonNFCeD","dadosNcm.id: ".concat(o.id," dadosCfop.id: ").concat(r.id," dados.empresa.id: ").concat(t.empresa.id)),e.next=15,Object(k["a"])().impostoConfiguracao.where("idNcm").equals(o.id).filter(function(e){return e.idCfop===r.id&&e.idEmitente===t.empresa.id&&e.ufOrigem===t.empresa.enderecoPrincipal.uf&&e.ufDestino===t.empresa.enderecoPrincipal.uf}).first();case 15:return n=e.sent,v["gconsole"].log("gerarJsonNFCeD","impostoConfiguracao",n),i="Verifique a configuração do imposto para "+"NCM: ".concat(t.item.ncm||"",", ")+"CFOP: ".concat(r.cfop||"",", ")+"CNPJ: ".concat(t.empresa.numeroDocumentoNacional||"",", ")+"UF origem: ".concat(t.empresa.enderecoPrincipal.uf||"",", ")+"UF destino: ".concat(t.empresa.enderecoPrincipal.uf||"","."),Object(v["verificarErro"])(!n,"".concat(a," sem configuração de imposto. ").concat(i)),s=t.det.prod,c=t.det.imposto,e.prev=21,s.CFOP=(r.cfop||0).toString(),e.next=25,this.obterImpostoParametro(t,n.idOrigem);case 25:return c.noXml_orig=e.sent,e.next=28,this.obterImpostoParametro(t,n.idCst);case 28:return c.noXml_CST=c.noXml_CSOSN=e.sent,c.noXml_pICMS=n.aliqIcmsUFOrigem||n.aliqIcms||0,c.noXml_pRedBC=n.percRedBcIcms||0,c.noXml_pFCP=n.aliqFcp||0,e.next=34,this.obterImpostoParametro(t,n.idTipoTribPis);case 34:return c.noXml_CSTPis=e.sent,c.noXml_pPIS=n.aliqPis||0,e.next=38,this.obterImpostoParametro(t,n.idTipoTribCofins);case 38:if(c.noXml_CSTCofins=e.sent,c.noXml_pCOFINS=n.aliqCofins||0,!n.idCest){e.next=45;break}return e.next=43,this.obterImpostoParametro(t,n.idCest);case 43:l=e.sent,l&&(s.opcional.visivel=!0,s.opcional.CEST=Object(v["filtrarDigitos"])(l));case 45:e.next=51;break;case 47:e.prev=47,e.t0=e["catch"](21),console.error(e.t0),Object(v["verificarErro"])(!0,"".concat(a," com erro na configuração de imposto. ").concat(i));case 51:case"end":return e.stop()}},e,this,[[21,47]])}));return function(t){return e.apply(this,arguments)}}(),obterDestinatario:function(){var e=d()(regeneratorRuntime.mark(function e(t,a,o){var r,n,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t.destinatario={},a){e.next=4;break}return t.infNFe.dest.visivel=!1,e.abrupt("return");case 4:if(r=t.documentoFatura.idContato,!r){e.next=21;break}return e.next=8,Object(k["a"])().contato.get(r);case 8:if(t.destinatario=e.sent,!t.destinatario){e.next=21;break}return e.next=12,Object(k["a"])().contatoEndereco.where("idContato").equals(r).toArray();case 12:return t.destinatario.enderecos=e.sent,t.destinatario.enderecoPrincipal=t.destinatario.enderecos.find(function(e){return"Principal"===e.grupo}),t.destinatario.enderecoPrincipal||(t.destinatario.enderecoPrincipal=t.destinatario.enderecos[0]||{}),e.next=17,Object(k["a"])().contatoTelefone.where("idContato").equals(r).toArray();case 17:t.destinatario.telefones=e.sent,t.destinatario.telefonePrincipal=t.destinatario.telefones.find(function(e){return"Principal"===e.grupo}),t.destinatario.telefonePrincipal||(t.destinatario.telefonePrincipal=t.destinatario.telefones[0]||{}),v["gconsole"].log("gerarJsonNFCeD","dados.destinatario",t.destinatario);case 21:if(n=t.infNFe.dest,n.visivel=!0,i=Object(v["filtrarDigitos"])(a),11===i.length?(n.escolhas.valor_escolha="CPF",n.escolhas.CPF=i,n.indIEDest="9"):14===i.length?(n.escolhas.valor_escolha="CNPJ",n.escolhas.CNPJ=i,n.indIEDest="9"):Object(v["verificarErro"])(!0,"Destinatario com CPF/CNPJ inválido"),i===Object(v["filtrarDigitos"])(t.destinatario.numeroDocumentoNacional)){e.next=27;break}return e.abrupt("return");case 27:if("CNPJ"===n.escolhas.valor_escolha&&t.destinatario.numeroDocumentoEstadual&&(n.IE=Object(v["filtrarDigitos"])(t.destinatario.numeroDocumentoEstadual)),n.xNome=Object(v["removerCaracteresEspeciais"])(o||t.destinatario.nome),t.destinatario.enderecoPrincipal.uf&&t.destinatario.enderecoPrincipal.ibgeCod){e.next=31;break}return e.abrupt("return");case 31:n.enderDest.visivel=!0,n.email=(t.destinatario.emailNfe||t.destinatario.email||"").trim(),n.enderDest.fone=Object(v["filtrarDigitos"])(t.destinatario.telefonePrincipal.telefone||""),n.enderDest.xLgr=Object(v["removerCaracteresEspeciais"])(t.destinatario.enderecoPrincipal.logradouro),n.enderDest.nro=(t.destinatario.enderecoPrincipal.numero||"SN").trim(),n.enderDest.xCpl=Object(v["removerCaracteresEspeciais"])(t.destinatario.enderecoPrincipal.complemento),n.enderDest.xBairro=Object(v["removerCaracteresEspeciais"])(t.destinatario.enderecoPrincipal.bairro),n.enderDest.cMun=String(t.destinatario.enderecoPrincipal.ibgeCod||"").trim(),n.enderDest.xMun=Object(v["removerCaracteresEspeciais"])(t.destinatario.enderecoPrincipal.municipio),n.enderDest.UF=(t.destinatario.enderecoPrincipal.uf||"").trim(),n.enderDest.CEP=Object(v["filtrarDigitos"])(t.destinatario.enderecoPrincipal.cep||""),n.enderDest.cPais="1058",n.enderDest.xPais=(t.destinatario.enderecoPrincipal.pais||"").trim()||"Brasil";case 44:case"end":return e.stop()}},e)}));return function(t,a,o){return e.apply(this,arguments)}}(),obterEmitente:function(){var e=d()(regeneratorRuntime.mark(function e(t){var a,o,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return v["gconsole"].log("gerarJsonNFCeD","obterEmitente"),a=t.documentoFatura.idEmpresa,Object(v["verificarErro"])(!a,"Fatura sem empresa emitente"),e.next=5,Object(k["a"])().contato.get(a);case 5:return t.empresa=e.sent,Object(v["verificarErro"])(!t.empresa,"Não foi possível carregar a empresa emitente"),t.outrosNFe.idContatoEmitente=a,e.next=10,k["b"].empresa.where({idContato:a}).first();case 10:if(t.empresaPlat=e.sent,t.empresaPlat){e.next=16;break}return o=JSON.parse(localStorage.getItem("clienteSistema")),e.next=15,k["b"].empresa.where({codigoContato:t.empresa.codigoContato}).filter(function(e){return e.codigoClienteSistema===o.codigoClienteSistema}).first();case 15:t.empresaPlat=e.sent;case 16:return Object(v["verificarErro"])(!t.empresaPlat,"Não foi possível carregar a empresa emitente"),"1"===t.infNFe.ide.tpAmb?(Object(v["verificarErro"])(!t.empresaPlat.hashCSCProducao,"Empresa emitente sem hashCSC de produção cadastrado"),Object(v["verificarErro"])(!t.empresaPlat.tokenCSCProducao,"Empresa emitente sem tokenCSC de produção cadastrado"),t.empresaPlat.hashCSC=t.empresaPlat.hashCSCProducao,t.empresaPlat.tokenCSC=t.empresaPlat.tokenCSCProducao):(Object(v["verificarErro"])(!t.empresaPlat.hashCSCHomologacao,"Empresa emitente sem hashCSC de homologação cadastrado"),Object(v["verificarErro"])(!t.empresaPlat.tokenCSCHomologacao,"Empresa emitente sem tokenCSC de homologação cadastrado"),t.empresaPlat.hashCSC=t.empresaPlat.hashCSCHomologacao,t.empresaPlat.tokenCSC=t.empresaPlat.tokenCSCHomologacao),e.next=20,Object(k["a"])().contatoEndereco.where("idContato").equals(a).toArray();case 20:return t.empresa.enderecos=e.sent,Object(v["verificarErro"])(!t.empresa.enderecos||0===t.empresa.enderecos.length,"Não foi possível carregar o endereço da empresa emitente"),t.empresa.enderecoPrincipal=t.empresa.enderecos.find(function(e){return"Principal"===e.grupo}),t.empresa.enderecoPrincipal||(t.empresa.enderecoPrincipal=t.empresa.enderecos[0]||{}),e.next=26,Object(k["a"])().contatoTelefone.where("idContato").equals(a).toArray();case 26:if(e.t0=e.sent,e.t0){e.next=29;break}e.t0=[];case 29:t.empresa.telefones=e.t0,t.empresa.telefonePrincipal=t.empresa.telefones.find(function(e){return"Principal"===e.grupo}),t.empresa.telefonePrincipal||(t.empresa.telefonePrincipal=t.empresa.telefones[0]||{}),v["gconsole"].log("gerarJsonNFCeD","dados.empresa",t.empresa),Object(v["verificarErro"])(!t.empresa.numeroDocumentoNacional,"Empresa emitente sem CNPJ cadastrado"),Object(v["verificarErro"])(!t.empresa.numeroDocumentoEstadual,"Empresa emitente sem Inscrição Estadual cadastrado"),Object(v["verificarErro"])(!t.empresa.nome,"Empresa emitente sem Razão Social (nome) cadastrado"),Object(v["verificarErro"])(!t.empresa.enderecoPrincipal.uf,"Empresa emitente sem UF cadastrado"),Object(v["verificarErro"])(!t.empresa.enderecoPrincipal.ibgeCod,"Empresa emitente sem código do município cadastrado"),Object(v["verificarErro"])(!t.empresa.regime,"Empresa emitente sem regime cadastrado"),r=t.infNFe.emit,r.escolhas.CNPJ=Object(v["filtrarDigitos"])(t.empresa.numeroDocumentoNacional),r.IE=Object(v["filtrarDigitos"])(t.empresa.numeroDocumentoEstadual),r.CRT="SimplesNacional"===t.empresa.regime?"1":"3",r.xNome=Object(v["removerCaracteresEspeciais"])(t.empresa.nome),r.xFant=Object(v["removerCaracteresEspeciais"])(t.empresa.apelido),r.email=(t.empresa.email||"").trim(),r.enderEmit.fone=Object(v["filtrarDigitos"])(t.empresa.telefonePrincipal.telefone),r.enderEmit.xLgr=Object(v["removerCaracteresEspeciais"])(t.empresa.enderecoPrincipal.logradouro),r.enderEmit.nro=(t.empresa.enderecoPrincipal.numero||"SN").trim(),r.enderEmit.xCpl=Object(v["removerCaracteresEspeciais"])(t.empresa.enderecoPrincipal.complemento),r.enderEmit.xBairro=Object(v["removerCaracteresEspeciais"])(t.empresa.enderecoPrincipal.bairro),r.enderEmit.cMun=String(t.empresa.enderecoPrincipal.ibgeCod||"").trim(),r.enderEmit.xMun=Object(v["removerCaracteresEspeciais"])(t.empresa.enderecoPrincipal.municipio),r.enderEmit.UF=(t.empresa.enderecoPrincipal.uf||"").trim(),r.enderEmit.CEP=Object(v["filtrarDigitos"])(t.empresa.enderecoPrincipal.cep),r.enderEmit.cPais="1058",r.enderEmit.xPais=Object(v["removerCaracteresEspeciais"])(t.empresa.enderecoPrincipal.pais||"Brasil"),t.infNFe.ide.cMunFG=r.enderEmit.cMun,t.infNFe.ide.cUF=String(v["mapearEstadoCodigo"][r.enderEmit.UF]);case 59:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),obterImpostoParametro:function(){var e=d()(regeneratorRuntime.mark(function e(t,a){var o,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(Object(v["verificarErro"])(!a,"Configuração de imposto sem informação completa"),o=t.cache[a],o){e.next=8;break}return e.next=5,Object(k["a"])().impostoParametro.get(a);case 5:r=e.sent,o=r?r.numero.trim():void 0,t.cache[a]=o;case 8:return Object(v["verificarErro"])(!o,"Configuração de imposto inválida"),e.abrupt("return",o);case 10:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),obterMeioPagamento:function(){var e=d()(regeneratorRuntime.mark(function e(t,a){var o,r,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(v["gconsole"].log("gerarJsonNFCeD","obterMeioPagamento",a),Object(v["verificarErro"])(!a,"Forma de pagamento inválida"),o=t.cache[a],!o){e.next=5;break}return e.abrupt("return",o);case 5:return e.next=7,Object(k["a"])().formaPagamento.get(a);case 7:return r=e.sent,Object(v["verificarErro"])(!r||!r.descricao,"Não foi possível carregar a forma de pagamento"),n=r.descricao.toLowerCase(),o=n.includes("dinheiro")?"01":n.includes("débito")?"04":n.includes("crédito de clientes")?"99":n.includes("crédito")?"03":n.includes("cartão")&&1===Number(r.parcelamentoMaximo||0)?"04":n.includes("cartão")&&Number(r.parcelamentoMaximo||0)>1?"03":"99",t.cache[a]=o,e.abrupt("return",o);case 13:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),obterAliquotasTributosIbpt:function(){var e=d()(regeneratorRuntime.mark(function e(t,a){var o,r,n,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return v["gconsole"].log("gerarJsonNFCeD","obterValorAproxTributos",a),e.next=3,Object(k["a"])().nfeIbpt.where("codigo").equals(Number(a.prod.NCM)).toArray();case 3:if(o=e.sent,!this.verificarAlerta(!o||0===o.length,"Não encontrado alíquotas para calculo do valor aproximado de tributos do NCM: ".concat(a.prod.NCM,". Atualize sua tabela IBPT."),t)){e.next=6;break}return e.abrupt("return");case 6:r=o.filter(function(e){return e.idContato===t.empresa.id}),n=r.length?r:o,i=n.reduce(function(e,t){return!e||e.vigenciaFim<t.vigenciaFim?t:e},null),this.verificarAlerta(i.vigenciaFim<Object(v["dataAtual"])(),"Informações vencidas para para o calculo do valor aproximado de tributos do NCM: ".concat(a.prod.NCM,". Atualize sua tabela IBPT."),t),a.imposto.noXml_pTribImp=Number(i.importadosFederal||0),a.imposto.noXml_pTribFed=Number(i.nacionalFederal||0),a.imposto.noXml_pTribEst=Number(i.estadual||0),a.imposto.noXml_pTribMun=Number(i.municipal||0);case 14:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}(),verificarAlerta:function(e,t,a){return e&&(a.alertas||(a.alertas=[]),a.alertas.push(t),console.warn(t)),e}},H=(a("f559"),a("f576"),a("ed50"),a("f490")),U={gerarSat:function(){var e=d()(regeneratorRuntime.mark(function e(t,a,o,r){var n,i,s,c,l,d;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=Object(v["logarIni"])("gerarSat",t,a,o,r),i={},e.prev=2,Object(v["verificarErro"])(!a,"Número do PDV não fornecido"),Object(v["verificarErro"])(!t,"Fatura não fornecida"),i.NumeroPDV=a,o&&(i.CPF_CNPJ=o),r&&(i.NomeCliente=Object(v["removerCaracteresEspeciais"])(r)),s={idDocumento:t,cpfCnpjCliente:o,nomeCliente:r,totalDevolucao:0,totalProdutos:0,totalServicos:0,alertas:[]},e.next=11,this.obterDadosGerais(s);case 11:return e.next=13,this.obterFatura(s);case 13:return e.next=15,this.obterEmpresa(s);case 15:return e.next=17,this.obterDestinatario(s);case 17:return e.next=19,this.obterItens(s);case 19:return i.Itens=e.sent,e.next=22,this.obterDescontoAcrescimoFatura(s);case 22:return c=e.sent,l=c.desconto,d=c.acrescimo,i.Desconto=l,i.Acrescimo=d,e.next=29,this.obterFormasPagamento(s);case 29:if(i.FormaPgto=e.sent,i.Mensagem=("Fatura: "+(s.documentoFatura.numero||(s.documentoFatura.id||"").slice(-6))).padEnd(48," "),!r){e.next=35;break}i.Mensagem+=r.padEnd(48," "),e.next=44;break;case 35:if(e.t0=s.destinatario.nome,!e.t0){e.next=42;break}return e.t1=s.destinatario.codigoContato,e.next=40,z["a"].configuracoes.leValorNumerico("venda.codigoconsumidor");case 40:e.t2=e.sent,e.t0=e.t1!==e.t2;case 42:if(!e.t0){e.next=44;break}i.Mensagem+=s.destinatario.nome.padEnd(48," ");case 44:return e.t3=i.Mensagem,e.next=47,z["a"].configuracoes.leValorComFiltroEmpresa("cupom.mensagem",s.documentoFatura.idEmpresa,"Obrigado e Volte Sempre!");case 47:return i.Mensagem=e.t3+=e.sent,i.Mensagem=Object(v["removerCaracteresEspeciais"])(i.Mensagem),e.abrupt("return",{objetoJson:i,dados:s});case 50:return e.prev=50,Object(v["logarFim"])(n,(i.Itens||[]).length,i),e.finish(50);case 53:case"end":return e.stop()}},e,this,[[2,,50,53]])}));return function(t,a,o,r){return e.apply(this,arguments)}}(),guardarRetornoEmissaoSat:function(){var e=d()(regeneratorRuntime.mark(function e(t,a,o){var r,n,i,s,c,l,d,u,m,p,h;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return v["gconsole"].log("gerarSatD","guardarRetornoSat",a),r=(new DOMParser).parseFromString(o,"application/xml"),Object(v["verificarErro"])(r.getElementsByTagName("parsererror").length,"Erro ao gravar os dados do SAT. (XML inválido)"),n=r.getElementsByTagName("infCFe")[0],Object(v["verificarErro"])(!n,"Erro ao gravar os dados do SAT. (XML inválido, sem infCFe)"),i=n.getElementsByTagName("ide")[0],Object(v["verificarErro"])(!i,"Erro ao gravar os dados do SAT. (XML inválido, sem ide)"),s=n.getElementsByTagName("dest")[0],Object(v["verificarErro"])(!s,"Erro ao gravar os dados do SAT. (XML inválido, sem dest)"),c=n.getElementsByTagName("total")[0],Object(v["verificarErro"])(!c,"Erro ao gravar os dados do SAT. (XML inválido, sem total)"),l=c.getElementsByTagName("ICMSTot")[0],Object(v["verificarErro"])(!l,"Erro ao gravar os dados do SAT. (XML inválido, sem ICMSTot)"),d=(s.getElementsByTagName("CPF")[0]||s.getElementsByTagName("CNPJ")[0]||{}).innerHTML||"",u=(i.getElementsByTagName("dEmi")[0]||{}).innerHTML,m=(i.getElementsByTagName("hEmi")[0]||{}).innerHTML,p=u&&m?H["d"].formatDate(u.substr(0,4)+"-"+u.substr(4,2)+"-"+u.substr(6,2)+"T"+m.substr(0,2)+":"+m.substr(2,2)+":"+m.substr(4,2)):"",h={id:Object(v["uuid"])(),idDocumento:t.idDocumento,idEmpresa:t.documentoFatura.idEmpresa,descricaoEmpresa:t.empresa.nome,idContato:t.documentoFatura.idContato,descricaoContato:t.documentoFatura.descricaoContato,nomeArquivo:a,chaveCupom:n.getAttribute("Id")||"",cancelamento:!1,xml:o,dataHoraEmissao:p,numeroCupom:Number((i.getElementsByTagName("nCFe")[0]||{}).innerHTML)||0,documentoConsumidor:d,valorIcms:Number((l.getElementsByTagName("vICMS")[0]||{}).innerHTML)||0,valorProdutos:Number((l.getElementsByTagName("vProd")[0]||{}).innerHTML)||0,valorDesconto:Number((l.getElementsByTagName("vDesc")[0]||{}).innerHTML)||0,valorPis:Number((l.getElementsByTagName("vPIS")[0]||{}).innerHTML)||0,valorConfins:Number((l.getElementsByTagName("vCOFINS")[0]||{}).innerHTML)||0,valorPisSt:Number((l.getElementsByTagName("vPISST")[0]||{}).innerHTML)||0,valorConfinsSt:Number((l.getElementsByTagName("vCOFINSST")[0]||{}).innerHTML)||0,outrosValores:Number((l.getElementsByTagName("vOutro")[0]||{}).innerHTML)||0,valorTotal:Number((c.getElementsByTagName("vCFe")[0]||{}).innerHTML)||0,valorTributos:Number((l.getElementsByTagName("vCFeLei12741")[0]||{}).innerHTML)||0,chaveCupomCancelado:"",dataHoraCupomCancelado:null},e.next=20,z["a"].documentoSat.grava({atual:h});case 20:case"end":return e.stop()}},e)}));return function(t,a,o){return e.apply(this,arguments)}}(),guardarRetornoCancelamentoSat:function(){var e=d()(regeneratorRuntime.mark(function e(t,a,o){var r,n,i,s,c,l,d,u,m,p,h,f,b,g;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return v["gconsole"].log("gerarSatD","guardarRetornoSat",a),r=(new DOMParser).parseFromString(o,"application/xml"),Object(v["verificarErro"])(r.getElementsByTagName("parsererror").length,"Erro ao gravar os dados do cancelamento do SAT. (XML inválido)"),n=r.getElementsByTagName("infCFe")[0],Object(v["verificarErro"])(!n,"Erro ao gravar os dados do cancelamento do SAT. (XML inválido, sem infCFe)"),i=n.getElementsByTagName("ide")[0],Object(v["verificarErro"])(!i,"Erro ao gravar os dados do cancelamento do SAT. (XML inválido, sem ide)"),s=n.getElementsByTagName("dest")[0],Object(v["verificarErro"])(!s,"Erro ao gravar os dados do cancelamento do SAT. (XML inválido, sem dest)"),c=n.getElementsByTagName("total")[0],Object(v["verificarErro"])(!c,"Erro ao gravar os dados do cancelamento do SAT. (XML inválido, sem total)"),l=(s.getElementsByTagName("CPF")[0]||s.getElementsByTagName("CNPJ")[0]||{}).innerHTML||"",d=(i.getElementsByTagName("dEmi")[0]||{}).innerHTML,u=(i.getElementsByTagName("hEmi")[0]||{}).innerHTML,m=d&&u?H["d"].formatDate(d.substr(0,4)+"-"+d.substr(4,2)+"-"+d.substr(6,2)+"T"+u.substr(0,2)+":"+u.substr(2,2)+":"+u.substr(4,2)):"",p=(n.getElementsByTagName("dEmi")[0]||{}).innerHTML,h=(n.getElementsByTagName("hEmi")[0]||{}).innerHTML,f=d&&u?H["d"].formatDate(p.substr(0,4)+"-"+p.substr(4,2)+"-"+p.substr(6,2)+"T"+h.substr(0,2)+":"+h.substr(2,2)+":"+h.substr(4,2)):"",b={},e.next=21,Object(k["a"])().documento.get(t);case 21:return b.documentoFatura=e.sent,Object(v["verificarExcecao"])(!b.documentoFatura,"Não foi possível carregar a fatura"),g={id:Object(v["uuid"])(),idDocumento:t,idEmpresa:b.documentoFatura.idEmpresa,descricaoEmpresa:b.documentoFatura.descricaoEmpresa,idContato:b.documentoFatura.idContato,descricaoContato:b.documentoFatura.descricaoContato,nomeArquivo:a,chaveCupom:n.getAttribute("Id")||"",cancelamento:!0,xml:o,dataHoraEmissao:m,dataHoraCupomCancelado:f,numeroCupom:Number((i.getElementsByTagName("nCFe")[0]||{}).innerHTML)||0,documentoConsumidor:l,valorTotal:Number((c.getElementsByTagName("vCFe")[0]||{}).innerHTML)||0,chaveCupomCancelado:n.getAttribute("chCanc")||""},e.next=26,z["a"].documentoSat.grava({atual:g});case 26:case"end":return e.stop()}},e)}));return function(t,a,o){return e.apply(this,arguments)}}(),obterConfiguracaoImposto:function(){var e=d()(regeneratorRuntime.mark(function e(t){var a,o,r,n,i,s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return v["gconsole"].log("gerarSatD","obterConfiguracaoImposto"),a="Produto '".concat(t.documentoItem.descricaoItem||"","'"),Object(v["verificarErro"])(!t.item.ncm,"".concat(a," sem cadastro de NCM")),e.next=5,Object(k["a"])()._ncm.where("ncm").equals(t.item.ncm).first();case 5:return o=e.sent,Object(v["verificarErro"])(!o,"".concat(a," com NCM '").concat(t.item.ncm||"","' inválido")),t.documentoItem.idCfop||(t.documentoItem.idCfop=t.idCfopVenda),e.next=10,Object(k["a"])().cfop.get(t.documentoItem.idCfop);case 10:return r=e.sent,Object(v["verificarErro"])(!r,"".concat(a," com CFOP inválido")),e.next=14,Object(k["a"])().impostoConfiguracao.where("idNcm").equals(o.id).filter(function(e){return e.idCfop===r.id&&e.idEmitente===t.empresa.id&&e.ufOrigem===t.empresa.enderecoPrincipal.uf&&e.ufDestino===t.empresa.enderecoPrincipal.uf}).first();case 14:return n=e.sent,i="Verifique a configuração do imposto para "+"NCM: ".concat(t.item.ncm||"",", ")+"CFOP: ".concat(r.cfop||"",", ")+"CNPJ: ".concat(t.empresa.numeroDocumentoNacional||"",", ")+"UF origem: ".concat(t.empresa.enderecoPrincipal.uf||"",", ")+"UF destino: ".concat(t.empresa.enderecoPrincipal.uf||"","."),Object(v["verificarErro"])(!n,"".concat(a," sem configuração de imposto. ").concat(i)),s={},e.prev=18,s.CFOP=(r.cfop||0).toString(),e.next=22,this.obterImpostoParametro(t,n.idOrigem);case 22:return s.ICMS_OrigemMercadoria=e.sent,e.next=25,this.obterImpostoParametro(t,n.idCst);case 25:return s.ICMS_CST=e.sent,s.ICMS_CSOSN=s.ICMS_CST,s.ICMS_Aliquota=(n.aliqIcmsUFOrigem||n.aliqIcms||0).toString(),e.next=30,this.obterImpostoParametro(t,n.idTipoTribPis);case 30:return s.PIS_CST=e.sent,s.PIS_Aliquota=(n.aliqPis||0).toString(),e.next=34,this.obterImpostoParametro(t,n.idTipoTribCofins);case 34:s.COFINS_CST=e.sent,s.COFINS_Aliquota=(n.aliqCofins||0).toString(),e.next=42;break;case 38:e.prev=38,e.t0=e["catch"](18),console.error(e.t0),Object(v["verificarErro"])(!0,"".concat(a," com erro na configuração de imposto. ").concat(i));case 42:return e.next=44,this.obterValorAproxTributos(t,s.ICMS_OrigemMercadoria);case 44:return s.ValorAproxTributos=e.sent,e.abrupt("return",s);case 46:case"end":return e.stop()}},e,this,[[18,38]])}));return function(t){return e.apply(this,arguments)}}(),obterConfiguracaoImpostoV2:function(){var e=d()(regeneratorRuntime.mark(function e(t){var a,o,r,n,i,s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return v["gconsole"].log("gerarSatD","obterConfiguracaoImposto"),a="Produto '".concat(t.documentoItem.descricaoItem||"","'"),Object(v["verificarErro"])(!t.item.ncm,"".concat(a," sem cadastro de NCM")),t.documentoItem.idCfop||(t.documentoItem.idCfop=t.idCfopVenda),e.next=6,Object(k["a"])().cfop.get(t.documentoItem.idCfop);case 6:return o=e.sent,Object(v["verificarErro"])(!o,"".concat(a," com CFOP inválido")),r=Object(v["filtrarDigitos"])(t.documentoItem.ncm||""),r=8===r.length?r:Object(v["filtrarDigitos"])(t.item.ncm||""),n={emitente:{regime:"SimplesNacional"===t.empresa.regime?"1":"3",uf:t.empresa.enderecoPrincipal.uf,tributacaoSetor:t.empresa.tributacaoSetor,tributacao:t.empresa.tributacao},destinatario:{regime:"SimplesNacional"===t.destinatario.regime?"1":"Normal"===t.destinatario.regime?"3":void 0,uf:t.empresa.enderecoPrincipal.uf,pessoa:{CPF:"PF",CNPJ:"PJ",idEstrangeiro:"Estrangeiro"}[t.destinatario.tipoDocumentoNacional]||void 0,stributacaoSetoretor:t.destinatario.tributacaoSetor,tributacao:t.destinatario.tributacao,indicadorIE:"9",consumidor:"S",destino:"1"},ncm:r,cfop:String(o.cfop||""),cest:t.documentoItem.cest||t.item.cest,origemMercadoria:String(t.item.codigoOrigem||""),produto:t.item.descricao},e.next=13,z["a"].configuracaoImposto.pesquisa(n);case 13:return i=e.sent,Object(v["verificarErro"])(!i||!i.ordem||!i.saida,"".concat(a," sem configuração de imposto. Verifique a configuração do imposto para ").concat(JSON.stringify(n)||"",".")),s={},s.CFOP=i.entrada.cfop,s.ICMS_OrigemMercadoria=i.entrada.origemMercadoria,s.ICMS_CST=i.saida.cstCsosn,s.ICMS_CSOSN=s.ICMS_CST,s.ICMS_Aliquota=(i.saida.pICMS||0).toString(),s.PIS_CST=i.saida.pisCst,s.PIS_Aliquota=(i.saida.pPIS||0).toString(),s.COFINS_CST=i.saida.cofinsCst,s.COFINS_Aliquota=(i.saida.pCOFINS||0).toString(),e.next=27,this.obterValorAproxTributos(t,s.ICMS_OrigemMercadoria);case 27:return s.ValorAproxTributos=e.sent,e.abrupt("return",s);case 29:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),obterDadosGerais:function(){var e=d()(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return v["gconsole"].log("gerarSatD","obterDadosGerais"),e.next=3,Object(k["a"])().documentoOperacao.filter(function(e){return"Venda"===e.descricao}).first();case 3:a=e.sent,t.idCfopVenda=a.idCfop,Object(v["verificarErro"])(!t.idCfopVenda,"Erro na configuração do sistema. Sem definição do CFOP de venda.");case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),obterDescontoAcrescimoFatura:function(){var e=d()(regeneratorRuntime.mark(function e(t){var a,o,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return v["gconsole"].log("gerarSatD","obterDescontoAcrescimoFatura"),a=Object(v["somar"])(t.documentosVendas,"valorFrete"),o=a,t.totalFrete=a,r=t.documentoFatura.totalDesconto||0,r+=Object(v["somar"])(t.documentosVendas,"totalDesconto"),t.totalDesconto=r,Object(v["arredondar"])(o)>0&&Object(v["arredondar"])(r)>0&&(o>r?(o-=r,r=0):(r-=o,o=0)),e.abrupt("return",{acrescimo:o.toFixed(2),desconto:r.toFixed(2)});case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),obterDestinatario:function(){var e=d()(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(a=t.documentoFatura.idContato,!a){e.next=10;break}return e.next=4,Object(k["a"])().contato.get(a);case 4:if(e.t1=e.sent,e.t1){e.next=7;break}e.t1={};case 7:e.t0=e.t1,e.next=11;break;case 10:e.t0={};case 11:t.destinatario=e.t0;case 12:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),obterEmpresa:function(){var e=d()(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return v["gconsole"].log("gerarSatD","obterEmpresa"),a=t.documentoFatura.idEmpresa,Object(v["verificarErro"])(!a,"Fatura sem empresa emitente"),e.next=5,Object(k["a"])().contato.get(a);case 5:return t.empresa=e.sent,Object(v["verificarErro"])(!t.empresa,"Não foi possível carregar a empresa emitente"),e.next=9,Object(k["a"])().contatoEndereco.where("idContato").equals(a).toArray();case 9:return t.empresa.enderecos=e.sent,Object(v["verificarErro"])(!t.empresa.enderecos||0===t.empresa.enderecos.length,"Não foi possível carregar o endereço da empresa emitente"),e.next=13,Object(k["a"])().contatoTelefone.where("idContato").equals(a).toArray();case 13:if(e.t0=e.sent,e.t0){e.next=16;break}e.t0=[];case 16:t.empresa.telefones=e.t0,t.empresa.enderecoPrincipal=t.empresa.enderecos.find(function(e){return"Principal"===e.grupo}),t.empresa.enderecoPrincipal||(t.empresa.enderecoPrincipal=t.empresa.enderecos[0]||{}),Object(v["verificarErro"])(!t.empresa.enderecoPrincipal.uf,"Empresa emitente sem UF cadastrado");case 20:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),obterFatura:function(){var e=d()(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return v["gconsole"].log("gerarSatD","obterFatura"),a=t.idDocumento,e.next=4,Object(k["a"])().documento.get(a);case 4:return t.documentoFatura=e.sent,Object(v["verificarErro"])(!t.documentoFatura,"Não foi possível carregar a fatura"),e.next=8,Object(k["a"])().documento.where("idDocumentoAdicional").equals(a).toArray();case 8:if(e.t0=e.sent,e.t0){e.next=11;break}e.t0=[];case 11:return t.documentosAdicionais=e.t0,e.next=14,Object(k["a"])().documento.where("idFatura").equals(a).toArray();case 14:if(e.t1=e.sent,e.t1){e.next=17;break}e.t1=[];case 17:t.documentosVendas=e.t1,t.idsDocumentos=[a].concat(c()(t.documentosAdicionais.map(function(e){return e.id})),c()(t.documentosVendas.map(function(e){return e.id})));case 19:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),obterFormasPagamento:function(){var e=d()(regeneratorRuntime.mark(function e(t){var a,o,r,n,i,s,c,l,d,u,m,p,h,f,b,g,C,x=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return v["gconsole"].log("gerarSatD","obterFormasPagamento"),e.next=3,Object(k["a"])().documentoCondicaoPagamento.where({idDocumento:t.idDocumento}).toArray();case 3:a=e.sent,Object(v["verificarErro"])(!a,"Não há pagamentos"),v["gconsole"].log("gerarSatD","documentoCondicaoPagamento",a),o=[],r=!0,n=!1,i=void 0,e.prev=10,s=regeneratorRuntime.mark(function e(){var a,r,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return a=l.value,e.next=3,x.obterMeioPagamento(t,a.idFormaPagamento);case 3:r=e.sent,n=o.find(function(e){return e.CodigoMeioPagamento===r}),n?n.Valor=Object(v["arredondar"])(n.Valor+a.valor):(n={CodigoMeioPagamento:r,Valor:Object(v["arredondar"])(a.valor)},o.push(n));case 6:case"end":return e.stop()}},e)}),c=a[Symbol.iterator]();case 13:if(r=(l=c.next()).done){e.next=18;break}return e.delegateYield(s(),"t0",15);case 15:r=!0,e.next=13;break;case 18:e.next=24;break;case 20:e.prev=20,e.t1=e["catch"](10),n=!0,i=e.t1;case 24:e.prev=24,e.prev=25,r||null==c.return||c.return();case 27:if(e.prev=27,!n){e.next=30;break}throw i;case 30:return e.finish(27);case 31:return e.finish(24);case 32:return Object(v["verificarErro"])(0===o.length,"A fatura não possui pagamentos"),e.next=35,Object(k["a"])().financeiroTitulo.where({idFatura:t.idDocumento}).toArray();case 35:if(d=e.sent,u=Object(v["arredondar"])(Object(v["somar"])(o,"Valor")),m=Object(v["arredondar"])(Object(v["somar"])(d,"valorTotal")+t.totalServicos),p=Object(v["arredondar"])(t.totalProdutos+t.totalFrete+t.totalDevolucao-t.totalDesconto),v["gconsole"].log("gerarSatD","\n      totalPagamentos: ".concat(u,"\n      totalProdutos: ").concat(t.totalProdutos,"\n      totalServicos: ").concat(t.totalServicos,"\n      totalFrete: ").concat(t.totalFrete,"\n      totalDesconto: ").concat(t.totalDesconto,"\n      totalDevolucao: ").concat(t.totalDevolucao,"\n      totalPagamentosCarnesServicos: ").concat(m,"\n      totalPagamentosNota: ").concat(p)),Object(v["verificarErro"])(Math.abs(u-m-p)>.02,"O valor dos pagamentos difere do somatório (produtos, serviços, frete, carnês, (-)devoluções e (-)descontos"),u>0&&u!==p){for(h=0;h<o.length;h++)f=o[h],f.Valor=Object(v["arredondar"])(f.Valor*p/u);b=Object(v["arredondar"])(Object(v["somar"])(o,"Valor")),o[0].Valor+=p-b}for(t.totalDevolucao<0&&t.totalProdutos>0&&o.push({CodigoMeioPagamento:"99",Valor:-t.totalDevolucao}),g=0;g<o.length;g++)C=o[g],C.Valor=C.Valor.toFixed(2);return e.abrupt("return",o);case 45:case"end":return e.stop()}},e,null,[[10,20,24,32],[25,,27,31]])}));return function(t){return e.apply(this,arguments)}}(),obterImpostoParametro:function(){var e=d()(regeneratorRuntime.mark(function e(t,a){var o,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(Object(v["verificarErro"])(!a,"Configuração de imposto sem informação completa"),t.impostoParametro||(t.impostoParametro={}),o=t.impostoParametro[a],o){e.next=9;break}return e.next=6,Object(k["a"])().impostoParametro.get(a);case 6:r=e.sent,o=r?r.numero.trim():void 0,t.impostoParametro[a]=o;case 9:return Object(v["verificarErro"])(!o,"Configuração de imposto inválida"),e.abrupt("return",o);case 11:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),obterItens:function(){var e=d()(regeneratorRuntime.mark(function e(t){var a,o,r,n,i,s,c,l,d,u,m=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return v["gconsole"].log("gerarSatD","obterItens"),e.next=3,Object(k["a"])().documentoItem.where("idDocumento").anyOf(t.idsDocumentos).sortBy("dataHoraEmissao");case 3:a=e.sent,Object(v["verificarErro"])(!a,"Não foi possível carregar os produtos"),v["gconsole"].log("gerarSatD","documentosItens",a),o=[],r=1,n=!0,i=!1,s=void 0,e.prev=11,c=regeneratorRuntime.mark(function e(){var n,i,s,c,l,u,p,h,f,b,g,C,x,q,O;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(n=d.value,i=Object(v["arredondar"])(n.total||0),0!==Object(v["arredondar"])(i)&&n.idItem){e.next=4;break}return e.abrupt("return","continue");case 4:if(!["Serviço"].includes(n.tipoItem)){e.next=7;break}return t.totalServicos+=i,e.abrupt("return","continue");case 7:if(!(i<0)){e.next=10;break}return t.totalDevolucao+=i,e.abrupt("return","continue");case 10:if(s=n.quantidade||0,c=n.valorItem||0,l=n.descontoItem||0,Object(v["verificarErro"])(i!==Object(v["arredondar"])(s*c-l),"Valor total do item ".concat(n.codigoItem||""," não corresponde ao valor unitário vezes a quantidade")),!["TLOE","TLOD"].includes(n.tipoItem)){e.next=16;break}return e.abrupt("return","continue");case 16:if(!["LOE","LOD"].includes(n.tipoItem)){e.next=38;break}for(u=a.filter(function(e){return["TLOE","TLOD"].includes(e.tipoItem)&&e.idDocumentoItemPai===n.id}),v["gconsole"].log("gerarSatD","tratamentos",u),p=!0,h=!1,f=void 0,e.prev=22,b=u[Symbol.iterator]();!(p=(g=b.next()).done);p=!0)C=g.value,c+=C.valorItem||0,l+=C.descontoItem||0,i+=C.total||0;e.next=30;break;case 26:e.prev=26,e.t0=e["catch"](22),h=!0,f=e.t0;case 30:e.prev=30,e.prev=31,p||null==b.return||b.return();case 33:if(e.prev=33,!h){e.next=36;break}throw f;case 36:return e.finish(33);case 37:return e.finish(30);case 38:return t.totalProdutos+=i,t.documentoItem=n,e.next=42,Object(k["a"])().item.get(n.idItem);case 42:return t.item=e.sent,Object(v["verificarErro"])(!t.item,"Não foi possível carregar o cadastro do produto"),e.next=46,z["a"].configuracoes.leValorNumerico("imposto.versao");case 46:if(x=e.sent,2!==x){e.next=53;break}return e.next=50,m.obterConfiguracaoImpostoV2(t);case 50:e.t1=e.sent,e.next=56;break;case 53:return e.next=55,m.obterConfiguracaoImposto(t);case 55:e.t1=e.sent;case 56:q=e.t1,O=String(t.item.codigoBarras||"").padStart(13,"0"),O.startsWith("999")&&(O=""),q.Sequencia=String(r),q.CodigoProduto=(n.codigoItem||0).toString(),q.CodigoBarras=O,q.Produto=Object(v["removerCaracteresEspeciais"])(n.descricaoItem||"").substr(0,120).trim(),q.NCM=t.item.ncm||"",q.UnidadeMedida=t.item.unidade||"UN",q.Quantidade=s.toFixed(4),q.ValorUnitario=c.toFixed(4),q.DescontoUnitario=l.toFixed(2),q.AcrescimoUnitario="0",q.Total=i.toFixed(2),r++,o.push(q);case 72:case"end":return e.stop()}},e,null,[[22,26,30,38],[31,,33,37]])}),l=a[Symbol.iterator]();case 14:if(n=(d=l.next()).done){e.next=22;break}return e.delegateYield(c(),"t0",16);case 16:if(u=e.t0,"continue"!==u){e.next=19;break}return e.abrupt("continue",19);case 19:n=!0,e.next=14;break;case 22:e.next=28;break;case 24:e.prev=24,e.t1=e["catch"](11),i=!0,s=e.t1;case 28:e.prev=28,e.prev=29,n||null==l.return||l.return();case 31:if(e.prev=31,!i){e.next=34;break}throw s;case 34:return e.finish(31);case 35:return e.finish(28);case 36:return Object(v["verificarErro"])(0===o.length,"A fatura não possui produtos"),v["gconsole"].log("gerarSatD","itens",o),e.abrupt("return",o);case 39:case"end":return e.stop()}},e,null,[[11,24,28,36],[29,,31,35]])}));return function(t){return e.apply(this,arguments)}}(),obterMeioPagamento:function(){var e=d()(regeneratorRuntime.mark(function e(t,a){var o,r,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(v["gconsole"].log("gerarSatD","obterMeioPagamento",a),Object(v["verificarErro"])(!a,"Forma de pagamento inválida"),t.meiosPagamento||(t.meiosPagamento={}),o=t.meiosPagamento[a],!o){e.next=6;break}return e.abrupt("return",o);case 6:return e.next=8,Object(k["a"])().formaPagamento.get(a);case 8:return r=e.sent,Object(v["verificarErro"])(!r||!r.descricao,"Não foi possível carregar a forma de pagamento"),n=r.descricao.toLowerCase(),o=n.includes("dinheiro")?"01":n.includes("débito")?"04":n.includes("crédito de clientes")?"99":n.includes("crédito")?"03":n.includes("cartão")&&1===Number(r.parcelamentoMaximo||0)?"04":n.includes("cartão")&&Number(r.parcelamentoMaximo||0)>1?"03":"99",t.meiosPagamento[a]=o,e.abrupt("return",o);case 14:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),obterValorAproxTributos:function(){var e=d()(regeneratorRuntime.mark(function e(t,a){var o,r,n,i,s,c,l;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return v["gconsole"].log("gerarSatD","obterValorAproxTributos",a),e.next=3,Object(k["a"])().nfeIbpt.where("codigo").equals(Number(t.item.ncm)).toArray();case 3:if(o=e.sent,!this.verificarAlerta(!o.length,"Não encontrado alíquotas para calculo do valor aproximado de tributos do NCM: ".concat(t.item.ncm,". Atualize sua tabela IBPT."),t)){e.next=6;break}return e.abrupt("return","0.00");case 6:return r=o.filter(function(e){return e.idContato===t.empresa.id}),n=r.length?r:o,i=n.reduce(function(e,t){return!e||e.vigenciaFim<t.vigenciaFim?t:e},null),this.verificarAlerta(i.vigenciaFim<Object(v["dataAtual"])(),"Informações vencidas para para o calculo do valor aproximado de tributos do NCM: ".concat(t.item.ncm,". Atualize sua tabela IBPT."),t),s=0,c=Number(t.documentoItem.descontoFaturaRateado||0)+Number(t.documentoItem.descontoTotalRateado||0),l=Number(t.documentoItem.quantidade||0)*(Number(t.documentoItem.valorItem||0)-Number(t.documentoItem.descontoItem||0))-c,["0","3","4","5","8"].includes(a)?s+=l*Number(i.nacionalFederal||0)/100:s+=l*Number(i.importadosFederal||0)/100,s+=l*Number(i.estadual||0)/100,s+=l*Number(i.municipal||0)/100,e.abrupt("return",s.toFixed(2));case 17:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}(),verificarAlerta:function(e,t,a){return e&&(a.alertas||(a.alertas=[]),a.alertas.push(t),console.warn(t)),e}},Q=a("a9a0"),J=a("895f"),G={components:{CpfCnpjNoCupom:C,ItemTrocarCest:y},computed:{config:function(){return z["a"].configuracoes.valores}},data:function(){return{configImpressaoNFe:[],documentosSat:[],documentosFiscais:[],documentosNFe:[],modalItemTrocarCest:{visivel:!1,campos:{}},cpfCnpjNoCupom:{visivel:!1,incluirCpfCnpjNoCupom:!1,cpfCnpj:"",nomeCliente:""}}},methods:{abrirNFe:function(e){v["eventos"].$emit("abrirNFe",e)},atualiza:function(){var e=d()(regeneratorRuntime.mark(function e(){var t,a,o,r,n,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(v["gconsole"].log("DocumentosFiscais","atualiza()",this.idFatura,this.idVenda),t=this.idFatura||this.idVenda,!t){e.next=13;break}return e.next=5,z["a"].documentoFiscalEletronico.le({idDocumento:t});case 5:return a=e.sent,this.documentosFiscais=a.sort(function(e,t){return Number(t.nNF)-Number(e.nNF)}),e.next=9,z["a"].documentoSat.le({idDocumento:t});case 9:o=e.sent,r=o.filter(function(e){return e.cancelamento}).map(function(e){return e.chaveCupomCancelado}),n=o.filter(function(e){return!r.includes(e.chaveCupom)}),this.documentosSat=n.sort(function(e,t){return t.numeroCupom-e.numeroCupom});case 13:return e.next=15,z["a"].documento.le({id:t});case 15:return i=e.sent,e.next=18,this.configuraImpressao(i.idEmpresa);case 18:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),cancelarSat:function(){var e=d()(regeneratorRuntime.mark(function e(t){var a,o,r,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return v["gconsole"].log("DocumentosFiscais","cancelarSat()",t),e.prev=1,e.next=4,this.$q.dialog({cancel:!0,color:"negative",title:"Tem certeza?",message:"Ao continuar você irá cancelar este cupom",ok:"Confirmar"});case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e["catch"](1),e.abrupt("return");case 9:return a="Erro no SAT",e.prev=10,Q["a"].show({spinner:J["a"],spinnerColor:"amber",message:"Cancelando o SAT"}),o=this.documentosSat.find(function(e){return e.id===t}),r={NumeroPDV:1,ChaveAcessoCFe:o.chaveCupom,CPF_CNPJ:"",Total:o.valorTotal},a="Ocorreu um erro ao cancelar o SAT",e.next=17,_["a"].cancelarSat(JSON.stringify(r),o.idEmpresa);case 17:return n=e.sent,Object(v["verificarErro"])("Erro"===n.status,n.mensagem),this.$q.notifyPositive(n.mensagem),a="Ocorreu um erro ao gravar os dados do cancelamento do SAT",e.next=23,U.guardarRetornoCancelamentoSat(this.idFatura,n.chaveCFe,n.xml);case 23:e.next=28;break;case 25:e.prev=25,e.t1=e["catch"](10),this.$q.notifyError(a,e.t1);case 28:return e.prev=28,Q["a"].hide(),this.atualiza(),e.finish(28);case 32:case"end":return e.stop()}},e,this,[[1,6],[10,25,28,32]])}));return function(t){return e.apply(this,arguments)}}(),cancelarNFCe:function(){var e=d()(regeneratorRuntime.mark(function e(t){var a,o,r,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return v["gconsole"].log("DocumentosFiscais","cancelarNFCe()",t),e.prev=1,e.next=4,this.$q.dialog({cancel:!0,color:"negative",title:"Tem certeza?",message:"Ao continuar você irá cancelar este cupom",ok:"Confirmar"});case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e["catch"](1),e.abrupt("return");case 9:return a="Erro no NFCe",e.prev=10,Q["a"].show({spinner:J["a"],spinnerColor:"amber",message:"Selecionando Certificado e Cancelando NFCe"}),o=JSON.parse(this.documentosFiscais.find(function(e){return e.id===t}).json),v["gconsole"].log("DocumentosFiscais","NFCe",o),e.next=16,L.gerarJsonCancelamento(o);case 16:if(o.infEvento=e.sent,Object(v["verificarErro"])(!o.infEvento,a),!o.erros.length){e.next=21;break}return v["eventos"].$emit("mostrarModalAlerta",{titulo:"Erro de validação",erros:o.erros}),e.abrupt("return");case 21:return a="Ocorreu um erro ao cancelar o NFCe",e.next=24,_["a"].cancelarNFCe(o);case 24:if(r=e.sent,"Erro"!==r.status){e.next=30;break}return v["gconsole"].log("DocumentosFiscaisErro",r),n=c()((r.mensagem||"").split("\n")).concat(c()((r.complemento||"").split("\n"))),v["eventos"].$emit("mostrarModalAlerta",{titulo:r.status,erros:n}),e.abrupt("return");case 30:this.$q.notifyPositive(r.mensagem),e.next=36;break;case 33:e.prev=33,e.t1=e["catch"](10),this.$q.notifyError(a,e.t1);case 36:return e.prev=36,Q["a"].hide(),this.atualiza(),e.finish(36);case 40:case"end":return e.stop()}},e,this,[[1,6],[10,33,36,40]])}));return function(t){return e.apply(this,arguments)}}(),configuraImpressao:function(){var e=d()(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,z["a"].configuracoes.porNome("impressao.nfe",t);case 2:a=e.sent,this.configImpressaoNFe=a.length?a.map(function(e){return i()({texto:"Imprimir Orçamento"},e)}):[{valor:"nfe-danfe",texto:"Imprimir DANFE"}];case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),emitirCupom:function(){var e=d()(regeneratorRuntime.mark(function e(t){var a,o,r,n,i,s,c,l,d,u,m,p=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return v["gconsole"].log("DocumentosFiscais","emitirCupom()"),e.prev=1,e.next=4,z["a"].documento.le({id:t});case 4:return a=e.sent,Object(v["verificarErro"])(!a||!a.status,"Erro ao emitir cupom. Falha na consulta da fatura."),Object(v["verificarErro"])("Finalizada"!==a.status,"Cupom não emitido. A Fatura não foi finalizada."),e.next=9,z["a"].financeiroTitulo.le({documentoId:t});case 9:if(o=e.sent[0],o){e.next=13;break}return v["gconsole"].log("DocumentosFiscais","Cupom não emitido. Fatura sem pagamentos."),e.abrupt("return");case 13:if(o.idDocumentoCaixa){e.next=20;break}return e.next=16,z["a"].configuracoes.porNome("vendas.tipoPDV",a.idEmpresa);case 16:n=e.sent,r=parseInt(((n||[]).find(function(e){return e.valor})||{}).valor)||4,e.next=29;break;case 20:return e.next=22,z["a"].documento.le({id:o.idDocumentoCaixa});case 22:return i=e.sent,Object(v["verificarErro"])(!i||!i.idCaixa,"Erro ao emitir cupom. Falha na consulta do documento Caixa."),e.next=26,z["a"].caixa.le({id:i.idCaixa});case 26:s=e.sent,Object(v["verificarErro"])(!s||!s.tipo,"Erro ao emitir cupom. Falha na consulta do Caixa."),r=s.tipo;case 29:if(Object(v["verificarErro"])(!z["a"].caixa.tiposCaixa[r],"Erro ao emitir cupom. Tipo de Caixa ".concat(r," inválido.")),r=z["a"].caixa.tiposCaixa[r],["SAT","NFCe"].includes(r)){e.next=34;break}return v["gconsole"].log("DocumentosFiscais","Cupom não emitido. Emissão de ".concat(z["a"].caixa.tiposCaixa[r]," não permitido.")),e.abrupt("return");case 34:if("SAT"!==r){e.next=45;break}return e.next=37,z["a"].documentoSat.le({idDocumento:t});case 37:c=e.sent,Object(v["verificarErro"])(!c,"Erro ao emitir cupom. Falha na consulta dos documentos Sat."),l=c.filter(function(e){return e.cancelamento}).map(function(e){return e.chaveCupomCancelado}),d=c.filter(function(e){return!l.includes(e.chaveCupom)}),u=d.filter(function(e){return!e.cancelamento}),Object(v["verificarErro"])(u.length>0,"Cupom Sat já emitido para a fatura"),e.next=51;break;case 45:if("NFCe"!==r){e.next=51;break}return e.next=48,z["a"].documentoFiscalEletronico.le({idDocumento:t,situacao:"Emitido"});case 48:m=e.sent,Object(v["verificarErro"])(!m,"Erro ao emitir cupom. Falha na consulta dos dados."),Object(v["verificarErro"])(m.length>0,"Cupom já emitido para a fatura");case 51:return e.next=53,Object(v["atualizarCfop"])(t);case 53:return this.cpfCnpjNoCupom={visivel:!0,incluirCpfCnpjNoCupom:!1,cpfCnpj:a.numeroDocumentoContato,nomeCliente:a.descricaoContato,idFatura:t,tipoCaixa:r,concluir:null},e.next=56,new Promise(function(e,t){p.cpfCnpjNoCupom.concluir=e});case 56:return e.next=58,this.$utils.dormir(500);case 58:if(!this.modalItemTrocarCest.visivel){e.next=61;break}return e.next=61,new Promise(function(e,t){p.concluirItemTrocarCest=e});case 61:e.next=66;break;case 63:e.prev=63,e.t0=e["catch"](1),this.$q.notifyError("Erro ao emitir cupom",e.t0);case 66:case"end":return e.stop()}},e,this,[[1,63]])}));return function(t){return e.apply(this,arguments)}}(),emitirCupomConfirma:function(){var e=d()(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",{SAT:this.emitirCupomSatConfirma,NFCe:this.emitirCupomNFCeConfirma}[t.tipoCaixa](t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),emitirCupomSatConfirma:function(){var e=d()(regeneratorRuntime.mark(function e(t){var a,o,r,n,i,s,c,l,d,u,m;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return v["gconsole"].log("DocumentosFiscais","emitirCupomSatConfirma()"),a="Erro no SAT",e.prev=2,Q["a"].show({spinner:J["a"],spinnerColor:"amber",message:"Emitindo o SAT"}),t.incluirCpfCnpjNoCupom||(t.cpfCnpj="",t.nomeCliente=""),a="Ocorreu um erro ao gerar o SAT",e.next=8,U.gerarSat(t.idFatura,1,t.cpfCnpj,t.nomeCliente);case 8:for(o=e.sent,r=o.objetoJson,n=o.dados,Object(v["verificarErro"])(!r,a),i=!0,s=!1,c=void 0,e.prev=15,l=n.alertas[Symbol.iterator]();!(i=(d=l.next()).done);i=!0)u=d.value,this.$q.notify({message:u,textColor:"black",type:"warning"});e.next=23;break;case 19:e.prev=19,e.t0=e["catch"](15),s=!0,c=e.t0;case 23:e.prev=23,e.prev=24,i||null==l.return||l.return();case 26:if(e.prev=26,!s){e.next=29;break}throw c;case 29:return e.finish(26);case 30:return e.finish(23);case 31:return a="Ocorreu um erro ao emitir o SAT",e.next=34,_["a"].emitirSat(JSON.stringify(r),n.empresa.id);case 34:return m=e.sent,Object(v["verificarErro"])("Erro"===m.status,m.mensagem),this.$q.notifyPositive(m.mensagem),a="Ocorreu um erro ao gravar os dados do SAT",e.next=40,U.guardarRetornoEmissaoSat(n,m.chaveCFe,m.xml);case 40:e.next=45;break;case 42:e.prev=42,e.t1=e["catch"](2),this.$q.notifyError(a,e.t1);case 45:return e.prev=45,Q["a"].hide(),!this.modalItemTrocarCest.visivel&&this.concluirItemTrocarCest&&(this.concluirItemTrocarCest(),this.concluirItemTrocarCest=null),this.atualiza(),e.finish(45);case 50:case"end":return e.stop()}},e,this,[[2,42,45,50],[15,19,23,31],[24,,26,30]])}));return function(t){return e.apply(this,arguments)}}(),emitirCupomNFCeConfirma:function(){var e=d()(regeneratorRuntime.mark(function e(t){var a,o,r,n,i,s,l,d,u,m,p;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return v["gconsole"].log("DocumentosFiscais","emitirCupomNFCeConfirma()"),a="Erro ao emitir Cupom NFCe",e.prev=2,Q["a"].show({spinner:J["a"],spinnerColor:"amber",message:"Selecionando Certificado e Emitindo o Cupom NFCe"}),t.incluirCpfCnpjNoCupom||(t.cpfCnpj="",t.nomeCliente=""),a="Ocorreu um erro ao gerar o Cupom NFCe",e.next=8,L.gerarJson(t.idFatura,t.cpfCnpj,t.nomeCliente);case 8:if(r=e.sent,Object(v["verificarErro"])(!r,a),!r.erros.length){e.next=13;break}return v["eventos"].$emit("mostrarModalAlerta",{titulo:"Erro de validação",erros:r.erros}),e.abrupt("return");case 13:return e.next=15,this.verificarCestEmST(r);case 15:if(!e.sent){e.next=17;break}return e.abrupt("return");case 17:for(n=!0,i=!1,s=void 0,e.prev=20,l=r.alertas[Symbol.iterator]();!(n=(d=l.next()).done);n=!0)u=d.value,this.$q.notify({message:u,textColor:"black",type:"warning"});e.next=28;break;case 24:e.prev=24,e.t0=e["catch"](20),i=!0,s=e.t0;case 28:e.prev=28,e.prev=29,n||null==l.return||l.return();case 31:if(e.prev=31,!i){e.next=34;break}throw s;case 34:return e.finish(31);case 35:return e.finish(28);case 36:return a="Ocorreu um erro ao emitir o Cupom NFCe",e.next=39,_["a"].emitirNFCe(r,r.empresaPlat.hashCSC,r.empresaPlat.tokenCSC);case 39:if(o=e.sent,"Erro"!==o.status){e.next=45;break}return v["gconsole"].log("DocumentosFiscaisErro",o),m=c()((o.mensagem||"").split("\n")).concat(c()((o.complemento||"").split("\n"))),v["eventos"].$emit("mostrarModalAlerta",{titulo:o.status,erros:m}),e.abrupt("return");case 45:this.$q.notifyPositive(o.mensagem),e.next=52;break;case 48:return e.prev=48,e.t1=e["catch"](2),this.$q.notifyError(a,e.t1),e.abrupt("return");case 52:return e.prev=52,Q["a"].hide(),!this.modalItemTrocarCest.visivel&&this.concluirItemTrocarCest&&(this.concluirItemTrocarCest(),this.concluirItemTrocarCest=null),this.atualiza(),e.finish(52);case 57:return e.prev=57,e.next=60,_["a"].imprimirNFCe(o.xml,r.outrosNFe.idContatoEmitente);case 60:p=e.sent,"Erro"===p.status&&console.error("Erro ao imprimir NFCe\n",p.mensagem),e.next=67;break;case 64:e.prev=64,e.t2=e["catch"](57),console.error("Erro ao imprimir NFCe\n",e.t2.toString());case 67:case"end":return e.stop()}},e,this,[[2,48,52,57],[20,24,28,36],[29,,31,35],[57,64]])}));return function(t){return e.apply(this,arguments)}}(),reimprimirSat:function(){var e=d()(regeneratorRuntime.mark(function e(t){var a,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(v["gconsole"].log("DocumentosFiscais","reimprimirSat()",t),e.prev=1,Q["a"].show({spinner:J["a"],spinnerColor:"amber",message:"Imprimindo SAT"}),a=this.documentosSat.find(function(e){return e.id===t}),v["gconsole"].log("DocumentosFiscais","sat.xml",a.xml),!a.cancelamento){e.next=11;break}return e.next=8,_["a"].imprimirCancelamentoSat(a.xml,a.idEmpresa);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,_["a"].imprimirSat(a.xml,a.idEmpresa);case 13:e.t0=e.sent;case 14:o=e.t0,Object(v["verificarErro"])("Erro"===o.status,o.mensagem),this.$q.notifyPositive(o.mensagem),e.next=22;break;case 19:e.prev=19,e.t1=e["catch"](1),this.$q.notifyError("Ocorreu um erro ao imprimir o SAT",e.t1);case 22:return e.prev=22,Q["a"].hide(),e.finish(22);case 25:case"end":return e.stop()}},e,this,[[1,19,22,25]])}));return function(t){return e.apply(this,arguments)}}(),reimprimirNFCe:function(){var e=d()(regeneratorRuntime.mark(function e(t){var a,o,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return v["gconsole"].log("DocumentosFiscais","reimprimirNFCe()",t),e.prev=1,Q["a"].show({spinner:J["a"],spinnerColor:"amber",message:"Imprimindo NFCe"}),e.next=5,z["a"].documentoFiscalEletronicoXml.le({idDocumentoFiscalEletronico:t,status:"Sucesso",situacao:"Emitido"});case 5:return a=e.sent,Object(v["verificarErro"])(!a||!a.length||!a[0].xmlProt,"Ocorreu um erro ao carregar o xml da NFCe"),o=JSON.parse(a[0].json),v["gconsole"].log("DocumentosFiscais","NFCeXml",a[0].xmlProt),e.next=11,_["a"].imprimirNFCe(a[0].xmlProt,o.outrosNFe.idContatoEmitente);case 11:r=e.sent,Object(v["verificarErro"])("Erro"===r.status,r.mensagem),this.$q.notifyPositive(r.mensagem),e.next=19;break;case 16:e.prev=16,e.t0=e["catch"](1),this.$q.notifyError("Ocorreu um erro ao imprimir o NFCe",e.t0);case 19:return e.prev=19,Q["a"].hide(),e.finish(19);case 22:case"end":return e.stop()}},e,this,[[1,16,19,22]])}));return function(t){return e.apply(this,arguments)}}(),verificarCestEmST:function(){var e=d()(regeneratorRuntime.mark(function e(t){var a,o,r,n,i,s,c,l,d,u,m;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,z["a"].configuracoes.leValorNumerico("imposto.versao");case 2:if(a=e.sent,2===a){e.next=5;break}return e.abrupt("return",!1);case 5:for(o=[],r=!0,n=!1,i=void 0,e.prev=9,s=t.infNFe.det[Symbol.iterator]();!(r=(c=s.next()).done);r=!0)l=c.value,d=this._.get(l,"prod.noXml_id"),u=this._.get(l,"prod.opcional.CEST"),m=this._.get(l,"imposto.noXml_CSOSN")||this._.get(l,"imposto.noXml_CST"),["10","20","60","70","201","202","500"].includes(m)&&!u&&o.push(d);e.next=17;break;case 13:e.prev=13,e.t0=e["catch"](9),n=!0,i=e.t0;case 17:e.prev=17,e.prev=18,r||null==s.return||s.return();case 20:if(e.prev=20,!n){e.next=23;break}throw i;case 23:return e.finish(20);case 24:return e.finish(17);case 25:if(0!==o.length){e.next=27;break}return e.abrupt("return",!1);case 27:return this.modalItemTrocarCest={visivel:!0,campos:{ids:o}},e.abrupt("return",!0);case 29:case"end":return e.stop()}},e,this,[[9,13,17,25],[18,,20,24]])}));return function(t){return e.apply(this,arguments)}}(),verNoSefaz:function(e){v["gconsole"].log("DocumentosFiscais","verNoSefaz()",e),window.open(e,"_blank")}},props:{idFatura:{required:!1,type:String},idVenda:{required:!1,type:String}},watch:{idFatura:function(){this.atualiza()},"cpfCnpjNoCupom.visivel":function(e){!e&&this.cpfCnpjNoCupom.concluir&&(this.cpfCnpjNoCupom.concluir(),this.cpfCnpjNoCupom.concluir=null)},"modalItemTrocarCest.visivel":function(e){!e&&this.concluirItemTrocarCest&&(this.concluirItemTrocarCest(),this.concluirItemTrocarCest=null)}},mounted:function(){v["eventos"].$on("atualizarDocumentosFiscais",this.atualiza),this.atualiza()},beforeDestroy:function(){v["eventos"].$off("atualizarDocumentosFiscais",this.atualiza)}},X=G,Y=(a("1c4d"),Object(b["a"])(X,o,r,!1,null,null,null));Y.options.__file="DocumentosFiscais.vue";t["a"]=Y.exports},e9b3:function(e,t,a){"use strict";var o=a("db8e"),r=a.n(o);r.a},e9d9:function(e,t,a){},ebdd:function(e,t,a){"use strict";var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-modal",{attrs:{value:e.abrir,"content-css":{minWidth:"50vw"}},on:{input:e.eventoInput}},[a("q-modal-layout",[a("q-toolbar",{attrs:{slot:"header"},slot:"header"},[a("q-toolbar-title",[e._v("Abertura de Caixa")]),a("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{dense:"",flat:"",icon:"close",round:""}})],1),a("form",{staticClass:"layout-padding",on:{submit:function(t){return t.preventDefault(),e.abrirCaixa(t)}}},[a("q-field",{staticClass:"row"},[a("q-select",{attrs:{"float-label":"Caixa",options:e.caixas},model:{value:e.campos.idCaixa,callback:function(t){e.$set(e.campos,"idCaixa",t)},expression:"campos.idCaixa"}})],1),a("campo",{staticClass:"row",attrs:{tipo:"decimal",decimals:"2",rotulo:"Valor inicial"},model:{value:e.campos.valor,callback:function(t){e.$set(e.campos,"valor",t)},expression:"campos.valor"}}),a("campo",{staticClass:"row",attrs:{tipo:"texto",rotulo:"Observação"},model:{value:e.campos.observacao,callback:function(t){e.$set(e.campos,"observacao",t)},expression:"campos.observacao"}}),a("div",{staticClass:"q-mt-lg text-center"},[a("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{color:"faded",flat:"",label:"Cancelar"}}),a("q-btn",{staticClass:"q-ml-sm no-shadow",attrs:{color:"primary",label:"Abrir",type:"submit"}})],1)],1)],1)],1)},r=[];o._withStripped=!0;var n=a("3156"),i=a.n(n),s=(a("ac4d"),a("8a81"),a("ac6a"),a("96cf"),a("c973")),c=a.n(s),l=a("88db"),d=a("8149"),u={components:{Campo:l["a"]},data:function(){return{abrir:!1,campos:{valor:0,idCaixa:"",observacao:""},caixas:[]}},methods:{atualizar:function(){var e=c()(regeneratorRuntime.mark(function e(){var t,a,o,r,n,s,c,l,u;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,d["a"].caixa.le({aberto:!1});case 2:return t=e.sent,e.next=5,d["a"].contatoBusca.filtrar(null,{ativo:!0,empresas:!0},0);case 5:if(a=e.sent,t=t.filter(function(e){if(!e.ativo)return!1;var t=a.filter(function(t){return t.id===e.idEmpresa});return t.length?(e.apelidoEmpresa=t[0].apelido,!0):void 0}),t.length){e.next=11;break}return this.$emit("input",!1),this.$q.notify({message:"Não há caixas para abrir.",type:"warning"}),e.abrupt("return");case 11:for(o=[],r=!0,n=!1,s=void 0,e.prev=15,c=t[Symbol.iterator]();!(r=(l=c.next()).done);r=!0)u=l.value,o.push(i()({value:u.id,label:u.descricao+" "+u.apelidoEmpresa},u));e.next=23;break;case 19:e.prev=19,e.t0=e["catch"](15),n=!0,s=e.t0;case 23:e.prev=23,e.prev=24,r||null==c.return||c.return();case 26:if(e.prev=26,!n){e.next=29;break}throw s;case 29:return e.finish(26);case 30:return e.finish(23);case 31:this.caixas=o,this.campos.idCaixa=this.caixas[0].id,this.abrir=!0;case 34:case"end":return e.stop()}},e,this,[[15,19,23,31],[24,,26,30]])}));return function(){return e.apply(this,arguments)}}(),abrirCaixa:function(){var e=c()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,this.$q.loading.show({message:"Processando..."}),e.next=4,d["a"].caixa.abra(this.campos);case 4:e.next=10;break;case 6:return e.prev=6,e.t0=e["catch"](0),this.$q.notifyError("Não foi possível abrir o caixa.",e.t0),e.abrupt("return");case 10:return e.prev=10,this.$q.loading.hide(),e.finish(10);case 13:this.abrir=!1,this.$emit("input",!1),this.$emit("aberto"),this.$q.notifyPositive("Caixa aberto com sucesso.");case 17:case"end":return e.stop()}},e,this,[[0,6,10,13]])}));return function(){return e.apply(this,arguments)}}(),eventoInput:function(e){this.$emit("input",e)}},props:{value:{default:!1,required:!0,type:Boolean}},watch:{value:function(e){e&&(this.abrir=!1,this.campos={valor:0,idCaixa:"",observacao:""},this.atualizar()),this.$emit("input",e)}}},m=u,p=a("2877"),v=Object(p["a"])(m,o,r,!1,null,null,null);v.options.__file="CaixaAbrir.vue";t["a"]=v.exports},ed50:function(e,t,a){"use strict";var o=a("5ca1"),r=a("2e08"),n=a("a25f"),i=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(n);o(o.P+o.F*i,"String",{padEnd:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0,!1)}})},fdcf:function(e,t,a){},febd:function(e,t,a){"use strict";var o=a("6461"),r=a.n(o);r.a},ff19:function(e,t,a){"use strict";var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"row gutter-xs"},[e.equipamento.descricao?a("div",{staticClass:"col-12"},[e._v(e._s(e.equipamento.descricao))]):e._e(),a("div",{staticClass:"col-12"},[e._v(" "+e._s(e.marcaModeloCor)+"\n\n  ")]),a("div",{staticClass:"col-12"},[e.equipamento.placa?[a("span",{staticClass:"q-body-1"},[e._v("Placa: ")]),a("strong",{staticClass:"q-pr-md"},[e._v(e._s(e.equipamento.placa))])]:e._e(),e.equipamento.chassi?[a("span",{staticClass:"q-body-1"},[e._v("Chassi: ")]),a("strong",{staticClass:"q-pr-md"},[e._v(e._s(e.equipamento.chassi))])]:e._e(),e.equipamento.btu?[a("span",{staticClass:"q-body-1"},[e._v("BTU: ")]),a("strong",{staticClass:"q-pr-md"},[e._v(e._s(e.equipamento.btu))])]:e._e(),e.equipamento.numeroSerie?[a("span",{staticClass:"q-body-1"},[e._v("Número de série: ")]),a("strong",{staticClass:"q-pr-md"},[e._v(e._s(e.equipamento.numeroSerie))])]:e._e(),e.equipamento.dataValidade?[a("span",{staticClass:"q-body-1"},[e._v("Validade: ")]),a("strong",{staticClass:"q-pr-md"},[e._v(e._s(e._f("data")(e.equipamento.dataValidade)))])]:e._e(),e.equipamento.dataFinalGarantia?[a("span",{staticClass:"q-body-1"},[e._v(" Garantia: ")]),a("strong",{staticClass:"q-pr-md"},[e._v(e._s(e._f("data")(e.equipamento.dataFinalGarantia)))])]:e._e()],2),e.equipamento.observacao?a("div",{staticClass:"col-12"},[a("strong",{staticClass:"q-body-1"},[e._v("Observação: ")]),e._v(e._s(e.equipamento.observacao)+"\n  ")]):e._e()])},r=[];o._withStripped=!0;var n={computed:{marcaModeloCor:function(){var e=this;return["marca","modelo","cor"].map(function(t){return e.equipamento[t]}).filter(function(e){return e}).join(" - ")}},props:{equipamento:{required:!0,type:Object}}},i=n,s=a("2877"),c=Object(s["a"])(i,o,r,!1,null,null,null);c.options.__file="EquipamentoCard.vue";t["a"]=c.exports}}]);