import{_ as Bo,aW as Ro,M as Qo,N as Ho,fT as jo,aU as Go,b2 as Jo,d9 as Ko,bd as $o,d8 as Xo,cS as Wo,cT as Yo,cU as Zo,d4 as zo,d5 as oe,R as No,p as V,o as f,d as $,f as o,w as t,K as Fo,A as ee,B as H,C as G,D as y,L as J,E as j,e as m,V as so,l as _,G as ae,x as c,t as h,i as v,aF as Z,ai as X,aj as C,ak as d,j as b,ah as P,s as W,U as no,k as L,cq as ho,F as co,r as go,I as te,aQ as ie,y as vo,aK as So,h as le,cO as re,fE as se,am as ne}from"./index.fd6a1d5c.js";import{l as ce}from"./Lista.8b25afdd.js";import"./QBtnDropdown.ade76751.js";import"./QBtnGroup.e25d70c2.js";import"./QDate.fca2b24c.js";import"./xlsx.e942faf2.js";const de={components:{Arquivo:Ro,Avatar:Qo,Badge:Ho,CodigoBarras:jo,ContatoCriar:Go,PromptItemV2:Jo,Receita:Ko,Tutorial:$o,Pupilometro:Xo,DocumentoCodigo:Wo,DocumentoMetas:Yo,Faturamento:Zo,PromptItemTabelaPrecoNovo:zo,PromptDocumentoOperacao:oe},computed:{carrinhoSemArmacaoVazia(){return this.carrinho.filter(i=>!(i.tipoItem==="Arma\xE7\xE3o"&&!i.descricaoItem.trim()&&i.total===0&&i.valorItem===0))},envelopeVazio(){return{id:"",idDocumentoAdicional:"",docId:"",docTipo:"",carrinho:[],totalDesconto:0,totalPercentualDesconto:0,subTotal:0,totalDocumento:0,paciente:{id:"",nome:""},tipo:"Envelope",tipoEnvelope:"Oculos",tipoLente:"",tipoOculos:"Vista"}},erroDataHoraPrevisto(){if(this.campos.dataHoraPrevisto){const i=new Date().setHours(0,0,0,0);if(new Date(this.campos.dataHoraPrevisto)<new Date(i))return"Previs\xE3o de entrega n\xE3o pode ser menor do que a data de hoje"}return""},descricaoClassificacaoDestinatario(){return this.classificacaoDestinatario===0?"PF N\xE3o Contribuinte":this.classificacaoDestinatario===1?"PJ Contribuinte":this.classificacaoDestinatario===2?"PJ N\xE3o Contribuinte":"Sem classifica\xE7\xE3o de destinat\xE1rio"},ehOrcamento(){return["AGUARDANDO LIBERA\xC7\xC3O","AGUARDANDO ESTOQUE","AGUARDANDO FINANCEIRO","OR\xC7AMENTO"].includes(((this.envelope.documento||{}).status||"").toUpperCase())&&((this.envelope.documento||{}).tipo||"").toUpperCase()==="VENDA"}},data(){return{armacao:{alturaMontagemOD:null,alturaMontagemOE:null,diagonal:null,ponte:null,altura:null,tamanho:"",armacaoMaterial:"",tipoMontagem:""},armacaoMaterialModal:!1,armacaoMaterialDescricao:"",envelope:{},visivel:!1,opcoesArmacaoMaterial:[],tipoMontagemModal:!1,tipoMontagemDescricao:"",opcoesTipoMontagem:[],campos:{totalDesconto:0,totalPercentualDesconto:0,subTotal:0,totalDocumento:0,idContato:"",descricaoContato:"",idDocumentoAdicional:"",dataHoraPrevisto:""},tipo:"Envelope",tipoEnvelope:"Oculos",tipoLente:"",tipoOculos:"Vista",carrinho:[],documentoContato:[],duplicarReceita:!1,idPacienteSelecionado:"",descricaoReceitaSelecionada:"",modalItem:{visivel:!1,filtros:{}},modalPupilometro:{},tipoPupilometro:"",permissaoPupilometro:!1,descricaoLaboratorio:"",documentoContatoLaboratorio:{},descricaoResponsavel:"",itensTipo:[],itens:{},tipoDescontoPercentagem:!0,tipoDescontoTotal:!0,pacientes:[{label:"",value:""}],tipoLentes:[],tipoLentesOculos:["","Monofocal (Longe)","Monofocal (M\xE9dio)","Monofocal (Perto)","Bifocal (Longe e Perto)","Multifocal (Longe e Perto)","Intermedi\xE1rio (M\xE9dio e Perto)","Intermedi\xE1rio (Longe e M\xE9dio)"],tipoLentesContato:["","Monofocal (Longe)","Bifocal (Longe e Perto)","Multifocal (Longe e Perto)"],receita:{},receitasDescricao:[],modalReceita:{visivel:!1,id:"",idEmpresa:"",duplicar:!1},arquivo:[],opcoesPacientes:[],filtroAvancado:void 0,dataPrevisaoEntrega:null,horaPrevisaoEntrega:null,classificacaoDestinatario:null,menuVenda:!1,contato:{imagem:null},exibirCarregando:!1}},emits:["salvarEnvelope"],methods:{ajustarDataHoraPrevisaoEntrega(){let i;i=new Date(this.dataPrevisaoEntrega),i.setHours(this.horaPrevisaoEntrega.slice(0,2)),i.setMinutes(this.horaPrevisaoEntrega.slice(3,5)),this.campos.dataHoraPrevisto=No.formatDate(i)},async criarOpcoesPacientes(){try{const i=await $db.contato.leFilhos($db.contato.selecionado.id);i.push($db.contato.selecionado);const e=i.map(l=>({label:l.nome,value:l.id}));return e.sort((l,r)=>l.label<r.label?1:-1),e}catch(i){this.$q.notifyError("N\xE3o foi poss\xEDvel carregar os dados de pacientes",i)}},filtrarPacientes(i,e){e(async()=>{const l=await this.criarOpcoesPacientes();if(i==="")this.opcoesPacientes=l;else{const r=i.toLowerCase();this.opcoesPacientes=l.filter(a=>a.label.toLowerCase().indexOf(r)>-1)}})},fecharModalPupilometro(){if(this.modalPupilometro.visivel=!1,$db.pupilometro.fotoOriginal==="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAQAAAAkGDomAAAATklEQVR42u3OMQEAAAgDINc/9Czh4QEJSDuvRVBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUPDSAovln7Gzmi7KAAAAAElFTkSuQmCC")return;let i={id:(this.modalPupilometro.pupilometroAtual||{}).id||$utils.uuid(),descricao:"Pupil\xF4metro",referencia:"idEnvelope:"+this.campos.id,json:JSON.stringify({foto:$db.pupilometro.foto,fotoOriginal:$db.pupilometro.fotoOriginal,medidas:$db.pupilometro.medidas})};this.modalPupilometro.pupilometroAtual=i,this.armacao.largura=$db.pupilometro.medidas.tamanhoArmacao,this.armacao.ponte=$db.pupilometro.medidas.ponte,this.armacao.altura=$db.pupilometro.medidas.alturaArmacao,this.armacao.diagonal=$db.pupilometro.medidas.diagonal.distancia,$db.pupilometro.medidas.bifocal?(this.armacao.alturaMontagemOD=$db.pupilometro.medidas.bifocalOlhoDireito,this.armacao.alturaMontagemOE=$db.pupilometro.medidas.bifocalOlhoEsquerdo):(this.armacao.alturaMontagemOD=$db.pupilometro.medidas.dip.od.altura,this.armacao.alturaMontagemOE=$db.pupilometro.medidas.dip.oe.altura),this.salvarDnp()},abrirModalPupilometro(i){if(this.modalPupilometro={...this.modalPupilometro,visivel:!1,avancar:this.envelope.somenteLeitura?"Medidas":""},$db.pupilometro.limpar(),$db.pupilometro.medidas.tipo="Presencial",this.armacao.largura&&($db.pupilometro.medidas.tamanhoArmacao=this.armacao.largura),this.armacao.ponte&&($db.pupilometro.medidas.ponte=this.armacao.ponte),this.armacao.diagonal&&($db.pupilometro.medidas.diagonal.distancia=this.armacao.diagonal),this.armacao.altura&&($db.pupilometro.medidas.alturaArmacao=this.armacao.altura),(this.modalPupilometro.pupilometroAtual||{}).json){const e=JSON.parse(this.modalPupilometro.pupilometroAtual.json);$db.pupilometro.foto=e.foto,$db.pupilometro.fotoOriginal=e.fotoOriginal,$db.pupilometro.medidas=e.medidas,this.armacao.largura&&($db.pupilometro.medidas.tamanhoArmacao=this.armacao.largura),this.armacao.ponte&&($db.pupilometro.medidas.ponte=this.armacao.ponte),this.armacao.diagonal&&($db.pupilometro.medidas.diagonal.distancia=this.armacao.diagonal),this.envelope.somenteLeitura||$db.pupilometro.foto!=="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAQAAAAkGDomAAAATklEQVR42u3OMQEAAAgDINc/9Czh4QEJSDuvRVBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUPDSAovln7Gzmi7KAAAAAElFTkSuQmCC"?this.modalPupilometro.avancar="Medidas":this.modalPupilometro.avancar="TirarFoto"}if(i==="Cart\xE3o"){$db.pupilometro.medidas.tipo=i,$db.pupilometro.medidas.olhoDireito.centroOlho.top=345,$db.pupilometro.medidas.olhoDireito.centroOlho.left=255,$db.pupilometro.medidas.olhoEsquerdo.centroOlho.top=345,$db.pupilometro.medidas.olhoEsquerdo.centroOlho.left=450,$db.pupilometro.medidas.nariz.top=0,$db.pupilometro.medidas.nariz.left=0,$db.pupilometro.medidas.ponte=23,this.envelope.somenteLeitura||$db.pupilometro.foto!=="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAQAAAAkGDomAAAATklEQVR42u3OMQEAAAgDINc/9Czh4QEJSDuvRVBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUPDSAovln7Gzmi7KAAAAAElFTkSuQmCC"?this.modalPupilometro.avancar="CartaoMedidas":this.modalPupilometro.avancar="CartaoFoto",this.modalPupilometro={...this.modalPupilometro,visivel:!0},this.$nextTick(()=>{this.modalPupilometro.avancar==="CartaoFoto"&&this.$refs.pupilometro.cartaoNovo()});return}this.$nextTick(()=>{this.modalPupilometro.visivel=!0})},abrirArmacaoMaterialModal(){this.envelope.somenteLeitura||(this.armacaoMaterialModal=!0)},abrirTipoMontagemModal(){this.envelope.somenteLeitura||(this.tipoMontagemModal=!0)},async atualizarArmacaoMaterial(){let i=[];await $db.item.carregarMemoria();for(const l of $db.item.itens)l.armacaoMaterial&&!~i.indexOf(l.armacaoMaterial)&&i.push(l.armacaoMaterial);i=i.map(l=>({armacaoMaterial:l,sort:l.toLowerCase()})),i=$lodash.orderBy(i,"sort","asc");const e=[];for(const l of i)e.push({rotulo:l.armacaoMaterial,valor:l.armacaoMaterial});this.opcoesArmacaoMaterial=e},async atualizarTipoMontagem(){let i=[];await $db.item.carregarMemoria();for(const l of $db.item.itens)l.tipoMontagem&&!~i.indexOf(l.tipoMontagem)&&i.push(l.tipoMontagem);i=i.map(l=>({tipoMontagem:l,sort:l.toLowerCase()})),i=$lodash.orderBy(i,"sort","asc");const e=[];for(const l of i)e.push({rotulo:l.tipoMontagem,valor:l.tipoMontagem});this.opcoesTipoMontagem=e},async criarArmacaoMaterial(){this.opcoesArmacaoMaterial=$lodash.orderBy([...this.opcoesArmacaoMaterial,{rotulo:this.armacaoMaterialDescricao,valor:this.armacaoMaterialDescricao,sort:this.armacaoMaterialDescricao.toLowerCase()}],"sort","asc"),this.armacao.armacaoMaterial=this.armacaoMaterialDescricao,this.armacaoMaterialModal=!1},async criarTipoMontagem(){this.opcoesTipoMontagem=$lodash.orderBy([...this.opcoesTipoMontagem,{rotulo:this.tipoMontagemDescricao,valor:this.tipoMontagemDescricao,sort:this.tipoMontagemDescricao.toLowerCase()}],"sort","asc"),this.armacao.tipoMontagem=this.tipoMontagemDescricao,this.tipoMontagemModal=!1},async selecionarLaboratorio(){if(this.envelope.somenteLeitura)return;const i=await $g.promptContato.show({filtro:{ativo:!0,segmento:"Laborat\xF3rio"},placeholder:"Selecione o laborat\xF3rio"});if(!(i!=null&&i.id))return;const e=i.id;this.documentoContatoLaboratorio.idContato=e,this.descricaoLaboratorio=(await $db.contato.le({id:e})).apelido||""},laboratorioLimpar(){this.documentoContatoLaboratorio.idContato="",this.descricaoLaboratorio=""},responsavelLimpar(){this.campos.idContatoResponsavel="",this.descricaoResponsavel=""},async selecionarResponsavel(){if(this.envelope.somenteLeitura)return;const i=await $g.promptContato.show({filtro:{ativo:!0,vendedores:!0},placeholder:"Selecione o respons\xE1vel"});if(!(i!=null&&i.id))return;const e=i.id;this.campos.idContatoResponsavel=e,this.descricaoResponsavel=(await $db.contato.le({id:e})).apelido||""},alterarTipoLente(){for(const i of this.carrinho)i.oculos=this.tipoLente},async selecionarPaciente(i){this.campos.idContato=i.value,this.campos.descricaoContato=i.label,await this.filtrarReceitas()},async atualizarReceita(i){var e;await this.filtrarReceitas(),i||this.receitasDescricao.length&&(i=this.receitasDescricao[0].value),i&&(this.receita=await $db.receita.le({id:i||this.receita.id}),await this.pacientesAtualizar(),this.campos.idContato=this.receita.paciente.id,this.campos.descricaoContato=(e=this.pacientes.filter(l=>l.value===this.campos.idContato)[0])==null?void 0:e.label)},calculaTotal(i){$db.envelope.calculaTotal({envelope:$utils.clonar(this.campos),itensEnvelope:$utils.clonar(this.carrinho),campoAlterado:i}).then(e=>{this.carrinho=e.itensEnvelope,this.campos=e.envelope})},async calculaTotalItem(i,e){const r=(await $db.envelope.calculaTotalItem({envelope:$utils.clonar(this.campos),itemEnvelope:$utils.clonar(this.carrinho[i]),campoAlterado:e})).itemEnvelope;if(e==="valorItem"){const a=$utils.clonarV2(this.carrinho);a[i]={...r,valorItem:0},this.carrinho=a,this.$nextTick(()=>{const n=$utils.clonarV2(this.carrinho);n[i]=r,this.carrinho=n,this.calculaTotal()})}else{const a=$utils.clonarV2(this.carrinho);a[i]=r,this.carrinho=a}this.calculaTotal()},async abrirModalDependente(){const i=await this.$refs.modalDependente.mostrar();(i||{}).id&&(await this.criarDependencia(i),await this.filtrarReceitas())},async abrirModalReceita(i,e){try{this.$refs.modalReceita.mostrar({id:i||$utils.uuid(),idEmpresa:$lodash.get(this.envelope,"documento.idEmpresa",""),duplicar:e,idContato:this.campos.idContato,descricaoContato:this.campos.descricaoContato})}catch(l){this.$q.notifyError("Ocorreu um erro ao carregar a receita.",l)}},limparFiltroAvancado(){this.filtroAvancado={...this.filtroAvancado,cilindrico:{lte:0},esfericoInicial:{lte:0},esfericoFinal:{gte:0},tipo:"Lente"}},abrirModalItem(i,e){var O,K,oo,eo,ao,u,Y,uo,mo,po,fo,s,D,E,k,I,q,T,U,x,N,F,S,B,Q,z,R,to,io,lo,ro,bo,_o,Co,Oo,Eo,Vo,yo,Mo,Ao,Do,Po,wo,Lo,ko,Io,qo,To,Uo,xo;let l,r,a,n,p,w,M,A,g;switch(i){case"Lentes":this.modalItem.filtros={tipo:"Lente",ativo:!0,bloquearVenda:!1},this.tipoLente&&(~this.tipoLente.indexOf("Monofocal")&&(g="Monofocal"),~this.tipoLente.indexOf("Bifocal")&&(g="Bifocal"),(~this.tipoLente.indexOf("Multifocal")||~this.tipoLente.indexOf("Intermedi\xE1rio"))&&(g="Multifocal")),r=(ao=(eo=(oo=(K=(O=this.receita)==null?void 0:O.prescricao)==null?void 0:K.dioptria)==null?void 0:oo.od)==null?void 0:eo.longe)==null?void 0:ao.cilindrico,a=(po=(mo=(uo=(Y=(u=this.receita)==null?void 0:u.prescricao)==null?void 0:Y.dioptria)==null?void 0:uo.oe)==null?void 0:mo.longe)==null?void 0:po.cilindrico,n=(k=(E=(D=(s=(fo=this.receita)==null?void 0:fo.prescricao)==null?void 0:s.dioptria)==null?void 0:D.od)==null?void 0:E.longe)==null?void 0:k.esferico,p=(x=(U=(T=(q=(I=this.receita)==null?void 0:I.prescricao)==null?void 0:q.dioptria)==null?void 0:T.oe)==null?void 0:U.longe)==null?void 0:x.esferico,l=(Q=(B=(S=(F=(N=this.receita)==null?void 0:N.prescricao)==null?void 0:F.dioptria)==null?void 0:S.od)==null?void 0:B.medio)==null?void 0:Q.esferico,(!n||l&&l>n)&&(n=l),l=(lo=(io=(to=(R=(z=this.receita)==null?void 0:z.prescricao)==null?void 0:R.dioptria)==null?void 0:to.oe)==null?void 0:io.medio)==null?void 0:lo.esferico,(!p||l&&l>p)&&(p=l),l=(Oo=(Co=(_o=(bo=(ro=this.receita)==null?void 0:ro.prescricao)==null?void 0:bo.dioptria)==null?void 0:_o.od)==null?void 0:Co.perto)==null?void 0:Oo.cilindrico,(!r||l&&l>r)&&(r=l),l=(Ao=(Mo=(yo=(Vo=(Eo=this.receita)==null?void 0:Eo.prescricao)==null?void 0:Vo.dioptria)==null?void 0:yo.oe)==null?void 0:Mo.perto)==null?void 0:Ao.cilindrico,(!a||l&&l>a)&&(a=l),l=(ko=(Lo=(wo=(Po=(Do=this.receita)==null?void 0:Do.prescricao)==null?void 0:Po.dioptria)==null?void 0:wo.od)==null?void 0:Lo.perto)==null?void 0:ko.esferico,(!n||l&&l>n)&&(n=l),l=(xo=(Uo=(To=(qo=(Io=this.receita)==null?void 0:Io.prescricao)==null?void 0:qo.dioptria)==null?void 0:To.oe)==null?void 0:Uo.perto)==null?void 0:xo.esferico,(!p||l&&l>p)&&(p=l),r=Number(r||void 0),a=Number(a||void 0),n=Number(n||void 0),p=Number(p||void 0),Number.isNaN(r)&&Number.isNaN(a)||(w=r>a?r:a),(Number.isNaN(r)||Number.isNaN(a))&&(w=r||a),Number.isNaN(n)&&Number.isNaN(p)||(M=n<p?n:p,A=n>p?n:p),(Number.isNaN(n)||Number.isNaN(p))&&(M=A=n||p),this.filtroAvancado={cilindrico:{lte:w||0},esfericoInicial:{lte:M||0},esfericoFinal:{gte:A||0},lenteTipo:g,opcoesTiposLente:["","Monofocal","Bifocal","Multifocal"]};break;case"LentesContato":this.modalItem.filtros={tipo:"Lente Contato",ativo:!0,bloquearVenda:!1},this.filtroAvancado=void 0;break;case"Armacao":this.modalItem.filtros={tipo:["Arma\xE7\xE3o","\xD3culos Sol"],ativo:!0,bloquearVenda:!1},this.filtroAvancado=void 0;break;case"Tratamento LOD":this.modalItem.filtros={tipo:"Tratamento",ativo:!0,bloquearVenda:!1},this.filtroAvancado=void 0,this.tipoTratamento="TLOD",this.idDocumentoItemPai=e;break;case"Tratamento LOE":this.modalItem.filtros={tipo:"Tratamento",ativo:!0,bloquearVenda:!1},this.filtroAvancado=void 0,this.tipoTratamento="TLOE",this.idDocumentoItemPai=e;break}this.modalItem.filtros.idEmpresa=this.campos.idEmpresa,this.modalItem.filtros.idTabelaPreco=this.campos.idItemTabelaPreco,this.modalItem.visivel=!0},async alterarTipoEnvelope(){const i=async()=>{this.tipoOculos=this.tipoEnvelope==="Oculos"?"Vista":"",this.carrinho=[],this.tipoEnvelope==="Oculos"?(this.tipoOculos="Vista",this.tipoLentes=this.tipoLentesOculos):(this.tipoOculos="",this.tipoLentes=this.tipoLentesContato)};if(!this.carrinho.length){i();return}$q.dialog({cancel:"Cancelar",message:"Esta a\xE7\xE3o ir\xE1 remover os itens do carrinho.",ok:"Continuar",title:"Tem certeza?"}).onOk(()=>{i()}).onCancel(()=>{this.tipoEnvelope=this.tipoEnvelope==="Oculos"?"Lentes":"Oculos"})},async criarDependencia(i){try{const e=await $db.hibrido.le({table:"documento",id:this.campos.documentoId});await $db.contato.criarDependenciaContatos({contatoPai:{id:e.idContato},contatoFilho:i}),this.campos.paciente||(this.campos.paciente={}),this.campos.idContato=this.campos.paciente.id=this.idPacienteSelecionado=i.id,this.campos.descricaoContato=this.campos.paciente.nome=i.nome}catch(e){this.$q.notifyError("Ocorreu um erro ao criar a depend\xEAncia.",e)}},async filtrarReceitas(){let i=[],e=await $db.hibrido.lista({table:"documento",where:{tipo:"Prescri\xE7\xE3o",idContato:this.campos.idContato}});e=$lodash.orderBy(e,"dataHoraEmissao","desc");const l=new Date().setHours(0,0,0,0);for(let r of e){r=await $db.receita.le({id:r.id}),this.receita.id||(this.receita=r);let a=`De ${r.medico.nome}, `;a+=`${this.$filters.data(r.data)} `,a+=`v\xE1lido at\xE9 ${this.$filters.data(r.validade)}`;let n={};new Date(r.validade).setHours(0,0,0,0)<l?n={icon:"alarm_off",color:"negative",stamp:"Vencida"}:n={icon:"alarm",stamp:"\xC0 vencer"};const p={label:a,value:r.id,...n};i.push(p)}this.receitasDescricao=i},mostrar(){this.atualizar(),this.visivel=!0},async fechar(i){i.stopPropagation(),this.visivel=!1},ordenarCarrinho(){const i={LOE:1,TLOE:2,LOD:3,TLOD:4,Arma\u00E7\u00E3o:5};this.carrinho=(this.carrinho||[]).sort((e,l)=>i[e.tipoItem]-i[l.tipoItem])},async removerItem(i){const e=(this.carrinho[i]||{}).id;this.carrinho=this.carrinho.filter(l=>l.id!==e&&l.idDocumentoItemPai!==e),this.calculaTotal()},async salvarDnp(){if(!this.receita.id)return;const i=JSON.parse((this.modalPupilometro.pupilometroAtual||{}).json||null);if(!i)return;let e=await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:this.receita.id}});for(const l of e){let r=0;l.operacao==="Olho Esquerdo"&&(r=$utils.arredondar(i.medidas.dnp.oe)),l.operacao==="Olho Direito"&&(r=$utils.arredondar(i.medidas.dnp.od)),r!==l.di&&(await $erp().documentoItem.update(l.id,{di:r}),await $utils.sincronismoEnviar("atualizar","documentoItem",l.id,{di:r}))}this.atualizarReceita(this.receita.id)},async salvarEnvelope(){if(!this.tipoLente){this.$q.notifyError("Selecione o tipo da lente");return}if(!this.receita.id){this.$q.notifyError("Selecione uma receita");return}if(!this.carrinho.length){this.$q.notifyError("N\xE3o h\xE1 itens no carrinho");return}if(this.erroDataHoraPrevisto){this.$q.notifyError("Erro no preenchimento do formul\xE1rio");return}let i={};if(this.tipoEnvelope==="Oculos"){let l=!1;for(const r in this.carrinho)if(this.carrinho[r].tipoItem==="Arma\xE7\xE3o"){this.carrinho[r].alturaMontagemOD=$utils.numberOrNull(this.armacao.alturaMontagemOD),this.carrinho[r].alturaMontagemOE=$utils.numberOrNull(this.armacao.alturaMontagemOE),this.carrinho[r].diagonal=$utils.numberOrNull(this.armacao.diagonal),this.carrinho[r].ponte=$utils.numberOrNull(this.armacao.ponte),this.carrinho[r].altura=$utils.numberOrNull(this.armacao.altura),this.carrinho[r].largura=$utils.numberOrNull(this.armacao.largura),this.carrinho[r].armacaoMaterial=this.armacao.armacaoMaterial,this.carrinho[r].tipoMontagem=this.armacao.tipoMontagem,this.carrinho[r].oculos=this.tipoLente,this.carrinho[r].tipoOculos=this.tipoOculos,this.carrinho[r].idItem&&(i.id=this.carrinho[r].idItem,i.armacaoMaterial=this.armacao.armacaoMaterial,i.tipoMontagem=this.armacao.tipoMontagem,i.diagonal=$utils.numberOrNull(this.armacao.diagonal),i.ponte=$utils.numberOrNull(this.armacao.ponte),i.altura=$utils.numberOrNull(this.armacao.altura),i.largura=$utils.numberOrNull(this.armacao.largura)),l=!0;break}l||this.carrinho.push({id:$utils.uuid(),idDocumento:this.campos.documentoId,idDocumentoAdicional:this.campos.id,dataHoraEmissao:$utils.dataAtual(),descontoItem:0,descontoPercentualItem:0,descontoSubTotal:0,descricaoItem:"",operacaoFator:0,oculos:this.tipoLente,tipoOculos:this.tipoOculos,quantidade:0,status:this.campos.status,subTotal:0,tipoItem:"Arma\xE7\xE3o",total:0,valorCusto:0,valorCustoMedio:0,valorCustoReposicao:0,valorCustoUltimo:0,valorItem:0,valorItemUltimo:0,valorOriginal:0,valorReal:0,alturaMontagemOD:$utils.numberOrNull(this.armacao.alturaMontagemOD),alturaMontagemOE:$utils.numberOrNull(this.armacao.alturaMontagemOE),diagonal:$utils.numberOrNull(this.armacao.diagonal),ponte:$utils.numberOrNull(this.armacao.ponte),altura:$utils.numberOrNull(this.armacao.altura),largura:$utils.numberOrNull(this.armacao.largura),armacaoMaterial:this.armacao.armacaoMaterial,tipoMontagem:this.armacao.tipoMontagem})}this.campos.idDocumentoAdicional=this.receita.id,this.campos.tipo="Envelope";const e={documento:$utils.clonar(this.campos),documentoItens:$utils.clonar(this.carrinho),armacao:i,arquivo:this.$refs.arquivo.arquivo.map(l=>({...l,idTabelaMaster:this.campos.id,tabelaMaster:"envelope"})),arquivoOriginal:this.envelope.arquivoOriginal,pupilometro:{original:$utils.clonarV2(this.modalPupilometro.pupilometroOriginal),atual:$utils.clonarV2(this.modalPupilometro.pupilometroAtual)}};this.documentoContatoLaboratorio.idContato&&(this.documentoContatoLaboratorio.id||(this.documentoContatoLaboratorio.id=$utils.uuid(),this.documentoContatoLaboratorio.idDocumento=e.documento.id,this.documentoContatoLaboratorio.descricao="Laborat\xF3rio"),this.documentoContato=this.documentoContato.filter(l=>l.descricao!=="Laborat\xF3rio"),e.documentoContato=[...this.documentoContato,this.documentoContatoLaboratorio]),this.salvarDnp(),this.$emit("salvarEnvelope",e),this.visivel=!1},adicionarItem(i){const e=this.carrinho.find(a=>a.idItem===i.id);let l=1;i.novoValorVenda=i.valorVenda,e&&(i.novoValorVenda=e.valorReal,l=e.quantidade);const r={};r[i.id]={item:i,quantidade:l},this.selecionarItens(r)},async selecionarItens(i){for(const e in i){const l=i[e].item||{};await this.selecionarItem(e,l)}},async selecionarItem(i,e){let l=[];if(["Arma\xE7\xE3o","\xD3culos Sol"].includes(e.tipo))l=["Arma\xE7\xE3o"];else if(e.tipo==="Tratamento")l=[this.tipoTratamento];else if(["Lente","Lente Contato"].includes(e.tipo))try{const a=[{label:"LOD / LOE",value:"opt1"},{label:"LOD",value:"opt2"},{label:"LOE",value:"opt3"}],n=await new Promise((p,w)=>{$q.dialog({noRefocus:!0,cancel:{label:"CANCELAR",push:!0,color:"tertiary",flat:!0},ok:{label:"CONTINUAR",push:!0,class:"bg-primary",textColor:"white",flat:!0},title:"",options:{type:"radio",model:"opt1",items:a}}).onOk(M=>{p(M)}).onCancel(()=>{w()})});l=a.filter(p=>p.value===n)[0].label.split(" / ")}catch{return}this.modalItem.visivel=!1;const r=await $utils.selecionarCfop({ncm:e.ncm,idItem:e.id,itemTipo:e.tipo,codigoDocumentoOperacao:this.campos.codigoDocumentoOperacao,idContatoDestinatario:this.campos.idContato,idContatoEmitente:this.campos.idEmpresa,operacaoFator:-1});if(!r){this.$q.notify("N\xE3o foi poss\xEDvel localizar o CFOP.");return}for(const a of l){if(!["TLOD","TLOE"].includes(a))for(const w in this.carrinho)this.carrinho[w].tipoItem===a&&await this.removerItem(w);const n=(await $db.estoqueSaldoProdutoEmpresa.le({idItem:e.id,idEmpresa:$lodash.get(this.envelope,"documento.idEmpresa",""),tipoEstoque:"Dispon\xEDvel"})).find(w=>w.idItem),p={id:$utils.uuid(),idItem:e.id,idDocumento:this.campos.documentoId,idDocumentoAdicional:this.campos.id,codigoPlanoContaDestino:139,codigoPlanoContaEstoque:146,dataHoraEmissao:$utils.dataAtual(),descontoItem:0,descontoPercentualItem:0,descontoSubTotal:0,descricaoItem:e.descricaoConcatenada,operacao:r==null?void 0:r.operacao,operacaoFator:r==null?void 0:r.fator,idCfop:r==null?void 0:r.id,oculos:this.tipoLente,tipoOculos:a==="Arma\xE7\xE3o"?this.tipoOculos:"",lenteTipo:a!=="Arma\xE7\xE3o"?this.tipoOculos:"",quantidade:1,status:this.campos.status,subTotal:e.valorVenda,tipoItem:a,total:e.valorVenda,valorCusto:0,valorCustoMedio:$lodash.get(n,"valorCustoMedio",0),valorCustoReposicao:e.valorCustoReposicao||0,valorCustoUltimo:$lodash.get(n,"valorCusto",0),valorItem:e.valorVenda,valorItemUltimo:0,valorOriginal:e.valorVenda,valorReal:e.valorVenda,valorRealTotal:e.valorVenda,alturaMontagemOD:null,alturaMontagemOE:null,diagonal:$utils.numberOrNull(e.diagonal),ponte:$utils.numberOrNull(e.ponte),altura:$utils.numberOrNull(e.altura),largura:$utils.numberOrNull(e.largura),armacaoMaterial:e.armacaoMaterial||"",tipoMontagem:e.tipoMontagem||""};["TLOD","TLOE"].includes(a)&&this.idDocumentoItemPai&&(p.idDocumentoItemPai=this.idDocumentoItemPai),a==="Arma\xE7\xE3o"&&(this.armacao.diagonal=$utils.numberOrNull(p.diagonal),this.armacao.ponte=$utils.numberOrNull(p.ponte),this.armacao.altura=$utils.numberOrNull(p.altura),this.armacao.largura=$utils.numberOrNull(p.largura),this.armacao.armacaoMaterial=p.armacaoMaterial,this.armacao.tipoMontagem=p.tipoMontagem),this.carrinho.push(p),this.ordenarCarrinho(),this.carregarItens(),this.calculaTotal()}},async pacientesAtualizar(){const i=await $db.contato.leFilhos(this.campos.idContato);i.push({nome:this.campos.descricaoContato,id:this.campos.idContato});const e=[];for(const l of i)e.push({label:l.nome,value:l.id});this.pacientes=$lodash.orderBy(e,"label")},async atualizar(){this.campos=$utils.clonar({...$db.envelope.vazio,...this.envelope.documento}),await this.obterClassificacaoDestinatario(this.campos.idContato),await this.atualizarDocumentoMetas(),this.tipoLente="",this.tipoLentes=this.tipoLentesOculos,this.carrinho=$utils.clonar(this.envelope.documentoItens||[]),this.armacao.alturaMontagemOD=null,this.armacao.alturaMontagemOE=null,this.armacao.diagonal=null,this.armacao.ponte=null,this.armacao.altura=null,this.armacao.largura=null,this.armacao.armacaoMaterial="",this.armacao.tipoMontagem="";const i=[];for(const r in this.carrinho){if(this.carrinho[r].idItem){const a=await $erp().item.get(this.carrinho[r].idItem);i.push(a.tipo||"")}if(this.carrinho[r].tipoItem==="Arma\xE7\xE3o"){this.armacao.alturaMontagemOD=$utils.numberOrNull(this.carrinho[r].alturaMontagemOD),this.armacao.alturaMontagemOE=$utils.numberOrNull(this.carrinho[r].alturaMontagemOE),this.armacao.diagonal=$utils.numberOrNull(this.carrinho[r].diagonal),this.armacao.ponte=$utils.numberOrNull(this.carrinho[r].ponte),this.armacao.altura=$utils.numberOrNull(this.carrinho[r].altura),this.armacao.largura=$utils.numberOrNull(this.carrinho[r].largura),this.armacao.armacaoMaterial=this.carrinho[r].armacaoMaterial,this.armacao.tipoMontagem=this.carrinho[r].tipoMontagem,this.tipoLente=this.carrinho[r].oculos;break}}this.tipoEnvelope="Oculos";const e=new RegExp(/contato/i);for(const r of i)if(e.test(r)){this.tipoEnvelope="Lentes";break}if(this.documentoContato=$utils.clonar(this.envelope.documentoContato||[]),this.documentoContatoLaboratorio=this.documentoContato.find(r=>r.descricao==="Laborat\xF3rio")||{},this.descricaoLaboratorio="",this.documentoContatoLaboratorio.id&&(this.descricaoLaboratorio=(await $db.contato.le({id:this.documentoContatoLaboratorio.idContato})).apelido||""),this.descricaoResponsavel=(await $db.contato.le({id:this.campos.idContatoResponsavel})).apelido||"",!this.campos.dataHoraPrevisto){let r="",a=await $db.configuracoes.le({nome:"venda.envelope.previsaoentrega"});a.length&&(a=parseInt(a[0].valor)),Number.isInteger(a)||(a=15);let n=new Date;const p=n.getDate();n.setDate(p+a),r=new Date(n.setHours(0,0,0,0)),this.campos.dataHoraPrevisto=No.formatDate(r)}let l;l=String(new Date(this.campos.dataHoraPrevisto).getHours()).padStart(2,"0"),l+=":",l+=String(new Date(this.campos.dataHoraPrevisto).getMinutes()).padStart(2,"0"),this.dataPrevisaoEntrega=new Date(new Date(this.campos.dataHoraPrevisto).toDateString()),this.horaPrevisaoEntrega=l,this.$refs.arquivo.somenteLeitura=this.envelope.somenteLeitura,this.pacientesAtualizar(),this.atualizarArmacaoMaterial(),this.atualizarTipoMontagem(),this.atualizarReceita(this.campos.idDocumentoAdicional),this.ordenarCarrinho(),this.carregarItens(),this.carregarPupilometro(),this.visivel=!0},async carregarItens(){for(const i of this.carrinho)if(!!i.idItem&&!(i.idItem in this.itens)){let e=await $erp().item.get(i.idItem);e={...e,marca:e.marca||"",referencia:e.referencia||"",observacao:e.observacao||"",aplicacao:e.aplicacao||"",imagem:e.imagem||""};const l=$utils.clonarV2(this.itens);l[e.id]=e,this.itens=l}},async carregarPupilometro(){var l,r;let i,e;$db.permissao.objeto("pupilometro").then(a=>{this.permissaoPupilometro=a}),i=await $erp().json.where({descricao:"Pupil\xF4metro",referencia:"idEnvelope:"+this.campos.id}).toArray(),e=i.find(a=>a.id),this.modalPupilometro.pupilometroOriginal={},this.modalPupilometro.pupilometroAtual={},e&&(this.modalPupilometro.pupilometroOriginal=$utils.clonarV2(e),this.modalPupilometro.pupilometroAtual=$utils.clonarV2(e)),this.tipoPupilometro="";try{e=JSON.parse(this.modalPupilometro.pupilometroAtual.json),this.tipoPupilometro=(r=(l=e==null?void 0:e.medidas)==null?void 0:l.tipo)!=null?r:"Presencial"}catch{}},async selecionarContato(i){const{placeholder:e,filtro:l}={placeholder:"Selecione o contato",filtro:{ativo:!0},...i},r=await $g.promptContato.show({filtro:l,placeholder:e});if(!r)throw new Error("Contato n\xE3o selecionado");return r},async obterClassificacaoDestinatario(i){if(this.classificacaoDestinatario=null,!i)return;const e=await $erp().contato.get(i);if(!e)return;const l=(e.numeroDocumentoNacional||"").trim().replace(/\D/g,""),r=(e.numeroDocumentoEstadual||"").trim().replace(/\D/g,"");if(l.length===14){this.classificacaoDestinatario=2,r&&(r||"").toLowerCase()!=="isento"&&(this.classificacaoDestinatario=1);return}this.classificacaoDestinatario=0},async obterContatoUsuario(){const i=JSON.parse(localStorage.getItem("usuario"))||{};let e={};return i.codigoUsuario&&(e=(await $erp().contato.where({codigoUsuario:i.codigoUsuario}).toArray()).find(l=>l.id)||{}),e},async atualizarDocumentoMetas(){if(!this.$refs.documentoMetas)return;const i=await $db.contato.leCompleto(this.envelope.documento.idContato);this.contato.imagem=i.imagem;const e=i.endereco.find(n=>n.grupo==="Principal")||i.endereco[0]||"",l=i.telefone.find(n=>n.grupo==="Principal")||i.telefone[0]||"";let r="";r="".concat((e==null?void 0:e.logradouro)||"",", ",(e==null?void 0:e.numero)||""," ",(e==null?void 0:e.complemento)||""," - ",(e==null?void 0:e.bairro)||""," - ",(e==null?void 0:e.cep)||""," - ",(e==null?void 0:e.municipio)||"","/",(e==null?void 0:e.uf)||""),r===",   -  -  - /"&&(r="");const a=await $db.contato.le({id:this.envelope.documento.idEmpresa});this.envelope.documento.numeroDocumentoEmpresa=a.numeroDocumentoNacional,this.envelope.documento.telefoneContato=l.telefone,this.envelope.documento.descricaoContatoEndereco=r,this.envelope.documento.idContatoIndicacao=this.campos.idContatoIndicacao,this.$refs.documentoMetas.documento=await $utils.clonarV2(this.envelope.documento)},async alterarCliente(){await this.selecionarContato({placeholder:"Selecione o cliente",filtro:{ativo:!0,somenteCarteira:!0}})},async alterarVendedor(){const i=await this.selecionarContato({placeholder:"Selecione o vendedor",filtro:{ativo:!0,vendedores:!0}});if(i.id){const e=i.id;this.envelope.documento.idContatoVendedor=i.id,this.descricaoResponsavel=(await $db.contato.le({id:e})).apelido||"",this.atualizarDocumentoMetas()}},async alterarTabelaPreco(){const i=await this.selecionarItemTabelaPreco(null,this.envelope.documento.idEmpresa);i.id&&(this.envelope.documento.idItemTabelaPreco=i.id,this.atualizarDocumentoMetas())},async selecionarItemTabelaPreco(i,e){if(!i)return this.$refs.promptItemTabelaPreco.placeholder="Selecione a tabela de pre\xE7o",this.$refs.promptItemTabelaPreco.filtro={tabelaMaster:!0,idContatoEmpresa:e},this.$refs.promptItemTabelaPreco.mostrar(),new Promise((l,r)=>{this.resolve=l,this.reject=r});i.id||this.reject("Tabela de pre\xE7o n\xE3o selecionada"),this.resolve(i)},async alterarDocumentoOperacao(){try{const i=await this.selecionarDocumentoOperacaoViaPrompt();i.id&&(this.envelope.documento.operacao=i.descricao,this.envelope.documento.codigoDocumentoOperacao=i.codigoDocumentoOperacao,this.finalidadeDestinatario=i.finalidade,this.atualizarDocumentoMetas())}catch(i){console.log("alterarDocumentoOperacao: ",i)}},async selecionarDocumentoOperacaoViaPrompt(i){if(!i)return this.$refs.promptDocumentoOperacao.placeholder="Selecione a opera\xE7\xE3o",this.$refs.promptDocumentoOperacao.mostrar({classificacaoDestinatario:this.classificacaoDestinatario}),new Promise((e,l)=>{this.resolve=e,this.reject=l});if(!i.id){this.reject("Opera\xE7\xE3o n\xE3o selecionada");return}this.resolve(i)},async selecionarContatoIndicacao(){const i=await this.selecionarContato({placeholder:"Selecione a indica\xE7\xE3o",filtro:{ativo:!0}});i.id&&(this.campos.idContatoIndicacao=i.id,this.atualizarDocumentoMetas())},removerIndicacao(){this.campos.idContatoIndicacao=null,this.atualizarDocumentoMetas()}},props:{enableChanges:{type:Boolean,required:!1,default:!1}}},ue={class:"layout-padding q-pa-none q-pb-md q-mt-md"},me={class:"u-container"},pe={class:"bg-white round-borders q-py-md q-my-md"},fe={class:"text-right"},he=c("br",null,null,-1),ve={class:"q-pa-md"},ge={class:"col-12 col-md"},be={class:"col-12 col-md-auto"},_e={class:"col-12 col-md"},Ce={class:"col-12 col-md-auto"},Oe={class:"q-pa-md"},Ee={key:0,class:"q-pa-lg text-center"},Ve=c("p",{class:"text-caption"},"Para incluir, utilize os bot\xF5es acima ou insira via QR Code.",-1),ye={class:"col-12 col-lg-4"},Me=c("span",{class:"text-body2"},"Paciente: ",-1),Ae={class:"col-12 col-lg-4"},De=c("span",{class:"text-body2"},"M\xE9dico: ",-1),Pe={class:"col-12 col-lg-2"},we=c("span",{class:"text-body2"},"Data: ",-1),Le={class:"col-12 col-lg-2"},ke=c("span",{class:"text-body2"},"Validade: ",-1),Ie={key:0,class:"col-12"},qe=c("strong",{class:"text-body2"},"Observa\xE7\xE3o:",-1),Te=c("div",{class:"col"},"Esf\xE9rico",-1),Ue=c("div",{class:"col"},"Cilindrico",-1),xe=c("div",{class:"col"},"Eixo",-1),Ne=c("div",{class:"col"},"DNP",-1),Fe={class:"col"},Se={class:"col"},Be={class:"col"},Qe={class:"col"},ze={class:"col"},Re={class:"col"},He={class:"col"},je={class:"col"},Ge=c("div",{class:"col"},"M\xE9dio",-1),Je=c("div",{class:"col"},"Perto",-1),Ke=c("div",{class:"col"},"Esf\xE9rico",-1),$e=c("div",{class:"col"},"DNP",-1),Xe=c("div",{class:"col"},"Esf\xE9rico",-1),We=c("div",{class:"col"},"DNP",-1),Ye={class:"col"},Ze={class:"col"},oa={class:"col"},ea={class:"col"},aa={class:"col"},ta={class:"col"},ia={class:"col"},la={class:"col"},ra={class:"q-pa-md"},sa={class:"q-pa-md"},na={key:0,class:"text-center"},ca=c("p",null,"N\xE3o h\xE1 itens no carrinho",-1),da=c("p",{class:"text-caption"},"Para adicionar, utilize os bot\xF5es acima ou insira o c\xF3digo de barras",-1),ua=[ca,da],ma={class:"col-12 col-md-auto"},pa={class:"col-12 col-md"},fa={class:"col-4 col-md"},ha={class:"col-4 col-md"},va={class:"col-4 col-md"},ga={class:"col-4 col-md"},ba={class:"q-col-gutter-sm row justify-end q-mt-sm"},_a={class:"col-12 col-md-4 offset-md-8"},Ca=c("div",{class:"col-4"},"Subtotal",-1),Oa={class:"col-8 text-right"},Ea=c("div",{class:"col-4",style:{"padding-top":"16px"}},"Desconto",-1),Va=c("div",{class:"col-4 q-mt-sm",style:{"padding-top":"8px"}},"Total",-1),ya={class:"col-8 q-mt-sm text-right",style:{"padding-top":"8px"}},Ma={class:"q-pa-md"},Aa={class:"col-12 col-md"},Da={class:"col-xs-6 col-md"},Pa={class:"col-xs-6 col-md"},wa={class:"col-12 col-md"},La={class:"col-12 col-md"},ka={class:"col-xs-6 col-md"},Ia={class:"col-xs-6 col-md"},qa={class:"q-pa-md"},Ta={class:"col-6 col-md"},Ua={class:"col-6 col-md"},xa={class:"col-6 col-md"},Na={class:"col-6 col-md"},Fa={class:"col-12 col-lg-3"},Sa={class:"col-12 col-lg-3"},Ba={class:"Fatura-faturamento round-borders q-pa-md"},Qa={class:"u-container"},za={class:"row justify-end"},Ra={class:"row justify-end"};function Ha(i,e,l,r,a,n){const p=V("avatar"),w=V("badge"),M=V("documento-codigo"),A=V("documento-metas"),g=V("campo"),O=V("row"),K=V("Arquivo"),oo=V("CodigoBarras"),eo=V("Tutorial"),ao=V("faturamento"),u=V("pupilometro"),Y=V("ContatoCriar"),uo=V("PromptItemV2"),mo=V("receita"),po=V("prompt-item-tabela-preco-novo"),fo=V("prompt-documento-operacao");return f(),$(co,null,[o(vo,{modelValue:a.visivel,"onUpdate:modelValue":e[37]||(e[37]=s=>a.visivel=s),persistent:"",maximized:"",onKeyup:ie(n.fechar,["esc"])},{default:t(()=>[o(Fo,{container:"",class:"bg-light"},{default:t(()=>[o(ee,null,{default:t(()=>[o(H,null,{default:t(()=>[G(o(y,{flat:"",round:"",dense:"",icon:"arrow_back"},null,512),[[J]]),o(j,null,{default:t(()=>[m("Envelope")]),_:1}),n.ehOrcamento?(f(),$("form",{key:0,onSubmit:e[0]||(e[0]=so((...s)=>n.salvarEnvelope&&n.salvarEnvelope(...s),["prevent"]))},[o(y,{class:"q-ml-sm no-shadow",color:"white","text-color":"primary",unelevated:"",label:"Salvar",type:"submit"})],32)):_("",!0)]),_:1})]),_:1}),o(ae,null,{default:t(()=>[c("div",ue,[c("div",me,[c("div",pe,[o(H,{class:"Venda-barra bg-transparent q-px-md",color:"black",dark:""},{default:t(()=>[o(p,{imagem:(a.contato||{}).imagem,rotulo:a.campos.descricaoContato,tamanho:"50"},null,8,["imagem","rotulo"]),o(j,{class:"text-tertiary"},{default:t(()=>[c("div",null,h(a.campos.descricaoContato),1),c("div",null,[o(w,{denso:""},{default:t(()=>[m(h(n.descricaoClassificacaoDestinatario),1)]),_:1})])]),_:1}),c("div",fe,[o(M,{documento:a.envelope.documento},null,8,["documento"]),he,n.ehOrcamento?(f(),v(y,{key:0,color:"tertiary",flat:"",icon:"more_vert",round:""},{default:t(()=>[o(Z,{modelValue:a.menuVenda,"onUpdate:modelValue":e[2]||(e[2]=s=>a.menuVenda=s)},{default:t(()=>[G((f(),v(X,{link:"",separator:""},{default:t(()=>[o(C,{clickable:"",onClick:n.alterarCliente},{default:t(()=>[o(d,{avatar:""},{default:t(()=>[o(b,{name:"how_to_reg"})]),_:1}),o(d,null,{default:t(()=>[o(P,null,{default:t(()=>[m("Alterar cliente")]),_:1})]),_:1})]),_:1},8,["onClick"]),o(C,{clickable:"",onClick:n.alterarVendedor},{default:t(()=>[o(d,{avatar:""},{default:t(()=>[o(b,{name:"how_to_reg"})]),_:1}),o(d,null,{default:t(()=>[o(P,null,{default:t(()=>[m("Alterar vendedor")]),_:1})]),_:1})]),_:1},8,["onClick"]),a.envelope.documentoItens.length?_("",!0):(f(),v(C,{key:0,clickable:"",onClick:n.alterarTabelaPreco},{default:t(()=>[o(d,{avatar:""},{default:t(()=>[o(b,{name:"attach_money"})]),_:1}),o(d,null,{default:t(()=>[o(P,null,{default:t(()=>[m("Alterar tabela de pre\xE7o")]),_:1})]),_:1})]),_:1},8,["onClick"])),a.envelope.documentoItens.length?_("",!0):(f(),v(C,{key:1,clickable:"",onClick:n.alterarDocumentoOperacao},{default:t(()=>[o(d,{avatar:""},{default:t(()=>[o(b,{name:"attach_money"})]),_:1}),o(d,null,{default:t(()=>[o(P,null,{default:t(()=>[m("Alterar Opera\xE7\xE3o")]),_:1})]),_:1})]),_:1},8,["onClick"])),a.envelope.documento.idContatoIndicacao?(f(),v(C,{key:2,clickable:"",onClick:e[1]||(e[1]=s=>n.removerIndicacao())},{default:t(()=>[o(d,{avatar:""},{default:t(()=>[o(b,{name:"how_to_reg"})]),_:1}),o(d,null,{default:t(()=>[o(P,null,{default:t(()=>[m("Remover indica\xE7\xE3o")]),_:1})]),_:1})]),_:1})):(f(),v(C,{key:3,clickable:"",onClick:n.selecionarContatoIndicacao},{default:t(()=>[o(d,{avatar:""},{default:t(()=>[o(b,{name:"how_to_reg"})]),_:1}),o(d,null,{default:t(()=>[o(P,null,{default:t(()=>[m("Selecionar indica\xE7\xE3o")]),_:1})]),_:1})]),_:1},8,["onClick"])),a.envelope.idContatoConvenio?(f(),v(C,{key:4,clickable:"",onClick:i.removerConvenio},{default:t(()=>[o(d,{avatar:""},{default:t(()=>[o(b,{name:"input"})]),_:1}),o(d,null,{default:t(()=>[o(P,null,{default:t(()=>[m("Remover conv\xEAnio")]),_:1})]),_:1})]),_:1},8,["onClick"])):(f(),v(C,{key:5,clickable:"",onClick:i.selecionarConvenio},{default:t(()=>[o(d,{avatar:""},{default:t(()=>[o(b,{name:"input"})]),_:1}),o(d,null,{default:t(()=>[o(P,null,{default:t(()=>[m("Alocar conv\xEAnio")]),_:1})]),_:1})]),_:1},8,["onClick"]))]),_:1})),[[J]])]),_:1},8,["modelValue"])]),_:1})):_("",!0)])]),_:1}),o(A,{ref:"documentoMetas"},null,512)]),o(W,{class:"q-mb-md bg-white no-shadow"},{default:t(()=>[o(H,{class:"text-tertiary"},{default:t(()=>[o(j,null,{default:t(()=>[m("Dados Principais")]),_:1})]),_:1}),c("div",ve,[o(O,{class:"items-center q-col-gutter-md"},{default:t(()=>[c("div",ge,[o(no,{modelValue:a.campos.descricaoContato,"onUpdate:modelValue":[e[3]||(e[3]=s=>a.campos.descricaoContato=s),n.selecionarPaciente],"use-input":"","hide-selected":"","fill-input":"","input-debounce":"500","stack-label":"",label:"Paciente",options:a.opcoesPacientes,onFilter:n.filtrarPacientes},{prepend:t(()=>[o(y,{color:"tertiary",size:"md",icon:"person_add",dense:"",flat:"",round:"",onClick:n.abrirModalDependente},{default:t(()=>[o(L,null,{default:t(()=>[m("Incluir paciente")]),_:1})]),_:1},8,["onClick"])]),"no-option":t(()=>[o(C,null,{default:t(()=>[o(d,{class:"text-grey"},{default:t(()=>[m(" Resultado n\xE3o encontrado ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter","onUpdate:modelValue"])]),c("div",be,[o(ho,{readonly:a.envelope.somenteLeitura,modelValue:a.tipoEnvelope,"onUpdate:modelValue":[e[4]||(e[4]=s=>a.tipoEnvelope=s),n.alterarTipoEnvelope],class:"q-mr-sm",label:"\xD3culos",val:"Oculos"},null,8,["readonly","modelValue","onUpdate:modelValue"]),o(ho,{readonly:a.envelope.somenteLeitura,modelValue:a.tipoEnvelope,"onUpdate:modelValue":[e[5]||(e[5]=s=>a.tipoEnvelope=s),n.alterarTipoEnvelope],label:"LDC",val:"Lentes"},{default:t(()=>[o(L,null,{default:t(()=>[m("Lentes de Contato")]),_:1})]),_:1},8,["readonly","modelValue","onUpdate:modelValue"])]),c("div",_e,[o(g,{modelValue:a.tipoLente,"onUpdate:modelValue":[e[6]||(e[6]=s=>a.tipoLente=s),n.alterarTipoLente],class:"col-12 col-lg-4",maxlength:"60",rotulo:"Tipo",tipo:"seletor",opcoes:a.tipoLentes,somenteLeitura:a.envelope.somenteLeitura},null,8,["modelValue","opcoes","somenteLeitura","onUpdate:modelValue"])]),c("div",Ce,[o(ho,{modelValue:a.tipoOculos,"onUpdate:modelValue":e[7]||(e[7]=s=>a.tipoOculos=s),class:"q-mr-sm",disable:a.envelope.somenteLeitura||a.tipoEnvelope!=="Oculos",label:"Vista",val:"Vista"},null,8,["modelValue","disable"]),o(ho,{modelValue:a.tipoOculos,"onUpdate:modelValue":e[8]||(e[8]=s=>a.tipoOculos=s),disable:a.envelope.somenteLeitura||a.tipoEnvelope!=="Oculos",label:"Solar",val:"Solar"},null,8,["modelValue","disable"])])]),_:1})])]),_:1}),o(W,{class:"q-mb-md no-shadow"},{default:t(()=>[o(H,null,{default:t(()=>[o(b,{name:"mdi-file-eye",size:"24px",class:"text-tertiary"}),o(j,{class:"text-tertiary"},{default:t(()=>[m(" Receita ")]),_:1}),a.envelope.somenteLeitura?_("",!0):(f(),v(y,{key:0,color:"primary",dense:"",flat:"",icon:"search",round:"",onClick:n.filtrarReceitas},{default:t(()=>[o(Z,null,{default:t(()=>[o(X,{separator:"",link:""},{default:t(()=>[(f(!0),$(co,null,go(a.receitasDescricao,s=>G((f(),v(C,{clickable:"",key:s.value,onClick:D=>n.atualizarReceita(s.value)},{default:t(()=>[o(d,{avatar:""},{default:t(()=>[o(b,{name:s.icon,color:s.color},null,8,["name","color"])]),_:2},1024),o(d,null,{default:t(()=>[o(P,null,{default:t(()=>[m(h(s.label),1)]),_:2},1024),o(P,{caption:""},{default:t(()=>[c("small",null,h(s.stamp),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[J]])),128))]),_:1})]),_:1}),o(L,null,{default:t(()=>[m("Selecionar receita")]),_:1})]),_:1},8,["onClick"])),a.envelope.somenteLeitura?_("",!0):(f(),v(y,{key:1,color:"primary",dense:"",flat:"",icon:"add",onClick:e[9]||(e[9]=s=>n.abrirModalReceita("",!1)),round:""},{default:t(()=>[o(L,null,{default:t(()=>[m("Adicionar")]),_:1})]),_:1})),a.envelope.somenteLeitura?_("",!0):(f(),v(y,{key:2,color:"tertiary",dense:"",flat:"",icon:"more_vert",round:""},{default:t(()=>[o(Z,null,{default:t(()=>[o(X,{link:"",separator:""},{default:t(()=>[a.receitasDescricao.length?G((f(),v(C,{key:0,clickable:"",onClick:e[10]||(e[10]=s=>n.abrirModalReceita(a.receita.id,!1))},{default:t(()=>[o(d,{avatar:""},{default:t(()=>[o(b,{name:"edit"})]),_:1}),o(d,null,{default:t(()=>[o(P,null,{default:t(()=>[m("Editar")]),_:1})]),_:1})]),_:1})),[[J]]):_("",!0),a.receitasDescricao.length?G((f(),v(C,{key:1,clickable:"",onClick:e[11]||(e[11]=s=>n.abrirModalReceita(a.receita.id,!0))},{default:t(()=>[o(d,{avatar:""},{default:t(()=>[o(b,{name:"file_copy"})]),_:1}),o(d,null,{default:t(()=>[o(P,null,{default:t(()=>[m("Duplicar")]),_:1})]),_:1})]),_:1})),[[J]]):_("",!0)]),_:1})]),_:1})]),_:1}))]),_:1}),c("div",Oe,[a.receitasDescricao.length?_("",!0):(f(),$("div",Ee,[c("p",null,"N\xE3o h\xE1 receitas para o paciente "+h(a.campos.descricaoContato)+".",1),Ve])),a.receitasDescricao.length?(f(),v(O,{key:1,class:"q-col-gutter-md"},{default:t(()=>[c("div",ye,[Me,c("strong",null,h((a.receita.paciente||{}).nome),1)]),c("div",Ae,[De,c("strong",null,h((a.receita.medico||{}).nome),1)]),c("div",Pe,[we,c("strong",null,h(i.$filters.data(a.receita.data)),1)]),c("div",Le,[ke,c("strong",null,h(i.$filters.data(a.receita.validade)),1)]),a.receita.observacoes?(f(),$("div",Ie,[qe,c("p",null,h(a.receita.observacoes),1)])):_("",!0)]),_:1})):_("",!0),a.receitasDescricao.length?(f(),v(O,{key:2,class:"q-col-gutter-md"},{default:t(()=>[o(X,{class:"col-12 col-lg-6",highlight:"","no-border":""},{default:t(()=>[o(C,{class:"q-px-none"},{default:t(()=>[o(d,{avatar:"",class:"mw100"}),o(d,{class:"text-subtitle1 text-weight-bold"},{default:t(()=>[m("Longe")]),_:1})]),_:1}),o(C,{class:"q-px-none"},{default:t(()=>[o(d,{avatar:"",class:"mw100"}),o(d,{class:"text-body2 text-weight-bold"},{default:t(()=>[o(O,null,{default:t(()=>[Te,Ue,xe,Ne]),_:1})]),_:1})]),_:1}),o(C,{class:"q-px-none"},{default:t(()=>[o(d,{avatar:"",class:"mw100"},{default:t(()=>[o(d,null,{default:t(()=>[m("OD")]),_:1})]),_:1}),o(d,null,{default:t(()=>[o(O,null,{default:t(()=>{var s,D,E,k,I,q,T,U,x,N,F,S,B,Q,z,R,to,io,lo,ro;return[c("div",Fe,h(i.$filters.numeroSinal((I=(k=(E=(D=(s=a.receita)==null?void 0:s.prescricao)==null?void 0:D.dioptria)==null?void 0:E.od)==null?void 0:k.longe)==null?void 0:I.esferico,2)),1),c("div",Se,h(i.$filters.numeroSinal((N=(x=(U=(T=(q=a.receita)==null?void 0:q.prescricao)==null?void 0:T.dioptria)==null?void 0:U.od)==null?void 0:x.longe)==null?void 0:N.cilindrico,2)),1),c("div",Be,h(i.$filters.numeroOuBranco((z=(Q=(B=(S=(F=a.receita)==null?void 0:F.prescricao)==null?void 0:S.dioptria)==null?void 0:B.od)==null?void 0:Q.longe)==null?void 0:z.eixo)),1),c("div",Qe,h(i.$filters.numeroOuBranco((ro=(lo=(io=(to=(R=a.receita)==null?void 0:R.prescricao)==null?void 0:to.dioptria)==null?void 0:io.od)==null?void 0:lo.longe)==null?void 0:ro.dnp,2)),1)]}),_:1})]),_:1})]),_:1}),o(C,{class:"q-px-none"},{default:t(()=>[o(d,{avatar:"",class:"mw100"},{default:t(()=>[o(d,null,{default:t(()=>[m("OE")]),_:1})]),_:1}),o(d,null,{default:t(()=>[o(O,null,{default:t(()=>{var s,D,E,k,I,q,T,U,x,N,F,S,B,Q,z,R;return[c("div",ze,h(i.$filters.numeroSinal((k=(E=(D=(s=a.receita.prescricao)==null?void 0:s.dioptria)==null?void 0:D.oe)==null?void 0:E.longe)==null?void 0:k.esferico,2)),1),c("div",Re,h(i.$filters.numeroSinal((U=(T=(q=(I=a.receita.prescricao)==null?void 0:I.dioptria)==null?void 0:q.oe)==null?void 0:T.longe)==null?void 0:U.cilindrico,2)),1),c("div",He,h(i.$filters.numeroOuBranco((S=(F=(N=(x=a.receita.prescricao)==null?void 0:x.dioptria)==null?void 0:N.oe)==null?void 0:F.longe)==null?void 0:S.eixo)),1),c("div",je,h(i.$filters.numeroOuBranco((R=(z=(Q=(B=a.receita.prescricao)==null?void 0:B.dioptria)==null?void 0:Q.oe)==null?void 0:z.longe)==null?void 0:R.dnp,2)),1)]}),_:1})]),_:1})]),_:1})]),_:1}),o(X,{class:"col-12 col-lg-6",highlight:"","no-border":""},{default:t(()=>[o(C,{class:"q-px-none"},{default:t(()=>[o(d,{avatar:"",class:"mw100"},{default:t(()=>[m("\xA0\xA0")]),_:1}),o(d,{class:"text-subtitle1 text-weight-bold"},{default:t(()=>[o(O,null,{default:t(()=>[Ge,Je]),_:1})]),_:1})]),_:1}),o(C,{class:"q-px-none"},{default:t(()=>[o(d,{avatar:"",class:"mw100"},{default:t(()=>[m("\xA0\xA0")]),_:1}),o(d,{class:"text-body2 text-weight-bold"},{default:t(()=>[o(O,null,{default:t(()=>[Ke,$e,Xe,We]),_:1})]),_:1})]),_:1}),o(C,null,{default:t(()=>[o(d,{avatar:"",class:"mw100"},{default:t(()=>[o(d,null,{default:t(()=>[m("OD")]),_:1})]),_:1}),o(d,null,{default:t(()=>[o(O,null,{default:t(()=>{var s,D,E,k,I,q,T,U,x,N,F,S,B,Q,z,R;return[c("div",Ye,h(i.$filters.numeroSinal((k=(E=(D=(s=a.receita.prescricao)==null?void 0:s.dioptria)==null?void 0:D.od)==null?void 0:E.medio)==null?void 0:k.esferico,2)),1),c("div",Ze,h(i.$filters.numeroOuBranco((U=(T=(q=(I=a.receita.prescricao)==null?void 0:I.dioptria)==null?void 0:q.od)==null?void 0:T.medio)==null?void 0:U.dnp,2)),1),c("div",oa,h(i.$filters.numeroSinal((S=(F=(N=(x=a.receita.prescricao)==null?void 0:x.dioptria)==null?void 0:N.od)==null?void 0:F.perto)==null?void 0:S.esferico,2)),1),c("div",ea,h(i.$filters.numeroOuBranco((R=(z=(Q=(B=a.receita.prescricao)==null?void 0:B.dioptria)==null?void 0:Q.od)==null?void 0:z.perto)==null?void 0:R.dnp,2)),1)]}),_:1})]),_:1})]),_:1}),o(C,null,{default:t(()=>[o(d,{avatar:"",class:"mw100"},{default:t(()=>[o(d,null,{default:t(()=>[m("OE")]),_:1})]),_:1}),o(d,null,{default:t(()=>[o(O,null,{default:t(()=>{var s,D,E,k,I,q,T,U,x,N,F,S,B,Q,z,R;return[c("div",aa,h(i.$filters.numeroSinal((k=(E=(D=(s=a.receita.prescricao)==null?void 0:s.dioptria)==null?void 0:D.oe)==null?void 0:E.medio)==null?void 0:k.esferico,2)),1),c("div",ta,h(i.$filters.numeroOuBranco((U=(T=(q=(I=a.receita.prescricao)==null?void 0:I.dioptria)==null?void 0:q.oe)==null?void 0:T.medio)==null?void 0:U.dnp,2)),1),c("div",ia,h(i.$filters.numeroSinal((S=(F=(N=(x=a.receita.prescricao)==null?void 0:x.dioptria)==null?void 0:N.oe)==null?void 0:F.perto)==null?void 0:S.esferico,2)),1),c("div",la,h(i.$filters.numeroOuBranco((R=(z=(Q=(B=a.receita.prescricao)==null?void 0:B.dioptria)==null?void 0:Q.oe)==null?void 0:z.perto)==null?void 0:R.dnp,2)),1)]}),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):_("",!0)])]),_:1}),o(W,{class:"bg-white q-mb-md no-shadow"},{default:t(()=>[o(H,{class:"text-tertiary"},{default:t(()=>[o(b,{name:"image",size:"24px"}),o(j,null,{default:t(()=>[m("Arquivos")]),_:1})]),_:1}),c("div",ra,[o(K,{ref:"arquivo",enableChanges:l.enableChanges,arquivo:a.envelope.arquivo,idTabelaMaster:a.envelope.id},null,8,["enableChanges","arquivo","idTabelaMaster"])])]),_:1}),o(W,{class:"q-mb-md bg-white no-shadow"},{default:t(()=>[o(H,null,{default:t(()=>[o(b,{name:"mdi-glasses",size:"24px",class:"text-tertiary"}),o(j,{class:"text-tertiary"},{default:t(()=>[m(" Carrinho ")]),_:1}),o(y,{class:"hideondesktop",color:"primary",dense:"",flat:"",icon:"add",round:""},{default:t(()=>[o(Z,null,{default:t(()=>[o(X,{link:"",separator:""},{default:t(()=>[!a.envelope.somenteLeitura&&a.tipoEnvelope==="Lentes"?G((f(),v(C,{key:0,clickable:"",onClick:e[12]||(e[12]=s=>n.abrirModalItem("LentesContato"))},{default:t(()=>[o(d,{avatar:""},{default:t(()=>[o(b,{name:"add"})]),_:1}),o(d,null,{default:t(()=>[o(P,null,{default:t(()=>[m("Lentes de Contato")]),_:1})]),_:1})]),_:1})),[[J]]):_("",!0),!a.envelope.somenteLeitura&&a.tipoEnvelope==="Oculos"&&["Vista","Solar"].includes(a.tipoOculos)?G((f(),v(C,{key:1,clickable:"",onClick:e[13]||(e[13]=s=>n.abrirModalItem("Lentes"))},{default:t(()=>[o(d,{avatar:""},{default:t(()=>[o(b,{name:"add"})]),_:1}),o(d,null,{default:t(()=>[o(P,null,{default:t(()=>[m("Lentes")]),_:1})]),_:1})]),_:1})),[[J]]):_("",!0),!a.envelope.somenteLeitura&&a.tipoEnvelope==="Oculos"&&["Vista","Solar"].includes(a.tipoOculos)?G((f(),v(C,{key:2,clickable:"",onClick:e[14]||(e[14]=s=>n.abrirModalItem("Armacao"))},{default:t(()=>[o(d,{avatar:""},{default:t(()=>[o(b,{name:"add"})]),_:1}),o(d,null,{default:t(()=>[o(P,null,{default:t(()=>[m("Arma\xE7\xE3o")]),_:1})]),_:1})]),_:1})),[[J]]):_("",!0)]),_:1})]),_:1})]),_:1}),!a.envelope.somenteLeitura&&a.tipoEnvelope==="Lentes"?(f(),v(y,{key:0,color:"primary",flat:"",icon:"add",class:"hideonmobile",label:"Lentes de Contato",onClick:e[15]||(e[15]=s=>n.abrirModalItem("LentesContato"))})):_("",!0),!a.envelope.somenteLeitura&&a.tipoEnvelope==="Oculos"&&["Vista","Solar"].includes(a.tipoOculos)?(f(),v(y,{key:1,class:"hideonmobile",color:"primary",flat:"",icon:"add",label:"Lentes",onClick:e[16]||(e[16]=s=>n.abrirModalItem("Lentes"))})):_("",!0),!a.envelope.somenteLeitura&&a.tipoEnvelope==="Oculos"&&["Vista","Solar"].includes(a.tipoOculos)?(f(),v(y,{key:2,class:"hideonmobile",color:"primary",flat:"",icon:"add",label:"Arma\xE7\xE3o",onClick:e[17]||(e[17]=s=>n.abrirModalItem("Armacao"))})):_("",!0),!a.envelope.somenteLeitura&&(a.tipoEnvelope==="Lentes"||a.tipoEnvelope==="Oculos"&&["Vista","Solar"].includes(a.tipoOculos))?(f(),v(oo,{key:3,itemFiltros:{ativo:!0,bloquearVenda:!1,idEmpresa:a.campos.idEmpresa,idItemTabelaPreco:a.campos.idItemTabelaPreco},documentoItens:a.carrinho,onAdicionar:n.adicionarItem,onAtualizar:n.selecionarItens},null,8,["itemFiltros","documentoItens","onAdicionar","onAtualizar"])):_("",!0)]),_:1}),c("div",sa,[a.carrinho.length?(f(!0),$(co,{key:1},go(n.carrinhoSemArmacaoVazia,(s,D)=>(f(),v(O,{class:"items-start q-col-gutter-md",key:D},{default:t(()=>[c("div",ma,[o(p,{imagem:(a.itens[s.idItem]||{}).imagem||"",rotulo:s.descricaoItem,tamanho:"120"},null,8,["imagem","rotulo"])]),c("div",pa,[o(H,{class:"Venda-itemBarra bg-transparent q-pa-none",color:"black",dark:""},{default:t(()=>[o(j,{class:"q-pl-none"},{default:t(()=>[m(h(s.descricaoItem),1),c("span",null,h((a.itens[s.idItem]||{}).marca||""),1)]),_:2},1024),o(w,{class:"q-mr-sm"},{default:t(()=>[m(h(s.tipoItem)+" "+h((a.itens[s.idItem]||{}).referencia||""),1)]),_:2},1024),a.envelope.somenteLeitura?_("",!0):(f(),v(y,{key:0,color:"tertiary",dense:"",flat:"",icon:"delete",round:"",onClick:E=>n.removerItem(D)},null,8,["onClick"]))]),_:2},1024),o(O,{class:"q-col-gutter-sm"},{default:t(()=>[c("div",fa,[o(g,{somenteLeitura:a.envelope.somenteLeitura,modelValue:s.valorItem,"onUpdate:modelValue":E=>s.valorItem=E,dense:"",outlined:"","rotulo-fixo":"Valor",onBlur:E=>n.calculaTotalItem(D,"valorItem"),tipo:"decimal",decimals:"2"},null,8,["somenteLeitura","modelValue","onUpdate:modelValue","onBlur"])]),c("div",ha,[o(O,{class:"items-center"},{default:t(()=>[o(b,{name:"mdi-minus",color:"primary"}),o(g,{somenteLeitura:a.envelope.somenteLeitura,modelValue:s.descontoPercentualItem,"onUpdate:modelValue":E=>s.descontoPercentualItem=E,dense:"",outlined:"",opcoes:{maximumValue:100},"rotulo-fixo":"Desconto",tipo:"decimal",decimals:"2",suffix:"%",onBlur:E=>n.calculaTotalItem(D,"descontoPercentualItem")},null,8,["somenteLeitura","modelValue","onUpdate:modelValue","onBlur"])]),_:2},1024)]),c("div",va,[o(g,{somenteLeitura:a.envelope.somenteLeitura,modelValue:s.descontoItem,"onUpdate:modelValue":E=>s.descontoItem=E,dense:"",outlined:"",opcoes:{minimumValue:0},"rotulo-fixo":"Desconto",onBlur:E=>n.calculaTotalItem(D,"descontoItem"),tipo:"decimal",decimals:"2"},null,8,["somenteLeitura","modelValue","onUpdate:modelValue","onBlur"])]),c("div",ga,[o(O,{class:"items-center"},{default:t(()=>[o(b,{name:"mdi-equal",color:"primary",class:"hideonmobile"}),o(g,{modelValue:s.total,"onUpdate:modelValue":E=>s.total=E,dense:"",outlined:"","somente-leitura":"","rotulo-fixo":"Total",tipo:"decimal",decimals:"2"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)])]),_:2},1024),c("div",ba,[!a.envelope.somenteLeitura&&s.tipoItem==="LOE"?(f(),v(y,{key:0,color:"primary",flat:"",icon:"add",label:"Tratamento LOE",onClick:E=>n.abrirModalItem("Tratamento LOE",s.id)},null,8,["onClick"])):_("",!0),!a.envelope.somenteLeitura&&s.tipoItem==="LOD"?(f(),v(y,{key:1,color:"primary",flat:"",icon:"add",label:"Tratamento LOD",onClick:E=>n.abrirModalItem("Tratamento LOD",s.id)},null,8,["onClick"])):_("",!0)])])]),_:2},1024))),128)):(f(),$("div",na,ua)),a.carrinho.length?(f(),v(O,{key:2,class:"q-col-gutter-md q-mt-md"},{default:t(()=>[c("div",_a,[o(O,{class:"q-col-gutter-md"},{default:t(()=>[Ca,c("strong",Oa,h(i.$filters.numero(a.campos.subTotal,2)),1),Ea,o(g,{"somente-leitura":a.envelope.somenteLeitura,modelValue:a.campos.totalPercentualDesconto,"onUpdate:modelValue":e[18]||(e[18]=s=>a.campos.totalPercentualDesconto=s),class:"col-3",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",suffix:"%",onBlur:e[19]||(e[19]=s=>n.calculaTotal("descontoPercentual"))},null,8,["somente-leitura","modelValue"]),o(g,{"somente-leitura":a.envelope.somenteLeitura,modelValue:a.campos.totalDesconto,"onUpdate:modelValue":e[20]||(e[20]=s=>a.campos.totalDesconto=s),class:"col-5",opcoes:{minimumValue:0},onBlur:e[21]||(e[21]=s=>n.calculaTotal("desconto")),tipo:"decimal",decimals:"2"},null,8,["somente-leitura","modelValue"]),Va,c("strong",ya,h(i.$filters.numero(a.campos.totalDocumento,2)),1)]),_:1})])]),_:1})):_("",!0)])]),_:1}),(f(),v(W,{key:0,class:"q-mb-md bg-white no-shadow"},{default:t(()=>[c("div",Ma,[o(O,{class:"q-col-gutter-md"},{default:t(()=>[c("div",Aa,[o(O,{class:"q-px-none q-mx-none"},{default:t(()=>[a.permissaoPupilometro&&this.tipoPupilometro?(f(),v(y,{key:0,label:"Pupil\xF4metro",icon:"mdi-eye-settings-outline",unelevated:"",color:"primary",onClick:e[22]||(e[22]=s=>n.abrirModalPupilometro(this.tipoPupilometro))})):_("",!0),a.permissaoPupilometro&&!this.tipoPupilometro?(f(),v(y,{key:1,label:"Pupil\xF4metro",icon:"mdi-eye-settings-outline",unelevated:"",color:"primary"},{default:t(()=>[o(Z,null,{default:t(()=>[o(X,{link:"","no-border":"",separator:""},{default:t(()=>[G((f(),v(C,{clickable:"",onClick:e[23]||(e[23]=s=>n.abrirModalPupilometro("Presencial"))},{default:t(()=>[o(d,{avatar:""},{default:t(()=>[o(b,{name:"add"})]),_:1}),o(d,null,{default:t(()=>[o(P,null,{default:t(()=>[m("Pupil\xF4metro (Arma\xE7\xE3o)")]),_:1})]),_:1})]),_:1})),[[J]]),G((f(),v(C,{clickable:"",onClick:e[24]||(e[24]=s=>n.abrirModalPupilometro("Cart\xE3o"))},{default:t(()=>[o(d,{avatar:""},{default:t(()=>[o(b,{name:"add"})]),_:1}),o(d,null,{default:t(()=>[o(P,null,{default:t(()=>[m("Pupil\xF4metro (Cart\xE3o)")]),_:1})]),_:1})]),_:1})),[[J]])]),_:1})]),_:1})]),_:1})):_("",!0),o(eo,{componente:"Envelope"})]),_:1})]),c("div",Da,[o(g,{"somente-leitura":a.envelope.somenteLeitura,modelValue:a.armacao.alturaMontagemOD,"onUpdate:modelValue":e[25]||(e[25]=s=>a.armacao.alturaMontagemOD=s),rotulo:"Alt. Mont. OD",tipo:"decimal",decimals:"2",permiteNull:""},null,8,["somente-leitura","modelValue"])]),c("div",Pa,[o(g,{"somente-leitura":a.envelope.somenteLeitura,modelValue:a.armacao.alturaMontagemOE,"onUpdate:modelValue":e[26]||(e[26]=s=>a.armacao.alturaMontagemOE=s),rotulo:"Alt. Mont. OE",tipo:"decimal",decimals:"2",permiteNull:""},null,8,["somente-leitura","modelValue"])]),c("div",wa,[o(no,{dense:"",rounded:"",modelValue:a.descricaoLaboratorio,"onUpdate:modelValue":e[27]||(e[27]=s=>a.descricaoLaboratorio=s),label:"Laborat\xF3rio",options:["a","b"],onFilter:n.selecionarLaboratorio,class:"col-12 col-sm-4"},{append:t(()=>[a.descricaoLaboratorio!==""?(f(),v(b,{key:0,name:"close",onClick:so(n.laboratorioLimpar,["stop"]),class:"cursor-pointer"},null,8,["onClick"])):_("",!0),o(b,{name:"search",onClick:so(n.selecionarLaboratorio,["stop"]),class:"cursor-pointer"},null,8,["onClick"])]),_:1},8,["modelValue","onFilter"])]),c("div",La,[o(no,{dense:"",rounded:"",modelValue:a.descricaoResponsavel,"onUpdate:modelValue":e[28]||(e[28]=s=>a.descricaoResponsavel=s),label:"Respons\xE1vel",options:["a","b"],onFilter:n.selecionarResponsavel,class:"col-12 col-sm-4"},{append:t(()=>[a.descricaoResponsavel!==""?(f(),v(b,{key:0,name:"close",onClick:so(n.responsavelLimpar,["stop"]),class:"cursor-pointer"},null,8,["onClick"])):_("",!0),o(b,{name:"search",onClick:so(n.selecionarResponsavel,["stop"]),class:"cursor-pointer"},null,8,["onClick"])]),_:1},8,["modelValue","onFilter"])]),c("div",ka,[o(g,{modelValue:a.dataPrevisaoEntrega,"onUpdate:modelValue":[e[29]||(e[29]=s=>a.dataPrevisaoEntrega=s),n.ajustarDataHoraPrevisaoEntrega],rotulo:"Data Previs\xE3o de Entrega",maxlength:"10",tipo:"data",error:!!n.erroDataHoraPrevisto,errorMessage:n.erroDataHoraPrevisto},null,8,["modelValue","error","errorMessage","onUpdate:modelValue"])]),c("div",Ia,[o(g,{modelValue:a.horaPrevisaoEntrega,"onUpdate:modelValue":[e[30]||(e[30]=s=>a.horaPrevisaoEntrega=s),n.ajustarDataHoraPrevisaoEntrega],rotulo:"Hora Previs\xE3o de Entrega",maxlength:"4",tipo:"hora"},null,8,["modelValue","onUpdate:modelValue"])])]),_:1})])]),_:1})),(f(),v(W,{key:1,class:"q-mb-md bg-white no-shadow"},{default:t(()=>[c("div",qa,[o(O,{class:"q-col-gutter-md"},{default:t(()=>[c("div",Ta,[o(g,{"somente-leitura":a.envelope.somenteLeitura,modelValue:a.armacao.diagonal,"onUpdate:modelValue":e[31]||(e[31]=s=>a.armacao.diagonal=s),tipo:"decimal",decimals:"2",rotulo:"Diagonal",permiteNull:""},null,8,["somente-leitura","modelValue"])]),c("div",Ua,[o(g,{"somente-leitura":a.envelope.somenteLeitura,modelValue:a.armacao.ponte,"onUpdate:modelValue":e[32]||(e[32]=s=>a.armacao.ponte=s),tipo:"decimal",decimals:"2",rotulo:"Ponte",permiteNull:""},null,8,["somente-leitura","modelValue"])]),c("div",xa,[o(g,{"somente-leitura":a.envelope.somenteLeitura,modelValue:a.armacao.altura,"onUpdate:modelValue":e[33]||(e[33]=s=>a.armacao.altura=s),tipo:"decimal",decimals:"2",rotulo:"Altura Vertical",permiteNull:""},null,8,["somente-leitura","modelValue"])]),c("div",Na,[o(g,{"somente-leitura":a.envelope.somenteLeitura,modelValue:a.armacao.largura,"onUpdate:modelValue":e[34]||(e[34]=s=>a.armacao.largura=s),rotulo:"Largura",tipo:"decimal",decimals:"2",permiteNull:""},null,8,["somente-leitura","modelValue"])]),c("div",Fa,[o(g,{"somente-leitura":a.envelope.somenteLeitura,modelValue:a.armacao.armacaoMaterial,"onUpdate:modelValue":e[35]||(e[35]=s=>a.armacao.armacaoMaterial=s),after:[{icon:"add_circle",handler(){n.abrirArmacaoMaterialModal()}}],opcoes:a.opcoesArmacaoMaterial,"rotulo-fixo":"Material",tipo:"seletor"},null,8,["somente-leitura","modelValue","after","opcoes"])]),c("div",Sa,[o(g,{"somente-leitura":a.envelope.somenteLeitura,modelValue:a.armacao.tipoMontagem,"onUpdate:modelValue":e[36]||(e[36]=s=>a.armacao.tipoMontagem=s),after:[{icon:"add_circle",handler(){n.abrirTipoMontagemModal()}}],opcoes:a.opcoesTipoMontagem,"rotulo-fixo":"Tipo Montagem",tipo:"seletor"},null,8,["somente-leitura","modelValue","after","opcoes"])])]),_:1})])]),_:1})),c("div",Ba,[o(ao,{documento:a.campos,ref:"faturamento"},null,8,["documento"])])])])]),_:1}),o(te,{bordered:"",class:"bg-light"},{default:t(()=>[c("div",Qa,[o(H,{class:"bg-light"},{default:t(()=>[o(j,{class:"text-right"},{default:t(()=>[o(y,{class:"q-mx-md",color:"negative",flat:"",label:"N\xE3o aprovado"}),o(y,{color:"primary",label:"Finalizar",unelevated:""})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue","onKeyup"]),o(vo,{modelValue:a.armacaoMaterialModal,"onUpdate:modelValue":e[40]||(e[40]=s=>a.armacaoMaterialModal=s)},{default:t(()=>[o(W,null,{default:t(()=>[o(H,null,{default:t(()=>[o(j,null,{default:t(()=>[m("Cadastrar Material")]),_:1})]),_:1}),o(So,null,{default:t(()=>[o(g,{modelValue:a.armacaoMaterialDescricao,"onUpdate:modelValue":e[38]||(e[38]=s=>a.armacaoMaterialDescricao=s),modelModifiers:{trim:!0},class:"row",maxlength:"60",rotulo:"Material"},null,8,["modelValue"])]),_:1}),o(H,null,{default:t(()=>[o(j,null,{default:t(()=>[c("div",za,[o(y,{flat:"",color:"tertiary",onClick:e[39]||(e[39]=s=>a.armacaoMaterialModal=!1),label:"Cancelar"}),o(y,{unelevated:"",color:"primary",onClick:n.criarArmacaoMaterial,label:"Criar"},null,8,["onClick"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(vo,{modelValue:a.tipoMontagemModal,"onUpdate:modelValue":e[43]||(e[43]=s=>a.tipoMontagemModal=s)},{default:t(()=>[o(W,null,{default:t(()=>[o(H,null,{default:t(()=>[o(j,null,{default:t(()=>[m("Cadastrar Tipo Montagem")]),_:1})]),_:1}),o(So,null,{default:t(()=>[o(g,{modelValue:a.tipoMontagemDescricao,"onUpdate:modelValue":e[41]||(e[41]=s=>a.tipoMontagemDescricao=s),modelModifiers:{trim:!0},class:"row",maxlength:"60",rotulo:"Tipo Montagem"},null,8,["modelValue"])]),_:1}),o(H,null,{default:t(()=>[o(j,null,{default:t(()=>[c("div",Ra,[o(y,{flat:"",color:"tertiary",onClick:e[42]||(e[42]=s=>a.tipoMontagemModal=!1),label:"Cancelar"}),o(y,{unelevated:"",color:"primary",onClick:n.criarTipoMontagem,label:"Criar"},null,8,["onClick"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(vo,{modelValue:a.modalPupilometro.visivel,"onUpdate:modelValue":e[45]||(e[45]=s=>a.modalPupilometro.visivel=s),maximized:"",onHide:e[46]||(e[46]=s=>n.fecharModalPupilometro())},{default:t(()=>[o(Fo,{class:"bg-light"},{default:t(()=>[o(u,{ref:"pupilometro",avancar:a.modalPupilometro.avancar,somenteLeitura:a.envelope.somenteLeitura,onFecharModal:e[44]||(e[44]=s=>n.fecharModalPupilometro())},null,8,["avancar","somenteLeitura"])]),_:1})]),_:1},8,["modelValue"]),o(Y,{ref:"modalDependente","cpf-cnpj":"","data-nascimento":"","msg-erro":"Ocorreu um erro ao incluir o paciente.","msg-sucesso":"Paciente inclu\xEDdo com sucesso.",titulo:"Incluir Paciente",observacao:""},null,512),o(uo,{modelValue:a.modalItem.visivel,"onUpdate:modelValue":e[51]||(e[51]=s=>a.modalItem.visivel=s),filtro:a.modalItem.filtros,filtroAvancado:a.filtroAvancado,onSelecionarItens:n.selecionarItens,onLimparFiltroAvancado:n.limparFiltroAvancado},le({_:2},[a.filtroAvancado?{name:"camposFiltroAvancado",fn:t(()=>[o(g,{modelValue:a.filtroAvancado.lenteTipo,"onUpdate:modelValue":e[47]||(e[47]=s=>a.filtroAvancado.lenteTipo=s),class:"col-12 col-lg-4",maxlength:"60",rotulo:"Tipo",tipo:"seletor",opcoes:a.filtroAvancado.opcoesTiposLente},null,8,["modelValue","opcoes"]),o(g,{modelValue:a.filtroAvancado.esfericoInicial.lte,"onUpdate:modelValue":e[48]||(e[48]=s=>a.filtroAvancado.esfericoInicial.lte=s),prefix:"<=",rotulo:"Esf\xE9rico Inicial",tipo:"decimal",decimals:"2",dense:""},null,8,["modelValue"]),o(g,{modelValue:a.filtroAvancado.esfericoFinal.gte,"onUpdate:modelValue":e[49]||(e[49]=s=>a.filtroAvancado.esfericoFinal.gte=s),prefix:">=",rotulo:"Esf\xE9rico Final",tipo:"decimal",decimals:"2",dense:""},null,8,["modelValue"]),o(g,{modelValue:a.filtroAvancado.cilindrico.lte,"onUpdate:modelValue":e[50]||(e[50]=s=>a.filtroAvancado.cilindrico.lte=s),prefix:"<=",rotulo:"Cil\xEDndrico",tipo:"decimal",decimals:"2",dense:""},null,8,["modelValue"])]),key:"0"}:void 0]),1032,["modelValue","filtro","filtroAvancado","onSelecionarItens","onLimparFiltroAvancado"]),o(mo,{ref:"modalReceita",onAtualizar:n.atualizarReceita},null,8,["onAtualizar"]),o(po,{ref:"promptItemTabelaPreco",onSelecionar:n.selecionarItemTabelaPreco},null,8,["onSelecionar"]),o(fo,{ref:"promptDocumentoOperacao",onSelecionar:n.selecionarDocumentoOperacaoViaPrompt},null,8,["onSelecionar"]),o(re,{color:"primary",size:"50px",visible:a.exibirCarregando},null,8,["visible"])],64)}var ja=Bo(de,[["render",Ha]]);const Ga={components:{lista:ce,avatar:Qo,Envelope:ja,PromptItemTabelaPrecoNovo:zo},data(){return{envelopes:[],contatos:{},responsaveis:{},envelope:{},envelopeOriginal:{},arquivo:[],arquivoOriginal:[],itensEnvelope:[],itensEnvelopeOriginal:[],carrinho:[],carrinhoOriginal:[],ehOrcamento:!1,empresaOpcoes:[],showFilters:!1,filtros:{termoBusca:null,frase:null,numeroEnvelope:null,prazoSelecionado:null,empresaSelecionada:null,status:null,dataHoraEmissao:{ini:null,fim:null},dataHoraPrevisto:{ini:null,fim:null},dataHoraFinalizado:{ini:null,fim:null}},prazoOpcoes:[{label:"Entrega para pr\xF3ximas semanas",value:"adiantadoEntrega"},{label:"Entrega para esta semana",value:"proximaEntrega"},{label:"Entrega atrasada",value:"atrasadoEntrega"}],tabSelecionada:{valor:"Todos"},tabs:[{rotulo:"Todos",value:"Todos"},{rotulo:"Or\xE7amento",value:"Or\xE7amento"},{rotulo:"Processando",value:"Processando"},{rotulo:"Translado Loja para Pedido",value:"Translado Loja para Pedido"},{rotulo:"Translado Pedido para Loja",value:"Translado Pedido para Loja"},{rotulo:"Aguardando Retorno",value:"Aguardando Retorno"},{rotulo:"Processando Montagem",value:"Processando Montagem"},{rotulo:"Pronto para Entrega",value:"Pronto para Entrega"},{rotulo:"Cliente Informado",value:"Cliente Informado"},{rotulo:"Entregues",value:"Entregue"}],buscaCampo:"",paginacao:{atual:1,maximo:1,total:1,limite:25,ordenacao:["descricaoConcatenada"]}}},methods:{async atualizar(){$q.loading.show();try{const i=$utils.eliminarVazios(this.filtros);i.status=this.tabSelecionada.valor,this.buscaCampo&&(i.termoBusca=this.buscaCampo);const e=await $db.envelope.ler({filtros:i,termoBusca:this.termoBusca,limit:this.paginacao.limite,page:this.paginacao.atual,sort:["dataHoraEmissao","dataHoraFinalizado"],dir:["desc","desc"]});this.envelopes=e.data,this.paginacao.total=e.total,this.paginacao.maximo=e.totalPages;for(const l of this.envelopes){const r=l.idContato,a=l.idContatoResponsavel;this.contatos[r]||(this.contatos[r]=await $db.contato.le({id:r})),this.responsaveis[a]||(this.responsaveis[a]=await $db.contato.le({id:a}))}}catch{}finally{$q.loading.hide()}},async empresaOpcoesCarregar(){const i=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;this.empresaOpcoes=i.map(e=>({label:e.nome,value:e.codigoContato,id:e.id}))},async selecionarEmpresa(){const i=await $erp().empresa.toArray();let e;if(!i.filter(r=>r.ativo).length)throw new Error("Empresa n\xE3o encontrada");if(i.filter(r=>r.ativo).length===1)return i.find(r=>r.ativo);const l=await $g.promptContato.show({filtro:{ativo:!0,empresas:!0},placeholder:"Selecione a empresa"});if((l||{}).id&&(e=(await $db.empresa.le({idContato:l.id})).find(a=>a.id)),!e)throw new Error("Empresa n\xE3o selecionada");return e},async selecionarContato(i){const{placeholder:e,filtro:l}={placeholder:"Selecione o contato",filtro:{ativo:!0},...i},r=await $g.promptContato.show({filtro:l,placeholder:e});if(!r)throw new Error("Contato n\xE3o selecionado");return r},async obterContatoUsuario(){const i=JSON.parse(localStorage.getItem("usuario"))||{};let e={};return i.codigoUsuario&&(e=(await $erp().contato.where({codigoUsuario:i.codigoUsuario}).toArray()).find(l=>l.id)||{}),e},async obterContatoVendedor(i){const l=((await $erp().configuracoes.where({nome:"vendas.usaCarteira"}).toArray())[0]||{}).valor==="1",r=(i||{}).idContatoVendedor;if(r&&l){const p=await $erp().contato.get(r)||{};if(p.id)return p}const a=JSON.parse(localStorage.getItem("usuario"))||{};let n=(await $db.contato.ler({filtros:{ativo:!0,vendedores:!0}})).data;if(n.length===1)return n[0];for(const p of n){if(!(p||{}).numeroDocumentoNacional)continue;const w=(p.numeroDocumentoNacional||"").replace(/\D/g,""),M=(a.numeroDocumentoNacional||"").replace(/\D/g,"");if(w===M)return p}return this.selecionarContato({placeholder:"Selecione o respons\xE1vel",filtro:{ativo:!0,vendedores:!0}})},async selecionarItemTabelaPreco(i,e){if(!i)return this.$refs.promptItemTabelaPreco.placeholder="Selecione a tabela de pre\xE7o",this.$refs.promptItemTabelaPreco.filtro={tabelaMaster:!0,idContatoEmpresa:e},this.$refs.promptItemTabelaPreco.mostrar(),new Promise((l,r)=>{this.resolve=l,this.reject=r});i.id||this.reject("Tabela de pre\xE7o n\xE3o selecionada"),this.resolve(i)},async abrirModalEnvelope(i=null){var e;$q.loading.show();try{if(i){let l=[];i.documentoContato=[];let r=await $db.hibrido.lista({table:"documentoContato",where:{idDocumento:i.id}});r=r.find(n=>n.descricao==="Laborat\xF3rio"),r&&i.documentoContato.push(r),this.arquivo=[],this.arquivoOriginal=await $db.arquivo.lista({tipoArquivo:"-",idTabelaMaster:i.id}),this.arquivo=$utils.clonarV2(this.arquivoOriginal),i.arquivoOriginal=this.arquivoOriginal,i.arquivo=this.arquivo,this.itensEnvelopeOriginal=[],this.itensEnvelopeOriginal=[...this.itensEnvelopeOriginal,...await $db.hibrido.lista({table:"documentoItem",where:{idDocumentoAdicional:i.id}})],this.itensEnvelope=$utils.clonarV2(this.itensEnvelopeOriginal);const a=this.itensEnvelope.filter(n=>n.idDocumentoAdicional===i.id);i.status==="Or\xE7amento"?this.ehOrcamento=!0:this.ehOrcamento=!1,this.envelope={documento:i,documentoContato:i.documentoContato,documentoItens:a,somenteLeitura:!this.ehOrcamento,arquivo:i.arquivo},this.envelopeOriginal=$utils.clonarV2(this.envelope)}else{const l=await this.selecionarEmpresa(),r=await this.selecionarContato({placeholder:"Selecione o cliente",filtro:{ativo:!0}}),a=await this.obterContatoVendedor(r),n=await this.obterContatoUsuario();let p="";if(r.idItemTabelaPreco){const M=await $db.itemTabelaPreco.le({id:r.idItemTabelaPreco});(M==null?void 0:M.id)&&(!M.idEmpresa||M.idEmpresa===l.idContato)&&(p=r.idItemTabelaPreco)}if(!p){const M=await $db.configuracoes.le({nome:"vendas.tabelapadrao"});let A,g;A=M.find(O=>O.idEmpresa===l.idContato),g=Number(A==null?void 0:A.valor),g||(A=M.find(O=>!O.idEmpresa),g=Number(A==null?void 0:A.valor)),g&&(p=(e=(await $erp().itemTabelaPreco.filter(K=>Number(K.codigoItemTabelaPreco)===g).toArray())[0])==null?void 0:e.id)}if(!p){const M=await $erp().itemTabelaPreco.filter(A=>A.tabelaMaster===1&&!A.idEmpresa===l.idContato).toArray();if(M.length===1)p=M[0].id;else if(M.lenght!==1)try{p=(await this.selecionarItemTabelaPreco(null,l.idContato)).id}catch(A){$q.notifyError(A)}}let w={id:$utils.uuid(),tipo:"Envelope",documentoId:null,documentoTipo:"Venda",status:"Or\xE7amento",dataHoraEmissao:$utils.dataAtual(),idEmpresa:l.idContato,idItemTabelaPreco:p,descricaoEmpresa:l.nome,idContato:r.id,descricaoContato:r.nome,idContatoVendedor:a.id,idContatoResponsavel:a.id,idContatoDigitador:n.id,idContatoIndicacao:null,operacao:"Normal",codigoDocumentoOperacao:1};this.envelope={documento:w,documentoContato:[],documentoItens:[],somenteLeitura:!1,arquivo:[]},this.envelopeOriginal={},this.itensEnvelopeOriginal=[]}this.$refs.modalEnvelope.envelope=$utils.clonarV2(this.envelope),this.$refs.modalEnvelope.envelope.documento.tipo="Venda",this.$refs.modalEnvelope.mostrar()}catch(l){console.log(l)}finally{$q.loading.hide()}},async salvarEnvelope(i){$q.loading.show({message:"Salvando..."});try{i.arquivoOriginal=this.arquivoOriginal,await $db.documento.grava({atual:i.documento,original:this.envelopeOriginal.documento}),Object.keys(i.pupilometro.atual).length&&await $db.pupilometro.gravar({original:(i.pupilometro||{}).original,atual:(i.pupilometro||{}).atual}),await se("documentoItem",this.itensEnvelopeOriginal||[],i.documentoItens||[]),Object.keys(i.arquivoOriginal).length&&await $db.arquivo.remove(i.arquivoOriginal.filter(e=>!i.arquivo.find(l=>l.id===e.id)));for(const e of i.arquivo){let l={};Object.keys(i.arquivoOriginal).length?l={original:i.arquivoOriginal.find(r=>r.id===e.id)||[{}],atual:e}:l={atual:e},await $db.arquivo.grava(l)}this.atualizar()}catch(e){console.error("Erro ao gravar os dados: ",e),$q.notifyError("Erro ao salvar: ",e)}finally{$q.loading.hide()}},async removerEnvelope(i){$q.loading.show({message:"Excluindo..."});try{await console.log(`Envelope id: "${i}"`)}catch(e){console.log(e)}finally{$q.loading.hide()}},limparFiltros_click(){this.filtros={termoBusca:null,frase:null,numeroEnvelope:null,prazoSelecionado:null,empresaSelecionada:null,status:null,dataHoraEmissao:{ini:null,fim:null},dataHoraPrevisto:{ini:null,fim:null},dataHoraFinalizado:{ini:null,fim:null}},this.atualizar()}},props:{enableChanges:{type:Boolean,required:!1,default:!0}},async mounted(){this.empresaOpcoesCarregar(),this.atualizar()}},Ja={class:"mw80 text-center"},Ka={style:{background:"rgb(236, 239, 241)","border-radius":"50px","text-align":"center",display:"inline-block",width:"22px",height:"22px","line-height":"22px","margin-left":"8px","margin-right":"8px"}},$a={style:{background:"rgb(236, 239, 241)","border-radius":"50px","text-align":"center",display:"inline-block",width:"22px",height:"22px","line-height":"22px","margin-right":"8px"},class:"q-mr-sm"},Xa={style:{background:"rgb(236, 239, 241)","border-radius":"50px","text-align":"center",display:"inline-block",width:"22px",height:"22px","line-height":"22px","margin-right":"3px"}},Wa={style:{background:"rgb(236, 239, 241)","border-radius":"50px","text-align":"center",display:"inline-block",width:"22px",height:"22px","line-height":"22px","margin-right":"3px"}};function Ya(i,e,l,r,a,n){const p=V("campo"),w=V("badgeCopiarUid"),M=V("avatar"),A=V("badge"),g=V("g-col"),O=V("g-row"),K=V("g-label"),oo=V("lista"),eo=V("envelope"),ao=V("prompt-item-tabela-preco-novo");return f(),$(co,null,[o(oo,{titulo:"Envelopes",icone:"mdi-email",buscaCampo:a.buscaCampo,"onUpdate:buscaCampo":e[11]||(e[11]=u=>a.buscaCampo=u),onCriar_click:e[12]||(e[12]=u=>n.abrirModalEnvelope()),onFiltro_change:n.atualizar,onLimparFiltros_click:n.limparFiltros_click,lista:a.envelopes,paginacao:a.paginacao,filtros:a.filtros,tabSelecionada:a.tabSelecionada,tabs:a.tabs,checkboxVisible:!1,removerTodosVisible:!1,abrirTodosVisible:!1,exportarXLSXVisible:!1,multiplosBtnNovo:!1,showQuickAdd:!1,permissaoExtras:!1},{filtroCampos:t(()=>[o(p,{modelValue:a.filtros.frase,"onUpdate:modelValue":e[0]||(e[0]=u=>a.filtros.frase=u),rotulo:"Por cliente, paciente ou respons\xE1vel",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),o(p,{modelValue:a.filtros.numeroEnvelope,"onUpdate:modelValue":e[1]||(e[1]=u=>a.filtros.numeroEnvelope=u),rotulo:"N\xFAmero Envelope",tipo:"decimal",decimals:"0",zerosDireita:"0",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),o(no,{modelValue:a.filtros.prazoSelecionado,"onUpdate:modelValue":e[2]||(e[2]=u=>a.filtros.prazoSelecionado=u),options:a.prazoOpcoes,clearable:"",dense:"",label:"Por prazo",class:"q-field--with-bottom"},null,8,["modelValue","options"]),o(no,{modelValue:a.filtros.empresaSelecionada,"onUpdate:modelValue":e[3]||(e[3]=u=>a.filtros.empresaSelecionada=u),options:a.empresaOpcoes,clearable:"",dense:"",label:"Por empresa",class:"q-field--with-bottom"},null,8,["modelValue","options"]),o(p,{modelValue:a.filtros.dataHoraEmissao.ini,"onUpdate:modelValue":e[4]||(e[4]=u=>a.filtros.dataHoraEmissao.ini=u),rotulo:"Data cria\xE7\xE3o",tipo:"data",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),o(p,{modelValue:a.filtros.dataHoraEmissao.fim,"onUpdate:modelValue":e[5]||(e[5]=u=>a.filtros.dataHoraEmissao.fim=u),rotulo:"at\xE9",tipo:"data",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),o(p,{modelValue:a.filtros.dataHoraPrevisto.ini,"onUpdate:modelValue":e[6]||(e[6]=u=>a.filtros.dataHoraPrevisto.ini=u),rotulo:"Data previs\xE3o",tipo:"data",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),o(p,{modelValue:a.filtros.dataHoraPrevisto.fim,"onUpdate:modelValue":e[7]||(e[7]=u=>a.filtros.dataHoraPrevisto.fim=u),rotulo:"at\xE9",tipo:"data",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),o(p,{modelValue:a.filtros.dataHoraFinalizado.ini,"onUpdate:modelValue":e[8]||(e[8]=u=>a.filtros.dataHoraFinalizado.ini=u),rotulo:"Data finalizado",tipo:"data",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),o(p,{modelValue:a.filtros.dataHoraFinalizado.fim,"onUpdate:modelValue":e[9]||(e[9]=u=>a.filtros.dataHoraFinalizado.fim=u),rotulo:"at\xE9",tipo:"data",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),o(p,{modelValue:a.paginacao.limite,"onUpdate:modelValue":e[10]||(e[10]=u=>a.paginacao.limite=u),rotulo:"Quantidade por p\xE1gina",tipo:"quantidade",min:"1",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"])]),itemLista:t(()=>[o(X,{bordered:"",class:"bg-white q-mb-xs rounded-borders"},{default:t(()=>[(f(!0),$(co,null,go(a.envelopes,u=>(f(),$("div",{key:u.id,class:"itemHover"},[o(C,{"manual-focus":"",class:"q-py-sm q-px-xs items-center"},{default:t(()=>[o(d,{class:"hideonmobile col-auto q-pa-none"},{default:t(()=>[c("div",Ja,[o(w,{id:u.id,numero:u.numero,cor:"positive"},null,8,["id","numero"]),o(L,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[m("N\xFAmero Envelope")]),_:1})])]),_:2},1024),o(d,null,{default:t(()=>[o(C,{class:"q-pa-none"},{default:t(()=>[o(d,{class:"col-auto items-center"},{default:t(()=>[o(M,{imagem:(a.contatos[u.idContato]||{}).imagem,rotulo:u.descricaoContato,tamanho:"40"},null,8,["imagem","rotulo"])]),_:2},1024),o(d,{class:"col sm-shrink"},{default:t(()=>[o(P,{class:"text-tertiary text-weight-bold ellipsis-2-lines"},{default:t(()=>[m(h(u.descricaoContato)+" ",1),o(L,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[m("Paciente")]),_:1})]),_:2},1024),o(d,{class:"hideondesktop q-mt-xs"},{default:t(()=>[o(O,{mg:"xs-b"},{default:t(()=>[o(g,{col:"xs12 sm-shrink"},{default:t(()=>[o(A,{cor:u.status==="Entregue"?"positive":"light",escuro:u.status==="Entregue",class:"q-mr-sm"},{default:t(()=>[m(h(u.status)+" ",1),o(L,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[m("Status")]),_:1})]),_:2},1032,["cor","escuro"])]),_:2},1024)]),_:2},1024),o(O,{mg:"xs-b"},{default:t(()=>[o(g,{col:"xs12 sm-shrink"},{default:t(()=>[o(w,{id:u.id,numero:u.numero,cor:"positive"},null,8,["id","numero"]),o(L,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[m("N\xFAmero Envelope")]),_:1})]),_:2},1024),o(g,{col:"xs12 sm-shrink"},{default:t(()=>[c("div",Ka,[o(b,{name:"business",color:"grey-7",size:"14px"}),o(L,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[m(h(u.descricaoEmpresa),1)]),_:2},1024)]),c("div",$a,[o(b,{name:"person",color:"grey-7",size:"14px"}),o(L,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[m(h(a.responsaveis[u.idContatoResponsavel].nome),1)]),_:2},1024)])]),_:2},1024),o(g,{col:"xs12 sm-shrink"},{default:t(()=>[u.dataHoraEmissao?(f(),v(K,{key:0,tip:`Criado \xE1s ${i.$filters.hora(u.dataHoraEmissao)}`,icon:"mdi-calendar-today xs tertiary",inline:"",class:"q-mr-sm"},{default:t(()=>[m(h(i.$filters.data(u.dataHoraEmissao)),1)]),_:2},1032,["tip"])):_("",!0),u.dataHoraPrevisto?(f(),v(K,{key:1,tip:"Previs\xE3o para entrega",icon:"mdi-calendar-today xs tertiary",inline:"",class:"q-mr-sm"},{default:t(()=>[m(h(i.$filters.data(u.dataHoraPrevisto)),1)]),_:2},1024)):_("",!0),u.dataHoraFinalizado?(f(),v(K,{key:2,tip:`Finalizado \xE1s ${i.$filters.hora(u.dataHoraFinalizado)}`,icon:"mdi-calendar-today xs tertiary",inline:"",class:"q-mr-sm"},{default:t(()=>[m(h(i.$filters.data(u.dataHoraFinalizado)),1)]),_:2},1032,["tip"])):_("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),o(d,{class:"hideonmobile maxw110 q-pl-sm no-margin"},{default:t(()=>[u.dataHoraEmissao?(f(),v(P,{key:0,lines:"1",color:"tertiary",class:"ellipsis"},{default:t(()=>[o(b,{name:"mdi-calendar-today"}),m(" "+h(i.$filters.data(u.dataHoraEmissao))+" ",1),o(L,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[m("Criado \xE1s "+h(i.$filters.hora(u.dataHoraEmissao)),1)]),_:2},1024)]),_:2},1024)):_("",!0)]),_:2},1024),o(d,{class:"hideonmobile maxw110 q-pl-sm no-margin"},{default:t(()=>[u.dataHoraPrevisto?(f(),v(P,{key:0,lines:"1",color:"tertiary",class:"ellipsis"},{default:t(()=>[o(b,{name:"mdi-calendar-today"}),m(" "+h(i.$filters.data(u.dataHoraPrevisto))+" ",1),o(L,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[m("Previs\xE3o para entrega")]),_:1})]),_:2},1024)):_("",!0)]),_:2},1024),o(d,{class:"hideonmobile maxw110 q-pl-sm no-margin"},{default:t(()=>[u.dataHoraFinalizado?(f(),v(P,{key:0,lines:"1",color:"tertiary",class:"ellipsis"},{default:t(()=>[o(b,{name:"mdi-calendar-today"}),m(" "+h(i.$filters.data(u.dataHoraFinalizado))+" ",1),o(L,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[m("Finalizado \xE1s "+h(i.$filters.hora(u.dataHoraFinalizado)),1)]),_:2},1024)]),_:2},1024)):_("",!0)]),_:2},1024),o(d,{class:"hideonmobile maxw170 q-pl-sm no-margin"},{default:t(()=>[o(A,{cor:u.status==="Entregue"?"positive":"light",escuro:u.status==="Entregue",class:"col-auto q-mx-auto"},{default:t(()=>[m(h(u.status)+" ",1),o(L,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[m("Status")]),_:1})]),_:2},1032,["cor","escuro"])]),_:2},1024),o(d,{class:"col-auto q-pl-sm no-margin"},{default:t(()=>[o(C,{class:"q-pa-none"},{default:t(()=>[o(d,{class:"hideonmobile maxw10 q-pl-sm no-margin"},{default:t(()=>[c("div",Xa,[o(b,{name:"business",color:"grey-7",size:"14px"}),o(L,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[m(h(u.descricaoEmpresa),1)]),_:2},1024)])]),_:2},1024),o(d,{class:"hideonmobile maxw10 q-pl-sm no-margin"},{default:t(()=>[c("div",Wa,[o(b,{name:"person",color:"grey-7",size:"14px",class:""}),o(L,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[m(h(a.responsaveis[u.idContatoResponsavel].nome),1)]),_:2},1024)])]),_:2},1024)]),_:2},1024)]),_:2},1024),o(d,{class:"hideonmobile col-auto q-pl-sm no-margin"},{default:t(()=>[o(C,{class:"q-pa-none"},{default:t(()=>[o(d,{class:"q-pr-sm no-margin"},{default:t(()=>[o(y,{onClick:Y=>n.abrirModalEnvelope(u),icon:"edit",size:"md",color:"primary",round:"",flat:"",dense:""},{default:t(()=>[o(L,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[m("Editar")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),o(d,{class:"no-margin"},{default:t(()=>[o(y,{icon:"more_vert",size:"md",round:"",flat:"",dense:""},{default:t(()=>[o(Z,null,{default:t(()=>[G((f(),v(X,{link:"","no-border":"",separator:""},{default:t(()=>[o(C,{clickable:"",onClick:Y=>n.removerEnvelope(u.id)},{default:t(()=>[o(d,{avatar:""},{default:t(()=>[o(b,{name:"delete"})]),_:1}),o(d,null,{default:t(()=>[m(" Excluir ")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[J]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),o(d,{class:"hideondesktop col-auto q-pl-sm no-margin"},{default:t(()=>[o(C,{class:"q-pa-none"},{default:t(()=>[o(d,{class:"no-margin"},{default:t(()=>[o(y,{icon:"more_vert",size:"md",round:"",flat:"",dense:""},{default:t(()=>[o(Z,null,{default:t(()=>[G((f(),v(X,{link:"","no-border":"",separator:""},{default:t(()=>[o(C,{clickable:"",onClick:Y=>n.abrirModalEnvelope(u)},{default:t(()=>[o(d,{avatar:""},{default:t(()=>[o(b,{name:"edit"})]),_:1}),o(d,null,{default:t(()=>[m(" Editar Envelope")]),_:1})]),_:2},1032,["onClick"]),o(C,{clickable:""},{default:t(()=>[o(d,{avatar:""},{default:t(()=>[o(b,{name:"delete"})]),_:1}),o(d,null,{default:t(()=>[m(" Excluir ")]),_:1})]),_:1})]),_:2},1024)),[[J]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),o(ne)]))),128))]),_:1})]),_:1},8,["buscaCampo","onFiltro_change","onLimparFiltros_click","lista","paginacao","filtros","tabSelecionada","tabs"]),o(eo,{ref:"modalEnvelope",onSalvarEnvelope:n.salvarEnvelope,enableChanges:l.enableChanges},null,8,["onSalvarEnvelope","enableChanges"]),o(ao,{ref:"promptItemTabelaPreco",onSelecionar:n.selecionarItemTabelaPreco},null,8,["onSelecionar"])],64)}var lt=Bo(Ga,[["render",Ya]]);export{lt as default};
